<?xml version="1.0" encoding="UTF-8"?>
<d:DocumentationCore xmlns:d="http://math.spbu.ru/drl" xmlns="http://docbook.org/ns/docbook"><d:InfElement id="root" name="test">

<appendix id="coding-standard">
  <title>Zend Framework PHP Coding Standard</title>
    <sect1 id="coding-standard.overview">
        <title>Overview</title>

        <sect2 id="coding-standard.overview.scope">
            <title>Scope</title>

            <para>
                This document provides the code guidelines for developers
                and teams contributing to Zend Framework. The subjects covered are:

                <itemizedlist>
                    <listitem>
                        <para>PHP File Formatting</para>
                    </listitem>

                    <listitem>
                        <para>Naming Conventions</para>
                    </listitem>

                    <listitem>
                        <para>Coding Style</para>
                    </listitem>

                    <listitem>
                        <para>Inline Documentation</para>
                    </listitem>
                </itemizedlist>
            </para>
        </sect2>

        <sect2 id="coding-standard.overview.goals">
            <title>Goals</title>

            <para>
                Good coding standards are important in any development project, but particularly
                when multiple developers are working on the same project. Having coding standards
                helps ensure that the code is of high quality, has fewer bugs, and is easily maintained.
            </para>
        </sect2>
    </sect1>

    <sect1 id="coding-standard.php-file-formatting">
        <title>PHP File Formatting</title>

        <sect2 id="coding-standard.php-file-formatting.general">
            <title>General</title>

            <para>
                For files that contain only PHP code, the closing tag ("?>") is never permitted.  It is
                not required by PHP.  Not including it prevents trailing whitespace from being accidentally
                injected into the output.
            </para>

            <para>
                <emphasis>IMPORTANT:</emphasis> Inclusion of arbitrary binary data as permitted by <code>__HALT_COMPILER()</code>
                is prohibited from any Zend framework PHP file or files derived from them. Use of
                this feature is only permitted for special installation scripts.
            </para>
        </sect2>

        <sect2 id="coding-standard.php-file-formatting.indentation">
            <title>Indentation</title>

            <para>Use an indent of 4 spaces, with no tabs.</para>
        </sect2>

        <sect2 id="coding-standard.php-file-formatting.max-line-length">
            <title>Maximum Line Length</title>

            <para>
                The target line length is 80 characters, i.e. developers should aim keep code
                as close to the 80-column boundary as is practical. However, longer lines are
                acceptable. The maximum length of any line of PHP code is 120 characters.
            </para>
        </sect2>

        <sect2 id="coding-standard.php-file-formatting.line-termination">
            <title>Line Termination</title>

            <para>
                Line termination is the standard way for Unix text files. Lines must end only
                with a linefeed (LF). Linefeeds are represented as ordinal 10, or hexadecimal 0x0A.
            </para>

            <para>Do not use carriage returns (CR) like Macintosh computers (0x0D).</para>

            <para>
                Do not use the carriage return/linefeed combination (CRLF) as Windows computers
                (0x0D, 0x0A).
            </para>
        </sect2>
    </sect1>

    <sect1 id="coding-standard.naming-conventions">
        <title>Naming Conventions</title>

        <sect2 id="coding-standard.naming-conventions.classes">
            <title>Classes</title>

            <para>
                The Zend Framework employs a class naming convention whereby the names
                of the classes directly map to the directories in which they are stored.
                The root level directory of the Zend Framework is the "Zend/" directory,
                under which all classes are stored hierarchially.
            </para>

            <para>
                Class names may only contain alphanumeric characters.   Numbers are permitted
                in class names but are discouraged.  Underscores are only permitted in place
                of the path separator -- the filename "Zend/Db/Table.php" must map to the
                class name "Zend_Db_Table".
            </para>

            <para>
                If a class name is comprised of more than one word, the first letter of each new
                word must be capitalized.  Successive capitalized letters are not allowed, e.g.
                a class "Zend_PDF" is not allowed while "Zend_Pdf" is acceptable.
            </para>

            <para>
                Zend Framework classes that are authored by Zend or one of the participating
                partner companies and distributed with the Framework must always start with
                "Zend_" and must be stored under the "Zend/" directory hierarchy accordingly.
            </para>

            <para>
                These are examples of acceptable names for classes:

                <programlisting role="php"><![CDATA[
Zend_Db

Zend_View

Zend_View_Helper]]>
                </programlisting>

                <emphasis>IMPORTANT:</emphasis> Code that operates with the framework but is not
                part of the framework, e.g. code written by a framework end-user and not Zend or
                one of the framework's partner companies, must never start with "Zend_".
            </para>
        </sect2>

        <sect2 id="coding-standard.naming-conventions.interfaces">
            <title>Interfaces</title>

            <para>
                Interface classes must follow the same conventions as other classes (see above),
                however must end with the word "Interface", such as in these examples:

                <programlisting role="php"><![CDATA[
Zend_Log_Adapter_Interface
Zend_Controller_Dispatcher_Interface]]>
                </programlisting>
            </para>
        </sect2>

        <sect2 id="coding-standard.naming-conventions.filenames">
            <title>Filenames</title>

            <para>
                For all other files, only alphanumeric characters, underscores, and the dash
                character ("-") are permitted. Spaces are prohibited.
            </para>

            <para>
                Any file that contains any PHP code must end with the extension ".php". These
                examples show the acceptable filenames for containing the class names from the
                examples in the section above:

                <programlisting role="php"><![CDATA[
Zend/Db.php

Zend/Controller/Front.php

Zend/View/Helper/FormRadio.php]]>
                </programlisting>

                File names must follow the mapping to class names described above.
            </para>
        </sect2>

        <sect2 id="coding-standard.naming-conventions.functions-and-methods">
            <title>Functions and Methods</title>

            <para>
                Function names may only contain alphanumeric characters. Underscores are not permitted.
                Numbers are permitted in function names but are discouraged.
            </para>

            <para>
                Function names must always start with a lowercase letter. When a function name consists
                of more than one word, the first letter of each new word must be capitalized. This is
                commonly called "camelCase" formatting.
            </para>

            <para>
                Verbosity is encouraged. Function names should be as verbose as is practical to enhance the
                understandability of code.
            </para>

            <para>
                These are examples of acceptable names for functions:

                <programlisting role="php"><![CDATA[
filterInput()

getElementById()

widgetFactory()]]>
                </programlisting>
            </para>

            <para>
                For object-oriented programming, accessors for objects should always be prefixed with
                either "get" or "set". When using design patterns, such as the singleton or factory
                patterns, the name of the method should contain the pattern name where practical to
                make the pattern more readily recognizable.
            </para>
            
            <para>
                For methods on objects that are declared with the "private" or "protected" construct,
                the first character of the variable name must be a single underscore. This is the only
                acceptable usage of an underscore in a method name. Methods declared "public"
                may never start with an underscore.
            </para>

            <para>
                Functions in the global scope ("floating functions") are permitted but discouraged.
                It is recommended that these functions should be wrapped in a static class.
            </para>
        </sect2>

        <sect2 id="coding-standard.naming-conventions.variables">
            <title>Variables</title>

            <para>
                Variable names may only contain alphanumeric characters. Underscores are not permitted.
                Numbers are permitted in variable names but are discouraged.
            </para>

            <para>
                For class member variables that are declared with the "private" or "protected" construct,
                the first character of the variable name must be a single underscore. This is the only
                acceptable usage of an underscore in a variable name. Member variables declared "public"
                may never start with an underscore.
            </para>

            <para>
                Like function names (see section 3.3, above) variable names must always start with a
                lowercase letter and follow the "camelCaps" capitalization convention.
            </para>

            <para>
                Verbosity is encouraged. Variables should always be as verbose as practical. Terse variable
                names such as "$i" and "$n" are discouraged for anything other than the smallest loop contexts.
                If a loop contains more than 20 lines of code, the variables for the indices need to have more
                descriptive names.
            </para>
        </sect2>

        <sect2 id="coding-standard.naming-conventions.constants">
            <title>Constants</title>

            <para>
                Constants may contain both alphanumeric characters and the underscore. Numbers are permitted
                in constant names.
            </para>

            <para>
                Constants must always have all letters capitalized.
            </para>

            <para>
                To enhance readablity, words in constant names must be separated by underscore characters. For
                example, <code>EMBED_SUPPRESS_EMBED_EXCEPTION</code> is permitted but
                <code>EMBED_SUPPRESSEMBEDEXCEPTION</code> is not.
            </para>

            <para>
                Constants must be defined as class members by using the "const" construct. Defining constants
                in the global scope with "define" is permitted but discouraged.
            </para>
        </sect2>
    </sect1>

    <sect1 id="coding-standard.coding-style">
        <title>Coding Style</title>

        <sect2 id="coding-standard.coding-style.php-code-demarcation">
            <title>PHP Code Demarcation</title>

            <para>
                PHP code must always be delimited by the full-form, standard PHP tags:

                <programlisting role="php"><![CDATA[<?php

?>]]></programlisting>
            </para>

            <para>
                Short tags are never allowed.  For files containing only PHP code, the
                closing tag must always be omitted (See <xref linkend="coding-standard.php-file-formatting.general" />).
            </para>
        </sect2>

        <sect2 id="coding-standard.coding-style.strings">
            <title>Strings</title>

            <sect3 id="coding-standard.coding-style.strings.literals">
                <title>String Literals</title>

                <para>
                    When a string is literal (contains no variable substitutions), the apostrophe or
                    "single quote" must always used to demarcate the string:

                    <programlisting role="php"><![CDATA[
$a = 'Example String';]]>
                    </programlisting>
                </para>
            </sect3>

            <sect3 id="coding-standard.coding-style.strings.literals-containing-apostrophes">
                <title>String Literals Containing Apostrophes</title>

                <para>
                    When a literal string itself contains apostrophes, it is permitted to demarcate
                    the string with quotation marks or "double quotes". This is especially encouraged
                    for SQL statements:

                    <programlisting role="php"><![CDATA[
$sql = "SELECT `id`, `name` from `people` WHERE `name`='Fred' OR `name`='Susan'";]]>
                    </programlisting>

                    The above syntax is preferred over escaping apostrophes.
                </para>
            </sect3>

            <sect3 id="coding-standard.coding-style.strings.variable-substitution">
                <title>Variable Substitution</title>

                <para>
                    Variable substitution is permitted using either of these two forms:

                    <programlisting role="php"><![CDATA[
$greeting = "Hello $name, welcome back!";

$greeting = "Hello {$name}, welcome back!";]]>
                    </programlisting>
                </para>

                <para>
                    For consistency, this form is not permitted:

                    <programlisting role="php"><![CDATA[
$greeting = "Hello ${name}, welcome back!";]]>
                    </programlisting>
                </para>
            </sect3>

            <sect3 id="coding-standard.coding-style.strings.string-concatenation">
                <title>String Concatenation</title>

                <para>
                    Strings may be concatenated using the "." operator. A space must always
                    be added before and after the "." operator to improve readability:

                    <programlisting role="php"><![CDATA[
$company = 'Zend' . ' ' . 'Technologies';]]>
                    </programlisting>
                </para>

                <para>
                    When concatenating strings with the "." operator, it is permitted to
                    break the statement into multiple lines to improve readability. In these
                    cases, each successive line should be padded with whitespace such that the
                    "."; operator is aligned under the "=" operator:

                    <programlisting role="php"><![CDATA[
$sql = "SELECT `id`, `name` FROM `people` "
     . "WHERE `name` = 'Susan' "
     . "ORDER BY `name` ASC ";]]>
                    </programlisting>
                </para>
            </sect3>
        </sect2>

        <sect2 id="coding-standard.coding-style.arrays">
            <title>Arrays</title>

            <sect3 id="coding-standard.coding-style.arrays.numerically-indexed">
                <title>Numerically Indexed Arrays</title>

                <para>Negative numbers are not permitted as indices.</para>

                <para>
                    An indexed array may be started with any non-negative number, however
                    this is discouraged and it is recommended that all arrays have a base index of 0.
                </para>

                <para>
                    When declaring indexed arrays with the <code>array</code> construct, a trailing space must be
                    added after each comma delimiter to improve readability:

                    <programlisting role="php"><![CDATA[
$sampleArray = array(1, 2, 3, 'Zend', 'Studio');]]>
                    </programlisting>
                </para>

                <para>
                    It is also permitted to declare multiline indexed arrays using the "array" construct.
                    In this case, each successive line must be padded with spaces such that beginning of
                    each line aligns as shown below:

                    <programlisting role="php"><![CDATA[
$sampleArray = array(1, 2, 3, 'Zend', 'Studio',
                     $a, $b, $c,
                     56.44, $d, 500);]]>
                    </programlisting>
                </para>
            </sect3>

            <sect3 id="coding-standard.coding-style.arrays.associative">
                <title>Associative Arrays</title>

                <para>
                    When declaring associative arrays with the <code>array</code> construct, it is encouraged
                    to break the statement into multiple lines. In this case, each successive line must be
                    padded with whitespace such that both the keys and the values are aligned:

                    <programlisting role="php"><![CDATA[
$sampleArray = array('firstKey'  => 'firstValue',
                     'secondKey' => 'secondValue');]]>
                    </programlisting>
                </para>
            </sect3>
        </sect2>

        <sect2 id="coding-standard.coding-style.classes">
            <title>Classes</title>

            <sect3 id="coding-standard.coding-style.classes.declaration">
                <title>Class Declaration</title>

                <para>
                    Classes must be named by following the naming conventions.
                </para><para>
                    The brace is always written on the line underneath the class name ("one true brace" form).
                </para><para>
                    Every class must have a documentation block that conforms to the PHPDocumentor standard.
                </para><para>
                    Any code within a class must be indented four spaces.
                </para><para>
                    Only one class is permitted per PHP file.
                </para><para>
                    Placing additional code in a class file is permitted but discouraged. In these files, two blank lines must separate the class from any additional PHP code in the file.
                </para><para>
                    This is an example of an acceptable class declaration:

                    <programlisting role="php"><![CDATA[
/**
 * Documentation Block Here
 */
class SampleClass
{
    // entire content of class
    // must be indented four spaces
}]]>
                    </programlisting>
                </para>
            </sect3>

            <sect3 id="coding-standard.coding-style.classes.member-variables">
                <title>Class Member Variables</title>

                <para>
                    Member variables must be named by following the variable naming conventions.
                </para><para>
                    Any variables declared in a class must be listed at the top of the class, prior
                    to declaring any methods.
                </para><para>
                    The <code>var</code> construct is not permitted.  Member variables always declare
                    their visibility by using one of the <code>private</code>, <code>protected</code>,
                    or <code>public</code> constructs. Accessing member variables directly by making
                    them public is permitted but discouraged in favor of accessor
                    methods (set/get).
                </para>
            </sect3>
        </sect2>

        <sect2 id="coding-standard.coding-style.functions-and-methods">
            <title>Functions and Methods</title>

            <sect3 id="coding-standard.coding-style.functions-and-methods.declaration">
                <title>Function and Method Declaration</title>

                <para>
                    Functions must be named by following the naming conventions.
                </para><para>
                    Methods inside classes must always declare their visibility by using
                    one of the <code>private</code>, <code>protected</code>,
                    or <code>public</code> constructs.
                </para><para>
                    Like classes, the brace is always written on the line underneath the
                    function name ("one true brace" form).

                    There is no space between the
                    function name and the opening parenthesis for the arguments.
                </para><para>
                    Functions in the global scope are strongly discouraged.
                </para><para>
                    This is an example of an acceptable function declaration in a class:

                    <programlisting role="php"><![CDATA[
/**
 * Documentation Block Here
 */
class Foo
{
    /**
     * Documentation Block Here
     */
    public function bar()
    {
        // entire content of function
        // must be indented four spaces
    }
}]]>
                    </programlisting>
                </para>

                <para>
                    <emphasis>NOTE:</emphasis> Pass-by-reference is permitted in the function declaration only:

                    <programlisting role="php"><![CDATA[
/**
 * Documentation Block Here
 */
class Foo
{
    /**
     * Documentation Block Here
     */
    public function bar(&$baz)
    {}
}]]>
                    </programlisting>
                </para>

                <para>
                    Call-time pass-by-reference is prohibited.
                </para>


                <para>
                    The return value must not be enclosed in parentheses.  This can hinder readability
                    and can also break code if a method is later changed to return by reference.

                    <programlisting role="php"><![CDATA[
/**
 * Documentation Block Here
 */
class Foo
{
    /**
     * WRONG
     */
    public function bar()
    {
        return($this->bar);
    }

    /**
     * RIGHT
     */
    public function bar()
    {
        return $this->bar;
    }
}]]>
                    </programlisting>
                </para>

            </sect3>

            <sect3 id="coding-standard.coding-style.functions-and-methods.usage">
                <title>Function and Method Usage</title>

                <para>
                    Function arguments are separated
                    by a single trailing space after the comma delimiter. This is an example of an
                    acceptable function call for a function that takes three arguments:

                    <programlisting role="php"><![CDATA[
threeArguments(1, 2, 3);]]>
                    </programlisting>
                </para>

                <para>
                    Call-time pass-by-reference is prohibited. See the function declarations section
                    for the proper way to pass function arguments by-reference.
                </para><para>
                    For functions whose arguments permit arrays, the function call may include the
                    "array" construct and can be split into multiple lines to improve readability.  In
                    these cases, the standards for writing arrays still apply:

                    <programlisting role="php"><![CDATA[
threeArguments(array(1, 2, 3), 2, 3);

threeArguments(array(1, 2, 3, 'Zend', 'Studio',
                     $a, $b, $c,
                     56.44, $d, 500), 2, 3);]]>
                    </programlisting>
                </para>
            </sect3>
        </sect2>

        <sect2 id="coding-standard.coding-style.control-statements">
            <title>Control Statements</title>

            <sect3 id="coding-standard.coding-style.control-statements.if-else-elseif">
                <title>If / Else / Elseif</title>

                <para>
                    Control statements based on the <code>if</code> and <code>elseif</code>
                    constructs must have a single space before the opening parenthesis of the conditional,
                    and a single space after the closing parenthesis.
                </para>

                <para>
                    Within the conditional statements between the parentheses, operators must be separated
                    by spaces for readability. Inner parentheses are encouraged to improve logical grouping
                    of larger conditionals.
                </para>

                <para>
                    The opening brace is written on the same line as the conditional statement. The closing
                    brace is always written on its own line. Any content within the braces must be
                    indented four spaces.

                    <programlisting role="php"><![CDATA[
if ($a != 2) {
    $a = 2;
}]]>
                    </programlisting>
                </para>

                <para>
                    For "if" statements that include "elseif" or "else", the formatting conventions are as shown
                    in the following examples:

                    <programlisting role="php"><![CDATA[
if ($a != 2) {
    $a = 2;
} else {
   $a = 7;
}


if ($a != 2) {
    $a = 2;
} elseif ($a == 3) {
   $a = 4;
} else {
   $a = 7;
}]]>
                    </programlisting>
                    PHP allows for these statements to be written without braces in some circumstances.
                    The coding standard makes no differentiation and all "if", "elseif" or "else" statements
                    must use braces.
                </para>

                <para>
                    Use of the "elseif" construct is permitted but highly discouraged in favor of the
                    "else if" combination.
                </para>
            </sect3>

            <sect3 id="coding-standards.coding-style.control-statements.switch">
                <title>Switch</title>

                <para>
                    Control statements written with the "switch" construct must have a single space before
                    the opening parenthesis of the conditional statement, and also a single space after
                    the closing parenthesis.
                </para>

                <para>
                    All content within the "switch" statement must be indented four spaces. Content under
                    each "case" statement must be indented an additional four spaces.
                </para>

                <programlisting role="php"><![CDATA[
switch ($numPeople) {
    case 1:
        break;

    case 2:
        break;

    default:
        break;
}]]>
                </programlisting>

                <para>
                    The construct <code>default</code> may never be omitted from a <code>switch</code> statement.
                </para>

                <para>
                    <emphasis>NOTE:</emphasis> It is sometimes useful to write a <code>case</code> statement which falls through
                    to the next case by not including a <code>break</code> or <code>return</code> in that case. To distinguish
                    these cases from bugs, any <code>case</code> statement where <code>break</code> or <code>return</code> are
                    omitted must contain the comment "// break intentionally omitted".
                </para>
            </sect3>
        </sect2>

        <sect2 id="coding-standards.inline-documentation">
            <title>Inline Documentation</title>

            <sect3 id="coding-standards.inline-documentation.documentation-format">
                <title>Documentation Format</title>

                <para>
                    All documentation blocks ("docblocks") must be compatible with the phpDocumentor format.
                    Describing the phpDocumentor format is beyond the scope of this document.
                    For more information, visit: <ulink url="http://phpdoc.org/">http://phpdoc.org/</ulink>
                </para>

                <para>
                    All source code files written for Zend Framework or that operate with the framework
                    must contain a "file-level" docblock at the top of each file and a "class-level" docblock
                    immediately above each class. Below are examples of such docblocks.
                </para>
            </sect3>

            <sect3 id="coding-standards.inline-documentation.files">
                <title>Files</title>

                <para>
                    Every file that contains PHP code must have a header block at the top of the file that
                    contains these phpDocumentor tags at a minimum:

                    <programlisting role="php"><![CDATA[
/**
 * Short description for file
 *
 * Long description for file (if any)...
 *
 * LICENSE: Some license information
 *
 * @copyright  2005 Zend Technologies
 * @license    http://www.zend.com/license/3_0.txt   PHP License 3.0
 * @version    $Id:$
 * @link       http://dev.zend.com/package/PackageName
 * @since      File available since Release 1.2.0
*/]]>
                    </programlisting>
                </para>
            </sect3>

            <sect3 id="coding-standards.inline-documentation.classes">
                <title>Classes</title>

                <para>
                    Every class must have a docblock that contains these phpDocumentor tags at a minimum:

                    <programlisting role="php"><![CDATA[
/**
 * Short description for class
 *
 * Long description for class (if any)...
 *
 * @copyright  2005 Zend Technologies
 * @license    http://www.zend.com/license/3_0.txt   PHP License 3.0
 * @version    Release: @package_version@
 * @link       http://dev.zend.com/package/PackageName
 * @since      Class available since Release 1.2.0
 * @deprecated Class deprecated in Release 2.0.0
 */]]>
                    </programlisting>
                </para>
            </sect3>

            <sect3 id="coding-standards.inline-documentation.functions">
                <title>Functions</title>

                <para>
                Every function, including object methods, must have a docblock that contains at a minimum:

                    <itemizedlist>
                        <listitem><para>A description of the function</para></listitem>
                        <listitem><para>All of the arguments</para></listitem>
                        <listitem><para>All of the possible return values</para></listitem>
                    </itemizedlist>
                </para>

                <para>
                    It is not necessary to use the "@access" tag because the access level is already known
                    from the "public", "private", or "protected" construct used to declare the function.
                </para>

                <para>
                    If a function/method may throw an exception, use @throws:

                    <programlisting role="php"><![CDATA[
@throws exceptionclass [description]]]>
                    </programlisting>
                </para>
            </sect3>
        </sect2>
    </sect1>

</appendix>
<!--
vim:se ts=4 sw=4 et:
-->
<appendix id="copyrights">
    <title>Copyright Information</title>

    <para>
        The following copyrights are applicable to portions of the Zend Framework.
    </para>

    <para>
        Copyright &#169; 2005-<?dbtimestamp format="Y"?> Zend Technologies Inc.
        (<ulink url="http://www.zend.com" />)
    </para>

</appendix>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="introduction.installation">

    <title>Installation</title>

    <para>
        Zend Framework is built with object-oriented PHP 5 and requires PHP 5.1.4 or later. Please see the
        <link linkend="requirements">system requirements appendix</link> for more detailed information.
    </para>

    <para>
        Once an appropriate PHP environment is available, the next step is to get a copy of the Zend Framework, which
        may be officially obtained by any of the following methods:

        <itemizedlist>
            <listitem>
                <para>
                    <ulink url="http://framework.zend.com/download">Download the latest stable release.</ulink>
                    This version, available in both <code>.zip</code> and <code>.tar.gz</code> formats, is a good
                    choice for those who are new to Zend Framework.
                </para>
            </listitem>
            <listitem>
                <para>
                    <ulink url="http://framework.zend.com/download/snapshot">Download the latest nightly
                    snapshot.</ulink> For those who would brave the cutting edge, the nightly snapshots represent the
                    latest progress of Zend Framework development. Snapshots are bundled with documentation either in
                    English only or in all available languages. If you anticipate working with the latest Zend
                    Framework developments, consider using a Subversion (SVN) client.
                </para>
            </listitem>
            <listitem>
                <para>
                    Using a <ulink url="http://subversion.tigris.org">Subversion</ulink> (SVN) client. Zend Framework
                    is open source software, and the Subversion repository used for its development is publicly
                    available. Consider using SVN to get the Zend Framework if you already use SVN for your
                    application development, want to contribute back to the framework, or need to upgrade your
                    framework version more often than releases occur.
                </para>
                <para>
                    <ulink url="http://svnbook.red-bean.com/nightly/en/svn.ref.svn.c.export.html">Exporting</ulink> is
                    useful if you want to get a particular framework revision without the <code>.svn</code>
                    directories as created in a working copy.
                </para>
                <para>
                    <ulink url="http://svnbook.red-bean.com/nightly/en/svn.ref.svn.c.checkout.html">Checking out a
                    working copy</ulink> is good when you might contribute to Zend Framework, and a working copy can
                    be updated any time with
                    <ulink url="http://svnbook.red-bean.com/nightly/en/svn.ref.svn.c.update.html"><code>svn
                    update</code></ulink>.
                </para>
                <para>
                    <ulink url="http://svnbook.red-bean.com/nightly/en/svn.advanced.externals.html">An externals
                    definition</ulink> is highly convenient for developers already using SVN to manage their
                    application working copies.
                </para>
                <para>
                    The URL for the trunk of the Zend Framework SVN repository is:
                    <ulink url="http://framework.zend.com/svn/framework/trunk">http://framework.zend.com/svn/framework/trunk</ulink>
                </para>
            </listitem>
        </itemizedlist>
    </para>

    <para>
        Once you have a copy of the Zend Framework available, your application needs to be able to access the
        framework classes. Though there are
        <ulink url="http://www.php.net/manual/en/configuration.changes.php">
        several ways to achieve this</ulink>, your PHP
        <ulink url="http://www.php.net/manual/en/ini.core.php#ini.include-path"><code>include_path</code></ulink>
        needs to contain the path to the Zend Framework library.
    </para>

    <para>
        One of the Zend Framework's most useful features is its implementation of the
        <ulink url="http://www.martinfowler.com/eaaCatalog/frontController.html">Front Controller</ulink> and
        <ulink url="http://en.wikipedia.org/wiki/Model-view-controller">Model-View-Controller</ulink> (MVC)
        patterns.
        <link linkend="zend.controller.quickstart">Get started with Zend Framework MVC!</link>
    </para>

    <para>
        Since Zend Framework components are rather loosely coupled, various components may be selected for
        independent use as needed. Each of the following chapters documents the use of a particular component.
    </para>

</sect1>
<sect1 id="introduction.overview">

    <title>Overview</title>

    <para>
        Zend Framework is a high quality and open source framework for developing Web
        Applications and Web Services with PHP.
    </para>

    <para>
        Built in the true PHP spirit, the Zend Framework delivers ease-of-use and
        powerful functionality. It provides solutions for building modern, robust, and
        secure websites.
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<appendix id="requirements">

    <title>System Requirements</title>

    <para>
        This section documents requirements for Zend Framework.
    </para>

    <sect1 id="requirements.version">

        <title>PHP Version Required</title>

        <para>
            Zend Framework requires PHP 5.1.4 or later.  Some SPL interfaces
            such as <code>Countable</code> were not stable in earlier versions
            of PHP.
        </para>

        <para>
            Zend Framework has an extensive collection of automated tests,
            which you can run using PHPUnit 3.0 or later.  This version of
            PHPUnit also requires PHP 5.1.4 or later.
        </para>

        <para>
            Although Zend Framework will function correctly with the PHP version
            mentioned above, you are strongly recommended to use PHP 5.2.3 or
            later.  There are important security and performance improvements
            available in the newer version of PHP.
        </para>

    </sect1>

    <sect1 id="requirements.extensions">

        <title>PHP Extensions</title>

        <para>
            Below is a table that lists all extensions typically found in PHP,
            and how they are used in Zend Framework.  This can help guide you
            to know which extensions are required for your application.
            Not all extensions used by Zend Framework are required for every
            application.
        </para>

        <para>
            A usage type of "Dependency" means that the components or classes
            are not usable if the respective extension is not available.  A
            usage type of "Optional" means that if the extension is not
            available, the components or classes automatically fall back to
            use alternative code.
        </para>

        <table frame='all' id="requirements.extensions.table-1">
            <title>PHP Extensions Used in Zend Framework</title>
            <tgroup cols='3'>
                <colspec colwidth='1in'/>
                <colspec colwidth='1in'/>
                <colspec colwidth='3in'/>
                <thead>
                    <row>
                        <entry>Extension</entry>
                        <entry>Usage Type</entry>
                        <entry>Used by Zend Framework Components</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.apc.php"><code>apc</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.cache.backends.html"><code>Zend_Cache_Backend_Apc</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.bc.php"><code>bcmath</code></ulink></entry>
                        <entry>Optional</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.locale.html"><code>Zend_Locale_Math</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://pecl.php.net/package/Bitset"><code>bitset</code></ulink></entry>
                        <entry>Optional</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.search.lucene.html"><code>Zend_Search_Lucene</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.bzip2.php"><code>bz2</code></ulink></entry>
                        <entry>--</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.calendar.php"><code>calendar</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.com.php"><code>com_dotnet</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                           <ulink url="http://framework.zend.com/manual/en/zend.auth.adapter.http.html"><code>Zend_Auth_Adapter_Http</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.gdata.html"><code>Zend_Gdata_App</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.http.html"><code>Zend_Http_Client</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.pdf.html"><code>Zend_Pdf</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.rest.client.html"><code>Zend_Rest_Client</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.rest.server.html"><code>Zend_Rest_Server</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.search.lucene.html"><code>Zend_Search_Lucene</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.uri.html"><code>Zend_Uri</code></ulink>,
                           <ulink url="http://framework.zend.com/manual/en/zend.validate.html"><code>Zend_Validate</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.curl.php"><code>curl</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.http.client.adapters.html"><code>Zend_Http_Client_Adapter_Curl</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.datetime.php"><code>date</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.dba.php"><code>dba</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.dbase.php"><code>dbase</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://framework.zend.com/manual/en/zend.feed.html"><code>Zend_Feed</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.gdata.html"><code>Zend_Gdata</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.log.formatters.html"><code>Zend_Log_Formatter_Xml</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.rest.server.html"><code>Zend_Rest_Server</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.search.lucene.html"><code>Zend_Search_Lucene</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.amazon.html"><code>Zend_Service_Amazon</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.delicious.html"><code>Zend_Service_Delicious</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.flickr.html"><code>Zend_Service_Flickr</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.simpy.html"><code>Zend_Service_Simpy</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.yahoo.html"><code>Zend_Service_Yahoo</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.xmlrpc.html"><code>Zend_XmlRpc</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.exif.php"><code>exif</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.fbsql.php"><code>fbsql</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.fdf.php"><code>fdf</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.filter.php"><code>filter</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ftp.php"><code>ftp</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.image.php"><code>gd</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.pdf.html"><code>Zend_Pdf</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.gettext.php"><code>gettext</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.gmp.php"><code>gmp</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.hash.php"><code>hash</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.auth.adapter.http.html"><code>Zend_Auth_Adapter_Http</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ibm-db2.php"><code>ibm_db2</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Db2</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://framework.zend.com/manual/en/zend.locale.parsing.html"><code>Zend_Locale_Format</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.mime.html"><code>Zend_Mime_Decode</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.pdf.html"><code>Zend_Pdf</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.search.lucene.html"><code>Zend_Search_Lucene</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.audioscrobbler.html"><code>Zend_Service_Audioscrobbler</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.flickr.html"><code>Zend_Service_Flickr</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.xmlrpc.client.html"><code>Zend_XmlRpc_Client</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.imap.php"><code>imap</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ifx.php"><code>informix</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ibase.php"><code>interbase</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>Zend_Db_Adapter_Firebird</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.json.php"><code>json</code></ulink></entry>
                        <entry>Optional</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.json.html"><code>Zend_Json</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ldap.php"><code>ldap</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>DOM</code></ulink>,
                            <ulink url="http://www.php.net/manual/en/ref.simplexml.php"><code>SimpleXML</code></ulink>,
                            <ulink url="http://www.php.net/manual/en/ref.xslt.php"><code>XSLT</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.mbstring.php"><code>mbstring</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.feed.html"><code>Zend_Feed</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.mcrypt.php"><code>mcrypt</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.memcache.php"><code>memcache</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.cache.backends.html"><code>Zend_Cache_Backend_Memcached</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.mhash.php"><code>mhash</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.mime-magic.php"><code>mime_magic</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.http.html"><code>Zend_Http_Client</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ming.php"><code>ming</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.msql.php"><code>msql</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.mssql.php"><code>mssql</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.mysql.php"><code>mysql</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.mysqli.php"><code>mysqli</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Mysqli</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.ncurses.php"><code>ncurses</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.oci8.php"><code>oci8</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Oracle</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.uodbc.php"><code>odbc</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.openssl.php"><code>openssl</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pcntl.php"><code>pcntl</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pcre.php"><code>pcre</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>Virtually all components</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pdo.php"><code>pdo</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>All PDO database adapters</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pdo-dblib.php"><code>pdo_dblib</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pdo-firebird.php"><code>pdo_firebird</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><code>pdo_mssql</code></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Mssql</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pdo-mysql.php"><code>pdo_mysql</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Mysql</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pdo-oci.php"><code>pdo_oci</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Oci</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pdo-pgsql.php"><code>pdo_pgsql</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Pgsql</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pdo-sqlite.php"><code>pdo_sqlite</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Sqlite</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pgsql.php"><code>pgsql</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.posix.php"><code>posix</code></ulink></entry>
                        <entry>Optional</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.mail.html"><code>Zend_Mail</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.pspell.php"><code>pspell</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.readline.php"><code>readline</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.recode.php"><code>recode</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://framework.zend.com/manual/en/zend.controller.html"><code>Zend_Controller</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.filter.html"><code>Zend_Filter</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.filter.input.html"><code>Zend_Filter_Input</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.json.html"><code>Zend_Json</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.log.html"><code>Zend_Log</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.rest.server.html"><code>Zend_Rest_Server</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.server.reflection.html"><code>Zend_Server_Reflection</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.validate.html"><code>Zend_Validate</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.view.html"><code>Zend_View</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.xmlrpc.server.html"><code>Zend_XmlRpc_Server</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.session.php"><code>session</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://framework.zend.com/manual/en/zend.controller.actionhelpers.html"><code>Zend_Controller_Action_Helper_Redirector</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.session.html"><code>Zend_Session</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.shmop.php"><code>shmop</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.simplexml.php"><code>SimpleXML</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://framework.zend.com/manual/en/zend.config.adapters.xml.html"><code>Zend_Config_Xml</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.feed.html"><code>Zend_Feed</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.rest.client.html"><code>Zend_Rest_Client</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.service.audioscrobbler.html"><code>Zend_Service_Audioscrobbler</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.xmlrpc.html"><code>Zend_XmlRpc</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.soap.php"><code>soap</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.strikeiron.html"><code>Zend_Service_StrikeIron</code></ulink></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.sockets.php"><code>sockets</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.spl.php"><code>SPL</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>Virtually all components</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.sqlite.php"><code>SQLite</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.cache.backends.html">Zend_Cache_Backend_Sqlite</ulink></entry>
                    </row>
                    <row>
                        <entry><code>standard</code></entry>
                        <entry>Dependency</entry>
                        <entry>Virtually all components</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.sybase.php"><code>sybase</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>sysvmsg</entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>sysvsem</entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>sysvshm</entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.tidy.php"><code>tidy</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.tokenizer.php"><code>tokenizer</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.wddx.php"><code>wddx</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.xml.php"><code>xml</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://framework.zend.com/manual/en/zend.translate.adapter.html"><code>Zend_Translate_Adapter_Qt</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.translate.adapter.html"><code>Zend_Translate_Adapter_Tmx</code></ulink>,
                            <ulink url="http://framework.zend.com/manual/en/zend.translate.adapter.html"><code>Zend_Translate_Adapter_Xliff</code></ulink>
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.xmlreader.php"><code>XMLReader</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.xmlrpc.php"><code>xmlrpc</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.xmlwriter.php"><code>XMLWriter</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.xsl.php"><code>xsl</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.zip.php"><code>zip</code></ulink></entry>
                        <entry>---</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><ulink url="http://www.php.net/manual/en/ref.zlib.php"><code>zlib</code></ulink></entry>
                        <entry>Dependency</entry>
                        <entry>
                            <ulink url="http://framework.zend.com/manual/en/zend.pdf.html"><code>Zend_Pdf</code></ulink>,
                            <ulink url="http://www.php.net/manual/en/ref.memcache.php"><code>Memcache</code></ulink>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect1>

    <sect1 id="requirements.zendcomponents">

        <title>Zend Framework Components</title>

        <para>
            Below is a table that lists all available Zend Framework Components
            and which PHP extension they need. This can help guide you
            to know which extensions are required for your application.
            Not all extensions used by Zend Framework are required for every
            application.
        </para>

        <table frame='all' id="requirements.zendcomponents.table-1">
            <title>Zend Framework Components and the PHP Extensions they use</title>
            <tgroup cols='3'>
                <colspec colwidth='2in'/>
                <colspec colwidth='4in'/>
                <thead>
                    <row>
                        <entry>Zend Framework Components</entry>
                        <entry>PHP Extension ( Subclass / Usage Type )</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>All Components</entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.pcre.php"><code>pcre</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.spl.php"><code>SPL</code></ulink>
                            ( Dependency )
                            <code>standard</code>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.acl.html"><code>Zend_Acl</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.auth.html"><code>Zend_Auth</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.auth.adapter.http.html"><code>Zend_Auth_Adapter_Http</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.hash.php"><code>hash</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.auth.adapter.http.html"><code>Zend_Auth_Adapter_Http</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.cache.html"><code>Zend_Cache</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.apc.php"><code>apc</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.cache.backends.html"><code>Zend_Cache_Backend_Apc</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.memcache.php"><code>memcache</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.cache.backends.html"><code>Zend_Cache_Backend_Memcached</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.sqlite.php"><code>sqlite</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.cache.backends.html"><code>Zend_Cache_Backend_Sqlite</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.zlib.php"><code>zlib</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.cache.backends.html"><code>Zend_Cache_Backend_Zlib</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.config.html"><code>Zend_Config</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.config.adapters.xml.html"><code>Zend_Config_Xml</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.simplexml.php"><code>SimpleXML</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.config.adapters.xml.html"><code>Zend_Config_Xml</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.console.getopt.html"><code>Zend_Console_Getopt</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.controller.html"><code>Zend_Controller</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.session.php"><code>session</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.controller.actionhelpers.html"><code>Zend_Controller_Action_Helper_Redirector</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.date.html"><code>Zend_Date</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ibm-db2.php"><code>ibm_db2</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Db2</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.mysqli.php"><code>mysqli</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Mysqli</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.oci8.php"><code>oci8</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Oracle</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.pdo.php"><code>pdo</code></ulink>
                            ( All PDO Adapters / Dependency )
                            <code>pdo_mssql</code>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Mssql</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.pdo-mysql.php"><code>pdo_mysql</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Mysql</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.pdo-oci.php"><code>pdo_oci</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Oci</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.pdo-pgsql.php"><code>pdo_pgsql</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Pgsql</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.pdo-sqlite.php"><code>pdo_sqlite</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.db.html"><code>Zend_Db_Adapter_Pdo_Sqlite</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.debug.html"><code>Zend_Debug</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.exception.html"><code>Zend_Exception</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.feed.html"><code>Zend_Feed</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.mbstring.php"><code>mbstring</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.simplexml.php"><code>SimpleXML</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.filter.html"><code>Zend_Filter</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.filter.input.html"><code>Zend_Filter_Input</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.gdata.html"><code>Zend_Gdata</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.gdata.html"><code>Zend_Gdata_App</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.http.html"><code>Zend_Http</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.http.html"><code>Zend_Http_Client</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.curl.php"><code>curl</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.http.client.adapters.html"><code>Zend_Http_Client_Adapter_Curl</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.mime-magic.php"><code>mime_magic</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.http.html"><code>Zend_Http_Client</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.json.html"><code>Zend_Json</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.json.php"><code>json</code></ulink>
                            ( Optional )
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.loader.html"><code>Zend_Loader</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.locale.html"><code>Zend_Locale</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.bc.php"><code>bcmath</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.locale.html"><code>Zend_Locale_Math</code></ulink> / Optional )
                            <ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.locale.parsing.html"><code>Zend_Locale_Format</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.log.html"><code>Zend_Log</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.log.formatters.html"><code>Zend_Log_Formatter_Xml</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.log.formatters.html"><code>Zend_Log_Formatter_Xml</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.mail.html"><code>Zend_Mail</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.posix.php"><code>posix</code></ulink>
                            ( Optional )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.measure.html"><code>Zend_Measure</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.memory.html"><code>Zend_Memory</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.mime.html"><code>Zend_Mime</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.mime.html"><code>Zend_Mime_Decode</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.pdf.html"><code>Zend_Pdf</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.image.php"><code>gd</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.zlib.php"><code>zlib</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.registry.html"><code>Zend_Registry</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry>Zend_Request</entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.rest.html"><code>Zend_Rest</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.rest.client.html"><code>Zend_Rest_Client</code></ulink> / Dependency )
                            ( <ulink url="http://framework.zend.com/manual/en/zend.rest.server.html"><code>Zend_Rest_Server</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.rest.server.html"><code>Zend_Rest_Server</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.rest.client.html"><code>Zend_Rest_Client</code></ulink> / Dependency )
                            ( <ulink url="http://framework.zend.com/manual/en/zend.rest.server.html"><code>Zend_Rest_Server</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.rest.server.html"><code>Zend_Rest_Server</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.simplexml.php"><code>SimpleXML</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.rest.client.html"><code>Zend_Rest_Client</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.search.lucene.html"><code>Zend_Search_Lucene</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( Dependency )
                            <ulink url="http://pecl.php.net/package/Bitset"><code>bitset</code></ulink>
                            ( Optional )
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.server.reflection.html"><code>Zend_Server_Reflection</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.akismet.html"><code>Zend_Service_Akismet</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.amazon.html"><code>Zend_Service_Amazon</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.audioscrobbler.html"><code>Zend_Service_Audioscrobbler</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.simplexml.php"><code>SimpleXML</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.delicious.html"><code>Zend_Service_Delicious</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.flickr.html"><code>Zend_Service_Flickr</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.simpy.html"><code>Zend_Service_Simpy</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.strikeiron.html"><code>Zend_Service_StrikeIron</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.soap.php"><code>soap</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.service.yahoo.html"><code>Zend_Service_Yahoo</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.session.html"><code>Zend_Session</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.session.php"><code>session</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.translate.html"><code>Zend_Translate</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.xml.php"><code>xml</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.translate.adapter.html"><code>Zend_Translate_Adapter_Qt</code></ulink> / Dependency )
                            ( <ulink url="http://framework.zend.com/manual/en/zend.translate.adapter.html"><code>Zend_Translate_Adapter_Tmx</code></ulink> / Dependency )
                            ( <ulink url="http://framework.zend.com/manual/en/zend.translate.adapter.html"><code>Zend_Translate_Adapter_Xliff</code></ulink> / Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.uri.html"><code>Zend_Uri</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.validate.html"><code>Zend_Validate</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.ctype.php"><code>ctype</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.version.html"><code>Zend_Version</code></ulink></entry>
                        <entry>---</entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.view.html"><code>Zend_View</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                    <row>
                        <entry><ulink url="http://framework.zend.com/manual/en/zend.xmlrpc.html"><code>Zend_XmlRpc</code></ulink></entry>
                        <entry>
                            <ulink url="http://www.php.net/manual/en/ref.dom.php"><code>dom</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.iconv.php"><code>iconv</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.xmlrpc.client.html"><code>Zend_XmlRpc_Client</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.libxml.php"><code>libxml</code></ulink>
                            ( Dependency )
                            <ulink url="http://www.php.net/manual/en/language.oop5.reflection.php"><code>Reflection</code></ulink>
                            ( <ulink url="http://framework.zend.com/manual/en/zend.xmlrpc.server.html"><code>Zend_XmlRpc_Server</code></ulink> / Dependency )
                            <ulink url="http://www.php.net/manual/en/ref.simplexml.php"><code>SimpleXML</code></ulink>
                            ( Dependency )
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect1>

</appendix>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.acl.advanced">

    <title>Advanced Use</title>

    <sect2 id="zend.acl.advanced.storing">

        <title>Storing ACL Data for Persistence</title>

        <para>
        Zend_Acl was designed in such a way that it does not require any particular backend technology such
        as a database or cache server for storage of the ACL data. Its complete PHP implementation enables
        customized administration tools to be built upon Zend_Acl with relative ease and flexibility. Many
        situations require some form of interactive maintenance of the ACL, and Zend_Acl provides methods for
        setting up, and querying against, the access controls of an application.
        </para>

        <para>
        Storage of ACL data is therefore left as a task for the developer, since use cases are expected to
        vary widely for various situations. Because Zend_Acl is serializable, ACL objects may be serialized
        with PHP's <ulink url="http://php.net/serialize"><code>serialize()</code></ulink> function, and the
        results may be stored anywhere the developer should desire, such as a file, database, or caching
        mechanism.
        </para>

    </sect2>

    <sect2 id="zend.acl.advanced.assertions">

        <title>Writing Conditional ACL Rules with Assertions</title>

        <para>
        Sometimes a rule for allowing or denying a Role access to a Resource should not be absolute but dependent
        upon various criteria. For example, suppose that certain access should be allowed, but only between the
        hours of 8:00am and 5:00pm. Another example would be denying access because a request comes from an
        IP address that has been flagged as a source of abuse. Zend_Acl has built-in support for implementing
        rules based on whatever conditions the developer needs.
        </para>

        <para>
        Zend_Acl provides support for conditional rules with <code>Zend_Acl_Assert_Interface</code>. In order
        to use the rule assertion interface, a developer writes a class that implements the
        <code>assert()</code> method of the interface:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Acl/Assert/Interface.php';

class CleanIPAssertion implements Zend_Acl_Assert_Interface
{
    public function assert(Zend_Acl $acl, Zend_Acl_Role_Interface $role = null,
                           Zend_Acl_Resource_Interface $resource = null, $privilege = null)
    {
        return $this->_isCleanIP($_SERVER['REMOTE_ADDR']);
    }

    protected function _isCleanIP($ip)
    {
        // ...
    }
}]]>
        </programlisting>

        <para>
        Once an assertion class is available, the developer must supply an instance of the assertion class
        when assigning conditional rules. A rule that is created with an assertion only applies when the
        assertion method returns true.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Acl.php';

$acl = new Zend_Acl();
$acl->allow(null, null, null, new CleanIPAssertion());]]>
        </programlisting>

        <para>
        The above code creates a conditional allow rule that allows access to all privileges on everything
        by everyone, except when the requesting IP is "blacklisted." If a request comes in from an IP that
        is not considered "clean," then the allow rule does not apply. Since the rule applies to all Roles,
        all Resources, and all privileges, an "unclean" IP would result in a denial of access. This is a special
        case, however, and it should be understood that in all other cases (i.e., where a specific Role,
        Resource, or privilege is specified for the rule), a failed assertion results in the rule not applying,
        and other rules would be used to determine whether access is allowed or denied.
        </para>

        <para>
        The <code>assert()</code> method of an assertion object is passed the ACL, Role, Resource, and privilege
        to which the authorization query (i.e., <code>isAllowed()</code>) applies, in order to provide
        a context for the assertion class to determine its conditions where needed.
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.acl.refining">

    <title>Refining Access Controls</title>

    <sect2 id="zend.acl.refining.precise">

        <title>Precise Access Controls</title>

        <para>
        The basic ACL as defined in the <link linkend="zend.acl.introduction">previous section</link> shows
        how various privileges may be allowed upon the entire ACL (all Resources). In practice, however, access
        controls tend to have exceptions and varying degrees of complexity. Zend_Acl allows to you accomplish
        these refinements in a straightforward and flexible manner.
        </para>

        <para>
        For the example CMS, it has been determined that whilst the 'staff' group covers the needs of the
        vast majority of users, there is a need for a new 'marketing' group that requires access to the
        newsletter and latest news in the CMS. The group is fairly self-sufficient and will have the ability
        to publish and archive both newsletters and the latest news.
        </para>

        <para>
        In addition, it has also been requested that the 'staff' group be allowed to view news stories but
        not to revise the latest news. Finally, it should be impossible for anyone (administrators included)
        to archive any 'announcement' news stories since they only have a lifespan of 1-2 days.
        </para>

        <para>
        First we revise the Role registry to reflect these changes. We have determined that the 'marketing'
        group has the same basic permissions as 'staff', so we define 'marketing' in such a way that it
        inherits permissions from 'staff':
        </para>

        <programlisting role="php"><![CDATA[<?php
// The new marketing group inherits permissions from staff
$acl->addRole(new Zend_Acl_Role('marketing'), 'staff');]]>
        </programlisting>

        <para>
        Next, note that the above access controls refer to specific Resources (e.g., "newsletter", "latest news", "announcement news"). Now we add these Resources:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Create Resources for the rules
require_once 'Zend/Acl/Resource.php';
$acl->add(new Zend_Acl_Resource('newsletter'));           // newsletter
$acl->add(new Zend_Acl_Resource('news'));                 // news
$acl->add(new Zend_Acl_Resource('latest'), 'news');       // latest news
$acl->add(new Zend_Acl_Resource('announcement'), 'news'); // announcement news]]>
        </programlisting>

        <para>
        Then it is simply a matter of defining these more specific rules on the target areas of the ACL:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Marketing must be able to publish and archive newsletters and the latest news
$acl->allow('marketing', array('newsletter', 'latest'), array('publish', 'archive'));

// Staff (and marketing, by inheritance), are denied permission to revise the latest news
$acl->deny('staff', 'latest', 'revise');

// Everyone (including administrators) are denied permission to archive news announcements
$acl->deny(null, 'announcement', 'archive');]]>
        </programlisting>

        <para>
        We can now query the ACL with respect to the latest changes:
        </para>

        <programlisting role="php"><![CDATA[<?php
echo $acl->isAllowed('staff', 'newsletter', 'publish') ?
     "allowed" : "denied"; // denied

echo $acl->isAllowed('marketing', 'newsletter', 'publish') ?
     "allowed" : "denied"; // allowed

echo $acl->isAllowed('staff', 'latest', 'publish') ?
     "allowed" : "denied"; // denied

echo $acl->isAllowed('marketing', 'latest', 'publish') ?
     "allowed" : "denied"; // allowed

echo $acl->isAllowed('marketing', 'latest', 'archive') ?
     "allowed" : "denied"; // allowed

echo $acl->isAllowed('marketing', 'latest', 'revise') ?
     "allowed" : "denied"; // denied

echo $acl->isAllowed('editor', 'announcement', 'archive') ?
     "allowed" : "denied"; // denied

echo $acl->isAllowed('administrator', 'announcement', 'archive') ?
     "allowed" : "denied"; // denied]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.acl.refining.removing">

        <title>Removing Access Controls</title>

        <para>
        To remove one or more access rules from the ACL, simply use the available <code>removeAllow()</code>
        or <code>removeDeny()</code> methods. As with <code>allow()</code> and <code>deny()</code>, you may
        provide a <code>null</code> value to indicate application to all Roles, Resources, and/or privileges:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Remove the denial of revising latest news to staff (and marketing, by inheritance)
$acl->removeDeny('staff', 'latest', 'revise');

echo $acl->isAllowed('marketing', 'latest', 'revise') ?
     "allowed" : "denied"; // allowed

// Remove the allowance of publishing and archiving newsletters to marketing
$acl->removeAllow('marketing', 'newsletter', array('publish', 'archive'));

echo $acl->isAllowed('marketing', 'newsletter', 'publish') ?
     "allowed" : "denied"; // denied

echo $acl->isAllowed('marketing', 'newsletter', 'archive') ?
     "allowed" : "denied"; // denied]]>
        </programlisting>

        <para>
        Privileges may be modified incrementally as indicated above, but a <code>null</code> value for the
        privileges overrides such incremental changes:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Allow marketing all permissions upon the latest news
$acl->allow('marketing', 'latest');

echo $acl->isAllowed('marketing', 'latest', 'publish') ?
     "allowed" : "denied"; // allowed

echo $acl->isAllowed('marketing', 'latest', 'archive') ?
     "allowed" : "denied"; // allowed

echo $acl->isAllowed('marketing', 'latest', 'anything') ?
     "allowed" : "denied"; // allowed]]>
        </programlisting>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.acl.introduction">
    <title>Introduction</title>

    <para>
        Zend_Acl provides lightweight and flexible access control list (ACL) functionality
        and privileges management. In general, an application may utilize such functionality
        to control access to certain protected objects by other requesting objects.
    </para>

    <para>
        For the purposes of this documentation,

        <itemizedlist>
            <listitem>
                <para>
                    a <emphasis role="strong">Resource</emphasis> is an object
                    to which access is controlled.
                </para>
            </listitem>
            <listitem>
                <para>
                    a <emphasis role="strong">Role</emphasis> is an object
                    that may request access to a Resource.
                </para>
            </listitem>
        </itemizedlist>

        Put simply, <emphasis role="strong">Roles request access to Resources</emphasis>.
        For example, if a person requests access to a car, then the person is the requesting Role,
        and the car is the Resource, since access to the car is under control.
    </para>

    <para>
        Through the specification and use of an access control list (ACL), an application may control
        how requesting objects (Roles) are granted access to protected objects (Resources).
    </para>

    <sect2 id="zend.acl.introduction.resources">
        <title>About Resources</title>
        <para>
            In Zend_Acl, creating a Resource is very simple. Zend_Acl provides
            <code>Zend_Acl_Resource_Interface</code> to facilitate developers' creating Resources. A class need only
            implement this interface, which consists of a single method, <code>getResourceId()</code>, in order
            for Zend_Acl to consider the object to be a Resource. Additionally, <code>Zend_Acl_Resource</code> is
            included with Zend_Acl as a basic Resource implementation for developers to extend where desirable.
        </para>
        <para>
            Zend_Acl provides a tree structure to which multiple Resources (or "areas under access control")
            can be added. Since Resources are stored in such a tree structure, they can be organized from the
            general (toward the tree root) to the specific (toward the tree leaves). Queries upon
            a specific Resource will automatically search the Resource's hierarchy for rules assigned to ancestor
            Resources, allowing for simple inheritance of rules. For example, if a default rule is to be
            applied to each building in a city, one would simply assign the rule to the city, instead of
            assigning the same rule to each building. Some buildings may require exceptions to such a
            rule, however, and this is achieved easily in Zend_Acl by assigning such exception rules to
            each such building that requires an exception to the rule. A Resource may inherit from only one
            parent Resource, though this parent Resource can have its own parent Resource, and so on.
        </para>
        <para>
            Zend_Acl also supports privileges upon Resources (e.g., "create", "read", "update", "delete"), and
            the developer can assign rules that affect all privileges or specific privileges upon a Resource.
        </para>
    </sect2>

    <sect2 id="zend.acl.introduction.roles">
        <title>About Roles</title>
        <para>
            Like with Resources, creating a Role is also very simple. Zend_Acl provides
            <code>Zend_Acl_Role_Interface</code> to facilitate developers' creating Roles. A class need only
            implement this interface, which consists of a single method, <code>getRoleId()</code>, in order
            for Zend_Acl to consider the object to be a Role. Additionally, <code>Zend_Acl_Role</code> is
            included with Zend_Acl as a basic Role implementation for developers to extend where desirable.
        </para>
        <para>
            In Zend_Acl, a Role may inherit from one or more Roles. This is to support inheritance of rules
            among Roles. For example, a user Role, such as "sally", may belong to one or more parent Roles,
            such as "editor" and "administrator". The developer can assign rules to "editor" and
            "administrator" separately, and "sally" would inherit such rules from both, without having to
            assign rules directly to "sally".
        </para>
        <para>
            Though the ability to inherit from multiple Roles is very useful, multiple inheritance also
            introduces some degree of complexity. The following example illustrates the ambiguity condition and how
            Zend_Acl solves it.
        </para>
        <example id="zend.acl.introduction.roles.example.multiple_inheritance">
            <title>Multiple inheritance between Roles</title>
            <para>
                The following code defines three base Roles - "<code>guest</code>", "<code>member</code>", and
                "<code>admin</code>" - from which other Roles may inherit. Then, a Role identified by
                "<code>someUser</code>" is established and inherits from the three other Roles. The order in
                which these Roles appear in the <code>$parents</code> array is important. When necessary,
                Zend_Acl searches for access rules defined not only for the queried Role (herein,
                "<code>someUser</code>"), but also upon the Roles from which the queried Role inherits
                (herein, "<code>guest</code>", "<code>member</code>", and "<code>admin</code>"):
            </para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Acl.php';
$acl = new Zend_Acl();

require_once 'Zend/Acl/Role.php';
$acl->addRole(new Zend_Acl_Role('guest'))
    ->addRole(new Zend_Acl_Role('member'))
    ->addRole(new Zend_Acl_Role('admin'));

$parents = array('guest', 'member', 'admin');
$acl->addRole(new Zend_Acl_Role('someUser'), $parents);

require_once 'Zend/Acl/Resource.php';
$acl->add(new Zend_Acl_Resource('someResource'));

$acl->deny('guest', 'someResource');
$acl->allow('member', 'someResource');

echo $acl->isAllowed('someUser', 'someResource') ? 'allowed' : 'denied';]]>
            </programlisting>
            <para>
                Since there is no rule specifically defined for the "<code>someUser</code>" Role and
                "<code>someResource</code>", Zend_Acl must search for rules that may be defined for Roles that
                "<code>someUser</code>" inherits. First, the "<code>admin</code>" role is visited, and there
                is no access rule defined for it. Next, the "<code>member</code>" role is visited, and
                Zend_Acl finds that there is a rule specifying that "<code>member</code>" is allowed access to
                "<code>someResource</code>".
            </para>
            <para>
                If Zend_Acl were to continue examining the rules defined for other parent Roles, however, it
                would find that "<code>guest</code>" is denied access to "<code>someResource</code>". This
                fact introduces an ambiguity because now "<code>someUser</code>" is both denied and allowed
                access to "<code>someResource</code>", by reason of having inherited conflicting rules from
                different parent Roles.
            </para>
            <para>
                Zend_Acl resolves this ambiguity by completing a query when it finds the first rule that is
                directly applicable to the query. In this case, since the "<code>member</code>" Role is
                examined before the "<code>guest</code>" Role, the example code would print
                "<code>allowed</code>".
            </para>
        </example>
        <note>
            <para>
                When specifying multiple parents for a Role, keep in mind that the last parent listed is the
                first one searched for rules applicable to an authorization query.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.acl.introduction.creating">
        <title>Creating the Access Control List (ACL)</title>

        <para>
            An ACL can represent any set of physical or virtual objects that you wish.
            For the purposes of demonstration, however, we will create a basic Content Management System ACL
            that maintains several tiers of groups over a wide variety of areas. To create a new ACL object,
            we instantiate the ACL with no parameters:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Acl.php';

$acl = new Zend_Acl();]]>
        </programlisting>

        <note>
            <para>
                Until a developer specifies an "allow" rule, Zend_Acl denies access to every privilege upon every
                Resource by every Role.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.acl.introduction.role_registry">
        <title>Registering Roles</title>

        <para>
            Content Management Systems will nearly always require a hierarchy of permissions
            to determine the authoring capabilities of its users. There may be a 'Guest' group to
            allow limited access for demonstrations, a 'Staff' group for the majority of CMS users
            who perform most of the day-to-day operations, an 'Editor' group for those responsible for publishing,
            reviewing, archiving and deleting content, and finally an 'Administrator' group whose tasks may
            include all of those of the other groups as well as maintenance of sensitive information,
            user management, back-end configuration data and backup/export. This set of permissions can be
            represented in a Role registry, allowing each group to inherit privileges from 'parent' groups,
            as well as providing distinct privileges for their unique group only.
            The permissions may be expressed as follows:
        </para>

        <table id="zend.acl.introduction.role_registry.table.example_cms_access_controls">
          <title>Access Controls for an Example CMS</title>
          <tgroup cols="3">
            <thead>
              <row>
                <entry>Name</entry>
                <entry>Unique permissions</entry>
                <entry>Inherit permissions from</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Guest</entry>
                <entry>View</entry>
                <entry>N/A</entry>
              </row>
              <row>
                <entry>Staff</entry>
                <entry>Edit, Submit, Revise</entry>
                <entry>Guest</entry>
              </row>
              <row>
                <entry>Editor</entry>
                <entry>Publish, Archive, Delete</entry>
                <entry>Staff</entry>
              </row>
              <row>
                <entry>Administrator</entry>
                <entry>(Granted all access)</entry>
                <entry>N/A</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>
            For this example, <code>Zend_Acl_Role</code> is used, but any object that implements
            <code>Zend_Acl_Role_Interface</code> is acceptable. These groups can be added to the
            Role registry as follows:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Acl.php';

$acl = new Zend_Acl();

// Add groups to the Role registry using Zend_Acl_Role
require_once 'Zend/Acl/Role.php';

// Guest does not inherit access controls
$roleGuest = new Zend_Acl_Role('guest');
$acl->addRole($roleGuest);

// Staff inherits from guest
$acl->addRole(new Zend_Acl_Role('staff'), $roleGuest);

/* alternatively, the above could be written:
$acl->addRole(new Zend_Acl_Role('staff'), 'guest');
//*/

// Editor inherits from staff
$acl->addRole(new Zend_Acl_Role('editor'), 'staff');

// Administrator does not inherit access controls
$acl->addRole(new Zend_Acl_Role('administrator'));]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.acl.introduction.defining">
        <title>Defining Access Controls</title>

        <para>
            Now that the ACL contains the relevant Roles, rules can be established that define how
            Resources may be accessed by Roles. You may have noticed that we have not defined any particular
            Resources for this example, which is simplified to illustrate that the rules apply to all Resources.
            Zend_Acl provides an implementation whereby rules need only be assigned from general to specific,
            minimizing the number of rules needed, because Resources and Roles inherit rules that are defined upon
            their ancestors.
        </para>

        <note>
            <para>
                In general, Zend_Acl obeys a given rule if and only if a more specific rule does not apply.
            </para>
        </note>

        <para>
            Consequently, we can define a reasonably complex set of rules with a minimum amount of code.
            To apply the base permissions as defined above:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Acl.php';

$acl = new Zend_Acl();

require_once 'Zend/Acl/Role.php';

$roleGuest = new Zend_Acl_Role('guest');
$acl->addRole($roleGuest);
$acl->addRole(new Zend_Acl_Role('staff'), $roleGuest);
$acl->addRole(new Zend_Acl_Role('editor'), 'staff');
$acl->addRole(new Zend_Acl_Role('administrator'));

// Guest may only view content
$acl->allow($roleGuest, null, 'view');

/* alternatively, the above could be written:
$acl->allow('guest', null, 'view');
//*/

// Staff inherits view privilege from guest, but also needs additional privileges
$acl->allow('staff', null, array('edit', 'submit', 'revise'));

// Editor inherits view, edit, submit, and revise privileges from staff,
// but also needs additional privileges
$acl->allow('editor', null, array('publish', 'archive', 'delete'));

// Administrator inherits nothing, but is allowed all privileges
$acl->allow('administrator');]]>
        </programlisting>

        <para>
            The <code>null</code> values in the above <code>allow()</code> calls are used to indicate
            that the allow rules apply to all Resources.
        </para>

    </sect2>

    <sect2 id="zend.acl.introduction.querying">
        <title>Querying the ACL</title>

        <para>
            We now have a flexible ACL that can be used to determine whether requesters have permission
            to perform functions throughout the web application. Performing queries is quite simple using
            the <code>isAllowed()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
echo $acl->isAllowed('guest', null, 'view') ?
     "allowed" : "denied"; // allowed

echo $acl->isAllowed('staff', null, 'publish') ?
     "allowed" : "denied"; // denied

echo $acl->isAllowed('staff', null, 'revise') ?
     "allowed" : "denied"; // allowed

echo $acl->isAllowed('editor', null, 'view') ?
     "allowed" : "denied"; // allowed because of inheritance from guest

echo $acl->isAllowed('editor', null, 'update') ?
     "allowed" : "denied"; // denied because no allow rule for 'update'

echo $acl->isAllowed('administrator', null, 'view') ?
     "allowed" : "denied"; // allowed because administrator is allowed all privileges

echo $acl->isAllowed('administrator') ?
     "allowed" : "denied"; // allowed because administrator is allowed all privileges

echo $acl->isAllowed('administrator', null, 'update') ?
     "allowed" : "denied"; // allowed because administrator is allowed all privileges]]>
        </programlisting>

    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.auth.introduction">

    <title>Introduction</title>

    <para>
        Zend_Auth provides an API for authentication and includes concrete authentication adapters for
        common use case scenarios.
    </para>

    <para>
        Zend_Auth is concerned only with <emphasis role="strong">authentication</emphasis> and not with
        <emphasis role="strong">authorization</emphasis>. Authentication is loosely defined as determining
        whether an entity actually is what it purports to be (i.e., identification), based on some set of
        credentials. Authorization, the process of deciding whether to allow an entity access to, or to
        perform operations upon, other entities is outside the scope of Zend_Auth. For more information about
        authorization and access control with the Zend Framework, please see
        <link linkend="zend.acl">Zend_Acl</link>.
    </para>

    <note>
        <para>
            The <code>Zend_Auth</code> class implements the Singleton pattern - only one instance of the class is
            available - through its static <code>getInstance()</code> method. This means that using the <code>new</code>
            operator and the <code>clone</code> keyword will not work with the <code>Zend_Auth</code> class; use
            <code>Zend_Auth::getInstance()</code> instead.
        </para>
    </note>

    <sect2 id="zend.auth.introduction.adapters">

        <title>Adapters</title>

        <para>
            A Zend_Auth adapter is used to authenticate against a particular type of authentication service,
            such as LDAP, RDBMS, or file-based storage. Different adapters are likely to have vastly different
            options and behaviors, but some basic things are common among authentication adapters. For example,
            accepting authentication credentials (including a purported identity), performing queries against the
            authentication service, and returning results are common to Zend_Auth adapters.
        </para>

        <para>
            Each Zend_Auth adapter class implements <code>Zend_Auth_Adapter_Interface</code>. This interface defines one
            method, <code>authenticate()</code>, that an adapter class must implement for performing an authentication
            query. Each adapter class must be prepared prior to calling <code>authenticate()</code>. Such adapter
            preparation includes setting up credentials (e.g., username and password) and defining values for adapter-
            specific configuration options, such as database connection settings for a database table adapter.
        </para>

        <para>
            The following is an example authentication adapter that requires a username and password to be set
            for authentication. Other details, such as how the authentication service is queried, have been
            omitted for brevity:

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Auth/Adapter/Interface.php';

class MyAuthAdapter implements Zend_Auth_Adapter_Interface
{
    /**
     * Sets username and password for authentication
     *
     * @return void
     */
    public function __construct($username, $password)
    {
        // ...
    }

    /**
     * Performs an authentication attempt
     *
     * @throws Zend_Auth_Adapter_Exception If authentication cannot be performed
     * @return Zend_Auth_Result
     */
    public function authenticate()
    {
        // ...
    }
}]]>
            </programlisting>

            As indicated in its docblock, <code>authenticate()</code> must return an instance of
            <code>Zend_Auth_Result</code> (or of a class derived from <code>Zend_Auth_Result</code>). If for some
            reason performing an authentication query is impossible, <code>authenticate()</code> should throw
            an exception that derives from <code>Zend_Auth_Adapter_Exception</code>.
        </para>

    </sect2>

    <sect2 id="zend.auth.introduction.results">

        <title>Results</title>

        <para>
            Zend_Auth adapters return an instance of <code>Zend_Auth_Result</code> with
            <code>authenticate()</code> in order to represent the results of an authentication attempt. Adapters
            populate the <code>Zend_Auth_Result</code> object upon construction, so that the following four methods
            provide a basic set of user-facing operations that are common to the results of Zend_Auth adapters:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>isValid()</code> - returns true if and only if the result represents a
                        successful authentication attempt
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>getCode()</code> - returns a <code>Zend_Auth_Result</code> constant identifier for
                        determining the type of authentication failure or whether success has occurred. This may be
                        used in situations where the developer wishes to distinguish among several authentication
                        result types. This allows developers to maintain detailed authentication result statistics,
                        for example. Another use of this feature is to provide specific, customized messages to
                        users for usability reasons, though developers are encouraged to consider the risks of
                        providing such detailed reasons to users, instead of a general authentication failure
                        message. For more information, see the notes below.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>getIdentity()</code> - returns the identity of the authentication attempt
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>getMessages()</code> - returns an array of messages regarding a failed
                        authentication attempt
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            A developer may wish to branch based on the type of authentication result in order to perform more
            specific operations. Some operations developers might find useful are locking accounts after too many
            unsuccessful password attempts, flagging an IP address after too many nonexistent identities are
            attempted, and providing specific, customized authentication result messages to the user. The following
            result codes are available:

            <programlisting role="php"><![CDATA[Zend_Auth_Result::SUCCESS
Zend_Auth_Result::FAILURE
Zend_Auth_Result::FAILURE_IDENTITY_NOT_FOUND
Zend_Auth_Result::FAILURE_IDENTITY_AMBIGUOUS
Zend_Auth_Result::FAILURE_CREDENTIAL_INVALID
Zend_Auth_Result::FAILURE_UNCATEGORIZED]]>
            </programlisting>

        </para>

        <para>
            The following example illustrates how a developer may branch on the result code:

            <programlisting role="php"><![CDATA[<?php
// inside of AuthController / loginAction
$result = $this->_auth->authenticate($adapter);

switch ($result->getCode()) {

    case Zend_Auth_Result::FAILURE_IDENTITY_NOT_FOUND:
        /** do stuff for nonexistent identity **/
        break;

    case Zend_Auth_Result::FAILURE_CREDENTIAL_INVALID:
        /** do stuff for invalid credential **/
        break;

    case Zend_Auth_Result::SUCCESS:
        /** do stuff for successful authentication **/
        break;

    default:
        /** do stuff for other failure **/
        break;
}]]>
            </programlisting>

        </para>

    </sect2>

    <sect2 id="zend.auth.introduction.persistence">

        <title>Identity Persistence</title>

        <para>
            Authenticating a request that includes authentication credentials is useful per se, but it is also
            important to support maintaining the authenticated identity without having to present the
            authentication credentials with each request.
        </para>

        <para>
            HTTP is a stateless protocol, however, and techniques such as cookies and sessions have been
            developed in order to facilitate maintaining state across multiple requests in server-side web
            applications.
        </para>

        <sect3 id="zend.auth.introduction.persistence.default">

            <title>Default Persistence in the PHP Session</title>

            <para>
                 By default, <code>Zend_Auth</code> provides persistent storage of the identity from a successful
                 authentication attempt using the PHP session. Upon a successful authentication attempt,
                 <code>Zend_Auth::authenticate()</code> stores the identity from the authentication result into
                 persistent storage. Unless configured otherwise, <code>Zend_Auth</code> uses a storage class named
                 <code>Zend_Auth_Storage_Session</code>, which, in turn, uses
                 <link linkend="zend.session">Zend_Session</link>. A custom class may instead be used by providing an
                 object that implements <code>Zend_Auth_Storage_Interface</code> to
                 <code>Zend_Auth::setStorage()</code>.
            </para>

            <note>
                <para>
                    If automatic persistent storage of the identity is not appropriate for a particular use case, then
                    developers may forgo using the <code>Zend_Auth</code> class altogether, instead using an adapter
                    class directly.
                </para>
            </note>

            <example id="zend.auth.introduction.persistence.default.example">

                <title>Modifying the Session Namespace</title>

                <para>
                    <code>Zend_Auth_Storage_Session</code> uses a session namespace of <code>'Zend_Auth'</code>. This
                    namespace may be overridden by passing a different value to the constructor of
                    <code>Zend_Auth_Storage_Session</code>, and this value is internally passed along to the constructor
                    of <code>Zend_Session_Namespace</code>. This should occur before authentication is attempted, since
                    <code>Zend_Auth::authenticate()</code> performs the automatic storage of the identity.

                    <programlisting role="php"><![CDATA[<?php
// Save a reference to the Singleton instance of Zend_Auth
require_once 'Zend/Auth.php';
$auth = Zend_Auth::getInstance();

// Use 'someNamespace' instead of 'Zend_Auth'
require_once 'Zend/Auth/Storage/Session.php';
$auth->setStorage(new Zend_Auth_Storage_Session('someNamespace'));

/**
 * @todo Set up the auth adapter, $authAdapter
 */

// Authenticate, saving the result, and persisting the identity upon success
$result = $auth->authenticate($authAdapter);]]>
                    </programlisting>

                </para>

            </example>

        </sect3>

        <sect3 id="zend.auth.introduction.persistence.custom">

            <title>Implementing Customized Storage</title>

            <para>
                Sometimes developers may need to use different identity persistence behavior than that provided by
                <code>Zend_Auth_Storage_Session</code>. For such cases developers may simply implement
                <code>Zend_Auth_Storage_Interface</code> and supply an instance of the class to
                <code>Zend_Auth::setStorage()</code>.
            </para>

            <example id="zend.auth.introduction.persistence.custom.example">

                <title>Using a Custom Storage Class</title>

                <para>
                    In order to use an identity persistence storage class other than
                    <code>Zend_Auth_Storage_Session</code>, a developer implements
                    <code>Zend_Auth_Storage_Interface</code>:

                    <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Auth/Storage/Interface.php';

class MyStorage implements Zend_Auth_Storage_Interface
{
    /**
     * Returns true if and only if storage is empty
     *
     * @throws Zend_Auth_Storage_Exception If it is impossible to determine whether storage is empty
     * @return boolean
     */
    public function isEmpty()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Returns the contents of storage
     *
     * Behavior is undefined when storage is empty.
     *
     * @throws Zend_Auth_Storage_Exception If reading contents from storage is impossible
     * @return mixed
     */
    public function read()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Writes $contents to storage
     *
     * @param  mixed $contents
     * @throws Zend_Auth_Storage_Exception If writing $contents to storage is impossible
     * @return void
     */
    public function write($contents)
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Clears contents from storage
     *
     * @throws Zend_Auth_Storage_Exception If clearing contents from storage is impossible
     * @return void
     */
    public function clear()
    {
        /**
         * @todo implementation
         */
    }

}]]>
                    </programlisting>

                </para>

                <para>
                    In order to use this custom storage class, <code>Zend_Auth::setStorage()</code> is invoked before an
                    authentication query is attempted:

                    <programlisting role="php"><![CDATA[<?php
// Instruct Zend_Auth to use the custom storage class
Zend_Auth::getInstance()->setStorage(new MyStorage());

/**
 * @todo Set up the auth adapter, $authAdapter
 */

// Authenticate, saving the result, and persisting the identity upon success
$result = Zend_Auth::getInstance()->authenticate($authAdapter);]]>
                    </programlisting>

                </para>

            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.auth.introduction.using">

        <title>Using Zend_Auth</title>

        <para>
            There are two provided ways to use Zend_Auth adapters:
            <orderedlist>
            <listitem>
                <para>
                    indirectly, through <code>Zend_Auth::authenticate()</code>
                </para>
            </listitem>
            <listitem>
                <para>
                    directly, through the adapter's <code>authenticate()</code> method
                </para>
            </listitem>
            </orderedlist>
        </para>

        <para>
            The following example illustrates how to use a Zend_Auth adapter indirectly, through the use of
            the <code>Zend_Auth</code> class:

            <programlisting role="php"><![CDATA[<?php
// Get a reference to the Singleton instance of Zend_Auth
require_once 'Zend/Auth.php';
$auth = Zend_Auth::getInstance();

// Set up the authentication adapter
$authAdapter = new MyAuthAdapter($username, $password);

// Attempt authentication, saving the result
$result = $auth->authenticate($authAdapter);

if (!$result->isValid()) {
    // Authentication failed; print the reasons why
    foreach ($result->getMessages() as $message) {
        echo "$message\n";
    }
} else {
    // Authentication succeeded; the identity ($username) is stored in the session
    // $result->getIdentity() === $auth->getIdentity()
    // $result->getIdentity() === $username
}]]>
            </programlisting>
        </para>

        <para>
            Once authentication has been attempted in a request, as in the above example, it is a simple
            matter to check whether a successfully authenticated identity exists:
            <programlisting role="php"><![CDATA[<?php
$auth = Zend_Auth::getInstance();
if ($auth->hasIdentity()) {
    // Identity exists; get it
    $identity = $auth->getIdentity();
}]]>
            </programlisting>
        </para>

        <para>
            To remove an identity from persistent storage, simply use the <code>clearIdentity()</code> method.
            This typically would be used for implementing an application "logout" operation:
            <programlisting role="php"><![CDATA[<?php
Zend_Auth::getInstance()->clearIdentity();]]>
            </programlisting>
        </para>

        <para>
            When the automatic use of persistent storage is inappropriate for a particular use case, a
            developer may simply bypass the use of the <code>Zend_Auth</code> class, using an adapter class
            directly. Direct use of an adapter class involves configuring and preparing an adapter object and
            then calling its <code>authenticate()</code> method. Adapter-specific details are discussed in the
            documentation for each adapter. The following example directly utilizes
            <code>MyAuthAdapter</code>:

            <programlisting role="php"><![CDATA[<?php
// Set up the authentication adapter
$authAdapter = new MyAuthAdapter($username, $password);

// Attempt authentication, saving the result
$result = $authAdapter->authenticate();

if (!$result->isValid()) {
    // Authentication failed; print the reasons why
    foreach ($result->getMessages() as $message) {
        echo "$message\n";
    }
} else {
    // Authentication succeeded
    // $result->getIdentity() === $username
}]]>
            </programlisting>
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.auth.adapter.dbtable">

    <title>Database Table Authentication</title>

    <sect2 id="zend.auth.adapter.dbtable.introduction">

        <title>Introduction</title>

        <para>
            <code>Zend_Auth_Adapter_DbTable</code> provides the ability to authenticate against credentials stored in a
            database table. Because <code>Zend_Auth_Adapter_DbTable</code> requires an instance of
            <code>Zend_Db_Adapter_Abstract</code> to be passed to its constructor, each instance is bound to a
            particular database connection. Other configuration options may be set through the constructor and through
            instance methods, one for each option.
        </para>

        <para>
            The available configuration options include:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>tableName</code>: This is the name of the database table that contains the authentication
                        credentials, and against which the database authentication query is performed.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>identityColumn</code>: This is the name of the database table column used to represent the
                        identity. The identity column must contain unique values, such as a username or e-mail address.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>credentialColumn</code>: This is the name of the database table column used to represent
                        the credential. Under a simple identity and password authentication scheme, the credential value
                        corresponds to the password. See also the <code>credentialTreatment</code> option.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>credentialTreatment</code>: In many cases, passwords and other sensitive data are
                        encrypted, hashed, encoded, obscured, or otherwise treated through some function or algorithm.
                        By specifying a parameterized treatment string with this method, such as <code>'MD5(?)'</code>
                        or <code>'PASSWORD(?)'</code>, a developer may apply such arbitrary SQL upon input credential
                        data. Since these functions are specific to the underlying RDBMS, check the database manual for
                        the availability of such functions for your database system.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <example id="zend.auth.adapter.dbtable.introduction.example.basic_usage">

            <title>Basic Usage</title>

            <para>
                As explained in the introduction, the <code>Zend_Auth_Adapter_DbTable</code> constructor requires an
                instance of <code>Zend_Db_Adapter_Abstract</code> that serves as the database connection to which the
                authentication adapter instance is bound. First, the database connection should be created.
            </para>

            <para>
                The following code creates an adapter for an in-memory database, creates a simple table schema, and
                inserts a row against which we can perform an authentication query later. This example requires the PDO
                SQLite extension to be available:

                <programlisting role="php"><![CDATA[<?php
// Create an in-memory SQLite database connection
require_once 'Zend/Db/Adapter/Pdo/Sqlite.php';
$dbAdapter = new Zend_Db_Adapter_Pdo_Sqlite(array('dbname' => ':memory:'));

// Build a simple table creation query
$sqlCreate = 'CREATE TABLE [users] ( '
           . '[id] INTEGER  NOT NULL PRIMARY KEY, '
           . '[username] VARCHAR(50) UNIQUE NOT NULL, '
           . '[password] VARCHAR(32) NULL, '
           . '[real_name] VARCHAR(150) NULL)';

// Create the authentication credentials table
$dbAdapter->query($sqlCreate);

// Build a query to insert a row for which authentication may succeed
$sqlInsert = 'INSERT INTO users (username, password, real_name) '
           . 'VALUES ("my_username", "my_password", "My Real Name")';

// Insert the data
$dbAdapter->query($sqlInsert);]]>
                </programlisting>

            </para>

            <para>
                With the database connection and table data available, an instance of
                <code>Zend_Auth_Adapter_DbTable</code> may be created. Configuration option values may be passed to the
                constructor or deferred as parameters to setter methods after instantiation:

                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Auth/Adapter/DbTable.php';

// Configure the instance with constructor parameters...
$authAdapter = new Zend_Auth_Adapter_DbTable($dbAdapter, 'users', 'username', 'password');

// ...or configure the instance with setter methods
$authAdapter = new Zend_Auth_Adapter_DbTable($dbAdapter);
$authAdapter->setTableName('users')
            ->setIdentityColumn('username')
            ->setCredentialColumn('password');]]>
                </programlisting>

            </para>

            <para>
                At this point, the authentication adapter instance is ready to accept authentication queries. In order
                to formulate an authentication query, the input credential values are passed to the adapter prior to
                calling the <code>authenticate()</code> method:

                <programlisting role="php"><![CDATA[<?php
// Set the input credential values (e.g., from a login form)
$authAdapter->setIdentity('my_username')
            ->setCredential('my_password');

// Perform the authentication query, saving the result
$result = $authAdapter->authenticate();]]>
                </programlisting>

            </para>

            <para>
                In addition to the availability of the <code>getIdentity()</code> method upon the authentication result
                object, <code>Zend_Auth_Adapter_DbTable</code> also supports retrieving the table row upon
                authentication success:

                <programlisting role="php"><![CDATA[<?php
// Print the identity
echo $result->getIdentity() . "\n\n";

// Print the result row
print_r($authAdapter->getResultRowObject());

/* Output:
my_username

Array
(
    [id] => 1
    [username] => my_username
    [password] => my_password
    [real_name] => My Real Name
)
*/]]>
                </programlisting>

                Since the table row contains the credential value, it is important to secure the values against
                unintended access.
            </para>

        </example>

    </sect2>

    <sect2 id="zend.auth.adapter.dbtable.advanced.storing_result_row">

        <title>Advanced Use: Persisting a DbTable Result Object</title>

        <para>
            By default, <code>Zend_Auth_Adapter_DbTable</code> returns the identity supplied back to the auth object
            upon successful authentication. Another use case scenario, where developers want to store to the persistent
            storage mechanism of <code>Zend_Auth</code> an identity object containing other useful information, is
            solved by using the <code>getResultRowObject()</code> method to return a <code>stdClass</code> object. The
            following code snippet illustrates its use:

            <programlisting role="php"><![CDATA[<?php
// authenticate with Zend_Auth_Adapter_DbTable
$result = $this->_auth->authenticate($adapter);

if ($result->isValid()) {

    // store the identity as an object where only the username and real_name have been returned
    $this->_auth->getStorage()->write($adapter->getResultRowObject(array('username', 'real_name')));

    // store the identity as an object where the password column has been omitted
    $this->_auth->getStorage()->write($adapter->getResultRowObject(null, 'password'));

    /* ... */

} else {

    /* ... */

}]]>
            </programlisting>

        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.dbtable.advanced.advanced_usage">
        <title>Advanced Usage By Example</title>

        <para>
            While the primary purpose of Zend_Auth (and consequently Zend_Auth_Adapter_DbTable) is primarily
            <emphasis role="strong">authentication</emphasis> and not <emphasis role="strong">authorization</emphasis>,
            there exist a few instances and problems
            that toe the line upon which domain the fit within.  Depending on how you've decided to explain
            your problem, it sometimes makes sense to solve what could look like an authorization problem
            within the authentication adapter.
        </para>

        <para>
            With that bit of a disclaimer out of the way, Zend_Auth_Adapter_DbTable has some built in
            mechanisms that can be leveraged to add additional checks at authentication time to solve
            some common user problems.

            <programlisting role="php"><![CDATA[<?php
// The status field value of an account is not equal to "compromised"
$adapter = new Zend_Auth_Adapter_DbTable($db, 'users', 'username', 'password', 'MD5(?) AND status != "compromised"');

// The active field value of an account is equal to "TRUE"
$adapter = new Zend_Auth_Adapter_DbTable($db, 'users', 'username', 'password', 'MD5(?) AND active = "TRUE"');

]]>
            </programlisting>

        </para>





    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.auth.adapter.digest">

    <title>Digest Authentication</title>

    <sect2 id="zend.auth.adapter.digest.introduction">

        <title>Introduction</title>

        <para>
            <ulink url="http://en.wikipedia.org/wiki/Digest_access_authentication">Digest authentication</ulink>
            is a method of HTTP authentication that improves upon
            <ulink url="http://en.wikipedia.org/wiki/Basic_authentication_scheme">Basic authentication</ulink>
            by providing a way to authenticate without having to transmit the password in clear text across
            the network.
        </para>

        <para>
            This adapter allows authentication against text files containing lines having the basic elements
            of digest authentication:
            <itemizedlist>
                <listitem>
                    <para>
                        username, such as "<code>joe.user</code>"
                    </para>
                </listitem>
                <listitem>
                    <para>
                        realm, such as "<code>Administrative Area</code>"
                    </para>
                </listitem>
                <listitem>
                    <para>
                        MD5 hash of the username, realm, and password, separated by colons
                    </para>
                </listitem>
            </itemizedlist>
            The above elements are separated by colons, as in the following example (in which the password is
            "<code>somePassword</code>"):
        </para>

        <programlisting><![CDATA[someUser:Some Realm:fde17b91c3a510ecbaf7dbd37f59d4f8]]></programlisting>

    </sect2>

    <sect2 id="zend.auth.adapter.digest.specifics">

        <title>Specifics</title>

        <para>
            The digest authentication adapter, <code>Zend_Auth_Adapter_Digest</code>, requires several input parameters:
            <itemizedlist>
                <listitem>
                    <para>
                        filename - Filename against which authentication queries are performed
                    </para>
                </listitem>
                <listitem>
                    <para>
                        realm - Digest authentication realm
                    </para>
                </listitem>
                <listitem>
                    <para>
                        username - Digest authentication user
                    </para>
                </listitem>
                <listitem>
                    <para>
                        password - Password for the user of the realm
                    </para>
                </listitem>
            </itemizedlist>
            These parameters must be set prior to calling <code>authenticate()</code>.
        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.digest.identity">

        <title>Identity</title>

        <para>
            The digest authentication adapter returns a <code>Zend_Auth_Result</code> object, which has been
            populated with the identity as an array having keys of <code>realm</code> and
            <code>username</code>. The respective array values associated with these keys correspond to the
            values set before <code>authenticate()</code> is called.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Auth/Adapter/Digest.php';

$adapter = new Zend_Auth_Adapter_Digest($filename, $realm, $username, $password);

$result = $adapter->authenticate();

$identity = $result->getIdentity();

print_r($identity);

/*
Array
(
    [realm] => Some Realm
    [username] => someUser
)
*/]]>
        </programlisting>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.auth.adapter.http">

    <title>HTTP Authentication Adapter</title>

    <sect2 id="zend.auth.adapter.http.introduction">

        <title>Introduction</title>

        <para>
            <code>Zend_Auth_Adapter_Http</code> provides a mostly-compliant implementation of
            <ulink url="http://tools.ietf.org/html/rfc2617">RFC-2617</ulink>,
            <ulink url="http://en.wikipedia.org/wiki/Basic_authentication_scheme">Basic</ulink> and
            <ulink url="http://en.wikipedia.org/wiki/Digest_access_authentication">Digest</ulink> HTTP Authentication.
            Digest authentication is a method of HTTP authentication that improves upon Basic authentication by
            providing a way to authenticate without having to transmit the password in clear text across the network.
        </para>

        <para>
            <emphasis role="strong">Major Features:</emphasis>
            <itemizedlist>
                <listitem>
                    <para>
                        Supports both Basic and Digest authentication.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Issues challenges in all supported schemes, so client can respond with any scheme it supports.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Supports proxy authentication.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Includes support for authenticating against text files and provides an interface for
                        authenticating against other sources, such as databases.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            There are a few notable features of RFC-2617 that are not implemented yet:
            <itemizedlist>
                <listitem>
                    <para>
                        Nonce tracking, which would allow for "stale" support, and increased replay attack protection.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Authentication with integrity checking, or "auth-int".
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Authentication-Info HTTP header.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.design_overview">

        <title>Design Overview</title>

        <para>
            This adapter consists of two sub-components, the HTTP authentication class itself, and the so-called
            "Resolvers." The HTTP authentication class encapsulates the logic for carrying out both Basic and Digest
            authentication. It uses a Resolver to look up a client's identity in some data store (text file by default),
            and retrieve the credentials from the data store. The "resolved" credentials are then compared to the values
            submitted by the client to determine whether authentication is successful.
        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.configuration_options">

        <title>Configuration Options</title>

        <para>
            The <code>Zend_Auth_Adapter_Http</code> class requires a configuration array passed to its constructor.
            There are several configuration options available, and some are required:
            <table id="zend.auth.adapter.configuration_options.table">
                <title>Configuration Options</title>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Option Name</entry>
                            <entry>Required</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry><code>accept_schemes</code></entry>
                            <entry>Yes</entry>
                            <entry>
                                Determines which authentication schemes the adapter will accept from the client. Must be
                                a space-separated list containing <code>'basic'</code> and/or <code>'digest'</code>.
                            </entry>
                        </row>
                        <row>
                            <entry><code>realm</code></entry>
                            <entry>Yes</entry>
                            <entry>
                                Sets the authentication realm; usernames should be unique within a given realm.
                            </entry>
                        </row>
                        <row>
                            <entry><code>digest_domains</code></entry>
                            <entry>Yes, when <code>'accept_schemes'</code> contains <code>'digest'</code></entry>
                            <entry>
                                Space-separated list of URIs for which the same authentication information is valid. The
                                URIs need not all point to the same server.
                            </entry>
                        </row>
                        <row>
                            <entry><code>nonce_timeout</code></entry>
                            <entry>Yes, when <code>'accept_schemes'</code> contains <code>'digest'</code></entry>
                            <entry>
                                Sets the number of seconds for which the nonce is valid. See notes below.
                            </entry>
                        </row>
                        <row>
                            <entry><code>proxy_auth</code></entry>
                            <entry>No</entry>
                            <entry>
                                Disabled by default. Enable to perform Proxy authentication, instead of normal origin
                                server authentication.
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>

        <note>
            <para>
                The current implementation of the <code>nonce_timeout</code> has some interesting side effects. This
                setting is supposed to determine the valid lifetime of a given nonce, or effectively how long a client's
                authentication information is accepted. Currently, if it's set to 3600 (for example), it will cause the
                adapter to prompt the client for new credentials every hour, on the hour. This will be resolved in a
                future release, once nonce tracking and stale support are implemented.
            </para>
        </note>

    </sect2>

    <sect2 id="zend.auth.adapter.http.resolvers">

        <title>Resolvers</title>

        <para>
            The resolver's job is to take a username and realm, and return some kind of credential value. Basic
            authentication expects to receive the Base64 encoded version of the user's password. Digest authentication
            expects to receive a hash of the user's username, the realm, and their password (each separated by colons).
            Currently, the only supported hash algorithm is MD5.
        </para>

        <para>
            <code>Zend_Auth_Adapter_Http</code> relies on objects implementing
            <code>Zend_Auth_Adapter_Http_Resolver_Interface</code>. A text file resolver class is included with this
            adapter, but any other kind of resolver can be created simply by implementing the resolver interface.
        </para>

        <sect3 id="zend.auth.adapter.http.resolvers.file">

            <title>File Resolver</title>

            <para>
                The file resolver is a very simple class. It has a single property specifying a filename, which can also
                be passed to the constructor. Its <code>resolve()</code> method walks through the text file, searching
                for a line with a matching username and realm. The text file format similar to Apache htpasswd files:
                <programlisting><![CDATA[<username>:<realm>:<credentials>\n]]></programlisting>
                Each line consists of three fields - username, realm, and credentials - each separated by a colon. The
                credentials field is opaque to the file resolver; it simply returns that value as-is to the caller.
                Therefore, this same file format serves both Basic and Digest authentication. In Basic authentication,
                the credentials field should be the Base64 encoding of the user's password. In Digest authentication, it
                should be the MD5 hash discribed above.
            </para>

            <para>
                There are two equally easy ways to create a File resolver:
                <programlisting role="php"><![CDATA[<?php
$path     = 'files/passwd.txt';
$resolver = new Zend_Auth_Adapter_Http_Resolver_File($path);]]>
                </programlisting>
                or
                <programlisting role="php"><![CDATA[<?php
$path     = 'files/passwd.txt';
$resolver = new Zend_Auth_Adapter_Http_Resolver_File();
$resolver->setFile($path);]]>
                </programlisting>
                If the given path is empty or not readable, an exception is thrown.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.auth.adapter.http.basic_usage">

        <title>Basic Usage</title>

        <para>
            First, set up an array with the required configuration values:
            <programlisting role="php"><![CDATA[<?php
$config = array(
    'accept_schemes' => 'basic digest',
    'realm'          => 'My Web Site',
    'digest_domains' => '/members_only /my_account',
    'nonce_timeout'  => 3600,
);]]>
            </programlisting>
            This array will cause the adapter to accept either Basic or Digest authentication, and will require
            authenticated access to all the areas of the site under <code>/members_only</code> and
            <code>/my_account</code>. The realm value is usually displayed by the browser in the password dialog box.
            The <code>nonce_timeout</code>, of course, behaves as described above.
        </para>

        <para>
            Next, create the Zend_Auth_Adapter_Http object:
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Auth/Adapter/Http.php';
$adapter = new Zend_Auth_Adapter_Http($config);]]>
            </programlisting>
        </para>

        <para>
            Since we're supporting both Basic and Digest authentication, we need two different resolver objects. Note
            that this could just as easily be two different classes:
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Auth/Adapter/Http/Resolver/File.php';

$basicResolver = new Zend_Auth_Adapter_Http_Resolver_File();
$basicResolver->setFile('files/basicPasswd.txt');

$digestResolver = new Zend_Auth_Adapter_Http_Resolver_File();
$digestResolver->setFile('files/digestPasswd.txt');

$adapter->setBasicResolver($basicResolver);
$adapter->setDigestResolver($digestResolver);]]>
            </programlisting>
        </para>

        <para>
            Finally, we perform the authentication. The adapter needs a reference to both the Request and Response
            objects in order to do its job:
            <programlisting role="php"><![CDATA[<?php
assert($request instanceof Zend_Controller_Request_Http);
assert($response instanceof Zend_Controller_Response_Http);

$adapter->setRequest($request);
$adapter->setResponse($response);

$result = $adapter->authenticate();
if (!$result->isValid()) {
    // Bad userame/password, or canceled password prompt
}]]>
            </programlisting>
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.auth.adapter.ldap">

    <title>LDAP Authentication</title>

    <sect2 id="zend.auth.adapter.ldap.introduction">

        <title>Introduction</title>

        <para>
            <code>Zend_Auth_Adapter_Ldap</code> supports web application authentication with LDAP services. Its
            features include username and domain name canonicalization, multi-domain authentication, and failover
            capabilities. It has been tested to work with
            <ulink url="http://www.microsoft.com/windowsserver2003/technologies/directory/activedirectory/">Microsoft
            Active Directory</ulink> and <ulink url="http://www.openldap.org/">OpenLDAP</ulink>, but it should also
            work with other LDAP service providers.
        </para>

        <para>
            This documentation includes a guide on using <code>Zend_Auth_Adapter_Ldap</code>, an exploration of its
            API, an outline of the various available options, diagnostic information for troubleshooting authentication
            problems, and example options for both Active Directory and OpenLDAP servers.
        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.ldap.usage">

        <title>Usage</title>

        <para>
            To incorporate <code>Zend_Auth_Adapter_Ldap</code> authentication into your application quickly, even if
            you're not using <code>Zend_Controller</code>, the meat of your code should look something like the
            following:
            <programlisting role="php"><![CDATA[<?php
$username = $this->_request->getParam('username');
$password = $this->_request->getParam('password');

$auth = Zend_Auth::getInstance();

require_once 'Zend/Config/Ini.php';
$config = new Zend_Config_Ini('../application/config/config.ini', 'production');
$log_path = $config->ldap->log_path;
$options = $config->ldap->toArray();
unset($options['log_path']);

require_once 'Zend/Auth/Adapter/Ldap.php';
$adapter = new Zend_Auth_Adapter_Ldap($options, $username, $password);

$result = $auth->authenticate($adapter);

if ($log_path) {
    $messages = $result->getMessages();

    require_once 'Zend/Log.php';
    require_once 'Zend/Log/Writer/Stream.php';
    require_once 'Zend/Log/Filter/Priority.php';
    $logger = new Zend_Log();
    $logger->addWriter(new Zend_Log_Writer_Stream($log_path));
    $filter = new Zend_Log_Filter_Priority(Zend_Log::DEBUG);
    $logger->addFilter($filter);

    foreach ($messages as $i => $message) {
        if ($i-- > 1) { // $messages[2] and up are log messages
            $message = str_replace("\n", "\n  ", $message);
            $logger->log("Ldap: $i: $message", Zend_Log::DEBUG);
        }
    }
}]]></programlisting>
            Of course the logging code is optional, but it is highly recommended that you use a logger.
            <code>Zend_Auth_Adapter_Ldap</code> will record just about every bit of information anyone could want in
            <code>$messages</code> (more below), which is a nice feature in itself for something that has a history of
            being notoriously difficult to debug.
        </para>

        <para>
            The <code>Zend_Config_Ini</code> code is used above to load the adapter options. It is also optional. A
            regular array would work equally well. The following is an example
            <code>application/config/config.ini</code> file that has options for two separate servers. With multiple
            sets of server options the adapter will try each in order until the credentials are successfully
            authenticated. The names of the servers (e.g., <code>server1</code> and <code>server2</code>) are largely
            arbitrary. For details regarding the options array, see the <emphasis>Server Options</emphasis> section
            below. Note that <code>Zend_Config_Ini</code> requires that any values with equals characters
            (<code>=</code>) will need to be quoted (like the DNs shown below).
            <programlisting role="ini"><![CDATA[[production]

ldap.log_path = /tmp/ldap.log

; Typical options for OpenLDAP
ldap.server1.host = s0.foo.net
ldap.server1.accountDomainName = foo.net
ldap.server1.accountDomainNameShort = FOO
ldap.server1.accountCanonicalForm = 3
ldap.server1.username = "CN=user1,DC=foo,DC=net"
ldap.server1.password = pass1
ldap.server1.baseDn = "OU=Sales,DC=foo,DC=net"
ldap.server1.bindRequiresDn = true

; Typical options for Active Directory
ldap.server2.host = dc1.w.net
ldap.server2.useSsl = true
ldap.server2.accountDomainName = w.net
ldap.server2.accountDomainNameShort = W
ldap.server2.accountCanonicalForm = 3
ldap.server2.baseDn = "CN=Users,DC=w,DC=net"]]></programlisting>
            The above configuration will instruct <code>Zend_Auth_Adapter_Ldap</code> to attempt to authenticate users
            with the OpenLDAP server <code>s0.foo.net</code> first. If the authentication fails for any reason, the AD
            server <code>dc1.w.net</code> will be tried.
        </para>

        <para>
            With servers in different domains, this configuration illustrates multi-domain authentication. You can also
            have multiple servers in the same domain to provide redundancy.
        </para>

        <para>
            Note that in this case, even though OpenLDAP has no need for the short NetBIOS style domain name used by
            Windows we provide it here for name canonicalization purposes (described in the
            <emphasis>Username Canonicalization</emphasis> section below).
        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.ldap.api">

        <title>The API</title>

        <para>
            The <code>Zend_Auth_Adapter_Ldap</code> constructor accepts three parameters.
        </para>

        <para>
            The <code>$options</code> parameter is required and must be an array containing one or more sets of
            options. Note that it is <emphasis>an array of arrays</emphasis> of
            <link linkend="zend.ldap">Zend_Ldap</link> options. Even if you will be using only one LDAP server, the
            options must still be within another array.
        </para>

        <para>
            Below is <ulink url="http://php.net/print_r"><code>print_r()</code></ulink> output of an example options
            parameter containing two sets of server options for LDAP servers <code>s0.foo.net</code> and
            <code>dc1.w.net</code> (same options as the above INI representation):
            <programlisting role="output"><![CDATA[Array
(
    [server2] => Array
        (
            [host] => dc1.w.net
            [useSsl] => 1
            [accountDomainName] => w.net
            [accountDomainNameShort] => W
            [accountCanonicalForm] => 3
            [baseDn] => CN=Users,DC=w,DC=net
        )

    [server1] => Array
        (
            [host] => s0.foo.net
            [accountDomainName] => foo.net
            [accountDomainNameShort] => FOO
            [accountCanonicalForm] => 3
            [username] => CN=user1,DC=foo,DC=net
            [password] => pass1
            [baseDn] => OU=Sales,DC=foo,DC=net
            [bindRequiresDn] => 1
        )

)]]></programlisting>
            The information provided in each set of options above is different mainly because AD does not require a
            username be in DN form when binding (see the <code>bindRequiresDn</code> option in the
            <emphasis>Server Options</emphasis> section below), which means we can omit the a number of options
            associated with retrieving the DN for a username being authenticated.
        </para>

        <note>
            <title>What is a DN?</title>
            <para>
                A DN or "distinguished name" is a string that represents the path to an object within the LDAP
                directory. Each comma separated component is an attribute and value representing a node. The components
                are evaluated in reverse. For example, the user account
                <emphasis>CN=Bob Carter,CN=Users,DC=w,DC=net</emphasis> is located directly within the
                <emphasis>CN=Users,DC=w,DC=net container</emphasis>. This structure is best explored with an LDAP
                browser like the ADSI Edit MMC snap-in for Active Directory or phpLDAPadmin.
            </para>
        </note>

        <para>
            The names of servers (e.g. '<code>server1</code>' and '<code>server2</code>' shown above) are largely
            arbitrary, but for the sake of using <code>Zend_Config</code>, the identifiers should be present (as
            opposed to being numeric indexes) and should not contain any special characters used by the associated file
            formats (e.g. the '<code>.</code>' INI property separator, '<code>&amp;</code>' for XML entity references,
            etc).
        </para>

        <para>
            With multiple sets of server options, the adapter can authenticate users in multiple domains and provide
            failover so that if one server is not available, another will be queried.
        </para>

        <note>
            <title>The Gory Details - What exactly happens in the authenticate method?</title>
            <para>
                When the <code>authenticate()</code> method is called, the adapter iterates over each set of server
                options, sets them on the internal <code>Zend_Ldap</code> instance and calls the
                <code>Zend_Ldap::bind()</code> method with the username and password being authenticated. The
                <code>Zend_Ldap</code> class checks to see if the username is qualified with a domain (e.g., has a
                domain component like <emphasis>alice@foo.net</emphasis> or <emphasis>FOO\alice</emphasis>). If a
                domain is present, but it does not match either of the server's domain names
                (<emphasis>foo.net</emphasis> or <emphasis>FOO</emphasis>), a special exception is thrown and caught by
                <code>Zend_Auth_Adapter_Ldap</code> that causes that server to be ignored and the next set of server
                options is selected. If a domain <emphasis>does</emphasis> match, or if the user did not supply a
                qualified username, <code>Zend_Ldap</code> proceeds to try to bind with the supplied credentials. If
                the bind is not successful, <code>Zend_Ldap</code> throws a <code>Zend_Ldap_Exception</code> which is
                caught by <code>Zend_Auth_Adapter_Ldap</code> and the next set of server options is tried. If the bind
                is successful, the iteration stops, and the adapter's <code>authenticate()</code> method returns a
                successful result. If all server options have been tried without success, the authentication fails, and
                <code>authenticate()</code> returns a failure result with error messages from the last iteration.
            </para>
        </note>

        <para>
            The username and password parameters of the <code>Zend_Auth_Adapter_Ldap</code> constructor represent the
            credentials being authenticated (i.e., the credentials supplied by the user through your HTML login form).
            Alternatively, they may also be set with the <code>setUsername()</code> and <code>setPassword()</code>
            methods.
        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.ldap.server-options">

        <title>Server Options</title>

        <para>
            Each set of server options <emphasis>in the context of Zend_Auth_Adapter_Ldap</emphasis> consists of the
            following options, which are passed, largely unmodifed, to <code>Zend_Ldap::setOptions()</code>:

            <table id="zend.auth.adapter.ldap.server-options.table">
              <title>Server Options</title>
              <tgroup cols="2">
                <thead>
                  <row>
                    <entry>Name</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry><emphasis role="strong">host</emphasis></entry>
                    <entry>
                        The hostname of LDAP server that these options represent. This option is required.
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">port</emphasis></entry>
                    <entry>
                        The port on which the LDAP server is listening. If <emphasis role="strong">useSsl</emphasis> is
                        <code>true</code>, the default <emphasis role="strong">port</emphasis> value is 636. If
                        <emphasis role="strong">useSsl</emphasis> is <code>false</code>, the default
                        <emphasis role="strong">port</emphasis> value is 389.
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">useSsl</emphasis></entry>
                    <entry>
                        If <code>true</code>, this value indicates that the LDAP client should use SSL / TLS encrypted
                        transport. A value of <code>true</code> is strongly favored in production environments to
                        prevent passwords from be transmitted in clear text. The default value is <code>false</code>,
                        as servers frequently require that a certificate be installed separately after installation.
                        This value also changes the default <emphasis role="strong">port</emphasis> value (see
                        <emphasis role="strong">port</emphasis> description above).
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">username</emphasis></entry>
                    <entry>
                        The DN of the account used to perform account DN lookups. LDAP servers that require the
                        username to be in DN form when performing the "bind" require this option. Meaning, if
                        <emphasis role="strong">bindRequiresDn</emphasis> is <code>true</code>, this option is
                        required. This account does not need to be a privileged account - a account with read-only
                        access to objects under the <emphasis role="strong">baseDn</emphasis> is all that is necessary
                        (and preferred based on the <emphasis>Principle of Least Privilege</emphasis>).
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">password</emphasis></entry>
                    <entry>
                        The password of the account used to perform account DN lookups. If this option is not supplied,
                        the LDAP client will attempt an "anonymous bind" when performing account DN lookups.
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">bindRequiresDn</emphasis></entry>
                    <entry>
                        Some LDAP servers require that the username used to bind be in DN form like
                        <emphasis>CN=Alice Baker,OU=Sales,DC=foo,DC=net</emphasis> (basically all servers
                        <emphasis>except</emphasis> AD). If this option is <code>true</code>, this instructs
                        <code>Zend_Ldap</code> to automatically retrieve the DN corresponding to the username being
                        authenticated, if it is not already in DN form, and then re-bind with the proper DN. The
                        default value is <code>false</code>. Currently only Microsoft Active Directory Server (ADS) is
                        known <emphasis>not</emphasis> to require usernames to be in DN form when binding, and
                        therefore this option may be <code>false</code> with AD (and it should be, as retrieving the DN
                        requires an extra round trip to the server). Otherwise, this option must be set to
                        <code>true</code> (e.g. for OpenLDAP). This option also controls the default
                        <emphasis role="strong">acountFilterFormat</emphasis> used when searching for accounts. See the
                        <emphasis role="strong">accountFilterFormat</emphasis> option.
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">baseDn</emphasis></entry>
                    <entry>
                        The DN under which all accounts being authenticated are located. This option is required. If
                        you are uncertain about the correct <emphasis role="strong">baseDn</emphasis> value, it should
                        be sufficient to derive it from the user's DNS domain using <emphasis>DC=</emphasis>
                        components. For example, if the user's principal name is <emphasis>alice@foo.net</emphasis>, a
                        <emphasis role="strong">baseDn</emphasis> of <emphasis>DC=foo,DC=net</emphasis> should work. A
                        more precise location (e.g., <emphasis>OU=Sales,DC=foo,DC=net</emphasis>) will be more
                        efficient, however.
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">accountCanonicalForm</emphasis></entry>
                    <entry>
                        A value of 2, 3 or 4 indicating the form to which account names should be canonicalized after
                        successful authentication. Values are as follows: 2 for traditional username style names (e.g.,
                        <emphasis>alice</emphasis>), 3 for backslash-style names (e.g., <emphasis>FOO\alice</emphasis>)
                        or 4 for principal style usernames (e.g., <emphasis>alice@foo.net</emphasis>). The default
                        value is 4 (e.g., <emphasis>alice@foo.net</emphasis>). For example, with a value of 3, the
                        identity returned by <code>Zend_Auth_Result::getIdentity()</code> (and
                        <code>Zend_Auth::getIdentity()</code>, if <code>Zend_Auth</code> was used) will always be
                        <emphasis>FOO\alice</emphasis>, regardless of what form Alice supplied, whether it be
                        <emphasis>alice</emphasis>, <emphasis>alice@foo.net</emphasis>, <emphasis>FOO\alice</emphasis>,
                        <emphasis>FoO\aLicE</emphasis>, <emphasis>foo.net\alice</emphasis>, etc. See the
                        <emphasis>Account Name Canonicalization</emphasis> section in the <code>Zend_Ldap</code>
                        documentation for details. Note that when using multiple sets of server options it is
                        recommended, but not required, that the same
                        <emphasis role="strong">accountCanonicalForm</emphasis> be used with all server options so that
                        the resulting usernames are always canonicalized to the same form (e.g., if you canonicalize to
                        <emphasis>EXAMPLE\username</emphasis> with an AD server but to
                        <emphasis>username@example.com</emphasis> with an OpenLDAP server, that may be awkward for the
                        application's high-level logic).
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">accountDomainName</emphasis></entry>
                    <entry>
                        The FQDN domain name for which the target LDAP server is an authority (e.g.,
                        <code>example.com</code>). This option is used to canonicalize names so that the username
                        supplied by the user can be converted as necessary for binding. It is also used to determine if
                        the server is an authority for the supplied username (e.g., if
                        <emphasis role="strong">accountDomainName</emphasis> is <emphasis>foo.net</emphasis> and the
                        user supplies <emphasis>bob@bar.net</emphasis>, the server will not be queried, and a failure
                        will result). This option is not required, but if it is not supplied, usernames in principal
                        name form (e.g., <emphasis>alice@foo.net</emphasis>) are not supported. It is strongly
                        recommended that you supply this option, as there are many use-cases that require generating
                        the principal name form.
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">accountDomainNameShort</emphasis></entry>
                    <entry>
                        The 'short' domain for which the target LDAP server is an authority (e.g.,
                        <emphasis>FOO</emphasis>). Note that there is a 1:1 mapping between the
                        <emphasis role="strong">accountDomainName</emphasis> and
                        <emphasis role="strong">accountDomainNameShort</emphasis>. This option should be used to
                        specify the NetBIOS domain name for Windows networks but may also be used by non-AD servers
                        (e.g., for consistency when multiple sets of server options with the backslash style
                        <emphasis role="strong">accountCanonicalForm</emphasis>). This option is not required but if it
                        is not supplied, usernames in backslash form (e.g., <emphasis>FOO\alice</emphasis>) are not
                        supported.
                    </entry>
                  </row>
                  <row>
                    <entry><emphasis role="strong">accountFilterFormat</emphasis></entry>
                    <entry>
                        The LDAP search filter used to search for accounts. This string is a
                        <ulink url="http://php.net/printf"><code>printf()</code></ulink>-style expression that must
                        contain one '<code>%s</code>' to accomodate the username. The default value is
                        '<code>(&amp;(objectClass=user)(sAMAccountName=%s))</code>', unless
                        <emphasis role="strong">bindRequiresDn</emphasis> is set to <code>true</code>, in which case
                        the default is '<code>(&amp;(objectClass=posixAccount)(uid=%s))</code>'. For example, if for
                        some reason you wanted to use <code>bindRequiresDn = true</code> with AD you would need to set
                        <code>accountFilterFormat = '(&amp;(objectClass=user)(sAMAccountName=%s))</code>'.
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
        </para>

        <note>
            <para>
                If you enable <code>useSsl = true</code> you may find that the LDAP client generates an error
                claiming that it cannot validate the server's certificate. Assuming the PHP LDAP extension is
                ultimately linked to the OpenLDAP client libraries, to resolve this issue you can set
                "<code>TLS_REQCERT never</code>" in the OpenLDAP client <code>ldap.conf</code> (and restart the web
                server) to indicate to the OpenLDAP client library that you trust the server. Alternatively if you are
                concerned that the server could be spoofed, you can export the LDAP server's root certificate and put
                it on the web server so that the OpenLDAP client can validate the server's identity.
            </para>
        </note>

    </sect2>

    <sect2 id="zend.auth.adapter.ldap.debugging">

        <title>Collecting Debugging Messages</title>

        <para>
            <code>Zend_Auth_Adapter_Ldap</code> collects debugging information within its <code>authenticate()</code>
            method. This information is stored in the <code>Zend_Auth_Result</code> object as messages. The array
            returned by <code>Zend_Auth_Result::getMessages()</code> is described as follows:

            <table id="zend.auth.adapter.ldap.debugging.table">
              <title>Debugging Messages</title>
              <tgroup cols="2">
                <thead>
                  <row>
                    <entry>Messages Array Index</entry>
                    <entry>Description</entry>
                  </row>
                </thead>
                <tbody>
                  <row>
                    <entry>Index 0</entry>
                    <entry>
                        A generic, user-friendly message that is suitable for displaying to users (e.g., "Invalid
                        credentials"). If the authentication is successful, this string is empty.
                    </entry>
                  </row>
                  <row>
                    <entry>Index 1</entry>
                    <entry>
                        A more detailed error message that is not suitable to be displayed to users but should be
                        logged for the benefit of server operators. If the authentication is successful, this string is
                        empty.
                    </entry>
                  </row>
                  <row>
                    <entry>Indexes 2 and higher</entry>
                    <entry>
                        All log messages in order starting at index 2.
                    </entry>
                  </row>
                </tbody>
              </tgroup>
            </table>

            In practice index 0 should be displayed to the user (e.g., using the FlashMessenger helper), index 1 should
            be logged and, if debugging information is being collected, indexes 2 and higher could be logged as well
            (although the final message always includes the string from index 1).
        </para>

    </sect2>

    <sect2 id="zend.auth.adapter.ldap.options-common-server-specific">

        <title>Common Options for Specific Servers</title>

        <sect3 id="zend.auth.adapter.ldap.options-common-server-specific.active-directory">

            <title>Options for Active Directory</title>

            <para>
                For ADS, the following options are noteworthy:

                <table id="zend.auth.adapter.ldap.options-common-server-specific.active-directory.table">
                  <title>Options for Active Directory</title>
                  <tgroup cols="2">
                    <thead>
                      <row>
                        <entry>Name</entry>
                        <entry>Additional Notes</entry>
                      </row>
                    </thead>
                    <tbody>
                      <row>
                        <entry><emphasis role="strong">host</emphasis></entry>
                        <entry>
                            As with all servers, this option is required.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">useSsl</emphasis></entry>
                        <entry>
                            For the sake of security, this should be <code>true</code> if the server has the necessary
                            certificate installed.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">baseDn</emphasis></entry>
                        <entry>
                            As with all servers, this option is required. By default AD places all user accounts under
                            the <emphasis>Users</emphasis> container (e.g.,
                            <emphasis>CN=Users,DC=foo,DC=net</emphasis>), but the default is not common in larger
                            organizations. Ask your AD administrator what the best DN for accounts for your application
                            would be.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">accountCanonicalForm</emphasis></entry>
                        <entry>
                            You almost certainly want this to be 3 for backslash style names (e.g.,
                            <emphasis>FOO\alice</emphasis>), which are most familar to Windows users. You should
                            <emphasis>not</emphasis> use the unqualified form 2 (e.g., <emphasis>alice</emphasis>), as
                            this may grant access to your application to users with the same username in other trusted
                            domains (e.g., <emphasis>BAR\alice</emphasis> and <emphasis>FOO\alice</emphasis> will be
                            treated as the same user). (See also note below.)
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">accountDomainName</emphasis></entry>
                        <entry>
                            This is required with AD unless <emphasis role="strong">accountCanonicalForm</emphasis> 2
                            is used, which, again, is discouraged.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">accountDomainNameShort</emphasis></entry>
                        <entry>
                            The NetBIOS name of the domain users are in and for which the AD server is an authority.
                            This is required if the backslash style
                            <emphasis role="strong">accountCanonicalForm</emphasis> is used.
                        </entry>
                      </row>
                    </tbody>
                  </tgroup>
                </table>
            </para>

            <note>
                <para>
                    Technically there should be no danger of accidental cross-domain authentication with the current
                    <code>Zend_Auth_Adapter_Ldap</code> implementation, since server domains are explicitly checked,
                    but this may not be true of a future implementation that discovers the domain at runtime or if an
                    alternative adapter is used (e.g., Kerberos). In general, account name ambiguity is known to be the
                    source of security issues so always try to use qualified account names.
                </para>
            </note>

        </sect3>

        <sect3 id="zend.auth.adapter.ldap.options-common-server-specific.openldap">

            <title>Options for OpenLDAP</title>

            <para>
                For OpenLDAP or a generic LDAP server using a typical posixAccount style schema, the following options
                are noteworthy:

                <table id="zend.auth.adapter.ldap.options-common-server-specific.openldap.table">
                  <title>Options for OpenLDAP</title>
                  <tgroup cols="2">
                    <thead>
                      <row>
                        <entry>Name</entry>
                        <entry>Additional Notes</entry>
                      </row>
                    </thead>
                    <tbody>
                      <row>
                        <entry><emphasis role="strong">host</emphasis></entry>
                        <entry>
                            As with all servers, this option is required.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">useSsl</emphasis></entry>
                        <entry>
                            For the sake of security, this should be <code>true</code> if the server has the necessary
                            certificate installed.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">username</emphasis></entry>
                        <entry>
                            Required and must be a DN, as OpenLDAP requires that usernames be in DN form when
                            performing a bind. Try to use an unprivileged account.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">password</emphasis></entry>
                        <entry>
                            The password corresponding to the username above, but this may be omitted if the LDAP
                            server permits an anonymous binding to query user accounts.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">bindRequiresDn</emphasis></entry>
                        <entry>
                            Required and must be <code>true</code>, as OpenLDAP requires that usernames be in DN form
                            when performing a bind.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">baseDn</emphasis></entry>
                        <entry>
                            As with all servers, this option is required and indicates the DN under which all accounts
                            being authenticated are located.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">accountCanonicalForm</emphasis></entry>
                        <entry>
                            Optional but the default value is 4 (principal style names like
                            <emphasis>alice@foo.net</emphasis>), which may not be ideal if your users are used to
                            backslash style names (e.g., <emphasis>FOO\alice</emphasis>). For backslash style names use
                            value 3.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">accountDomainName</emphasis></entry>
                        <entry>
                            Required unless you're using <emphasis role="strong">accountCanonicalForm</emphasis> 2,
                            which is not recommended.
                        </entry>
                      </row>
                      <row>
                        <entry><emphasis role="strong">accountDomainNameShort</emphasis></entry>
                        <entry>
                            If AD is not also being used, this value is not required. Otherwise, if
                            <emphasis role="strong">accountCanonicalForm</emphasis> 3 is used, this option is required
                            and should be a short name that corresponds adequately to the
                            <emphasis role="strong">accountDomainName</emphasis> (e.g., if your
                            <emphasis role="strong">accountDomainName</emphasis> is
                            <emphasis role="strong">foo.net</emphasis>, a good
                            <emphasis role="strong">accountDomainNameShort</emphasis> value might be
                            <emphasis>FOO</emphasis>).
                        </entry>
                      </row>
                    </tbody>
                  </tgroup>
                </table>

            </para>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.auth.adapter.openid">

    <title>Open ID Authentication</title>

    <sect2 id="zend.auth.adapter.openid.introduction">

        <title>Introduction</title>
        <para>
            <code>Zend_Auth_Adapter_OpenId</code> allows authenticate user using
            remote OpenID server. Such authentication process assumes that user
            submits to web application only their OpenID identity. Then they are
            redirected to their OpenID providers to prove the identity ownership
            using password or some other method. This password is never known
            to local web application.
        </para>
        <para>
            The OpenID identity is just an HTTP URL that points to some web page
            with suitable information about the user and special tags which
            describes which server to use and which identity to submit there.
            You can read more about OpenID at
            <ulink url="http://www.openid.net/">OpenID official site</ulink>.
        </para>
        <para>
            The <code>Zend_Auth_Adapter_OpenId</code> class is a wrapper on top
            of <code>Zend_OpenId_Consumer</code> component which implements the
            OpenID authentication protocol itself.
        </para>

        <note>
            <para>
                <code>Zend_OpenId</code> takes advantage of the <ulink url="http://php.net/gmp">GMP extension</ulink>,
                where available. Consider enabling the GMP extension for better performance when using
                <code>Zend_Auth_Adapter_OpenId</code>.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.auth.adapter.openid.specifics">
        <title>Specifics</title>
        <para>
            As any other <code>Zend_Auth</code> adapter the <code>Zend_Auth_Adapter_OpenId</code>
            class implements <code>Zend_Auth_Adapter_Interface</code>, which
            defines one method - <code>authenticate()</code>. This method performs
            the authentication itself, but the object must be prepared prior to
            calling it. Such adapter preparation includes setting up OpenID
            identity and some other <code>Zend_OpenId</code> specific options.
        </para>

        <para>
            However in opposite to other <code>Zend_Auth</code> adapters it
            performs authentication on external server and it is done in two
            separate HTTP requests. So the <code>Zend_Auth_Adapter_OpenId::authenticate()</code>
            must be called twice. First time the method won't return, but will
            redirect user to their OpenID server. Then after authentication on
            server they will be redirected back and the script for this second
            request must call <code>Zend_Auth_Adapter_OpenId::authenticate()</code>
            again to verify signature which come with redirected request from the
            server and complete the authentication process. This time the
            method will return <code>Zend_Auth_Result</code> object as expected.
        </para>

        <para>
            The following example shows the usage of <code>Zend_Auth_Adapter_OpenId</code>.
            As was said before the <code>Zend_Auth_Adapter_OpenId::authenticate()</code>
            is called two times. First time - after submitting of HTML form when
            <code>$_POST['openid_action']</code> is set to <code>"login"</code>,
            and the second time after HTTP redirection from OpenID server when
            <code>$_GET['openid_mode']</code> or <code>$_POST['openid_mode']</code>
            is set.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once "Zend/Auth.php";
require_once "Zend/Auth/Adapter/OpenId.php";

$status = "";
$auth = Zend_Auth::getInstance();
if ((isset($_POST['openid_action']) &&
     $_POST['openid_action'] == "login" &&
     !empty($_POST['openid_identifier'])) ||
    isset($_GET['openid_mode']) ||
    isset($_POST['openid_mode'])) {
    $result = $auth->authenticate(
        new Zend_Auth_Adapter_OpenId(@$_POST['openid_identifier']));
    if (!$result->isValid()) {
        $status = "You are logged-in as " . $auth->getIdentity() . "<br>\n";
    } else {
        $auth->clearIdentity();
        foreach ($result->getMessages() as $message) {
            $status .= "$message<br>\n";
        }
    }
} else if ($auth->hasIdentity()) {
    if (isset($_POST['openid_action']) &&
        $_POST['openid_action'] == "logout") {
        $auth->clearIdentity();
    } else {
        $status = "You are logged-in as " . $auth->getIdentity() . "<br>\n";
    }
}
?>
<html><body>
<?php echo "$status";?>
<form method="post"><fieldset>
<legend>OpenID Login</legend>
<input type="text" name="openid_identifier" value="">
<input type="submit" name="openid_action" value="login">
<input type="submit" name="openid_action" value="logout">
</fieldset></form></body></html>
*/]]>
        </programlisting>

        <para>
            It is allowed customize the OpenID authentication process with:
            receiving redirection from the OpenID server on separate page,
            specifying the "root" of web site. In this case, using custom
            <code>Zend_OpenId_Consumer_Storage</code> or custom
            <code>Zend_Controller_Response</code>. It is also possible to use
            Simple Registration Extension to retrieve information about
            user from the OpenID server. All these possibilities described
            in more details in <code>Zend_OpenId_Consumer</code>
            reference.
        </para>

    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.cache.backends">
    <title>Zend_Cache backends</title>

    <sect2 id="zend.cache.backends.file">
        <title>Zend_Cache_Backend_File</title>
        <para>
            This backends stores cache records into files (in a choosen directory).
        </para>
        <para>
            Available options are :
        </para>
        <table id="zend.cache.backends.file.table">
            <title>File backend options</title>
            <tgroup cols="4">
                 <thead>
                      <row>
                        <entry>Option</entry>
                        <entry>Data Type</entry>
                        <entry>Default Value</entry>
                        <entry>Description</entry>
                    </row>
                 </thead>
                 <tbody>
                      <row>
                          <entry><code>cache_dir</code></entry>
                          <entry><code>string</code></entry>
                          <entry><code>'/tmp/'</code></entry>
                          <entry>
                              Directory where to store cache files
                          </entry>
                      </row>
                      <row>
                          <entry><code>file_locking</code></entry>
                          <entry><code>boolean</code></entry>
                          <entry><code>true</code></entry>
                          <entry>
                            Enable / disable file_locking : Can avoid cache corruption under
                            bad circumstances but it doesn't help on multithread webservers
                            or on NFS filesystems...
                          </entry>
                      </row>
                      <row>
                          <entry><code>read_control</code></entry>
                          <entry><code>boolean</code></entry>
                          <entry><code>true</code></entry>
                          <entry>
                            Enable / disable read control : if enabled, a control key is
                            embeded in the cache file and this key is compared with the
                            one calculated after the reading.
                          </entry>
                      </row>
                      <row>
                          <entry><code>read_control_type</code></entry>
                          <entry><code>string</code></entry>
                          <entry><code>'crc32'</code></entry>
                          <entry>
                            Type of read control (only if read control is enabled). Available values are :
                            'md5' (best but slowest), 'crc32' (lightly less safe but faster, better choice),
                            'adler32' (new choice, faster than crc32),
                            'strlen' for a length only test (fastest).
                        </entry>
                      </row>
                      <row>
                          <entry><code>hashed_directory_level</code></entry>
                          <entry><code>int</code></entry>
                          <entry><code>0</code></entry>
                          <entry>
                            Hashed directory structure level :     0 means "no hashed directory
                             structure", 1 means "one level of directory", 2 means "two levels"...
                             This option can speed up the cache only when you have many thousands of
                             cache files. Only specific benchs can help you to choose the perfect
                             value for you. Maybe, 1 or 2 is a good start.
                          </entry>
                      </row>
                      <row>
                          <entry><code>hashed_directory_umask</code></entry>
                          <entry><code>int</code></entry>
                          <entry><code>0700</code></entry>
                          <entry>
                              Umask for the hashed directory structure
                        </entry>
                      </row>
                      <row>
                          <entry><code>file_name_prefix</code></entry>
                          <entry><code>string</code></entry>
                          <entry><code>'zend_cache'</code></entry>
                          <entry>
                              prefix for cache files ; be really carefull with this option because
                              a too generic value in a system cache dir (like /tmp) can cause
                              disasters when cleaning the cache
                        </entry>
                      </row>
                      <row>
                          <entry><code>cache_file_umask</code></entry>
                          <entry><code>int</code></entry>
                          <entry><code>0700</code></entry>
                          <entry>
                              umask for cache files
                          </entry>
                      </row>
                       <row>
                          <entry><code>metatadatas_array_max_size</code></entry>
                          <entry><code>int</code></entry>
                          <entry><code>100</code></entry>
                          <entry>
                              internal max size for the metadatas array (don't change this value unless you
                              know what you are doing)
                          </entry>
                      </row>                     
                  </tbody>
              </tgroup>
          </table>
    </sect2>
    <sect2 id="zend.cache.backends.sqlite">
        <title>Zend_Cache_Backend_Sqlite</title>
        <para>
            This backends stores cache records into a SQLite database.
        </para>
        <para>
            Available options are :
        </para>
        <table id="zend.cache.backends.sqlite.table">
            <title>Sqlite backend options</title>
            <tgroup cols="4">
                 <thead>
                      <row>
                           <entry>Option</entry>
                        <entry>Data Type</entry>
                        <entry>Default Value</entry>
                        <entry>Description</entry>
                    </row>
                 </thead>
                 <tbody>
                      <row>
                          <entry><code>cache_db_complete_path (mandatory)</code></entry>
                          <entry><code>string</code></entry>
                          <entry><code>null</code></entry>
                          <entry>
                              The complete path (filename included) of the SQLite database
                          </entry>
                      </row>
                      <row>
                          <entry><code>automatic_vacuum_factor</code></entry>
                          <entry><code>int</code></entry>
                          <entry><code>10</code></entry>
                          <entry>
                              Disable / Tune the automatic vacuum process.
                              The automatic vacuum process defragment the database file (and make it smaller)
                              when a clean() or delete() is called :
                              0 means no automatic vacuum ;
                              1 means systematic vacuum (when delete() or clean() methods are called) ;
                              x (integer) > 1 => automatic vacuum randomly 1 times on x clean() or delete().
                          </entry>
                      </row>
                  </tbody>
              </tgroup>
          </table>
    </sect2>
    <sect2 id="zend.cache.backends.memcached">
        <title>Zend_Cache_Backend_Memcached</title>
        <para>
            This backends stores cache records into a memcached server. <ulink url="http://www.danga.com/memcached/">memcached</ulink>
            is a high-performance, distributed memory object caching system. To use this backend,
            you need a memcached daemon and <ulink url="http://pecl.php.net/package/memcache">the memcache PECL extension</ulink>.
        </para>
        <para>
            Be careful : with this backend, "tags" are not supported for the moment as
            the "doNotTestCacheValidity=true" argument.
        </para>
        <para>
            Available options are :
        </para>
        <table id="zend.cache.backends.memcached.table">
            <title>Memcached backend options</title>
            <tgroup cols="4">
                 <thead>
                      <row>
                        <entry>Option</entry>
                        <entry>Data Type</entry>
                        <entry>Default Value</entry>
                        <entry>Description</entry>
                    </row>
                 </thead>
                 <tbody>
                      <row>
                          <entry><code>servers</code></entry>
                          <entry><code>array</code></entry>
                          <entry><code>array(array('host' => 'localhost','port' => 11211, 'persistent' => true))</code></entry>
                          <entry>
                              An array of memcached servers ; each memcached server is described by an associative array :
                              'host' => (string) : the name of the memcached server,
                              'port' => (int) : the port of the memcached server,
                              'persistent' => (bool) : use or not persistent connections to this memcached server
                          </entry>
                      </row>
                      <row>
                          <entry><code>compression</code></entry>
                          <entry><code>boolean</code></entry>
                          <entry><code>false</code></entry>
                          <entry>
                             true if you want to use on-the-fly compression
                          </entry>
                      </row>
                  </tbody>
              </tgroup>
          </table>
    </sect2>
    <sect2 id="zend.cache.backends.apc">
        <title>Zend_Cache_Backend_Apc</title>
        <para>
            This backends stores cache records in shared memory through
            the <ulink url="http://pecl.php.net/package/APC">APC</ulink> (Alternative PHP Cache) extension
            (which is of course need for using this backend).
        </para>
        <para>
            Be careful : with this backend, "tags" are not supported for the moment as
            the "doNotTestCacheValidity=true" argument.
        </para>
        <para>
            There is no option for this backend.
        </para>
    </sect2>
    <sect2 id="zend.cache.backends.platform">
        <title>Zend_Cache_Backend_ZendPlatform</title>
        <para>
            This backend uses content caching API of the <ulink url="http://www.zend.com/products/platform">Zend Platform</ulink> product. Naturally, to use this backend you need to have Zend Platform installed.
        </para>
        <para>
    This backend supports tags, but does not support <code>CLEANING_MODE_NOT_MATCHING_TAG</code> cleaning mode.
        </para>
        <para>
            Specify this backend using a word separator -- '-', '.', ' ', or '_'
            -- between the words 'Zend' and 'Platform' when using the
            <code>Zend_Cache::factory()</code> method:
        </para>
        <programlisting role="php"><![CDATA[<?php
$cache = Zend_Cache::factory('Core', 'Zend Platform');]]>
        </programlisting>
        <para>
            There is no options for this backend.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.cache.frontends">
    <title>Zend_Cache frontends</title>

    <sect2 id="zend.cache.frontends.core">
        <title>Zend_Cache_Core</title>
        <sect3 id="zend.cache.frontends.core.introduction">
            <title>Introduction</title>
            <para>
                <code>Zend_Cache_Core</code> is a special frontend because it is the core
                of the module. It is a generic cache frontend and is extended by other classes.
            </para>
            <note><para>
                All frontends inherit from <code>Zend_Cache_Core</code> so that its methods and options
                (described below) would also be available in other frontends, therefore they won't be
                documented there.
            </para></note>
        </sect3>
        <sect3 id="zend.cache.frontends.core.options">
            <title>Available options</title>
            <para>
                These options are passed to the factory method as demonstrated in previous examples.
            </para>
            <table id="zend.cache.frontends.core.options.table">
                <title>Core frontend options</title>
                <tgroup cols="4">
                     <thead>
                          <row>
                            <entry>Option</entry>
                            <entry>Data Type</entry>
                            <entry>Default Value</entry>
                            <entry>Description</entry>
                        </row>
                     </thead>
                     <tbody>
                          <row>
                              <entry><code>caching</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>true</code></entry>
                              <entry>
                                  enable / disable caching (can be very useful for the debug of
                                  cached scripts)
                              </entry>
                          </row>
                          <row>
                              <entry><code>cache_id_prefix</code></entry>
                              <entry><code>string</code></entry>
                              <entry><code>null</code></entry>
                              <entry>
                                A prefix for all cache ids, if set to <code>null</code>, no
                                cache id prefix will be used. The cache id prefix essentially creates
                                a namespace in the cache, allowing multiple applications or websites
                                to use a shared cache. Each application or website can use a different
                                cache id prefix so specific cache ids can be used more than once.
                              </entry>
                          </row>
                          <row>
                              <entry><code>lifetime</code></entry>
                              <entry><code>int</code></entry>
                              <entry><code>3600</code></entry>
                              <entry>
                                cache lifetime (in seconds), if set to <code>null</code>, the
                                cache is valid forever.
                              </entry>
                          </row>
                          <row>
                              <entry><code>logging</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>false</code></entry>
                              <entry>
                                if set to true, logging through <code>Zend_Log</code> is activated
                                (but the system is slower)
                              </entry>
                          </row>
                          <row>
                              <entry><code>write_control</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>true</code></entry>
                              <entry>
                                Enable / disable write control (the cache is read
                                just after writing to detect corrupt entries), enabling write_control
                                will lightly slow the cache writing but not the cache reading (it
                                can detect some corrupt cache files but it's not a perfect control)
                              </entry>
                          </row>
                          <row>
                              <entry><code>automatic_serialization</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>false</code></entry>
                              <entry>
                                Enable / disable automatic serialization, it can be used to save directly datas
                                which aren't strings (but it's slower)
                              </entry>
                          </row>
                          <row>
                              <entry><code>automatic_cleaning_factor</code></entry>
                              <entry><code>int</code></entry>
                              <entry><code>10</code></entry>
                              <entry>
                                Disable / Tune the automatic cleaning process (garbage collector):
                                0 means no automatic cache cleaning, 1 means systematic cache cleaning
                                and x &gt; 1 means automatic random cleaning 1 times in x write operations.
                              </entry>
                          </row>
                          <row>
                              <entry><code>ignore_user_abort</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>false</code></entry>
                              <entry>
                                if set to true, the core will set the ignore_user_abort PHP flag inside the
                                save() method to avoid cache corruptions in some cases
                              </entry>
                          </row>
                      </tbody>
                  </tgroup>
              </table>
        </sect3>

        <sect3 id="zend.cache.core.examples">
            <title>Examples</title>
            <para>
                An example is given in the manual at the very beginning.
            </para>
            <para>
                If you store only strings into cache (because with "automatic_serialization" option, it's possible
                to store some booleans), you can use a more compact construction like:
            </para>
            <programlisting role="php"><![CDATA[<?php
// we assume you already have $cache

$id = 'myBigLoop'; // cache id of "what we want to cache"

if (!($data = $cache->load($id))) {
    // cache miss

    $data = '';
    for ($i = 0; $i < 10000; $i++) {
        $data = $data . $i;
    }

    $cache->save($data);

}

// [...] do something with $data (echo it, pass it on etc.)]]>
            </programlisting>
            <para>
                If you want to cache multiple blocks or data instances, the idea is the same:
            </para>
            <programlisting role="php"><![CDATA[<?php
// make sure you use unique identifiers:
$id1 = 'foo';
$id2 = 'bar';

// block 1
if (!($data = $cache->load($id1))) {
    // cache missed

    $data = '';
    for ($i=0;$i<10000;$i++) {
        $data = $data . $i;
    }

    $cache->save($data);

}
echo($data);

// this isn't affected by caching
echo('NEVER CACHED! ');

// block 2
if (!($data = $cache->load($id2))) {
    // cache missed

    $data = '';
    for ($i=0;$i<10000;$i++) {
        $data = $data . '!';
    }

    $cache->save($data);

}
echo($data);]]>
            </programlisting>
        </sect3>
    </sect2>

    <sect2 id="zend.cache.frontends.output">
        <title>Zend_Cache_Frontend_Output</title>
        <sect3 id="zend.cache.frontends.output.introduction">
            <title>Introduction</title>
            <para>
                <code>Zend_Cache_Frontend_Output</code> is an output-capturing frontend. It utilizes
                output buffering in PHP to capture everything between its <code>start()</code> and
                <code>end()</code> methods.
            </para>
        </sect3>
        <sect3 id="zend.cache.frontends.output.options">
            <title>Available options</title>
            <para>
                This frontend doesn't have any specific options other than those of
                <code>Zend_Cache_Core</code>.
            </para>
        </sect3>

        <sect3 id="zend.cache.frontends.output.examples">
            <title>Examples</title>
            <para>
                An example is given in the manual at the very beginning. Here it is with minor changes:
            </para>
            <programlisting role="php"><![CDATA[<?php
// if it is a cache miss, output buffering is triggered
if (!($cache->start('mypage'))) {

    // output everything as usual
    echo 'Hello world! ';
    echo 'This is cached ('.time().') ';

    $cache->end(); // output buffering ends

}

echo 'This is never cached ('.time().').';]]>
            </programlisting>
            <para>
                Using this form it is fairly easy to set up output caching in your already working project
                with little or no code refactoring.
            </para>
        </sect3>
    </sect2>

    <sect2 id="zend.cache.frontends.function">
        <title>Zend_Cache_Frontend_Function</title>
        <sect3 id="zend.cache.frontends.function.introduction">
            <title>Introduction</title>
            <para>
                <code>Zend_Cache_Frontend_Function</code> caches the results of function calls. It has
                a single main method named <code>call()</code> which takes a function name and parameters
                for the call in an array.
            </para>
        </sect3>
        <sect3 id="zend.cache.frontends.function.options">
            <title>Available options</title>
            <table id="zend.cache.frontends.function.options.table">
                <title>Function frontend options</title>
                <tgroup cols="4">
                     <thead>
                          <row>
                            <entry>Option</entry>
                            <entry>Data Type</entry>
                            <entry>Default Value</entry>
                            <entry>Description</entry>
                        </row>
                     </thead>
                     <tbody>
                          <row>
                              <entry><code>cache_by_default</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>true</code></entry>
                              <entry>
                                  if true, function calls will be cached by default
                              </entry>
                         </row>
                         <row>
                              <entry><code>cached_functions</code></entry>
                              <entry><code>array</code></entry>
                              <entry></entry>
                              <entry>
                                  function names which will always be cached
                              </entry>
                         </row>
                         <row>
                              <entry><code>non_cached_functions</code></entry>
                              <entry><code>array</code></entry>
                              <entry></entry>
                              <entry>
                                  function names which must never be cached
                              </entry>
                         </row>
                      </tbody>
                  </tgroup>
              </table>
        </sect3>

        <sect3 id="zend.cache.frontends.function.examples">
            <title>Examples</title>
            <para>
                Using the <code>call()</code> function is the same as using
                <code>call_user_func_array()</code> in PHP:
            </para>
            <programlisting role="php"><![CDATA[<?php
$cache->call('veryExpensiveFunc', $params);

# $params is an array
# for example to call (with caching) veryExpensiveFunc(1, 'foo', 'bar'), you will use
# $cache->call('veryExpensiveFunc', array(1, 'foo', 'bar'))]]>
            </programlisting>
            <para>
                <code>Zend_Cache_Frontend_Function</code> is smart enough to cache both the
                return value of the function and its internal output.
            </para>
            <note><para>
                You can pass any builtin or user defined function with the exception of
                <code>array()</code>, <code>echo()</code>, <code>empty()</code>, <code>eval()</code>,
                <code>exit()</code>, <code>isset()</code>, <code>list()</code>, <code>print()</code>
                and <code>unset()</code>.
            </para></note>
        </sect3>
    </sect2>

    <sect2 id="zend.cache.frontends.class">
        <title>Zend_Cache_Frontend_Class</title>
        <sect3 id="zend.cache.frontends.class.introduction">
            <title>Introduction</title>
            <para>
                <code>Zend_Cache_Frontend_Class</code> is different from <code>Zend_Cache_Frontend_Function</code>
                because it allows caching of object and static method calls.
            </para>
        </sect3>
        <sect3 id="zend.cache.frontends.class.options">
            <title>Available options</title>
            <table id="zend.cache.frontends.class.options.table">
                <title>Class frontend options</title>
                <tgroup cols="4">
                     <thead>
                          <row>
                            <entry>Option</entry>
                            <entry>Data Type</entry>
                            <entry>Default Value</entry>
                            <entry>Description</entry>
                        </row>
                     </thead>
                     <tbody>
                          <row>
                              <entry><code>cached_entity</code> (required)</entry>
                              <entry><code>mixed</code></entry>
                              <entry></entry>
                              <entry>
                                  if set to a class name, we will cache an abstract class and will use
                                  only static calls; if set to an object, we will cache this object methods
                              </entry>
                         </row>
                         <row>
                              <entry><code>cache_by_default</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>true</code></entry>
                              <entry>
                                  if true, calls will be cached by default
                              </entry>
                         </row>
                         <row>
                              <entry><code>cached_methods</code></entry>
                              <entry><code>array</code></entry>
                              <entry></entry>
                              <entry>
                                  method names which will always be cached
                              </entry>
                         </row>
                         <row>
                              <entry><code>non_cached_methods</code></entry>
                              <entry><code>array</code></entry>
                              <entry></entry>
                              <entry>
                                  method names which must never be cached
                              </entry>
                         </row>
                      </tbody>
                  </tgroup>
              </table>
        </sect3>

        <sect3 id="zend.cache.frontends.class.examples">
            <title>Examples</title>
            <para>
                For example, to cache static calls :
            </para>
            <programlisting role="php"><![CDATA[<?php
class test {

    # Static method
    public static function foobar($param1, $param2) {
        echo "foobar_output($param1, $param2)";
        return "foobar_return($param1, $param2)";
    }

}

// [...]
$frontendOptions = array(
    'cached_entity' => 'test' // The name of the class
);
// [...]

# The cached call
$res = $cache->foobar('1', '2');]]>
            </programlisting>
            <para>
                To cache classic method calls :
            </para>
            <programlisting role="php"><![CDATA[<?php
class test {

    private $_string = 'hello !';

    public function foobar2($param1, $param2) {
        echo($this->_string);
        echo "foobar2_output($param1, $param2)";
        return "foobar2_return($param1, $param2)";
    }

}

// [...]
$frontendOptions = array(
    'cached_entity' => new test() // An instance of the class
);
// [...]

# The cached call
$res = $cache->foobar2('1', '2');]]>
            </programlisting>
        </sect3>
    </sect2>

    <sect2 id="zend.cache.frontends.file">
        <title>Zend_Cache_Frontend_File</title>
        <sect3 id="zend.cache.frontends.file.introduction">
            <title>Introduction</title>
            <para>
                <code>Zend_Cache_Frontend_File</code> is a frontend driven by the
                modification time of a "master file". It's really interesting for examples
                in configuration or templates issues.
            </para>
            <para>
                For instance, you have an XML configuration file which is parsed by a function
                which returns a "config object" (like with <code>Zend_Config</code>). With
                <code>Zend_Cache_Frontend_File</code>, you can store the "config object" into
                cache (to avoid the parsing of the XML config file at each time) but with a
                sort of strong dependency on the "master file". So, if the XML config file
                is modified, the cache is immediatly invalidated.
            </para>
        </sect3>
        <sect3 id="zend.cache.frontends.file.options">
            <title>Available options</title>
            <table id="zend.cache.frontends.file.options.table">
                <title>File frontend options</title>
                <tgroup cols="4">
                     <thead>
                          <row>
                            <entry>Option</entry>
                            <entry>Data Type</entry>
                            <entry>Default Value</entry>
                            <entry>Description</entry>
                        </row>
                     </thead>
                     <tbody>
                          <row>
                              <entry><code>master_file (mandatory)</code></entry>
                              <entry><code>string</code></entry>
                              <entry><code></code></entry>
                              <entry>
                                  the complete path and name of the master file
                              </entry>
                         </row>
                      </tbody>
                  </tgroup>
              </table>
        </sect3>
        <sect3 id="zend.cache.frontends.file.examples">
            <title>Examples</title>
            <para>
                Use of this frontend is the same than of <code>Zend_Cache_Core</code>. There
                is no need of a specific example - the only thing to do is to
                define the <code>master_file</code> when using the factory.
            </para>
        </sect3>
    </sect2>

    <sect2 id="zend.cache.frontends.page">
        <title>Zend_Cache_Frontend_Page</title>
        <sect3 id="zend.cache.frontends.page.introduction">
            <title>Introduction</title>
            <para>
                <code>Zend_Cache_Frontend_Page</code> is like <code>Zend_Cache_Frontend_Output</code>
                but designed for a complete page. It's impossible to use <code>Zend_Cache_Frontend_Page</code>
                for caching only a single block.
            </para>
            <para>
                On the other hand, the "cache id" is calculated automatically with
                <code>$_SERVER['REQUEST_URI']</code> and (depending on options)
                <code>$_GET</code>, <code>$_POST</code>, <code>$_SESSION</code>, <code>$_COOKIE</code>, <code>$_FILES</code>.
                More over, you have only one method to call (<code>start()</code>) because the
                <code>end()</code> call is fully automatic when the page is ended.
            </para>
            <para>
                For the moment, it's not implemented but we plan to add a HTTP conditional system
                to save bandwith (the system will send a HTTP 304 Not Modified if the cache is hit
                and if the browser has already the good version).
            </para>
        </sect3>
        <sect3 id="zend.cache.frontends.page.options">
            <title>Available options (for this frontend in Zend_Cache factory)</title>
            <table id="zend.cache.frontends.page.options.table">
                <title>Page frontend options</title>
                <tgroup cols="4">
                     <thead>
                          <row>
                            <entry>Option</entry>
                            <entry>Data Type</entry>
                            <entry>Default Value</entry>
                            <entry>Description</entry>
                        </row>
                     </thead>
                     <tbody>
                          <row>
                              <entry><code>http_conditional</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>false</code></entry>
                              <entry>
                                  use the http_conditional system (not implemented for the moment)
                              </entry>
                         </row>
                         <row>
                              <entry><code>debug_header</code></entry>
                              <entry><code>boolean</code></entry>
                              <entry><code>false</code></entry>
                              <entry>
                                  if true, a debug text is added before each cached pages
                              </entry>
                         </row>
                         <row>
                               <entry><code>default_options</code></entry>
                              <entry><code>array</code></entry>
                              <entry><code>array(...see below...)</code></entry>
                              <entry>
                                  an associative array of default options :
                                  <itemizedlist>
                                      <listitem>
                                          <para>
                                              <code>(boolean, true by default) cache</code> :
                                              cache is on if true
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, false by default) cache_with_get_variables</code> :
                                              if true, cache is still on even if there are some variables in
                                              <code>$_GET</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, false by default) cache_with_post_variables</code> :
                                              if true, cache is still on even if there are some variables in
                                              <code>$_POST</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, false by default) cache_with_session_variables</code> :
                                              if true, cache is still on even if there are some variables in
                                              <code>$_SESSION</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, false by default) cache_with_files_variables</code> :
                                              if true, cache is still on even if there are some variables in
                                              <code>$_FILES</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, false by default) cache_with_cookie_variables</code> :
                                              if true, cache is still on even if there are some variables in
                                              <code>$_COOKIE</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, true by default) make_id_with_get_variables</code> :
                                              if true, the cache id will be dependent of the content of the
                                              <code>$_GET</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, true by default) make_id_with_post_variables</code> :
                                              if true, the cache id will be dependent of the content of the
                                              <code>$_POST</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, true by default) make_id_with_session_variables</code> :
                                              if true, the cache id will be dependent of the content of the
                                              <code>$_SESSION</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, true by default) make_id_with_files_variables</code> :
                                              if true, the cache id will be dependent of the content of the
                                              <code>$_FILES</code> array
                                          </para>
                                      </listitem>
                                      <listitem>
                                          <para>
                                              <code>(boolean, true by default) make_id_with_cookie_variables</code> :
                                              if true, the cache id will be dependent of the content of the
                                              <code>$_COOKIE</code> array
                                          </para>
                                      </listitem>
                                  </itemizedlist>
                              </entry>
                         </row>
                         <row>
                              <entry><code>regexps</code></entry>
                              <entry><code>array</code></entry>
                              <entry><code>array()</code></entry>
                              <entry>
                                    an associative array to set options only for some REQUEST_URI, keys are (PCRE) regexps, values are
                                    associative arrays with specific options to set if the regexp matchs on $_SERVER['REQUEST_URI']
                                  (see default_options for the list of available options) ; if several regexps match the $_SERVER['REQUEST_URI'],
                                  only the last one will be used
                              </entry>
                         </row>
                      </tbody>
                  </tgroup>
              </table>
        </sect3>
        <sect3 id="zend.cache.frontends.page.examples">
            <title>Examples</title>
            <para>
                Use of Zend_Cache_Frontend_Page is really trivial :
            </para>
            <programlisting role="php"><![CDATA[<?php
// [...] // require, configuration and factory

$cache->start();
// if the cache is hit, the result is sent to the browser and the script stop here

// rest of the page ...]]>
            </programlisting>
            <para>
                a more complex example which shows a way to get a centralized cache management in a bootstrap file
                (for using with Zend_Controller for example)
            </para>
            <programlisting role="php"><![CDATA[<?php

// [...] you should avoid to put too much lines before the cache section
// [...] for example, for optimal performances, "require_once" or "Zend_Loader::loadClass" should be
// [...] after the cache section

require_once 'Zend/Cache.php';

$frontendOptions = array(
   'lifetime' => 7200,
   'debug_header' => true, // for debugging
   'regexps' => array(
       '^/$' => array('cache' => true),         // cache the whole IndexController
       '^/index/' => array('cache' => true),    // cache the whole IndexController
       '^/article/' => array('cache' => false), // we don't cache the ArticleController...
       '^/article/view/' => array(              // ...but we cache the "view" action of
           'cache' => true,                     // this ArticleController
           'cache_with_post_variables' => true,    // and we cache even there are some variables in $_POST
           'make_id_with_post_variables' => true,   // (but the cache will be dependent of the $_POST array)
       )
   )
);
$backendOptions = array(
    'cache_dir' => '/tmp/'
);

// getting a Zend_Cache_Frontend_Page object
$cache = Zend_Cache::factory('Page', 'File', $frontendOptions, $backendOptions);

$cache->start();
// if the cache is hit, the result is sent to the browser and the script stop here

// [...] the end of the bootstrap file (these lines won't be executed if the cache is hit)]]>
            </programlisting>
        </sect3>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.cache.introduction">
    <title>Introduction</title>
    <para>
        <code>Zend_Cache</code> provides a generic way to cache any data.
    </para>
    <para>
      Caching in Zend Framework is operated by frontends while cache records are stored through backend adapters
      (<code>File</code>, <code>Sqlite</code>, <code>Memcache</code>...) through a flexible
      system of IDs and tags. Using those, it is easy to delete specific types of records afterwards
      (for example: "delete all cache records marked with a given tag").
    </para>
    <para>
        The core of the module (<code>Zend_Cache_Core</code>) is generic, flexible and configurable.
        Yet, for your specific needs there are cache frontends that extend <code>Zend_Cache_Core</code>
        for convinience: <code>Output</code>, <code>File</code>, <code>Function</code> and <code>Class</code>.
    </para>
    <example id="zend.cache.introduction.example-1">
        <title>Getting a frontend with <code>Zend_Cache::factory()</code></title>
        <para>
            <code>Zend_Cache::factory()</code> instantiates correct objects and ties them together.
            In this first example, we will use <code>Core</code> frontend together with <code>File</code>
            backend.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Cache.php';

$frontendOptions = array(
   'lifetime' => 7200, // cache lifetime of 2 hours
   'automatic_serialization' => true
);

$backendOptions = array(
    'cache_dir' => './tmp/' // Directory where to put the cache files
);

// getting a Zend_Cache_Core object
$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);]]>
        </programlisting>
    </example>

    <note>
        <title>Frontends and Backends consisting of multiple words</title>
        <para>
            Some frontends and backends are named using multiple words, such
            as 'ZendPlatform'. When specifying them to the factory, separate
            them using a word separator, such as a space (' '), hyphen
            ('-'), or period ('.').
        </para>
    </note>

    <example id="zend.cache.introduction.example-2">
        <title>Caching a database query result</title>

        <para>
            Now that we have a frontend, we can cache any type of data (we turned on serialization). For
            example, we can cache a result from a very expensive database query. After it is cached, there
            is no need to even connect to the database; records are fetched from cache and unserialized.
        </para>

        <programlisting role="php"><![CDATA[<?php
// $cache initialized in previous example

// see if a cache already exists:
if(!$result = $cache->load('myresult')) {

    // cache miss; connect to the database

    $db = Zend_Db::factory( [...] );

    $result = $db->fetchAll('SELECT * FROM huge_table');

    $cache->save($result, 'myresult');

} else {

    // cache hit! shout so that we know
    echo "This one is from cache!\n\n";

}

print_r($result);]]>
        </programlisting>
    </example>

    <example id="zend.cache.introduction.example-3">
        <title>Caching output with <code>Zend_Cache</code> output frontend</title>
        <para>
            We 'mark up' sections in which we want to cache output by adding some conditional logic,
            encapsulating the section within <code>start()</code> and <code>end()</code> methods (this
            resembles the first example and is the core strategy for caching).
        </para><para>
            Inside, output your data as usual - all output will be cached when execution hits the <code>end()</code>
            method. On the next run, the whole section will be skipped in favor of fetching data from cache
            (as long as the cache record is valid).
        </para>
        <programlisting role="php"><![CDATA[<?php
$frontendOptions = array(
   'lifetime' => 30,                  // cache lifetime of half a minute
   'automatic_serialization' => false  // this is default anyway
);

$backendOptions = array('cache_dir' => './tmp/');

$cache = Zend_Cache::factory('Output', 'File', $frontendOptions, $backendOptions);

// we pass a unique identifier to the start() method
if(!$cache->start('mypage')) {
    // output as usual:

    echo 'Hello world! ';
    echo 'This is cached ('.time().') ';

    $cache->end(); // the output is saved and sent to the browser
}

echo 'This is never cached ('.time().').';]]>
       </programlisting>
       <para>
           Notice that we output the result of <code>time()</code> twice; this is something dynamic
           for demonstration purposes. Try running this and then refreshing several times; you will notice
           that the first number doesn't change while second changes as time passes. That is because the first
           number was output in the cached section and is saved among other output.
           After half a minute (we've set lifetime to 30 seconds) the
           numbers should match again because the cache record expired -- only to be cached again. You
           should try this in your brower or console.
       </para>
    </example>
    <note><para>
        When using Zend_Cache, pay attention to the important cache identifier (passed to <code>save()</code>
        and <code>start()</code>). It must be unique for every resource you cache, otherwise unrelated
        cache records may wipe each other or, even worse, be displayed in place of the other.
    </para></note>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.cache.theory">
    <title>The theory of caching</title>
    <para>
        There are three key concepts in Zend_Cache. One is the unique indentifier (a string) that is used
        to identify cache records. The second one is the <code>'lifetime'</code> directive as seen in the
        examples; it defines for how long the cached resource is considered 'fresh'. The third key concept
        is conditional execution so that parts of your code can be skipped entirely, boosting performance.
        The main frontend function (eg. <code>Zend_Cache_Core::get()</code>) is always designed to return
        false for a cache miss if that makes sense for the nature of a frontend. That enables end-users to
        wrap parts of the code they would like to cache (and skip) in <code>if(){ ... }</code> statements where
        the condition is a Zend_Cache method itself. On the end if these blocks you must save what you've
        generated, however (eg. <code>Zend_Cache_Core::save()</code>).
    </para>
    <note><para>
        The conditional execution design of your generating code is not necessary in some frontends
        (<code>Function</code>, for an example) when the whole logic is implemented inside the frontend.
    </para></note>
    <note><para>
        'Cache hit' is a term for a condition when a cache record is found, is valid and is 'fresh' (in other
        words hasn't expired yet). 'Cache miss' is everything else. When a cache miss happens, you must
        generate your data (as you would normally do) and have it cached. When you have a cache hit, on the
        other hand, the backend automatically fetches the record from cache transparently.
    </para></note>
    <sect2 id="zend.cache.factory">
        <title>The <code>Zend_Cache</code> factory method</title>
        <para>
            A good way to build a usable instance of a <code>Zend_Cache</code> Frontend is given
            in the following example :
        </para>
        <programlisting role="php"><![CDATA[<?php
# We "load" the Zend_Cache factory
require 'Zend/Cache.php';

# We choose a backend (for example 'File' or 'Sqlite'...)
$backendName = '[...]';

# We choose a frontend (for example 'Core', 'Output', 'Page'...)
$frontendName = '[...]';

# We set an array of options for the choosen frontend
$frontendOptions = array([...]);

# We set an array of options for the choosen backend
$backendOptions = array([...]);

# We make the good instance
# (of course, the two last arguments are optional)
$cache = Zend_Cache::factory($frontendName, $backendName, $frontendOptions, $backendOptions);]]>
        </programlisting>
        <para>
            In the following examples we will assume that the <code>$cache</code> variable holds a
            valid, instantiated frontend as shown and that you understand how to pass parametres
            to your chosen backends.
        </para>
        <note><para>
            Always use <code>Zend_Cache::factory()</code> to get frontend instances. Instantiating
            frontends and backends yourself will not work as expected.
        </para></note>
    </sect2>

    <sect2 id="zend.cache.tags">
        <title>Tagging records</title>
        <para>
            Tags are a way to categorize cache records. When you save a cache with the <code>save()</code>
            method, you can set an array of tags to apply for this record. Then you will be
            able to clean all cache records tagged with a given tag (or tags):
        </para>
        <programlisting role="php"><![CDATA[<?php
$cache->save($huge_data, 'myUniqueID', array('tagA', 'tagB', 'tagC'));]]>
        </programlisting>
        <note><para>
            note than the <code>save()</code> method accepts an optional fourth argument : <code>$specificLifetime</code>
            (if != false, it sets a specific lifetime for this particular cache record)
        </para></note>
    </sect2>
    <sect2 id="zend.cache.clean">
        <title>Cleaning the cache</title>
        <para>
            To remove/invalidate in particular cache id, you can use the <code>remove()</code>
            method :
        </para>
        <programlisting role="php"><![CDATA[<?php
$cache->remove('idToRemove');]]>
        </programlisting>
        <para>
            To remove/invalidate several cache ids in one operation, you can use the <code>clean()</code>
            method. For example to remove all cache records :
        </para>
        <programlisting role="php"><![CDATA[<?php
// clean all records
$cache->clean(Zend_Cache::CLEANING_MODE_ALL);

// clean only outdated
$cache->clean(Zend_Cache::CLEANING_MODE_OLD);]]>
        </programlisting>
        <para>
            If you want to remove cache entries matching the tags 'tagA' and 'tagC':
        </para>
        <programlisting role="php"><![CDATA[<?php
$cache->clean(Zend_Cache::CLEANING_MODE_MATCHING_TAG, array('tagA', 'tagC'));]]>
        </programlisting>
        <para>
            Available cleaning modes are: <code>CLEANING_MODE_ALL</code>, <code>CLEANING_MODE_OLD</code>,
            <code>CLEANING_MODE_MATCHING_TAG</code> and <code>CLEANING_MODE_NOT_MATCHING_TAG</code>. The
            latter are, as their names suggest, combined with an array of tags in cleaning operations.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.config.introduction">
    <title>Introduction</title>
    <para>
        <code>Zend_Config</code> is designed to simplify access to and use of configuration data within applications.
        It provides a nested object property based user interface for accessing such configuration data within
        application code. The configuration data may come from a variety of media supporting hierarchical data storage.
        Currently <code>Zend_Config</code> provides adapters for configuration data that are stored in text files with
        <link linkend="zend.config.adapters.ini"><code>Zend_Config_Ini</code></link> and
        <link linkend="zend.config.adapters.xml"><code>Zend_Config_Xml</code></link>.
    </para>
    <example id="zend.config.introduction.example.using">
        <title>Using Zend_Config Per Se</title>
        <para>
            Normally it is expected that users would use one of the adapter classes such as
            <link linkend="zend.config.adapters.ini"><code>Zend_Config_Ini</code></link> or
            <link linkend="zend.config.adapters.xml"><code>Zend_Config_Xml</code></link>, but if configuration data are
            available in a PHP array, one may simply pass the data to the <code>Zend_Config</code> constructor in order
            to utilize a simple object-oriented interface:
        </para>
        <programlisting role="php"><![CDATA[<?php
// Given an array of configuration data
$configArray = array(
    'webhost'  => 'www.example.com',
    'database' => array(
        'adapter' => 'pdo_mysql',
        'params'  => array(
            'host'     => 'db.example.com',
            'username' => 'dbuser',
            'password' => 'secret',
            'dbname'   => 'mydatabase'
        )
    )
);

// Create the object-oriented wrapper upon the configuration data
require_once 'Zend/Config.php';
$config = new Zend_Config($configArray);

// Print a configuration datum (results in 'www.example.com')
echo $config->webhost;

// Use the configuration data to connect to the database
$db = Zend_Db::factory($config->database->adapter,
                       $config->database->params->toArray());

// Alternative usage: simply pass the Zend_Config object.
// The Zend_Db factory knows how to interpret it.
$db = Zend_Db::factory($config->database);]]>
        </programlisting>
    </example>
    <para>
        As illustrated in the example above, <code>Zend_Config</code> provides nested object property syntax to access
        configuration data passed to its constructor.
    </para>
    <para>
        Along with the object oriented access to the data values, <code>Zend_Config</code> also has <code>get()</code>
        which will return the supplied default value if the data element doesn't exist. For example:
    </para>
    <programlisting role="php"><![CDATA[<?php
$host = $config->database->get('host', 'localhost');]]>
    </programlisting>
    <example id="zend.config.introduction.example.file.php">
        <title>Using Zend_Config with a PHP Configuration File</title>
        <para>
            It is often desirable to use a pure PHP-based configuration file. The following code illustrates how easily
            this can be accomplished:
        </para>
        <programlisting role="php"><![CDATA[<?php
// config.php
return array(
    'webhost'  => 'www.example.com',
    'database' => array(
        'adapter' => 'pdo_mysql',
        'params'  => array(
            'host'     => 'db.example.com',
            'username' => 'dbuser',
            'password' => 'secret',
            'dbname'   => 'mydatabase'
        )
    )
);]]></programlisting>
        <programlisting role="php"><![CDATA[<?php
// Configuration consumption
require_once 'Zend/Config.php';
$config = new Zend_Config(require 'config.php');

// Print a configuration datum (results in 'www.example.com')
echo $config->webhost;]]></programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.config.theory_of_operation">
    <title>Theory of Operation</title>
    <para>
        Configuration data are made accessible to the <code>Zend_Config</code> constructor
        through an associative array, which may be multidimensional, in order to support
        organizing the data from general to specific. Concrete adapter classes function
        to adapt configuration data from storage to produce the associative array for the
        <code>Zend_Config</code> constructor. User scripts may provide such arrays directly
        to the <code>Zend_Config</code> constructor, without using an adapter class, since
        it may be appropriate to do so in certain situations.
    </para>
    <para>
        Each configuration data array value becomes a property of the <code>Zend_Config</code> object. The key is used
        as the property name. If a value is itself an array, then the resulting object property is created as a new
        <code>Zend_Config</code> object, loaded with the array data. This occurs recursively, such that a hierarchy of
        configuration data may be created with any number of levels.
    </para>
    <para>
        <code>Zend_Config</code> implements the <code>Countable</code> and <code>Iterator</code>
        interfaces in order to facilitate simple access to configuration data.
        Thus, one may use the <ulink url="http://php.net/count"><code>count()</code></ulink>
        function and PHP constructs such as
        <ulink url="http://php.net/foreach"><code>foreach</code></ulink> upon
        <code>Zend_Config</code> objects.
    </para>
    <para>
        By default, configuration data made available through <code>Zend_Config</code>
        are read-only, and an assignment (e.g.,
        <code><![CDATA[$config->database->host = 'example.com']]></code>)
        results in a thrown exception. This default behavior may be overridden through the constructor,
        however, to allow modification of data values. Also, when modifications are allowed, <code>Zend_Config</code>
        supports unsetting of values (i.e. <code><![CDATA[unset($config->database->host);]]></code>).
        <note>
            <para>
                It is important not to confuse such in-memory modifications with saving configuration
                data out to specific storage media. Tools for creating and modifying configuration
                data for various storage media are out of scope with respect to <code>Zend_Config</code>.
                Third-party open source solutions are readily available for the purpose of creating and
                modifying configuration data for various storage media.
            </para>
        </note>
    </para>
    <para>
        Adapter classes inherit from the <code>Zend_Config</code> class since they utilize its functionality.
    </para>
    <para>
        The <code>Zend_Config</code> family of classes enables configuration data to be
        organized into sections. <code>Zend_Config</code> adapter objects may be loaded
        with a single specified section, multiple specified sections, or all sections
        (if none are specified).
    </para>
    <para>
        <code>Zend_Config</code> adapter classes support a single inheritance model that
        enables configuration data to be inherited from one section of configuration data
        into another. This is provided in order to reduce or eliminate the need for
        duplicating configuration data for different purposes. An inheriting section
        may also override the values that it inherits through its parent section.
        Like PHP class inheritance, a section may inherit from a parent section,
        which may inherit from a grandparent section, and so on, but multiple inheritance
        (i.e., section C inheriting directly from parent sections A and B) is not supported.
    </para>
    <para>
        If you have two <code>Zend_Config</code> objects, you can merge them into a single
        object using the <code>merge()</code> function. For example, given <code>$config</code> and
        <code>$localConfig</code>, you can merge data from <code>$localConfig</code> to <code>$config</code> using
        <code>$config->merge($localConfig);</code>. The items in <code>$localConfig</code> will override
        any items with the same name in <code>$config</code>.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.config.adapters.ini">
    <title>Zend_Config_Ini</title>
    <para>
        <code>Zend_Config_Ini</code> enables developers to store configuration data in a familiar INI format and read
        them in the application by using nested object property syntax. The INI format is specialized to provide both
        the ability to have a hierarchy of configuration data keys and inheritance between configuration data sections.
        Configuration data hierarchies are supported by separating the keys with the dot or period character
        (<code>.</code>). A section may extend or inherit from another section by following the section name with a
        colon character (<code>:</code>) and the name of the section from which data are to be inherited.
    </para>
    <note>
        <title>parse_ini_file</title>
        <para>
            <code>Zend_Config_Ini</code> utilizes the
            <ulink url="http://php.net/parse_ini_file"><code>parse_ini_file()</code></ulink>
            PHP function. Please review this documentation to be aware of its specific behaviors,
            which propagate to <code>Zend_Config_Ini</code>, such as how the special values of
            <code>true</code>, <code>false</code>, <code>yes</code>, <code>no</code>,
            and <code>null</code> are handled.
        </para>
    </note>
    <note>
        <title>Key Separator</title>
        <para>
            By default, the key separator character is the period character (<code>.</code>). This can be changed,
            however, by changing the <code>$options</code> key <code>'nestSeparator'</code> when constructing the
            <code>Zend_Config_Ini</code> object. For example:
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Config/Ini.php';
$options['nestSeparator'] = ':';
$config = new Zend_Config_Ini('/path/to/config.ini', 'staging', $options);]]>
            </programlisting>
        </para>
    </note>
    <example id="zend.config.adapters.ini.example.using">
        <title>Using Zend_Config_Ini</title>
        <para>
            This example illustrates a basic use of <code>Zend_Config_Ini</code> for loading configuration data from an
            INI file. In this example there are configuration data for both a production system and for a staging
            system. Because the staging system configuration data are very similar to those for production, the staging
            section inherits from the production section. In this case, the decision is arbitrary and could have been
            written conversely, with the production section inheriting from the staging section, though this may not be
            the case for more complex situations. Suppose, then, that the following configuration data are contained in
            <code>/path/to/config.ini</code>:
        </para>
        <programlisting role="ini"><![CDATA[; Production site configuration data
[production]
webhost                  = www.example.com
database.adapter         = pdo_mysql
database.params.host     = db.example.com
database.params.username = dbuser
database.params.password = secret
database.params.dbname   = dbname

; Staging site configuration data inherits from production and
; overrides values as necessary
[staging : production]
database.params.host     = dev.example.com
database.params.username = devuser
database.params.password = devsecret]]>
        </programlisting>
        <para>
            Next, assume that the application developer needs the staging configuration data from the INI file. It is a
            simple matter to load these data by specifying the INI file and the staging section:
        </para>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Config/Ini.php';

$config = new Zend_Config_Ini('/path/to/config.ini', 'staging');

echo $config->database->params->host;   // prints "dev.example.com"
echo $config->database->params->dbname; // prints "dbname"]]>
        </programlisting>
    </example>
    <note>
    <table id="zend.config.adapters.ini.table">
        <title>Zend_Config_Ini Constructor parameters</title>
        <tgroup cols="2">
            <thead>
                  <row>
                    <entry>Parameter</entry>
                    <entry>Notes</entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry><code>$filename</code></entry>
                    <entry>The INI file to load.</entry>
                </row>
                <row>
                    <entry><code>$section</code></entry>
                    <entry>The [section] within the ini file that is to be loaded. Setting
                        this parameter to null will load all sections. Alternatively, an
                        array of section names may be supplied to load multiple sections.</entry>
                </row>
                <row>
                    <entry><code>$options = false</code></entry>
                    <entry>Options array. The following keys are supported:
                        <itemizedlist>
                            <listitem><para><emphasis>allowModifications</emphasis>: Set to true to allow subsequent modification of loaded file. Defaults to false</para></listitem>
                            <listitem><para><emphasis>nestSeparator</emphasis>: Set to the character to be used as the nest separator. Defaults to "."</para></listitem>
                        </itemizedlist>
                    </entry>
                </row>
            </tbody>
        </tgroup>
    </table>
    </note>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.config.adapters.xml">
    <title>Zend_Config_Xml</title>
    <para>
        <code>Zend_Config_Xml</code> enables developers to store configuration data in a simple XML format and read them
        via nested object property syntax. The root element of the XML file is irrelevant and may be named arbitrarily.
        The first level of XML elements correspond with configuration data sections. The XML format supports
        hierarchical organization through nesting of XML elements below the section-level elements. The content of a
        leaf-level XML element corresponds to the value of a configuration datum. Section inheritance is supported by a
        special XML attribute named <code>extends</code>, and the value of this attribute corresponds with the section
        from which data are to be inherited by the extending section.
    </para>
    <note>
        <title>Return type</title>
        <para>
            Configuration data read into <code>Zend_Config_Xml</code> are always returned as strings.
            Conversion of data from strings to other types is left to developers to suit their particular needs.
        </para>
    </note>
    <example id="zend.config.adapters.xml.example.using">
        <title>Using Zend_Config_Xml</title>
        <para>
            This example illustrates a basic use of <code>Zend_Config_Xml</code> for loading configuration data from an
            XML file. In this example there are configuration data for both a production system and for a staging
            system. Because the staging system configuration data are very similar to those for production, the staging
            section inherits from the production section. In this case, the decision is arbitrary and could have been
            written conversely, with the production section inheriting from the staging section, though this may not be
            the case for more complex situations. Suppose, then, that the following configuration data are contained in
            <code>/path/to/config.xml</code>:
        </para>
        <programlisting role="xml"><![CDATA[<?xml version="1.0"?>
<configdata>
    <production>
        <webhost>www.example.com</webhost>
        <database>
            <adapter>pdo_mysql</adapter>
            <params>
                <host>db.example.com</host>
                <username>dbuser</username>
                <password>secret</password>
                <dbname>dbname</dbname>
            </params>
        </database>
    </production>
    <staging extends="production">
        <database>
            <params>
                <host>dev.example.com</host>
                <username>devuser</username>
                <password>devsecret</password>
            </params>
        </database>
    </staging>
</configdata>]]>
        </programlisting>
        <para>
            Next, assume that the application developer needs the staging configuration data from the XML file. It is a
            simple matter to load these data by specifying the XML file and the staging section:
        </para>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Config/Xml.php';

$config = new Zend_Config_Xml('/path/to/config.xml', 'staging');

echo $config->database->params->host;   // prints "dev.example.com"
echo $config->database->params->dbname; // prints "dbname"]]>
        </programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.console.getopt.configuration">
    <title>Configuring Zend_Console_Getopt</title>

    <sect2 id="zend.console.getopt.configuration.addrules">
        <title>Adding Option Rules</title>
        <para>
            You can add more option rules in addition to those you specified
            in the <code>Zend_Console_Getopt</code> constructor, using the
            <code>addRules()</code> method.  The argument to
            <code>addRules()</code> is the same as the first argument to the
            class constructor.  It is either a string in the format of the
            short syntax options specification, or else an associative array
            in the format of a long syntax options specification.
            See <link linkend="zend.console.getopt.rules">Declaring Getopt Rules</link>
            for details on the syntax for specifying options.
        </para>
        <example id="zend.console.getopt.configuration.addrules.example">
            <title>Using addRules()</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
$opts->addRules(
  array(
    'verbose|v' => 'Print verbose output'
  )
);]]>
            </programlisting>
        </example>
        <para>
            The example above shows adding the "<code>--verbose</code>" option
            with an alias of "<code>-v</code>" to a set of options
            defined in the call to the constructor.  Notice that you can mix
            short format options and long format options in the same instance
            of <code>Zend_Console_Getopt</code>.
        </para>
    </sect2>

    <sect2 id="zend.console.getopt.configuration.addhelp">
        <title>Adding Help Messages</title>
        <para>
            In addition to specifying the help strings when declaring option
            rules in the long format, you can associate help strings
            with option rules using the <code>setHelp()</code>
            method.  The argument to the <code>setHelp()</code> method is an
            associative array, in which the key is a flag, and the value is a
            corresponding help string.
        </para>
        <example id="zend.console.getopt.configuration.addhelp.example">
            <title>Using setHelp()</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
$opts->setHelp(
    array(
        'a' => 'This option chooses apple, with no parameter',
        'b' => 'This option chooses banana, with required integer parameter',
        'p' => 'This option chooses pear, with optional string parameter'
    )
);]]>
            </programlisting>
        </example>
        <para>
            If you declared options with aliases, you can use any of the
            aliases as the key of the associative array.
        </para>
        <para>
            The <code>setHelp()</code> method is the only way to define help
            strings if you declared the options using the short syntax.
        </para>
    </sect2>

    <sect2 id="zend.console.getopt.configuration.addaliases">
        <title>Adding Option Aliases</title>
        <para>
            You can declare aliases for options using the <code>setAliases</code>
            method.  The argument is an associative array, whose key is
            a flag string declared previously, and whose value is a new
            alias for that flag.  These aliases are merged with any existing
            aliases.  In other words, aliases you declared earlier are
            still in effect.
        </para>
        <para>
            An alias may be declared only once.  If you try to redefine
            an alias, a <code>Zend_Console_Getopt_Exception</code> is thrown.
        </para>
        <example id="zend.console.getopt.configuration.addaliases.example">
            <title>Using setAliases()</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
$opts->setAliases(
    array(
        'a' => 'apple',
        'a' => 'apfel',
        'p' => 'pear'
    )
);]]>
            </programlisting>
        </example>
        <para>
            In the example above, after declaring these aliases,
            "<code>-a</code>", "<code>--apple</code>" and
            "<code>--apfel</code>" are aliases for each other.
            Also "<code>-p</code>" and "<code>--pear</code>" are aliases
            for each other.
        </para>
        <para>
            The <code>setAliases()</code> method is the only way to define aliases
            if you declared the options using the short syntax.
        </para>
    </sect2>

    <sect2 id="zend.console.getopt.configuration.addargs">
        <title>Adding Argument Lists</title>
        <para>
            By default, <code>Zend_Console_Getopt</code> uses
            <code>$_SERVER['argv']</code> for the array of command-line
            arguments to parse.  You can alternatively specify the array of
            arguments as the second constructor argument.  Finally, you
            can append more arguments to those already used using the
            <code>addArguments()</code> method, or you can replace the current
            array of arguments using the <code>setArguments()</code> method.
            In both cases, the parameter to these methods is a simple array of
            strings.  The former method appends the array to the current
            arguments, and the latter method substitutes the array for the
            current arguments.
        </para>
        <example id="zend.console.getopt.configuration.addargs.example">
            <title>Using addArguments() and setArguments()</title>
            <programlisting role="php"><![CDATA[<?php
// By default, the constructor uses $_SERVER['argv']
$opts = new Zend_Console_Getopt('abp:');

// Append an array to the existing arguments
$opts->addArguments(array('-a', '-p', 'p_parameter', 'non_option_arg'));

// Substitute a new array for the existing arguments
$opts->setArguments(array('-a', '-p', 'p_parameter', 'non_option_arg'));]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.console.getopt.configuration.config">
        <title>Adding Configuration</title>
        <para>
            The third parameter to the <code>Zend_Console_Getopt</code>
            constructor is an array of configuration options that affect
            the behavior of the object instance returned. You can also
            specify configuration options using the <code>setOptions()</code>
            method, or you can set an individual option using the
            <code>setOption()</code> method.
        </para>
        <note>
            <title>Clarifying the term "option"</title>
            <para>
                The term "option" is used for configuration of the
                <code>Zend_Console_Getopt</code> class to match terminology
                used elsewhere in the Zend Framework.  These are not the same
                things as the command-line options that are parsed by
                the <code>Zend_Console_Getopt</code> class.
            </para>
        </note>
        <para>
            The currently supported
            options have const definitions in the class.  The options,
            their const identifiers (with literal values in parentheses)
            are listed below:
        </para>
        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Console_Getopt::CONFIG_DASHDASH</code> ("dashDash"),
                    if true, enables the special flag "<code>--</code>" to
                    signify the end of flags.  Command-line arguments following
                    the double-dash signifier are not interpreted as options,
                    even if the arguments start with a dash.  This configuration
                    option is true by default.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Console_Getopt::CONFIG_IGNORECASE</code> ("ignoreCase"),
                    if true, makes flags aliases of each other if they differ
                    only in their case.  That is, "<code>-a</code>" and
                    "<code>-A</code>" will be considered to be synonymous flags.
                    This configuration option is false by default.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Console_Getopt::CONFIG_RULEMODE</code>
                    ("ruleMode") may have values <code>Zend_Console_Getopt::MODE_ZEND</code>
                    ("zend") and <code>Zend_Console_Getopt::MODE_GNU</code>
                    ("gnu").  It should not be necessary to use this option
                    unless you extend the class with additional syntax forms.
                    The two modes supported in the base <code>Zend_Console_Getopt</code>
                    class are unambiguous.  If the specifier is a string, the
                    class assumes <code>MODE_GNU</code>, otherwise it assumes
                    <code>MODE_ZEND</code>.  But if you extend the class and
                    add more syntax forms, you may need to specify the mode
                    using this option.
                </para>
            </listitem>
        </itemizedlist>
        <para>
            More configuration options may be added as future enhancements
            of this class.
        </para>
        <para>
            The two arguments to the <code>setOption()</code> method are
            a configuration option name and an option value.
        </para>
        <example id="zend.console.getopt.configuration.config.example.setoption">
            <title>Using setOption()</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
$opts->setOption('ignoreCase', true);]]>
            </programlisting>
        </example>
        <para>
            The argument to the <code>setOptions()</code> method is
            an associative array.  The keys of this array are the configuration
            option names, and the values are configuration values.
            This is also the array format used in the class constructor.
            The configuration values you specify are merged with the current
            configuration; you don't have to list all options.
        </para>
        <example id="zend.console.getopt.configuration.config.example.setoptions">
            <title>Using setOptions()</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
$opts->setOptions(
    array(
        'ignoreCase' => true,
        'dashDash'   => false
    )
);]]>
            </programlisting>
        </example>
    </sect2>

</sect1>
<sect1 id="zend.console.getopt.fetching">
    <title>Fetching Options and Arguments</title>
    <para>
        After you have declared the options that the
        <code>Zend_Console_Getopt</code> object should recognize, and supply
        arguments from the command-line or an array, you can
        query the object to find out which options were specified by a user in
        a given command-line invocation of your program.  The class implements
        magic methods so you can query for options by name.
    </para>
    <para>
        The parsing of the data is deferred until the first query you make
        against the <code>Zend_Console_Getopt</code> object to find out if an
        option was given, the object performs its parsing.  This allows you to
        use several method calls to configure the options, arguments, help
        strings, and configuration options before parsing takes place.
    </para>

    <sect2 id="zend.console.getopt.fetching.exceptions">
        <title>Handling Getopt Exceptions</title>
        <para>
            If the user gave any invalid options on the command-line,
            the parsing function throws a <code>Zend_Console_Getopt_Exception</code>.
            You should catch this exception in your application code.
            You can use the <code>parse()</code> method to force the object
            to parse the arguments.  This is useful because you can invoke
            <code>parse()</code> in a <code>try</code> block.  If it passes,
            you can be sure that the parsing won't throw an exception again.
            The exception thrown has a custom method <code>getUsageMessage()</code>,
            which returns as a string the formatted set of usage messages for
            all declared options.
        </para>
        <example id="zend.console.getopt.fetching.exceptions.example">
            <title>Catching Getopt Exceptions</title>
            <programlisting role="php"><![CDATA[<?php
try {
    $opts = new Zend_Console_Getopt('abp:');
    $opts->parse();
} catch (Zend_Console_Getopt_Exception $e) {
    echo $e->getUsageMessage();
    exit;
}]]>
            </programlisting>
        </example>
        <para>
            Cases where parsing throws an exception include:
        </para>
        <itemizedlist>
            <listitem>
                <para>
                    Option given is not recognized.
                </para>
            </listitem>
            <listitem>
                <para>
                    Option requires a parameter but none was given.
                </para>
            </listitem>
            <listitem>
                <para>
                    Option parameter is of the wrong type.
                    E.g. a non-numeric string when an integer
                    was required.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.console.getopt.fetching.byname">
        <title>Fetching Options by Name</title>
        <para>
            You can use the <code>getOption()</code> method to query the value
            of an option.  If the option had a parameter, this method returns
            the value of the parameter.  If the option had no parameter but
            the user did specify it on the command-line, the method returns
            <code>true</code>.  Otherwise the method returns <code>null</code>.
        </para>
        <example id="zend.console.getopt.fetching.byname.example.setoption">
            <title>Using getOption()</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
$b = $opts->getOption('b');
$p_parameter = $opts->getOption('p');]]>
            </programlisting>
        </example>
        <para>
            Alternatively, you can use the magic <code>__get()</code> function
            to retrieve the value of an option as if it were a class member
            variable.  The <code>__isset()</code> magic method is also
            implemented.
        </para>
        <example id="zend.console.getopt.fetching.byname.example.magic">
            <title>Using __get() and __isset() magic methods</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
if (isset($opts->b)) {
    echo "I got the b option.\n";
}
$p_parameter = $opts->p; // null if not set]]>
            </programlisting>
        </example>
        <para>
            If your options are declared with aliases, you may use any of the
            aliases for an option in the methods above.
        </para>
    </sect2>

    <sect2 id="zend.console.getopt.fetching.reporting">
        <title>Reporting Options</title>
        <para>
            There are several methods to report the full set of
            options given by the user on the current command-line.
        </para>
        <itemizedlist>
            <listitem>
                <para>
                    As a string: use the <code>toString()</code> method.  The options
                    are returned as a space-separated string of "<code>flag=value</code>"
                    pairs.  The value of an option that does not have a parameter
                    is the literal string "<code>true</code>".
                </para>
            </listitem>
            <listitem>
                <para>
                    As an array: use the <code>toArray()</code> method.  The options
                    are returned in a simple integer-indexed array of strings, the flag
                    strings followed by parameter strings, if any.
                </para>
            </listitem>
            <listitem>
                <para>
                    As a string containing JSON data: use the <code>toJson()</code> method.
                </para>
            </listitem>
            <listitem>
                <para>
                    As a string containing XML data: use the <code>toXml()</code> method.
                </para>
            </listitem>
        </itemizedlist>
        <para>
            In all of the above dumping methods, the flag string is the
            first string in the corresponding list of aliases.  For example,
            if the option aliases were declared like "<code>verbose|v</code>",
            then the first string, "<code>verbose</code>", is used as the
            canonical name of the option.  The name of the option flag does not
            include any preceding dashes.
        </para>
    </sect2>

    <sect2 id="zend.console.getopt.fetching.remainingargs">
        <title>Fetching Non-option Arguments</title>
        <para>
            After option arguments and their parameters have been
            parsed from the command-line, there may be additional arguments
            remaining.  You can query these arguments using the
            <code>getRemainingArgs()</code> method.  This method returns
            an array of the strings that were not part of any options.
        </para>
        <example id="zend.console.getopt.fetching.remainingargs.example">
            <title>Using getRemainingArgs()</title>
            <programlisting role="php"><![CDATA[<?php
$opts = new Zend_Console_Getopt('abp:');
$opts->setArguments(array('-p', 'p_parameter', 'filename'));
$args = $opts->getRemainingArgs(); // returns array('filename')]]>
            </programlisting>
        </example>
        <para>
            <code>Zend_Console_Getopt</code> supports the GNU convention that
            an argument consisting of a double-dash signifies the end of
            options.  Any arguments following this signifier must be treated as
            non-option arguments.  This is useful if you might have a non-option
            argument that begins with a dash.
            For example: "<command>rm -- -filename-with-dash</command>".
        </para>
    </sect2>

</sect1>
<sect1 id="zend.console.getopt.introduction">
    <title>Introduction to Getopt</title>
    <para>
        The <code>Zend_Console_Getopt</code> class helps command-line
        applications to parse their options and arguments.
    </para>
    <para>
        Users may specify command-line arguments when
        they execute your application.  These arguments have meaning to the
        application, to change the behavior in some way, or choose resources,
        or specify parameters.  Many options have developed customary meaning,
        for example "<code>--verbose</code>" enables extra output from many
        applications.  Other options may have a meaning that is different for
        each application.  For example, "<code>-c</code>" enables different
        features in <command>grep</command>, <command>ls</command>, and
        <command>tar</command>.
    </para>
    <para>
        Below are a few definitions of terms.  Common usage of the terms
        varies, but this documentation will use the definitions below.
    </para>
    <itemizedlist>
        <listitem>
            <para>
                "argument": a string that occurs on the command-line
                following the name of the command.  Arguments may be
                options or else may appear without an option, to name
                resources on which the command operates.
            </para>
        </listitem>
        <listitem>
            <para>
                "option": an argument that signifies that the command
                should change its default behavior in some way.
            </para>
        </listitem>
        <listitem>
            <para>
                "flag": the first part of an option, identifies
                the purpose of the option.  A flag is preceded
                conventionally by one or two dashes
                ("<code>-</code>" or "<code>--</code>").
                A single dash precedes a single-character flag
                or a cluster of single-character flags.
                A double-dash precedes a multi-character flag.
                Long flags cannot be clustered.
            </para>
        </listitem>
        <listitem>
            <para>
                "parameter": the secondary part of an option; a data value
                that may accompany a flag, if it is applicable to the
                given option.  For example, many commands accept a
                "<code>--verbose</code>" option, but typically
                this option has no parameter.  However, an option like
                "<code>--user</code>" almost always requires
                a following parameter.
            </para>
            <para>
                A parameter may be given as a separate argument following a
                flag argument, or as part of the same argument string,
                separated from the flag by an equals symbol ("<code>=</code>").
                The latter form is supported only by long flags.
                For example,
                <code>-u username</code>, <code>--user username</code>,
                and <code>--user=username</code> are forms supported
                by <code>Zend_Console_Getopt</code>.
            </para>
        </listitem>
        <listitem>
            <para>
                "cluster": multiple single-character flags combined
                in a single string argument and preceded by a single
                dash.  For example, "<command>ls -1str</command>"
                uses a cluster of four short flags.  This command is
                equivalent to "<command>ls -1 -s -t -r</command>".
                Only single-character flags can be clustered.
                You cannot make a cluster of long flags.
            </para>
        </listitem>
    </itemizedlist>
    <para>
        For example, in "<code>mysql --user=root mydatabase</code>",
        "<code>mysql</code>" is a <emphasis>command</emphasis>,
        "<code>--user=root</code>" is an <emphasis>option</emphasis>,
        "<code>--user</code>" is a <emphasis>flag</emphasis>,
        "<code>root</code>" is a <emphasis>parameter</emphasis> to the option,
        and "<code>mydatabase</code>" is an argument but not an option
        by our definition.
    </para>
    <para>
        <code>Zend_Console_Getopt</code> provides an interface to declare
        which flags are valid for your application, output an error and usage
        message if they use an invalid flag, and report to your application
        code which flags the user specified.
    </para>
    <note>
        <title>Getopt is not an application framework</title>
        <para>
            <code>Zend_Console_Getopt</code> does <emphasis>not</emphasis>
            interpret the meaning of flags and parameters, nor does this class
            implement application workflow or invoke application code.
            You must implement those actions in your own application code.
            You can use the <code>Zend_Console_Getopt</code> class to parse
            the command-line and provide object-oriented methods for querying
            which options were given by a user, but code to use this
            information to invoke parts of your application should be in
            another PHP class.
        </para>
    </note>
    <para>
        The following sections describe usage of <code>Zend_Console_Getopt</code>.
    </para>
</sect1>
<sect1 id="zend.console.getopt.rules">
    <title>Declaring Getopt Rules</title>
    <para>
        The constructor for the <code>Zend_Console_Getopt</code> class takes
        from one to three arguments.  The first argument
        declares which options are supported by your application.
        This class supports alternative syntax forms for declaring the options.
        See the sections below for the format and usage of these syntax forms.
    </para>
    <para>
        The constructor takes two more arguments, both of which are optional.
        The second argument may contain the command-line arguments.
        This defaults to <code>$_SERVER['argv']</code>.
    </para>
    <para>
        The third argument of the constructor may contain an
        configuration options to customize the behavior of
        <code>Zend_Console_Getopt</code>.
        See <link linkend="zend.console.getopt.configuration.config">Adding Configuration</link>
        for reference on the options available.
    </para>

    <sect2 id="zend.console.getopt.rules.short">
        <title>Declaring Options with the Short Syntax</title>
        <para>
            <code>Zend_Console_Getopt</code> supports a compact syntax similar
            to that used by GNU Getopt (see
            <ulink url="http://www.gnu.org/software/libc/manual/html_node/Getopt.html">http://www.gnu.org/software/libc/manual/html_node/Getopt.html</ulink>.
            This syntax supports only single-character flags.  In a single
            string, you type each of the letters that correspond to flags
            supported by your application.  A letter followed by a colon
            character ("<code>:</code>") indicates a flag that requires a
            parameter.
        </para>
        <example id="zend.console.getopt.rules.short.example">
            <title>Using the Short Syntax</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Console/Getopt.php';
$opts = new Zend_Console_Getopt('abp:');]]>
            </programlisting>
        </example>
        <para>
            The example above shows using <code>Zend_Console_Getopt</code>
            to declare that options may be given as "<code>-a</code>",
            "<code>-b</code>", or "<code>-p</code>".  The latter flag
            requires a parameter.
        </para>
        <para>
            The short syntax is limited to flags of a single character.
            Aliases, parameter types, and help strings are not supported
            in the short syntax.
        </para>
    </sect2>

    <sect2 id="zend.console.getopt.rules.long">
        <title>Declaring Options with the Long Syntax</title>
        <para>
            A different syntax with more features is also available.  This
            syntax allows you to specify aliases for flags, types of option
            parameters, and also help strings to describe usage to the user.
            Instead of the single string used in the short syntax to declare
            the options, the long syntax uses an associative array as the
            first argument to the constructor.
        </para>
        <para>
            The key of each element of the associative array is a string with
            a format that names the flag, with any aliases, separated by the
            pipe symbol ("<code>|</code>").  Following this series of flag
            aliases, if the option requires a parameter, is an equals symbol
            ("<code>=</code>") with a letter that stands for the
            <emphasis>type</emphasis> of the parameter:
        </para>
        <itemizedlist>
            <listitem>
                <para>
                    "<code>=s</code>" for a string parameter
                </para>
            </listitem>
            <listitem>
                <para>
                    "<code>=w</code>" for a word parameter
                    (a string containing no whitespace)
                </para>
            </listitem>
            <listitem>
                <para>
                    "<code>=i</code>" for an integer parameter
                </para>
            </listitem>
        </itemizedlist>
        <para>
            If the parameter is optional, use a dash ("<code>-</code>")
            instead of the equals symbol.
        </para>
        <para>
            The value of each element in the associative array is a help string
            to describe to a user how to use your program.
        </para>
        <example id="zend.console.getopt.rules.long.example">
            <title>Using the Long Syntax</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Console/Getopt.php';
$opts = new Zend_Console_Getopt(
  array(
    'apple|a'    => 'This option chooses apple, with no parameter',
    'banana|b=i' => 'This option chooses banana, with required integer parameter',
    'pear|p-s'   => 'This option chooses pear, with optional string parameter'
  )
);]]>
            </programlisting>
        </example>
        <para>
            In the example declaration above, there are three options.
            "<code>--apple</code>" and "<code>-a</code>" are aliases for each
            other, and the option takes no parameter.
            "<code>--banana</code>" and "<code>-b</code>" are aliases for each
            other, and the option takes a mandatory integer parameter.
            Finally, "<code>--pear</code>" and "<code>-p</code>" are aliases
            for each other, and the option may take an optional string parameter.
        </para>
    </sect2>

</sect1>
<sect1 id="zend.controller.action">
    <title>Action Controllers</title>

    <sect2 id="zend.controller.action.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Controller_Action</code> is an abstract class you may use
            for implementing Action Controllers for use with the Front
            Controller when building a website based on the
            Model-View-Controller (MVC) pattern.
        </para>

        <para>
            To use <code>Zend_Controller_Action</code>, you will need to
            subclass it in your actual action controller classes (or subclass it
            to create your own base class for action controllers). The most
            basic operation is to subclass it, and create action methods that
            correspond to the various actions you wish the controller to handle
            for your site.  Zend_Controller's routing and dispatch handling will
            autodiscover any methods ending in 'Action' in your class as
            potential controller actions.
        </para>

        <para>
            For example, let's say your class is defined as follows:
        </para>

        <programlisting role="php"><![CDATA[
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // do something
    }

    public function bazAction()
    {
        // do something
    }
}
]]>
        </programlisting>

        <para>
            The above <code>FooController</code> class (controller
            <code>foo</code>) defines two actions, <code>bar</code> and
            <code>baz</code>.
        </para>

        <para>
            There's much more that can be accomplished than this, such as custom
            initialization actions, default actions to call should no action (or
            an invalid action) be specified, pre- and post-dispatch hooks, and a
            variety of helper methods. This chapter serves as an overview of the
            action controller functionality
        </para>

        <note>
            <title>Default Behaviour</title>

            <para>
                By default, the <link linkend="zend.controller.front">front
                    controller</link> enables the <link
                    linkend="zend.controller.actionhelpers.viewrenderer">ViewRenderer</link>
                action helper. This helper takes care of injecting the view
                object into the controller, as well as automatically rendering
                views. You may disable it within your action controller via one
                of the following methods:
            </para>

            <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function init()
    {
        // Local to this controller only; affects all actions, as loaded in init:
        $this->_helper->viewRenderer->setNoRender(true);

        // Globally:
        $this->_helper->removeHelper('viewRenderer');

        // Also globally, but would need to be in conjunction with the local
        // version in order to propagate for this controller:
        Zend_Controller_Front::getInstance()->setParam('noViewRenderer', true);
    }
}]]>
            </programlisting>

            <para>
                <code>initView()</code>, <code>getViewScript()</code>,
                <code>render()</code>, and <code>renderScript()</code> each
                proxy to the <code>ViewRenderer</code> unless the helper is not
                in the helper broker or the <code>noViewRenderer</code> flag has
                been set.
            </para>

            <para>
                You can also simply disable rendering for an invididual view by
                setting the <code>ViewRenderer</code>'s <code>noRender</code>
                flag:
            </para>

            <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // disable autorendering for this action only:
        $this->_helper->viewRenderer->setNoRender();
    }
}]]>
            </programlisting>

            <para>
                The primary reasons to disable the <code>ViewRenderer</code> are
                if you simply do not need a view object or if you are not
                rendering via view scripts (for instance, when using an action
                controller to serve web service protocols such as SOAP, XML-RPC,
                or REST). In most cases, you will never need to globally disable
                the <code>ViewRenderer</code>, only selectively within
                individual controllers or actions.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.controller.action.initialization">
        <title>Object initialization</title>

        <para>
            While you can always override the action controller's constructor,
            we do not recommend this. Zend_Controller_Action::__construct()
            performs some important tasks, such as registering the request and
            response objects, as well as any custom invocation arguments passed
            in from the front controller. If you must override the constructor,
            be sure to call <code>parent::__construct($request, $response,
            $invokeArgs)</code>.
        </para>

        <para>
            The more appropriate way to customize instantiation is to use the
            <code>init()</code> method, which is called as the last task of
            <code>__construct()</code>.  For example, if you want to connect to
            a database at instantiation:
        </para>

        <programlisting role="php"><![CDATA[
class FooController extends Zend_Controller_Action
{
    public function init()
    {
        $this->db = Zend_Db::factory('Pdo_Mysql', array(
            'host'     => 'myhost',
            'username' => 'user',
            'password' => 'XXXXXXX',
            'dbname'   => 'website'
        ));
    }
}
]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.controller.action.prepostdispatch">
        <title>Pre- and Post-Dispatch Hooks</title>

        <para>
            <code>Zend_Controller_Action</code> specifies two methods that may
            be called to bookend a requested action, <code>preDispatch()</code>
            and <code>postDispatch()</code>. These can be useful in a variety of
            ways: verifying authentication and ACLs prior to running an action
            (by calling <code>_forward()</code> in <code>preDispatch()</code>,
            the action will be skipped), for instance, or placing generated
            content in a sitewide template (<code>postDispatch()</code>).
        </para>
    </sect2>

    <sect2 id="zend.controller.action.accessors">
        <title>Accessors</title>

        <para>
            A number of objects and variables are registered with the object,
            and each has accessor methods.
        </para>

        <itemizedlist>
            <listitem><para>
                <emphasis>Request Object</emphasis>: <code>getRequest()</code>
                may be used to retrieve the request object used to call the
                action.
            </para></listitem>

            <listitem>
                <para>
                    <emphasis>Response Object</emphasis>:
                    <code>getResponse()</code> may be used to retrieve the
                    response object aggregating the final response. Some typical
                    calls might look like:
                </para>

                <programlisting role="php"><![CDATA[
$this->getResponse()->setHeader('Content-Type', 'text/xml');
$this->getResponse()->appendBody($content);
]]>
                </programlisting>
            </listitem>

            <listitem>
                <para>
                    <emphasis>Invocation Arguments</emphasis>: the front
                    controller may push parameters into the router, dispatcher,
                    and action controller. To retrieve these, use
                    <code>getInvokeArg($key)</code>; alternatively, fetch the
                    entire list using <code>getInvokeArgs()</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis>Request parameters</emphasis>: The request object
                    aggregates request parameters, such as any _GET or _POST
                    parameters, or user parameters specified in the URL's path
                    information. To retrieve these, use
                    <code>_getParam($key)</code> or
                    <code>_getAllParams()</code>. You may also set request
                    parameters using <code>_setParam()</code>; this is useful
                    when forwarding to additional actions.
                </para>

                <para>
                    To test whether or not a parameter exists (useful for
                    logical branching), use <code>_hasParam($key)</code>.
                </para>

                <note>
                    <para>
                        <code>_getParam()</code> may take an optional second
                        argument containing a default value to use if the
                        parameter is not set or is empty. Using it eliminates
                        the need to call <code>_hasParam()</code> prior to
                        retrieving a value:
                    </para>

                    <programlisting role="php"><![CDATA[<?php
// Use default value of 1 if id is not set
$id = $this->_getParam('id', 1);

// Instead of:
if ($this->_hasParam('id') {
    $id = $this->_getParam('id');
} else {
    $id = 1;
}]]>
                    </programlisting>
                </note>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.action.viewintegration">
        <title>View Integration</title>

        <para>
            <code>Zend_Controller_Action</code> provides a rudimentary and
            flexible mechanism for view integration. Two methods accomplish
            this, <code>initView()</code> and <code>render()</code>; the former
            method lazy-loads the <code>$view</code> public property, and the
            latter renders a view based on the current requested action, using
            the directory hierarchy to determine the script path.
        </para>

        <sect3 id="zend.controller.action.viewintegration.initview">
            <title>View Initialization</title>

            <para>
                <code>initView()</code> initializes the view object.
                <code>render()</code> calls <code>initView()</code> in order to
                retrieve the view object, but it may be initialized at any time;
                by default it populates the <code>$view</code> property with a
                <code>Zend_View</code> object, but any class implementing
                <code>Zend_View_Interface</code> may be used. If
                <code>$view</code> is already initialized, it simply returns
                that property.
            </para>

            <para>
                The default implementation makes the following assumption of
                the directory structure:
            </para>

            <programlisting role="php"><![CDATA[
applicationOrModule/
    controllers/
        IndexController.php
    views/
        scripts/
            index/
                index.phtml
        helpers/
        filters/
]]>
            </programlisting>

            <para>
                In other words, view scripts are assumed to be in the
                <code>views/scripts/</code> subdirectory, and the
                <code>views</code> subdirectory is assumed to contain sibling
                functionality (helpers, filters). When determining the view
                script name and path, the <code>views/scripts/</code> directory
                will be used as the base path, with a directories named after the
                individual controllers providing a hierarchy of view scripts.
            </para>
        </sect3>

        <sect3 id="zend.controller.action.viewintegration.render">
            <title>Rendering Views</title>

            <para>
                <code>render()</code> has the following signature:
            </para>

            <programlisting role="php"><![CDATA[<?php
string render(string $action = null, string $name = null, bool $noController = false);]]>
            </programlisting>

            <para>
                <code>render()</code> renders a view script. If no arguments are
                passed, it assumes that the script requested is
                <code>[controller]/[action].phtml</code> (where
                <code>.phtml</code> is the value of the <code>$viewSuffix</code>
                property). Passing a value for <code>$action</code> will render
                that template in the <code>[controller]</code> subdirectory. To
                override using the <code>[controller]</code> subdirectory, pass
                a true value for <code>$noController</code>. Finally, templates
                are rendered into the response object; if you wish to render to
                a specific <link
                    linkend="zend.controller.response.namedsegments">named
                    segment</link> in the response object, pass a value to
                <code>$name</code>.
            </para>

            <note><para>
                    Since controller and action names may contain word delimiter
                    characters such as '_', '.', and '-', render() normalizes
                    these to '-' when determining the script name. Internally,
                    it uses the dispatcher's word and path delimiters to do this
                    normalization. Thus, a request to
                    <code>/foo.bar/baz-bat</code> will render the script
                    <code>foo-bar/baz-bat.phtml</code>. If your action method
                    contains camelCasing, please remember that this will result
                    in '-' separated words when determining the view script
                    file name.
            </para></note>

            <para>
                Some examples:
            </para>

            <programlisting role="php"><![CDATA[<?php
class MyController extends Zend_Controller_Action
{
    public function fooAction()
    {
        // Renders my/foo.phtml
        $this->render();

        // Renders my/bar.phtml
        $this->render('bar');

        // Renders baz.phtml
        $this->render('baz', null, true);

        // Renders my/login.phtml to the 'form' segment of the response object
        $this->render('login', 'form');

        // Renders site.phtml to the 'page' segment of the response object; does
        // not use the 'my/' subirectory
        $this->render('site', 'page', true);
    }

    public function bazBatAction()
    {
        // Renders my/baz-bat.phtml
        $this->render();
    }
}]]>
            </programlisting>
        </sect3>
    </sect2>

    <sect2 id="zend.controller.action.utilmethods">
        <title>Utility Methods</title>

        <para>
            Besides the accessors and view integration methods,
            <code>Zend_Controller_Action</code> has several utility methods for
            performing common tasks from within your action methods (or from
            pre-/post-dispatch).
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>_forward($action, $controller = null, $module = null,
                        array $params = null)</code>: perform another action. If
                    called in <code>preDispatch()</code>, the currently
                    requested action will be skipped in favor of the new one.
                    Otherwise, after the current action is processed, the action
                    requested in _forward() will be executed.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>_redirect($url, array $options =
                        array())</code>: redirect to another location. This
                    method takes a URL and an optional set of options. By
                    default, it performs an HTTP 302 redirect.
                </para>

                <para>
                    The options may include one or more of the following:
                </para>

                <itemizedlist>
                    <listitem>
                        <para>
                            <emphasis>exit:</emphasis> whether or not to exit
                            immediately. If requested, it will cleanly close any
                            open sessions and perform the redirect.
                        </para>

                        <para>
                            You may set this option globally within the
                            controller using the <code>setRedirectExit()</code>
                            accessor.
                        </para>
                    </listitem>

                    <listitem>
                        <para>
                            <emphasis>prependBase:</emphasis> whether or not to
                            prepend the base URL registered with the request
                            object to the URL provided.
                        </para>

                        <para>
                            You may set this option globally within the
                            controller using the
                            <code>setRedirectPrependBase()</code> accessor.
                        </para>
                    </listitem>

                    <listitem>
                        <para>
                            <emphasis>code:</emphasis> what HTTP code to utilize
                            in the redirect. By default, an HTTP 302 is
                            utilized; any code between 301 and 306 may be used.
                        </para>

                        <para>
                            You may set this option globally within the
                            controller using the
                            <code>setRedirectCode()</code> accessor.
                        </para>
                    </listitem>
                </itemizedlist>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.action.subclassing">
        <title>Subclassing the Action Controller</title>

        <para>
            By design, <code>Zend_Controller_Action</code> must be subclassed
            in order to create an action controller. At the minimum, you will
            need to define action methods that the controller may call.
        </para>

        <para>
            Besides creating useful functionality for your web applications, you
            may also find that you're repeating much of the same setup or
            utility methods in your various controllers; if so, creating a
            common base controller class that extends
            <code>Zend_Controller_Action</code> could solve such redundancy.
        </para>

        <example id="zend.controller.action.subclassing.example-call">
            <title>How to Handle Non-Existent Actions</title>

            <para>
                If a request to a controller is made that includes an undefined
                action method, <code>Zend_Controller_Action::__call()</code>
                will be invoked. <code>__call()</code> is, of course, PHP's
                magic method for method overloading.
            </para>

            <para>
                By default, this method throws a
                <code>Zend_Controller_Action_Exception</code> indicating the
                requested method was not found in the controller. If the method
                requested ends in 'Action', the assumption is that an action was
                requested and does not exist; such errors result in an exception
                with a code of 404. All other methods result in an exception
                with a code of 500. This allows you to easily differentiate
                between page not found and application errors in your error
                handler.
            </para>
                
            <para>
                You should override this functionality if you wish to perform
                other operations.  For instance, if you wish to display an error
                message, you might write something like this:
            </para>

            <programlisting role="php"><![CDATA[<?php
class MyController extends Zend_Controller_Action
{
    public function __call($method, $args)
    {
        if ('Action' == substr($method, -6)) {
            // If the action method was not found, render the error template
            return $this->render('error');
        }

        // all other methods throw an exception
        throw new Exception('Invalid method "' . $method . '" called', 500);
    }
}]]>
            </programlisting>

            <para>
                Another possibility is that you may want to forward on to a
                default controller page:
            </para>

            <programlisting role="php"><![CDATA[<?php
class MyController extends Zend_Controller_Action
{
    public function indexAction()
    {
        $this->render();
    }

    public function __call($method, $args)
    {
        if ('Action' == substr($method, -6)) {
            // If the action method was not found, forward to the index action
            return $this->_forward('index');
        }

        // all other methods throw an exception
        throw new Exception('Invalid method "' . $method . '" called', 500);
    }
}]]>
            </programlisting>
        </example>

        <para>
            Besides overriding <code>__call()</code>, each of the
            initialization, utility, accessor, view, and dispatch hook methods
            mentioned previously in this chapter may be overridden in order to
            customize your controllers. As an example, if you are storing your
            view object in a registry, you may want to modify your
            <code>initView()</code> method with code resembling the following:
        </para>

        <programlisting role="php"><![CDATA[<?php
abstract class My_Base_Controller extends Zend_Controller_Action
{
    public function initView()
    {
        if (null === $this->view) {
            if (Zend_Registry::isRegistered('view')) {
                $this->view = Zend_Registry::get('view');
            } else {
                $this->view = new Zend_View();
                $this->view->setBasePath(dirname(__FILE__) . '/../views');
            }
        }

        return $this->view;
    }
}]]>
        </programlisting>

        <para>
            Hopefully, from the information in this chapter, you can see the
            flexibility of this particular component and how you can shape it to
            your application's or site's needs.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.actionhelpers.actionstack">
    <title>ActionStack</title>

    <para>
        The <code>ActionStack</code> helper allows you to push requests to the
        <link linkend="zend.controller.plugins.standard.actionstack">ActionStack</link>
        front controller plugin, effectively helping you create a queue of
        actions to execute during the request.  The helper allows you to add
        actions either by specifying new request objects or
        action/controller/module sets.
    </para>

    <note>
        <title>Invoking ActionStack helper initializees ActionStack Plugin</title>

        <para>
            Invoking the <code>ActionStack</code> helper implicitly registers
            the <code>ActionStack</code> plugin -- which means you do not need
            to explicitly register the <code>ActionStack</code> plugin to use
            this functionality.
        </para>
    </note>

    <example id="zend.controller.actionhelpers.actionstack.simple">
        <title>Adding a task using action, controller and module names</title>

        <para>
            Often, it's simplest to simply specify the action, controller, and
            module (and optional request parameters), much as you would when
            calling <code>Zend_Controller_Action::_forward()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // Add two actions to the stack
        // Add call to /foo/baz/bar/baz
        // (FooController::bazAction() with request var bar == baz)
        $this->_helper->actionStack('baz', 'foo', 'default', array('bar' => 'baz'));

        // Add call to /bar/bat
        // (BarController::batAction())
        $this->_helper->actionStack('bat', 'bar');
    }
}
?>]]></programlisting>

    </example>

    <example id="zend.controller.actionhelpers.actionstack.simple2">
        <title>Adding a task using a request object</title>

        <para>
            Sometimes the OOP nature of a request object makes most sense; you
            can pass such an object to the <code>ActionStack</code> helper as
            well.
        </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // Add two actions to the stack
        // Add call to /foo/baz/bar/baz
        // (FooController::bazAction() with request var bar == baz)
        $request = clone $this->getRequest();
        $request->setActionName('baz')              // don't set controller or 
                ->setParams(array('bar' => 'baz')); // module; use current values
        $this->_helper->actionStack($request);

        // Add call to /bar/bat
        // (BarController::batAction())
        $request = clone $this->getRequest();
        $request->setActionName('bat')      // don't set module; use current
                ->setControllerName('bar'); // value
        $this->_helper->actionStack($request);
    }
}
?>]]></programlisting>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.actionhelpers.autocomplete">
    <title>AutoComplete</title>

    <para>
        Many AJAX javascript libraries offer functionality for providing
        autocompletion whereby a selectlist of potentially matching results is
        displayed as the user types.  The <code>AutoComplete</code> helper aims
        to simplify returning acceptable responses to such methods.
    </para>

    <para>
        Since not all JS libraries implement autocompletion in the same way, the
        <code>AutoComplete</code> helper provides some abstract base
        functionality necessary to many libraries, and concrete implementations
        for individual libraries. Return types are generally either JSON arrays
        of strings, JSON arrays of arrays (with each member array being an
        associative array of metadata used to create the selectlist), or HTML.
    </para>

    <para>
        Basic usage for each implementation is the same:
    </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // Perform some logic...

        // Encode and send response;
        $this->_helper->autoCompleteDojo($data);

        // Or explicitly:
        $response = $this->_helper->autoCompleteDojo->sendAutoCompletion($data);

        // Or simply prepare autocompletion response:
        $response = $this->_helper->autoCompleteDojo->prepareAutoCompletion($data);
    }
}
?>]]></programlisting>

    <para>
        By default, autocompletion does the following:
    </para>

    <itemizedlist>
        <listitem><para>
                Disables layouts and ViewRenderer.
        </para></listitem>

        <listitem><para>
                Sets appropriate response headers.
        </para></listitem>

        <listitem><para>
                Sets response body with encoded/formatted autocompletion data.
        </para></listitem>

        <listitem><para>
                Sends response.
        </para></listitem>
    </itemizedlist>

    <para>
        Available methods of the helper include:
    </para>

    <itemizedlist>
        <listitem><para>
                <code>disableLayouts()</code> can be used to disable layouts and
                the ViewRenderer. Typically, this is called within
                <code>prepareAutoCompletion()</code>.
        </para></listitem>

        <listitem><para>
                <code>encodeJson($data, $keepLayouts = false)</code> will encode
                data to JSON, optionally enabling or disabling layouts.
                Typically, this is called within
                <code>prepareAutoCompletion()</code>.
        </para></listitem>

        <listitem><para>
                <code>prepareAutoCompletion($data, $keepLayouts = false)</code>
                is used to prepare data in the response format necessary for the
                concrete implementation, optionally enabling or disabling
                layouts. The return value will vary based on the implementation.
        </para></listitem>

        <listitem><para>
                <code>sendAutoCompletion($data, $keepLayouts = false)</code>
                is used to send data in the response format necessary for the
                concrete implementation. It calls
                <code>prepareAutoCompletion()</code>, and then sends the
                response.
        </para></listitem>

        <listitem><para>
                <code>direct($data, $sendNow = true, $keepLayouts =
                    false)</code> is used when calling the helper as a method of
                the helper broker. The <code>$sendNow</code> flag is used to
                determine whether to call <code>sendAutoCompletion()</code> or
                <code>prepareAutoCompletion()</code>, respectively.
        </para></listitem>
    </itemizedlist>

    <para>
        Currently, <code>AutoComplete</code> supports the Dojo and Scriptaculous
        AJAX libraries.
    </para>

    <sect4 id="zend.controller.actionhelpers.autocomplete.dojo">
        <title>AutoCompletion with Dojo</title>

        <para>
            Dojo does not have an AutoCompletion widget per se, but has two
            widgets that can perform AutoCompletion: ComboBox and
            FilteringSelect. In both cases, they require a data store that
            implements the QueryReadStore; for more information on these topics,
            see the <ulink url="http://dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/data-retrieval-dojo-data-0">dojo.data</ulink>
            documentation.
        </para>

        <para>
            In Zend Framework, you can pass a simple indexed array to the
            AutoCompleteDojo helper, and it will return a JSON response suitable
            for use with such a store:
        </para>

        <programlisting role="php"><![CDATA[<?php
// within a controller action:
$this->_helper->autoCompleteDojo($data);
]]></programlisting>
        
        <example id="zend.controller.actionhelpers.autocomplete.dojo.example1">
            <title>AutoCompletion with Dojo Using Zend MVC</title>

            <para>
                AutoCompletion with Dojo via the Zend MVC requires several
                things: generating a form object for the ComboBox on which you
                want AutoCompletion, a controller action for serving the
                AutoCompletion results, creating a custom QueryReadStore to connect
                to the AutoCompletion action, and generation of the javascript
                to use to initialize AutoCompletion on the server side.
            </para>

            <para>
                First, let's look at the javascript necessary. Dojo offers a
                complete framework for creating OOP javascript, much as Zend
                Framework does for PHP. Part of that is the ability to create
                pseudo-namespaces using the directory hierarchy. We'll create a
                'custom' directory at the same level as the Dojo directory
                that's part of the Dojo distribution. Inside that directory,
                we'll create a javascript file, TestNameReadStore.js, with the
                following contents:
            </para>

            <programlisting role="javascript"><![CDATA[
dojo.provide("custom.TestNameReadStore");
dojo.declare("custom.TestNameReadStore", dojox.data.QueryReadStore, {
    fetch:function (request) {
        request.serverQuery = { test:request.query.name };
        return this.inherited("fetch", arguments);
    }
});
]]></programlisting>
            
            <para>
                This class is simply an extenstion of Dojo's own QueryReadStore,
                which is itself an abstract class. We simply define a method by
                which to request, and assigning it to the 'test' element.
            </para>

            <para>
                Next, let's create the form element for which we want
                AutoCompletion:
            </para>

            <programlisting role="php"><![CDATA[<?php
class TestController extends Zend_Controller_Action
{
    protected $_form;

    public function getForm()
    {   
        if (null === $this->_form) {
            require_once 'Zend/Form.php';
            $this->_form = new Zend_Form();
            $this->_form->setMethod('get')
                ->setAction($this->getRequest()->getBaseUrl() . '/test/process')
                ->addElements(array(
                    'test' => array('type' => 'text', 'options' => array(
                        'filters'        => array('StringTrim'),
                        'dojoType'       => array('dijit.form.ComboBox'),
                        'store'          => 'testStore',
                        'autoComplete'   => 'false',
                        'hasDownArrow'   => 'true',
                        'label' => 'Your input:',
                    )),
                    'go' => array('type' => 'submit', 'options' => array('label' => 'Go!'))
                ));
        }
        return $this->_form;
    }
}
]]></programlisting>
            
            <para>
                Here, we simply create a form with 'test' and 'go' methods. The
                'test' method adds several special, Dojo-specific attributes:
                dojoType, store, autoComplete, and hasDownArrow. The dojoType is
                used to indicate that we are creating a ComboBox, and we will
                link it to a data store (key 'store') of 'testStore' -- more on
                that later. Specifying 'autoComplete' as false tells Dojo not to
                automatically select the first match, but instead show a list of
                matches. Finally, 'hasDownArrow' creates a down arrow similar to
                a select box so we can show and hide the matches.
            </para>

            <para>
                Let's add a method to display the form, as well as an end point
                for processing AutoCompletion:
            </para>

            <programlisting role="php"><![CDATA[<?php
class TestController extends Zend_Controller_Action
{
    // ...

    /**
     * Landing page
     */
    public function indexAction()
    {
        $this->view->form = $this->getForm();
    }

    public function autocompleteAction()
    {
        if ('ajax' != $this->_getParam('format', false)) {
            return $this->_helper->redirector('index');
        }
        if ($this->getRequest()->isPost()) {
            return $this->_helper->redirector('index');
        }

        $match = trim($this->getRequest()->getQuery('test', ''));

        $matches = array();
        foreach ($this->getData() as $datum) {
            if (0 === strpos($datum, $match)) {
                $matches[] = $datum;
            }
        }
        $this->_helper->autoCompleteDojo($matches);
    }
}
]]></programlisting>
            
            <para>
                In our <code>autocompleteAction()</code> we do a number of
                things. First, we look to make sure we have a post request, and
                that there is a 'format' parameter set to the value 'ajax';
                these are simply to help reduce spurious queries to the action.
                Next, we check for a 'test' parameter, and compare it against
                our data. (I purposely leave out the implementation of
                <code>getData()</code> here -- it could be any sort of data
                source.) Finally, we send our matches to our AutoCompletion
                helper.
            </para>

            <para>
                Now that we have all the pieces on the backend, let's look at
                what we need to deliver in our view script for the landing page.
                First, we need to setup our data store, then render our form,
                and finally ensure that the appropriate Dojo libraries --
                including our custom data store -- get loaded. Let's look at the
                view script, which comments the steps:
            </para>

            <programlisting role="php"><![CDATA[
<? // setup our data store: ?>
<div dojoType="custom.TestNameReadStore" jsId="testStore"
    url="<?= $this->baseUrl() ?>/unit-test/autocomplete/format/ajax" requestMethod="get"></div>

<? // render our form: ?>
<?= $this->form ?>

<? // setup Dojo-related CSS to load in HTML head: ?>
<? $this->headStyle()->captureStart() ?>
@import "<?= $this->baseUrl() ?>/javascript/dijit/themes/tundra/tundra.css";
@import "<?= $this->baseUrl() ?>/javascript/dojo/resources/dojo.css";
<? $this->headStyle()->captureEnd() ?>

<? // setup javascript to load in HTML head, including all required Dojo
   // libraries: ?>
<? $this->headScript()
        ->setAllowArbitraryAttributes(true)
        ->appendFile($this->baseUrl() . '/javascript/dojo/dojo.js', 
            'text/javascript', 
            array('djConfig' => 'parseOnLoad: true'))
        ->captureStart() ?>
djConfig.usePlainJson=true;
dojo.registerModulePath("custom","../custom");
dojo.require("dojo.parser");
dojo.require("dojox.data.QueryReadStore");
dojo.require("dijit.form.ComboBox");
dojo.require("custom.TestNameReadStore");
<? $this->headScript()->captureEnd() ?>
]]></programlisting>

            <para>
                Note the calls to view helpers such as headStyle and headScript;
                these are placeholders, which we can then render in the HTML
                head section of our layout view script.
            </para>

            <para>
                We now have all the pieces to get Dojo AutoCompletion working.
            </para>
        </example>
    </sect4>

    <sect4 id="zend.controller.actionhelpers.autocomplete.scriptaculous">
        <title>AutoCompletion with Scriptaculous</title>
        <para>
            <ulink url="http://wiki.script.aculo.us/scriptaculous/show/Ajax.Autocompleter">Scriptaculous</ulink>
            expects an HTML response in a specific format.
        </para>

        <para>
            The helper to use with this library is 'AutoCompleteScriptaculous'.
            Simply provide it an array of data, and the helper will create an
            HTML response compatible with Ajax.Autocompleter.
        </para>
    </sect4>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.actionhelpers.contextswitch">
    <title>ContextSwitch and AjaxContext</title>

    <para>
        The <code>ContextSwitch</code> action helper is intended for
        facilitating returning different response formats on request.
        The <code>AjaxContext</code> helper is a specialized version of
        <code>ContextSwitch</code> that facilitates returning responses
        to XmlHttpRequests.
    </para>

    <para>
        To enable either one, you must provide hinting in your controller as to
        what actions can respond to which contexts. If an incoming request
        indicates a valid context for the given action, the helper will then:
    </para>

    <itemizedlist>
        <listitem><para>
                Disable layouts, if enabled.
        </para></listitem>

        <listitem><para>
                Set an alternate view suffix, effectively requiring a separate
                view script for the context.
        </para></listitem>

        <listitem><para>
                Send approprite response headers for the context desired.
        </para></listitem>

        <listitem><para>
                Optionally, call specified callbacks to setup the context and/or
                perform post-processing.
        </para></listitem>
    </itemizedlist>

    <para>
        As an example, let's consider the following controller:
    </para>

    <programlisting role="php"><![CDATA[<?php
class NewsController extends Zend_Controller_Action
{
    /**
     * Landing page; forwards to listAction()
     */
    public function indexAction()
    {
        $this->_forward('list');
    }

    /**
     * List news items
     */
    public function listAction()
    {
    }

    /**
     * View a news item
     */
    public function viewAction()
    {
    }
}
?>]]></programlisting>
    
    <para>
        Let's say that we want the <code>listAction()</code> to also be
        available in an XML format. Instead of creating a different action, we
        can hint that it can return an XML response:
    </para>

    <programlisting role="php"><![CDATA[<?php
class NewsController extends Zend_Controller_Action
{
    public function init()
    {
        $contextSwitch = $this->_helper->getHelper('contextSwitch');
        $contextSwitch->addActionContext('list', 'xml')
                      ->initContext();
    }

    // ...
}
?>]]></programlisting>

    <para>
        What this will do is:
    </para>

    <itemizedlist>
        <listitem><para>
                Set the 'Content-Type' response header to 'text/xml'.
        </para></listitem>

        <listitem><para>
                Change the view suffix to 'xml.phtml' (or, if you use an
                alternate view suffix, 'xml.[your suffix]').
        </para></listitem>
    </itemizedlist>

    <para>
        Now, you'll need to create a new view script, 'news/list.xml.phtml',
        which will create and render the XML.
    </para>

    <para>
        To determine if a request should initiate a context switch, the helper
        checks for a token in the request object. By default, it looks for the
        'format' parameter, though this may be configured. This means that, in
        most cases, to trigger a context switch, you can add a 'format'
        parameter to your request:
    </para>

    <itemizedlist>
        <listitem><para>
                Via URL parameter: <code>/news/list/format/xml</code> (recall,
                the default routing schema allows for arbitrary key/value pairs
                following the action)
        </para></listitem>

        <listitem><para>
                Via GET parameter: <code>/news/list?format=xml</code>
        </para></listitem>
    </itemizedlist>

    <para>
        <code>ContextSwitch</code> allows you to specify arbitrary contexts,
        including what suffix change will occur (if any), any response headers
        that should be sent, and arbitrary callbacks for initialization and post
        processing.
    </para>

    <sect4 id="zend.controller.actionhelpers.contextswitch.contexts">
        <title>Default Contexts Available</title>

        <para>
            By default, two contexts are available to the
            <code>ContextSwitch</code> helper: json and xml.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis>JSON</emphasis>. The JSON context sets the
                    'Content-Type' response header to 'application/json', and
                    the view script suffix to 'json.phtml'.
                </para>

                <para>
                    By default, however, no view script is required. It will
                    simply serialize all view variables, and emit the JSON
                    response immediately.
                </para>

                <para>
                    This behaviour can be disabled by turning off auto-JSON
                    serialization:
                </para>

                <programlisting role="php"><![CDATA[<?php
$this->_helper->contextSwitch()->setAutoJsonSerialization(false);
?>]]></programlisting>
            </listitem>

            <listitem>
                <para>
                    <emphasis>XML</emphasis>. The XML context sets the
                    'Content-Type' response header to 'text/xml', and the view
                    script suffix to 'xml.phtml'. You will need to create a new
                    view script for the context.
                </para>
            </listitem>
        </itemizedlist>
    </sect4>

    <sect4 id="zend.controller.actionhelpers.contextswitch.custom">
        <title>Creating Custom Contexts</title>

        <para>
            Sometimes, the default contexts are not enough. For instance, you
            may wish to return YAML, or serialized PHP, an RSS or ATOM feed,
            etc. <code>ContextSwitch</code> allows you to do so.
        </para>

        <para>
            The easiest way to add a new context is via the
            <code>addContext()</code> method. This method takes two arguments,
            the name of the context, and an array specification. The
            specification should include one or more of the following:
        </para>

        <itemizedlist>
            <listitem>
                <para><emphasis>suffix</emphasis>: the suffix to prepend to the
                default view suffix as registered in the ViewRenderer.</para>
            </listitem>

            <listitem>
                <para><emphasis>headers</emphasis>: an array of header/value
                    pairs you wish sent as part of the response.</para>
            </listitem>

            <listitem>
                <para><emphasis>callbacks</emphasis>: an array containing one or
                more of the keys 'init' or 'post', pointing to valid PHP
                callbacks that can be used for context initialization and post
                processing.</para>

                <para>Initialization callbacks occur when the context is
                detected by <code>ContextSwitch</code>. You can use it to
                perform arbitrary logic that should occur. As an example,
                the JSON context uses a callback to disable the ViewRenderer
                when auto-JSON serialization is on.</para>
                
                <para>Post processing occurs during the action's
                <code>postDispatch()</code> routine, and can be used to perform
                arbitrary logic. As an example, the JSON context uses a callback
                to determine if auto-JSON serialization is on; if so, it
                serializes the view variables to JSON and sends the response,
                but if not, it re-enables the ViewRenderer.</para>
            </listitem>
        </itemizedlist>

        <para>
            There are a variety of methods for interacting with contexts:
        </para>

        <itemizedlist>
            <listitem><para>
                <code>addContext($context, array $spec)</code>: add a new
                context. Throws an exception if the context already exists.
            </para></listitem>

            <listitem><para>
                <code>setContext($context, array $spec)</code>: add a new
                context or overwrite an existing context. Uses the same
                specification as <code>addContext()</code>.
            </para></listitem>

            <listitem><para>
                <code>addContexts(array $contexts)</code>: add many contexts at
                once. The <code>$contexts</code> array should be an array of
                context/specification pairs.  If any of the contexts already
                exists, it will throw an exception.
            </para></listitem>

            <listitem><para>
                <code>setContexts(array $contexts)</code>: add new contexts and
                overwrite existing ones. Uses the same specification as
                <code>addContexts()</code>.
            </para></listitem>

            <listitem><para>
                <code>hasContext($context)</code>: returns true if the context
                exists, false otherwise.  
            </para></listitem>

            <listitem><para> <code>getContext($context)</code>: retrieve a
                    single context by name. Returns an array following the
                    specification used in <code>addContext()</code>.
            </para></listitem>

            <listitem><para>
                <code>getContexts()</code>: retrieve all contexts. Returns an
                array of context/specification pairs.
            </para></listitem>

            <listitem><para>
                <code>removeContext($context)</code>: remove a single context by
                name. Returns true if successful, false if the context was not
                found.
            </para></listitem>

            <listitem><para>
                <code>clearContexts()</code>: remove all contexts.
            </para></listitem>
        </itemizedlist>
    </sect4>

    <sect4 id="zend.controller.actionhelpers.contextswitch.actions">
        <title>Setting Contexts Per Action</title>

        <para>
            There are two mechanisms for setting available contexts. You can
            either manually create arrays in your controller, or use several
            methods in <code>ContextSwitch</code> to assemble them.
        </para>

        <para>
            The principle method for adding action/context relations is
            <code>addActionContext()</code>. It expects two arguments, the
            action to which the context is being added, and either the name of a
            context or an array of contexts. As an example, consider the
            following controller class:
        </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function listAction()
    {
    }

    public function viewAction()
    {
    }

    public function commentsAction()
    {
    }

    public function updateAction()
    {
    }
}
?>]]></programlisting>

        <para>
            Let's say we wanted to add an XML context to the 'list' action, and
            XML and JSON contexts to the 'comments' action. We could do so in
            the <code>init()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function init()
    {
        $this->_helper->contextSwitch()
             ->addActionContext('list', 'xml')
             ->addActionContext('comments', array('xml', 'json'))
             ->initContext();
    }
}
?>]]></programlisting>

        <para>
            Alternately, you could simply define the array property
            <code>$contexts</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public $contexts = array(
        'list'     => array('xml'),
        'comments' => array('xml', 'json')
    );

    public function init()
    {
        $this->_helper->contextSwitch()->initContext();
    }
}
?>]]></programlisting>

        <para>
            The above is less overhead, but also prone to potential errors.
        </para>

        <para>
            The following methods can be used to build the context mappings:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>addActionContext($action, $context)</code>: marks one
                    or more contexts as available to an action. If mappings
                    already exists, simply appends to those mappings.
                    <code>$context</code> may be a single context, or an array
                    of contexts.
                </para>

                <para>
                    A value of <code>true</code> for the context will mark
                    all available contexts as available for the action.
                </para>

                <para>
                    An empty value for $context will disable all contexts for
                    the given action.
                </para>
            </listitem>

            <listitem><para>
                    <code>setActionContext($action, $context)</code>: marks one
                    or more contexts as available to an action. If mappings
                    already exists, it replaces them with those specified.
                    <code>$context</code> may be a single context, or an array
                    of contexts.
            </para></listitem>

            <listitem><para>
                    <code>addActionContexts(array $contexts)</code>: add several
                    action/context pairings at once. <code>$contexts</code>
                    should be an associative array of action/context pairs. It
                    proxies to <code>addActionContext()</code>, meaning that if
                    pairings already exist, it appends to them.
            </para></listitem>

            <listitem><para>
                    <code>setActionContexts(array $contexts)</code>: acts like
                    <code>addActionContexts()</code>, but overwrites existing
                    action/context pairs.
            </para></listitem>

            <listitem><para>
                    <code>hasActionContext($action, $context)</code>: determine
                    if a particular action has a give context.
            </para></listitem>

            <listitem><para>
                    <code>getActionContexts($action = null)</code>: returns
                    either all contexts for a given action, or all
                    action/context pairs.
            </para></listitem>

            <listitem><para>
                    <code>removeActionContext($action, $context)</code>: remove
                    one or more contexts from a given action.
                    <code>$context</code> may be a single context or an array of
                    contexts.
            </para></listitem>

            <listitem><para>
                    <code>clearActionContexts($action = null)</code>: remove all
                    contexts from a given action, or from all actions with
                    contexts.
            </para></listitem>
        </itemizedlist>
    </sect4>

    <sect4 id="zend.controller.actionhelpers.contextswitch.initcontext">
        <title>Initializizing Context Switching</title>

        <para>
            To initialize context switching, you need to call
            <code>initContext()</code> in your action controller:
        </para>

        <programlisting role="php"><![CDATA[<?php
class NewsController extends Zend_Controller_Action
{
    public function init()
    {
        $this->_helper->contextSwitch()->initContext();
    }
}
?>]]></programlisting>

        <para>
            In some cases, you may want to force the context used; for instance,
            you may only want to allow the XML context if context switching is
            activated. You can do so by passing the context to
            <code>initContext()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
$contextSwitch->initContext('xml');
?>]]></programlisting>
    </sect4>

    <sect4 id="zend.controller.actionhelpers.contextswitch.misc">
        <title>Additional Functionality</title>

        <para>
            A variety of methods can be used to alter the behaviour of the
            <code>ContextSwitch</code> helper. These include:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setAutoJsonSerialization($flag)</code>: By default,
                    JSON contexts will serialize any view variables to JSON
                    notation and return this as a response. If you wish to
                    create your own response, you should turn this off; this
                    needs to be done prior to the call to
                    <code>initContext()</code>.
                </para>

                <programlisting role="php"><![CDATA[<?php
$contextSwitch->setAutoJsonSerialization(false);
$contextSwitch->initContext();
?>]]></programlisting>

                <para>
                    You can retrieve the value of the flag with
                    <code>getAutoJsonSerialization()</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setSuffix($context, $suffix,
                        $prependViewRendererSuffix)</code>: With this method,
                    you can specify a different suffix to use for a given
                    context. The third argument is used to indicate whether or
                    not to prepend the current ViewRenderer suffix with the new
                    suffix; this flag is enabled by default.
                </para>

                <para>
                    Passing an empty value to the suffix will cause only the
                    ViewRenderer suffix to be used.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>addHeader($context, $header, $content)</code>: Add a
                    response header for a given context. <code>$header</code> is
                    the header name, and <code>$content</code> is the value to
                    pass for that header.
                </para>

                <para>
                    Each context can have multiple headers;
                    <code>addHeader()</code> adds additional headers to the
                    context's header stack.
                </para>

                <para>
                    If the <code>$header</code> specified already exists for the
                    context, an exception will be thrown.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setHeader($context, $header, $content)</code>:
                    <code>setHeader()</code> acts just like
                    <code>addHeader()</code>, except it allows you to overwrite
                    existing context headers.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>addHeaders($context, array $headers)</code>: Add
                    multiple headers at once to a given context. Proxies to
                    <code>addHeader()</code>, so if the header already exists,
                    an exception will be thrown. <code>$headers</code> is an
                    array of header/context pairs.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setHeaders($context, array $headers.)</code>: like
                    <code>addHeaders()</code>, except it proxies to
                    <code>setHeader()</code>, allowing you to overwrite existing
                    headers.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getHeader($context, $header)</code>: retrieve the
                    value of a header for a given context. Returns null if not
                    found.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>removeHeader($context, $header)</code>: remove a
                    single header for a given context.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearHeaders($context, $header)</code>: remove all
                    headers for a given context.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setCallback($context, $trigger, $callback)</code>: set
                    a callback at a given trigger for a given context. Triggers
                    may be either 'init' or 'post' (indicating callback will be
                    called at either context initialization or postDispatch).
                    <code>$callback</code> should be a valid PHP callback.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setCallbacks($context, array $callbacks)</code>: set
                    multiple callbacks for a given context. <code>$callbacks</code> 
                    should be trigger/callback pairs. In actuality, the most callbacks
                    that can be registered are two, one for initialization and
                    one for post processing.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getCallback($context, $trigger)</code>: retrieve a
                    callback for a given trigger in a given context.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getCallbacks($context)</code>: retrieve all callbacks
                    for a given context. Returns an array of trigger/callback
                    pairs.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>removeCallback($context, $trigger)</code>: remove a
                    callback for a given trigger and context.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearCallbacks($context)</code>: remove all
                    callbacks for a given context.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setContextParam($name)</code>: set the request
                    parameter to check when determining if a context switch has
                    been requested. The value defaults to 'format', but this
                    accessor can be used to set an alternate value.
                </para>

                <para>
                    <code>getContextParam()</code> can be used to retrieve the
                    current value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setAutoDisableLayout($flag)</code>: By default,
                    layouts are disabled when a context switch occurs; this is
                    because typically layouts will only be used for returning
                    normal responses, and have no meaning in alternate contexts.
                    However, if you wish to use layouts (perhaps you may have a
                    layout for the new context), you can change this behaviour
                    by passing a true value to
                    <code>setAutoDisableLayout()</code>. You should do this
                    <emphasis>before</emphasis> calling
                    <code>initContext()</code>.
                </para>

                <para>
                    To get the value of this flag, use the accessor
                    <code>getAutoDisableLayout()</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getCurrentContext()</code> can be used to determine
                    what context was detected, if any. This returns null if no
                    context switch occurred, or if called before
                    <code>initContext()</code> has been invoked.
                </para>
            </listitem>
        </itemizedlist>
    </sect4>

    <sect4 id="zend.controller.actionhelpers.contextswitch.ajaxcontext">
        <title>AjaxContext Functionality</title>

        <para>
            The <code>AjaxContext</code> helper extends
            <code>ContextSwitch</code>, so all of the functionality listed for
            <code>ContextSwitch</code> is available to it. There are a few key
            differences, however.
        </para>

        <para>
            First, it uses a different action controller property for
            determining contexts, <code>$ajaxable</code>. This is so you can
            have different contexts used for AJAX versus normal HTTP requests.
            The various <code>*ActionContext*()</code> methods of
            <code>AjaxContext</code> will write to this property.
        </para>

        <para>
            Second, it will only trigger if an XmlHttpRequest has occurred, as
            determined by the request object's <code>isXmlHttpRequest()</code>
            method. Thus, if the context parameter ('format') is passed in the
            request, but the request was not made as an XmlHttpRequest, no
            context switch will trigger.
        </para>

        <para>
            Third, <code>AjaxContext</code> adds an additional context, HTML. In
            this context, it sets the suffix to 'ajax.phtml' in order to
            differentiate the context from a normal request. No additional
            headers are returned.
        </para>

        <example id="zend.controller.actionhelpers.contextswitch.ajaxcontext.example">
            <title>Allowing Actions to Respond To Ajax Requests</title>

            <para>
                In this following example, we're allowing requests to the
                actions 'view', 'form', and 'process' to respond to AJAX
                requests. In the first two cases, 'view' and 'form', we'll
                return HTML snippets with which to update the page; in the
                latter, we'll return JSON.
            </para>

            <programlisting role="php"><![CDATA[<?php
class CommentController extends Zend_Controller_Action
{
    public function init()
    {
        $ajaxContext = $this->_helper->getHelper('AjaxContext');
        $ajaxContext->addActionContext('view', 'html')
                    ->addActionContext('form', 'html')
                    ->addActionContext('process', 'json')
                    ->initContext();
    }

    public function viewAction()
    {
        // Pull a single comment to view.
        // When AjaxContext detected, uses the comment/view.ajax.phtml 
        // view script.
    }

    public function formAction()
    {
        // Render the "add new comment" form.
        // When AjaxContext detected, uses the comment/form.ajax.phtml 
        // view script.
    }

    public function processAction()
    {
        // Process a new comment
        // Return the results as JSON; simply assign the results as view
        // variables, and JSON will be returned.
    }
}
?>]]></programlisting>

            <para>
                On the client end, your AJAX library will simply request the
                endpoints '/comment/view', '/comment/form', and
                '/comment/process', and pass the 'format' parameter:
                '/comment/view/format/html', '/comment/form/format/html',
                '/comment/process/format/json'. (Or you can pass the parameter
                via query string: e.g., "?format=json".)
            </para>
                
            <para>
                Assuming your library passes the 'X-Requested-With:
                XmlHttpRequest' header, these actions will then return the
                appropriate response format.
            </para>
        </example>
    </sect4>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.actionhelpers.flashmessenger">
    <title>FlashMessenger</title>

    <sect4 id="zend.controller.actionhelper.flashmessenger.introduction">
        <title>Introduction</title>
        <para>
            The <code>FlashMessenger</code> helper allows you to pass messages
            that the user may need to see on the next request.  To accomplish
            this, <code>FlashMessenger</code> uses
            <code>Zend_Session_Namespace</code> to store messages for future or
            next request retrieval.  It is generally a good idea that if you
            plan on using <code>Zend_Session</code> or
            <code>Zend_Session_Namespace</code>, that you initialize with
            <code>Zend_Session::start()</code> in your bootstrap file.  (See the
            <link linkend="zend.session.advanced_usage.starting_a_session">Zend_Session</link>
            documentation for more details on its usage.)
        </para>

    </sect4>

    <sect4 id="zend.controller.actionhelper.flashmessenger.basicusage">
        <title>Basic Usage Example</title>
        <para>
            The usage example below shows the use of the flash messenger at its
            most basic. When the action <code>/some/my</code> is called, it adds
            the flash message "Record Saved!" A subsequent request to the action
            <code>/some/my-next-request</code> will retrieve it (and thus delete
            it as well).
        </para>

        <programlisting role="php"><![CDATA[<?php
class SomeController extends Zend_Controller_Action
{
    /**
     * FlashMessenger
     *
     * @var Zend_Controller_Action_Helper_FlashMessenger
     */
    protected $_flashMessenger = null;

    public function init()
    {
        $this->_flashMessenger = $this->_helper->getHelper('FlashMessenger');
        $this->initView();
    }

    public function myAction()
    {
        /**
         * default method of getting Zend_Controller_Action_Helper_FlashMessenger
         * instance on-demand
         */
        $this->_flashMessenger->addMessage('Record Saved!');
    }

    public function myNextRequestAction()
    {
        $this->view->messages = $this->_flashMessenger->getMessages();
        $this->render();
    }
}]]>
        </programlisting>
    </sect4>
</sect3>
<sect3 id="zend.controller.actionhelpers.json">
    <title>JSON</title>

    <para>
        JSON responses are rapidly becoming the response of choice when dealing
        with AJAX requests that expect dataset responses; JSON can be
        immediately parsed on the client-side, leading to quick execution.
    </para>

    <para>
        The JSON action helper does several things:
    </para>

    <itemizedlist>
        <listitem><para>
                Disables layouts if currently enabled.
        </para></listitem>

        <listitem><para>
                Disables the ViewRenderer if currently enabled.
        </para></listitem>

        <listitem><para>
                Sets the 'Content-Type' response header to 'application/json'.
        </para></listitem>

        <listitem><para>
                By default, immediately returns the response, without waiting
                for the action to finish execution.
        </para></listitem>
    </itemizedlist>

    <para>
        Usage is simple: either call it as a method of the helper broker, or
        call one of the methods <code>encodeJson()</code> or
        <code>sendJson()</code>:
    </para>

    <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // do some processing...
        // Send the JSON response:
        $this->_helper->json($data);

        // or...
        $this->_helper->json->sendJson($data);

        // or retrieve the json:
        $json = $this->_helper->json->encodeJson($data);
    }
}
?>]]></programlisting>

    <note>
        <title>Keeping Layouts</title>

        <para>
            If you have a separate layout for JSON responses -- perhaps to wrap
            the JSON response in some sort of context -- each method in the JSON
            helper accepts a second, optional argument: a flag to enable or
            disable layouts. Passing a boolean <code>true</code> value will keep
            layouts enabled:
        </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // Retrieve the json, keeping layouts:
        $json = $this->_helper->json->encodeJson($data, true);
    }
}
?>]]></programlisting>
    </note>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.actionhelpers.redirector">
    <title>Redirector</title>

    <sect4 id="zend.controller.actionhelper.redirector.introduction">
        <title>Introduction</title>

        <para>
            The <code>Redirector</code> helper allows you to use a redirector
            object to fufill your application's needs for redirecting to a new
            URL. It provides numerous benefits over the
            <code>_redirect()</code> method, such as being able to preconfigure
            sitewide behavior into the redirector object or using the built in
            <code>goto($action, $controller, $module, $params)</code> interface
            similar to that of <code>Zend_Controller_Action::_forward()</code>.
        </para>

        <para>
            The <code>Redirector</code> has a number of methods that can be used
            to affect the behaviour at redirect:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setCode()</code> can be used to set the HTTP response
                    code to use during the redirect.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setExit()</code> can be used to force an
                    <code>exit()</code> following a redirect. By default this is
                    true.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setGoto()</code> can be used to set a default URL to
                    use if none is passed to <code>goto()</code>. Uses the API
                    of <code>Zend_Controller_Action::_forward()</code>:
                    setgoto($action, $controller = null, $module = null, array
                    $params = array());
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setGotoRoute()</code> can be used to set a URL
                    based on a registered route. Pass in an array of key/value
                    pairs and a route name, and it will assemble the URL
                    according to the route type and definition.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setGotoUrl()</code> can be used to set a default URL to
                    use if none is passed to <code>gotoUrl()</code>. Accepts a
                    single URL string.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setPrependBase()</code> can be used to prepend the
                    request object's base URL to a URL specified with
                    <code>setGotoUrl()</code>, <code>gotoUrl()</code>, or
                    <code>gotoUrlAndExit()</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setUseAbsoluteUri()</code> can be used to force the
                    <code>Redirector</code> to use absolute URIs when
                    redirecting. When this option is set, it uses the value of
                    <code>$_SERVER['HTTP_HOST']</code>,
                    <code>$_SERVER['SERVER_PORT']</code>, and
                    <code>$_SERVER['HTTPS']</code> to form a full URI to the URL
                    specified by one of the redirect methods. This option is off
                    by default, but may be enabled by default in later releases.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            Additionally, there are a variety of methods in the redirector for
            performing the actual redirects:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>goto()</code> uses <code>setGoto()</code>
                    (<code>_forward()-like API</code>) to build a URL and
                    perform a redirect.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>gotoRoute()</code> uses <code>setGotoRoute()</code>
                    (<code>route-assembly</code>) to build a URL and
                    perform a redirect.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>gotoUrl()</code> uses <code>setGotoUrl()</code>
                    (<code>URL string</code>) to build a URL and
                    perform a redirect.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            Finally, you can determine the current redirect URL at any time
            using <code>getRedirectUrl()</code>.
        </para>
    </sect4>

    <sect4 id="zend.controller.actionhelper.redirector.basicusage">
        <title>Basic Usage Examples</title>

        <example id="zend.controller.actionhelper.redirector.basicusage.example-1">
            <title>Setting Options</title>

            <para>
                This example overrides several options, including setting the
                HTTP status code to use in the redirect ('303'), not defaulting
                to exit on redirect, and defining a default URL to use when
                redirecting.
            </para>

            <programlisting role="php"><![CDATA[<?php
class SomeController extends Zend_Controller_Action
{
    /**
     * Redirector - defined for code completion
     *
     * @var Zend_Controller_Action_Helper_Redirector
     */
    protected $_redirector = null;

    public function init()
    {
        $this->_redirector = $this->_helper->getHelper('Redirector');

        // Set the default options for the redirector
        // Since the object is registered in the helper broker, these become
        // relevant for all actions from this point forward
        $this->_redirector->setCode('303')
                          ->setExit(false)
                          ->setGoto("this-action", "some-controller");
    }

    public function myAction()
    {
        /* do some stuff */

        // Redirect to a previously registered URL, and force an exit to occur
        // when done:
        $this->_redirector->redirectAndExit();
        return; // never reached
    }
}]]>
            </programlisting>
        </example>

        <example id="zend.controller.actionhelper.redirector.basicusage.example-2">
            <title>Using Defaults</title>

            <para>
                This example assumes that the defaults are used, which means
                that any redirect will result in an immediate
                <code>exit()</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
// ALTERNATIVE EXAMPLE
class AlternativeController extends Zend_Controller_Action
{
    /**
     * Redirector - defined for code completion
     *
     * @var Zend_Controller_Action_Helper_Redirector
     */
    protected $_redirector = null;

    public function init()
    {
        $this->_redirector = $this->_helper->getHelper('Redirector');
    }

    public function myAction()
    {
        /* do some stuff */

        $this->_redirector->gotoUrl('/my-controller/my-action/param1/test/param2/test2');
        return; // never reached since default is to goto and exit
    }
}]]>
            </programlisting>
        </example>

        <example id="zend.controller.actionhelper.redirector.basicusage.example-3">
            <title>Using goto()'s _forward() API</title>

            <para>
                <code>goto()</code>'s API mimics that of
                <code>Zend_Controller_Action::_forward()</code>. The primary
                difference is that it builds a URL from the parameters passed,
                and using the default <code>:module/:controller/:action/*</code>
                format of the default router. It then redirects instead of
                chaining the action.
            </para>

            <programlisting role="php"><![CDATA[<?php
class ForwardController extends Zend_Controller_Action
{
    /**
     * Redirector - defined for code completion
     *
     * @var Zend_Controller_Action_Helper_Redirector
     */
    protected $_redirector = null;

    public function init()
    {
        $this->_redirector = $this->_helper->getHelper('Redirector');
    }

    public function myAction()
    {
        /* do some stuff */

        // Redirect to 'my-action' of 'my-controller' in the current module,
        // using the params param1 => test and param2 => test2
        $this->_redirector->goto('my-action', 'my-controller', null, array('param1' => 'test', 'param2' => 'test2'));
    }
}]]>
            </programlisting>
        </example>

        <example id="zend.controller.actionhelper.redirector.basicusage.example-4">
            <title>Using route assembly with gotoRoute()</title>

            <para>
                The following example uses the <link
                    linkend="zend.controller.router">router's</link>
                <code>assemble()</code> method to create a URL based on an
                associative array of parameters passed. It assumes the following
                route has been registered:
            </para>

            <programlisting role="php"><![CDATA[<?php
$route = new Zend_Controller_Router_Route(
    'blog/:year/:month/:day/:id',
    array('controller' => 'archive', 'module' => 'blog', 'action' => 'view')
);
$router->addRoute('blogArchive', $route);]]>
            </programlisting>

            <para>
                Given an array with year set to 2006, month to 4, day to 24, and
                id to 42, it would then build the URL
                <code>/blog/2006/4/24/42</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
class BlogAdminController extends Zend_Controller_Action
{
    /**
     * Redirector - defined for code completion
     *
     * @var Zend_Controller_Action_Helper_Redirector
     */
    protected $_redirector = null;

    public function init()
    {
        $this->_redirector = $this->_helper->getHelper('Redirector');
    }

    public function returnAction()
    {
        /* do some stuff */

        // Redirect to blog archive. Builds the following URL:
        // /blog/2006/4/24/42
        $this->_redirector->gotoRoute(
            array('year' => 2006, 'month' => 4, 'day' => 24, 'id' => 42),
            'blogArchive'
        );
    }
}]]>
            </programlisting>
        </example>
    </sect4>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.actionhelpers.viewrenderer">
    <title>ViewRenderer</title>

    <sect4 id="zend.controller.actionhelper.viewrenderer.introduction">
        <title>Introduction</title>

        <para>
            The <code>ViewRenderer</code> helper is designed to satisfy the
            following goals:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    Eliminate the need to instantiate view objects within
                    controllers; view objects will be automatically registered
                    with the controller.
                </para>
            </listitem>

            <listitem>
                <para>
                    Automatically set view script, helper, and filter paths
                    based on the current module, and automatically associate
                    the current module name as a class prefix for helper and
                    filter classes.
                </para>
            </listitem>

            <listitem>
                <para>
                    Create a globally available view object for all dispatched
                    controllers and actions.
                </para>
            </listitem>

            <listitem>
                <para>
                    Allow the developer to set default view rendering options
                    for all controllers.
                </para>
            </listitem>

            <listitem>
                <para>
                    Add the ability to automatically render a view script with
                    no intervention.
                </para>
            </listitem>

            <listitem>
                <para>
                    Allow the developer to create her own specifications for
                    the view base path and for view script paths.
                </para>
            </listitem>
        </itemizedlist>

        <note>
            <para>
                If you perform a <code>_forward()</code>, redirect, or
                <code>render</code> manually, autorendering will not occur, as
                by performing any of these actions you are telling the
                <code>ViewRenderer</code> that you are determining your own
                output.
            </para>
        </note>

        <note>
            <para>
                The <code>ViewRenderer</code> is enabled by default. You may
                disable it via the front controller <code>noViewRenderer</code>
                param (<code>$front->setParam('noViewRenderer', true)</code>) or
                removing the helper from the helper broker stack
                (<code>Zend_Controller_Action_HelperBroker::removeHelper('viewRenderer')</code>).
            </para>

            <para>
                If you wish to modify settings of the <code>ViewRenderer</code>
                prior to dispatching the front controller, you may do so in one
                of two ways:
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        Instantiate and register your own
                        <code>ViewRenderer</code> object and pass it to the
                        helper broker:
                    </para>

                    <programlisting role="php"><![CDATA[<?php
$viewRenderer = new Zend_Controller_Action_Helper_ViewRenderer();
$viewRenderer->setView($view)
             ->setViewSuffix('php');
Zend_Controller_Action_HelperBroker::addHelper($viewRenderer);]]>
                    </programlisting>
                </listitem>

                <listitem>
                    <para>
                        Initialize and/or retrieve a <code>ViewRenderer</code>
                        object on demand via the helper broker:
                    </para>

                    <programlisting role="php"><![CDATA[<?php
$viewRenderer = Zend_Controller_Action_HelperBroker::getStaticHelper('viewRenderer');
$viewRenderer->setView($view)
             ->setViewSuffix('php');]]>
                    </programlisting>
                </listitem>
            </itemizedlist>
        </note>
    </sect4>

    <sect4 id="zend.controller.actionhelper.viewrenderer.api">
        <title>API</title>

        <para>
            At its most basic usage, you simply instantiate the
            <code>ViewRenderer</code> and pass it to the action helper broker.
            The easiest way to instantiate it and register in one go is to use
            the helper broker's <code>getStaticHelper()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
Zend_Controller_Action_HelperBroker::getStaticHelper('viewRenderer');]]>
        </programlisting>

        <para>
            The first time an action controller is instantiated, it will trigger
            the <code>ViewRenderer</code> to instantiate a view object. Each
            time a controller is instantiated, the <code>ViewRenderer</code>'s
            <code>init()</code> method is called, which will cause it to set the
            view property of the action controller, and call
            <code>addScriptPath()</code> with a path relative to the current
            module; this will be called with a class prefix named after the
            current module, effectively namespacing all helper and filter
            classes you define for the module.
        </para>

        <para>
            Each time <code>postDispatch()</code> is called, it will call
            <code>render()</code> for the current action.
        </para>

        <para>
            As an example, consider the following class:
        </para>

        <programlisting role="php"><![CDATA[<?php
// A controller class, foo module:
class Foo_BarController extends Zend_Controller_Action
{
    // Render bar/index.phtml by default; no action required
    public function indexAction()
    {
    }

    // Render bar/populate.phtml with variable 'foo' set to 'bar'.
    // Since view object defined at preDispatch(), it's already available.
    public function populateAction()
    {
        $this->view->foo = 'bar';
    }
}

...

// in one of your view scripts:
<?php $this->foo(); // call Foo_View_Helper_Foo::foo()]]>
        </programlisting>

        <para>
            The <code>ViewRenderer</code> also defines a number of accessors to
            allow setting and retrieving view options:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setView($view)</code> allows you to set the view
                    object for the <code>ViewRenderer</code>. It gets set as
                    the public class property <code>$view</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setNeverRender($flag = true)</code> can be used to
                    disable or enable autorendering globally, i.e., for all
                    controllers. If set to true, <code>postDispatch()</code>
                    will not automatically call <code>render()</code> in the
                    current controller.  <code>getNeverRender()</code> retrieves
                    the current value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setNoRender($flag = true)</code> can be used to
                    disable or enable autorendering. If set to true,
                    <code>postDispatch()</code> will not automatically call
                    <code>render()</code> in the current controller. This
                    setting is reset each time <code>preDispatch()</code> is
                    called (i.e., you need to set this flag for each controller
                    for which you don't want autorenderering to occur).
                    <code>getNoRender()</code> retrieves the current value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setNoController($flag = true)</code> can be used to
                    tell <code>render()</code> not to look for the action script
                    in a subdirectory named after the controller (which is the
                    default behaviour). <code>getNoController()</code> retrieves
                    the current value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setNeverController($flag = true)</code> is analogous
                    to <code>setNoController()</code>, but works on a global
                    level -- i.e., it will not be reset for each dispatched
                    action. <code>getNeverController()</code> retrieves
                    the current value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setScriptAction($name)</code> can be used to
                    specify the action script to render. <code>$name</code>
                    should be the name of the script minus the file suffix (and
                    without the controller subdirectory, unless
                    <code>noController</code> has been turned on). If not
                    specified, it looks for a view script named after the action
                    in the request object. <code>getScriptAction()</code>
                    retrieves the current value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setResponseSegment($name)</code> can be used to
                    specify which response object named segment to render into.
                    If not specified, it renders into the default segment.
                    <code>getResponseSegment()</code> retrieves the current
                    value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>initView($path, $prefix, $options)</code> may be called
                    to specify the base view path, class prefix for helper and
                    filter scripts, and <code>ViewRenderer</code> options. You
                    may pass any of the following flags:
                    <code>neverRender</code>, <code>noRender</code>,
                    <code>noController</code>, <code>scriptAction</code>, and
                    <code>responseSegment</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setRender($action = null, $name = null, $noController
                        = false)</code> allows you to set any of
                    <code>scriptAction</code>, <code>responseSegment</code>, and
                    <code>noController</code> in one pass. <code>direct()</code>
                    is an alias to this method, allowing you to call this method
                    easily from your controller:
                </para>

                <programlisting role="php"><![CDATA[
// Render 'foo' instead of current action script
$this->_helper->viewRenderer('foo');

// render form.phtml to the 'html' response segment, without using a
// controller view script subdirectory:
$this->_helper->viewRenderer('form', 'html', true);
]]>
                </programlisting>

                <note><para>
                        <code>setRender()</code> and <code>direct()</code> don't
                        actually render the view script, but instead set hints
                        that <code>postDispatch()</code> and
                        <code>render()</code> will use to render the view.
                </para></note>
            </listitem>
        </itemizedlist>

        <para>
            The constructor allows you to optionally pass the view object and
            <code>ViewRenderer</code> options; it accepts the same flags as
            <code>initView()</code>:
        </para>

        <programlisting role="php"><![CDATA[
$view    = new Zend_View(array('encoding' => 'UTF-8'));
$options = array('noController' => true, 'neverRender' => true);
$viewRenderer = new Zend_Controller_Action_Helper_ViewRenderer($view, $options);
]]>
        </programlisting>

        <para>
            There are several additional methods for customizing path
            specifications used for determining the view base path to add to the
            view object, and the view script path to use when autodetermining
            the view script to render. These methods each take one or more of
            the following placeholders:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>:moduleDir</code> refers to the current module's base
                    directory (by convention, the parent directory of the
                    module's controller directory).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>:module</code> refers to the current module name.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>:controller</code> refers to the current controller name.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>:action</code> refers to the current action name.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>:suffix</code> refers to the view script suffix (which
                    may be set via <code>setViewSuffix()</code>).
                </para>
            </listitem>
        </itemizedlist>

        <para>
            The methods for controlling path specifications are:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setViewBasePathSpec($spec)</code> allows you to change
                    the path specification used to determine the base path to
                    add to the view object. The default specification is
                    <code>:moduleDir/views</code>. You may retrieve the current
                    specification at any time using
                    <code>getViewBasePathSpec()</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setViewScriptPathSpec($spec)</code> allows you to
                    change the path specification used to determine the path to
                    an individual view script (minus the base view script path).
                    The default specification is
                    <code>:controller/:action.:suffix</code>. You may retrieve
                    the current specification at any time using
                    <code>getViewScriptPathSpec()</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setViewScriptPathNoControllerSpec($spec)</code> allows
                    you to change the path specification used to determine the
                    path to an individual view script when
                    <code>noController</code> is in effect (minus the base view
                    script path).  The default specification is
                    <code>:action.:suffix</code>. You may retrieve the current
                    specification at any time using
                    <code>getViewScriptPathNoControllerSpec()</code>.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            For fine-grained control over path specifications, you may use
            <link linkend="zend.filter.inflector">Zend_Filter_Inflector</link>.
            Under the hood, the <code>ViewRenderer</code> uses an inflector to
            perform path mappings already. To interact with the inflector --
            either to set your own for use, or to modify the default inflector,
            the following methods may be used:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>getInflector()</code> will retrieve the inflector. If
                    none exists yet in the <code>ViewRenderer</code>, it creates
                    one using the default rules.
                </para>

                <para>
                    By default, it uses static rule references for the suffix
                    and module directory, as well as a static target; this
                    allows various <code>ViewRenderer</code> properties the
                    ability to dynamically modify the inflector.
                </para>
            </listitem>

            <listitem><para>
                    <code>setInflector($inflector, $reference)</code> allows you
                    to set a custom inflector for use with the
                    <code>ViewRenderer</code>. If <code>$reference</code> is
                    true, it will set the suffix and module directory as static
                    references to <code>ViewRenderer</code> properties, as well
                    as the target.
            </para></listitem>
        </itemizedlist>

        <note>
            <title>Default Lookup Conventions</title>

            <para>
                The <code>ViewRenderer</code> does some path normalization to
                make view script lookups easier. The default rules are as
                follows:
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <code>:module</code>: MixedCase and camelCasedWords are separated by
                        dashes, and the entire string cast to lowercase. E.g.:
                        "FooBarBaz" becomes "foo-bar-baz".
                    </para>

                    <para>
                        Internally, the inflector uses the filters
                        <code>Zend_Filter_Word_CamelCaseToDash</code> and
                        <code>Zend_Filter_StringToLower</code>.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>:controller</code>: MixedCase and camelCasedWords are separated
                        by dashes; underscores are converted to directory
                        separators, and the entire string cast to lower case.
                        Examples: "FooBar" becomes "foo-bar"; "FooBar_Admin"
                        becomes "foo-bar/admin".
                    </para>

                    <para>
                        Internally, the inflector uses the filters
                        <code>Zend_Filter_Word_CamelCaseToDash</code>,
                        <code>Zend_Filter_Word_UnderscoreToSeparator</code>, and
                        <code>Zend_Filter_StringToLower</code>.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>:action</code>: MixedCase and camelCasedWords are separated
                        by dashes; non-alphanumeric characters are translated to
                        dashes, and the entire string cast to lower case.
                        Examples: "fooBar" becomes "foo-bar"; "foo-barBaz"
                        becomes "foo-bar-baz".
                    </para>

                    <para>
                        Internally, the inflector uses the filters
                        <code>Zend_Filter_Word_CamelCaseToDash</code>,
                        <code>Zend_Filter_PregReplace</code>, and
                        <code>Zend_Filter_StringToLower</code>.
                    </para>
                </listitem>
            </itemizedlist>
        </note>

        <para>
            The final items in the <code>ViewRenderer</code> API are the methods
            for actually determining view script paths and rendering views.
            These include:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>renderScript($script, $name)</code> allows you to
                    render a script with a path you specify, optionally to a
                    named path segment. When using this method, the
                    <code>ViewRenderer</code> does no autodetermination of the
                    script name, but instead directly passes the
                    <code>$script</code> argument directly to the view object's
                    <code>render()</code> method.
                </para>

                <note><para>
                    Once the view has been rendered to the response object, it
                    sets the <code>noRender</code> to prevent accidentally
                    rendering the same view script multiple times.
                </para></note>

                <note>
                    <para>
                        By default,
                        <code>Zend_Controller_Action::renderScript()</code>
                        proxies to the <code>ViewRenderer</code>'s
                        <code>renderScript()</code> method.
                    </para>
                </note>
            </listitem>

            <listitem>
                <para>
                    <code>getViewScript($action, $vars)</code> creates the path
                    to a view script based on the action passed and/or any
                    variables passed in <code>$vars</code>. Keys for this array
                    may include any of the path specification keys ('moduleDir',
                    'module', 'controller', 'action', and 'suffix'). Any
                    variables passed will be used; otherwise, values based on
                    the current request will be utlized.
                </para>

                <para>
                    <code>getViewScript()</code> will use either the
                    <code>viewScriptPathSpec</code> or
                    <code>viewScriptPathNoControllerSpec</code> based on the
                    setting of the <code>noController</code> flag.
                </para>

                <para>
                    Word delimiters occurring in module, controller, or action
                    names will be replaced with dashes ('-'). Thus, if you have
                    the controller name 'foo.bar' and the action 'baz:bat',
                    using the default path specification will result in a view
                    script path of 'foo-bar/baz-bat.phtml'.
                </para>

                <note>
                    <para>
                        By default,
                        <code>Zend_Controller_Action::getViewScript()</code>
                        proxies to the <code>ViewRenderer</code>'s
                        <code>getViewScript()</code> method.
                    </para>
                </note>
            </listitem>

            <listitem>
                <para>
                    <code>render($action, $name, $noController)</code> checks
                    first to see if either <code>$name</code> or
                    <code>$noController</code> have been passed, and if so, sets
                    the appropriate flags (responseSegment and noController,
                    respectively) in the ViewRenderer. It then passes the
                    <code>$action</code> argument, if any, on to
                    <code>getViewScript()</code>. Finally, it passes the
                    calculated view script path to <code>renderScript()</code>.
                </para>

                <note>
                    <para>
                        Be aware of the side-effects of using render(): the
                        values you pass for the response segment name and for
                        the noController flag will persist in the object.
                        Additionally, noRender will be set after rendering is
                        completed.
                    </para>
                </note>

                <note>
                    <para>
                        By default,
                        <code>Zend_Controller_Action::render()</code> proxies to
                        the <code>ViewRenderer</code>'s <code>render()</code>
                        method.
                    </para>
                </note>
            </listitem>

            <listitem>
                <para>
                    <code>renderBySpec($action, $vars, $name)</code> allows you
                    to pass path specification variables in order to determine
                    the view script path to create. It passes
                    <code>$action</code> and <code>$vars</code> to
                    <code>getScriptPath()</code>, and then passes the resulting
                    script path and <code>$name</code> on to
                    <code>renderScript()</code>.
                </para>
            </listitem>
        </itemizedlist>
    </sect4>

    <sect4 id="zend.controller.actionhelper.viewrenderer.basicusage">
        <title>Basic Usage Examples</title>

        <example id="zend.controller.actionhelper.viewrenderer.basicusage.example-1">
            <title>Basic Usage</title>

            <para>
                At its most basic, you simply initialize and register the
                <code>ViewRenderer</code> helper with the helper broker in your
                bootstrap, and then set variables in your action methods.
            </para>

            <programlisting role="php"><![CDATA[<?php
// In your bootstrap:
Zend_Controller_Action_HelperBroker::getStaticHelper('viewRenderer');

...

<?php
// 'foo' module, 'bar' controller:
class Foo_BarController extends Zend_Controller_Action
{
    // Render bar/index.phtml by default; no action required
    public function indexAction()
    {
    }

    // Render bar/populate.phtml with variable 'foo' set to 'bar'.
    // Since view object defined at preDispatch(), it's already available.
    public function populateAction()
    {
        $this->view->foo = 'bar';
    }

    // Renders nothing as it forwards to another action; the new action
    // will perform any rendering
    public function bazAction()
    {
        $this->_forward('index');
    }

    // Renders nothing as it redirects to another location
    public function batAction()
    {
        $this->_redirect('/index');
    }
}]]>
            </programlisting>
        </example>

        <note>
            <title>Naming Conventions: Word delimiters in controller and action names</title>
            <para>
                If your controller or action name is composed of several
                words, the dispatcher requires that these are separated on
                the URL by specific path and word delimiter characters. The
                <code>ViewRenderer</code> replaces any path delimiter found
                in the controller name with an actual path delimiter ('/'),
                and any word delimiter found with a dash ('-') when creating
                paths. Thus, a call to the action
                <code>/foo.bar/baz.bat</code> would dispatch to
                <code>FooBarController::bazBatAction()</code> in
                FooBarController.php, which would render
                <code>foo-bar/baz-bat.phtml</code>; a call to the action
                <code>/bar_baz/baz-bat</code> would dispatch to
                <code>Bar_BazController::bazBatAction()</code> in
                <code>Bar/BazController.php</code> (note the path
                separation) and render <code>bar/baz/baz-bat.phtml</code>.
            </para>

            <para>
                Note that the in the second example, the module is still the
                default module, but that, because of the existence of a path
                separator, the controller receives the name
                <code>Bar_BazController</code>, in
                <code>Bar/BazController.php</code>. The ViewRenderer mimics
                the controller directory hierarchy.
            </para>
        </note>

        <example id="zend.controller.actionhelper.viewrenderer.basicusage.example-2">
            <title>Disabling autorender</title>

            <para>
                For some actions or controllers, you may want to turn off the
                autorendering -- for instance, if you're wanting to emit a
                different type of output (XML, JSON, etc), or if you simply want
                to emit nothing. You have two options: turn off all cases of
                autorendering (<code>setNeverRender()</code>), or simply turn it
                off for the current action (<code>setNoRender()</code>).
            </para>

            <programlisting role="php"><![CDATA[<?php
// Baz controller class, bar module:
class Bar_BazController extends Zend_Controller_Action
{
    public function fooAction()
    {
        // Don't auto render this action
        $this->_helper->viewRenderer->setNoRender();
    }
}

// Bat controller class, bar module:
class Bar_BatController extends Zend_Controller_Action
{
    public function preDispatch()
    {
        // Never auto render this controller's actions
        $this->_helper->viewRenderer->setNoRender();
    }
}]]>
            </programlisting>
        </example>

        <note>
            <para>
                In most cases, it makes no sense to turn off autorendering
                globally (ala <code>setNeverRender()</code>), as the only thing
                you then gain from <code>ViewRenderer</code> is the autosetup of
                the view object.
            </para>
        </note>

        <example id="zend.controller.actionhelper.viewrenderer.basicusage.example-3">
            <title>Choosing a different view script</title>

            <para>
                Some situations require that you render a different script than
                one named after the action. For instance, if you have a
                controller that has both add and edit actions, they may both
                display the same 'form' view, albeit with different values set.
                You can easily change the script name used with either
                <code>setScriptAction()</code>, <code>setRender()</code>, or
                calling the helper as a method, which will invoke
                <code>setRender()</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
// Bar controller class, foo module:
class Foo_BarController extends Zend_Controller_Action
{
    public function addAction()
    {
        // Render 'bar/form.phtml' instead of 'bar/add.phtml'
        $this->_helper->viewRenderer('form');
    }

    public function editAction()
    {
        // Render 'bar/form.phtml' instead of 'bar/edit.phtml'
        $this->_helper->viewRenderer->setScriptAction('form');
    }

    public function processAction()
    {
        // do some validation...
        if (!$valid) {
            // Render 'bar/form.phtml' instead of 'bar/process.phtml'
            $this->_helper->viewRenderer->setRender('form');
            return;
        }

        // otherwise continue processing...
    }

}]]>
            </programlisting>
        </example>

        <example id="zend.controller.actionhelper.viewrenderer.basicusage.example-4">
            <title>Modifying the registered view</title>

            <para>
                What if you need to modify the view object -- for instance,
                change the helper paths, or the encoding? You can do so either
                by modifying the view object set in your controller, or by
                grabbing the view object out of the <code>ViewRenderer</code>;
                both are references to the same object.
            </para>

            <programlisting role="php"><![CDATA[<?php
// Bar controller class, foo module:
class Foo_BarController extends Zend_Controller_Action
{
    public function preDispatch()
    {
        // change view encoding
        $this->view->setEncoding('UTF-8');
    }

    public function bazAction()
    {
        // Get view object and set escape callback to 'htmlspecialchars'
        $view = $this->_helper->viewRenderer->view;
        $view->setEscape('htmlspecialchars');
    }
}]]>
            </programlisting>
        </example>
    </sect4>

    <sect4 id="zend.controller.actionhelper.viewrenderer.advancedusage">
        <title>Advanced Usage Examples</title>

        <example id="zend.controller.actionhelper.viewrenderer.advancedusage.example-1">
            <title>Changing the path specifications</title>

            <para>
                In some circumstances, you may decide that the default path
                specifications do not fit your site's needs. For instance, you
                may want to have a single template tree to which you may then
                give access to your designers (this is very typical when using
                <ulink url="http://smarty.php.net/">Smarty</ulink>, for
                instance). In such a case, you may want to hardcode the view
                base path specification, and create an alternate specification
                for the action view script paths themselves.
            </para>

            <para>
                For purposes of this example, let's assume that the base path to
                views should be '/opt/vendor/templates', and that you wish for
                view scripts to be referenced by
                ':moduleDir/:controller/:action.:suffix'; if the noController
                flag has been set, you want to render out of the top level
                instead of in a subdirectory (':action.:suffix'). Finally, you
                want to use 'tpl' as the view script filename suffix.
            </para>

            <programlisting role="php"><![CDATA[<?php
/**
 * In your bootstrap:
 */

// Different view implementation
$view = new ZF_Smarty();

$viewRenderer = new Zend_Controller_Action_Helper_ViewRenderer($view);
$viewRenderer->setViewBasePathSpec('/opt/vendor/templates')
             ->setViewScriptPathSpec(':module/:controller/:action.:suffix')
             ->setViewScriptPathNoControllerSpec(':action.:suffix')
             ->setViewSuffix('tpl');
Zend_Controller_Action_HelperBroker::addHelper($viewRenderer);]]>
            </programlisting>
        </example>

        <example id="zend.controller.actionhelper.viewrenderer.advancedusage.example-2">
            <title>Rendering multiple view scripts from a single action</title>

            <para>
                At times, you may need to render multiple view scripts from a
                single action. This is very straightforward -- simply make
                multiple calls to <code>render()</code>:
            </para>

            <programlisting role="php"><![CDATA[<?php
class SearchController extends Zend_Controller_Action
{
    public function resultsAction()
    {
        // Assume $this->model is the current model
        $this->view->results = $this->model->find($this->_getParam('query', '');

        // render() by default proxies to the ViewRenderer
        // Render first the search form and then the results
        $this->render('form');
        $this->render('results');
    }

    public function formAction()
    {
        // do nothing; ViewRenderer autorenders the view script
    }
}]]>
            </programlisting>
        </example>
    </sect4>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.actionhelpers" xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>Action Helpers</title>

    <sect2 id="zend.controller.actionhelper.introduction">
        <title>Introduction</title>
        <para>
            Action Helpers allow developers to inject runtime and/or on-demand
            functionality into any Action Controllers that extend
            Zend_Controller_Action.  Action Helpers aim to minimize the
            necessity to extend the abstract Action Controller in order to
            inject common Action Controller functionality.
        </para>

        <para>
            There are a number of ways to use Action Helpers.  Action Helpers
            employ the use of a brokerage system, similar to the types of
            brokerage you see in <link
                linkend="zend.view.helpers">Zend_View_Helper</link>, and that
            of <link
                linkend="zend.controller.plugins">Zend_Controller_Plugin</link>.
            Action Helpers (like <code>Zend_View_Helper</code>) may be
            loaded and called on demand, or they may be instantiated at
            request time (bootstrap) or action controller creation time
            (init()).  To understand this more fully, please see the usage
            section below.
        </para>
    </sect2>

    <sect2 id="zend.controller.actionhelper.initialization">
        <title>Helper Initialization</title>

        <para>
            A helper can be initialized in several different ways, based on
            your needs as well as the functionality of that helper.
        </para>

        <para>
            The helper broker is stored as the <code>$_helper</code> member of
            <code>Zend_Controller_Action</code>; use the broker to retrieve or
            call on helpers. Some methods for doing so include:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    Explicitly using <code>getHelper()</code>. Simply pass it a
                    name, and a helper object is returned:
                </para>

                <programlisting role="php"><![CDATA[<?php
$flashMessenger = $this->_helper->getHelper('FlashMessenger');
$flashMessenger->addMessage('We did something in the last request');]]>
                </programlisting>
            </listitem>

            <listitem>
                <para>
                    Use the helper broker's <code>__get()</code> functionality
                    and retrieve the helper as if it were a member property of
                    the broker:
                </para>

                <programlisting role="php"><![CDATA[<?php
$flashMessenger = $this->_helper->FlashMessenger;
$flashMessenger->addMessage('We did something in the last request');]]>
                </programlisting>
            </listitem>

            <listitem>
                <para>
                    Finally, most action helpers implement the method
                    <code>direct()</code> which will call a specific, default
                    method in the helper. In the example of the
                    <code>FlashMessenger</code>, it calls
                    <code>addMessage()</code>:
                </para>

                <programlisting role="php"><![CDATA[<?php
$this->_helper->FlashMessenger('We did something in the last request');]]>
                </programlisting>
            </listitem>
        </itemizedlist>

        <note>
            <para>All of the above examples are functionally equivalent.</para>
        </note>

        <para>
            You may also instantiate helpers explicitly. You may wish to do this
            if using the helper outside of an action controller, or if you wish
            to pass a helper to the helper broker for use by any action.
            Instantiation is as per any other PHP class.
        </para>
    </sect2>

    <sect2 id="zend.controller.actionhelper.broker">
        <title>The Helper Broker</title>

        <para>
            <code>Zend_Controller_Action_HelperBroker</code> handles the details
            of registering helper objects and helper paths, as well as
            retrieving helpers on-demand.
        </para>

        <para>
            To register a helper with the broker, use <code>addHelper</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
Zend_Controller_Action_HelperBroker::addHelper($helper);]]>
        </programlisting>

        <para>
            Of course, instantiating and passing helpers to the broker is a bit
            time and resource intensive, so two methods exists to automate
            things slightly: <code>addPrefix()</code> and
            <code>addPath()</code>.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>addPrefix()</code> takes a class prefix and uses it
                    to determine a path where helper classes have been defined.
                    It assumes the prefix follows Zend Framework class naming
                    conventions.
                </para>

                <programlisting role="php"><![CDATA[<?php
// Add helpers prefixed with My_Action_Helpers in My/Action/Helpers/
Zend_Controller_Action_HelperBroker::addPrefix('My_Action_Helpers');]]>
                </programlisting>
            </listitem>

            <listitem>
                <para>
                    <code>addPath()</code> takes a directory as its first
                    argument and a class prefix as the second argument
                    (defaulting to 'Zend_Controller_Action_Helper'). This allows
                    you to map your own class prefixes to specific directories.
                </para>

                <programlisting role="php"><![CDATA[<?php
// Add helpers prefixed with Helper in Plugins/Helpers/
Zend_Controller_Action_HelperBroker::addPath('./Plugins/Helpers', 'Helper');]]>
                </programlisting>
            </listitem>
        </itemizedlist>

        <para>
            Since these methods are static, they may be called at any point in
            the controller chain in order to dynamically add helpers as needed.
        </para>

        <para>
            To determine if a helper exists in the helper broker, use
            <code>hasHelper($name)</code>, where <code>$name</code> is the short
            name of the helper (minus the prefix):
        </para>

        <programlisting role="php"><![CDATA[<?php
// Check if 'redirector' helper is registered with the broker:
if (Zend_Controller_Action_HelperBroker::hasHelper('redirector')) {
    echo 'Redirector helper registered';
}]]>
        </programlisting>

        <para>
            There are also two static methods for retrieving helpers from the helper
            broker: <code>getExistingHelper()</code> and
            <code>getStaticHelper()</code>. <code>getExistingHelper()</code>
            will retrieve a helper only if it has previously been invoked by or
            explicitly registered with the helper broker; it will throw an
            exception if not. <code>getStaticHelper()</code> does the same as
            <code>getExistingHelper()</code>, but will attempt to instantiate
            the helper if has not yet been registered with the helper stack.
            <code>getStaticHelper()</code> is a good choice for retrieving
            helpers which you wish to configure.
        </para>

        <para>
            Both methods take a single argument, <code>$name</code>, which is
            the short name of the helper (minus the prefix).
        </para>

        <programlisting role="php"><![CDATA[<?php
// Check if 'redirector' helper is registered with the broker, and fetch:
if (Zend_Controller_Action_HelperBroker::hasHelper('redirector')) {
    $redirector = Zend_Controller_Action_HelperBroker::getExistingHelper('redirector');
}

// Or, simply retrieve it, not worrying about whether or not it was previously
// registered:
$redirector = Zend_Controller_Action_HelperBroker::getStaticHelper('redirector');
}]]></programlisting>

        <para>
            Finally, to delete a registered helper from the broker, use
            <code>removeHelper($name)</code>, where <code>$name</code> is the
            short name of the helper (minus the prefix):
        </para>

        <programlisting role="php"><![CDATA[<?php
// Conditionally remove the 'redirector' helper from the broker:
if (Zend_Controller_Action_HelperBroker::hasHelper('redirector')) {
    Zend_Controller_Action_HelperBroker::removeHelper('redirector')
}]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.controller.actionhelper.stockhelpers">
        <title>Built-in Action Helpers</title>

        <para>
            Zend Framework includes several action helpers by default:
            <code>AutoComplete</code> for automating responses for AJAX
            autocompletion; <code>ContextSwitch</code> and
            <code>AjaxContext</code> for serving alternate response formats for
            your actions; a <code>FlashMessenger</code> for handling session
            flash messages; <code>Json</code> for encoding and sending JSON
            responses; a <code>Redirector</code>, to provide different
            implementations for redirecting to internal and external pages from
            your application; and a <code>ViewRenderer</code> to automate the
            process of setting up the view object in your controllers and
            rendering views.
        </para>

        <xi:include href="Zend_Controller-ActionHelpers-ActionStack.xml" />
        <xi:include href="Zend_Controller-ActionHelpers-AutoComplete.xml" />
        <xi:include href="Zend_Controller-ActionHelpers-ContextSwitch.xml" />
        <xi:include href="Zend_Controller-ActionHelpers-FlashMessenger.xml" />
        <xi:include href="Zend_Controller-ActionHelpers-Json.xml" />
        <xi:include href="Zend_Controller-ActionHelpers-Redirector.xml" />
        <xi:include href="Zend_Controller-ActionHelpers-ViewRenderer.xml" />
    </sect2>

    <sect2 id="zend.controller.actionhelper.writingyourown">
        <title>Writing Your Own Helpers</title>

        <para>
            Action helpers extend
            <code>Zend_Controller_Action_Helper_Abstract</code>, an abstract
            class that provides the basic interface and functionality required
            by the helper broker. These include the following methods:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setActionController()</code> is used to set the current
                    action controller.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>init()</code>, triggered by the helper broker at
                    instantiation, can be used to trigger initialization in the
                    helper; this can be useful for resetting state when multiple
                    controllers use the same helper in chained actions.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>preDispatch()</code>, is triggered prior to a
                    dispatched action.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>postDispatch()</code> is triggered when a dispatched
                    action is done -- even if a <code>preDispatch()</code>
                    plugin has skipped the action. Mainly useful for cleanup.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getRequest()</code> retrieves the current request
                    object.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getResponse()</code> retrieves the current response
                    object.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getName()</code> retrieves the helper name. It
                    retrieves the portion of the class name following the last
                    underscore character, or the full class name otherwise. As
                    an example, if the class is named
                    <code>Zend_Controller_Action_Helper_Redirector</code>, it
                    will return <code>Redirector</code>; a class named
                    <code>FooMessage</code> will simply return itself.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            You may optionally include a <code>direct()</code> method in your
            helper class. If defined, it allows you to treat the helper as a
            method of the helper broker, in order to allow easy, one-off usage
            of the helper. As an example, the <link
                linkend="zend.controller.actionhelpers.redirector">redirector</link>
            defines <code>direct()</code> as an alias of <code>goto()</code>,
            allowing use of the helper like this:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Redirect to /blog/view/item/id/42
$this->_helper->redirector('item', 'view', 'blog', array('id' => 42));]]>
        </programlisting>

        <para>
            Internally, the helper broker's <code>__call()</code> method looks
            for a helper named <code>redirector</code>, then checks to see if
            that helper has a defined <code>direct</code> class, and calls it
            with the arguments provided.
        </para>

        <para>
            Once you have created your own helper class, you may provide access
            to it as described in the sections above.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.basics">
    <title>Zend_Controller Basics</title>

    <para>
        The <code>Zend_Controller</code> system is designed to be
        lightweight, modular, and extensible.  It is a minimalist design to
        permit flexibility and some freedom to users while providing enough
        structure so that systems built around <code>Zend_Controller</code>
        share some common conventions and similar code layout.
    </para>

    <para>
        The following diagram depicts the workflow, and the narrative following
        describes in detail the interactions:
    </para>

    <para>
        <inlinegraphic width="483" scale="100" align="center" valign="middle"
            fileref="figures/zend.controller.basics.png" format="PNG" />
    </para>

    <para>
        The <code>Zend_Controller</code> workflow is implemented by several
        components.  While it is not necessary to completely understand the
        underpinnings of all of these components to use the system, having a
        working knowledge of the process is helpful.
    </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Controller_Front</code> orchestrates the entire
                    workflow of the <code>Zend_Controller</code> system.  It is
                    an interpretation of the FrontController pattern.
                    <code>Zend_Controller_Front</code> processes all requests
                    received by the server and is ultimately responsible for
                    delegating requests to ActionControllers
                    (<code>Zend_Controller_Action</code>).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Request_Abstract</code> (often
                    referred to as the <code>Request Object</code>) represents
                    the request environment and provides methods for setting and
                    retrieving the controller and action names and any request
                    parameters. Additionally it keeps track of whether or not
                    the action it contains has been dispatched by
                    <code>Zend_Controller_Dispatcher</code>.  Extensions to the
                    abstract request object can be used to encapsulate the
                    entire request environment, allowing routers to pull
                    information from the request environment in order to set the
                    controller and action names.
                </para>

                <para>
                    By default, <code>Zend_Controller_Request_Http</code> is
                    used, which provides access to the entire HTTP request
                    environment.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Router_Interface</code> is used to
                    define routers.  Routing is the process of examining the
                    request environment to determine which controller, and
                    action of that controller, should receive the request.  This
                    controller, action, and optional parameters are then set in
                    the request object to be processed by
                    <code>Zend_Controller_Dispatcher_Standard</code>.  Routing
                    occurs only once: when the request is initially received and
                    before the first controller is dispatched.
                </para>

                <para>
                    The default router,
                    <code>Zend_Controller_Router_Rewrite</code>, takes a URI
                    endpoint as specified in
                    <code>Zend_Controller_Request_Http</code> and decomposes it
                    into a controller, action, and parameters based on the path
                    information in the url. As an example, the URL
                    <code>http://localhost/foo/bar/key/value</code> would be
                    decoded to use the <code>foo</code> controller,
                    <code>bar</code> action, and specify a parameter
                    <code>key</code> with a value of <code>value</code>.
                </para>

                <para>
                    <code>Zend_Controller_Router_Rewrite</code> can also be used
                    to match arbitrary paths; see <link
                        linkend="zend.controller.router">the router
                        documentation</link> for more information.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Dispatcher_Interface</code> is used to
                    define dispatchers.  Dispatching is the process of pulling
                    the controller and action from the request object and
                    mapping them to a controller file/class and action method in
                    the controller class. If the controller or action do not
                    exist, it handles determining default controllers and
                    actions to dispatch.
                </para>

                <para>
                    The actual dispatching process consists of instantiating the
                    controller class and calling the action method in that
                    class. Unlike routing, which occurs only once, dispatching
                    occurs in a loop. If the request object's dispatched status
                    is reset at any point, the loop will be repeated, calling
                    whatever action is currently set in the request object. The
                    first time the loop finishes with the request object's
                    dispatched status set (boolean true), it will finish
                    processing.
                </para>

                <para>
                    The default dispatcher is
                    <code>Zend_Controller_Dispatcher_Standard</code>. It defines
                    controllers as MixedCasedClasses ending in the word
                    Controller, and action methods as camelCasedMethods ending
                    in the word Action:
                    <code>FooController::barAction()</code>. In this case, the
                    controller would be referred to as <code>foo</code> and
                    the action as <code>bar</code>.
                </para>

                <note>
                    <title>CaseNamingConventions</title>

                    <para>
                        Since humans are notoriously inconsistent at
                        maintaining case sensitivity when typing links, Zend
                        Framework actually normalizes path information to
                        lowercase. This, of course, will affect how you name
                        your controller and actions... or refer to them in
                        links.
                    </para>

                    <para>
                        If you wish to have your controller class or action
                        method name have multiple MixedCasedWords or
                        camelCasedWords, you will need to separate those words
                        on the url with either a '-' or '.' (though you can
                        configure the character used).
                    </para>

                    <para>
                        As an example, if you were going to the action in
                        <code>FooBarController::bazBatAction()</code>, you'd
                        refer to it on the url as <code>/foo-bar/baz-bat</code>
                        or <code>/foo.bar/baz.bat</code>.
                    </para>
                </note>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Action</code> is the base action
                    controller component.  Each controller is a single class
                    that extends the <code>Zend_Controller_Action class</code>
                    and should contain one or more action methods.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Response_Abstract</code> defines a
                    base response class used to collect and return responses
                    from the action controllers. It collects both headers and
                    body content.
                </para>

                <para>
                    The default response class is
                    <code>Zend_Controller_Response_Http</code>, which is
                    suitable for use in an HTTP environment.
                </para>
            </listitem>
        </itemizedlist>

    <para>
        The workflow of <code>Zend_Controller</code> is relatively simple.  A
        request is received by <code>Zend_Controller_Front</code>, which in turn
        calls <code>Zend_Controller_Router_Rewrite</code> to determine which
        controller (and action in that controller) to dispatch.
        <code>Zend_Controller_Router_Rewrite</code> decomposes the URI in order
        to set the controller and action names in the request.
        <code>Zend_Controller_Front</code> then enters a dispatch loop.  It
        calls <code>Zend_Controller_Dispatcher_Standard</code>, passing it the
        request, to dispatch to the controller and action specified in the
        request (or use defaults).  After the controller has finished, control
        returns to <code>Zend_Controller_Front</code>.  If the controller has
        indicated that another controller should be dispatched by resetting the
        dispatched status of the request, the loop continues and another
        dispatch is performed.  Otherwise, the process ends.
    </para>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.dispatcher">
    <title>The Dispatcher</title>

    <sect2 id="zend.controller.dispatcher.overview">
        <title>Overview</title>

        <para>
            Dispatching is the process of taking the request object,
            <code>Zend_Controller_Request_Abstract</code>, extracting the module
            name, controller name, action name, and optional parameters
            contained in it, and then instantiating a controller and calling an
            action of that controller. If any of the module, controller, or
            action are not found, it will use default values for them.
            <code>Zend_Controller_Dispatcher_Standard</code> specifies
            <code>index</code> for each of the controller and action defaults
            and <code>default</code> for the module default value, but allows
            the developer to change the default values for each using the
            <code>setDefaultController()</code>,
            <code>setDefaultAction()</code>, and <code>setDefaultModule()</code>
            methods, respectively.
        </para>

        <note>
            <title>Default Module</title>

            <para>
                When creating modular applications, you may find that you want
                your default module namespaced as well (the default
                configuration is that the default module is
                <emphasis>not</emphasis> namespaced). As of 1.5.0, you can now
                do so by specifying the <code>prefixDefaultModule</code> as true
                in either the front controller or your dispatcher:
            </para>

            <programlisting role="php"><![CDATA[<?php 
// In your front controller:
$front->setParam('prefixDefaultModule', true);

// In your dispatcher:
$dispatcher->setParam('prefixDefaultModule', true);
?>]]></programlisting>

            <para>
                This allows you to re-purpose an existing module to be the
                default module for an application.
            </para>
        </note>

        <para>
            Dispatching happens in a loop in the front controller. Before
            dispatching occurs, the front controller routes the request to find
            user specified values for the module, controller, action, and optional
            parameters. It then enters a dispatch loop, dispatching the request.
        </para>

        <para>
            At the beginning of each iteration, it sets a flag in the request
            object indicating that the action has been dispatched. If an action
            or pre/postDispatch plugin resets that flag, the dispatch loop will
            continue and attempt to dispatch the new request. By changing the
            controller and/or action in the request and resetting the dispatched
            flag, the developer may define a chain of requests to perform.
        </para>

        <para>
            The action controller method that controlls such dispatching is
            <code>_forward()</code>; call this method from any of the
            pre/postDispatch() or action methods, providing an action, controller,
            module, and optionally any additional parameters you may wish to
            send to the new action:
        </para>

        <programlisting role="php"><![CDATA[<?php
public function fooAction()
{
    // forward to another action in the current controller and module:
    $this->_forward('bar', null, null, array('baz' => 'bogus'));
}

public function barAction()
{
    // forward to an action in another controller, FooController::bazAction(),
    // in the current module:
    $this->_forward('baz', 'foo', null, array('baz' => 'bogus'));
}

public function bazAction()
{
    // forward to an action in another controller in another module,
    // Foo_BarController::bazAction():
    $this->_forward('baz', 'bar', 'foo', array('baz' => 'bogus'));
}]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.controller.dispatcher.subclassing">
        <title>Subclassing the Dispatcher</title>

        <para>
            <code>Zend_Controller_Front</code> will first call the router to
            determine the first action in the request. It then enters a dispatch
            loop, which calls on the dispatcher to dispatch the action.
        </para>

        <para>
            The dispatcher needs a variety of data in order to do its work - it
            needs to know how to format controller and action names, where to
            look for controller class files, whether or not a provided module
            name is valid, and an API for determining if a given request is even
            dispatchable based on the other information available.
        </para>

        <para>
            <code>Zend_Controller_Dispatcher_Interface</code> defines the
            following methods as required for any dispatcher implementation:
        </para>

        <programlisting role="php"><![CDATA[
interface Zend_Controller_Dispatcher_Interface
{
    /**
     * Format a string into a controller class name.
     *
     * @param string $unformatted
     * @return string
     */
    public function formatControllerName($unformatted);

    /**
     * Format a string into an action method name.
     *
     * @param string $unformatted
     * @return string
     */
    public function formatActionName($unformatted);

    /**
     * Determine if a request is dispatchable
     *
     * @param  Zend_Controller_Request_Abstract $request
     * @return boolean
     */
    public function isDispatchable(Zend_Controller_Request_Abstract $request);

    /**
     * Set a user parameter (via front controller, or for local use)
     *
     * @param string $name
     * @param mixed $value
     * @return Zend_Controller_Dispatcher_Interface
     */
    public function setParam($name, $value);

    /**
     * Set an array of user parameters
     *
     * @param array $params
     * @return Zend_Controller_Dispatcher_Interface
     */
    public function setParams(array $params);

    /**
     * Retrieve a single user parameter
     *
     * @param string $name
     * @return mixed
     */
    public function getParam($name);

    /**
     * Retrieve all user parameters
     *
     * @return array
     */
    public function getParams();

    /**
     * Clear the user parameter stack, or a single user parameter
     *
     * @param null|string|array single key or array of keys for params to clear
     * @return Zend_Controller_Dispatcher_Interface
     */
    public function clearParams($name = null);

    /**
     * Set the response object to use, if any
     *
     * @param Zend_Controller_Response_Abstract|null $response
     * @return void
     */
    public function setResponse(Zend_Controller_Response_Abstract $response = null);

    /**
     * Retrieve the response object, if any
     *
     * @return Zend_Controller_Response_Abstract|null
     */
    public function getResponse();

    /**
     * Add a controller directory to the controller directory stack
     *
     * @param string $path
     * @param string $args
     * @return Zend_Controller_Dispatcher_Interface
     */
    public function addControllerDirectory($path, $args = null);

    /**
     * Set the directory (or directories) where controller files are stored
     *
     * @param string|array $dir
     * @return Zend_Controller_Dispatcher_Interface
     */
    public function setControllerDirectory($path);

    /**
     * Return the currently set directory(ies) for controller file lookup
     *
     * @return array
     */
    public function getControllerDirectory();

    /**
     * Dispatch a request to a (module/)controller/action.
     *
     * @param  Zend_Controller_Request_Abstract $request
     * @param  Zend_Controller_Response_Abstract $response
     * @return Zend_Controller_Request_Abstract|boolean
     */
    public function dispatch(Zend_Controller_Request_Abstract $request, Zend_Controller_Response_Abstract $response);

    /**
     * Whether or not a given module is valid
     *
     * @param string $module
     * @return boolean
     */
    public function isValidModule($module);
}]]>
        </programlisting>

        <para>
            In most cases, however, you should simply extend the abstract class
            <code>Zend_Controller_Dispatcher_Abstract</code>, in which each of
            these have already been defined, or
            <code>Zend_Controller_Dispatcher_Standard</code> to modify
            functionality of the standard dispatcher.
        </para>

        <para>
            Possible reasons to subclass the dispatcher include a desire to
            use a different class or method naming schema in your action
            controllers, or a desire to use a different dispatching paradigm
            such as dispatching to action files under controller directories
            (instead of dispatching to class methods).
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.exceptions">
    <title>MVC Exceptions</title>

    <sect2 id="zend.controller.exceptions.introduction">
        <title>Introduction</title>

        <para>
            The MVC components in Zend Framework utilize a Front Controller,
            which means that all requests to a given site will go through a
            single entry point. As a result, all exceptions bubble up to the
            Front Controller eventually, allowing the developer to handle them
            in a single location.
        </para>

        <para>
            However, exception messages and backtrace information often contain
            sensitive system information, such as SQL statements, file
            locations, and more. To help protect your site, by default
            <code>Zend_Controller_Front</code> catches all exceptions and
            registers them with the response object; in turn, by default, the
            response object does not display exception messages.
        </para>
    </sect2>

    <sect2 id="zend.controller.exceptions.handling">
        <title>How can you handle exceptions?</title>

        <para>
            Several mechanisms are built in to the MVC components already to
            allow you to handle exceptions.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    By default, the <link
                        linkend="zend.controller.plugins.standard.errorhandler">error
                    handler plugin</link> is registered and active. This plugin
                    was designed to handle:
                </para>

                <itemizedlist>
                    <listitem><para>Errors due to missing controllers or actions</para></listitem>

                    <listitem><para>Errors occurring within action controllers</para></listitem>
                </itemizedlist>

                <para>
                    It operates as a <code>postDispatch()</code> plugin, and
                    checks to see if a dispatcher, action controller, or
                    other exception has occurred. If so, it forwards to an error
                    handler controller.
                </para>

                <para>
                    This handler will cover most exceptional situations, and
                    handle missing controllers and actions gracefully.
                </para>
            </listitem>

            <listitem>
                <para><code>Zend_Controller_Front::throwExceptions()</code></para>

                <para>
                    By passing a boolean true value to this method, you can tell
                    the front controller that instead of aggregating exceptions
                    in the response object or using the error handler plugin,
                    you'd rather handle them yourself.  As an example:
                </para>

                <programlisting role="php"><![CDATA[<?php
$front->throwExceptions(true);
try {
    $front->dispatch();
} catch (Exception $e) {
    // handle exceptions yourself
}]]>
                </programlisting>

                <para>
                    This method is probably the easiest way to add custom
                    exception handling covering the full range of possible
                    exceptions to your front controller application.
                </para>
            </listitem>

            <listitem>
                <para><code>Zend_Controller_Response_Abstract::renderExceptions()</code></para>

                <para>
                    By passing a boolean true value to this method, you tell the
                    response object that it should render an exception message
                    and backtrace when rendering itself. In this scenario, any
                    exception raised by your application will be displayed. This
                    is only recommended for non-production environments.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Front::returnResponse()</code> and
                    <code>Zend_Controller_Response_Abstract::isException()</code>.
                </para>

                <para>
                    By passing a boolean true to
                    <code>Zend_Controller_Front::returnResponse()</code>,
                    <code>Zend_Controller_Front::dispatch()</code> will not render the
                    response, but instead return it. Once you have the response,
                    you may then test to see if any exceptions were trapped using
                    its <code>isException()</code> method, and retrieving the exceptions via
                    the <code>getException()</code> method. As an example:
                </para>

                <programlisting role="php"><![CDATA[<?php
$front->returnResponse(true);
$response = $front->dispatch();
if ($response->isException()) {
    $exceptions = $response->getException();
    // handle exceptions ...
} else {
    $response->sendHeaders();
    $response->outputBody();
}]]>
                </programlisting>

                <para>
                    The primary advantage this method offers over
                    <code>Zend_Controller_Front::throwExceptions()</code> is to
                    allow you to conditionally render the response after
                    handling the exception. This will catch any exception in the
                    controller chain, unlike the error handler plugin.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.exceptions.internal">
        <title>MVC Exceptions You May Encounter</title>

        <para>
            The various MVC components -- request, router, dispatcher, action
            controller, and response objects -- may each throw exceptions on
            occasion. Some exceptions may be conditionally overridden, and
            others are used to indicate the developer may need to consider
            their application structure.
        </para>

        <para>As some examples:</para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Controller_Dispatcher::dispatch()</code> will,
                    by default, throw an exception if an invalid controller is
                    requested.  There are two recommended ways to deal with
                    this.
                </para>

                <itemizedlist>
                    <listitem>
                        <para>Set the <code>useDefaultControllerAlways</code> parameter.</para>

                        <para>
                            In your front controller, or your dispatcher, add
                            the following directive:
                        </para>

                        <programlisting role="php"><![CDATA[<?php
$front->setParam('useDefaultControllerAlways', true);

// or
$dispatcher->setParam('useDefaultControllerAlways', true);]]>
                        </programlisting>

                        <para>
                            When this flag is set, the dispatcher will use the
                            default controller and action instead of throwing an
                            exception. The disadvantage to this method is that
                            any typos a user makes when accessing your site will
                            still resolve and display your home page, which can
                            wreak havoc with search engine optimization.
                        </para>
                    </listitem>

                    <listitem>
                        <para>
                            The exception thrown by <code>dispatch()</code> is
                            a <code>Zend_Controller_Dispatcher_Exception</code>
                            containing the text 'Invalid controller specified'.
                            Use one of the methods outlined in <link
                                linkend="zend.controller.exceptions.handling">the
                                previous section</link> to catch the exception,
                            and then redirect to a generic error page or the
                            home page.
                        </para>
                    </listitem>
                </itemizedlist>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Action::__call()</code> will throw a
                    <code>Zend_Controller_Action_Exception</code> if it cannot
                    dispatch a non-existent action to a method. Most likely,
                    you will want to use some default action in the controller
                    in cases like this. Ways to achieve this include:
                </para>

                <itemizedlist>
                    <listitem>
                        <para>
                            Subclass <code>Zend_Controller_Action</code> and
                            override the <code>__call()</code> method. As an
                            example:
                        </para>

                        <programlisting role="php"><![CDATA[<?php
class My_Controller_Action extends Zend_Controller_Action
{
    public function __call($method, $args)
    {
        if ('Action' == substr($method, -6)) {
            $controller = $this->getRequest()->getControllerName();
            $url = '/' . $controller . '/index';
            return $this->_redirect($url);
        }

        throw new Exception('Invalid method');
    }
}]]>
                        </programlisting>
                        <para>
                            The example above intercepts any undefined action
                            method called and redirects it to the default action
                            in the controller.
                        </para>
                    </listitem>

                    <listitem>
                        <para>
                            Subclass <code>Zend_Controller_Dispatcher</code>
                            and override the <code>getAction()</code> method to
                            verify the action exists.  As an example:
                        </para>

                        <programlisting role="php"><![CDATA[<?php
class My_Controller_Dispatcher extends Zend_Controller_Dispatcher
{
    public function getAction($request)
    {
        $action = $request->getActionName();
        if (empty($action)) {
            $action = $this->getDefaultAction();
            $request->setActionName($action);
            $action = $this->formatActionName($action);
        } else {
            $controller = $this->getController();
            $action     = $this->formatActionName($action);
            if (!method_exists($controller, $action)) {
                $action = $this->getDefaultAction();
                $request->setActionName($action);
                $action = $this->formatActionName($action);
            }
        }

        return $action;
    }
}]]>
                        </programlisting>

                        <para>
                            The above code checks to see that the requested
                            action exists in the controller class; if not, it
                            resets the action to the default action.
                        </para>

                        <para>
                            This method is nice becauase you can transparently
                            alter the action prior to final dispatch. However,
                            it also means that typos in the URL may still
                            dispatch correctly, which is not great for search
                            engine optimization.
                        </para>
                    </listitem>

                    <listitem>
                        <para>
                            Use
                            <code>Zend_Controller_Action::preDispatch()</code>
                            or
                            <code>Zend_Controller_Plugin_Abstract::preDispatch()</code>
                            to identify invalid actions.
                        </para>

                        <para>
                            By subclassing <code>Zend_Controller_Action</code>
                            and modifying <code>preDispatch()</code>, you can
                            modify all of your controllers to forward to
                            another action or redirect prior to actually
                            dispatching the action. The code for this will look
                            similar to the code for overriding
                            <code>__call()</code>, above.
                        </para>

                        <para>
                            Alternatively, you can check this information in a
                            global plugin. This has the advantage of being
                            action controller independent; if your application
                            consists of a variety of action controllers, and not
                            all of them inherit from the same class, this method
                            can add consistency in handling your various
                            classes.
                        </para>

                        <para>
                            As an example:
                        </para>

                        <programlisting role="php"><![CDATA[<?php
class My_Controller_PreDispatchPlugin extends Zend_Controller_Plugin_Abstract
{
    public function preDispatch(Zend_Controller_Request_Abstract $request)
    {
        $dispatcher = Zend_Controller_Front::getInstance()->getDispatcher();
        $controller = $dispatcher->getController($request);
        if (!$controller) {
            $controller = $dispatcher->getDefaultControllerName($request);
        }
        $action     = $dispatcher->getAction($request);

        if (!method_exists($controller, $action)) {
            $defaultAction = $dispatcher->getDefaultAction();
            $controllerName = $request->getControllerName();
            $response = Zend_Controller_Front::getInstance()->getResponse();
            $response->setRedirect('/' . $controllerName . '/' . $defaultAction);
            $response->sendHeaders();
            exit;
        }
    }
}]]>
                        </programlisting>

                        <para>
                            In this example, we check to see if the action
                            requested is available in the controller. If not, we
                            redirect to the default action in the controller,
                            and exit script execution immediately.
                        </para>
                    </listitem>
                </itemizedlist>
            </listitem>
        </itemizedlist>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.front">
    <title>The Front Controller</title>

    <sect2 id="zend.controller.front.overview">
        <title>Overview</title>

        <para>
            <code>Zend_Controller_Front</code> implements a <ulink
                url="http://www.martinfowler.com/eaaCatalog/frontController.html">Front
                Controller pattern</ulink> used in <ulink
                url="http://en.wikipedia.org/wiki/Model-view-controller">Model-View-Controller
                (MVC)</ulink> applications. Its purpose is to initialize the
            request environment, route the incoming request, and then dispatch
            any discovered actions; it aggregates any responses and returns them
            when the process is complete.
        </para>

        <para>
            <code>Zend_Controller_Front</code> also implements the <ulink
                url="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton
            pattern</ulink>, meaning only a single instance of it may be available at
            any given time. This allows it to also act as a registry on which
            the other objects in the dispatch process may draw.
        </para>

        <para>
            <code>Zend_Controller_Front</code> registers a <link
                linkend="zend.controller.plugins">plugin broker</link> with
            itself, allowing various events it triggers to be observed by
            plugins. In most cases, this gives the developer the opportunity to
            tailor the dispatch process to the site without the need to extend
            the front controller to add functionality.
        </para>

        <para>
            At a bare minimum, the front controller needs one or more paths to
            directories containing <link linkend="zend.controller.action">action
                controllers</link> in order to do its work. A variety of methods
            may also be invoked to further tailor the front controller
            environment and that of its helper classes.
        </para>

        <note>
            <title>Default Behaviour</title>
            <para>
                By default, the front controller loads the <link
                    linkend="zend.controller.plugins.standard.errorhandler">ErrorHandler</link>
                plugin, as well as the <link
                    linkend="zend.controller.actionhelpers.viewrenderer">ViewRenderer</link>
                action helper plugin. These are to simplify error handling and
                view renderering in your controllers, respectively.
            </para>

            <para>
                To disable the <code>ErrorHandler</code>, perform the following
                at any point prior to calling <code>dispatch()</code>:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Disable the ErrorHandler plugin:
$front->setParam('noErrorHandler', true);]]>
            </programlisting>

            <para>
                To disable the <code>ViewRenderer</code>, do the following prior
                to calling <code>dispatch()</code>:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Disable the ViewRenderer helper:
$front->setParam('noViewRenderer', true);]]>
            </programlisting>
        </note>
    </sect2>

    <sect2 id="zend.controller.front.methods.primary">
        <title>Primary Methods</title>

        <para>
            The front controller has several accessors for setting up its
            environment. However, there are three primary methods key to the
            front controller's functionality:
        </para>

        <sect3 id="zend.controller.front.methods.primary.getinstance">
            <title>getInstance()</title>

            <para>
                <code>getInstance()</code> is used to retrieve a front
                controller instance. As the front controller implements a
                Singleton pattern, this is also the only means possible for
                instantiating a front controller object.
            </para>

            <programlisting role="php"><![CDATA[<?php
$front = Zend_Controller_Front::getInstance();]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.controller.front.methods.primary.setcontrollerdirectory">
            <title>setControllerDirectory() and addControllerDirectory</title>

            <para>
                <code>setControllerDirectory()</code> is used to tell <link
                    linkend="zend.controller.dispatcher">the dispatcher</link>
                where to look for <link
                    linkend="zend.controller.action">action controller</link>
                class files.  It accepts either a single path or an associative
                array of module/path pairs.
            </para>

            <para>
                As some examples:
            </para>

            <programlisting role="php"><![CDATA[
// Set the default controller directory:
$front->setControllerDirectory('../application/controllers');

// Set several module directories at once:
$front->setControllerDirectory(array(
    'default' => '../application/controllers',
    'blog'    => '../modules/blog/controllers',
    'news'    => '../modules/news/controllers',
));

// Add a 'foo' module directory:
$front->addControllerDirectory('../modules/foo/controllers', 'foo');]]>
            </programlisting>

            <note>
                <para>
                    If you use <code>addControllerDirectory()</code> without a
                    module name, it will set the directory for the
                    <code>default</code> module -- overwriting it if it already
                    exists.
                </para>
            </note>

            <para>
                You can get the current settings for the controller directory
                using <code>getControllerDirectory()</code>; this will return an
                array of module/directory pairs.
            </para>
        </sect3>

        <sect3 id="zend.controller.front.methods.primary.dispatch">
            <title>dispatch()</title>

            <para>
                <code>dispatch(Zend_Controller_Request_Abstract $request = null,
                    Zend_Controller_Response_Abstract $response = null)</code>
                does the heavy work of the front controller. It may optionally
                take a <link linkend="zend.controller.request">request
                    object</link> and/or a <link
                    linkend="zend.controller.response">response object</link>,
                allowing the developer to pass in custom objects for each.
            </para>

            <para>
                If no request or response object are passed in,
                <code>dispatch()</code> will check for previously registered
                objects and use those or instantiate default versions to use in
                its process (in both cases, the HTTP flavor will be used as the
                default).
            </para>

            <para>
                Similarly, <code>dispatch()</code> checks for registered <link
                    linkend="zend.controller.router">router</link> and <link
                    linkend="zend.controller.dispatcher">dispatcher</link>
                objects, instantiating the default versions of each if none is
                found.
            </para>

            <para>
                The dispatch process has three distinct events:
            </para>

            <itemizedlist>
                <listitem><para>Routing</para></listitem>
                <listitem><para>Dispatching</para></listitem>
                <listitem><para>Response</para></listitem>
            </itemizedlist>

            <para>
                Routing takes place exactly once, using the values in the
                request object when <code>dispatch()</code> is called.
                Dispatching takes place in a loop; a request may either indicate
                multiple actions to dispatch, or the controller or a plugin may
                reset the request object to force additional actions to
                dispatch. When all is done, the front controller returns a
                response.
            </para>
        </sect3>

        <sect3 id="zend.controller.front.methods.primary.run">
            <title>run()</title>

            <para>
                <code>Zend_Controller_Front::run($path)</code> is a static
                method taking simply a path to a directory containing
                controllers. It fetches a front controller instance (via
                <link
                    linkend="zend.controller.front.methods.primary.getinstance">getInstance()</link>,
                registers the path provided via <link
                    linkend="zend.controller.front.methods.primary.setcontrollerdirectory">setControllerDirectory()</link>,
                and finally <link
                    linkend="zend.controller.front.methods.primary.dispatch">dispatches</link>.
            </para>

            <para>
                Basically, <code>run()</code> is a convenience method that can
                be used for site setups that do not require customization of the
                front controller environment.
            </para>

            <programlisting role="php"><![CDATA[<?php
// Instantiate front controller, set controller directory, and dispatch in one
// easy step:
Zend_Controller_Front::run('../application/controllers');]]>
            </programlisting>
        </sect3>
    </sect2>

    <sect2 id="zend.controller.front.methods.environment">
        <title>Environmental Accessor Methods</title>

        <para>
            In addition to the methods listed above, there are a number of
            accessor methods that can be used to affect the front controller
            environment -- and thus the environment of the classes to which the
            front controller delegates.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>resetInstance()</code> can be used to clear all
                    current settings. Its primary purpose is for testing, but it
                    can also be used for instances where you wish to chain
                    together multiple front controllers.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>(set|get)DefaultControllerName()</code> let you
                    specify a different name to use for the default controller
                    ('index' is used otherwise) and retrieve the current value.
                    They proxy to <link
                        linkend="zend.controller.dispatcher">the
                        dispatcher</link>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>(set|get)DefaultActionName()</code> let you specify a
                    different name to use for the default action ('index' is
                    used otherwise) and retrieve the current value.  They proxy
                    to <link linkend="zend.controller.dispatcher">the
                        dispatcher</link>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>(set|get)Request()</code> let you specify <link
                        linkend="zend.controller.request">the request</link>
                    class or object to use during the dispatch process and to
                    retrieve the current object. When setting the request
                    object, you may pass in a request class name, in which case
                    the method will load the class file and instantiate it.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>(set|get)Router()</code> let you specify <link
                        linkend="zend.controller.router">the router</link>
                    class or object to use during the dispatch process and to
                    retrieve the current object. When setting the router
                    object, you may pass in a router class name, in which case
                    the method will load the class file and instantiate it.
                </para>

                <para>
                    When retrieving the router object, it first checks to see if
                    one is present, and if not, instantiates the default router
                    (rewrite router).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>(set|get)BaseUrl()</code> let you specify <link
                        linkend="zend.controller.request.http.baseurl">the base
                        URL</link> to strip when routing requests and to
                    retrieve the current value. The value is provided to the
                    request object just prior to routing.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>(set|get)Dispatcher()</code> let you specify <link
                        linkend="zend.controller.dispatcher">the
                        dispatcher</link> class or object to use during the
                    dispatch process and retrieve the current object. When
                    setting the dispatcher object, you may pass in a dispatcher
                    class name, in which case the method will load the class
                    file and instantiate it.
                </para>

                <para>
                    When retrieving the dispatcher object, it first checks to see if
                    one is present, and if not, instantiates the default
                    dispatcher.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>(set|get)Response()</code> let you specify <link
                        linkend="zend.controller.response">the response</link>
                    class or object to use during the dispatch process and to
                    retrieve the current object. When setting the response
                    object, you may pass in a response class name, in which case
                    the method will load the class file and instantiate it.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>registerPlugin(Zend_Controller_Plugin_Abstract $plugin, $stackIndex = null)</code>
                    allows you to register a <link
                        linkend="zend.controller.plugins">plugin objects</link>.
                    By setting the optional <code>$stackIndex</code>, you can
                    control the order in which plugins will execute.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>unregisterPlugin($plugin)</code> let you 
                    unregister <link
                        linkend="zend.controller.plugins">plugin objects</link>.
                    <code>$plugin</code> may be either a plugin object or a
                    string denoting the class of plugin to unregister.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>throwExceptions($flag)</code> is used to turn on/off
                    the ability to throw exceptions during the dispatch process.
                    By default, exceptions are caught and placed in the <link
                        linkend="zend.controller.response">response
                        object</link>; turning on <code>throwExceptions()</code>
                    will override this behaviour.
                </para>

                <para>
                    For more information, read <xref
                        linkend="zend.controller.exceptions" />.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>returnResponse($flag)</code> is used to tell the front
                    controller whether to return the response
                    (<code>true</code>) from <code>dispatch()</code>, or if the
                    response should be automatically emitted
                    (<code>false</code>).  By default, the response is
                    automatically emitted (by calling
                    <code>Zend_Controller_Response_Abstract::sendResponse()</code>);
                    turning on <code>returnResponse()</code> will override this
                    behaviour.
                </para>

                <para>
                    Reasons to return the response include a desire to check for
                    exceptions prior to emitting the response, needing to log
                    various aspects of the response (such as headers), etc.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.front.methods.params">
        <title>Front Controller Parameters</title>

        <para>
            In the introduction, we indicated that the front controller also
            acts as a registry for the various controller components. It does so
            through a family of "param" methods. These methods allow you to
            register arbitrary data -- objects and variables -- with the front
            controller to be retrieved at any time in the dispatch chain. These
            values are passed on to the router, dispatcher, and action
            controllers. The methods include:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setParam($name, $value)</code> allows you to set a
                    single parameter of <code>$name</code> with value
                    <code>$value</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setParams(array $params)</code> allows you to set
                    multiple parameters at once using an associative array.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getParam($name)</code> allows you to retrieve a single
                    parameter at a time, using <code>$name</code> as the
                    identifier.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getParams()</code> allows you to retrieve the entire
                    list of parameters at once.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearParams()</code> allows you to clear a single
                    parameter (by passing a string identifier), multiple named
                    parameters (by passing an array of string identifiers), or the
                    entire parameter stack (by passing nothing).
                </para>
            </listitem>
        </itemizedlist>

        <para>
            There are several pre-defined parameters that may be set that have
            specific uses in the dispatch chain:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>useDefaultControllerAlways</code> is used to hint to
                    <link linkend="zend.controller.dispatcher">the
                        dispatcher</link> to use the default controller in the
                    default module for any request that is not dispatchable
                    (i.e., the module, controller, and/or action do not exist).
                    By default, this is off.
                </para>

                <para>
                    See <xref linkend="zend.controller.exceptions.internal" />
                    for more detailed information on using this setting.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>disableOutputBuffering</code> is used to hint to <link
                        linkend="zend.controller.dispatcher">the
                        dispatcher</link> that it should not use output
                    buffering to capture output generated by action controllers.
                    By default, the dispatcher captures any output and appends
                    it to the response object body content.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>noViewRenderer</code> is used to disable the <link
                        linkend="zend.controller.actionhelpers.viewrenderer">ViewRenderer</link>.
                    Set this parameter to true to disable it.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>noErrorHandler</code> is used to disable the <link
                        linkend="zend.controller.plugins.standard.errorhandler">Error
                        Handler plugin</link>. Set this parameter to true to
                    disable it.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.front.subclassing">
        <title>Subclassing the Front Controller</title>

        <para>
            To subclass the Front Controller, at the very minimum you will need
            to override the <code>getInstance()</code> method:
        </para>

        <programlisting role="php"><![CDATA[
class My_Controller_Front extends Zend_Controller_Front
{
    public static function getInstance()
    {
        if (null === self::$_instance) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }
}
]]>
        </programlisting>

        <para>
            Overriding the <code>getInstance()</code> method ensures that
            subsequent calls to
            <code>Zend_Controller_Front::getInstance()</code> will return an
            instance of your new subclass instead of a
            <code>Zend_Controller_Front</code> instance -- this is particularly
            useful for some of the alternate routers and view helpers.
        </para>

        <para>
            Typically, you will not need to subclass the front controller unless
            you need to add new functionality (for instance, a plugin
            autoloader, or a way to specify action helper paths). Some points
            where you may want to alter behaviour may include modifying how
            controller directories are stored, or what default router or
            dispatcher are used.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.migration">
    <title>Migrating from Previous Versions</title>

    <para>
        The API of the MVC components has changed over time. If you started
        using Zend Framework in an early version, follow the guidelines below to
        migrate your scripts to use the new architecture.
    </para>

    <sect2 id="zend.controller.migration.fromoneohtoonefive">
        <title>Migrating from 1.0.x to 1.5.0 or newer</title>

        <para>
            Though most basic functionality remains the same, and all documented
            functionality remains the same, there is one particular
            <emphasis>undocumented</emphasis> "feature" that has changed.
        </para>

        <para>
            When writing URLs, the documented way to write camelCased action
            names is to use a word separator; these are '.' or '-' by default,
            but may be configured in the dispatcher. The dispatcher internally
            lowercases the action name, and uses these word separators to
            re-assemble the action method using camelCasing. However, because PHP
            functions are not case sensitive, you <emphasis>could</emphasis>
            still write URLs using camelCasing, and the dispatcher would resolve
            these to the same location. For example, 'camel-cased' would become
            'camelCasedAction' by the dispatcher, whereas 'camelCased' would
            become 'camelcasedAction'; however, due to the case insensitivity of
            PHP, both will execute the same method.
        </para>

        <para>
            This causes issues with the ViewRenderer when resolving view
            scripts. The canonical, documented way is that all word separators
            are converted to dashes, and the words lowercased. This creates
            a semantic tie between the actions and view scripts, and the
            normalization ensures that the scripts can be found. However, if the
            action 'camelCased' is called and actually resolves, the word
            separator is no longer present, and the ViewRenderer attempts to
            resolve to a different location -- 'camelcased.phtml' instead of
            'camel-cased.phtml'.
        </para>

        <para>
            Some developers relied on this "feature", which was never intended.
            Several changes in the 1.5.0 tree, however, made it so that the
            ViewRenderer no longer resolves these paths; the semantic tie is now
            enforced. First among these, the dispatcher now enforces case
            sensitivity in action names. What this means is that referring to
            your actions on the url using camelCasing will no longer resolve to
            the same method as using word separators (i.e., 'camel-casing').
            This leads to the ViewRenderer now only honoring the word-separated
            actions when resolving view scripts.
        </para>

        <para>
            If you find that you were relying on this "feature", you have several
            options:
        </para>

        <itemizedlist>
            <listitem><para>
                    Best option: rename your view scripts. Pros: forward
                    compatibility. Cons: if you have many view scripts that
                    relied on the former, unintended behavior, you will have a
                    lot of renaming to do.
            </para></listitem>

            <listitem>
                <para>
                    Second best option: The ViewRenderer now delegates view
                    script resolution to <code>Zend_Filter_Inflector</code>; you
                    can modify the rules of the inflector to no longer separate
                    the words of an action with a dash:
                </para>

                <programlisting role="php"><![CDATA[<?php
$viewRenderer = Zend_Controller_Action_HelperBroker::getStaticHelper('viewRenderer');
$inflector = $viewRenderer->getInflector();
$inflector->setFilterRule(':action', array(
    new Zend_Filter_PregReplace(
        '#[^a-z0-9' . preg_quote(DIRECTORY_SEPARATOR, '#') . ']+#i',
        ''
    ),
    'StringToLower'
));
?>]]></programlisting>

                <para>
                    The above code will modify the inflector to no longer
                    separate the words with dash; you may also want to remove
                    the 'StringToLower' filter if you <emphasis>do</emphasis>
                    want the actual view script names camelCased as well.
                </para>

                <para>
                    If renaming your view scripts would be too tedious or time
                    consuming, this is your best option until you can find the
                    time to do so.
                </para>
            </listitem>

            <listitem>
                <para>
                    Least desirable option: You can force the dispatcher to
                    dispatch camelCased action names with a new front controller
                    flag, 'useCaseSensitiveActions':
                </para>

                <programlisting role="php"><![CDATA[<?php
$front->setParam('useCaseSensitiveActions', true);
?>]]></programlisting>

                <para>
                    This will allow you to use camelCasing on the url and still
                    have it resolve to the same action as when you use word
                    separators. However, this will mean that the original issues
                    will cascade on through; you will likely need to use the
                    second option above in addition to this for things to work
                    at all reliably.
                </para>

                <para>
                    Note, also, that usage of this flag will raise a notice that
                    this usage is deprecated.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.migration.fromzeroninethree">
        <title>Migrating from 0.9.3 to 1.0.0RC1 or newer</title>

        <para>
            The principal changes introduced in 1.0.0RC1 are the introduction of
            and default enabling of the
            <link
                linkend="zend.controller.plugins.standard.errorhandler">ErrorHandler</link>
            plugin and the <link
                linkend="zend.controller.actionhelpers.viewrenderer">ViewRenderer</link>
            action helper. Please read the documentation to each thoroughly to
            see how they work and what effect they may have on your
            applications.
        </para>

        <para>
            The <code>ErrorHandler</code> plugin runs during
            <code>postDispatch()</code> checking for exceptions, and forwarding
            to a specified error handler controller. You should include such a
            controller in your application. You may disable it by setting the
            front controller parameter <code>noErrorHandler</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
$front->setParam('noErrorHandler', true);]]>
        </programlisting>

        <para>
            The <code>ViewRenderer</code> action helper automates view injection
            into action controllers as well as autorendering of view scripts
            based on the current action. The primary issue you may encounter is
            if you have actions that do not render view scripts and neither
            forward or redirect, as the <code>ViewRenderer</code> will attempt
            to render a view script based on the action name.
        </para>

        <para>
            There are several strategies you can take to update your code. In
            the short term, you can globally disable the
            <code>ViewRenderer</code> in your front controller bootstrap prior
            to dispatching:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Assuming $front is an instance of Zend_Controller_Front
$front->setParam('noViewRenderer', true);]]>
        </programlisting>

        <para>
            However, this is not a good long term strategy, as it means most
            likely you'll be writing more code.
        </para>

        <para>
            When you're ready to start using the <code>ViewRenderer</code>
            functionality, there are several things to look for in your
            controller code. First, look at your action methods (the methods
            ending in 'Action'), and determine what each is doing. If none of
            the following is happening, you'll need to make changes:
        </para>

        <itemizedlist>
            <listitem><para>Calls to <code>$this-&gt;render()</code></para></listitem>
            <listitem><para>Calls to <code>$this-&gt;_forward()</code></para></listitem>
            <listitem><para>Calls to <code>$this-&gt;_redirect()</code></para></listitem>
            <listitem><para>Calls to the <code>Redirector</code> action helper</para></listitem>
        </itemizedlist>

        <para>
            The easiest change is to disable auto-rendering for that method:
        </para>

        <programlisting role="php"><![CDATA[
$this->_helper->viewRenderer->setNoRender();]]>
        </programlisting>

        <para>
            If you find that none of your action methods are rendering,
            forwarding, or redirecting, you will likely want to put the above
            line in your <code>preDispatch()</code> or <code>init()</code>
            methods:
        </para>

        <programlisting role="php"><![CDATA[
public function preDispatch()
{
    // disable view script autorendering
    $this->_helper->viewRenderer->setNoRender()
    // .. do other things...
}]]>
        </programlisting>

        <para>
            If you are calling <code>render()</code>, and you're using <link
                linkend="zend.controller.modular">the Conventional Modular
                directory structure</link>, you'll want to change your code to
            make use of autorendering:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    If you're rendering multiple view scripts in a single
                    action, you don't need to change a thing.
                </para>
            </listitem>
            <listitem>
                <para>
                    If you're simply calling <code>render()</code> with no
                    arguments, you can remove such lines.
                </para>
            </listitem>
            <listitem>
                <para>
                    If you're calling <code>render()</code> with arguments, and
                    not doing any processing afterwards or rendering multiple
                    view scripts, you can change these calls to read
                    <code>$this-&gt;_helper-&gt;viewRenderer()</code>.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            If you're not using the conventional modular directory structure,
            there are a variety of methods for setting the view base path and
            script path specifications so that you can make use of the
            <code>ViewRenderer</code>. Please read the <link
                linkend="zend.controller.actionhelpers.viewrenderer">ViewRenderer
                documentation</link> for information on these methods.
        </para>

        <para>
            If you're using a view object from the registry, or customizing your
            view object, or using a different view implementation, you'll want
            to inject the <code>ViewRenderer</code> with this object. This can
            be done easily at any time.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    Prior to dispatching a front controller instance:
                </para>

                <programlisting role="php"><![CDATA[<?php
// Assuming $view has already been defined
$viewRenderer = new Zend_Controller_Action_Helper_ViewRenderer($view);
Zend_Controller_Action_HelperBroker::addHelper($viewRenderer);]]>
                </programlisting>
            </listitem>

            <listitem>
                <para>
                    Any time during the bootstrap process:
                </para>

                <programlisting role="php"><![CDATA[<?php
$viewRenderer = Zend_Controller_Action_HelperBroker::getStaticHelper('viewRenderer');
$viewRenderer->setView($view);]]>
                </programlisting>
            </listitem>
        </itemizedlist>

        <para>
            There are many ways to modify the <code>ViewRenderer</code>,
            including setting a different view script to render, specifying
            replacements for all replaceable elements of a view script path
            (including the suffix), choosing a response named segment to
            utilize, and more. If you aren't using the conventional modular
            directory structure, you can even associate different path
            specifications with the <code>ViewRenderer</code>.
        </para>

        <para>
            We encourage you to adapt your code to use the
            <code>ErrorHandler</code> and <code>ViewRenderer</code> as they are
            now core functionality.
        </para>
    </sect2>

    <sect2 id="zend.controller.migration.fromzeroninetwo">
        <title>Migrating from 0.9.2 to 0.9.3 or newer</title>

        <para>
            0.9.3 introduces <link
                linkend="zend.controller.actionhelpers">action helpers</link>.
            As part of this change, the following methods have been removed as
            they are now encapsulated in the <link
                linkend="zend.controller.actionhelpers.redirector">redirector
                action helper</link>:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setRedirectCode()</code>; use
                    <code>Zend_Controller_Action_Helper_Redirector::setCode()</code>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>setRedirectPrependBase()</code>; use
                    <code>Zend_Controller_Action_Helper_Redirector::setPrependBase()</code>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>setRedirectExit()</code>; use
                    <code>Zend_Controller_Action_Helper_Redirector::setExit()</code>.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            Read the <link linkend="zend.controller.actionhelpers">action
                helpers documentation</link> for more information on how to
            retrieve and manipulate helper objects, and the <link
                linkend="zend.controller.actionhelpers.redirector">redirector
                helper documentation</link> for more information on setting
            redirect options (as well as alternate methods for redirecting).
        </para>
    </sect2>

    <sect2 id="zend.controller.migration.fromzerosix">
        <title>Migrating from 0.6.0 to 0.8.0 or newer</title>

        <para>
            Per previous changes, the most basic usage of the MVC components
            remains the same:
        </para>

        <programlisting role="php"><![CDATA[
require_once 'Zend/Controller/Front.php';
Zend_Controller_Front::run('/path/to/controllers');]]>
        </programlisting>

        <para>
            However, the directory structure underwent an overhaul, several
            components were removed, and several others either renamed or added.
            Changes include:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Controller_Router</code> was removed in favor of
                    the rewrite router.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_RewriteRouter</code> was renamed to
                    <code>Zend_Controller_Router_Rewrite</code>, and promoted to
                    the standard router shipped with the framework;
                    <code>Zend_Controller_Front</code> will use it by default if
                    no other router is supplied.
                </para>
            </listitem>

            <listitem>
                <para>
                    A new route class for use with the rewrite router was
                    introduced,
                    <code>Zend_Controller_Router_Route_Module</code>; it covers
                    the default route used by the MVC, and has support for <link
                        linkend="zend.controller.modular">controller
                        modules</link>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Router_StaticRoute</code> was renamed
                    to <code>Zend_Controller_Router_Route_Static</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Dispatcher</code> was renamed
                    <code>Zend_Controller_Dispatcher_Standard</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Action::_forward()</code>'s arguments
                    have changed. The signature is now:
                </para>

                <programlisting role="php"><![CDATA[
final protected function _forward($action, $controller = null, $module = null, array $params = null);]]>
                </programlisting>

                <para>
                    <code>$action</code> is always required; if no controller is
                    specified, an action in the current controller is assumed.
                    <code>$module</code> is always ignored unless
                    <code>$controller</code> is specified. Finally, any
                    <code>$params</code> provided will be appended to the
                    request object. If you do not require the controller or
                    module, but still need to pass parameters, simply specify
                    null for those values.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.migration.fromzerotwo">
        <title>Migrating from 0.2.0 or before to 0.6.0</title>

        <para>
            The most basic usage of the MVC components has not changed; you can
            still do each of the following:
        </para>

        <programlisting role="php"><![CDATA[
require_once 'Zend/Controller/Front.php';
Zend_Controller_Front::run('/path/to/controllers');]]>
        </programlisting>

        <programlisting role="php"><![CDATA[
/* -- create a router -- */
$router = new Zend_Controller_RewriteRouter();
$router->addRoute('user', 'user/:username', array('controller' => 'user',
'action' => 'info'));

/* -- set it in a controller -- */
$ctrl = Zend_Controller_Front::getInstance();
$ctrl->setRouter($router);

/* -- set controller directory and dispatch -- */
$ctrl->setControllerDirectory('/path/to/controllers');
$ctrl->dispatch();]]>
        </programlisting>

        <para>
            We encourage use of the Response object to aggregate content and
            headers. This will allow for more flexible output format switching
            (for instance, JSON or XML instead of XHTML) in your applications.
            By default, <code>dispatch()</code> will render the response, sending both
            headers and rendering any content. You may also have the front
            controller return the response using <code>returnResponse()</code>,
            and then render the response using your own logic. A future version
            of the front controller may enforce use of the response object via
            output buffering.
        </para>

        <para>
            There are many additional features that extend the existing API,
            and these are noted in the documentation.
        </para>

        <para>
            The main changes you will need to be aware of will be found when
            subclassing the various components. Key amongst these are:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Controller_Front::dispatch()</code> by default
                    traps exceptions in the response object, and does not render
                    them, in order to prevent sensitive system information from
                    being rendered. You can override this in several ways:
                </para>

                <itemizedlist>
                    <listitem>
                        <para>
                            Set <code>throwExceptions()</code> in the front
                            controller:
                        </para>
                        <programlisting role="php"><![CDATA[
$front->throwExceptions(true);]]>
                        </programlisting>
                    </listitem>

                    <listitem>
                        <para>
                            Set <code>renderExceptions()</code> in the response
                            object:
                        </para>
                        <programlisting role="php"><![CDATA[
$response->renderExceptions(true);
$front->setResponse($response);
$front->dispatch();

// or:
$front->returnResponse(true);
$response = $front->dispatch();
$response->renderExceptions(true);
echo $response;]]>
                        </programlisting>
                    </listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>
                <code>Zend_Controller_Dispatcher_Interface::dispatch()</code>
                now accepts and returns a <xref linkend="zend.controller.request" />
                object instead of a dispatcher token.
            </para></listitem>

            <listitem><para>
                <code>Zend_Controller_Router_Interface::route()</code>
                now accepts and returns a <xref linkend="zend.controller.request" />
                object instead of a dispatcher token.
            </para></listitem>

            <listitem>
                <para><code>Zend_Controller_Action</code> changes include:</para>

                <itemizedlist>
                    <listitem><para>
                        The constructor now accepts exactly three arguments,
                        <code>Zend_Controller_Request_Abstract $request</code>,
                        <code>Zend_Controller_Response_Abstract $response</code>,
                        and <code>array $params (optional)</code>.
                        <code>Zend_Controller_Action::__construct()</code> uses
                        these to set the request, response, and invokeArgs
                        properties of the object, and if overriding the
                        constructor, you should do so as well. Better yet, use
                        the <code>init()</code> method to do any instance
                        configuration, as this method is called as the final
                        action of the constructor.
                    </para></listitem>

                    <listitem><para>
                        <code>run()</code> is no longer defined as final, but is
                        also no longer used by the front controller; it's sole
                        purpose is for using the class as a page controller. It
                        now takes two optional arguments, a
                        <code>Zend_Controller_Request_Abstract $request</code>
                        and a <code>Zend_Controller_Response_Abstract $response</code>.
                    </para></listitem>

                    <listitem><para>
                        <code>indexAction()</code> no longer needs to be
                        defined, but is encouraged as the default action. This
                        allows using the RewriteRouter and action controllers to
                        specify different default action methods.
                    </para></listitem>

                    <listitem><para>
                        <code>__call()</code> should be overridden to handle any
                        undefined actions automatically.
                    </para></listitem>

                    <listitem><para>
                        <code>_redirect()</code> now takes an optional second
                        argument, the HTTP code to return with the redirect, and
                        an optional third argument, <code>$prependBase</code>,
                        that can indicate that the base URL registered with the
                        request object should be prepended to the url specified.
                    </para></listitem>

                    <listitem>
                        <para>
                            The <code>_action</code> property is no longer set.
                            This property was a <code>Zend_Controller_Dispatcher_Token</code>,
                            which no longer exists in the current incarnation.
                            The sole purpose of the token was to provide
                            information about the requested controller, action,
                            and URL parameters. This information is now
                            available in the request object, and can be accessed
                            as follows:
                        </para>

                        <programlisting role="php"><![CDATA[
// Retrieve the requested controller name
// Access used to be via: $this->_action->getControllerName().
// The example below uses getRequest(), though you may also directly access the
// $_request property; using getRequest() is recommended as a parent class may
// override access to the request object.
$controller = $this->getRequest()->getControllerName();

// Retrieve the requested action name
// Access used to be via: $this->_action->getActionName().
$action = $this->getRequest()->getActionName();

// Retrieve the request parameters
// This hasn't changed; the _getParams() and _getParam() methods simply proxy to
// the request object now.
$params = $this->_getParams();
$foo = $this->_getParam('foo', 'default'); // request 'foo' parameter, using
                                           // 'default' as default value if not found]]>
                        </programlisting>
                    </listitem>

                    <listitem>
                        <para>
                            <code>noRouteAction()</code> has been removed. The
                            appropriate way to handle non-existent action
                            methods should you wish to route them to a default
                            action is using <code>__call()</code>:
                        </para>

                        <programlisting role="php"><![CDATA[
public function __call($method, $args)
{
    // If an unmatched 'Action' method was requested, pass on to the default
    // action method:
    if ('Action' == substr($method, -6)) {
        return $this->defaultAction();
    }

    throw new Zend_Controller_Exception('Invalid method called');
}]]>
                        </programlisting>
                    </listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>
                <code>Zend_Controller_RewriteRouter::setRewriteBase()</code> has
                been removed. Use <code>Zend_Controller_Front::setBaseUrl()</code>
                instead (or Zend_Controller_Request_Http::setBaseUrl(), if using
                that request class).
            </para></listitem>

            <listitem><para>
                <code>Zend_Controller_Plugin_Interface</code> was replaced
                by <code>Zend_Controller_Plugin_Abstract</code>. All methods now
                accept and return a <xref linkend="zend.controller.request" />
                object instead of a dispatcher token.
            </para></listitem>
        </itemizedlist>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.modular">
    <title>Using a Conventional Modular Directory Structure</title>

    <sect2 id="zend.controller.modular.introduction">
        <title>Introduction</title>
        <para>
            The Conventional Modular directory structure allows you to separate
            different MVC applications into self-contained units, and re-use
            them with different front controllers. To illustrate such a
            directory structure:
        </para>

        <programlisting role="php"><![CDATA[
docroot/
    index.php
application/
    default/
        controllers/
            IndexController.php
            FooController.php
        models/
        views/
            scripts/
                index/
                foo/
            helpers/
            filters/
    blog/
        controllers/
            IndexController.php
        models/
        views/
            scripts/
                index/
            helpers/
            filters/
    news/
        controllers/
            IndexController.php
            ListController.php
        models/
        views/
            scripts/
                index/
                list/
            helpers/
            filters/]]>
        </programlisting>

        <para>
            In this paradigm, the module name serves as a prefix to the
            controllers it contains. The above example contains three
            module controllers, 'Blog_IndexController', 'News_IndexController', and
            'News_ListController'. Two global controllers, 'IndexController' and
            'FooController' are also defined; neither of these will be
            namespaced. This directory structure will be used for examples in
            this chapter.
        </para>

        <note>
            <title>No namespacing in the default module</title>
            <para>
                Note that in the default module, controllers do not need a
                namespace prefix. Thus, in the example above, the controllers in
                the default module do not need a prefix of 'Default_' -- they
                are simply dispatched according to their base controller name:
                'IndexController' and 'FooController'. A namespace prefix is
                used in all other modules, however.
            </para>
        </note>

        <para>
            So, how do you implement such a directory layout using the Zend
            Framework MVC components?
        </para>
    </sect2>

    <sect2 id="zend.controller.modular.directories">
        <title>Specifying Module Controller Directories</title>

        <para>
            The first step to making use of modules is to modify how you specify
            the controller directory list in the front controller. In the basic
            MVC series, you pass either an array or a string to
            <code>setControllerDirectory()</code>, or a path to
            <code>addControllerDirectory()</code>.  When using modules, you need
            to alter your calls to these methods slightly.
        </para>

        <para>
            With <code>setControllerDirectory()</code>, you will need to pass an
            associative array and specify key/value pairs of module
            name/directory paths.  The special key <code>default</code> will be
            used for global controllers (those not needing a module namespace).
            All entries should contain a string key pointing to a single path,
            and the <code>default</code> key must be present. As an example:
        </para>

        <programlisting role="php"><![CDATA[<?php
$front->setControllerDirectory(array(
      'default' => '/path/to/application/controllers',
      'blog'    => '/path/to/application/blog/controllers'
));]]>
        </programlisting>

        <para>
            <code>addControllerDirectory()</code> will take an optional second
            argument. When using modules, pass the module name as the second
            argument; if not specified, the path will be added to the
            <code>default</code> namespace. As an example:
        </para>

        <programlisting role="php"><![CDATA[<?php
$front->addControllerDirectory('/path/to/application/news/controllers', 'news');]]>
        </programlisting>

        <para>
            Saving the best for last, the easiest way to specify module
            directories is to do so en masse, with all modules under a common
            directory and sharing the same structure. This can be done with
            <code>addModuleDirectory()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
/**
 * Assuming the following directory structure:
 * application/
 *     modules/
 *         default/
 *             controllers/
 *         foo/
 *             controllers/
 *         bar/
 *             controllers/
 */
$front->addModuleDirectory('/path/to/application/modules');]]>
        </programlisting>

        <para>
            The above example will define the <code>default</code>,
            <code>foo</code>, and <code>bar</code> modules, each pointing to the
            <code>controllers</code> subdirectory of their respective module.
        </para>

        <para>
            You may customize the controller subdirectory to use within your
            modules by using <code>setModuleControllerDirectoryName()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
/**
 * Change the controllers subdirectory to be 'con'
 * application/
 *     modules/
 *         default/
 *             con/
 *         foo/
 *             con/
 *         bar/
 *             con/
 */
$front->setModuleControllerDirectoryName('con');
$front->addModuleDirectory('/path/to/application/modules');]]>
        </programlisting>

        <note><para>
            You can indicate that no controller subdirectory be used for your
            modules by passing an empty value to
            <code>setModuleControllerDirectoryName()</code>.
        </para></note>
    </sect2>

    <sect2 id="zend.controller.modular.router">
        <title>Routing to modules</title>

        <para>
            The default route in <code>Zend_Controller_Router_Rewrite</code> is
            an object of type <code>Zend_Controller_Router_Route_Module</code>.
            This route expects one of the following routing schemas:
        </para>

        <itemizedlist>
            <listitem><para><code>:module/:controller/:action/*</code></para></listitem>
            <listitem><para><code>:controller/:action/*</code></para></listitem>
        </itemizedlist>

        <para>
            In other words, it will match a controller and action by themselves
            or with a preceding module. The rules for matching specify that a
            module will only be matched if a key of the same name exists in the
            controller directory array passed to the front controller and
            dispatcher.
        </para>
    </sect2>

    <sect2 id="zend.controller.modular.defaultcontroller">
        <title>Module or Global Default Controller</title>

        <para>
            In the default router, if a controller was not specified in the URL,
            a default controller is used (<code>IndexController</code>, unless
            otherwise requested). With modular controllers, if a module has been
            specified but no controller, the dispatcher first looks for this
            default controller in the module path, and then falls back on the
            default controller found in the 'default', global, namespace.
        </para>

        <para>
            If you wish to always default to the global namespace, set the
            <code>useDefaultControllerAlways</code> parameter in the front controller:
        </para>

        <programlisting role="php"><![CDATA[<?php
$front->setParam('useDefaultControllerAlways', true);]]>
        </programlisting>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.plugins.standard.actionstack">
    <title>ActionStack</title>

    <para>
        The <code>ActionStack</code> plugin allows you to manage a stack of
        requests, and operates as a <code>postDispatch</code> plugin. If a
        forward (i.e., a call to another action) is already detected in the
        current request object, it does nothing. However, if not, it checks its
        stack and pulls the topmost item off it and forwards to the action
        specified in that request. The stack is processed in LIFO order.
    </para>

    <para>
        You can retrieve the plugin from the front controller at any time using
        <code>Zend_Controller_Front::getPlugin('Zend_Controller_Plugin_ActionStack')</code>.
        Once you have the plugin object, there are a variety of mechanisms you
        can use to manipulate it.
    </para>

    <itemizedlist>
        <listitem><para>
                <code>getRegistry()</code> and <code>setRegistry()</code>.
                Internally, <code>ActionStack</code> uses a
                <code>Zend_Registry</code> instance to store the stack. You can
                substitute a different registry instance or retrieve it with
                these accessors.
        </para></listitem>

        <listitem><para>
                <code>getRegistryKey()</code> and <code>setRegistryKey()</code>.
                These can be used to indicate which registry key to use when
                pulling the stack. Default value is
                'Zend_Controller_Plugin_ActionStack'.
        </para></listitem>

        <listitem><para>
                <code>getStack()</code> allows you to retrieve the stack of
                actions in its entirety.
        </para></listitem>

        <listitem><para>
                <code>pushStack()</code> and <code>popStack()</code> allow you
                to add to and pull from the stack, respectively.
                <code>pushStack()</code> accepts a request object.
        </para></listitem>
    </itemizedlist>

    <para>
        An additional method, <code>forward()</code>, expects a request object,
        and sets the state of the current request object in the front controller
        to the state of the provided request object, and markes it as
        undispatched (forcing another iteration of the dispatch loop).
    </para>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.plugins.standard.errorhandler">
    <title>Zend_Controller_Plugin_ErrorHandler</title>

    <para>
        <code>Zend_Controller_Plugin_ErrorHandler</code> provides a drop-in
        plugin for handling exceptions thrown by your application, including
        those resulting from missing controllers or actions; it is an
        alternative to the methods listed in the <link
            linkend="zend.controller.exceptions">MVC Exceptions section</link>.
    </para>

    <para>
        The primary targets of the plugin are:
    </para>

    <itemizedlist>
        <listitem>
            <para>Intercept exceptions raised due to missing controllers or
                action methods</para>
        </listitem>

        <listitem>
            <para>Intercept exceptions raised within action controllers</para>
        </listitem>
    </itemizedlist>

    <para>
        In other words, the <code>ErrorHandler</code> plugin is designed to
        handle HTTP 404-type errors (page missing) and 500-type errors (internal
        error). It is not intended to catch exceptions raised in other plugins
        or routing.
    </para>

    <para>
        By default, <code>Zend_Controller_Plugin_ErrorHandler</code> will
        forward to <code>ErrorController::errorAction()</code> in the default
        module. You may set alternate values for these by using the various
        accessors available to the plugin:
    </para>

    <itemizedlist>
        <listitem>
            <para>
                <code>setErrorHandlerModule()</code> sets the controller module
                to use.
            </para>
        </listitem>

        <listitem>
            <para>
                <code>setErrorHandlerController()</code> sets the controller
                to use.
            </para>
        </listitem>

        <listitem>
            <para>
                <code>setErrorHandlerAction()</code> sets the controller action
                to use.
            </para>
        </listitem>

        <listitem>
            <para>
                <code>setErrorHandler()</code> takes an associative array, which
                may contain any of the keys 'module', 'controller', or 'action',
                with which it will set the appropriate values.
            </para>
        </listitem>
    </itemizedlist>

    <para>
        Additionally, you may pass an optional associative array to the
        constructor, which will then proxy to <code>setErrorHandler()</code>.
    </para>

    <para>
        <code>Zend_Controller_Plugin_ErrorHandler</code> registers a
        <code>postDispatch()</code> hook and checks for exceptions registered in
        <link linkend="zend.controller.response">the response object</link>. If
        any are found, it attempts to forward to the registered error handler
        action.
    </para>

    <para>
        If an exception occurs dispatching the error handler, the plugin will
        tell the front controller to throw exceptions, and rethrow the last
        exception registered with the response object.
    </para>

    <sect4 id="zend.controller.plugins.standard.errorhandler.fourohfour">
        <title>Using the ErrorHandler as a 404 Handler</title>

        <para>
            Since the <code>ErrorHandler</code> plugin captures not only
            application errors, but also errors in the controller chain arising
            from missing controller classes and/or action methods, it can be
            used as a 404 handler. To do so, you will need to have your error
            controller check the exception type.
        </para>

        <para>
            Exceptions captured are logged in an object registered in the
            request. To retrieve it, use
            <code>Zend_Controller_Action::_getParam('error_handler')</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
class ErrorController extends Zend_Controller_Action
{
    public function errorAction()
    {
        $errors = $this->_getParam('error_handler');
    }
}]]>
        </programlisting>

        <para>
            Once you have the error object, you can get the type via
            <code>$errors->type</code>. It will be one of the following:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_CONTROLLER</code>,
                    indicating the controller was not found.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_ACTION</code>,
                    indicating the requested action was not found.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>Zend_Controller_Plugin_ErrorHandler::EXCEPTION_OTHER</code>,
                    indicating other exceptions.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            You can then test for either of the first two types, and, if so,
            indicate a 404 page:
        </para>

        <programlisting role="php"><![CDATA[<?php
class ErrorController extends Zend_Controller_Action
{
    public function errorAction()
    {
        $errors = $this->_getParam('error_handler');

        switch ($errors->type) {
            case Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_CONTROLLER:
            case Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_ACTION:
                // 404 error -- controller or action not found
                $this->getResponse()->setRawHeader('HTTP/1.1 404 Not Found');

                // ... get some output to display...
                break;
            default:
                // application error; display error page, but don't change
                // status code
                break;
        }
    }
}]]>
        </programlisting>

        <para>
            Finally, you can retrieve the exception that triggered the error
            handler by grabbing the <code>exception</code> property of the
            <code>error_handler</code> object:
        </para>

        <programlisting role="php"><![CDATA[<?php
public function errorAction()
{
        $errors = $this->_getParam('error_handler');


        switch ($errors->type) {
            case Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_CONTROLLER:
            case Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_ACTION:
                // 404 error -- controller or action not found
                $this->getResponse()->setRawHeader('HTTP/1.1 404 Not Found');

                // ... get some output to display...
                break;
            default:
                // application error; display error page, but don't change
                // status code

                // ...

                // Log the exception:
                $exception = $errors->exception;
                $log = new Zend_Log(new Zend_Log_Writer_Stream('/tmp/applicationException.log'));
                $log->debug($exception->getMessage() . "\n" .  $exception->getTraceAsString());
                break;
        }
}]]>
        </programlisting>
    </sect4>

    <sect4 id="zend.controller.plugins.standard.errorhandler.buffer">
        <title>Handling Previously Rendered Output</title>

        <para>
            If you dispatch multiple actions in a request, or if your action
            makes multiple calls to <code>render()</code>, its possible that the
            response object already has content stored within it. This can lead
            to rendering a mixture of expected content and error content.
        </para>

        <para>
            If you wish to render errors inline in such pages, no changes will
            be necessary. If you do not wish to render such content, you should
            clear the response body prior to rendering any views:
        </para>

        <programlisting role="php"><![CDATA[<?php
$this->getResponse()->clearBody();]]>
        </programlisting>
    </sect4>

    <sect4 id="zend.controller.plugins.standard.errorhandler.examples">
        <title>Plugin Usage Examples</title>

        <example id="zend.controller.plugins.standard.errorhandler.examples.example-1">
            <title>Standard usage</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Controller/Front.php';
require_once 'Zend/Controller/Plugin/ErrorHandler.php';

$front = Zend_Controller_Front::getInstance();
$front->registerPlugin(new Zend_Controller_Plugin_ErrorHandler());]]>
            </programlisting>
        </example>

        <example id="zend.controller.plugins.standard.errorhandler.examples.example-2">
            <title>Setting a different error handler</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Controller/Front.php';
require_once 'Zend/Controller/Plugin/ErrorHandler.php';

$front = Zend_Controller_Front::getInstance();
$front->registerPlugin(new Zend_Controller_Plugin_ErrorHandler(array(
    'module'     => 'mystuff',
    'controller' => 'static',
    'action'     => 'error'
)));]]>
            </programlisting>
        </example>

        <example id="zend.controller.plugins.standard.errorhandler.examples.example-3">
            <title>Using accessors</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Controller/Front.php';
require_once 'Zend/Controller/Plugin/ErrorHandler.php';

$plugin = new Zend_Controller_Plugin_ErrorHandler();
$plugin->setErrorHandlerModule('mystuff')
       ->setErrorHandlerController('static')
       ->setErrorHandlerAction('error');

$front = Zend_Controller_Front::getInstance();
$front->registerPlugin($plugin);]]>
            </programlisting>
        </example>
    </sect4>

    <sect4 id="zend.controller.plugins.standard.errorhandler.controllerexamples">
        <title>Error Controller Example</title>

        <para>
            In order to use the Error Handler plugin, you need an error
            controller. Below is a simple example.
        </para>

        <programlisting role="php"><![CDATA[<?php
class ErrorController extends Zend_Controller_Action
{
    public function errorAction()
    {
        $errors = $this->_getParam('error_handler');

        switch ($errors->type) {
            case Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_CONTROLLER:
            case Zend_Controller_Plugin_ErrorHandler::EXCEPTION_NO_ACTION:
                // 404 error -- controller or action not found
                $this->getResponse()->setRawHeader('HTTP/1.1 404 Not Found');

                $content =<<<EOH
<h1>Error!</h1>
<p>The page you requested was not found.</p>
EOH;
                break;
            default:
                // application error
                $content =<<<EOH
<h1>Error!</h1>
<p>An unexpected error occurred with your request. Please try again later.</p>
EOH;
                break;
        }

        // Clear previous content
        $this->getResponse()->clearBody();

        $this->view->content = $content;
    }
}]]>
        </programlisting>
    </sect4>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.plugins" xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>Plugins</title>

    <sect2 id="zend.controller.plugins.introduction">
        <title>Introduction</title>

        <para>
            The controller architecture includes a plugin system that allows
            user code to be called when certain events occur in the controller
            process lifetime.  The front controller uses a plugin broker as a
            registry for user plugins, and the plugin broker ensures that event
            methods are called on each plugin registered with the front
            controller.
        </para>

        <para>
            The event methods are defined in the abstract class
            <code>Zend_Controller_Plugin_Abstract</code>, from which user plugin
            classes inherit:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>routeStartup()</code> is called before
                    <code>Zend_Controller_Front</code> calls on <link
                        linkend="zend.controller.router">the router</link>
                    to evaluate the request against the registered routes.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>routeShutdown()</code> is called after <link
                        linkend="zend.controller.router">the router</link>
                    finishes routing the request.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>dispatchLoopStartup()</code> is called before
                    <code>Zend_Controller_Front</code> enters its dispatch loop.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>preDispatch()</code> is called before an action is
                    dispatched by <link linkend="zend.controller.dispatcher">the
                        dispatcher</link>. This callback allows for proxy or
                    filter behavior. By altering the request and resetting its
                    dispatched flag (via
                    <code>Zend_Controller_Request_Abstract::setDispatched(false)</code>),
                    the current action may be skipped and/or replaced.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>postDispatch()</code> is called after an action is
                    dispatched by <link linkend="zend.controller.dispatcher">the
                        dispatcher</link>. This callback allows for proxy or
                    filter behavior. By altering the request and resetting its
                    dispatched flag (via
                    <code>Zend_Controller_Request_Abstract::setDispatched(false)</code>),
                    a new action may be specified for dispatching.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>dispatchLoopShutdown()</code> is called after
                    <code>Zend_Controller_Front</code> exits its dispatch loop.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.plugins.writing">
        <title>Writing Plugins</title>

        <para>
            In order to write a plugin class, simply include and extend the
            abstract class <code>Zend_Controller_Plugin_Abstract</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Controller/Plugin/Abstract.php';

class MyPlugin extends Zend_Controller_Plugin_Abstract
{
    // ...
}]]>
        </programlisting>

        <para>
            None of the methods of <code>Zend_Controller_Plugin_Abstract</code>
            are abstract, and this means that plugin classes are not forced to
            implement any of the available event methods listed above. Plugin
            writers may implement only those methods required by their
            particular needs.
        </para>

        <para>
            <code>Zend_Controller_Plugin_Abstract</code> also makes the request
            and response objects available to controller plugins via the
            <code>getRequest()</code> and <code>getResponse()</code> methods,
            respectively.
        </para>
    </sect2>

    <sect2 id="zend.controller.plugins.using">
        <title>Using Plugins</title>

        <para>
            Plugin classes are registered with
            <code>Zend_Controller_Front::registerPlugin()</code>, and may be
            registered at any time.  The following snippet illustrates how a
            plugin may be used in the controller chain:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Controller/Front.php';
require_once 'Zend/Controller/Router.php';
require_once 'Zend/Controller/Plugin/Abstract.php';

class MyPlugin extends Zend_Controller_Plugin_Abstract
{
    public function routeStartup(Zend_Controller_Request_Abstract $request)
    {
        $this->getResponse()->appendBody("<p>routeStartup() called</p>\n");
    }

    public function routeShutdown(Zend_Controller_Request_Abstract $request)
    {
        $this->getResponse()->appendBody("<p>routeShutdown() called</p>\n");
    }

    public function dispatchLoopStartup(Zend_Controller_Request_Abstract $request)
    {
        $this->getResponse()->appendBody("<p>dispatchLoopStartup() called</p>\n");
    }

    public function preDispatch(Zend_Controller_Request_Abstract $request)
    {
        $this->getResponse()->appendBody("<p>preDispatch() called</p>\n");
    }

    public function postDispatch(Zend_Controller_Request_Abstract $request)
    {
        $this->getResponse()->appendBody("<p>postDispatch() called</p>\n");
    }

    public function dispatchLoopShutdown()
    {
        $this->getResponse()->appendBody("<p>dispatchLoopShutdown() called</p>\n");
    }
}

$front = Zend_Controller_Front::getInstance();
$front->setControllerDirectory('/path/to/controllers')
      ->setRouter(new Zend_Controller_Router_Rewrite())
      ->registerPlugin(new MyPlugin());
$front->dispatch();]]>
        </programlisting>

        <para>
            Assuming that no actions called emit any output, and only one action
            is called, the functionality of the above plugin would still create
            the following output:
        </para>

        <programlisting role="php"><![CDATA[
<p>routeStartup() called</p>
<p>routeShutdown() called</p>
<p>dispatchLoopStartup() called</p>
<p>preDispatch() called</p>
<p>postDispatch() called</p>
<p>dispatchLoopShutdown() called</p>]]>
        </programlisting>

        <note>
            <para>
                Plugins may be registered at any time during the front
                controller execution. However, if an event has passed for which
                the plugin has a registered event method, that method will not
                be triggered.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.controller.plugins.manipulating">
        <title>Retrieving and Manipulating Plugins</title>

        <para>
            On occasion, you may need to unregister or retrieve a plugin. The
            following methods of the front controller allow you to do so:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>getPlugin($class)</code> allows you to retrieve a
                    plugin by class name. If no plugins match, it returns false.
                    If more than one plugin of that class is registered, it
                    returns an array.
            </para></listitem>

            <listitem><para>
                    <code>getPlugins()</code> retrieves the entire plugin stack.
            </para></listitem>

            <listitem><para>
                    <code>unregisterPlugin($plugin)</code> allows you to remove
                    a plugin from the stack. You may pass a plugin object, or
                    the class name of the plugin you wish to unregister. If you
                    pass the class name, any plugins of that class will be
                    removed.
            </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.plugins.standard">
        <title>Plugins Included in the Standard Distribution</title>

        <para>
            Zend Framework includes a plugin for error handling in its standard
            distribution.
        </para>

        <xi:include href="Zend_Controller-Plugins-ActionStack.xml" />
        <xi:include href="Zend_Controller-Plugins-ErrorHandler.xml" />
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.quickstart">
    <title>Zend_Controller Quick Start</title>

    <sect2 id="zend.controller.quickstart.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Controller</code> is the heart of Zend Framework's MVC
            system. MVC stands for <ulink
                url="http://en.wikipedia.org/wiki/Model-view-controller">Model-View-Controller</ulink>
            and is a design pattern targeted at separating application logic
            from display logic. <code>Zend_Controller_Front</code> implements a
            <ulink
                url="http://www.martinfowler.com/eaaCatalog/frontController.html">Front
                Controller</ulink> pattern, in which all requests are
            intercepted by the front controller and dispatched to individual
            Action Controllers based on the URL requested.
        </para>
        <para>
            The <code>Zend_Controller</code> system was built with extensibility
            in mind, either by subclassing the existing classes, writing new
            classes that implement the various interfaces and abstract classes
            that form the foundation of the controller family of classes, or
            writing plugins or action helpers to augment or manipulate the
            functionality of the system.
        </para>
    </sect2>

    <sect2 id="zend.controller.quickstart.go">
        <title>Quick Start</title>

        <para>
            If you need more in-depth information, see the following sections.
            If you just want to get up and running quickly, read on.
        </para>

        <sect3 id="zend.controller.quickstart.go.directory">
            <title>Create your filesystem layout</title>

            <para>
                The first step is to create your file system layout. The typical
                layout is as follows:
            </para>

            <programlisting role="php"><![CDATA[
application/
    controllers/
        IndexController.php
    models/
    views/
        scripts/
            index/
                index.phtml
        helpers/
        filters/
html/
    .htaccess
    index.php]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.controller.quickstart.go.docroot">
            <title>Set your document root</title>

            <para>
                In your web server, point your document root to the
                <code>html</code> directory of the above file system layout.
            </para>
        </sect3>

        <sect3 id="zend.controller.quickstart.go.rewrite">
            <title>Create your rewrite rules</title>

            <para>
                Edit the <code>html/.htaccess</code> file above to read as
                follows:
            </para>

            <programlisting role="php"><![CDATA[
RewriteEngine on
RewriteRule !\.(js|ico|gif|jpg|png|css)$ index.php]]>
            </programlisting>

            <para>
                The above rules will route any non-resource (images,
                stylesheets) requests to the front controller. If there are
                other extensions you wish to exclude from the front controller
                (PDFs, text files, etc), add their extensions to the switch, or
                create your own rewrite rules.
            </para>

            <note>
                <para>
                    The above rewrite rules are for Apache; for examples of
                    rewrite rules for other web servers, see the <link
                        linkend="zend.controller.router.introduction">router
                        documentation</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.controller.quickstart.go.bootstrap">
            <title>Create your bootstrap file</title>

            <para>
                The bootstrap file is the page all requests are routed through
                -- <code>html/index.php</code> in this case. Open up
                <code>html/index.php</code> in the editor of your choice and add
                the following:
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Controller/Front.php';
Zend_Controller_Front::run('/path/to/app/controllers');]]>
            </programlisting>

            <para>
                This will instantiate and dispatch the front controller, which
                will route requests to action controllers.
            </para>
        </sect3>

        <sect3 id="zend.controller.quickstart.go.controller">
            <title>Create your default action controller</title>

            <para>
                Before discussing action controllers, you should first
                understand how requests are routed in Zend Framework. By
                default, the first segment of a URL path maps to a controller,
                and the second to an action. For example, given the URL
                <code>http://framework.zend.com/roadmap/components</code>, the
                path is <code>/roadmap/components</code>, which will map to the
                controller <code>roadmap</code> and the action
                <code>components</code>. If no action is provided, the action
                <code>index</code> is assumed, and if no controller is provided,
                the controller <code>index</code> is assumed (following the
                Apache convention that maps a <code>DirectoryIndex</code>
                automatically).
            </para>

            <para>
                <code>Zend_Controller</code>'s dispatcher then takes the
                controller value and maps it to a class. By default, it
                Title-cases the controller name and appends the word
                <code>Controller</code>. Thus, in our example above, the
                controller <code>roadmap</code> is mapped to the class
                <code>RoadmapController</code>.
            </para>

            <para>
                Similarly, the action value is mapped to a method of the
                controller class. By default, the value is lower-cased, and the
                word <code>Action</code> is appended. Thus, in our example
                above, the action <code>components</code> becomes
                <code>componentsAction</code>, and the final method called is
                <code>RoadmapController::componentsAction()</code>.
            </para>

            <para>
                So, moving on, let's now create a default action controller and
                action method. As noted earlier, the default controller and
                action called are both <code>index</code>. Open the file
                <code>application/controllers/IndexController.php</code>, and
                enter the following:
            </para>

            <programlisting role="php"><![CDATA[<?php
/** Zend_Controller_Action */
require_once 'Zend/Controller/Action.php';

class IndexController extends Zend_Controller_Action
{
    public function indexAction()
    {
    }
}]]>
            </programlisting>

            <para>
                By default, the <link
                    linkend="zend.controller.actionhelpers.viewrenderer">ViewRenderer</link>
                action helper is enabled. What this means is that by simply
                defining an action method and a corresponding view script, you
                will immediately get content rendered.  By default,
                <code>Zend_View</code> is used as the View layer in the MVC. The
                <code>ViewRenderer</code> does some magic, and uses the
                controller name (e.g., <code>index</code>) and the current
                action name (e.g., <code>index</code>) to determine what
                template to pull. By default, templates end in the
                <code>.phtml</code> extension, so this means that, in the above
                example, the template <code>index/index.phtml</code> will be
                rendered. Additionally, the <code>ViewRenderer</code>
                automatically assumes that the directory <code>views</code> at
                the same level as the controller directory will be the base view
                directory, and that the actual view scripts will be in the
                <code>views/scripts/</code> subdirectory. Thus, the template
                rendered will be found in
                <code>application/views/scripts/index/index.phtml</code>.
            </para>
        </sect3>

        <sect3 id="zend.controller.quickstart.go.view">
            <title>Create your view script</title>

            <para>
                As mentioned <link
                    linkend="zend.controller.quickstart.go.controller">in the
                    previous section</link>, view scripts are found in
                <code>application/views/scripts/</code>; the view script for the
                default controller and action is in
                <code>application/views/scripts/index/index.phtml</code>. Create
                this file, and type in some HTML:
            </para>

            <programlisting role="php"><![CDATA[
<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>My first Zend Framework App</title>
</head>
<body>
    <h1>Hello, World!</h1>
</body>
</html>]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.controller.quickstart.go.errorhandler">
            <title>Create your error controller</title>

            <para>
                By default, <link
                    linkend="zend.controller.plugins.standard.errorhandler">the
                error handler plugin</link> is registered. This plugin expects
                that a controller exists to handle errors. By default, it
                assumes an <code>ErrorController</code> in the default module
                with an <code>errorAction</code> method:
            </para>

            <programlisting role="php"><![CDATA[<?php
/** Zend_Controller_Action */
require_once 'Zend/Controller/Action.php';

class ErrorController extends Zend_Controller_Action
{
    public function errorAction()
    {
    }
}]]>
            </programlisting>

            <para>
                Assuming the already discussed directory layout, this file will
                go in <code>application/controllers/ErrorController.php</code>.
                You will also need to create a view script in
                <code>application/views/scripts/error/error.phtml</code>; sample
                content might look like:
            </para>

            <programlisting role="php"><![CDATA[
<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Error</title>
</head>
<body>
    <h1>An error occurred</h1>
    <p>An error occurred; please try again later.</p>
</body>
</html>]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.controller.quickstart.go.finish">
            <title>View the site!</title>

            <para>
                With your first controller and view under your belt, you can now
                fire up your browser and browse to the site. Assuming
                <code>example.com</code> is your domain, any of the following
                URLs will get to the page we've just created:
            </para>

            <itemizedlist>
                <listitem><para><code>http://example.com/</code></para></listitem>
                <listitem><para><code>http://example.com/index</code></para></listitem>
                <listitem><para><code>http://example.com/index/index</code></para></listitem>
            </itemizedlist>

            <para>
                You're now ready to start creating more controllers and action
                methods. Congratulations!
            </para>
        </sect3>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.request">
    <title>The Request Object</title>
    <sect2 id="zend.controller.request.introduction">
        <title>Introduction</title>
        <para>
            The request object is a simple value object that is passed between
            <code>Zend_Controller_Front</code> and the router, dispatcher, and
            controller classes.  It packages the names of the requested module,
            controller, action, and optional parameters, as well as the rest of
            the request environment, be it HTTP, the CLI, or PHP-GTK.
        </para>

        <itemizedlist>
            <listitem><para>
                The module name is accessed by
                <code>getModuleName()</code> and
                <code>setModuleName()</code>.
            </para></listitem>

            <listitem><para>
                The controller name is accessed by
                <code>getControllerName()</code> and
                <code>setControllerName()</code>.
            </para></listitem>

            <listitem><para>
                The name of the action to call within that controller is
                accessed by <code>getActionName()</code> and
                <code>setActionName()</code>.
            </para></listitem>

            <listitem><para>
                Parameters to be accesible by the action are an associative array
                of key/value pairs that are retrieved by <code>getParams()</code>
                and set with <code>setParams()</code>, or individually by
                <code>getParam()</code> and <code>setParam()</code>.
            </para></listitem>
        </itemizedlist>

        <para>
            Based on the type of request, there may be more methods available.
            The default request used, <code>Zend_Controller_Request_Http</code>,
            for instance, has methods for retrieving the request URI, path
            information, <code>$_GET</code> and <code>$_POST</code> parameters,
            etc.
        </para>

        <para>
            The request object is passed to the front controller, or if none is
            provided, it is instantiated at the beginning of the dispatch
            process, before routing occurs. It is passed through to every object
            in the dispatch chain.
        </para>

        <para>
            Additionally, the request object is particularly useful in testing.
            The developer may craft the request environment, including module,
            controller, action, parameters, URI, etc, and pass the request
            object to the front controller to test application flow. When paired
            with the <link linkend="zend.controller.response">response
                object</link>, elaborate and precise unit testing of MVC
            applications becomes possible.
        </para>
    </sect2>

    <sect2 id="zend.controller.request.http">
        <title>HTTP Requests</title>

        <sect3 id="zend.controller.request.http.dataacess">
            <title>Accessing Request Data</title>

            <para>
                <code>Zend_Controller_Request_Http</code> encapsulates access to
                relevant values such as the key name and value for the
                controller and action router variables, and all additional
                parameters parsed from the URI. It additionally allows access to
                values contained in the superglobals as public members, and
                manages the current Base URL and Request URI.  Superglobal
                values cannot be set on a request object, instead use the
                setParam/getParam methods to set or retrieve user parameters.
            </para>

            <note>
                <title>Superglobal data</title>
                <para>
                    When accessing superglobal data through
                    <code>Zend_Controller_Request_Http</code> as public member
                    properties, it is necessary to keep in mind that the
                    property name (superglobal array key) is matched to a
                    superglobal in a specific order of precedence: 1. GET, 2.
                    POST, 3. COOKIE, 4. SERVER, 5. ENV.
                </para>
            </note>

            <para>
                Specific superglobals can be accessed using a public method as
                an alternative. For example, the raw value of
                <code>$_POST['user']</code> can be accessed by calling
                <code>getPost('user')</code> on the request object. These
                include <code>getQuery()</code> for retrieving
                <code>$_GET</code> elements, and <code>getHeader()</code> for
                retrieving request headers.
            </para>

            <note>
                <title>GET and POST data</title>
                <para>
                    Be cautious when accessing data from the request object as
                    it is not filtered in any way. The router and dispatcher
                    validate and filter data for use with their tasks, but leave
                    the data untouched in the request object.
                </para>
            </note>

            <note>
                <title>Retrieve the Raw POST Data, Too!</title>

                <para>
                    As of 1.5.0, you can also retrieve the raw post data via the
                    <code>getRawBody()</code> method. This method returns false
                    if no data was submitted in that fashion, but the full body
                    of the post otherwise.
                </para>

                <para>
                    This is primarily useful for accepting content when
                    developing a RESTful MVC application.
                </para>
            </note>

            <para>
                You may also set user parameters in the request object using
                <code>setParam()</code> and retrieve these later using
                <code>getParam()</code>. The router makes use of this
                functionality to set parameters matched in the request URI into
                the request object.
            </para>

            <note>
                <title>getParam() retrieves more than user params</title>

                <para>
                    In order to do some of its work, <code>getParam()</code> actually
                    retrieves from several sources. In order of priority, these
                    include: user parameters set via <code>setParam()</code>,
                    <code>GET</code> parameters, and finally <code>POST</code>
                    parameters.  Be aware of this when pulling data via this
                    method.
                </para>

                <para>
                    If you wish to pull only from parameters you set via
                    <code>setParam()</code>, use the <code>getUserParam()</code>.
                </para>

                <para>
                    Additionally, as of 1.5.0, you can lock down which parameter
                    sources will be searched. <code>setParamSources()</code>
                    allows you to specify an empty array or an array with one or
                    more of the values '_GET' or '_POST' indicating which
                    parameter sources are allowed (by default, both are
                    allowed); if you wish to restrict access to only '_GET'
                    specify <code>setParamSources(array('_GET'))</code>.
                </para>
            </note>

            <note>
                <title>Apache Quirks</title>
                <para>
                    If you are using Apache's 404 handler to pass incoming
                    requests to the front controller, or using a PT flag with
                    rewrite rules, <code>$_SERVER['REDIRECT_URL']</code>
                    contains the URI you need, not
                    <code>$_SERVER['REQUEST_URI']</code>. If you are using such
                    a setup and getting invalid routing, you should use the
                    <code>Zend_Controller_Request_Apache404</code> class instead
                    of the default Http class for your request object:
                </para>

                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Controller/Request/Apache404.php';
$request = new Zend_Controller_Request_Apache404();
$front->setRequest($request);]]>
                </programlisting>

                <para>
                    This class extends the
                    <code>Zend_Controller_Request_Http</code> class and simply
                    modifies the autodiscovery of the request URI. It can be
                    used as a drop-in replacement.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.controller.request.http.baseurl">
            <title>Base Url and Subdirectories</title>

            <para>
                <code>Zend_Controller_Request_Http</code> allows
                Zend_Controller_Router_Rewrite to be used in subdirectories.
                Zend_Controller_Request_Http will attempt to automatically
                detect your base URL and set it accordingly.
            </para>

            <para>
                For example, if you keep your <code>index.php</code> in a
                webserver subdirectory named
                <code>/projects/myapp/index.php</code>, base URL (rewrite base)
                should be set to <code>/projects/myapp</code>. This string will
                then be stripped from the beginning of the path before
                calculating any route matches. This frees one from the necessity
                of prepending it to any of your routes. A route of
                <code>'user/:username'</code> will match URIs like
                <code>http://localhost/projects/myapp/user/martel</code> and
                <code>http://example.com/user/martel</code>.
            </para>

            <note>
                <title>URL detection is case sensitive</title>
                <para>
                    Automatic base URL detection is case sensitive, so make sure your URL
                    will match a subdirectory name in a filesystem (even on Windows
                    machines). If it doesn't, an exception will be raised.
                </para>
            </note>

            <para>
                Should base URL be detected incorrectly you can override it
                with your own base path with the help of the
                <code>setBaseUrl()</code> method of either the
                <code>Zend_Controller_Request_Http</code> class, or the
                <code>Zend_Controller_Front</code> class. The easiest
                method is to set it in <code>Zend_Controller_Front</code>,
                which will proxy it into the request object. Example usage to
                set a custom base URL:
            </para>

            <programlisting role="php"><![CDATA[<?php
/**
 * Dispatch Request with custom base URL with Zend_Controller_Front.
 */
$router     = new Zend_Controller_Router_Rewrite();
$controller = Zend_Controller_Front::getInstance();
$controller->setControllerDirectory('./application/controllers')
           ->setRouter($router)
           ->setBaseUrl('/projects/myapp'); // set the base url!
$response   = $controller->dispatch();]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.controller.request.http.method">
            <title>Determining the Request Method</title>

            <para>
                <code>getMethod()</code> allows you to determine the HTTP
                request method used to request the current resource.
                Additionally, a variety of methods exist that allow you to get
                boolean responses when asking if a specific type of request has
                been made:
            </para>

            <itemizedlist>
                <listitem><para><code>isGet()</code></para></listitem>
                <listitem><para><code>isPost()</code></para></listitem>
                <listitem><para><code>isPut()</code></para></listitem>
                <listitem><para><code>isDelete()</code></para></listitem>
                <listitem><para><code>isHead()</code></para></listitem>
                <listitem><para><code>isOptions()</code></para></listitem>
            </itemizedlist>

            <para>
                The primary use case for these is for creating RESTful MVC
                architectures.
            </para>
        </sect3>

        <sect3 id="zend.controller.request.http.ajax">
            <title>Detecting AJAX Requests</title>

            <para>
                <code>Zend_Controller_Request_Http</code> has a rudimentary
                method for detecting AJAX requests:
                <code>isXmlHttpRequest()</code>. This method looks for an
                HTTP request header <code>X-Requested-With</code> with the value
                'XMLHttpRequest'; if found, it returns true.
            </para>

            <para>
                Currently, this header is known to be passed by default with the
                following JS libraries:
            </para>

            <itemizedlist>
                <listitem><para>Prototype/Scriptaculous (and libraries derived
                        from Prototype)</para></listitem>
                <listitem><para>Yahoo! UI Library</para></listitem>
                <listitem><para>jQuery</para></listitem>
                <listitem><para>MochiKit</para></listitem>
            </itemizedlist>

            <para>
                Most AJAX libraries allow you to send custom HTTP request
                headers; if your library does not send this header, simply add
                it as a request header to ensure the
                <code>isXmlHttpRequest()</code> method works for you.
            </para>
        </sect3>
    </sect2>

    <sect2 id="zend.controller.request.subclassing">
        <title>Subclassing the Request Object</title>

        <para>
            The base request class used for all request objects is the abstract
            class <code>Zend_Controller_Request_Abstract</code>. At its most
            basic, it defines the following methods:
        </para>

        <programlisting role="php"><![CDATA[
abstract class Zend_Controller_Request_Abstract
{
    /**
     * @return string
     */
    public function getControllerName();

    /**
     * @param string $value
     * @return self
     */
    public function setControllerName($value);

    /**
     * @return string
     */
    public function getActionName();

    /**
     * @param string $value
     * @return self
     */
    public function setActionName($value);

    /**
     * @return string
     */
    public function getControllerKey();

    /**
     * @param string $key
     * @return self
     */
    public function setControllerKey($key);

    /**
     * @return string
     */
    public function getActionKey();

    /**
     * @param string $key
     * @return self
     */
    public function setActionKey($key);

    /**
     * @param string $key
     * @return mixed
     */
    public function getParam($key);

    /**
     * @param string $key
     * @param mixed $value
     * @return self
     */
    public function setParam($key, $value);

    /**
     * @return array
     */
     public function getParams();

    /**
     * @param array $array
     * @return self
     */
    public function setParams(array $array);

    /**
     * @param boolean $flag
     * @return self
     */
    public function setDispatched($flag = true);

    /**
     * @return boolean
     */
    public function isDispatched();
}]]>
        </programlisting>

        <para>
            The request object is a container for the request environment. The
            controller chain really only needs to know how to set and retrieve the
            controller, action, optional parameters, and dispatched status. By
            default, the request will search its own parameters using the
            controller or action keys in order to determine the controller and
            action.
        </para>

        <para>
            Extend this class, or one of its derivatives, when you need the
            request class to interact with a specific environment in order to
            retrieve data for use in the above tasks. Examples include <link
                linkend="zend.controller.request.http">the HTTP
                environment</link>, a CLI environment, or a PHP-GTK environment.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.response">
    <title>The Response Object</title>

    <sect2 id="zend.controller.response.usage">
        <title>Usage</title>

        <para>
            The response object is the logical counterpart to the <link
                linkend="zend.controller.request">request object</link>. Its
            purpose is to collate content and/or headers so that they may be
            returned en masse. Additionally, the front controller will pass any
            caught exceptions to the response object, allowing the developer to
            gracefully handle exceptions. This functionality may be overridden
            by setting
            <code>Zend_Controller_Front::throwExceptions(true)</code>:
        </para>

        <programlisting role="php"><![CDATA[
$front->throwExceptions(true);]]>
        </programlisting>

        <para>
            To send the response output, including headers, use
            <code>sendResponse()</code>.
        </para>

        <programlisting role="php"><![CDATA[
$response->sendResponse();]]>
        </programlisting>

        <note>
            <para>
                By default, the front controller calls <code>sendResponse()</code>
                when it has finished dispatching the request; typically you will
                never need to call it. However, if you wish to manipulate the
                response or use it in testing, you can override this
                behaviour by setting the <code>returnResponse</code> flag with
                <code>Zend_Controller_Front::returnResponse(true)</code>:
            </para>

            <programlisting role="php"><![CDATA[<?php
$front->returnResponse(true);
$response = $front->dispatch();

// do some more processing, such as logging...
// and then send the output:
$response->sendResponse();]]>
            </programlisting>
        </note>

        <para>
            Developers should make use of the response object in their action
            controllers. Instead of directly rendering output and sending
            headers, push them to the response object:
        </para>

        <programlisting role="php"><![CDATA[
// Within an action controller action:
// Set a header
$this->getResponse()
    ->setHeader('Content-Type', 'text/html')
    ->appendBody($content);]]>
        </programlisting>

        <para>
            By doing this, all headers get sent at once, just prior to
            displaying the content.
        </para>

        <note>
            <para>
                If using the action controller <link
                    linkend="zend.controller.action.viewintegration">view
                    integration</link>, you do not need to set the rendered view
                script content in the response object, as
                <code>Zend_Controller_Action::render()</code> does this by default.
            </para>
        </note>

        <para>
            Should an exception occur in an application, check the response object's
            <code>isException()</code> flag, and retrieve the exception using
            <code>getException()</code>. Additionally, one may create custom
            response objects that redirect to error pages, log exception messages,
            do pretty formatting of exception messages (for development
            environments), etc.
        </para>

        <para>
            You may retrieve the response object following the front controller
            dispatch(), or request the front controller to return the response
            object instead of rendering output.
        </para>

        <programlisting role="php"><![CDATA[
// retrieve post-dispatch:
$front->dispatch();
$response = $front->getResponse();
if ($response->isException()) {
    // log, mail, etc...
}

// Or, have the front controller dispatch() process return it
$front->returnResponse(true);
$response = $front->dispatch();

// do some processing...

// finally, echo the response
$response->sendResponse();]]>
        </programlisting>

        <para>
            By default, exception messages are not displayed. This behaviour may be
            overridden by calling <code>renderExceptions()</code>, or enabling the
            front controller to throwExceptions(), as shown above:
        </para>

        <programlisting role="php"><![CDATA[
$response->renderExceptions(true);
$front->dispatch($request, $response);

// or:
$front->returnResponse(true);
$response = $front->dispatch();
$response->renderExceptions();
$response->sendResponse();

// or:
$front->throwExceptions(true);
$front->dispatch();]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.controller.response.headers">
        <title>Manipulating Headers</title>

        <para>
            As stated previously, one aspect of the response object's duties is
            to collect and emit HTTP response headers.  A variety of methods
            exist for this:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>canSendHeaders()</code> is used to determine if
                    headers have already been sent. It takes an optional flag
                    indicating whether or not to throw an exception if headers
                    have already been sent. This can be overridden by setting
                    the property <code>headersSentThrowsException</code> to
                    <code>false</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setHeader($name, $value, $replace = false)</code> is
                    used to set an individual header. By default, it does not
                    replace existing headers of the same name in the object;
                    however, setting <code>$replace</code> to true will force it
                    to do so.
                </para>

                <para>
                    Before setting the header, it checks with
                    <code>canSendHeaders()</code> to see if this operation is
                    allowed at this point, and requests that an exception be
                    thrown.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setRedirect($url, $code = 302)</code> sets an HTTP
                    Location header for a redirect. If an HTTP status code has
                    been provided, it will use that status code.
                </para>

                <para>
                    Internally, it calls <code>setHeader()</code> with the
                    <code>$replace</code> flag on to ensure only one such header
                    is ever sent.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getHeaders()</code> returns an array of all headers.
                    Each array element is an array with the keys 'name' and
                    'value'.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearHeaders()</code> clears all registered headers.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>setRawHeader()</code> can be used to set headers that
                    are not key/value pairs, such as an HTTP status header.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getRawHeaders()</code> returns any registered raw
                    headers.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearRawHeaders()</code> clears any registered raw
                    headers.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearAllHeaders()</code> clears both regular key/value
                    headers as well as raw headers.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            In addition to the above methods, there are accessors for setting
            and retrieving the HTTP response code for the current request,
            <code>setHttpResponseCode()</code> and
            <code>getHttpResponseCode()</code>.
        </para>
    </sect2>

    <sect2 id="zend.controller.response.namedsegments">
        <title>Named Segments</title>

        <para>
            The response object has support for "named segments". This allows
            you to segregate body content into different segments and order
            those segments so output is returned in a specific order.
            Internally, body content is saved as an array, and the various
            accessor methods can be used to indicate placement and names within
            that array.
        </para>

        <para>
            As an example, you could use a <code>preDispatch()</code> hook to
            add a header to the response object, then have the action controller
            add body content, and a <code>postDispatch()</code> hook add a
            footer:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Assume that this plugin class is registered with the front controller
class MyPlugin extends Zend_Controller_Plugin_Abstract
{
    public function preDispatch(Zend_Controller_Request_Abstract $request)
    {
        $response = $this->getResponse();
        $view = new Zend_View();
        $view->setBasePath('../views/scripts');

        $response->prepend('header', $view->render('header.phtml'));
    }

    public function postDispatch(Zend_Controller_Request_Abstract $request)
    {
        $response = $this->getResponse();
        $view = new Zend_View();
        $view->setBasePath('../views/scripts');

        $response->append('footer', $view->render('footer.phtml'));
    }
}

// a sample action controller
class MyController extends Zend_Controller_Action
{
    public function fooAction()
    {
        $this->render();
    }
}]]>
        </programlisting>

        <para>
            In the above example, a call to <code>/my/foo</code> will cause the
            final body content of the response object to have the following
            structure:
        </para>

        <programlisting role="php"><![CDATA[<?php
array(
    'header'  => ..., // header content
    'default' => ..., // body content from MyController::fooAction()
    'footer'  => ...  // footer content
);]]>
        </programlisting>

        <para>
            When this is rendered, it will render in the order in which elements
            are arranged in the array.
        </para>

        <para>
            A variety of methods can be used to manipulate the named segments:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setBody()</code> and <code>appendBody()</code> both
                    allow you to pass a second value, <code>$name</code>,
                    indicating a named segment. In each case, if you provide
                    this, it will overwrite that specific named segment or
                    create it if it does not exist (appending to the array by
                    default). If no named segment is passed to
                    <code>setBody()</code>, it resets the entire body content
                    array. If no named segment is passed to appendBody(), the
                    content is appended to the value in the 'default' name
                    segment.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>prepend($name, $content)</code> will create a segment
                    named <code>$name</code> and place it at the beginning of
                    the array. If the segment exists already, it will be removed
                    prior to the operation (i.e., overwritten and replaced).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>append($name, $content)</code> will create a segment
                    named <code>$name</code> and place it at the end of
                    the array. If the segment exists already, it will be removed
                    prior to the operation (i.e., overwritten and replaced).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>insert($name, $content, $parent = null, $before =
                        false)</code> will create a segment named
                    <code>$name</code>. If provided with a <code>$parent</code>
                    segment, the new segment will be placed either before or
                    after that segment (based on the value of
                    <code>$before</code>) in the array. If the segment exists
                    already, it will be removed prior to the operation (i.e.,
                    overwritten and replaced).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearBody($name = null)</code> will remove a single
                    named segment if a <code>$name</code> is provided (and the
                    entire array otherwise).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getBody($spec = false)</code> can be used to retrieve a single
                    array segment if <code>$spec</code> is the name of a named
                    segment. If <code>$spec</code> is false, it returns a string
                    formed by concatenating all named segments in order. If
                    <code>$spec</code> is true, it returns the body content
                    array.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.response.exceptions">
        <title>Testing for Exceptions in the Response Object</title>

        <para>
            As mentioned earlier, by default, exceptions caught during dispatch
            are registered with the response object. Exceptions are registered
            in a stack, which allows you to keep all exceptions thrown --
            application exceptions, dispatch exceptions, plugin exceptions, etc.
            Should you wish to check for particular exceptions or to log
            exceptions, you'll want to use the response object's exception API:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>setException(Exception $e)</code> allows you to
                    register an exception.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>isException()</code> will tell you if an exception has
                    been registered.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getException()</code> returns the entire
                    exception stack.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>hasExceptionOfType($type)</code> allows you to
                    determine if an exception of a particular class is in the
                    stack.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>hasExceptionOfMessage($message)</code> allows you to
                    determine if an exception with a specific message is in the
                    stack.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>hasExceptionOfCode($code)</code> allows you to
                    determine if an exception with a specific code is in the
                    stack.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getExceptionByType($type)</code> allows you to
                    retrieve all exceptions of a specific class from the stack.
                    It will return false if none are found, and an array of
                    exceptions otherwise.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getExceptionByMessage($message)</code> allows you to
                    retrieve all exceptions with a specific message from the stack.
                    It will return false if none are found, and an array of
                    exceptions otherwise.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getExceptionByCode($code)</code> allows you to
                    retrieve all exceptions with a specific code from the stack.
                    It will return false if none are found, and an array of
                    exceptions otherwise.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>renderExceptions($flag)</code> allows you to set a
                    flag indicating whether or not exceptions should be emitted
                    when the response is sent.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.controller.response.subclassing">
        <title>Subclassing the Response Object</title>

        <para>
            The purpose of the response object is to collect headers and content
            from the various actions and plugins and return them to the client;
            secondarily, it also collects any errors (exceptions) that occur in
            order to process them, return them, or hide them from the end user.
        </para>

        <para>
            The base response class is
            <code>Zend_Controller_Response_Abstract</code>, and any subclass you
            create should extend that class or one of its derivatives. The
            various methods available have been listed in the previous sections.
        </para>

        <para>
            Reasons to subclass the response object include modifying how output
            is returned based on the request environment (e.g., not sending
            headers for CLI or PHP-GTK requests), adding functionality to return
            a final view based on content stored in named segments, etc.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.router.routes.regex">
    <title>Zend_Controller_Router_Route_Regex</title>

    <para>
        In addition to the default and static route types, a Regular
        Expression route type is available. This route offers more power and
        flexibility over the others, but at a slight cost of complexity. At the
        same time, it should be faster than the standard Route.
    </para>

    <para>
        Like the standard route, this route has to be initialized with a route
        definition and some defaults. Let's create an archive route as an
        example, similar to the previoulsy defined one, only using the Regex
        route this time:
    </para>

    <programlisting role="php"><![CDATA[
$route = new Zend_Controller_Router_Route_Regex(
    'archive/(\d+)',
    array(
        'controller' => 'archive',
        'action'     => 'show'
    )
);
$router->addRoute('archive', $route);]]>
    </programlisting>

    <para>
        Every defined regex subpattern will be injected to the request
        object. With our above example, after successful matching
        <code>http://domain.com/archive/2006</code>, the resulting value
        array may look like:
    </para>

    <programlisting role="php"><![CDATA[
$values = array(
    1            => '2006',
    'controller' => 'archive',
    'action'     => 'show'
);]]>
    </programlisting>

    <note>
        <para>
            Leading and trailing slashes are trimmed from the URL in the Router
            prior to a match. As a result, matching the URL
            <code>http://domain.com/foo/bar/</code>, would involve a regex of
            <code>foo/bar</code>, and not <code>/foo/bar</code>.
        </para>
    </note>

    <note>
        <para>
            Line start and line end anchors ('^' and '$', respectively) are
            automatically pre- and appended to all expressions.  Thus, you
            should not use these in your regular expressions, and you should
            match the entire string.
        </para>
    </note>

    <note>
        <para>
            This route class uses the <code>#</code> character for a delimiter.
            This means that you will need to escape hash characters ('#') but
            not forward slashes ('/') in your route definitions.  Since the '#'
            character (named anchor) is rarely passed to the webserver, you will
            rarely need to use that character in your regex.
        </para>
    </note>

    <para>
        You can get the contents of the defined subpatterns the usual way:
    </para>

    <programlisting role="php"><![CDATA[
public function showAction()
{
    $request = $this->getRequest();
    $year    = $request->getParam(1); // $year = '2006';
}]]>
    </programlisting>

    <note>
        <para>Notice the key is an integer (1) instead of a string ('1').</para>
    </note>

    <para>
        This route will not yet work exactly the same as its standard route
        counterpart since the default for 'year' is not yet set. And what may
        not yet be evident is that we will have a problem with a trailing slash
        even if we declare a default for the year and make the subpattern
        optional. The solution is to make the whole year part optional along
        with the slash but catch only the numeric part:
    </para>

    <programlisting role="php"><![CDATA[
$route = new Zend_Controller_Router_Route_Regex(
    'archive(?:/(\d+))?',
    array(
        1            => '2006',
        'controller' => 'archive',
        'action'     => 'show'
    )
);
$router->addRoute('archive', $route);]]>
    </programlisting>

    <para>
        Now let's get to the problem you have probably noticed on your own by
        now. Using integer based keys for parameters is not an easily manageable
        solution and may be potentially problematic in the long run. And that's
        where the third parameter comes in. This parameter is an associative
        array that represents a map of regex subpatterns to parameter named
        keys. Let's work on our easier example:
    </para>

    <programlisting role="php"><![CDATA[
$route = new Zend_Controller_Router_Route_Regex(
    'archive/(\d+)',
    array(
        'controller' => 'archive',
        'action' => 'show'
    ),
    array(
        1 => 'year'
    )
);
$router->addRoute('archive', $route);]]>
    </programlisting>

    <para>
        This will result in following values injected into Request:
    </para>

    <programlisting role="php"><![CDATA[
$values = array(
    'year'       => '2006',
    'controller' => 'archive',
    'action'     => 'show'
);]]>
    </programlisting>

    <para>
        The map may be defined in either direction to make it work in any
        environment. Keys may contain variable names or subpattern indexes:
    </para>


    <programlisting role="php"><![CDATA[
$route = new Zend_Controller_Router_Route_Regex(
    'archive/(\d+)',
    array( ... ),
    array(1 => 'year')
);

// OR

$route = new Zend_Controller_Router_Route_Regex(
    'archive/(\d+)',
    array( ... ),
    array('year' => 1)
);]]>
    </programlisting>

    <note>
        <para>
            Subpattern keys have to be represented by integers.
        </para>
    </note>

    <para>
        Notice that the numeric index in Request values is now gone and a named
        variable is shown in its place. Of course you can mix numeric and named
        variables if you wish:
    </para>

    <programlisting role="php"><![CDATA[
$route = new Zend_Controller_Router_Route_Regex(
    'archive/(\d+)/page/(\d+)',
    array( ... ),
    array('year' => 1)
);]]>
    </programlisting>

    <para>
        Which will result in mixed values available in the Request.  As an
        example, the URL <code>http://domain.com/archive/2006/page/10</code>
        will result in following values:
    </para>

    <programlisting role="php"><![CDATA[
$values = array(
    'year'       => '2006',
    2            => 10,
    'controller' => 'archive',
    'action'     => 'show'
);]]>
    </programlisting>

    <para>
        Since regex patterns are not easily reversed, you will need to prepare
        a reverse URL if you wish to use a URL helper or even an assemble method
        of this class. This reversed path is represented by a string parsable by
        sprintf() and is defined as a fourth construct parameter:
    </para>

    <programlisting role="php"><![CDATA[
$route = new Zend_Controller_Router_Route_Regex(
    'archive/(\d+)',
    array( ... ),
    array('year' => 1),
    'archive/%s'
);]]>
    </programlisting>

    <para>
        All of this is something which was already possible by the means of a
        standard route object, so where's the benefit in using the Regex route,
        you ask?  Primarily, it allows you to describe any type of URL without
        any restrictions.  Imagine you have a blog and wish to create URLs like:
        <code>http://domain.com/blog/archive/01-Using_the_Regex_Router.html</code>,
        and have it decompose the last path element,
        <code>01-Using_the_Regex_Router.html</code>, into an article ID and
        article title/description; this is not possible with the standard route.
        With the Regex route, you can do something like the following solution:
    </para>

    <programlisting role="php"><![CDATA[
$route = new Zend_Controller_Router_Route_Regex(
    'blog/archive/(\d+)-(.+)\.html',
    array(
        'controller' => 'blog',
        'action'     => 'view'
    ),
    array(
        1 => 'id',
        2 => 'description'
    ),
    'blog/archive/%d-%s.html'
);
$router->addRoute('blogArchive', $route);]]>
    </programlisting>

    <para>
        As you can see, this adds a tremendous amount of flexibility over the
        standard route.
    </para>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.router.routes.static">
    <title>Zend_Controller_Router_Route_Static</title>

    <para>
        The examples above all use dynamic routes -- routes that contain
        patterns to match against. Sometimes, however, a particular route is
        set in stone, and firing up the regular expression engine would be
        an overkill. The answer to this situation is to use static routes:
    </para>

    <programlisting role="php"><![CDATA[<?php
$route = new Zend_Controller_Router_Route_Static(
    'login',
    array('controller' => 'auth', 'action' => 'login')
);
$router->addRoute('login', $route);]]>
    </programlisting>

    <para>
        Above route will match a URL of <code>http://domain.com/login</code>,
        and dispatch to <code>AuthController::loginAction()</code>.
    </para>

</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.controller.router.routes.standard">
    <title>Zend_Controller_Router_Route</title>

    <para>
        <code>Zend_Controller_Router_Route</code> is the standard framework
        route. It combines ease of use with flexible route definition.  Each
        route consists primarily of URL mapping (of static and dynamic parts
        (variables)) and may be initialized with defaults as well as with
        variable requirements.
    </para>

    <para>
        Let's imagine our fictional application will need some informational
        page about the content authors. We want to be able to point our web
        browsers to <code>http://domain.com/author/martel</code> to see the
        information about this "martel" guy. And the route for such
        functionality could look like:
    </para>

    <programlisting role="php"><![CDATA[<?php
$route = new Zend_Controller_Router_Route(
    'author/:username',
    array(
        'controller' => 'profile',
        'action'     => 'userinfo'
    )
);

$router->addRoute('user', $route);]]>
    </programlisting>

    <para>
        The first parameter in the <code>Zend_Controller_Router_Route</code>
        constructor is a route definition that will be matched to a URL.  Route
        definitions consist of static and dynamic parts separated by the slash
        ('/') character.  Static parts are just simple text:
        <code>author</code>.  Dynamic parts, called variables, are marked by
        prepending a colon to the variable name: <code>:username</code>.
    </para>

    <note>
        <title>Character usage</title>
        <para>
            The current implementation allows you to use any character (except a
            slash) as a variable identifier, but it is strongly recommended that
            one uses only characters that are valid for PHP variable
            identifiers. Future implementations may alter this behaviour, which
            could result in hidden bugs in your code.
        </para>
    </note>

    <para>
        This example route should be matched when you point your browser to
        <code>http://domain.com/author/martel</code>, in which case all its
        variables will be injected to the <code>Zend_Controller_Request</code>
        object and will be accessible in your <code>ProfileController</code>.
        Variables returned by this example may be represented as an array of
        the following key and value pairs:
    </para>

    <programlisting role="php"><![CDATA[<?php
$values = array(
    'username'   => 'martel',
    'controller' => 'profile',
    'action'     => 'userinfo'
);]]>
    </programlisting>

    <para>
        Later on, <code>Zend_Controller_Dispatcher_Standard</code> should invoke
        the <code>userinfoAction()</code> method of your
        <code>ProfileController</code> class (in the default module) based on
        these values. There you will be able to access all variables by means of
        the <code>Zend_Controller_Action::_getParam()</code> or
        <code>Zend_Controller_Request::getParam()</code> methods:
    </para>

    <programlisting role="php"><![CDATA[<?php
public function userinfoAction()
{
    $request = $this->getRequest();
    $username = $request->getParam('username');

    $username = $this->_getParam('username');
}]]>
    </programlisting>

    <para>
        Route definition can contain one more special character - a wildcard
        - represented by '*' symbol. It is used to gather parameters similarly
        to the default Module route (var => value pairs defined in the URI).  The
        following route more-or-less mimics the Module route behavior:
    </para>

    <programlisting role="php"><![CDATA[<?php
$route = new Zend_Controller_Router_Route(
    ':module/:controller/:action/*',
    array('module' => 'default')
);
$router->addRoute('default', $route);]]>
    </programlisting>

    <sect4 id="zend.controller.router.routes.standard.variable-defaults">
        <title>Variable defaults</title>

        <para>
            Every variable in the route can have a default and this is what the
            second parameter of the <code>Zend_Controller_Router_Route</code>
            constructor is used for. This parameter is an array with keys
            representing variable names and with values as desired defaults:
        </para>

        <programlisting role="php"><![CDATA[<?php
$route = new Zend_Controller_Router_Route(
    'archive/:year',
    array('year' => 2006)
);
$router->addRoute('archive', $route);]]>
        </programlisting>

        <para>
            The above route will match URLs like
            <code>http://domain.com/archive/2005</code> and
            <code>http://example.com/archive</code>. In the latter case the
            variable year will have an initial default value of 2006.
        </para>

        <para>
            This example will result in injecting a year variable to the request
            object.  Since no routing information is present (no controller and
            action parameters are defined), the application will be dispatched
            to the default controller and action method (which are both defined
            in <code>Zend_Controller_Dispatcher_Abstract</code>).  To make it
            more usable, you have to provide a valid controller and a valid
            action as the route's defaults:
        </para>

        <programlisting role="php"><![CDATA[<?php
$route = new Zend_Controller_Router_Route(
    'archive/:year',
    array(
        'year'       => 2006,
        'controller' => 'archive',
        'action'     => 'show'
    )
);
$router->addRoute('archive', $route);]]>
        </programlisting>

        <para>
            This route will then result in dispatching to the method
            <code>showAction()</code> of the class
            <code>ArchiveController</code>.
        </para>

    </sect4>

    <sect4 id="zend.controller.router.routes.standard.variable-requirements">
        <title>Variable requirements</title>

        <para>
            One can add a third parameter to the
            <code>Zend_Controller_Router_Route</code> constructor where variable
            requirements may be set. These are defined as parts of a regular
            expression:
        </para>

        <programlisting role="php"><![CDATA[<?php
$route = new Zend_Controller_Router_Route(
    'archive/:year',
    array(
        'year'       => 2006,
        'controller' => 'archive',
        'action'     => 'show'
    ),
    array('year' => '\d+')
);
$router->addRoute('archive', $route);]]>
        </programlisting>

        <para>
            With a route defined like above, the router will match it only when
            the year variable will contain numeric data, eg.
            <code>http://domain.com/archive/2345</code>. A URL like
            <code>http://example.com/archive/test</code> will not be matched and
            control will be passed to the next route in the chain instead.
        </para>
    </sect4>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.controller.router"  xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>The Standard Router: Zend_Controller_Router_Rewrite</title>
    <sect2 id="zend.controller.router.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Controller_Router_Rewrite</code> is the standard
            framework router. Routing is the process of taking a URI endpoint
            (that part of the URI which comes after the base URL) and
            decomposing it into parameters to determine which module,
            controller, and action of that controller should receive the
            request. This values of the module, controller, action and other
            parameters are packaged into a
            <code>Zend_Controller_Request_Http</code> object which is then
            processed by <code>Zend_Controller_Dispatcher_Standard</code>.
            Routing occurs only once: when the request is initially received and
            before the first controller is dispatched.
        </para>

        <para>
            <code>Zend_Controller_Router_Rewrite</code> is designed to allow for
            mod_rewrite-like functionality using pure php structures. It is very
            loosely based on Ruby on Rails routing and does not require any
            prior knowledge of webserver URL rewriting. It is designed to work
            with a single Apache mod_rewrite rule (one of):
        </para>

        <programlisting role="php"><![CDATA[
RewriteEngine on
RewriteRule !\.(js|ico|gif|jpg|png|css)$ index.php]]>
        </programlisting>

        <para>
            or:
        </para>

        <programlisting role="php"><![CDATA[
RewriteEngine on
RewriteCond %{SCRIPT_FILENAME} !-f
RewriteCond %{SCRIPT_FILENAME} !-d
RewriteRule ^(.*)$ index.php/$1 ]]>
        </programlisting>

        <para>
            The rewrite router can also be used with the IIS webserver if <ulink
                url="http://www.isapirewrite.com">Isapi_Rewrite</ulink> has been
            installed as an Isapi extension with the following rewrite rule:
        </para>

        <programlisting role="php"><![CDATA[
RewriteRule ^[\w/\%]*(?:\.(?!(?:js|ico|gif|jpg|png|css)$)[\w\%]*$)? /index.php [I]]]>
        </programlisting>

        <note>
            <title>IIS Isapi_Rewrite</title>
            <para>
                When using IIS, <code>$_SERVER['REQUEST_URI']</code> will either
                not exist, or be set as an empty string. In this case,
                <code>Zend_Controller_Request_Http</code> will attempt to use
                the <code>$_SERVER['HTTP_X_REWRITE_URL']</code> value set by the
                Isapi_Rewrite extension.
            </para>
        </note>

        <para>
            If using Lighttpd, the following rewrite rule is valid:
        </para>

        <programlisting role="php"><![CDATA[
url.rewrite-once = ( ".*\.(js|ico|gif|jpg|png|css)$" => "$0", "" => "/index.php")]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.controller.router.usage">
        <title>Using a router</title>

        <para>
            To properly use the rewrite router you have to instantiate it, add
            some user defined routes and inject it into the controller.  The
            following code illustrates the procedure:
        </para>

        <programlisting role="php"><![CDATA[<?php
/* Create a router */

$router = $ctrl->getRouter(); // returns a rewrite router by default
$router->addRoute(
    'user',
    new Zend_Controller_Router_Route('user/:username', array('controller' => 'user', 'action' => 'info'))
);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.controller.router.basic">
        <title>Basic Rewrite Router operation</title>

        <para>
            The heart of the RewriteRouter is the definition of user defined
            routes. Routes are added by calling the addRoute method of
            RewriteRouter and passing in a new instance of a class implementing
            <code>Zend_Controller_Router_Route_Interface</code>. Eg.:
        </para>

        <programlisting role="php"><![CDATA[<?php
$router->addRoute('user', new Zend_Controller_Router_Route('user/:username'));]]>
        </programlisting>

        <para>
            Rewrite Router comes with four basic types of routes (one of which
            is special):
        </para>

        <itemizedlist mark="opencircle">
            <listitem><para><xref linkend="zend.controller.router.routes.standard" /></para></listitem>
            <listitem><para><xref linkend="zend.controller.router.routes.static" /></para></listitem>
            <listitem><para><xref linkend="zend.controller.router.routes.regex" /></para></listitem>
            <listitem><para><xref linkend="zend.controller.router.default-routes" /> *</para></listitem>
        </itemizedlist>

        <para>
            Routes may be used numerous times to create a chain or user defined
            application routing schema. You may use any number of routes in any
            configuration, with the exception of the Module route, which should
            rather be used once and probably as the most generic route (i.e., as a
            default). Each route will be described in greater detail later on.
        </para>

        <para>
            The first parameter to addRoute is the name of the route. It is used
            as a handle for getting the routes out of the router (e.g., for URL
            generation purposes). The second parameter being the route itself.
        </para>

        <note>
            <para>
                The most common use of the route name is through the means of
                Zend_View url helper:
            </para>

            <programlisting role="php"><![CDATA[
<a href="<?= $this->url(array('username' => 'martel'), 'user') ?>">Martel</a>]]>
            </programlisting>

            <para>
                Which would result in the href: <code>user/martel</code>.
            </para>
        </note>

        <para>
            Routing is a simple process of iterating through all provided routes
            and matching its definitions to current request URI. When a positive
            match is found, variable values are returned from the Route instance
            and are injected into the <code>Zend_Controller_Request</code>
            object for later use in the dispatcher as well as in user created
            controllers. On a negative match result, the next route in the chain
            is checked.
        </para>

        <note>
            <title>Reverse matching</title>
            <para>
                Routes are matched in reverse order so make sure your most
                generic routes are defined first.
            </para>
        </note>

        <note>
            <title>Returned values</title>
            <para>
                Values returned from routing come from URL parameters or user
                defined route defaults. These variables are later accessible
                through the <code>Zend_Controller_Request::getParam()</code> or
                <code>Zend_Controller_Action::_getParam()</code> methods.
            </para>
        </note>

        <para>
            There are three special variables which can be used in your routes
            - 'module', 'controller' and 'action'. These special variables are
            used by Zend_Controller_Dispatcher to find a controller and action
            to dispatch to.
        </para>

        <note>
            <title>Special variables</title>
            <para>
                The names of these special variables may be different if you
                choose to alter the defaults in
                <code>Zend_Controller_Request_Http</code> by means of the
                <code>setControllerKey</code> and <code>setActionKey</code>
                methods.
            </para>
        </note>

    </sect2>

    <sect2 id="zend.controller.router.default-routes">
        <title>Default routes</title>

        <para>
            Zend_Controller_Router_Rewrite comes preconfigured with a default
            route, which will match URIs in the shape of
            <code>controller/action</code>.  Additionally, a module name may be
            specified as the first path element, allowing URIs of the form
            <code>module/controller/action</code>.  Finally, it will also match
            any additional parameters appended to the URI by default -
            <code>controller/action/var1/value1/var2/value2</code>.
        </para>

        <para>
            Some examples of how such routes are matched:
        </para>

        <programlisting role="php"><![CDATA[
// Assuming the following:
$ctrl->setControllerDirectory(
    array(
        'default' => '/path/to/default/controllers',
        'news'    => '/path/to/news/controllers',
        'blog'    => '/path/to/blog/controllers'
    )
);

Module only:
http://example/news
    module == news

Invalid module maps to controller name:
http://example/foo
    controller == foo

Module + controller:
http://example/blog/archive
    module     == blog
    controller == archive

Module + controller + action:
http://example/blog/archive/list
    module     == blog
    controller == archive
    action     == list

Module + controller + action + params:
http://example/blog/archive/list/sort/alpha/date/desc
    module     == blog
    controller == archive
    action     == list
    sort       == alpha
    date       == desc
]]>
        </programlisting>

        <para>
            The default route is simply a
            <code>Zend_Controller_Router_Route_Module</code> object stored under
            the name (index) of 'default' in RewriteRouter. It's created
            more-or-less like below:
        </para>

        <programlisting role="php"><![CDATA[<?php
$compat = new Zend_Controller_Router_Route_Module(array(), $dispatcher, $request);
$this->addRoute('default', $compat);]]>
        </programlisting>

        <para>
            If you do not want this particular default route in your routing
            schema, you may override it by creating your own 'default' route
            (i.e., storing it under the name of 'default') or removing it
            altogether by using <code>removeDefaultRoutes()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Remove any default routes
$router->removeDefaultRoutes();]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.controller.router.rewritebase">
        <title>Base URL and subdirectories</title>

        <para>
            The rewrite router can be used in subdirectories (e.g.,
            <code>http://domain.com/~user/application-root/</code>) in which
            case the base URL of the application
            (<code>/~user/application-root</code>) should be automatically
            detected by <code>Zend_Controller_Request_Http</code> and used
            accordingly.
        </para>

        <para>
            Should the base URL be detected incorrectly you can override it with
            your own base path by using
            <code>Zend_Controller_Request_Http</code> and calling the
            <code>setBaseUrl()</code> method (see <xref
                linkend="zend.controller.request.http.baseurl" />):
        </para>

        <programlisting role="php"><![CDATA[<?php
$request->setBaseUrl('/~user/application-root/');]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.controller.router.routes">
        <title>Route Types</title>
        <xi:include href="Zend_Controller-Router-Route.xml" />
        <xi:include href="Zend_Controller-Router-Route-Static.xml" />
        <xi:include href="Zend_Controller-Router-Route-Regex.xml" />
    </sect2>

    <sect2 id="zend.controller.router.add-config">
        <title>Using Zend_Config with the RewriteRouter</title>

        <para>
            Sometimes it is more convenient to update a configuration file with
            new routes than to change the code. This is possible via the
            <code>addConfig()</code> method. Basically, you create a
            Zend_Config-compatible configuration, and in your code read it in
            and pass it to the RewriteRouter.
        </para>

        <para>
            As an example, consider the following INI file:
        </para>

        <programlisting role="php"><![CDATA[
[production]
routes.archive.route = "archive/:year/*"
routes.archive.defaults.controller = archive
routes.archive.defaults.action = show
routes.archive.defaults.year = 2000
routes.archive.reqs.year = "\d+"

routes.news.type = "Zend_Controller_Router_Route_Static"
routes.news.route = "news"
routes.news.defaults.controller = "news"
routes.news.defaults.action = "list"

routes.archive.type = "Zend_Controller_Router_Route_Regex"
routes.archive.route = "archive/(\d+)"
routes.archive.defaults.controller = "archive"
routes.archive.defaults.action = "show"
routes.archive.map.1 = "year"
; OR: routes.archive.map.year = 1]]>
        </programlisting>

        <para>
            The above INI file can then be read into a <code>Zend_Config</code>
            object as follows:
        </para>

        <programlisting role="php"><![CDATA[
$config = new Zend_Config_Ini('/path/to/config.ini', 'production');
$router = new Zend_Controller_Router_Rewrite();
$router->addConfig($config, 'routes');]]>
        </programlisting>

        <para>
            In the above example, we tell the router to use the 'routes' section
            of the INI file to use for its routes. Each first-level key under
            that section will be used to define a route name; the above example
            defines the routes 'archive' and 'news'. Each route then requires,
            at minimum, a 'route' entry and one or more 'defaults' entries;
            optionally one or more 'reqs' (short for 'required') may be
            provided. All told, these correspond to the three arguments provided
            to a <code>Zend_Controller_Router_Route_Interface</code> object. An
            option key, 'type', can be used to specify the route class type to
            use for that particular route; by default, it uses
            <code>Zend_Controller_Router_Route</code>. In the example above, the
            'news' route is defined to use
            <code>Zend_Controller_Router_Route_Static</code>.
        </para>
    </sect2>

    <sect2 id="zend.controller.router.subclassing">
        <title>Subclassing the Router</title>

        <para>
            The standard rewrite router should provide most functionality you
            may need; most often, you will only need to create a new route type
            in order to provide new or modified functionality over the provided
            routes.
        </para>

        <para>
            That said, you may at some point find yourself wanting to use a
            different routing paradigm.  The interface
            <code>Zend_Controller_Router_Interface</code> provides the minimal
            information required to create a router, and consists of a single
            method.
        </para>

        <programlisting role="php"><![CDATA[<?php
interface Zend_Controller_Router_Interface
{
  /**
   * @param  Zend_Controller_Request_Abstract $request
   * @throws Zend_Controller_Router_Exception
   * @return Zend_Controller_Request_Abstract
   */
  public function route(Zend_Controller_Request_Abstract $request);
}]]>
        </programlisting>

        <para>
            Routing only occurs once: when the request is first received into
            the system.  The purpose of the router is to determine the
            controller, action, and optional parameters based on the request
            environment, and then set them in the request.  The request object
            is then passed to the dispatcher.  If it is not possible to map a
            route to a dispatch token, the router should do nothing to the
            request object.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.currency.introduction">

    <title>Introduction to Zend_Currency</title>

    <para>
        <code>Zend_Currency</code> is part of the I18N core of the Zend_Framework. It handles all issues
        related to currency, money representation and formating. And it also provides additional informational
        methods which include localized informations on currencies, informations about which currency is used
        in which region and more.
    </para>

    <sect2 id="zend.currency.introduction.list">

        <title>Why should <code>Zend_Currency</code> be used ?</title>

        <para>
            <code>Zend_Currency</code> offers the following functions for handling currency and money related work.
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    <emphasis role="strong">Complete Locale support</emphasis>
                </para>
                <para>
                    <code>Zend_Currency</code> works with all available locales and has therefor the ability to
                    know about over 100 different localized currency informations. This includes for example
                    currency names, abbreviations, money signs and more.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Reuseable currency definitions</emphasis>
                </para>
                <para>
                    <code>Zend_Currency</code> does not include the value of the currency. This is the reason why
                    it's functionallity is not included in <code>Zend_Locale_Format</code>. But this gives the
                    advantage that already defined currency representations can be reused.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Fluid interface</emphasis>
                </para>
                <para>
                    <code>Zend_Currency</code> includes the fluid interface where possible.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Additional informational methods</emphasis>
                </para>
                <para>
                    <code>Zend_Currency</code> includes additional methods which offers informations about
                    in which regions a currency is used or which currency is known to be used in a defined region.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

</sect1><sect1 id="zend.currency.migration">

    <title>Migrating from Previous Versions</title>

    <para>
        The API of <code>Zend_Currency</code> has changed in the past to increase
        the usability. If you started using <code>Zend_Currency</code> with a
        version which is mentioned in this chapter follow the guidelines below
        to migrate your scripts to the new API.
    </para>

    <sect2 id="zend.currency.usage.migration.fromonezerotwo">

        <title>Migrating from 1.0.2 to 1.0.3 or newer</title>

        <para>
            Creating an object of <code>Zend_Currency</code> has become simpler.
            You now do not longer have to give a script or set it to null. The optional
            script parameter is now an option which can be set through the
            <code>setFormat()</code> method.
        </para>

        <programlisting role="php"><![CDATA[<?php
$currency = new Zend_Currency($currency, $locale);]]>
        </programlisting>

        <para>
            The <code>setFormat()</code> method takes now an array of options which
            can be set. These options are set permanent and override all previous
            set values. Also a new option 'precision' has been integrated. The
            following options has been integrated:

            <itemizedlist mark='opencircle'>
                <listitem>
                    <para>
                        <emphasis role="strong">position</emphasis>:
                        Replacement for the old 'rules' parameter.
                    </para>
                    <para>
                        <emphasis role="strong">script</emphasis>:
                        Replacement for the old 'script' parameter.
                    </para>
                    <para>
                        <emphasis role="strong">format</emphasis>:
                        Replacement for the old 'locale' parameter which does not
                        set new currencies but only the number format.
                    </para>
                    <para>
                        <emphasis role="strong">display</emphasis>:
                        Replacement for the old 'rules' parameter.
                    </para>
                    <para>
                        <emphasis role="strong">precision</emphasis>:
                        New parameter.
                    </para>
                    <para>
                        <emphasis role="strong">name</emphasis>:
                        Replacement for the ole 'rules' parameter. Sets the full
                        currencies name.
                    </para>
                    <para>
                        <emphasis role="strong">currency</emphasis>:
                        New parameter.
                    </para>
                    <para>
                        <emphasis role="strong">symbol</emphasis>:
                        New parameter.
                    </para>
                </listitem>
            </itemizedlist>

        </para>

        <programlisting role="php"><![CDATA[<?php
$currency->setFormat(array $options);]]>
        </programlisting>

        <para>
            The <code>toCurrency()</code> method does no longer support the optional
            'script' and 'locale' parameters. Instead it takes an options array which
            can contain the same keys as for the <code>setFormat</code> method. 
        </para>

        <programlisting role="php"><![CDATA[<?php
$currency->toCurrency($value, array $options);]]>
        </programlisting>

        <para>
            The methods <code>getSymbol()</code>, <code>getShortName()</code>,
            <code>getName()</code>, <code>getRegionList()</code> and
            <code>getCurrencyList()</code> are no longer static and can be called
            from within the object. They return the set values of the object if no
            parameter has been set.
        </para>

    </sect2>

</sect1>
<sect1 id="zend.currency.usage">

    <title>How to work with currencies</title>

    <para>
        To use <code>Zend_Currency</code> within the own application just create an instance of it without any
        parameter. This will create an instance of <code>Zend_Currency</code> with the actual locale, and defines
        the currency which has to be used for this locale.
    </para>

    <example id="zend.currency.usage.example1">

        <title>Creating an instance of Zend_Currency from the actual locale</title>

        <para>
            Expect you have 'en_US' set as actual locale through the users or your environment. By using no
            parameter while creating the instance you say <code>Zend_Currency</code> to use the actual currency
            from the locale 'en_US'. This leads to an instance with US Dollar set as actual currency with the
            formatting rules from 'en_US'.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Currency.php';

$currency = new Zend_Currency();]]>
        </programlisting>


    </example>
        <note>
            <para>
                Be aware, that if your system has no default locale, or if the locale of your system can not be
                detected automatically, <code>Zend_Currency</code> will throw an exception. If you have this
                behaviour you should set the locale you manually.
            </para>
        </note>

    <para>
        Of course, depending on your needs, several parameters can be given at creation. Each of this parameters
        is optional and can be supressed. Even the order of the parameters can be switched. The meaning of each
        parameter is described in this list:
    </para>

    <itemizedlist mark='opencircle'>
        <listitem>
            <para>
                <emphasis role="strong">currency</emphasis>:
            </para>
            <para>
                A locale can include several currencies. Therefor the first parameter
                <emphasis role="strong">'currency'</emphasis> can define which currency should be used by giving
                the short name or full name of that currency. If that currency in not known in any locale an
                exception will be thrown. Currency short names are always 3 lettered and written uppercase.
                Well known currency shortnames are for example <code>USD</code> or <code>EUR</code>.
                For a list of all known currencies see the informational methods of <code>Zend_Currency</code>.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">locale</emphasis>:
            </para>
            <para>
                The third parameter <emphasis role="strong">'locale'</emphasis> defines which locale should be
                used for formatting the currency. The given locale will also be used to get the standard script
                and currency of this currency if these parameters are not given.
            </para>
            <note>
                <para>
                    Note that Zend_Currency only accepts locales which include a region. This means that all
                    given locale which only include the language will throw an exception. For example the locale
                    <emphasis role="strong">en</emphasis> will throw an exception whereas the locale
                    <emphasis role="strong">en_US</emphasis> will return <emphasis role="strong">USD</emphasis>
                    as currency.
                </para>
            </note>
        </listitem>
    </itemizedlist>

    <example id="zend.currency.usage.example2">

        <title>Other examples for creating an instance of Zend_Currency</title>

        <programlisting role="php"><![CDATA[<?php
// expect standard locale 'de_AT'
require_once 'Zend/Currency.php';

// creates an instance from 'en_US' using 'USD' which is default currency for 'en_US'
$currency = new Zend_Currency('en_US');

// creates an instance from the actual locale ('de_AT') using 'EUR' as currency
$currency = new Zend_Currency();

// creates an instance using 'EUR' as currency, 'en_US' for number formating
$currency = new Zend_Currency('en_US', 'EUR');]]>
        </programlisting>

    </example>

    <para>
        So you can supress any of these parameters if you want to use the default ones. This has no negative effect
        on handling the currencies. It can be useful f.e. if you dont know the default currency for a region.
    </para>

    <note>
        <para>
            For many countries there are several known currencies. One currency will actually be used and
            maybe several ancient currencies. If the '<emphasis role="strong">currency</emphasis>' parameter
            is supressed the actual currency will be used. The region '<emphasis role="strong">de</emphasis>' for
            example knows the currencies '<emphasis role="strong">EUR</emphasis>' and
            '<emphasis role="strong">DEM</emphasis>'... '<emphasis role="strong">EUR</emphasis>' is the actual one
            and will be used if the parameter is supressed.
        </para>
    </note>

    <sect2 id="zend.currency.usage.tocurrency">

        <title>Create output from an currency</title>

        <para>
            To get an existing value converted to a currency formatted output the method
            <emphasis role="strong">toCurrency()</emphasis> can be used. It takes a value which should be converted.
            The value itself can be any normalized number.
        </para>

        <para>
            If you have a localized number you will have to convert it first to an normalized number with
            <link linkend="zend.locale.number.normalize">Zend_Locale_Format::getNumber()</link>. Afterwards it can
            be used with <code>toCurrency()</code> to create an currency output.
        </para>

        <para>
            <code>toCurrency(array $options)</code> accepts an array with options which can be used to temporary set another
            format or currency represenation. For details about which options can be used see 
            <link linkend="zend.currency.usage.setformat">Changing the format of a currency</link>.
        </para>

        <example id="zend.currency.usage.tocurrency.example">

            <title>Creating output for an currency</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Currency.php';

// creates an instance with 'en_US' using 'USD' which is the default values for 'en_US'
$currency = new Zend_Currency('en_US');

// prints '$ 1,000.00'
echo $currency->toCurrency(1000);

// prints '$ 1.000,00'
echo $currency->toCurrency(1000, array('format' => 'de_AT'));

// prints '$ ١٬٠٠٠٫٠٠'
echo $currency->toCurrency(1000, array('script' => 'Arab'));]]>
            </programlisting>

        </example>
    </sect2>

    <sect2 id="zend.currency.usage.setformat">

        <title>Changing the format of a currency</title>

        <para>
            The format which is used by creation of a <code>Zend_Currency</code> instance is of course the
            standard format. But sometimes it is necessary to change this format for own purposes.
        </para>

        <para>
            The format of an currency output includes the following parts:
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    <emphasis role="strong">Currency symbol, shortname or name</emphasis>:
                </para>
                <para>
                    The symbol of the currency is normally displayed within an currency output. It can be supressed
                    when needed or even overwritten.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Currency position</emphasis>:
                </para>
                <para>
                    The position of the currency sign is normally automatically defined by the locale. It can be
                    changed if necessary.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Script</emphasis>:
                </para>
                <para>
                    The script which shall be used to display digits. Detailed information about scripts and their
                    usage can be found in the documentation of <code>Zend_Locale</code> in
                    <link linkend="zend.locale.appendix.numberscripts.supported">supported number scripts</link>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Number formatting</emphasis>:
                </para>
                <para>
                    The amount of currency (formally known as value of money) is formatted by the usage of
                    formatting rules within the locale. For example is in english the ',' sign used as seperator for
                    thousands, and in german the '.' sign.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            So if you are in need to change the format, you can use the
            <emphasis role="strong">setFormat()</emphasis> method. It takes an array which includes all
            options which you want to change. The <code>options</code> array supports the following
            settings:
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    <emphasis role="strong">position</emphasis>: Defines the position at which the currency
                    description should be displayed. The supported position can be found in
                    <link linkend="zend.currency.usage.setformat.constantsposition">this table</link>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">script</emphasis>: Defined which script has to be used for
                    displaying digits. The default script for most locales is
                    <emphasis role="strong">'Latn'</emphasis>, which includes the digits 0 to 9. Also other
                    scripts like 'Arab' (arabian) can be used. All supported scripts can be found in
                    <link linkend="zend.locale.appendix.numberscripts.supported">this table</link>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">format</emphasis>: Defines which locale has to be used for displaying
                    numbers. This number-format includes for example the thousand seperator. If no format is set
                    the locale from the <code>Zend_Currency</code> object will be used. 
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">display</emphasis>: Defines which part of the currency has to be
                    used for displaying the currency representation. There are 4 representations which can be
                    used and which are all described in
                    <link linkend="zend.currency.usage.setformat.constantsdescription">this table</link>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">precision</emphasis>: Defines the precision which has to be used for
                    the currency represenation. The default value is <emphasis role="strong">2</emphasis>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">name</emphasis>: Defines the full currency name which has to be
                    displayed. This option overwrites any currency name which is set through
                    the creation of <code>Zend_Currency</code>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">currency</emphasis>: Defines the international abbreviation which
                    has to be displayed. This option overwrites any abbreviation which is set through
                    the creation of <code>Zend_Currency</code>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">symbol</emphasis>: Defines the currency symbol which has to be
                    displayed. This option overwrites any symbol which is set through
                    the creation of <code>Zend_Currency</code>.
                </para>
            </listitem>
        </itemizedlist>

        <table id="zend.currency.usage.setformat.constantsdescription">

            <title>Constants for the selecting the currency description</title>

            <tgroup cols="3" align="left">
                <thead>
                    <row>
                        <entry>constant</entry>
                        <entry>description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>NO_SYMBOL</entry>
                        <entry>Do not display any currency representation</entry>
                    </row>
                    <row>
                        <entry>USE_SYMBOL</entry>
                        <entry>Display the currency symbol</entry>
                    </row>
                    <row>
                        <entry>USE_SHORTNAME</entry>
                        <entry>Display the 3 lettered international currency abbreviation</entry>
                    </row>
                    <row>
                        <entry>USE_NAME</entry>
                        <entry>Display the full currency name</entry>
                    </row>
                </tbody>
            </tgroup>

        </table>

        <table id="zend.currency.usage.setformat.constantsposition">

            <title>Constants for the selecting the currency position</title>

            <tgroup cols="3" align="left">
                <thead>
                    <row>
                        <entry>constant</entry>
                        <entry>description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>STANDARD</entry>
                        <entry>Set the standard position as defined within the locale</entry>
                    </row>
                    <row>
                        <entry>RIGHT</entry>
                        <entry>Display the currency represenation at the right side of the value</entry>
                    </row>
                    <row>
                        <entry>LEFT</entry>
                        <entry>Display the currency represenation at the left side of the value</entry>
                    </row>
                </tbody>
            </tgroup>

        </table>

        <example id="zend.currency.usage.setformat.example">

            <title>Changing the displayed format of a currency</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Currency.php';

// creates an instance with 'en_US' using 'USD', 'Latin' and 'en_US' as these are the default values from 'en_US'
$currency = new Zend_Currency('en_US');

// prints 'US$ 1,000.00'
echo $currency->toCurrency(1000);

$currency->setFormat(Zend_Currency::USE_NAME&Zend_Currency::RIGHT);
// prints '1.000,00 US Dollar'
echo $currency->toCurrency(1000);

$currency->setFormat("American Dollar");
// prints '1.000,00 American Dollar'
echo $currency->toCurrency(1000);]]>
            </programlisting>

        </example>
    </sect2>

    <sect2 id="zend.currency.usage.informational">

        <title>Informational methods for Zend_Currency</title>

        <para>
            Of course, <code>Zend_Currency</code> supports also methods to get informations about any existing
            and many ancient currencies from <code>Zend_Locale</code>. The supported
            methods are:
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    <emphasis role="strong">getSymbol()</emphasis>:
                </para>
                <para>
                    Returns the known sign of the actual currency or a given currency. For example
                    <emphasis role="strong">$</emphasis> for the US Dollar within the locale
                    '<emphasis role="strong">en_US</emphasis>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">getShortName()</emphasis>:
                </para>
                <para>
                    Returns the abbreviation of the actual currency or a given currency.  For example
                    <emphasis role="strong">USD</emphasis> for the US Dollar within the locale
                    '<emphasis role="strong">en_US</emphasis>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">getName()</emphasis>:
                </para>
                <para>
                    Returns the full name of the actual currency of a given currency. For example
                    <emphasis role="strong">US Dollar</emphasis> for the US Dollar within the locale
                    '<emphasis role="strong">en_US</emphasis>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">getRegionList()</emphasis>:
                </para>
                <para>
                    Returns a list of regions where the actual currency or a given one is known to be used.
                    It is possible that a currency is used within several regions therefor the return value
                    is always an array.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">getCurrencyList()</emphasis>:
                </para>
                <para>
                    Returns a list of currencies which are known to be used in the given region.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            The function <code>getSymbol()</code>, <code>getShortName()</code> and <code>getName()</code> accept
            two optional parameters. If no parameter is given the expected data will be returned from the actual
            set currency. The first parameter takes the shortname of a currency. Short names are always three
            lettered, for example EUR for euro or USD for US Dollar. The second parameter defines from which
            locale the data should be read. If no locale is given, the actual set locale is used.
        </para>

        <example id="zend.currency.usage.informational.example">

            <title>Getting informations from currencies</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Currency.php';

// creates an instance with 'en_US' using 'USD', 'Latin' and 'en_US' as these are the default values from 'en_US'
$currency = new Zend_Currency('en_US');

// prints '$'
echo $currency->getSymbol();

// prints 'EUR'
echo $currency->getShortName('EUR');

// prints 'Österreichische Schilling'
echo $currency->getName('ATS', 'de_AT');

// returns an array with all regions where USD is used
print_r($currency->getRegionList();

// returns an array with all currencies which were ever used in this region
print_r($currency->getCurrencyList('de_AT');]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.currency.usage.setlocale">

        <title>Settings new default values</title>

        <para>
            The method <code>setLocale</code> allows to set a new locale for
            <code>Zend_Currency</code>. When calling this function also all default
            values for the currency will be overwritten. This includes currency name,
            abbreviation and symbol.
        </para>

        <example id="zend.currency.usage.setlocale.example">

            <title>Setting a new locale</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Currency.php';

// get the currency for US
$currency = new Zend_Currency('en_US');
print $currency->toCurrency(1000);

// get the currency for AT
$currency->setLocale('de_AT');
print $currency->toCurrency(1000);
]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.currency.usage.cache">

        <title>Speed up Zend_Currency</title>

        <para>
            The work of <code>Zend_Currency</code> can be speed up by the usage of <code>Zend_Cache</code>.
            By using the static method <code>Zend_Currency::setCache($cache)</code> which accepts one option, an
            <code>Zend_Cache</code> adapter. When you set it, the localization data of the methods from
            Zend_Currency are cached.
        </para>

        <example id="zend.currency.usage.cache.example">

            <title>Caching currencies</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Currency.php';
require_once 'Zend/Cache.php';

// creating a cache object
$cache = Zend_Cache::factory('Core', 'File',
             array('lifetime' => 120, 'automatic_serialization' => true),
             array('cache_dir' => dirname(__FILE__) . '/_files/'));
Zend_Currency::setCache($cache);]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<sect1 id="zend.date.additional">

    <title>Working examples</title>

    <para>
        Within this chapter, we will describe several additional functions which are also available through
        <code>Zend_Date</code>. Of course all described functions have additional examples to show the
        expexted working and the simple API for the proper using of them.
    </para>

    <sect2 id="zend.date.additional.checking">

        <title>Checking dates</title>

        <para>
            Probably most dates you will get as input are strings. But the problem with strings is that
            you can not be sure if the string is a real date. Therefor <code>Zend_Date</code> has spent
            an own static function to check date strings. <code>Zend_Locale</code> has an own function
            <code>getDate($date, $locale);</code> which parses a date and returns the proper and normalized
            date parts. A monthname for example will be recognised and returned just a month number.
            But as <code>Zend_Locale</code> does not know anything about dates because it is a
            normalizing and localizing class we have integrated an own function <code>isDate($date);</code>
            which checks this.
        </para>

        <para>
            <code>isDate($date, $format, $locale);</code> can take up to 3 parameters and needs minimum one
            parameter. So what we need to verify a date is, of course, the date itself as string.
            The second parameter can be the format which the date is expected to have. If no format is given
            the standard date format from your locale is used. For details about how formats should look like
            see the chapter about <link linkend="zend.date.constants.selfdefinedformats">self defined formats</link>
            .
        </para>

        <para>
            The third parameter is also optional as the second parameter and can be used to give a locale.
            We need the locale to normalize monthnames and daynames. So with the third parameter we are able
            to recognise dates like '01.Jänner.2000' or '01.January.2000' depending on the given locale.
        </para>

        <para>
            <code>isDate();</code> of course checks if a date does exist. <code>Zend_Date</code> itself does not
            check a date. So it is possible to create a date like '31.February.2000' with <code>Zend_Date</code>
            because <code>Zend_Date</code> will automatically correct the date and return the proper date.
            In our case '03.March.2000'. <code>isDate()</code> on the other side does this check and will return
            false on '31.February.2000' because it knows that this date is impossible.
        </para>

        <example id="zend.date.additional.checking.example-1">
            <title>Checking dates</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

// Checking dates
$date = '01.03.2000';
if (Zend_Date::isDate($date)) {
    print "String $date is a date";
} else {
    print "String $date is NO date";
}

// Checking localized dates
$date = '01 February 2000';
if (Zend_Date::isDate($date,'dd MMMM yyyy', 'en')) {
    print "String $date is a date";
} else {
    print "String $date is NO date";
}

// Checking impossible dates
$date = '30 February 2000';
if (Zend_Date::isDate($date,'dd MMMM yyyy', 'en')) {
    print "String $date is a date";
} else {
    print "String $date is NO date";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.date.additional.sunrise-sunset">

        <title>Sunrise and Sunset</title>

        <para>
            <code>Zend_Date</code> has also functions integrated for getting informations from the sun. Often it is
            necessary to get the time for sunrise or sunset within a particulary day. This is quite easy with
            <code>Zend_Date</code> as just the expected day has to be given and additionally location for which
            the sunrise or sunset has to be calculated.
        </para>

        <para>
            As most people do not know the location of their city we have also spent a helper class which provides
            the location data for about 250 capital and other big cities around the whole world. Most people could
            use cities near themself as the difference for locations situated to each other can only be measured
            within some seconds.
        </para>

        <para>
            For creating a listbox and choosing a special city the function <code>Zend_Date_Cities::getCityList</code>
            can be used. It returns the names of all available predefined cities for the helper class.
        </para>

        <example id="zend.date.additional.sunrise-sunset.example-1">
            <title>Getting all available cities</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date/Cities.php';

// Output the complete list of available cities
print_r (Zend_Date_Cities::getCityList());]]>
            </programlisting>
        </example>

        <para>
            The location itself can be received with the <code>Zend_Date_Cities::City()</code> function.
            It accepts the name of the city as returned by the <code>Zend_Date_Cities::getCityList()</code>
            function and optional as second parameter the horizon to set.
        </para>

        <para>
            There are 4 defined horizons which can be used with locations to receive the exact time of sunset and
            sunrise. The '<code>horizon</code>' parameter is always optional in all functions. If it is not set, the
            '<code>effective</code>' horizon is used.
        </para>

        <table id="zend.date.additional.sunrise-sunset.table">
            <title>Types of supported horizons for sunset and sunrise</title>
            <tgroup cols="3">
                <thead>
                    <row>
                        <entry>Horizon</entry>
                        <entry>Description</entry>
                        <entry>Usage</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>effective</entry>
                        <entry>Standard horizon</entry>
                        <entry>Expects the world to be a ball. This horizon is always used if non is defined.</entry>
                    </row>
                    <row>
                        <entry>civil</entry>
                        <entry>Common horizon</entry>
                        <entry>Often used in common medias like TV or radio</entry>
                    </row>
                    <row>
                        <entry>nautic</entry>
                        <entry>Nautic horizon</entry>
                        <entry>Often used in sea navigation</entry>
                    </row>
                    <row>
                        <entry>astronomic</entry>
                        <entry>Astronomic horizon</entry>
                        <entry>Often used for calculation with stars</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            Of course also a self-defined location can be given and calculated with. Therefor a '<code>latitude</code>'
            and a '<code>longitude</code>' has to be given and optional the '<code>horizon</code>'.
        </para>

        <example id="zend.date.additional.sunrise-sunset.example-2">
            <title>Getting the location for a city</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date/Cities.php';

// Get the location for a defined city
// uses the effective horizon as no horizon is defined
print_r (Zend_Date_Cities::City('Vienna'));

// use the nautic horizon
print_r (Zend_Date_Cities::City('Vienna', 'nautic'));

// self definition of a location
$mylocation = array('latitude' => 41.5, 'longitude' => 13.2446);]]>
            </programlisting>
        </example>

        <para>
            As now all needed data can be set the next is to create a <code>Zend_Date</code> object with the day where
            sunset or sunrise should be calculated. For the calculation there are 3 functions available. It is possible
            to calculate sunset with '<code>getSunset()</code>', sunrise with '<code>getSunrise()</code>' and all
            available informations related to the sun with '<code>getSunInfo()</code>'. After the calculation the
            <code>Zend_Date</code> object will be returned with the calculated time.
        </para>

        <example id="zend.date.additional.sunrise-sunset.example-3">
            <title>Calculating sun informations</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';
require_once 'Zend/Date/Cities.php';

// Get the location for a defined city
$city = Zend_Date_Cities::City('Vienna');

// create a date object for the day for which the sun has to be calculated
$date = new Zend_Date('10.03.2007', Zend_Date::ISO_8601, 'de');

// calculate sunset
$sunset = $date->getSunset($city);
print $sunset->get(Zend_Date::ISO_8601);

// calculate all sun informations
$info = $date->getSunInfo($city);
foreach ($info as $sun) {
    print "\n" . $sun->get(Zend_Date::ISO_8601);
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.date.additional.timezones">

        <title>Timezones</title>

        <para>
            Timezones are as important as dates themselves. There are several timezones depending on where
            in the world a user lives. So working with dates also means to set the proper timezone.
            This may sound complicated but it's easier as expected. As already mentioned in the first chapter
            of <code>Zend_Date</code> the default timezone has to be set. Eigther by <code>php.ini</code> or
            by definition within the bootstrap file.
        </para>

        <para>
            A <code>Zend_Date</code> object of course also stores the actual timezone. Even if the timezone
            is changed after the creation of the object it remembers the original timezone and works with it.
            It is also not necessary to change the timezone within the code with php functions.
            <code>Zend_Date</code> has two built-in functions which makes it possible to handle this.
        </para>

        <para>
            <code>getTimezone()</code> returns the actual set timezone of within the <code>Zend_Date</code>
            object. Remember that <code>Zend_Date</code> is not coupled with php internals. So the returned
            timezone is not the timezone of the php script but the timezone of the object.
            <code>setTimezone($zone)</code> is the second function and makes it possible to set new timezone for
            <code>Zend_Date</code>. A given timezone is always checked. If it does not exist an exception will
            be thrown. Additionally the actual scripts or systems timezone can be set to the date object by
            calling  <code>setTimezone()</code> without the zone parameter. This is also done automatically
            when the date object is created.
        </para>

        <example id="zend.date.additional.timezones.example-1">
            <title>Working with timezones</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

// Set a default timezone... this has to be done within the bootstrap file or php.ini
// We do this here just for having a complete example
date_default_timezone_set('Europe/Vienna');

// create a date object
$date = new Zend_Date('10.03.2007', Zend_Date::ISO_8601, 'de');

// view our date object
print $date->getIso();

// what timezone do we have ?
print $date->getTimezone();

// set another timezone
$date->setTimezone('America/Chicago');

// what timezone do we now have ?
print $date->getTimezone();

// see the changed date object
print $date->getIso();]]>
            </programlisting>
        </example>

        <para>
            <code>Zend_Date</code> always takes the actual timezone for object creation as shown in the first
            lines of the example. Changing the timezone within the created object also has an effect to the
            date itself. Dates are always related to a timezone. Changing the timezone for a <code>Zend_Date</code>
            object does not change the time of <code>Zend_Date</code>. Remember that internally dates are always
            stored as timestamps and in GMT. So the timezone means how much hours should be substracted or added
            to get the actual global time for the own timezone and region.
        </para>

        <para>
            Having the timezone coupled within <code>Zend_Date</code> has another positive effect. It is possible
            to have several dates with different timezones.
        </para>

        <example id="zend.date.additional.timezones.example-2">
            <title>Multiple timezones</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

// Set a default timezone... this has to be done within the bootstrap file or php.ini
// We do this here just for having a complete example
date_default_timezone_set('Europe/Vienna');

// create a date object
$date = new Zend_Date('10.03.2007 00:00:00', Zend_Date::ISO_8601, 'de');

// view our date object
print $date->getIso();

// the date stays unchanged even after changeing the timezone
date_default_timezone_set('America/Chicago');
print $date->getIso();

$otherdate = clone $date;
$otherdate->setTimezone('Brazil/Acre');

// view our date object
print $otherdate->getIso();

// set the object to the actual systems timezone
$lastdate = clone $date;
$lastdate->setTimezone();

// view our date object
print $lastdate->getIso();]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.date.basic">

    <title>Basic Methods</title>

    <para>
        The following sections show basic usage of <code>Zend_Date</code> primarily by example. For this manual, "dates"
        always imply a calendar date with a time, even when not explicitly mentioned, and vice-versa. The part not
        specified defaults to an internal representation of "zero". Thus, adding a date having no calendar date and a
        time value of 12 hours to another date consisting only of a calendar date would result in a date having that
        calendar date and a time of "noon".
    </para>

    <para>
        Setting only a specific date, with no time part, implies a time set to 00:00:00. Conversely, setting only a
        specific time implies a date internally set to 01.01.1970 plus the number of seconds equal to the elapsed hours,
        minutes, and seconds identified by the time. Normally, people measure things from a starting point, such as the
        year 0 A.D. However, many software systems use the first second of the year 1970 as the starting point, and
        denote times as a timestamp offset counting the number of seconds elapsed from this starting point.
    </para>

    <sect2 id="zend.date.basic.creation">

        <title>The current date</title>

        <para>
            Without any arguments, constructing an instance returns an object in the default locale with the current,
            local date using PHP's <code>time()</code> function to obtain the
            <ulink url="http://en.wikipedia.org/wiki/Unix_Time">UNIX timestamp</ulink>
            for the object. Make sure your PHP environment has the correct
            <link linkend="zend.date.setdefaulttimezone">default timezone</link>
            .
        </para>

        <example id="zend.date.basic.creation.example-1">
            <title>Creating the current date</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date();

// Output of the current timestamp
print $date;]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.date.basic.functions">

        <title>Zend_Date by Example</title>

        <para>
            Reviewing basic methods of <code>Zend_Date</code> is a good place to start for those unfamiliar with date
            objects in other languages or frameworks. A small example will be provided for each method below.
        </para>

        <sect3 id="zend.date.simple.functions.get">

            <title>Ouput a Date</title>

            <para>
                The date in a <code>Zend_Date</code> object may be obtained as a localized integer or string using the
                <code>get()</code> method. There are many available options, which will be explained in later sections.
            </para>

            <example id="zend.date.simple.functions.get.example-1">
                <title>get() - output a date</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date();

// Output of the desired date
print $date->get();]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.date.simple.functions.set">

            <title>Setting a Date</title>

            <para>
                The <code>set()</code> method alters the date stored in the object, and returns the final date value as
                a timestamp (not an object). Again, there are many options which will be explored in later sections.
            </para>

            <example id="zend.date.simple.functions.set.example-1">
                <title>set() - set a date</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date();

// Setting of a new time
$date->set('13:00:00',Zend_Date::TIMES);
print $date->get(Zend_Date::W3C);]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.date.simple.functions.add">

            <title>Adding and Subtracting Dates</title>

            <para>
                Adding two dates with <code>add()</code> usually involves adding a real date in time with an artificial
                timestramp representing a date part, such as 12 hours, as shown in the example below. Both
                <code>add()</code> and <code>sub()</code> use the same set of options as <code>set()</code>, which will
                be explained later.
            </para>

            <example id="zend.date.simple.functions.add.example-1">
                <title>add() - adding dates</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date();

// changes $date by adding 12 hours
$date->add('12:00:00', Zend_Date::TIMES);

echo "Date via get() = ", $date->get(Zend_Date::W3C), "\n";

// use magic __toString() method to call Zend_Date's toString()
echo "Date via toString() = ", $date, "\n";]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.date.simple.functions.compare">

            <title>Comparation of dates</title>

            <para>
                All basic <code>Zend_Date</code> methods can operate on entire dates contained in the objects, or can
                operate on date parts, such as comparing the minutes value in a date to an absolute value. For example,
                the current minutes in the current time may be compared with a specific number of minutes using
                <code>compare()</code>, as in the example below.
            </para>

            <example id="zend.date.simple.functions.compare.example-1">
                <title>compare() - compare dates</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date();

// Comparation of both times
if ($date->compare(10, Zend_Date::MINUTE) == -1) {
    print "This hour is less than 10 minutes old";
} else {
    print "This hour is at least 10 minutes old";
}]]>
                </programlisting>
            </example>

            <para>
                For simple equality comparisons, use <code>equals()</code>, which returns a boolean.
            </para>

            <example id="zend.date.simple.functions.compare.example-2">
                <title>equals() - identify a date or date part</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date();

// Comparation of the two dates
if ($date->equals(10, Zend_Date::HOUR)) {
    print "It's 10 o'clock. Time to get to work.";
} else {
    print "It is not 10 o'clock. You can keep sleeping.";
}]]>
                </programlisting>
            </example>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.date.constants">

    <title>Constants for General Date Functions</title>

    <para>
        Whenever a <code>Zend_Date</code> method has a <code>$parts</code> parameter, one of the constants below can be
        used as the argument for that parameter, in order to select a specific part of a date or indicate the date
        format used or desired (e.g. RFC 822).
    </para>

    <sect2 id="zend.date.constants.using">

        <title>Using Constants</title>

        <para>
            For example, the constant <code>Zend_Date::HOUR</code> can be used in the ways shown below. When working
            with days of the week, calendar dates, hours, minutes, seconds, and any other date parts that are expressed
            differently when in different parts of the world, the object's timezone will automatically be used to
            compute the correct value, even though the internal timestamp is the same for the same moment in time,
            regardless of the user's physical location in the world. Regardless of the units involved, output must be
            expressed either as GMT/UTC or localized to a locale. The example output below reflects localization to
            Europe/GMT+1 hour (e.g. Germany, Austria, France).
        </para>

        <table id="zend.date.constants.using.table">
            <title>Operations involving Zend_Date::HOUR</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Function/input</entry>
                        <entry>Description</entry>
                        <entry>Original date</entry>
                        <entry>Effect/output</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>get(Zend_Date::HOUR)</entry>
                        <entry>Output of the hour</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>14</entry>
                    </row>
                    <row>
                        <entry>set(12, Zend_Date::HOUR)</entry>
                        <entry>Set new hour</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>2009-02-13T12:53:27+01:00</entry>
                    </row>
                    <row>
                        <entry>add(12, Zend_Date::HOUR)</entry>
                        <entry>Add hours</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>2009-02-14T02:53:27+01:00</entry>
                    </row>
                    <row>
                        <entry>sub(12, Zend_Date::HOUR)</entry>
                        <entry>Subtract hours</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>2009-02-13T02:53:27+01:00</entry>
                    </row>
                    <row>
                        <entry>compare(12, Zend_Date::HOUR)</entry>
                        <entry>Compare hour, returns 0, 1 or -1</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>1 (if object > argument)</entry>
                    </row>
                    <row>
                        <entry>copy(Zend_Date::HOUR)</entry>
                        <entry>Copies only the hour part</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>1970-01-01T14:00:00+01:00</entry>
                    </row>
                    <row>
                        <entry>equals(14, Zend_Date::HOUR)</entry>
                        <entry>Compares the hour, returns TRUE or FALSE</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>TRUE</entry>
                    </row>
                    <row>
                        <entry>isEarlier(12, Zend_Date::HOUR)</entry>
                        <entry>Compares the hour, returns TRUE or FALSE</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>TRUE</entry>
                    </row>
                    <row>
                        <entry>isLater(12, Zend_Date::HOUR)</entry>
                        <entry>Compares the hour, returns TRUE or FALSE</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry>FALSE</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect2>

    <sect2 id="zend.date.constants.list">

        <title>List of All Constants</title>

        <para>
            Each part of a date/time has a unique constant in <code>Zend_Date</code>. All constants supported by
            <code>Zend_Date</code> are listed below.
        </para>

        <table id="zend.date.constants.list.table-1">
            <title>Day Constants</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::DAY</entry>
                        <entry>Day (as a number, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry>2009-02-<emphasis role="strong">06</emphasis>T14:53:27+01:00 (06)</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DAY_SHORT</entry>
                        <entry>Day (as a number, one or two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry>2009-02-0<emphasis role="strong">6</emphasis>T14:53:27+01:00 (6)</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::WEEKDAY</entry>
                        <entry>Weekday (Name of the day, localized, complete)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Friday</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::WEEKDAY_SHORT</entry>
                        <entry>Weekday (Name of the day, localized, abbreviated, the first three digits)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Fre</emphasis> for Friday</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::WEEKDAY_NAME</entry>
                        <entry>Weekday (Name of the day, localized, abbreviated, the first two digits)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Fr</emphasis> for Friday</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::WEEKDAY_NARROW</entry>
                        <entry>Weekday (Name of the day, localized, abbreviated, only the first digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">F</emphasis> for Friday</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::WEEKDAY_DIGIT</entry>
                        <entry>Weekday (0 = Sunday, 6 = Saturday)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">5</emphasis> for Friday</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::WEEKDAY_8601</entry>
                        <entry>Weekday according to ISO 8601 (1 = Monday, 7 = Sunday)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">5</emphasis> for Friday</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DAY_OF_YEAR</entry>
                        <entry>Day (as a number, one or two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">43</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DAY_SUFFIX</entry>
                        <entry>English addendum for the day (st, nd, rd, th)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">th</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <table id="zend.date.constants.list.table-2">
            <title>Week Constants</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::WEEK</entry>
                        <entry>Week (as a number, 1-53)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">7</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <table id="zend.date.constants.list.table-3">
            <title>Month Constants</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::MONTH_NAME</entry>
                        <entry>Month (Name of the month, localized, complete)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">February</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MONTH_NAME_SHORT</entry>
                        <entry>Month (Name of the month, localized, abbreviated, three digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Feb</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MONTH_NAME_NARROW</entry>
                        <entry>Month (Name of the month, localized, abbreviated, one digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">F</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MONTH</entry>
                        <entry>Month (Number of the month, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry>2009-<emphasis role="strong">02</emphasis>-06T14:53:27+01:00 (02)</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MONTH_SHORT</entry>
                        <entry>Month (Number of the month, one or two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry>2009-0<emphasis role="strong">2</emphasis>-06T14:53:27+01:00 (2)</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MONTH_DAYS</entry>
                        <entry>Number of days for this month (number)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">28</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <table id="zend.date.constants.list.table-4">
            <title>Year Constants</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::YEAR</entry>
                        <entry>Year (number)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">2009</emphasis>-02-06T14:53:27+01:00</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::YEAR_8601</entry>
                        <entry>Year according to ISO 8601 (number)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::YEAR_SHORT</entry>
                        <entry>Year (number, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry>20<emphasis role="strong">09</emphasis>-02-06T14:53:27+01:00</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::YEAR_SHORT_8601</entry>
                        <entry>Year according to ISO 8601 (number, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">09</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::LEAPYEAR</entry>
                        <entry>Is the year a leap year? (TRUE or FALSE)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">FALSE</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <table id="zend.date.constants.list.table-5">
            <title>Time Constants</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::HOUR</entry>
                        <entry>Hour (00-23, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">14</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::HOUR_SHORT</entry>
                        <entry>Hour (0-23, one or two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">14</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::HOUR_SHORT_AM</entry>
                        <entry>Hour (1-12, one or two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::HOUR_AM</entry>
                        <entry>Hour (01-12, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MINUTE</entry>
                        <entry>Minute (00-59, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry>2009-02-06T14:<emphasis role="strong">53</emphasis>:27+01:00</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MINUTE_SHORT</entry>
                        <entry>Minute (0-59, one or two digit)</entry>
                        <entry>2009-02-06T14:03:27+01:00</entry>
                        <entry>2009-02-06T14:0<emphasis role="strong">3</emphasis>:27+01:00</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::SECOND</entry>
                        <entry>Second (00-59, two digit)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry>2009-02-06T14:53:<emphasis role="strong">27</emphasis>+01:00</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::SECOND_SHORT</entry>
                        <entry>Second (0-59, one or two digit)</entry>
                        <entry>2009-02-06T14:53:07+01:00</entry>
                        <entry>2009-02-06T14:53:0<emphasis role="strong">7</emphasis>+01:00</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MILLISECOND</entry>
                        <entry>Millisecond (theoretically infinite)</entry>
                        <entry>2009-02-06T14:53:27.20546</entry>
                        <entry>2009-02-06T14:53:27.<emphasis role="strong">20546</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::MERIDIEM</entry>
                        <entry>Time of day (forenoon/afternoon)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">afternoon</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::SWATCH</entry>
                        <entry>Swatch Internet Time</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">620</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <table id="zend.date.constants.list.table-6">
            <title>Timezone Constants</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::TIMEZONE</entry>
                        <entry>Name der time zone (string, abbreviated)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">CET</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIMEZONE_NAME</entry>
                        <entry>Name of the time zone (string, complete)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Europe/Paris</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIMEZONE_SECS</entry>
                        <entry>Difference of the time zone to GMT in seconds (integer)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">3600</emphasis> seconds to GMT</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::GMT_DIFF</entry>
                        <entry>Difference to GMT in seconds (string)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">+0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::GMT_DIFF_SEP</entry>
                        <entry>Difference to GMT in seconds (string, separated)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">+01:00</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DAYLIGHT</entry>
                        <entry>Summer time or Winter time? (TRUE or FALSE)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">FALSE</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <table id="zend.date.constants.list.table-7">
            <title>Date Format Constants (formats include timezone)</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::ISO_8601</entry>
                        <entry>Date according to ISO 8601 (string, complete)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">2009-02-13T14:53:27+01:00</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::RFC_2822</entry>
                        <entry>Date according to RFC 2822 (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Fri, 13 Feb 2009 14:53:27 +0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIMESTAMP</entry>
                        <entry>
                            <ulink url="http://en.wikipedia.org/wiki/Unix_Time">Unix time</ulink> (seconds since 1.1.1970, mixed)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">1234533207</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::ATOM</entry>
                        <entry>Date according to ATOM (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">2009-02-13T14:53:27+01:00</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::COOKIE</entry>
                        <entry>Date for Cookies (string, for Cookies)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Friday, 13-Feb-09 14:53:27 Europe/Paris</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::RFC_822</entry>
                        <entry>Date according to RFC 822 (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Fri, 13 Feb 09 14:53:27 +0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::RFC_850</entry>
                        <entry>Date according to RFC 850 (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Friday, 13-Feb-09 14:53:27 Europe/Paris</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::RFC_1036</entry>
                        <entry>Date according to RFC 1036 (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Fri, 13 Feb 09 14:53:27 +0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::RFC_1123</entry>
                        <entry>Date according to RFC 1123 (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Fri, 13 Feb 2009 14:53:27 +0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::RSS</entry>
                        <entry>Date for RSS Feeds (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Fri, 13 Feb 2009 14:53:27 +0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::W3C</entry>
                        <entry>Date for HTML/HTTP according to W3C (string)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">2009-02-13T14:53:27+01:00</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            Especially note <code>Zend_Date::DATES</code>, since this format specifier has a unique property within
            <code>Zend_Date</code> as an <emphasis role="strong">input</emphasis> format specifier. When used as an
            input format for <code>$part</code>, this constant provides the most flexible acceptance of a variety of
            similar date formats. Heuristics are used to automatically extract dates from an input string and then "fix"
            simple errors in dates (if any), such as swapping of years, months, and days, when possible.
        </para>

        <table id="zend.date.constants.list.table-8">
            <title>Date and Time Formats (format varies by locale)</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Date</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Zend_Date::ERA</entry>
                        <entry>Epoch (string, localized, abbreviated)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">AD</emphasis> (anno Domini)</entry>
                    </row>
                    <row>
                        <entry>Zend_Date::ERA_NAME</entry>
                        <entry>Epoch (string, localized, complete)</entry>
                        <entry>2009-02-06T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">anno domini</emphasis> (anno Domini)</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Zend_Date::DATES</emphasis>
                        </entry>
                        <entry>Standard date (string, localized, default value).</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">13.02.2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DATE_FULL</entry>
                        <entry>Complete date (string, localized, complete)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">Friday, 13. February 2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DATE_LONG</entry>
                        <entry>Long date (string, localized, long)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">13. February 2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DATE_MEDIUM</entry>
                        <entry>Normal date (string, localized, normal)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">13.02.2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::DATE_SHORT</entry>
                        <entry>Abbreviated Date (string, localized, abbreviated)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">13.02.09</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIMES</entry>
                        <entry>Standard time (string, localized, default value)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">14:53:27</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIME_FULL</entry>
                        <entry>Complete time (string, localized, complete)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">14:53 Uhr CET</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIME_LONG</entry>
                        <entry>Long time (string, localized, Long)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">14:53:27 CET</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIME_MEDIUM</entry>
                        <entry>Normal time (string, localized, normal)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">14:53:27</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Zend_Date::TIME_SHORT</entry>
                        <entry>Abbreviated time (string, localized, abbreviated)</entry>
                        <entry>2009-02-13T14:53:27+01:00</entry>
                        <entry><emphasis role="strong">14:53</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect2>

    <sect2 id="zend.date.constants.selfdefinedformats">

        <title>Self-Defined OUTPUT Formats with ISO</title>

        <para>
            If you need a date format not shown above, then use a self-defined format composed from the ISO format token
            specifiers below. The following examples illustrate the usage of constants from the table below to create
            self-defined ISO formats. The format length is unlimited. Also, multiple usage of format constants is
            allowed.
        </para>

        <para>
            The accepted format specifiers can be changed from ISO Format to PHP's date format if you are more
            comfortable with it. However, not all formats defined in the ISO norm are supported with PHP's date format
            specifiers. Use the <code>Zend_Date::setOptions(array('format_type' => 'php'))</code> method to switch
            Zend_Date methods from supporting ISO format specifiers to PHP date() type specifiers (see
            <xref linkend="zend.date.constants.phpformats" />
            below).
        </para>

        <example id="zend.date.constants.selfdefinedformats.example-1">
            <title>Example usage for self-defined ISO formats</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$locale = new Zend_Locale('de_AT');
$date = new Zend_Date(1234567890, false, $locale);
print $date->toString("'Era:GGGG='GGGG, ' Date:yy.MMMM.dd'yy.MMMM.dd");]]>
            </programlisting>
        </example>

        <table id="zend.date.constants.selfdefinedformats.table">
            <title>Constants for <emphasis role="strong">ISO 8601 date output</emphasis>
            </title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Corresponds best to</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>G</entry>
                        <entry>Epoch, localized, abbreviated</entry>
                        <entry>Zend_Date::ERA</entry>
                        <entry><emphasis role="strong">AD</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>GG</entry>
                        <entry>Epoch, localized, abbreviated</entry>
                        <entry>Zend_Date::ERA</entry>
                        <entry><emphasis role="strong">AD</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>GGG</entry>
                        <entry>Epoch, localized, abbreviated</entry>
                        <entry>Zend_Date::ERA</entry>
                        <entry><emphasis role="strong">AD</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>GGGG</entry>
                        <entry>Epoch, localized, complete</entry>
                        <entry>Zend_Date::ERA_NAME</entry>
                        <entry><emphasis role="strong">anno domini</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>GGGGG</entry>
                        <entry>Epoch, localized, abbreviated</entry>
                        <entry>Zend_Date::ERA</entry>
                        <entry><emphasis role="strong">a</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>y</entry>
                        <entry>Year, at least one digit</entry>
                        <entry>Zend_Date::YEAR</entry>
                        <entry><emphasis role="strong">9</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>yy</entry>
                        <entry>Year, at least two digit</entry>
                        <entry>Zend_Date::YEAR_SHORT</entry>
                        <entry><emphasis role="strong">09</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>yyy</entry>
                        <entry>Year, at least three digit</entry>
                        <entry>Zend_Date::YEAR</entry>
                        <entry><emphasis role="strong">2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>yyyy</entry>
                        <entry>Year, at least four digit</entry>
                        <entry>Zend_Date::YEAR</entry>
                        <entry><emphasis role="strong">2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>yyyyy</entry>
                        <entry>Year, at least five digit</entry>
                        <entry>Zend_Date::YEAR</entry>
                        <entry><emphasis role="strong">02009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Y</entry>
                        <entry>Year according to ISO 8601, at least one digit</entry>
                        <entry>Zend_Date::YEAR_8601</entry>
                        <entry><emphasis role="strong">9</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>YY</entry>
                        <entry>Year according to ISO 8601, at least two digit</entry>
                        <entry>Zend_Date::YEAR_SHORT_8601</entry>
                        <entry><emphasis role="strong">09</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>YYY</entry>
                        <entry>Year according to ISO 8601, at least three digit</entry>
                        <entry>Zend_Date::YEAR_8601</entry>
                        <entry><emphasis role="strong">2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>YYYY</entry>
                        <entry>Year according to ISO 8601, at least four digit</entry>
                        <entry>Zend_Date::YEAR_8601</entry>
                        <entry><emphasis role="strong">2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>YYYYY</entry>
                        <entry>Year according to ISO 8601, at least five digit</entry>
                        <entry>Zend_Date::YEAR_8601</entry>
                        <entry><emphasis role="strong">02009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>M</entry>
                        <entry>Month, one or two digit</entry>
                        <entry>Zend_Date::MONTH_SHORT</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>MM</entry>
                        <entry>Month, two digit</entry>
                        <entry>Zend_Date::MONTH</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>MMM</entry>
                        <entry>Month, localized, abbreviated</entry>
                        <entry>Zend_Date::MONTH_NAME_SHORT</entry>
                        <entry><emphasis role="strong">Feb</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>MMMM</entry>
                        <entry>Month, localized, complete</entry>
                        <entry>Zend_Date::MONTH_NAME</entry>
                        <entry><emphasis role="strong">February</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>MMMMM</entry>
                        <entry>Month, localized, abbreviated, one digit</entry>
                        <entry>Zend_Date::MONTH_NAME_NARROW</entry>
                        <entry><emphasis role="strong">F</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>w</entry>
                        <entry>Week, one or two digit</entry>
                        <entry>Zend_Date::WEEK</entry>
                        <entry><emphasis role="strong">5</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>ww</entry>
                        <entry>Week, two digit</entry>
                        <entry>Zend_Date::WEEK</entry>
                        <entry><emphasis role="strong">05</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>d</entry>
                        <entry>Day of the month, one or two digit</entry>
                        <entry>Zend_Date::DAY_SHORT</entry>
                        <entry><emphasis role="strong">9</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>dd</entry>
                        <entry>Day of the month, two digit</entry>
                        <entry>Zend_Date::DAY</entry>
                        <entry><emphasis role="strong">09</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>D</entry>
                        <entry>Day of the year, one, two or three digit</entry>
                        <entry>Zend_Date::DAY_OF_YEAR</entry>
                        <entry><emphasis role="strong">7</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>DD</entry>
                        <entry>Day of the year, two or three digit</entry>
                        <entry>Zend_Date::DAY_OF_YEAR</entry>
                        <entry><emphasis role="strong">07</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>DDD</entry>
                        <entry>Day of the year, three digit</entry>
                        <entry>Zend_Date::DAY_OF_YEAR</entry>
                        <entry><emphasis role="strong">007</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>E</entry>
                        <entry>Day of the week, localized, abbreviated, one char</entry>
                        <entry>Zend_Date::WEEKDAY_NARROW</entry>
                        <entry><emphasis role="strong">M</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>EE</entry>
                        <entry>Day of the week, localized, abbreviated, two char</entry>
                        <entry>Zend_Date::WEEKDAY_NAME</entry>
                        <entry><emphasis role="strong">Mo</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>EEE</entry>
                        <entry>Day of the week, localized, abbreviated, three char</entry>
                        <entry>Zend_Date::WEEKDAY_SHORT</entry>
                        <entry><emphasis role="strong">Mon</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>EEEE</entry>
                        <entry>Day of the week, localized, complete</entry>
                        <entry>Zend_Date::WEEKDAY</entry>
                        <entry><emphasis role="strong">Monday</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>EEEEE</entry>
                        <entry>Day of the week, localized, abbreviated, one digit</entry>
                        <entry>Zend_Date::WEEKDAY_NARROW</entry>
                        <entry><emphasis role="strong">M</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>e</entry>
                        <entry>Number of the day, one digit</entry>
                        <entry>Zend_Date::WEEKDAY_NARROW</entry>
                        <entry><emphasis role="strong">4</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>ee</entry>
                        <entry>Number of the day, two digit</entry>
                        <entry>Zend_Date::WEEKDAY_NARROW</entry>
                        <entry><emphasis role="strong">04</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>a</entry>
                        <entry>Time of day, localized</entry>
                        <entry>Zend_Date::MERIDIEM</entry>
                        <entry><emphasis role="strong">vorm.</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>h</entry>
                        <entry>Hour, (1-12), one or two digit</entry>
                        <entry>Zend_Date::HOUR_SHORT_AM</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>hh</entry>
                        <entry>Hour, (01-12), two digit</entry>
                        <entry>Zend_Date::HOUR_AM</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>H</entry>
                        <entry>Hour, (0-23), one or two digit</entry>
                        <entry>Zend_Date::HOUR_SHORT</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>HH</entry>
                        <entry>Hour, (00-23), two digit</entry>
                        <entry>Zend_Date::HOUR</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>m</entry>
                        <entry>Minute, (0-59), one or two digit</entry>
                        <entry>Zend_Date::MINUTE_SHORT</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>mm</entry>
                        <entry>Minute, (00-59), two digit</entry>
                        <entry>Zend_Date::MINUTE</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>s</entry>
                        <entry>Second, (0-59), one or two digit</entry>
                        <entry>Zend_Date::SECOND_SHORT</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>ss</entry>
                        <entry>Second, (00-59), two digit</entry>
                        <entry>Zend_Date::SECOND</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>S</entry>
                        <entry>Millisecond</entry>
                        <entry>Zend_Date::MILLISECOND</entry>
                        <entry><emphasis role="strong">20536</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>z</entry>
                        <entry>Time zone, localized, abbreviated</entry>
                        <entry>Zend_Date::TIMEZONE</entry>
                        <entry><emphasis role="strong">CET</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>zz</entry>
                        <entry>Time zone, localized, abbreviated</entry>
                        <entry>Zend_Date::TIMEZONE</entry>
                        <entry><emphasis role="strong">CET</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>zzz</entry>
                        <entry>Time zone, localized, abbreviated</entry>
                        <entry>Zend_Date::TIMEZONE</entry>
                        <entry><emphasis role="strong">CET</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>zzzz</entry>
                        <entry>Time zone, localized, complete</entry>
                        <entry>Zend_Date::TIMEZONE_NAME</entry>
                        <entry><emphasis role="strong">Europe/Paris</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Z</entry>
                        <entry>Difference of time zone</entry>
                        <entry>Zend_Date::GMT_DIFF</entry>
                        <entry><emphasis role="strong">+0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>ZZ</entry>
                        <entry>Difference of time zone</entry>
                        <entry>Zend_Date::GMT_DIFF</entry>
                        <entry><emphasis role="strong">+0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>ZZZ</entry>
                        <entry>Difference of time zone</entry>
                        <entry>Zend_Date::GMT_DIFF</entry>
                        <entry><emphasis role="strong">+0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>ZZZZ</entry>
                        <entry>Difference of time zone, separated</entry>
                        <entry>Zend_Date::GMT_DIFF_SEP</entry>
                        <entry><emphasis role="strong">+01:00</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>A</entry>
                        <entry>Millisecond</entry>
                        <entry>Zend_Date::MILLISECOND</entry>
                        <entry><emphasis role="strong">20563</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <note>
            <para>
                Note that the default ISO format differs from PHP's format which can be
                irritating if you have not used in previous. Especially the format specifiers
                for <emphasis role="strong">Year and Minute</emphasis> are often not used in the
                intended way.
            </para>

            <para>
                For <emphasis role="strong">year</emphasis> there are two specifiers available
                which are often mistaken. The <emphasis role="strong">Y</emphasis> specifier
                for the ISO year and the <emphasis role="strong">y</emphasis> specifier for the
                real year. The difference is small but significant.
                <emphasis role="strong">Y</emphasis> calculates the ISO year, which is often used
                for calendar formats. See for example the 31. December 2007. The real year is
                2007, but it is the first day of the first week in the week 1 of the year 2008.
                So, if you are using 'dd.MM.yyyy' you will get '31.December.2007' but if you use
                'dd.MM.YYYY' you will get '31.December.2008'. As you see this is no bug but a
                expected behaviour depending on the used specifiers.
            </para>

            <para>
                For <emphasis role="strong">minute</emphasis> the difference is not so big. ISO
                uses the specifier <emphasis role="strong">m</emphasis> for the minute, unlike
                PHP which uses <emphasis role="strong">i</emphasis>. So if you are getting no
                minute in your format check if you have used the right specifier.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.date.constants.phpformats">

        <title>Self-defined OUTPUT formats using PHP's date() format specifiers</title>

        <para>
            If you are more comfortable with PHP's date format specifier than with ISO format specifiers, then you can
            use the <code>Zend_Date::setOptions(array('format' => 'php'))</code> method to switch Zend_Date methods from
            supporting ISO format specifiers to PHP date() type specifiers. Afterwards, all format parameters must be
            given with
            <ulink url="http://php.net/date">PHP's <code>date()</code> format specifiers</ulink>
            . The PHP date format lacks some of the formats supported by the ISO Format, and vice-versa. If you are not
            already comfortable with it, then use the standard ISO format instead. Also, if you have legacy code using
            PHP's date format, then either manually convert it to the ISO format using
            <link linkend="zend.locale.date.normalize">Zend_Locale_Format::convertPhpToIsoFormat()</link>
            , or use <code>setOptions()</code>. The following examples illustrate the usage of constants from the table
            below to create self-defined formats.
        </para>

        <example id="zend.date.constants.phpformats.example-1">
            <title>Example usage for self-defined formats with PHP specifier</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$locale = new Zend_Locale('de_AT');
Zend_Date::setOptions(array('format_type' => 'php'));
$date = new Zend_Date(1234567890, false, $locale);

// outputs something like 'February 16, 2007, 3:36 am'
print $date->toString('F j, Y, g:i a');

print $date->toString("'Format:D M j G:i:s T Y='D M j G:i:s T Y");]]>
            </programlisting>
        </example>

        <para>
            The following table shows the list of PHP date format specifiers with their equivalent Zend_Date constants
            and CLDR/ISO equivalent format specifiers. In most cases, when the CLDR/ISO format does not have an
            equivalent format specifier, the PHP format specifier is not altered by
            <code>Zend_Locale_Format::convertPhpToIsoFormat()</code>, and the Zend_Date methods then recognize these
            "peculiar" PHP format specifiers, even when in the default "ISO" format mode.
        </para>

        <table id="zend.date.constants.phpformats.table">
            <title>Constants for <emphasis role="strong">PHP date output</emphasis>
            </title>
            <tgroup cols="5">
                <thead>
                    <row>
                        <entry>Constant</entry>
                        <entry>Description</entry>
                        <entry>Corresponds best to</entry>
                        <entry>closest CLDR equivalent</entry>
                        <entry>Affected part/example</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>d</entry>
                        <entry>Day of the month, two digit</entry>
                        <entry>Zend_Date::DAY</entry>
                        <entry>dd</entry>
                        <entry><emphasis role="strong">09</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>D</entry>
                        <entry>Day of the week, localized, abbreviated, three digit</entry>
                        <entry>Zend_Date::WEEKDAY_SHORT</entry>
                        <entry>EEE</entry>
                        <entry><emphasis role="strong">Mon</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>j</entry>
                        <entry>Day of the month, one or two digit</entry>
                        <entry>Zend_Date::DAY_SHORT</entry>
                        <entry>d</entry>
                        <entry><emphasis role="strong">9</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>l (lowercase L)</entry>
                        <entry>Day of the week, localized, complete</entry>
                        <entry>Zend_Date::WEEKDAY</entry>
                        <entry>EEEE</entry>
                        <entry><emphasis role="strong">Monday</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>N</entry>
                        <entry>Number of the weekday, one digit</entry>
                        <entry>Zend_Date::WEEKDAY_8601</entry>
                        <entry>e</entry>
                        <entry><emphasis role="strong">4</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>S</entry>
                        <entry>English suffixes for day of month, two chars</entry>
                        <entry>no equivalent</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">st</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>w</entry>
                        <entry>Number of the weekday, 0=sunday, 6=saturday</entry>
                        <entry>Zend_Date::WEEKDAY_DIGIT</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">4</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>z</entry>
                        <entry>Day of the year, one, two or three digit</entry>
                        <entry>Zend_Date::DAY_OF_YEAR</entry>
                        <entry>D</entry>
                        <entry><emphasis role="strong">7</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>W</entry>
                        <entry>Week, one or two digit</entry>
                        <entry>Zend_Date::WEEK</entry>
                        <entry>w</entry>
                        <entry><emphasis role="strong">5</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>F</entry>
                        <entry>Month, localized, complete</entry>
                        <entry>Zend_Date::MONTH_NAME</entry>
                        <entry>MMMM</entry>
                        <entry><emphasis role="strong">February</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>m</entry>
                        <entry>Month, two digit</entry>
                        <entry>Zend_Date::MONTH</entry>
                        <entry>MM</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>M</entry>
                        <entry>Month, localized, abbreviated</entry>
                        <entry>Zend_Date::MONTH_NAME_SHORT</entry>
                        <entry>MMM</entry>
                        <entry><emphasis role="strong">Feb</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>n</entry>
                        <entry>Month, one or two digit</entry>
                        <entry>Zend_Date::MONTH_SHORT</entry>
                        <entry>M</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>t</entry>
                        <entry>Number of days per month, one or two digits</entry>
                        <entry>Zend_Date::MONTH_DAYS</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">30</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>L</entry>
                        <entry>Leapyear, boolean</entry>
                        <entry>Zend_Date::LEAPYEAR</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">true</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>o</entry>
                        <entry>Year according to ISO 8601, at least four digit</entry>
                        <entry>Zend_Date::YEAR_8601</entry>
                        <entry>YYYY</entry>
                        <entry><emphasis role="strong">2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Y</entry>
                        <entry>Year, at least four digit</entry>
                        <entry>Zend_Date::YEAR</entry>
                        <entry>yyyy</entry>
                        <entry><emphasis role="strong">2009</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>y</entry>
                        <entry>Year, at least two digit</entry>
                        <entry>Zend_Date::YEAR_SHORT</entry>
                        <entry>yy</entry>
                        <entry><emphasis role="strong">09</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>a</entry>
                        <entry>Time of day, localized</entry>
                        <entry>Zend_Date::MERIDIEM</entry>
                        <entry>a (sort of, but likely to be uppercase)</entry>
                        <entry><emphasis role="strong">vorm.</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>A</entry>
                        <entry>Time of day, localized</entry>
                        <entry>Zend_Date::MERIDIEM</entry>
                        <entry>a (sort of, but no guarantee that the format is uppercase)</entry>
                        <entry><emphasis role="strong">VORM.</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>B</entry>
                        <entry>Swatch internet time</entry>
                        <entry>Zend_Date::SWATCH</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">1463</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>g</entry>
                        <entry>Hour, (1-12), one or two digit</entry>
                        <entry>Zend_Date::HOUR_SHORT_AM</entry>
                        <entry>h</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>G</entry>
                        <entry>Hour, (0-23), one or two digit</entry>
                        <entry>Zend_Date::HOUR_SHORT</entry>
                        <entry>H</entry>
                        <entry><emphasis role="strong">2</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>h</entry>
                        <entry>Hour, (01-12), two digit</entry>
                        <entry>Zend_Date::HOUR_AM</entry>
                        <entry>hh</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>H</entry>
                        <entry>Hour, (00-23), two digit</entry>
                        <entry>Zend_Date::HOUR</entry>
                        <entry>HH</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>i</entry>
                        <entry>Minute, (00-59), two digit</entry>
                        <entry>Zend_Date::MINUTE</entry>
                        <entry>mm</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>s</entry>
                        <entry>Second, (00-59), two digit</entry>
                        <entry>Zend_Date::SECOND</entry>
                        <entry>ss</entry>
                        <entry><emphasis role="strong">02</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>e</entry>
                        <entry>Time zone, localized, complete</entry>
                        <entry>Zend_Date::TIMEZONE_NAME</entry>
                        <entry>zzzz</entry>
                        <entry><emphasis role="strong">Europe/Paris</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>I</entry>
                        <entry>Daylight</entry>
                        <entry>Zend_Date::DAYLIGHT</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">1</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>O</entry>
                        <entry>Difference of time zone</entry>
                        <entry>Zend_Date::GMT_DIFF</entry>
                        <entry>Z or ZZ or ZZZ</entry>
                        <entry><emphasis role="strong">+0100</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>P</entry>
                        <entry>Difference of time zone, separated</entry>
                        <entry>Zend_Date::GMT_DIFF_SEP</entry>
                        <entry>ZZZZ</entry>
                        <entry><emphasis role="strong">+01:00</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>T</entry>
                        <entry>Time zone, localized, abbreviated</entry>
                        <entry>Zend_Date::TIMEZONE</entry>
                        <entry>z or zz or zzz</entry>
                        <entry><emphasis role="strong">CET</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>Z</entry>
                        <entry>Time zone offset in seconds</entry>
                        <entry>Zend_Date::TIMEZONE_SECS</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">3600</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>c</entry>
                        <entry>Standard Iso format output</entry>
                        <entry>Zend_Date::ISO_8601</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">2004-02-12T15:19:21+00:00</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>r</entry>
                        <entry>Standard Rfc 2822 format output</entry>
                        <entry>Zend_Date::RFC_2822</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">Thu, 21 Dec 2000 16:01:07 +0200</emphasis>
                        </entry>
                    </row>
                    <row>
                        <entry>U</entry>
                        <entry>Unix timestamp</entry>
                        <entry>Zend_Date::TIMESTAMP</entry>
                        <entry>no equivalent</entry>
                        <entry><emphasis role="strong">15275422364</emphasis>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect2>

</sect1>
<sect1 id="zend.date.creation">

    <title>Creation of dates</title>

    <para>
        <code>Zend_Date</code> provides several different ways to create a new instance of itself. As there are
        different needs the most convinient ways will be shown in this chapter.
    </para>

    <sect2 id="zend.date.creation.actual">

        <title>Create the actual date</title>

        <para>
            The simplest way of creating a date object is to create the actual date. You can eigther create a new
            instance with <emphasis role="strong">new Zend_Date()</emphasis> or use the convinient static method
            <emphasis role="strong">Zend_Date::now()</emphasis> which both will return the actual date as new
            instance of <code>Zend_Date</code>. The actual date always include the actual date and time for the
            actual set timezone.
        </para>

        <example id="zend.date.creation.actual.example-1">

            <title>Date creation by instance</title>

            <para>
                Date creation by creating a new instance means that you do not need to give an parameter. Of course
                there are several parameters which will be described later but normally this is the simplest and
                most used way to get the actual date as <code>Zend_Date</code> instance.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date();]]>
            </programlisting>

        </example>

        <example id="zend.date.creation.actual.example-2">

            <title>Static date creation</title>

            <para>
                Sometimes it is easier to use a static method for date creation. Therefor you can use the
                <emphasis role="strong"><code>now()</code></emphasis> method. It returns a new instance of
                <code>Zend_Date</code> the same way as if you would use <code>new Zend_Date()</code>. But it will
                always return the actual date and can not be changed by giving optional parameters.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = Zend_Date::now();]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.date.creation.database">

        <title>Create a date from database</title>

        <para>
            Databases are often used to store date values. But the problem is, that every database outputs it's
            date values in a different way. <code>MsSQL</code> databases use a quite different standard date
            output than <code>MySQL</code> databases. But for simplification <code>Zend_Date</code> makes it very
            easy to create a date from database date values.
        </para>

        <para>
            Of course each database can be said to convert the output of a defined column to a special value.
            For example you could convert a <code>datetime</code> value to output a minute value. But this is
            time expensive and often you are in need of handling dates in an other way than expected when creating
            the database query.
        </para>

        <para>
            So we have one quick and one convinient way of creating dates from database values.
        </para>

        <example id="zend.date.creation.database.example-1">

            <title>Quick creation of dates from database date values</title>

            <para>
                All databases are known to handle queries as fast as possible. They are built to act and respond
                quick. The quickest way for handling dates is to get unix timestamps from the database. All
                databases store date values internal as timestamp (not unix timestamp). This means that the time
                for creating a timestamp through a query is much smaller than converting it to a specified format.
            </para>

            <programlisting role="php"><![CDATA[<?php
// SELECT UNIX_TIMESTAMP(my_datetime_column) FROM my_table
require_once 'Zend/Date.php';

$date = new Zend_Date($unixtimestamp, Zend_Date::TIMESTAMP);]]>
            </programlisting>

        </example>

        <example id="zend.date.creation.database.example-2">

            <title>Convenient creation of dates from database date values</title>

            <para>
                The standard output of all databases is quite different even if it looks the same on the first
                eyecatch. But all are part of the <code>ISO</code> Standard and explained through it. So the
                easiest way of date creation is the usage of <code>Zend_Date::ISO_8601</code>. Databases which are
                known to be recognised by <code>Zend_Date::ISO_8601</code> are <code>MySQL</code>,
                <code>MsSQL</code> for example. But all databases are also able to return a <code>ISO 8601</code>
                representation of a date column. <code>ISO 8601</code> has the big advantage that it is human
                readable. The disadvantage is that <code>ISO 8601</code> needs more time for computation than a
                simple unix timestamp. But it should also be mentioned that unix timestamps are only supported
                for dates after 1 January 1970.
            </para>

            <programlisting role="php"><![CDATA[<?php
// SELECT datecolumn FROM my_table
require_once 'Zend/Date.php';

$date = new Zend_Date($datecolumn, Zend_Date::ISO_8601);]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.date.creation.array">

        <title>Create dates from an array</title>

        <para>
            Dates can also be created by the usage of an array. This is a simple and easy way. The used array
            keys are:
        </para>

        <para>
            <itemizedlist mark='opencircle'>
                <listitem>
                    <para>
                        <emphasis role="strong">day</emphasis>: day of the date as number
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">month</emphasis>: month of the date as number
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">year</emphasis>: full year of the date
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">hour</emphasis>: hour of the date
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">minute</emphasis>: minute of the date
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">second</emphasis>: second of the date
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <example id="zend.date.creation.array.example">

            <title>Date creation by array</title>

            <para>
                Normally you will give a complete date array for creation of a new date instance. But when you
                do not give all values, the not given array values are zeroed. This means that if f.e. no hour is
                given the hour <emphasis role="strong">0</emphasis> is used.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';
$datearray = array('year' => 2006, 'month' => 4, 'day' => 18, 'hour' => 12, 'minute' => 3, 'second' => 10);
$date = new Zend_Date($datearray);]]>
            </programlisting>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';
$datearray = array('year' => 2006, 'month' => 4, 'day' => 18);
$date = new Zend_Date($datearray);]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.date.introduction">

    <title>Introduction</title>

    <para>
        The <code>Zend_Date</code> component offers a detailed, but simple API for manipulating dates and times. Its
        methods accept a wide variety of types of information, including date parts, in numerous combinations yielding
        many features and possibilities above and beyond the existing PHP date related functions. For the very latest
        manual updates, please see
        <ulink url="http://framework.zend.com/wiki/display/ZFDOCDEV/Home">our online manual
        (frequently synced to Subversion)</ulink>
        .
    </para>

    <para>
        Although simplicity remains the goal, working with localized dates and times while modifying, combining, and
        comparing parts involves some unavoidable complexity. Dates, as well as times, are often written differently in
        different locales. For example, some place the month first, while other write the year first when expressing
        calendar dates. For more information about handling localization and normalization, please refer to
        <link linkend="zend.locale.date.datesandtimes"><code>Zend_Locale</code>
        </link>
        .
    </para>

    <para>
        <code>Zend_Date</code> also supports abbreviated names of months in many languages. <code>Zend_Locale</code>
        facilitates the normalization of localized month and weekday names to timestamps, which may, in turn, be shown
        localized to other regions.
    </para>

    <sect2 id="zend.date.setdefaulttimezone">

        <title>Always Set a Default Timezone</title>

        <para>
            Before using any date related functions in PHP or the Zend Framework, first make certain your application
            has a correct default timezone, by either setting the TZ environment variable, using the
            <code>date.timezone</code> php.ini setting, or using
            <ulink url="http://php.net/date_default_timezone_set">date_default_timezone_set()</ulink>
            . In PHP, we can adjust all date and time related functions to work for a particular user by setting a
            default timezone according to the user's expectations. For a complete list of timezone settings, see the
            <ulink url="http://unicode.org/cldr/data/diff/supplemental/territory_containment_un_m_49.html">CLDR Timezone Identifier List</ulink>
            .
            <example id="zend.date.setdefaulttimezone.example-1">
                <title>Setting a default timezone</title>
                <programlisting role="php"><![CDATA[<?php
date_default_timezone_set('America/Los_Angeles'); // timezone for an American in California
date_default_timezone_set('Europe/Berlin');       // timezone for a German in Germany]]>
                </programlisting>
            </example>
            <emphasis role="strong">When creating Zend_Date instances, their timezone will automatically become the
            current default timezone!</emphasis> Thus, the timezone setting will account for any Daylight Savings Time
            (DST) in effect, eliminating the need to explicitly specify DST.
        </para>

        <para>
            Keep in mind that the timezones <emphasis role="strong">UTC</emphasis> and
            <emphasis role="strong">GMT</emphasis> do not include Daylight Saving Time. This means that even
            if you define per hand that <code>Zend_Date</code> should work with DST, it would automatically
            be switched back for the instances of <code>Zend_Date</code> which have been set to UTC or GMT.
        </para>
    </sect2>

    <sect2 id="zend.date.why">

        <title>Why Use Zend_Date?</title>

        <para>
            <code>Zend_Date</code> offers the following features, which extend the scope of PHP date functions:
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    Simple API
                </para>
                <para>
                    <code>Zend_Date</code> offers a very simple API, which combines the best of date/time functionality
                    from four programming languages. It is possible, for example, to add or compare two times within a
                    single row.
                </para>
            </listitem>
            <listitem>
                <para>
                    Completely internationalized
                </para>
                <para>
                    All full and abbreviated names of months and weekdays are supported for more than 130 languages.
                    Methods support both input and the output of dates using the localized names of months and weekdays,
                    in the conventional format associated with each locale.
                </para>
            </listitem>
            <listitem>
                <para>
                    Unlimited timestamps
                </para>
                <para>
                    Although PHP 5.2 docs state, "The valid range of a timestamp is typically from Fri, 13 Dec 1901
                    20:45:54 GMT to Tue, 19 Jan 2038 03:14:07 GMT," <code>Zend_Date</code> supports a nearly unlimited
                    range, with the help of the BCMath extension. If BCMath is not available, then Zend_Date will have
                    reduced support only for timestamps within the range of the <code>float</code> type supported by
                    your server. "The size of a float is platform-dependent, although a maximum of ~1.8e308 with a
                    precision of roughly 14 decimal digits is a common value (that's 64 bit IEEE format)." [
                    <ulink url="http://www.php.net/float">http://www.php.net/float</ulink>
                    ].  Additionally, inherent limitations of float data types, and rounding error of float numbers
                    may introduce errors into calculations.  To avoid these problems, the ZF i18n components use
                    BCMath extension, if available.
                </para>
            </listitem>
            <listitem>
                <para>
                    Support for ISO_8601 date specifications
                </para>
                <para>
                    ISO_8601 date specifications are supported. Even partially compliant ISO_8601 date specifications
                    will be identified. These date formats are particularly useful when working with databases. For
                    example, even though MsSQL and
                    <ulink url="http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html">MySQL</ulink>
                    differ a little from each other, both are supported by <code>Zend_Date</code> using the
                    <link linkend="zend.date.constants.list">Zend_Date::ISO_8601</link>
                    format specification constant. When date strings conform to "Y/m/d" or "Y-m-d H:i:s", according to
                    PHP date() format tokens, use Zend_Date's built-in support for ISO 8601 formatted dates.
                </para>
            </listitem>
            <listitem>
                <para>
                    Calculate sunrise and sunset
                </para>
                <para>
                    For any place and day, the times for sunrise and sunset can be displayed, so that you won't miss a
                    single daylight second for working on your favorite PHP project :)
                </para>
            </listitem>
        </itemizedlist>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.date.overview">

    <title>Zend_Date API Overview</title>

    <para>
        While the <code>Zend_Date</code> API remains simplistic and unitary, its design remains flexible and powerful
        through the rich permutations of operations and operands.
    </para>

    <sect2 id="zend.date.options">

        <title>Zend_Date Options</title>

        <sect3 id="zend.date.options.formattype">

            <title>Selecting the date format type</title>

            <para>
                Several methods use date format strings, in a way similar to PHP's <code>date()</code>.
                If you are more comfortable with PHP's date format specifier than with ISO format specifiers,
                then you can use <code>Zend_Date::setOptions(array('format_type' => 'php'))</code>.
                Afterward, use PHP's date format specifiers for all functions which accept a <code>$format</code> parameter.
                Use <code>Zend_Date::setOptions(array('format_type' => 'iso'))</code> to switch back to the default mode of
                supporting only ISO date format tokens. For a list of supported format codes, see
                <xref linkend="zend.date.constants.phpformats" />
            </para>

        </sect3>

        <sect3 id="zend.date.options.fixdst">

            <title>DST and Date Math</title>

            <para>
                When dates are manipulated, sometimes they cross over a DST change, normally resulting in the date
                losing or gaining an hour.  For exmaple, when adding months to a date before a DST change, if the
                resulting date is after the DST change, then the resulting date will appear to lose or gain an hour,
                resulting in the time value of the date changing.  For boundary dates, such as midnight of the first
                or last day of a month, adding enough months to cross a date boundary results in the date losing
                an hour and becoming the last hour of the preceding month, giving the appearance of an "off by 1"
                error.  To avoid this situation, the DST change ignored by using the <code>fix_dst</code> option.
                When crossing the Summer/Winter DST boundary, normally an hour is substracted or added depending
                on the date.  For example, date math crossing the Spring DST leads to a date having a day value
                one less than expected, if the time part of the date was originally 00:00:00.  Since Zend_Date
                is based on timestamps, and not calendar dates with a time component, the timestamp loses an hour,
                resulting in the date having a calendar day value one less than expected.
                To prevent such problems use the option <code>fix_dst</code>, which defaults to true, causing DST
                to have no effect on date "math" (<code>addMOnth(), subMonth()</code>). Use
                <code>Zend_Date::setOptions(array('fix_dst' => false))</code> to enable the subtraction or addition
                of the DST adjustment when performing date "math".
            </para>

            <para>
                <emphasis role="strong">If your actual timezone within the instance of <code>Zend_Date</code>
                is set to UTC or GMT the option <code>'fix_dst'</code> will not be used</emphasis> because
                these two timezones do not work with DST. When you change the timezone for this instance
                again to a timezone which is not UTC or GMT the previous set 'fix_dst' option will be used
                again for date "math". 
            </para>
        </sect3>

        <sect3 id="zend.date.options.extendmonth">

            <title>Month Calculations</title>

            <para>
                When adding or substracting months from an existing date, the resulting value for the day of
                the month might be unexpected, if the original date fell on a day close to the end of the month.
                For example, when adding one month to January 31st, people familiar with SQL will expect February
                28th as the result. On the other side, people familiar with Excel and OpenOffice will expect
                March 3rd as the result. The problem only occurs, if the resulting month does not have the day,
                which is set in the original date.  For ZF developers, the desired behavior is selectable using
                the <code>extend_month</code> option to choose either the SQL behaviour, if set to false,
                or the spreadsheet behaviour when set to true. The default behaviour for <code>extend_month</code>
                is false, providing behavior compatible to SQL.  By default, <code>Zend_Date</code> computes month
                calculations by truncating dates to the end of the month (if necessary), without wrapping into the
                next month when the original date designates a day of the month exceeding the number of days in
                the resulting month.  Use <code>Zend_Date::setOptions(array('extend_month' => true));</code>
                to make month calculations work like popular spreadsheet programs.
            </para>

        </sect3>

        <sect3 id="zend.date.options.cache">

            <title>Speed up date localization and normalization with Zend_Cache</title>

            <para>
                You can speed up <code>Zend_Date</code> by using an <code>Zend_Cache</code> adapter.
                This speeds up all methods of <code>Zend_Date</code> when you are using localized data.
                For example all methods which accept <code>Zend_Date::DATE</code> and
                <code>Zend_Date::TIME</code> constants would benefit from this. To set an <code>Zend_Cache</code>
                adapter to <code>Zend_Date</code> just use
                <code>Zend_Date::setOptions(array('cache' => $adapter));</code>.
            </para>

        </sect3>

        <sect3 id="zend.date.options.timesync">

            <title>Receiving syncronised timestamps with Zend_TimeSync</title>

            <para>
                Normally the clocks from servers and computers differ from each other. <code>Zend_Date</code>
                is able to handle such problems with the help of <code>Zend_TimeSync</code>. You can set a
                timeserver with <code>Zend_Date::setOptions(array('timesync' => $timeserver));</code> which
                will set the offset between the own actual timestamp and the real actual timestamp for all
                instances of Zend_Date. Using this option does not change the timestamp of existing instances.
                So best usage is to set it within the bootstrap file.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.date.values">

        <title>Working with Date Values</title>

        <para>
            Once input has been normalized via the creation of a <code>Zend_Date</code> object, it will have an
            associated timezone, but an internal representation using standard
            <ulink url="http://en.wikipedia.org/wiki/Unix_Time">UNIX timestamps</ulink>
            . In order for a date to be rendered in a localized manner, a timezone must be known first. The default
            timezone is always GMT/UTC. To examine an object's timezone use <code>getTimeZone())</code>. To change an
            object's timezone, use <code>setTimeZone())</code>. All manipulations of these objects are assumed to be
            relative to this timezone.
        </para>

        <para>
            Beware of mixing and matching operations with date parts between date objects for different timezones, which
            generally produce undesireable results, unless the manipulations are only related to the timestamp.
            Operating on <code>Zend_Date</code> objects having different timezones generally works, except as just
            noted, since dates are normalized to UNIX timestamps on instantiation of <code>Zend_Date</code>.
        </para>

        <para>
            Most methods expect a constant selecting the desired <code>$part</code> of a date, such as
            <code>Zend_Date::HOUR</code>. These constants are valid for all of the functions below. A list of all
            available constants is provided in
            <xref linkend="zend.date.constants.list" />
            . If no <code>$part</code> is specified, then <code>Zend_Date::TIMESTAMP</code> is assumed. Alternatively, a
            user-specified format may be used for <code>$part</code>, using the same underlying mechanism and format
            codes as
            <link linkend="zend.locale.date.normalize"><code>Zend_Locale_Format::getDate()</code>
            </link>
            . If a date object is constructed using an obviously invalid date (e.g. a month number greater than 12),
            then <code>Zend_Date</code> will throw an exception, unless no specific date format has been selected -i.e.
            <code>$part</code> is either <code>null</code> or <code>Zend_Date::DATES</code> (a "loose" format).
        </para>

        <example id="zend.date.values.example-1">
            <title>User-specified input date format</title>
            <programlisting role="php"><![CDATA[<?php
$date1 = new Zend_Date('Feb 31, 2007', null, 'en_US');
echo $date1, "\n"; // outputs "Mar 3, 2007 12:00:00 AM"

$date2 = new Zend_Date('Feb 31, 2007', Zend_Date::DATES, 'en_US');
echo $date2, "\n"; // outputs "Mar 3, 2007 12:00:00 AM"

$date3 = new Zend_Date('Feb 31, 2007', 'MM.dd.yyyy'); // strictly restricts interpretation to specified format
echo $date3, "\n"; // outputs "Mar 3, 2007 12:00:00 AM"]]>
            </programlisting>
        </example>

        <para>
            If the optional <code>$locale</code> parameter is provided, then the <code>$locale</code> disambiguates the
            <code>$date</code> operand by replacing month and weekday names for string <code>$date</code> operands, and
            even parsing date strings expressed according to the conventions of that locale (see <code>
            <link linkend="zend.locale.date.normalize">Zend_Locale_Format::getDate()</link>
            </code> ). The automatic normalization of localized <code>$date</code> operands of a string type occurs when
            <code>$part</code> is one of the <code>Zend_Date::DATE*</code> or <code>Zend_Date::TIME*</code> constants.
            The locale identifies which language should be used to parse month names and weekday names, if the
            <code>$date</code> is a string containing a date. If there is no <code>$date</code> input parameter, then
            the <code>$locale</code> parameter specifies the locale to use for localizing output (e.g. the date format
            for a string representation). Note that the <code>$date</code> input parameter might actually have a type
            name instead (e.g. <code>$hour</code> for <code>addHour()</code>), although that does not prevent the use of
            <code>Zend_Date</code> objects as arguments for that parameter. If no <code>$locale</code> was specified,
            then the locale of the current object is used to interpret <code>$date</code>, or select the localized
            format for output.
        </para>

    </sect2>

    <sect2 id="id.date.basic">

        <title>Basic <code>Zend_Date</code> Operations Common to Many Date Parts</title>

        <para>
            The methods <code>add(), sub(), compare(), get(), and set()</code> operate generically on dates. In each
            case, the operation is performed on the date held in the instance object. The <code>$date</code> operand is
            required for all of these methods, except <code>get()</code>, and may be a <code>Zend_Date</code> instance
            object, a numeric string, or an integer. These methods assume <code>$date</code> is a timestamp, if it is
            not an object. However, the <code>$part</code> operand controls which logical part of the two dates are
            operated on, allowing operations on parts of the object's date, such as year or minute, even when
            <code>$date</code> contains a long form date string, such as, "December 31, 2007 23:59:59". The result of
            the operation changes the date in the object, except for <code>compare()</code>, and <code>get()</code>.
        </para>

        <example id="zend.date.basic.example-1">
            <title>Operating on Parts of Dates</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';

$date = new Zend_Date(); // $date's timestamp === time()

// changes $date by adding 12 hours
$date->add('12', Zend_Date::HOUR);
print $date;]]>
            </programlisting>
        </example>

        <para>
            Convenience methods exist for each combination of the basic operations and several common date parts as
            shown in the tables below. These convenience methods help us lazy programmers avoid having to type out the
            <link linkend="zend.date.constants.list">date part constants</link>
            when using the general methods above. Conveniently, they are named by combining a prefix (name of a basic
            operation) with a suffix (type of date part), such as <code>addYear()</code>. In the list below, all
            combinations of "Date Parts" and "Basic Operations" exist. For example, the operation "add" exists for each
            of these date parts, including <code>addDay()</code>, <code>addYear()</code>, etc.
        </para>

        <para>
            These convenience methods have the same equivalent functionality as the basic operation methods, but expect
            string and integer <code>$date</code> operands containing only the values representing the type indicated by
            the suffix of the convenience method. Thus, the names of these methods (e.g. "Year" or "Minute") identify
            the units of the <code>$date</code> operand, when <code>$date</code> is a string or integer.
        </para>

        <sect3 id="id.date.basic.parts">

            <title>List of Date Parts</title>

            <table id="id.date.basic.parts.table">
                <title>Date Parts</title>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Date Part</entry>
                            <entry>Explanation</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Unix_Time">Timestamp</ulink>
                            </entry>
                            <entry>
                            UNIX timestamp, expressed in seconds elapsed since January 1st, 1970 00:00:00 GMT/UTC.
                        </entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Gregorian_calendar">Year</ulink>
                            </entry>
                            <entry>Gregorian calendar year (e.g. 2006)</entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Month#Julian_and_Gregorian_calendars">Month</ulink>
                            </entry>
                            <entry>Gregorian calendar month (1-12, localized names supported)</entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/24-hour_clock">24 hour clock</ulink>
                            </entry>
                            <entry>Hours of the day (0-23) denote the hours elapsed, since the start of the day.</entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Minute">minute</ulink>
                            </entry>
                            <entry>Minutes of the hour (0-59) denote minutes elapsed, since the start of the hour.</entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Second">Second</ulink>
                            </entry>
                            <entry>Seconds of the minute (0-59) denote the elapsed seconds, since the start of the minute.</entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Millisecond">millisecond</ulink>
                            </entry>
                            <entry>Milliseconds denote thousandths of a second (0-999). <code>Zend_Date</code> supports two additional methods for working with time units smaller than seconds. By default, <code>Zend_Date</code> instances use a precision defaulting to milliseconds, as seen using <code>getFractionalPrecision()</code>. To change the precision use <code>setFractionalPrecision($precision)</code>.  However, precision is limited practically to microseconds, since <code>Zend_Date</code> uses <code>
                                <ulink url="http://php.net/microtime">microtime()</ulink></code>.</entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Day">Day</ulink>
                            </entry>
                            <entry><code>Zend_Date::DAY_SHORT</code> is extracted from <code>$date</code> if the <code>$date</code> operand is an instance of <code>Zend_Date</code> or a numeric string.  Otherwise, an attempt is made to extract the day according to the conventions documented for these constants: <code>Zend_Date::WEEKDAY_NARROW</code>, <code>Zend_Date::WEEKDAY_NAME</code>, <code>Zend_Date::WEEKDAY_SHORT</code>, <code>Zend_Date::WEEKDAY</code> (Gregorian calendar assumed)</entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/Week">Week</ulink>
                            </entry>
                            <entry><code>Zend_Date::WEEK</code> is extracted from <code>$date</code> if the <code>$date</code> operand is an instance of <code>Zend_Date</code> or a numeric string. Otherwise an exception is raised. (Gregorian calendar assumed)</entry>
                        </row>
                        <row>
                            <entry>Date</entry>
                            <entry><code>Zend_Date::DAY_MEDIUM</code> is extracted from <code>$date</code> if the <code>$date</code> operand is an instance of <code>Zend_Date</code>.  Otherwise, an attempt is made to normalize the <code>$date</code> string into a Zend_Date::DATE_MEDIUM formatted date. The format of <code>Zend_Date::DAY_MEDIUM</code> depends on the object's locale.</entry>
                        </row>
                        <row>
                            <entry>Weekday</entry>
                            <entry>Weekdays are represented numerically as 0 (for Sunday) through 6 (for Saturday).  <code>Zend_Date::WEEKDAY_DIGIT</code> is extracted from <code>$date</code>, if the <code>$date</code> operand is an instance of <code>Zend_Date</code> or a numeric string.  Otherwise, an attempt is made to extract the day according to the conventions documented for these constants: <code>Zend_Date::WEEKDAY_NARROW</code>, <code>Zend_Date::WEEKDAY_NAME</code>, <code>Zend_Date::WEEKDAY_SHORT</code>, <code>Zend_Date::WEEKDAY</code> (Gregorian calendar assumed)</entry>
                        </row>
                        <row>
                            <entry>DayOfYear</entry>
                            <entry>In <code>Zend_Date</code>, the day of the year represents the number of calendar days elapsed since the start of the year (0-365).  As with other units above, fractions are rounded down to the nearest whole number. (Gregorian calendar assumed)
                        </entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://www.faqs.org/rfcs/rfc822.html">Arpa</ulink>
                            </entry>
                            <entry>Arpa dates (i.e. RFC 822 formatted dates) are supported. Output uses either a "GMT" or "Local differential hours+min" format (see section 5 of RFC 822).  Before PHP 5.2.2, using the DATE_RFC822 constant with PHP date functions sometimes produces <ulink url="http://bugs.php.net/bug.php?id=40308">incorrect results</ulink>.  Zend_Date's results are correct.  Example: <code>Mon, 31 Dec 06 23:59:59 GMT</code>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <ulink url="http://en.wikipedia.org/wiki/ISO_8601">Iso</ulink>
                            </entry>
                            <entry>Only complete ISO 8601 dates are supported for output. Example: <code>2009-02-14T00:31:30+01:00</code>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>

        </sect3>

        <sect3 id="id.date.basic.operations">

            <title>List of Date Operations</title>

            <para>
                The basic operations below can be used instead of the convenience operations for specific date parts, if
                the
                <link linkend="zend.date.constants.list">appropriate constant</link>
                is used for the <code>$part</code> parameter.
            </para>

            <table id="id.date.basic.operations.table">
                <title>Basic Operations</title>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Basic Operation</entry>
                            <entry>Explanation</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>get()</entry>
                            <entry>
                                <para>
                                    <emphasis role="strong">get($part = null, $locale = null)</emphasis>
                                </para>
                                <para>
                                    Use <code>get($part)</code> to retrieve the date <code>$part</code> of this object's
                                    date localized to <code>$locale</code> as a formatted string or integer. When using
                                    the BCMath extension, numeric strings might be returned instead of integers for
                                    large values. <emphasis role="strong">NOTE:</emphasis> Unlike <code>get()</code>,
                                    the other get*() convenience methods only return instances of <code>Zend_Date</code>
                                    containing a date representing the selected or computed date/time.
                                </para>
                            </entry>
                        </row>
                        <row>
                            <entry>set()</entry>
                            <entry>
                                <para>
                                    <emphasis role="strong">set($date, $part = null, $locale = null)</emphasis>
                                </para>
                                <para>
                                    Sets the <code>$part</code> of the current object to the corresponding value for
                                    that part found in the input <code>$date</code> having a locale
                                    <code>$locale</code>.
                                </para>
                            </entry>
                        </row>
                        <row>
                            <entry>add()</entry>
                            <entry>
                                <para>
                                    <emphasis role="strong">add($date, $part = null, $locale = null)</emphasis>
                                </para>
                                <para>
                                    Adds the <code>$part</code> of <code>$date</code> having a locale
                                    <code>$locale</code> to the current object's date.
                                </para>
                            </entry>
                        </row>
                        <row>
                            <entry>sub()</entry>
                            <entry>
                                <para>
                                    <emphasis role="strong">sub($date, $part = null, $locale = null)</emphasis>
                                </para>
                                <para>
                                    Subtracts the <code>$part</code> of <code>$date</code> having a locale
                                    <code>$locale</code> from the current object's date.
                                </para>
                            </entry>
                        </row>
                        <row>
                            <entry>copyPart()</entry>
                            <entry>
                                <para>
                                    <emphasis role="strong">copyPart($part, $locale = null)</emphasis>
                                </para>
                                <para>
                                    Returns a cloned object, with only <code>$part</code> of the object's date copied to
                                    the clone, with the clone have its locale arbitrarily set to <code>$locale</code>
                                    (if specified).
                                </para>
                            </entry>
                        </row>
                        <row>
                            <entry>compare()</entry>
                            <entry>
                                <para>
                                    <emphasis role="strong">compare($date, $part = null, $locale = null)</emphasis>
                                </para>
                                <para>
                                    compares <code>$part</code> of <code>$date</code> to this object's timestamp,
                                    returning 0 if they are equal, 1 if this object's part was more recent than $date's
                                    part, otherwise -1.
                                </para>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>

        </sect3>

    </sect2>

    <sect2 id="zend.date.others.comparison">

        <title>Comparing Dates</title>

        <para>
            The following basic operations do not have corresponding convenience methods for the date parts listed in
            <xref linkend="zend.date.overview" />
            .
        </para>

        <table id="zend.date.others.comparison.table">
            <title>Date Comparison Methods</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Method</entry>
                        <entry>Explanation</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>equals()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">equals($date, $part = null, $locale = null)</emphasis>
                            </para>
                            <para>
                                returns true, if <code>$part</code> of <code>$date</code> having locale
                                <code>$locale</code> is the same as this object's date <code>$part</code>, otherwise
                                false
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>isEarlier()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">isEarlier($date, $part = null, $locale = null)</emphasis>
                            </para>
                            <para>
                                returns true, if <code>$part</code> of this object's date is earlier than
                                <code>$part</code> of <code>$date</code> having a locale <code>$locale</code>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>isLater()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">isLater($date, $part = null, $locale = null)</emphasis>
                            </para>
                            <para>
                                returns true, if <code>$part</code> of this object's date is later than
                                <code>$part</code> of <code>$date</code> having a locale <code>$locale</code>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>isToday()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">isToday()</emphasis>
                            </para>
                            <para>
                                Tests if today's year, month, and day match this object's date value, using this
                                object's timezone.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>isTomorrow()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">isTomorrow()</emphasis>
                            </para>
                            <para>
                                Tests if tomorrow's year, month, and day match this object's date value, using this
                                object's timezone.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>isYesterday()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">isYesterday()</emphasis>
                            </para>
                            <para>
                                Tests if yesterday's year, month, and day match this object's date value, using this
                                object's timezone.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>isLeapYear()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">isLeapYear()</emphasis>
                            </para>
                            <para>
                                Use <code>isLeapYear()</code> to determine if the current object is a leap year, or use
                                Zend_Date::checkLeapYear($year) to check $year, which can be a string, integer, or
                                instance of <code>Zend_Date</code>. Is the year a leap year?
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>isDate()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">isDate($date, $format = null, $locale = null)</emphasis>
                            </para>
                            <para>
                                This method checks if a given date is a real date and returns true if all checks are ok.
                                It works like php's checkdate() function but can also check for localized month names and
                                for dates extending the range of checkdate()
                                false
                            </para>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect2>

    <sect2 id="zend.date.others.gettingparts">

        <title>Getting Dates and Date Parts</title>

        <para>
            Several methods support retrieving values related to a <code>Zend_Date</code> instance.
        </para>

        <table id="zend.date.others.gettingparts.table">
            <title>Date Output Methods</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Method</entry>
                        <entry>Explanation</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>toString()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">toString($format = null, $locale = null)</emphasis>
                            </para>
                            <para>
                                Invoke directly or via the magic method <code>__toString()</code>. The
                                <code>toString()</code> method automatically formats the date object's value according
                                to the conventions of the object's locale, or an optionally specified
                                <code>$locale</code>. For a list of supported format codes, see
                                <xref linkend="zend.date.constants.selfdefinedformats" />
                                .
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>toArray()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">toArray()</emphasis>
                            </para>
                            <para>
                                Returns an array representation of the selected date according to
                                the conventions of the object's locale. The returned array is equivalent to
                                PHP's <ulink url="http://php.net/getdate">getdate()</ulink> function and includes:
                            </para>
                            <para>
                                <itemizedlist>
                                    <listitem>
                                        <para>
                                            Number of day as '<emphasis role="strong">day</emphasis>'
                                            (<code>Zend_Date::DAY_SHORT</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Number of month as '<emphasis role="strong">month</emphasis>'
                                            (<code>Zend_Date::MONTH_SHORT</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Year as '<emphasis role="strong">year</emphasis>'
                                            (<code>Zend_Date::YEAR</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Hour as '<emphasis role="strong">hour</emphasis>'
                                            (<code>Zend_Date::HOUR_SHORT</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Minute as '<emphasis role="strong">minute</emphasis>'
                                            (<code>Zend_Date::MINUTE_SHORT</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Second as '<emphasis role="strong">second</emphasis>'
                                            (<code>Zend_Date::SECOND_SHORT</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Abbreviated timezone as '<emphasis role="strong">timezone</emphasis>'
                                            (<code>Zend_Date::TIMEZONE</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Unix timestamp as '<emphasis role="strong">timestamp</emphasis>'
                                            (<code>Zend_Date::TIMESTAMP</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Number of weekday as '<emphasis role="strong">weekday</emphasis>'
                                            (<code>Zend_Date::WEEKDAY_DIGIT</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Day of year as '<emphasis role="strong">dayofyear</emphasis>'
                                            (<code>Zend_Date::DAY_OF_YEAR</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Week as '<emphasis role="strong">week</emphasis>'
                                            (<code>Zend_Date::WEEK</code>)
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>
                                            Delay of timezone to GMT as
                                            '<emphasis role="strong">gmtsecs</emphasis>'
                                            (<code>Zend_Date::GMT_SECS</code>)
                                        </para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>toValue()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">toValue($part = null)</emphasis>
                            </para>
                            <para>
                                Returns an integer representation of the selected date <code>$part</code> according to
                                the conventions of the object's locale. Returns <code>false</code> when
                                <code>$part</code> selects a non-numeric value, such as
                                <code>Zend_Date::MONTH_NAME_SHORT</code>. <emphasis role="strong">NOTE:</emphasis> This
                                method calls
                                <link linkend="id.date.basic.operations"><code>get()</code>
                                </link>
                                and casts the result to a PHP integer, which will give unpredictable results, if
                                <code>get()</code> returns a numeric string containing a number too large for a PHP
                                integer on your system. Use <code>get()</code> instead.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <link linkend="id.date.basic.operations">get()</link>
                        </entry>
                        <entry>
                            <para>
                                <emphasis role="strong">get($part = null, $locale = null)</emphasis>
                            </para>
                            <para>
                                This method returns the <code>$part</code> of object's date localized to
                                <code>$locale</code> as a formatted string or integer. See
                                <xref linkend="id.date.basic.operations" />
                                for more information.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>now()</entry>
                        <entry>
                            <para>
                                <emphasis role="strong">now($locale = null)</emphasis>
                            </para>
                            <para>
                                This convenience function is equivalent to <code>new Zend_Date()</code>. It returns the
                                current date as a <code>Zend_Date</code> object, having <code>$locale</code>
                            </para>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect2>

    <sect2 id="zend.date.others.fractions">

        <title>Working with Fractions of Seconds</title>

        <para>
            Several methods support retrieving values related to a <code>Zend_Date</code> instance.
        </para>

        <table id="zend.date.others.fractions.table">
            <title>Date Output Methods</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Method</entry>
                        <entry>Explanation</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>
                            <para>
                                <emphasis role="strong">getFractionalPrecision()</emphasis>
                            </para>
                        </entry>
                        <entry>Return the precision of the part seconds</entry>
                    </row>
                    <row>
                        <entry>
                            <para>
                                <emphasis role="strong">setFractionalPrecision()</emphasis>
                            </para>
                        </entry>
                        <entry>Set the precision of the part seconds</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect2>

    <sect2 id="zend.date.other.sun">

        <title>Sunrise / Sunset</title>

        <para>
            Three methods provide access to geographically localized information about the Sun, including the time of
            sunrise and sunset.
        </para>

        <table id="zend.date.other.sun.table">
            <title>Miscellaneous Methods</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Method</entry>
                        <entry>Explanation</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>
                            <para>
                                <emphasis role="strong">getSunrise($location)</emphasis>
                            </para>
                        </entry>
                        <entry>Return the date's time of sunrise</entry>
                    </row>
                    <row>
                        <entry>
                            <para>
                                <emphasis role="strong">getSunset($location)</emphasis>
                            </para>
                        </entry>
                        <entry>Return the date's time of sunset</entry>
                    </row>
                    <row>
                        <entry>
                            <para>
                                <emphasis role="strong">getSunInfo($location)</emphasis>
                            </para>
                        </entry>
                        <entry>Return an array with the date's sun dates</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.date.definition.theory">

    <title>Theory of Operation</title>

    <para>
        Why is there only one class <code>Zend_Date</code> for handling dates and times in the Zend Framework?
    </para>

    <para>
        Many languages split the handling of times and calendar dates into two classes. However, the Zend Framework
        strives for extreme simplicity, and forcing the developer to manage different objects with different methods for
        times and dates becomes a burden in many situations. Since <code>Zend_Date</code> methods support working with
        ambiguous dates that might not include all parts (era, year, month, day, hour, minute, second, timezone),
        developers enjoy the flexibility and ease of using the same class and the same methods to perform the same
        manipulations (e.g. addition, subtraction, comparision, merging of date parts, etc.). Splitting the handling of
        these date fragments into multiple classes would create complications when smooth interoperation is desired with
        a small learning curve. A single class reduces code duplication for similar operations, without the need for a
        complex inheritance hierarchy.
    </para>

    <sect2 id="zend.date.theory.internals">

        <title>Internals</title>

        <para>
            <itemizedlist mark='opencircle'>
                <listitem>
                    <para>
                        UNIX Timestamp
                    </para>
                    <para>
                        All dates and times, even ambiguous ones (e.g. no year), are represented internally as absolute
                        moments in time, represented as a UNIX timestamp expressing the difference between the desired
                        time and January 1st, 1970 00:00:00 GMT/UTC. This was only possible, because
                        <code>Zend_Date</code> is not limited to UNIX timestamps nor integer values. The BCMath
                        extension is required to support extremely large dates outside of the range Fri, 13 Dec 1901
                        20:45:54 GMT to Tue, 19 Jan 2038 03:14:07 GMT.  Additional, tiny math errors may arise due to
                        the inherent limitations of float data types and rounding, unless using the BCMath extension.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Date parts as timestamp offsets
                    </para>
                    <para>
                        Thus, an instance object representing three hours would be expressed as three hours after
                        January 1st, 1970 00:00:00 GMT/UTC -i.e. 0 + 3 * 60 * 60 = 10800.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        PHP functions
                    </para>
                    <para>
                        Where possible, <code>Zend_Date</code> usually uses PHP functions to improve performance.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

</sect1>
<!--vim:se ts=4 sw=4 et:-->
<sect1 id="zend.db.adapter">

    <title>Zend_Db_Adapter</title>

    <para>
        Zend_Db and its related classes provide a simple SQL database interface
        for Zend Framework.  The Zend_Db_Adapter is the basic class you use to
        connect your PHP application to an RDBMS.  There is a different Adapter
        class for each brand of RDBMS.
    </para>

    <para>
        The Zend_Db Adapters create a bridge from the vendor-specific PHP
        extensions to a common interface, to help you write PHP applications
        once and deploy with multiple brands of RDBMS with very little effort.
    </para>

    <para>
        The interface of the Adapter class is similar to the interface of the
        <ulink url="http://www.php.net/pdo">PHP Data Objects</ulink> extension.
        Zend_Db provides Adapter classes to PDO drivers for the following RDBMS
        brands:
    </para>

    <itemizedlist>
        <listitem>
            <para>
                IBM DB2 and Informix Dynamic Server (IDS), using the
                <ulink url="http://www.php.net/pdo-ibm">pdo_ibm</ulink> PHP extension
            </para>
        </listitem>
        <listitem>
            <para>
                MySQL, using the <ulink url="http://www.php.net/pdo-mysql">pdo_mysql</ulink> PHP extension
            </para>
        </listitem>
        <listitem>
            <para>
                Microsoft SQL Server, using the <ulink url="http://www.php.net/pdo-mssql">pdo_mssql</ulink> PHP
                extension
            </para>
        </listitem>
        <listitem>
            <para>
                Oracle, using the <ulink url="http://www.php.net/pdo-oci">pdo_oci</ulink> PHP extension
            </para>
        </listitem>
        <listitem>
            <para>
                PostgreSQL, using the <ulink url="http://www.php.net/pdo-pgsql">pdo_pgsql</ulink> PHP extension
            </para>
        </listitem>
        <listitem>
            <para>
                SQLite, using the <ulink url="http://www.php.net/pdo-sqlite">pdo_sqlite</ulink> PHP extension
            </para>
        </listitem>

    </itemizedlist>

    <para>
        In addition, Zend_Db provides Adapter classes that utilize PHP database
        extensions for the following RDBMS brands:
    </para>

    <itemizedlist>
        <listitem>
            <para>
                MySQL, using the <ulink url="http://www.php.net/mysqli">mysqli</ulink> PHP extension
            </para>
        </listitem>
        <listitem>
            <para>
                Oracle, using the <ulink url="http://www.php.net/oci8">oci8</ulink> PHP extension
            </para>
        </listitem>
        <listitem>
            <para>
                IBM DB2, using the <ulink url="http://www.php.net/ibm_db2">ibm_db2</ulink> PHP extension
            </para>
        </listitem>
        <listitem>
            <para>
                Firebird/Interbase, using the <ulink url="http://www.php.net/ibase">php_interbase</ulink> PHP extension
            </para>
        </listitem>
    </itemizedlist>

    <note>
        <para>
            Each Zend_Db Adapter uses a PHP extension.  You must have the
            respective PHP extension enabled in your PHP environment to use a
            Zend_Db Adapter.  For example, if you use any of the PDO Zend_Db
            Adapters, you need to enable both the PDO extension and the
            PDO driver for the brand of RDBMS you use.
        </para>
    </note>

    <sect2 id="zend.db.adapter.connecting">

        <title>Connecting to a Database using an Adapter</title>

        <para>
            This section describes how to create an instance of a database Adapter.
            This corresponds to making a connection to your RDBMS server from your
            PHP application.
        </para>

        <sect3 id="zend.db.adapter.connecting.constructor">

            <title>Using a Zend_Db Adapter Constructor</title>

            <para>
                You can create an instance of an Adapter using its constructor.
                An Adapter constructor takes one argument, which is an array
                of parameters used to declare the connection.
            </para>

            <example id="zend.db.adapter.connecting.constructor.example">
                <title>Using an Adapter constructor</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Db/Adapter/Pdo/Mysql.php';

$db = new Zend_Db_Adapter_Pdo_Mysql(array(
    'host'     => '127.0.0.1',
    'username' => 'webuser',
    'password' => 'xxxxxxxx',
    'dbname'   => 'test'
));]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.connecting.factory">

            <title>Using the Zend_Db Factory</title>

            <para>
                As an alternative to using an Adapter constructor directly, you
                can create an instance of an Adapter using the static method
                <code>Zend_Db::factory()</code>.  This method dynamically loads
                the Adapter class file on demand, using
                <link linkend="zend.loader.load.class">Zend_Loader::loadClass()</link>.
            </para>

            <para>
                The first argument is a string that names the base name of the
                Adapter class.  For example the string 'Pdo_Mysql' corresponds
                to the class Zend_Db_Adapter_Pdo_Mysql.  The second argument is
                the same array of parameters you would have given to the
                Adapter constructor.
            </para>

            <example id="zend.db.adapter.connecting.factory.example">
                <title>Using the Adapter factory method</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Db.php';

// Automatically load class Zend_Db_Adapter_Pdo_Mysql and create an instance of it.
$db = Zend_Db::factory('Pdo_Mysql', array(
    'host'     => '127.0.0.1',
    'username' => 'webuser',
    'password' => 'xxxxxxxx',
    'dbname'   => 'test'
));]]>
                </programlisting>
            </example>

            <para>
                If you create your own class that extends
                Zend_Db_Adapter_Abstract, but you do not name your class with
                the "Zend_Db_Adapter" package prefix, you can use the
                <code>factory()</code> method to load your Adapter if you
                specify the leading portion of the adapter class with the
                'adapterNamespace' key in the parameters array.
            </para>

            <example id="zend.db.adapter.connecting.factory.example2">
                <title>Using the Adapter factory method for a custom adapter class</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Db.php';

// Automatically load class MyProject_Db_Adapter_Pdo_Mysql and create an instance of it.
$db = Zend_Db::factory('Pdo_Mysql', array(
    'host'             => '127.0.0.1',
    'username'         => 'webuser',
    'password'         => 'xxxxxxxx',
    'dbname'           => 'test',
    'adapterNamespace' => 'MyProject_Db_Adapter'
));]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.connecting.factory-config">

            <title>Using Zend_Config with the Zend_Db Factory</title>

            <para>
                Optionally, you may specify either argument of the
                <code>factory()</code> method as an object of type
                <link linkend="zend.config">Zend_Config</link>.
            </para>

            <para>
                If the first argument is a config object, it is expected to
                contain a property named <code>adapter</code>, containing the
                string naming the adapter class name base.  Optionally, the object
                may contain a property named <code>params</code>, with
                subproperties corresponding to adapter parameter names.
                This is used only if the second argument of the
                <code>factory()</code> method is absent.
            </para>

            <example id="zend.db.adapter.connecting.factory.example1">
                <title>Using the Adapter factory method with a Zend_Config object</title>
                <para>
                    In the example below, a Zend_Config object is created from
                    an array.  You can also load data from an external file,
                    for example with
                    <link linkend="zend.config.adapters.ini">Zend_Config_Ini</link>
                    or <link linkend="zend.config.adapters.xml">Zend_Config_Xml</link>.
                </para>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Config.php';
require_once 'Zend/Db.php';

$config = new Zend_Config(
    array(
        'database' => array(
            'adapter' => 'Mysqli',
            'params' => array(
                'dbname' => 'test',
                'username' => 'webuser',
                'password' => 'secret',
            )
        )
    )
);

$db = Zend_Db::factory($config->database);]]>
                </programlisting>
            </example>

            <para>
                The second argument of the <code>factory()</code> method may be
                an associative array containing entries corresponding to
                adapter parameters.  This argument is optional.  If the first
                argument is of type Zend_Config, it is assumed to contain all
                parameters, and the second argument is ignored.
            </para>

        </sect3>

        <sect3 id="zend.db.adapter.connecting.parameters">

            <title>Adapter Parameters</title>

            <para>
                The list below explains common parameters recognized by Zend_Db Adapter classes.
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <emphasis role="strong">host</emphasis>:
                        a string containing a hostname or IP address of the
                        database server.  If the database is running on the
                        same host as the PHP application, you may use
                        'localhost' or '127.0.0.1'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">username</emphasis>:
                        account identifier for authenticating a connection to the
                        RDBMS server.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">password</emphasis>:
                        account password credential for authenticating a
                        connection to the RDBMS server.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">dbname</emphasis>:
                        database instance name on the RDBMS server.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">port</emphasis>:
                        some RDBMS servers can accept network connections on a
                        administrator-specified port number.  The port
                        parameter allow you to specify the port to which your
                        PHP application connects, to match the port configured
                        on the RDBMS server.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">options</emphasis>:
                        this parameter is an associative array of options
                        that are generic to all Zend_Db_Adapter classes.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">driver_options</emphasis>:
                        this parameter is an associative array of additional
                        options that are specific to a given database
                        extension.  One typical use of this parameter is to
                        set attributes of a PDO driver.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">adapterNamespace</emphasis>:
                        names the initial part of the class name for the
                        adapter, instead of 'Zend_Db_Adapter'.  Use this if
                        you need to use the <code>factory()</code> method to
                        load a non-Zend database adapter class.
                    </para>
                </listitem>
            </itemizedlist>

            <example id="zend.db.adapter.connecting.parameters.example1">
                <title>Passing the case-folding option to the factory</title>
                <para>
                    You can specify this option by the constant
                    <code>Zend_Db::CASE_FOLDING</code>.
                    This corresponds to the <code>ATTR_CASE</code> attribute in
                    PDO and IBM DB2 database drivers, adjusting the case of
                    string keys in query result sets.  The option takes values
                    <code>Zend_Db::CASE_NATURAL</code> (the default),
                    <code>Zend_Db::CASE_UPPER</code>, and
                    <code>Zend_Db::CASE_LOWER</code>.
                </para>
                <programlisting role="php"><![CDATA[<?php
$options = array(
    Zend_Db::CASE_FOLDING => Zend_Db::CASE_UPPER
);

$params = array(
    'host'           => '127.0.0.1',
    'username'       => 'webuser',
    'password'       => 'xxxxxxxx',
    'dbname'         => 'test',
    'options'        => $options
);

$db = Zend_Db::factory('Db2', $params);]]>
                </programlisting>
            </example>

            <example id="zend.db.adapter.connecting.parameters.example2">
                <title>Passing the auto-quoting option to the factory</title>
                <para>
                    You can specify this option by the constant
                    <code>Zend_Db::AUTO_QUOTE_IDENTIFIERS</code>.  If the value
                    is <code>true</code> (the default), identifiers like table
                    names, column names, and even aliases are delimited in all
                    SQL syntax generated by the Adapter object.  This makes it
                    simple to use identifiers that contain SQL keywords, or
                    special characters.  If the value is <code>false</code>,
                    identifiers are not delimited automatically.  If you need
                    to delimit identifiers, you must do so yourself using the
                    <code>quoteIdentifier()</code> method.
                </para>
                <programlisting role="php"><![CDATA[<?php
$options = array(
    Zend_Db::AUTO_QUOTE_IDENTIFIERS => false
);

$params = array(
    'host'           => '127.0.0.1',
    'username'       => 'webuser',
    'password'       => 'xxxxxxxx',
    'dbname'         => 'test',
    'options'        => $options
);

$db = Zend_Db::factory('Pdo_Mysql', $params);]]>
                </programlisting>
            </example>

            <example id="zend.db.adapter.connecting.parameters.example3">
                <title>Passing PDO driver options to the factory</title>
                <programlisting role="php"><![CDATA[<?php
$pdoParams = array(
    PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true
);

$params = array(
    'host'           => '127.0.0.1',
    'username'       => 'webuser',
    'password'       => 'xxxxxxxx',
    'dbname'         => 'test',
    'driver_options' => $pdoParams
);

$db = Zend_Db::factory('Pdo_Mysql', $params);

echo $db->getConnection()->getAttribute(PDO::MYSQL_ATTR_USE_BUFFERED_QUERY);]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.connecting.getconnection">
            <title>Managing Lazy Connections</title>

            <para>
                Creating an instance of an Adapter class does not immediately
                connect to the RDBMS server.  The Adapter saves the connection
                parameters, and makes the actual connection on demand, the
                first time you need to execute a query.  This ensures that
                creating an Adapter object is quick and inexpensive.  You can
                create an instance of an Adapter even if you are not certain
                that you need to run any database queries during the current
                request your application is serving.
            </para>

            <para>
                If you need to force the Adapter to connect to the RDBMS, use
                the <code>getConnection()</code> method.  This method returns
                an object for the connection as represented by the respective
                PHP database extension.  For example, if you use any of the
                Adapter classes for PDO drivers, then
                <code>getConnection()</code> returns the PDO object, after
                initiating it as a live connection to the specific database.
            </para>

            <para>
                It can be useful to force the connection if you want to catch
                any exceptions it throws as a result of invalid account
                credentials, or other failure to connect to the RDBMS server.
                These exceptions are not thrown until the connection is made,
                so it can help simplify your application code if you handle the
                exceptions in one place, instead of at the time of
                the first query against the database.
            </para>

            <example id="zend.db.adapter.connecting.getconnection.example">
                <title>Handling connection exceptions</title>
                <programlisting role="php"><![CDATA[<?php
try {
    $db = Zend_Db::factory('Pdo_Mysql', $parameters);
    $db->getConnection();
} catch (Zend_Db_Adapter_Exception $e) {
    // perhaps a failed login credential, or perhaps the RDBMS is not running
} catch (Zend_Exception $e) {
    // perhaps factory() failed to load the specified Adapter class
}]]>
                </programlisting>
            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.db.adapter.example-database">

        <title>The example database</title>

        <para>
            In the documentation for Zend_Db classes, we use a set of simple
            tables to illustrate usage of the classes and methods.  These
            example tables could store information for tracking bugs in a
            software development project.  The database contains four tables:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis role="strong">accounts</emphasis> stores
                    information about each user of the bug-tracking database.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">products</emphasis> stores
                    information about each product for which a bug can be
                    logged.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">bugs</emphasis> stores information
                    about bugs, including that current state of the bug, the
                    person who reported the bug, the person who is assigned to
                    fix the bug, and the person who is assigned to verify the
                    fix.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">bugs_products</emphasis> stores a
                    relationship between bugs and products.  This implements a
                    many-to-many relationship, because a given bug may be
                    relevant to multiple products, and of course a given
                    product can have multiple bugs.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            The following SQL data definition language pseudocode describes the
            tables in this example database.  These example tables are used
            extensively by the automated unit tests for Zend_Db.
        </para>

        <programlisting role="sql"><![CDATA[
CREATE TABLE accounts (
  account_name      VARCHAR(100) NOT NULL PRIMARY KEY
);

CREATE TABLE products (
  product_id        INTEGER NOT NULL PRIMARY KEY,
  product_name      VARCHAR(100)
);

CREATE TABLE bugs (
  bug_id            INTEGER NOT NULL PRIMARY KEY,
  bug_description   VARCHAR(100),
  bug_status        VARCHAR(20),
  reported_by       VARCHAR(100) REFERENCES accounts(account_name),
  assigned_to       VARCHAR(100) REFERENCES accounts(account_name),
  verified_by       VARCHAR(100) REFERENCES accounts(account_name)
);

CREATE TABLE bugs_products (
  bug_id            INTEGER NOT NULL REFERENCES bugs,
  product_id        INTEGER NOT NULL REFERENCES products,
  PRIMARY KEY       (bug_id, product_id)
);]]>
        </programlisting>

        <para>
            Also notice that the <code>bugs</code> table contains multiple
            foreign key references to the <code>accounts</code> table.
            Each of these foreign keys may reference a different row in the
            <code>accounts</code> table for a given bug.
        </para>

        <para>
            The diagram below illustrates the physical data model of the
            example database.
        </para>

        <para>
            <inlinegraphic width="387" scale="100" align="center" valign="middle"
                fileref="figures/zend.db.adapter.example-database.png" format="PNG" />
        </para>

    </sect2>

    <sect2 id="zend.db.adapter.select">

        <title>Reading Query Results</title>

        <para>
            This section describes methods of the Adapter class with which you
            can run SELECT queries and retrieve the query results.
        </para>

        <sect3 id="zend.db.adapter.select.fetchall">

            <title>Fetching a Complete Result Set</title>

            <para>
                You can run a SQL SELECT query and retrieve its results in one
                step using the <code>fetchAll()</code> method.
            </para>

            <para>
                The first argument to this method is a string containing a
                SELECT statement.  Alternatively, the first argument can be an
                object of class <link linkend="zend.db.select">Zend_Db_Select</link>.
                The Adapter automatically converts this object to a string
                representation of the SELECT statement.
            </para>

            <para>
                The second argument to <code>fetchAll()</code> is an array of
                values to substitute for parameter placeholders in the SQL
                statement.
            </para>

            <example id="zend.db.adapter.select.fetchall.example">
                <title>Using fetchAll()</title>
                <programlisting role="php"><![CDATA[<?php
$sql = 'SELECT * FROM bugs WHERE bug_id = ?';

$result = $db->fetchAll($sql, 2);]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.select.fetch-mode">

            <title>Changing the Fetch Mode</title>

            <para>
                By default, <code>fetchAll()</code> returns an array of
                rows, each of which is an associative array.  The keys of the
                associative array are the columns or column aliases named in
                the select query.
            </para>

            <para>
                You can specify a different style of fetching results using the
                <code>setFetchMode()</code> method.  The modes supported are
                identified by constants:
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <emphasis role="strong">Zend_Db::FETCH_ASSOC</emphasis>:
                        return data in an array of associative arrays.
                        The array keys are column names, as strings.
                        This is the default fetch mode for Zend_Db_Adapter classes.
                    </para>
                    <para>
                        Note that if your select-list contains more than one
                        column with the same name, for example if they are from
                        two different tables in a JOIN, there can be only one
                        entry in the associative array for a given name.
                        If you use the FETCH_ASSOC mode, you should specify
                        column aliases in your SELECT query to ensure that the
                        names result in unique array keys.
                    </para>
                    <para>
                        By default, these strings are returned as they are
                        returned by the database driver.  This is typically the
                        spelling of the column in the RDBMS server.  You can
                        specify the case for these strings, using the
                        <code>Zend_Db::CASE_FOLDING</code> option.
                        Specify this when instantiating the Adapter.
                        See <xref linkend="zend.db.adapter.connecting.parameters.example1" />.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Zend_Db::FETCH_NUM</emphasis>:
                        return data in an array of arrays.  The arrays are
                        indexed by integers, corresponding to the position of
                        the respective field in the select-list of the query.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Zend_Db::FETCH_BOTH</emphasis>:
                        return data in an array of arrays.  The array keys are
                        both strings as used in the FETCH_ASSOC mode, and
                        integers as used in the FETCH_NUM mode.  Note that the
                        number of elements in the array is double that which
                        would be in the array if you used either FETCH_ASSOC
                        or FETCH_NUM.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Zend_Db::FETCH_COLUMN</emphasis>:
                        return data in an array of values.  The value in each array
                        is the value returned by one column of the result set.
                        By default, this is the first column, indexed by 0.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Zend_Db::FETCH_OBJ</emphasis>:
                        return data in an array of objects.  The default class
                        is the PHP built-in class stdClass.  Columns of the
                        result set are available as public properties of the
                        object.
                    </para>
                </listitem>
            </itemizedlist>

            <example id="zend.db.adapter.select.fetch-mode.example">
                <title>Using setFetchMode()</title>
                <programlisting role="php"><![CDATA[<?php
$db->setFetchMode(Zend_Db::FETCH_OBJ);

$result = $db->fetchAll('SELECT * FROM bugs WHERE bug_id = ?', 2);

// $result is an array of objects
echo $result[0]->bug_description;]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.select.fetchassoc">

            <title>Fetching a Result Set as an Associative Array</title>

            <para>
                The <code>fetchAssoc()</code> method returns data in an array
                of associative arrays, regardless of what value you have set
                for the fetch mode.
            </para>

            <example id="zend.db.adapter.select.fetchassoc.example">
                <title>Using fetchAssoc()</title>
                <programlisting role="php"><![CDATA[<?php
$db->setFetchMode(Zend_Db::FETCH_OBJ);

$result = $db->fetchAssoc('SELECT * FROM bugs WHERE bug_id = ?', 2);

// $result is an array of associative arrays, in spite of the fetch mode
echo $result[0]['bug_description'];]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.select.fetchcol">

            <title>Fetching a Single Column from a Result Set</title>

            <para>
                The <code>fetchCol()</code> method returns data in an array
                of values, regardless of the value you have set for the fetch mode.
                This only returns the first column returned by the query.
                Any other columns returned by the query are discarded.
                If you need to return a column other than the first, see <xref linkend="zend.db.statement.fetching.fetchcolumn" />.
            </para>

            <example id="zend.db.adapter.select.fetchcol.example">
                <title>Using fetchCol()</title>
                <programlisting role="php"><![CDATA[<?php
$db->setFetchMode(Zend_Db::FETCH_OBJ);

$result = $db->fetchCol('SELECT bug_description, bug_id FROM bugs WHERE bug_id = ?', 2);

// contains bug_description; bug_id is not returned
echo $result[0];]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.select.fetchpairs">

            <title>Fetching Key-Value Pairs from a Result Set</title>

            <para>
                The <code>fetchPairs()</code> method returns data in an array
                of key-value pairs, as an associative array with a single entry
                per row.  The key of this associative array is taken from the
                first column returned by the SELECT query.  The value is taken
                from the second column returned by the SELECT query.  Any other
                columns returned by the query are discarded.
            </para>

            <para>
                You should design the SELECT query so that the first column
                returned has unique values.  If there are duplicates values in
                the first column, entries in the associative array will be
                overwritten.
            </para>

            <example id="zend.db.adapter.select.fetchpairs.example">
                <title>Using fetchPairs()</title>
                <programlisting role="php"><![CDATA[<?php
$db->setFetchMode(Zend_Db::FETCH_OBJ);

$result = $db->fetchPairs('SELECT bug_id, bug_status FROM bugs');

echo $result[2];]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.db.adapter.select.fetchrow">

            <title>Fetching a Single Row from a Result Set</title>

            <para>
                The <code>fetchRow()</code> method returns data using the
                current fetch mode, but it returns only the first row
                fetched from the result set.
            </para>

            <example id="zend.db.adapter.select.fetchrow.example">
                <title>Using fetchRow()</title>
                <programlisting role="php"><![CDATA[<?php
$db->setFetchMode(Zend_Db::FETCH_OBJ);

$result = $db->fetchRow('SELECT * FROM bugs WHERE bug_id = 2');

// note that $result is a single object, not an array of objects
echo $result->bug_description;]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.db.adapter.select.fetchone">

            <title>Fetching a Single Scalar from a Result Set</title>

            <para>
                The <code>fetchOne()</code> method is like a combination
                of <code>fetchRow()</code> with <code>fetchCol()</code>,
                in that it returns data only for the first row fetched from
                the result set, and it returns only the value of the first
                column in that row.  Therefore it returns only a single
                scalar value, not an array or an object.
            </para>

            <example id="zend.db.adapter.select.fetchone.example">
                <title>Using fetchOne()</title>
                <programlisting role="php"><![CDATA[<?php
$result = $db->fetchOne('SELECT bug_status FROM bugs WHERE bug_id = 2');

// this is a single string value
echo $result;]]>
                </programlisting>
            </example>
        </sect3>

    </sect2>

    <sect2 id="zend.db.adapter.write">

        <title>Writing Changes to the Database</title>

        <para>
            You can use the Adapter class to write new data or change existing
            data in your database.  This section describes methods to do these
            operations.
        </para>

        <sect3 id="zend.db.adapter.write.insert">

            <title>Inserting Data</title>

            <para>
                You can add new rows to a table in your database using the
                <code>insert()</code> method.  The first argument is a string
                that names the table, and the second argument is an associative
                array, mapping column names to data values.
            </para>

            <example id="zend.db.adapter.write.insert.example">
                <title>Inserting to a table</title>
                <programlisting role="php"><![CDATA[<?php
$data = array(
    'created_on'      => '2007-03-22',
    'bug_description' => 'Something wrong',
    'bug_status'      => 'NEW'
);

$db->insert('bugs', $data);]]>
                </programlisting>
            </example>

            <para>
                Columns you exclude from the array of data are not specified to
                the database.  Therefore, they follow the same rules that an
                SQL INSERT statement follows:  if the column has a DEFAULT
                clause, the column takes that value in the row created,
                otherwise the column is left in a NULL state.
            </para>

            <para>
                By default, the values in your data array are inserted using
                parameters.  This reduces risk of some types of security
                issues.  You don't need to apply escaping or quoting to values
                in the data array.
            </para>

            <para>
                You might need values in the data array to be treated as SQL
                expressions, in which case they should not be quoted.  By
                default, all data values passed as strings are treated as
                string literals.  To specify that the value is an SQL
                expression and therefore should not be quoted, pass the value
                in the data array as an object of type Zend_Db_Expr instead of
                a plain string.
            </para>

            <example id="zend.db.adapter.write.insert.example2">
                <title>Inserting expressions to a table</title>
                <programlisting role="php"><![CDATA[<?php
$data = array(
    'created_on'      => new Zend_Db_Expr('CURDATE()'),
    'bug_description' => 'Something wrong',
    'bug_status'      => 'NEW'
);

$db->insert('bugs', $data);]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.write.lastinsertid">

            <title>Retrieving a Generated Value</title>

            <para>
                Some RDBMS brands support auto-incrementing primary keys.
                A table defined this way generates a primary key value
                automatically during an INSERT of a new row.  The return value
                of the <code>insert()</code> method is <emphasis>not</emphasis>
                the last inserted ID, because the table might not have an
                auto-incremented column.  Instead, the return value is the
                number of rows affected (usually 1).
            </para>

            <para>
                If your table is defined with an auto-incrementing primary key,
                you can call the <code>lastInsertId()</code> method after the
                insert.  This method returns the last value generated in the
                scope of the current database connection.
            </para>

            <example id="zend.db.adapter.write.lastinsertid.example-1">
                <title>Using lastInsertId() for an auto-increment key</title>
                <programlisting role="php"><![CDATA[<?php
$db->insert('bugs', $data);

// return the last value generated by an auto-increment column
$id = $db->lastInsertId();]]>
                </programlisting>
            </example>

            <para>
                Some RDBMS brands support a sequence object, which generates
                unique values to serve as primary key values.  To support
                sequences, the <code>lastInsertId()</code> method accepts two
                optional string arguments.  These arguments name the table and
                the column, assuming you have followed the convention that a
                sequence is named using the table and column names for which
                the sequence generates values, and a suffix "_seq".  This is
                based on the convention used by PostgreSQL when naming
                sequences for SERIAL columns.  For example, a table "bugs" with
                primary key column "bug_id" would use a sequence named
                "bugs_bug_id_seq".
            </para>

            <example id="zend.db.adapter.write.lastinsertid.example-2">
                <title>Using lastInsertId() for a sequence</title>
                <programlisting role="php"><![CDATA[<?php
$db->insert('bugs', $data);

// return the last value generated by sequence 'bugs_bug_id_seq'.
$id = $db->lastInsertId('bugs', 'bug_id');

// alternatively, return the last value generated by sequence 'bugs_seq'.
$id = $db->lastInsertId('bugs');]]>
                </programlisting>
            </example>

            <para>
                If the name of your sequence object does not follow this naming
                convention, use the <code>lastSequenceId()</code> method
                instead.  This method takes a single string argument, naming
                the sequence literally.
            </para>

            <example id="zend.db.adapter.write.lastinsertid.example-3">
                <title>Using lastSequenceId()</title>
                <programlisting role="php"><![CDATA[<?php
$db->insert('bugs', $data);

// return the last value generated by sequence 'bugs_id_gen'.
$id = $db->lastSequenceId('bugs_id_gen');]]>
                </programlisting>
            </example>

            <para>
                For RDBMS brands that don't support sequences, including MySQL,
                Microsoft SQL Server, and SQLite, the arguments to the
                lastInsertId() method are ignored, and the value returned is the
                most recent value generated for any table by INSERT operations
                during the current connection.   For these RDBMS brands, the
                lastSequenceId() method always returns <code>null</code>.
            </para>

            <note>
                <title>Why not use "SELECT MAX(id) FROM table"?</title>
                <para>
                    Sometimes this query returns the most recent primary key
                    value inserted into the table.  However, this technique
                    is not safe to use in an environment where multiple clients are
                    inserting records to the database.  It is possible, and
                    therefore is bound to happen eventually, that another
                    client inserts another row in the instant between the
                    insert performed by your client application and your query
                    for the MAX(id) value.  Thus the value returned does not
                    identify the row you inserted, it identifies the row
                    inserted by some other client.  There is no way to know
                    when this has happened.
                </para>
                <para>
                    Using a strong transaction isolation mode such as
                    "repeatable read" can mitigate this risk, but some RDBMS
                    brands don't support the transaction isolation required for
                    this, or else your application may use a lower transaction
                    isolation mode by design.
                </para>
                <para>
                    Furthermore, using an expression like "MAX(id)+1" to generate
                    a new value for a primary key is not safe, because two clients
                    could do this query simultaneously, and then both use the same
                    calculated value for their next INSERT operation.
                </para>
                <para>
                    All RDBMS brands provide mechanisms to generate unique
                    values, and to return the last value generated.  These
                    mechanisms necessarily work outside of the scope of
                    transaction isolation, so there is no chance of two clients
                    generating the same value, and there is no chance that the
                    value generated by another client could be reported to your
                    client's connection as the last value generated.
                </para>
            </note>

        </sect3>

        <sect3 id="zend.db.adapter.write.update">
            <title>Updating Data</title>

            <para>
                You can update rows in a database table using the
                <code>update()</code> method of an Adapter.  This method takes
                three arguments:  the first is the name of the table; the
                second is an associative array mapping columns to change to new
                values to assign to these columns.
            </para>

            <para>
                The values in the data array are treated as string literals.
                See <xref linkend="zend.db.adapter.write.insert" />
                for information on using SQL expressions in the data array.
            </para>

            <para>
                The third argument is a string containing an SQL expression
                that is used as criteria for the rows to change.  The values
                and identifiers in this argument are not quoted or escaped.
                You are responsible for ensuring that any dynamic content is
                interpolated into this string safely.
                See <xref linkend="zend.db.adapter.quoting" />
                for methods to help you do this.
            </para>

            <para>
                The return value is the number of rows affected by the update
                operation.
            </para>

            <example id="zend.db.adapter.write.update.example">
                <title>Updating rows</title>
                <programlisting role="php"><![CDATA[<?php
$data = array(
    'updated_on'      => '2007-03-23',
    'bug_status'      => 'FIXED'
);

$n = $db->update('bugs', $data, 'bug_id = 2');]]>
                </programlisting>
            </example>

            <para>
                If you omit the third argument, then all rows in the database
                table are updated with the values specified in the data array.
            </para>

            <para>
                If you provide an array of strings as the third argument, these
                strings are joined together as terms in an expression separated
                by <code>AND</code> operators.
            </para>

            <example id="zend.db.adapter.write.update.example-array">
                <title>Updating rows using an array of expressions</title>
                <programlisting role="php"><![CDATA[<?php
$data = array(
    'updated_on'      => '2007-03-23',
    'bug_status'      => 'FIXED'
);

$where[] = "reported_by = 'goofy'";
$where[] = "bug_status = 'OPEN'";

$n = $db->update('bugs', $data, $where);

// Resulting SQL is:
//  UPDATE "bugs" SET "update_on" = '2007-03-23', "bug_status" = 'FIXED'
//  WHERE ("reported_by" = 'goofy') AND ("bug_status" = 'OPEN')]]>
                </programlisting>
            </example>

        </sect3>

        <sect3 id="zend.db.adapter.write.delete">
            <title>Deleting Data</title>
            <para>
                You can delete rows from a database table using the
                <code>delete()</code> method.  This method takes two arguments:
                the first is a string naming the table.
            </para>

            <para>
                The second argument is a string containing an SQL expression
                that is used as criteria for the rows to delete.  The values
                and identifiers in this argument are not quoted or escaped.
                You are responsible for ensuring that any dynamic content is
                interpolated into this string safely.
                See <xref linkend="zend.db.adapter.quoting" />
                for methods to help you do this.
            </para>

            <para>
                The return value is the number of rows affected by the delete
                operation.
            </para>

            <example id="zend.db.adapter.write.delete.example">
                <title>Deleting rows</title>
                <programlisting role="php"><![CDATA[<?php
$n = $db->delete('bugs', 'bug_id = 3');]]>
                </programlisting>
            </example>

            <para>
                If you omit the second argument, the result is that all rows in
                the database table are deleted.
            </para>

            <para>
                If you provide an array of strings as the second argument, these
                strings are joined together as terms in an expression separated
                by <code>AND</code> operators.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.db.adapter.quoting">

        <title>Quoting Values and Identifiers</title>

        <para>
            When you form SQL queries, often it is the case that you need to
            include the values of PHP variables in SQL expressions.  This is
            risky, because if the value in a PHP string contains certain
            symbols, such as the quote symbol, it could result in invalid SQL.
            For example, notice the imbalanced quote characters in the
            following query:
            <programlisting role="php"><![CDATA[
$name = "O'Reilly";
$sql = "SELECT * FROM bugs WHERE reported_by = '$name'";

echo $sql;
// SELECT * FROM bugs WHERE reported_by = 'O'Reilly']]>
            </programlisting>
        </para>

        <para>
            Even worse is the risk that such code mistakes might be exploited
            deliberately by a person who is trying to manipulate the function
            of your web application.  If they can specify the value of a PHP
            variable through the use of an HTTP parameter or other mechanism,
            they might be able to make your SQL queries do things that you
            didn't intend them to do, such as return data to which the person
            should not have privilege to read.  This is a serious and widespread
            technique for violating application security, known as "SQL Injection"
            (see <ulink url="http://en.wikipedia.org/wiki/SQL_Injection">http://en.wikipedia.org/wiki/SQL_Injection</ulink>).
        </para>

        <para>
            The Zend_Db Adapter class provides convenient functions to help you
            reduce vulnerabilities to SQL Injection attacks in your PHP code.
            The solution is to escape special characters such as quotes in PHP
            values before they are interpolated into your SQL strings.
            This protects against both accidental and deliberate manipulation
            of SQL strings by PHP variables that contain special characters.
        </para>

        <sect3 id="zend.db.adapter.quoting.quote">

            <title>Using <code>quote()</code></title>

            <para>
                The <code>quote()</code> method accepts a single argument, a
                scalar string value.  It returns the value with special
                characters escaped in a manner appropriate for the RDBMS you
                are using, and surrounded by string value delimiters.  The
                standard SQL string value delimiter is the single-quote
                (<code>'</code>).
            </para>

            <example id="zend.db.adapter.quoting.quote.example">
                <title>Using quote()</title>
                <programlisting role="php"><![CDATA[<?php
$name = $db->quote("O'Reilly");
echo $name;
// 'O\'Reilly'

$sql = "SELECT * FROM bugs WHERE reported_by = $name";

echo $sql;
// SELECT * FROM bugs WHERE reported_by = 'O\'Reilly']]>
                </programlisting>
            </example>

            <para>
                Note that the return value of <code>quote()</code> includes the
                quote delimiters around the string.  This is different from
                some functions that escape special characters but do not add
                the quote delimiters, for example
                <ulink url="http://www.php.net/mysqli_real_escape_string">mysql_real_escape_string()</ulink>.
            </para>

            <para>
                Values may need to be quoted or not quoted according to the SQL
                datatype context in which they are used.  For instance, in some
                RDBMS brands, an integer value must not be quoted as a string
                if it is compared to an integer-type column or expression.
                In other words, the following is an error in some SQL
                implementations, assuming <code>intColumn</code> has a SQL
                datatype of <code>INTEGER</code>

                <programlisting role="php"><![CDATA[
SELECT * FROM atable WHERE intColumn = '123']]>
                </programlisting>
            </para>

            <para>
                You can use the optional second argument to the
                <code>quote()</code> method to apply quoting selectively for
                the SQL datatype you specify.
            </para>

            <example id="zend.db.adapter.quoting.quote.example-2">
                <title>Using quote() with a SQL type</title>
                <programlisting role="php"><![CDATA[<?php
$value = '1234';
$sql = 'SELECT * FROM atable WHERE intColumn = '
     . $db->quote($value, 'INTEGER');
]]>
                </programlisting>
            </example>

            <para>
                Each Zend_Db_Adapter class has encoded the names of numeric
                SQL datatypes for the respective brand of RDBMS.  You can also
                use the constants <code>Zend_Db::INT_TYPE</code>,
                <code>Zend_Db::BIGINT_TYPE</code>, and
                <code>Zend_Db::FLOAT_TYPE</code> to write code in a more
                RDBMS-independent way.
            </para>

            <para>
                Zend_Db_Table specifies SQL types to <code>quote()</code>
                automatically when generating SQL queries that reference a
                table's key columns.
            </para>

        </sect3>

        <sect3 id="zend.db.adapter.quoting.quote-into">

            <title>Using <code>quoteInto()</code></title>

            <para>
                The most typical usage of quoting is to interpolate a PHP
                variable into a SQL expression or statement.  You can use the
                <code>quoteInto()</code> method to do this in one step.  This
                method takes two arguments: the first argument is a string
                containing a placeholder symbol (<code>?</code>), and the
                second argument is a value or PHP variable that should be
                substituted for that placeholder.
            </para>

            <para>
                The placeholder symbol is the same symbol used by many RDBMS
                brands for positional parameters, but the
                <code>quoteInto()</code> method only emulates query parameters.
                The method simply interpolates the value into the string,
                escapes special characters, and applies quotes around it.
                True query parameters maintain the separation between the SQL
                string and the parameters as the statement is parsed in the
                RDBMS server.
            </para>

            <example id="zend.db.adapter.quoting.quote-into.example">
                <title>Using quoteInto()</title>
                <programlisting role="php"><![CDATA[<?php
$sql = $db->quoteInto("SELECT * FROM bugs WHERE reported_by = ?", "O'Reilly");

echo $sql;
// SELECT * FROM bugs WHERE reported_by = 'O\'Reilly']]>
                </programlisting>
            </example>

            <para>
                You can use the optional third parameter of
                <code>quoteInto()</code> to specify the SQL datatype.  Numeric
                datatypes are not quoted, and other types are quoted.
            </para>

            <example id="zend.db.adapter.quoting.quote-into.example-2">
                <title>Using quoteInto() with a SQL type</title>
                <programlisting role="php"><![CDATA[<?php
$sql = $db->quoteInto("SELECT * FROM bugs WHERE bug_id = ?", '1234', 'INTEGER');

echo $sql;
// SELECT * FROM bugs WHERE reported_by = 1234]]>
                </programlisting>
            </example>

        </sect3>
        <sect3 id="zend.db.adapter.quoting.quote-identifier">

            <title>Using <code>quoteIdentifier()</code></title>

            <para>
                Values are not the only part of SQL syntax that might need to
                be variable.  If you use PHP variables to name tables, columns,
                or other identifiers in your SQL statements, you might need to
                quote these strings too.  By default, SQL identifiers have
                syntax rules like PHP and most other programming languages.
                For example, identifiers should not contain spaces, certain
                punctuation or special characters, or international characters.
                Also certain words are reserved for SQL syntax, and should not
                be used as identifiers.
            </para>

            <para>
                However, SQL has a feature called <emphasis>delimited identifiers</emphasis>,
                which allows broader choices for the spelling of identifiers.
                If you enclose a SQL identifier in the proper types of quotes,
                you can use identifiers with spellings that would be invalid
                without the quotes.  Delimited identifiers can contain spaces,
                punctuation, or international characters.  You can also use SQL
                reserved words if you enclose them in identifier delimiters.
            </para>

            <para>
                The <code>quoteIdentifier()</code> method works like
                <code>quote()</code>, but it applies the identifier delimiter
                characters to the string according to the type of Adapter you
                use.  For example, standard SQL uses double-quotes
                (<code>"</code>) for identifier delimiters, and most RDBMS
                brands use that symbol.  MySQL uses back-quotes
                (<code>`</code>) by default.  The
                <code>quoteIdentifier()</code> method also escapes special
                characters within the string argument.
            </para>

            <example id="zend.db.adapter.quoting.quote-identifier.example">
                <title>Using quoteIdentifier()</title>
                <programlisting role="php"><![CDATA[<?php
// we might have a table name that is an SQL reserved word
$tableName = $db->quoteIdentifier("order");

$sql = "SELECT * FROM $tableName";

echo $sql
// SELECT * FROM "order"]]>
                </programlisting>
            </example>

            <para>
                SQL delimited identifiers are case-sensitive, unlike unquoted
                identifiers.  Therefore, if you use delimited identifiers, you
                must use the spelling of the identifier exactly as it is stored
                in your schema, including the case of the letters.
            </para>

            <para>
                In most cases where SQL is generated within Zend_Db classes,
                the default is that all identifiers are delimited
                automatically.  You can change this behavior with the option
                <code>Zend_Db::AUTO_QUOTE_IDENTIFIERS</code>.  Specify this
                when instantiating the Adapter.
                See <xref linkend="zend.db.adapter.connecting.parameters.example2" />.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.db.adapter.transactions">

        <title>Controlling Database Transactions</title>

        <para>
            Databases define transactions as logical units of work that can be
            committed or rolled back as a single change, even if they operate
            on multiple tables.  All queries to a database are executed within
            the context of a transaction, even if the database driver manages
            them implicitly.  This is called <emphasis>auto-commit</emphasis>
            mode, in which the database driver creates a transaction for every
            statement you execute, and commits that transaction after your
            SQL statement has been executed.  By default, all Zend_Db Adapter
            classes operate in auto-commit mode.
        </para>

        <para>
            Alternatively, you can specify the beginning and resolution of a
            transaction, and thus control how many SQL queries are included in
            a single group that is committed (or rolled back) as a single
            operation.  Use the <code>beginTransaction()</code> method to
            initiate a transaction.  Subsequent SQL statements are executed in
            the context of the same transaction until you resolve it
            explicitly.
        </para>

        <para>
            To resolve the transaction, use either the <code>commit()</code> or
            <code>rollBack()</code> methods.  The <code>commit()</code> method
            marks changes made during your transaction as committed, which
            means the effects of these changes are shown in queries run in
            other transactions.
        </para>

        <para>
            The <code>rollBack()</code> method does the opposite: it discards
            the changes made during your transaction.  The changes are
            effectively undone, and the state of the data returns to how it was
            before you began your transaction.  However, rolling back your
            transaction has no effect on changes made by other transactions
            running concurrently.
        </para>

        <para>
            After you resolve this transaction, <code>Zend_Db_Adapter</code>
            returns to auto-commit mode until you call
            <code>beginTransaction()</code> again.
        </para>

        <example id="zend.db.adapter.transactions.example">
            <title>Managing a transaction to ensure consistency</title>
            <programlisting role="php"><![CDATA[<?php
// Start a transaction explicitly.
$db->beginTransaction();

try {
    // Attempt to execute one or more queries:
    $db->query(...);
    $db->query(...);
    $db->query(...);

    // If all succeed, commit the transaction and all changes
    // are committed at once.
    $db->commit();

} catch (Exception $e) {
    // If any of the queries failed and threw an exception,
    // we want to roll back the whole transaction, reversing
    // changes made in the transaction, even those that succeeded.
    // Thus all changes are committed together, or none are.
    $db->rollBack();
    echo $e->getMessage();
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.db.adapter.list-describe">

        <title>Listing and Describing Tables</title>

        <para>
            The <code>listTables()</code> method returns an array of strings,
            naming all tables in the current database.
        </para>

        <para>
            The <code>describeTable()</code> method returns an associative
            array of metadata about a table.  Specify the name of the table
            as a string in the first argument to this method.  The second
            argument is optional, and names the schema in which the table
            exists.
        </para>

        <para>
            The keys of the associative array returned are the column names of
            the table.  The value corresponding to each column is also an
            associative array, with the following keys and values:
        </para>

        <table frame="all" cellpadding="5" id="zend.db.adapter.list-describe.metadata">
            <title>Metadata fields returned by describeTable()</title>
            <tgroup cols="3" align="left" colsep="1" rowsep="1">
                <thead>
                    <row>
                        <entry>Key</entry>
                        <entry>Type</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>SCHEMA_NAME</entry>
                        <entry>(string)</entry>
                        <entry>Name of the database schema in which this table exists.</entry>
                    </row>
                    <row>
                        <entry>TABLE_NAME</entry>
                        <entry>(string)</entry>
                        <entry>Name of the table to which this column belongs.</entry>
                    </row>
                    <row>
                        <entry>COLUMN_NAME</entry>
                        <entry>(string)</entry>
                        <entry>Name of the column.</entry>
                    </row>
                    <row>
                        <entry>COLUMN_POSITION</entry>
                        <entry>(integer)</entry>
                        <entry>Ordinal position of the column in the table.</entry>
                    </row>
                    <row>
                        <entry>DATA_TYPE</entry>
                        <entry>(string)</entry>
                        <entry>RDBMS name of the datatype of the column.</entry>
                    </row>
                    <row>
                        <entry>DEFAULT</entry>
                        <entry>(string)</entry>
                        <entry>Default value for the column, if any.</entry>
                    </row>
                    <row>
                        <entry>NULLABLE</entry>
                        <entry>(boolean)</entry>
                        <entry>True if the column accepts SQL NULLs, false if the column has a NOT NULL constraint.</entry>
                    </row>
                    <row>
                        <entry>LENGTH</entry>
                        <entry>(integer)</entry>
                        <entry>Length or size of the column as reported by the RDBMS.</entry>
                    </row>
                    <row>
                        <entry>SCALE</entry>
                        <entry>(integer)</entry>
                        <entry>Scale of SQL NUMERIC or DECIMAL type.</entry>
                    </row>
                    <row>
                        <entry>PRECISION</entry>
                        <entry>(integer)</entry>
                        <entry>Precision of SQL NUMERIC or DECIMAL type.</entry>
                    </row>
                    <row>
                        <entry>UNSIGNED</entry>
                        <entry>(boolean)</entry>
                        <entry>True if an integer-based type is reported as UNSIGNED.</entry>
                    </row>
                    <row>
                        <entry>PRIMARY</entry>
                        <entry>(boolean)</entry>
                        <entry>True if the column is part of the primary key of this table.</entry>
                    </row>
                    <row>
                        <entry>PRIMARY_POSITION</entry>
                        <entry>(integer)</entry>
                        <entry>Ordinal position (1-based) of the column in the primary key.</entry>
                    </row>
                    <row>
                        <entry>IDENTITY</entry>
                        <entry>(boolean)</entry>
                        <entry>True if the column uses an auto-generated value.</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            If no table exists matching the table name and optional schema name
            specified, then <code>describeTable()</code> returns an empty array.
        </para>

    </sect2>

    <sect2 id="zend.db.adapter.closing">

        <title>Closing a Connection</title>

        <para>
            Normally it is not necessary to close a database connection.  PHP
            automatically cleans up all resources and the end of a request.
            Database extensions are designed to close the connection as the
            reference to the resource object is cleaned up.
        </para>

        <para>
            However, if you have a long-duration PHP script that initiates many
            database connections, you might need to close the connection, to avoid
            exhausting the capacity of your RDBMS server.  You can use the
            Adapter's <code>closeConnection()</code> method to explicitly close
            the underlying database connection.
        </para>

        <example id="zend.db.adapter.closing.example">
            <title>Closing a database connection</title>
            <programlisting role="php"><![CDATA[<?php
$db->closeConnection();]]>
            </programlisting>
        </example>

        <note>
            <title>Does Zend_Db support persistent connections?</title>
            <para>
                The usage of persistent connections is not supported
                or encouraged in Zend_Db.
            </para>
            <para>
                Using persistent connections can cause an excess of idle
                connections on the RDBMS server, which causes more problems
                than any performance gain you might achieve by reducing the
                overhead of making connections.
            </para>
            <para>
                Database connections have state.  That is, some objects in the
                RDBMS server exist in session scope.  Examples are locks, user
                variables, temporary tables, and information about the most
                recently executed query, such as rows affected, and last
                generated id value.  If you use persistent connections, your
                application could access invalid or privileged data that were
                created in a previous PHP request.
            </para>
        </note>

    </sect2>

    <sect2 id="zend.db.adapter.other-statements">

        <title>Running Other Database Statements</title>

        <para>
            There might be cases in which you need to access the connection
            object directly, as provided by the PHP database extension.  Some
            of these extensions may offer features that are not surfaced by
            methods of Zend_Db_Adapter_Abstract.
        </para>

        <para>
            For example, all SQL statements run by Zend_Db are prepared, then
            executed.  However, some database features are incompatible with
            prepared statements.  DDL statements like CREATE and ALTER cannot
            be prepared in MySQL.  Also, SQL statements don't benefit
            from the <ulink url="http://dev.mysql.com/doc/refman/5.1/en/query-cache-how.html">MySQL Query Cache</ulink>,
            prior to MySQL 5.1.17.
        </para>

        <para>
            Most PHP database extensions provide a method to execute SQL
            statements without preparing them.  For example, in PDO, this
            method is <code>exec()</code>.  You can access the connection
            object in the PHP extension directly using getConnection().
        </para>

        <example id="zend.db.adapter.other-statements.example">
            <title>Running a non-prepared statement in a PDO adapter</title>
            <programlisting role="php"><![CDATA[<?php
$result = $db->getConnection()->exec('DROP TABLE bugs');]]>
            </programlisting>
        </example>

        <para>
            Similarly, you can access other methods or properties that are
            specific to PHP database extensions.  Be aware, though, that by
            doing this you might constrain your application to the interface
            provided by the extension for a specific brand of RDBMS.
        </para>

        <para>
            In future versions of Zend_Db, there will be opportunities to
            add method entry points for functionality that is common to
            the supported PHP database extensions.  This will not affect
            backward compatibility.
        </para>

    </sect2>

    <sect2 id="zend.db.adapter.adapter-notes">

        <title>Notes on Specific Adapters</title>

        <para>
            This section lists differences between the Adapter classes of which
            you should be aware.
        </para>

        <sect3 id="zend.db.adapter.adapter-notes.ibm-db2">
            <title>IBM DB2</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the factory() method with the
                        name 'Db2'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extension ibm_db2.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        IBM DB2 supports both sequences and auto-incrementing
                        keys.  Therefore the arguments to
                        <code>lastInsertId()</code> are optional.  If you give
                        no arguments, the Adapter returns the last value
                        generated for an auto-increment key.  If you give
                        arguments, the Adapter returns the last value generated
                        by the sequence named according to the convention
                        '<emphasis>table</emphasis>_<emphasis>column</emphasis>_seq'.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.mysqli">
            <title>MySQLi</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Mysqli'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter utilizes the PHP extension mysqli.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        MySQL does not support sequences, so
                        <code>lastInsertId()</code> ignores its arguments and
                        always returns the last value generated for an
                        auto-increment key.  The <code>lastSequenceId()</code>
                        method returns <code>null</code>.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.oracle">
            <title>Oracle</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Oracle'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extension oci8.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Oracle does not support auto-incrementing keys, so you
                        should specify the name of a sequence to
                        <code>lastInsertId()</code> or
                        <code>lastSequenceId()</code>.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        The Oracle extension does not support positional
                        parameters.  You must use named parameters.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Currently the <code>Zend_Db::CASE_FOLDING</code> option
                        is not supported by the Oracle adapter. To use this
                        option with Oracle, you must use the PDO OCI adapter.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.pdo-ibm">
            <title>PDO for IBM DB2 and Informix Dynamic Server (IDS)</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Pdo_Ibm'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extensions pdo and pdo_ibm.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        You must use at least PDO_IBM extension version 1.2.2.
                        If you have an earlier version of this extension, you
                        must upgrade the PDO_IBM extension from PECL.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.pdo-mssql">
            <title>PDO Microsoft SQL Server</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Pdo_Mssql'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extensions pdo and pdo_mssql.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Microsoft SQL Server does not support sequences, so
                        <code>lastInsertId()</code> ignores its arguments and
                        always returns the last value generated for an
                        auto-increment key.  The <code>lastSequenceId()</code>
                        method returns <code>null</code>.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Zend_Db_Adapter_Pdo_Mssql sets <code>QUOTED_IDENTIFIER ON</code>
                        immediately after connecting to a SQL Server database.
                        This makes the driver use the standard SQL identifier
                        delimiter symbol (<code>"</code>) instead of the
                        proprietary square-brackets syntax SQL Server uses for
                        delimiting identifiers.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        You can specify <code>pdoType</code> as a key in the
                        options array.  The value can be "mssql" (the default),
                        "dblib", "freetds", or "sybase".  This option affects
                        the DSN prefix the adapter uses when constructing the
                        DSN string.  Both "freetds" and "sybase" imply a prefix
                        of "sybase:", which is used for the
                        <ulink url="http://www.freetds.org/">FreeTDS</ulink> set
                        of libraries.
                        See also
                        <ulink url="http://www.php.net/manual/en/ref.pdo-dblib.connection.php">
                        http://www.php.net/manual/en/ref.pdo-dblib.connection.php</ulink>
                        for more information on the DSN prefixes used in this driver.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.pdo-mysql">
            <title>PDO MySQL</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Pdo_Mysql'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extensions pdo and pdo_mysql.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        MySQL does not support sequences, so
                        <code>lastInsertId()</code> ignores its arguments and
                        always returns the last value generated for an
                        auto-increment key.  The <code>lastSequenceId()</code>
                        method returns <code>null</code>.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.pdo-oci">
            <title>PDO Oracle</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Pdo_Oci'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extensions pdo and pdo_oci.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Oracle does not support auto-incrementing keys, so you
                        should specify the name of a sequence to
                        <code>lastInsertId()</code> or
                        <code>lastSequenceId()</code>.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.pdo-pgsql">
            <title>PDO PostgreSQL</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Pdo_Pgsql'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extensions pdo and pdo_pgsql.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        PostgreSQL supports both sequences and auto-incrementing
                        keys.  Therefore the arguments to
                        <code>lastInsertId()</code> are optional.  If you give
                        no arguments, the Adapter returns the last value
                        generated for an auto-increment key.  If you give
                        arguments, the Adapter returns the last value generated
                        by the sequence named according to the convention
                        '<emphasis>table</emphasis>_<emphasis>column</emphasis>_seq'.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.pdo-sqlite">
            <title>PDO SQLite</title>
            <itemizedlist>
                <listitem>
                    <para>
                        Specify this Adapter to the <code>factory()</code>
                        method with the name 'Pdo_Sqlite'.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        This Adapter uses the PHP extensions pdo and pdo_sqlite.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        SQLite does not support sequences, so
                        <code>lastInsertId()</code> ignores its arguments and
                        always returns the last value generated for an
                        auto-increment key.  The <code>lastSequenceId()</code>
                        method returns <code>null</code>.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        To connect to an SQLite2 database, specify
                        <code>'dsnprefix'=>'sqlite2'</code> in the array of
                        parameters when creating an instance of the
                        Pdo_Sqlite Adapter.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        To connect to an in-memory SQLite database,
                        specify <code>'dbname'=>':memory:'</code> in the
                        array of parameters when creating an instance of
                        the Pdo_Sqlite Adapter.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Older versions of the SQLite driver for PHP do not seem
                        to support the PRAGMA commands necessary to ensure that
                        short column names are used in result sets.  If you
                        have problems that your result sets are returned with
                        keys of the form "tablename.columnname" when you do a
                        join query, then you should upgrade to the current
                        version of PHP.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.db.adapter.adapter-notes.firebird">
            <title>Firebird/Interbase</title>
            <itemizedlist>
                <listitem>
                    <para>
                        This Adapter uses the PHP extension php_interbase.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Firebird/interbase does not support auto-incrementing keys,
                        so you should specify the name of a sequence to
                        <code>lastInsertId()</code> or
                        <code>lastSequenceId()</code>.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Currently the <code>Zend_Db::CASE_FOLDING</code> option
                        is not supported by the Firebird/interbase adapter.
                        Unquoted identifiers are automaticaly returned in
                        upper case.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>


    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.db.profiler">

    <title>Zend_Db_Profiler</title>

    <sect2 id="zend.db.profiler.introduction">

        <title>Introduction</title>

        <para>
            <code>Zend_Db_Profiler</code> can be enabled to allow profiling of
            queries. Profiles include the queries processed by the adapter as
            well as elapsed time to run the queries, allowing inspection of the
            queries that have been performed without needing to add extra
            debugging code to classes. Advanced usage also allows the
            developer to filter which queries are profiled.
        </para>

        <para>
            Enable the profiler by either passing a directive to the adapter
            constructor, or by asking the adapter to enable it later.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Db.php';

$params = array(
    'host'     => '127.0.0.1',
    'username' => 'webuser',
    'password' => 'xxxxxxxx',
    'dbname'   => 'test'
    'profiler' => true  // turn on profiler; set to false to disable (default)
);

$db = Zend_Db::factory('PDO_MYSQL', $params);

// turn off profiler:
$db->getProfiler()->setEnabled(false);

// turn on profiler:
$db->getProfiler()->setEnabled(true);]]>
        </programlisting>

        <para>
            The value of the '<code>profiler</code>' option is flexible. It is interpreted differently depending on its
            type.  Most often, you should use a simple boolean value, but other types enable you to customize the
            profiler behavior.
        </para>

        <para>
            A boolean argument sets the profiler to enabled if it is a <code>true</code> value, or disabled if
            <code>false</code>.  The profiler class is the adapter's default profiler class,
            <code>Zend_Db_Profiler</code>.
            <programlisting role="php"><![CDATA[
$params['profiler'] = true;
$db = Zend_Db::factory('PDO_MYSQL', $params);]]>
            </programlisting>
        </para>

        <para>
            An instance of a profiler object makes the adapter use that object.  The object type must be
            <code>Zend_Db_Profiler</code> or a subclass thereof. Enabling the profiler is done separately.
            <programlisting role="php"><![CDATA[
$profiler = MyProject_Db_Profiler();
$profiler->setEnabled(true);
$params['profiler'] = $profiler;
$db = Zend_Db::factory('PDO_MYSQL', $params);]]>
            </programlisting>
        </para>

        <para>
            The argument can be an associative array containing any or all of the keys '<code>enabled</code>',
            '<code>instance</code>', and '<code>class</code>'. The '<code>enabled</code>' and '<code>instance</code>'
            keys correspond to the boolean and instance types documented above. The '<code>class</code>' key is used
            to name a class to use for a custom profiler. The class must be <code>Zend_Db_Profiler</code> or a
            subclass. The class is instantiated with no constructor arguments. The '<code>class</code>' option is
            ignored when the '<code>instance</code>' option is supplied.
            <programlisting role="php"><![CDATA[
$params['profiler'] = array(
    'enabled' => true,
    'class'   => 'MyProject_Db_Profiler'
);
$db = Zend_Db::factory('PDO_MYSQL', $params);]]>
            </programlisting>
        </para>

        <para>
            Finally, the argument can be an object of type <code>Zend_Config</code> containing properties, which are treated as the array keys described above.  For example, a file "config.ini" might contain the following data:
            <programlisting role="ini"><![CDATA[
[main]
db.profiler.class   = "MyProject_Db_Profiler"
db.profiler.enabled = true]]>
            </programlisting>

            This configuration can be applied by the following PHP code:

            <programlisting role="php"><![CDATA[
$config = new Zend_Config_Ini('config.ini', 'main');
$params['profiler'] = $config->db->profiler;
$db = Zend_Db::factory('PDO_MYSQL', $params);]]>
            </programlisting>

            The '<code>instance</code>' property may be used as in the following:
            <programlisting role="php"><![CDATA[
$profiler = new MyProject_Db_Profiler();
$profiler->setEnabled(true);
$configData = array(
    'instance' => $profiler
    );
$config = new Zend_Config($configData);
$params['profiler'] = $config;
$db = Zend_Db::factory('PDO_MYSQL', $params);]]>
            </programlisting>

        </para>

    </sect2>

    <sect2 id="zend.db.profiler.using">

        <title>Using the Profiler</title>

        <para>
            At any point, grab the profiler using the adapter's
            <code>getProfiler()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
$profiler = $db->getProfiler();]]>
        </programlisting>

        <para>
            This returns a <code>Zend_Db_Profiler</code> object instance. With
            that instance, the developer can examine your queries using a
            variety of methods:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>getTotalNumQueries()</code> returns the total number
                    of queries that have been profiled.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>getTotalElapsedSecs()</code> returns the total
                    number of seconds elapsed for all profiled queries.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>getQueryProfiles()</code> returns an array of all
                    query profiles.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>getLastQueryProfile()</code> returns the last (most
                    recent) query profile, regardless of whether or not the query
                    has finished (if it hasn't, the end time will be null)
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>clear()</code> clears any past query profiles
                    from the stack.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            The return value of <code>getLastQueryProfile()</code> and the
            individual elements of <code>getQueryProfiles()</code> are
            <code>Zend_Db_Profiler_Query</code> objects, which provide the
            ability to inspect the individual queries themselves:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>getQuery()</code> returns the SQL text of the query.
                    The SQL text of a prepared statement with parameters is the
                    text at the time the query was prepared, so it contains
                    parameter placeholders, not the values used when the
                    statement is executed.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>getQueryParams()</code> returns an array of
                    parameter values used when executing a prepared query.
                    This includes both bound parameters and arguments to the
                    statement's <code>execute()</code> method.  The keys of
                    the array are the positional (1-based) or named (string)
                    parameter indices.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>getElapsedSecs()</code> returns the number of
                    seconds the query ran.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            The information <code>Zend_Db_Profiler</code> provides is useful for
            profiling bottlenecks in applications, and for debugging queries
            that have been run. For instance, to see the exact query that was
            last run:
        </para>

        <programlisting role="php"><![CDATA[<?php
$query = $profiler->getLastQueryProfile();

echo $query->getQuery();]]>
        </programlisting>

        <para>
            Perhaps a page is generating slowly; use the profiler to determine
            first the total number of seconds of all queries, and then step
            through the queries to find the one that ran longest:
        </para>

        <programlisting role="php"><![CDATA[<?php
$totalTime    = $profiler->getTotalElapsedSecs();
$queryCount   = $profiler->getTotalNumQueries();
$longestTime  = 0;
$longestQuery = null;

foreach ($profiler->getQueryProfiles() as $query) {
    if ($query->getElapsedSecs() > $longestTime) {
        $longestTime  = $query->getElapsedSecs();
        $longestQuery = $query->getQuery();
    }
}

echo 'Executed ' . $queryCount . ' queries in ' . $totalTime . ' seconds' . "\n";
echo 'Average query length: ' . $totalTime / $queryCount . ' seconds' . "\n";
echo 'Queries per second: ' . $queryCount / $totalTime . "\n";
echo 'Longest query length: ' . $longestTime . "\n";
echo "Longest query: \n" . $longestQuery . "\n";]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.db.profiler.advanced">

        <title>Advanced Profiler Usage</title>

        <para>
            In addition to query inspection, the profiler also allows the
            developer to filter which queries get profiled. The following
            methods operate on a <code>Zend_Db_Profiler</code> instance:
        </para>

        <sect3 id="zend.db.profiler.advanced.filtertime">
            <title>Filter by query elapsed time</title>

            <para>
                <code>setFilterElapsedSecs()</code> allows the developer to set
                a minimum query time before a query is profiled. To remove the
                filter, pass the method a null value.
            </para>

            <programlisting role="php"><![CDATA[<?php
// Only profile queries that take at least 5 seconds:
$profiler->setFilterElapsedSecs(5);

// Profile all queries regardless of length:
$profiler->setFilterElapsedSecs(null);]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.db.profiler.advanced.filtertype">
            <title>Filter by query type</title>

            <para>
                <code>setFilterQueryType()</code> allows the developer to set
                which types of queries should be profiled; to profile multiple
                types, logical OR them. Query types are defined as the following
                <code>Zend_Db_Profiler</code> constants:
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <code>Zend_Db_Profiler::CONNECT</code>: connection
                        operations, or selecting a database.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Db_Profiler::QUERY</code>: general database
                        queries that do not match other types.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Db_Profiler::INSERT</code>: any query that
                        adds new data to the database, generally SQL INSERT.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Db_Profiler::UPDATE</code>: any query that
                        updates existing data, usually SQL UPDATE.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Db_Profiler::DELETE</code>: any query that
                        deletes existing data, usually SQL DELETE.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Db_Profiler::SELECT</code>: any query that
                        retrieves existing data, usually SQL SELECT.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Db_Profiler::TRANSACTION</code>: any
                        transactional operation, such as start transaction, commit,
                        or rollback.
                    </para>
                </listitem>
            </itemizedlist>

            <para>
                As with <code>setFilterElapsedSecs()</code>, you can remove any
                existing filters by passing <code>null</code> as the sole
                argument.
            </para>

            <programlisting role="php"><![CDATA[<?php
// profile only SELECT queries
$profiler->setFilterQueryType(Zend_Db_Profiler::SELECT);

// profile SELECT, INSERT, and UPDATE queries
$profiler->setFilterQueryType(Zend_Db_Profiler::SELECT | Zend_Db_Profiler::INSERT | Zend_Db_Profiler::UPDATE);

// profile DELETE queries (so we can figure out why data keeps disappearing)
$profiler->setFilterQueryType(Zend_Db_Profiler::DELETE);

// Remove all filters
$profiler->setFilterQueryType(null);]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.db.profiler.advanced.getbytype">
            <title>Retrieve profiles by query type</title>

            <para>
                Using <code>setFilterQueryType()</code> can cut down on the
                profiles generated. However, sometimes it can be more useful to
                keep all profiles, but view only those you need at a given
                moment. Another feature of <code>getQueryProfiles()</code> is
                that it can do this filtering on-the-fly, by passing a query
                type (or logical combination of query types) as its first
                argument; see <xref linkend="zend.db.profiler.advanced.filtertype" />
                for a list of the query type constants.
            </para>

            <programlisting role="php"><![CDATA[<?php
// Retrieve only SELECT query profiles
$profiles = $profiler->getQueryProfiles(Zend_Db_Profiler::SELECT);

// Retrieve only SELECT, INSERT, and UPDATE query profiles
$profiles = $profiler->getQueryProfiles(Zend_Db_Profiler::SELECT | Zend_Db_Profiler::INSERT | Zend_Db_Profiler::UPDATE);

// Retrieve DELETE query profiles (so we can figure out why data keeps
// disappearing)
$profiles = $profiler->getQueryProfiles(Zend_Db_Profiler::DELETE);]]>
            </programlisting>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.db.select">

    <title>Zend_Db_Select</title>

    <sect2 id="zend.db.select.introduction">

        <title>Overview of the Select Object</title>

        <para>
            The Zend_Db_Select object represents a SQL <code>SELECT</code> query statement. The
            class has methods for adding individual parts to the query. You can specify some
            parts of the query using PHP methods and data structures, and the class forms the
            correct SQL syntax for you. After you build a query, you can execute the query as if
            you had written it as a string.
        </para>

        <para>
            The value offered by Zend_Db_Select includes:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    Object-oriented methods for specifying SQL queries in a piece-by-piece manner;
                </para>
            </listitem>

            <listitem>
                <para>
                    Database-independent abstraction of some parts of the SQL query;
                </para>
            </listitem>

            <listitem>
                <para>
                    Automatic quoting of metadata identifiers in most cases, to support identifiers
                    containing SQL reserved words and special characters;
                </para>
            </listitem>

            <listitem>
                <para>
                    Quoting identifiers and values, to help reduce risk of SQL injection attacks.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            Using Zend_Db_Select is not mandatory. For very simple SELECT queries, it is usually
            simpler to specify the entire SQL query as a string and execute it using Adapter
            methods like <code>query()</code> or <code>fetchAll()</code>. Using Zend_Db_Select is
            helpful if you need to assemble a SELECT query procedurally, or based on conditional
            logic in your application.
        </para>

    </sect2>

    <sect2 id="zend.db.select.creating">

        <title>Creating a Select Object</title>

        <para>
            You can create an instance of a Zend_Db_Select object using the <code>select()</code>
            method of a Zend_Db_Adapter_Abstract object.
        </para>

        <example id="zend.db.select.creating.example-db">

            <title>Example of the database adapter's select() method</title>

            <programlisting role="php"><![CDATA[<?php
$db = Zend_Db::factory( ...options... );
$select = $db->select();]]>
            </programlisting>

        </example>

        <para>
            Another way to create a Zend_Db_Select object is with its constructor, specifying the
            database adapter as an argument.
        </para>

        <example id="zend.db.select.creating.example-new">

            <title>Example of creating a new Select object</title>

            <programlisting role="php"><![CDATA[<?php
$db = Zend_Db::factory( ...options... );
$select = new Zend_Db_Select($db);]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.db.select.building">

        <title>Building Select queries</title>

        <para>
            When building the query, you can add clauses of the query one by one. There is a
            separate method to add each clause to the Zend_Db_Select object.
        </para>

        <example id="zend.db.select.building.example">

            <title>Example of the using methods to add clauses</title>

            <programlisting role="php"><![CDATA[<?php
// Create the Zend_Db_Select object
$select = $db->select();

// Add a FROM clause
$select->from( ...specify table and columns... )

// Add a WHERE clause
$select->where( ...specify search criteria... )

// Add an ORDER BY clause
$select->order( ...specify sorting criteria... );]]>
            </programlisting>

        </example>

        <para>
            You also can use most methods of the Zend_Db_Select object with a convenient fluent
            interface. A fluent interface means that each method returns a reference to the object
            on which it was called, so you can immediately call another method.
        </para>

        <example id="zend.db.select.building.example-fluent">

            <title>Example of the using the fluent interface</title>

            <programlisting role="php"><![CDATA[<?php
$select = $db->select()
    ->from( ...specify table and columns... )
    ->where( ...specify search criteria... )
    ->order( ...specify sorting criteria... );]]>
            </programlisting>

        </example>

        <para>
            The examples in this section show usage of the fluent interface, but you can use the
            non-fluent interface in all cases. It is often necessary to use the non-fluent
            interface, for example, if your application needs to perform some logic before adding a
            clause to a query.
        </para>

        <sect3 id="zend.db.select.building.from">

            <title>Adding a FROM clause</title>

            <para>
                Specify the table for this query using the <code>from()</code> method. You can
                specify the table name as a simple string. Zend_Db_Select applies identifier
                quoting around the table name, so you can use special characters.
            </para>

            <example id="zend.db.select.building.from.example">

                <title>Example of the from() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT *
//   FROM "products"

$select = $db->select()
    ->from( 'products' );]]>
                </programlisting>

            </example>

            <para>
                You can also specify the correlation name (sometimes called the "table alias") for
                a table. Instead of a simple string, use an associative array mapping the
                correlation name to the table name. In other clauses of the SQL query, use this
                correlation name. If your query joins more than one table, Zend_Db_Select generates
                unique correlation names based on the table names, for any tables for which you
                don't specify the correlation name.
            </para>

            <example id="zend.db.select.building.from.example-cname">

                <title>Example of specifying a table correlation name</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p.*
//   FROM "products" AS p

$select = $db->select()
    ->from( array('p' => 'products') );]]>
                </programlisting>

            </example>

            <para>
                Some RDBMS brands support a leading schema specifier for a table. You can specify
                the table name as "<code>schemaName.tableName</code>", where Zend_Db_Select quotes
                each part individually, or you may specify the schema name separately. A schema
                name specified in the table name takes precedence over a schema provided separately
                in the event that both are provided.
            </para>

            <example id="zend.db.select.building.from.example-schema">

                <title>Example of specifying a schema name</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT *
//   FROM "myschema"."products"

$select = $db->select()
    ->from( 'myschema.products' );

// or

$select = $db->select()
    ->from('products', '*', 'myschema');]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.building.columns">

            <title>Adding Columns</title>

            <para>
                In the second argument of the <code>from()</code> method, you can specify the
                columns to select from the respective table. If you specify no columns, the default
                is "<code>*</code>", the SQL wildcard for "all columns".
            </para>

            <para>
                You can list the columns in a simple array of strings, or as an associative mapping
                of column alias to column name. If you only have one column to query, and you don't
                need to specify a column alias, you can list it as a plain string instead of an
                array.
            </para>

            <para>
                If you give an empty array as the columns argument, no columns from the respective
                table are included in the result set. See a
                <link linkend="zend.db.select.building.join.example-no-columns">code example</link>
                under the section on the <code>join()</code> method.
            </para>

            <para>
                You can specify the column name as "<code>correlationName.columnName</code>".
                Zend_Db_Select quotes each part individually. If you don't specify a correlation
                name for a column, it uses the correlation name for the table named in the current
                <code>from()</code> method.
            </para>

            <example id="zend.db.select.building.columns.example">

                <title>Examples of specifying columns</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", p."product_name"
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id', 'product_name'));

// Build the same query, specifying correlation names:
//   SELECT p."product_id", p."product_name"
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'),
        array('p.product_id', 'p.product_name'));

// Build this query with an alias for one column:
//   SELECT p."product_id" AS prodno, p."product_name"
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'),
        array('prodno' => 'product_id', 'product_name'));]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.building.columns-expr">

            <title>Adding Expression Columns</title>

            <para>
                Columns in SQL queries are sometimes expressions, not simply column names from a
                table. Expressions should not have correlation names or quoting applied. If your
                column string contains parentheses, Zend_Db_Select recognizes it as an expression.
            </para>

            <para>
                You also can create an object of type Zend_Db_Expr explicitly, to prevent a string
                from being treated as a column name. Zend_Db_Expr is a minimal class that contains
                a single string. Zend_Db_Select recognizes objects of type Zend_Db_Expr and
                converts them back to string, but does not apply any alterations, such as quoting
                or correlation names.
            </para>

            <note>

                <para>
                    Using Zend_Db_Expr for column names is not necessary if your column expression
                    contains parentheses; Zend_Db_Select recognizes parentheses and treats the
                    string as an expression, skipping quoting and correlation names.
                </para>

            </note>

            <example id="zend.db.select.building.columns-expr.example">

                <title>Examples of specifying columns containing expressions</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", LOWER(product_name)
//   FROM "products" AS p
// An expression with parentheses implicitly becomes
// a Zend_Db_Expr.

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id', 'LOWER(product_name)'));

// Build this query:
//   SELECT p."product_id", (p.cost * 1.08) AS cost_plus_tax
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id', 'cost_plus_tax' => '(p.cost * 1.08)'));

// Build this query using Zend_Db_Expr explicitly:
//   SELECT p."product_id", p.cost * 1.08 AS cost_plus_tax
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id', 'cost_plus_tax' => new Zend_Db_Expr('p.cost * 1.08')));]]>
                </programlisting>

            </example>

            <para>
                In the cases above, Zend_Db_Select does not alter the string to apply correlation
                names or identifier quoting. If those changes are necessary to resolve ambiguity,
                you must make the changes manually in the string.
            </para>

            <para>
                If your column names are SQL keywords or contain special characters, you should use
                the Adapter's <code>quoteIdentifier()</code> method and interpolate the result into
                the string. The <code>quoteIdentifier()</code> method uses SQL quoting to delimit
                the identifier, which makes it clear that it is an identifier for a table or a
                column, and not any other part of SQL syntax.
            </para>

            <para>
                Your code is more database-independent if you use the
                <code>quoteIdentifier()</code> method instead of typing quotes literally in your
                string, because some RDBMS brands use nonstandard symbols for quoting identifiers.
                The <code>quoteIdentifier()</code> method is designed to use the appropriate
                quoting symbols based on the adapter type. The <code>quoteIdentifier()</code>
                method also escapes any quote characters that appear within the identifier name
                itself.
            </para>

            <example id="zend.db.select.building.columns-quoteid.example">

                <title>Examples of quoting columns in an expression</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query, quoting a special column name "from" in the expression:
//   SELECT p."from" + 10 AS origin
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'),
        array('origin' => '(p.' . $db->quoteIdentifier('from') . ' + 10)'));]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.building.columns-atomic">

            <title>Adding columns to an existing FROM or JOIN table</title>

            <para>
                There may be cases where you wish to add columns to an existing FROM or JOIN table
                after those methods have been called. The <code>columns()</code> method allows you
                to add specific columns at any point before the query is executed. You can supply
                the columns as either a string or <code>Zend_Db_Expr</code> or as an array of these
                elements. The second argument to this method can be omitted, implying that the
                columns are to be added to the FROM table, otherwise an existing correlation name
                must be used.
            </para>

            <example id="zend.db.select.building.columns-atomic.example">

                <title>Examples of adding columns with the <code>columns()</code> method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", p."product_name"
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'), 'product_id')
    ->columns('product_name');

// Build the same query, specifying correlation names:
//   SELECT p."product_id", p."product_name"
//   FROM "products" AS p

$select = $db->select()
    ->from(array('p' => 'products'), 'p.product_id')
    ->columns('product_name', 'p'); // Alternatively use columns('p.product_name')]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.building.join">

            <title>Adding Another Table to the Query with JOIN</title>

            <para>
                Many useful queries involve using a <code>JOIN</code> to combine rows from multiple
                tables. You can add tables to a Zend_Db_Select query using the <code>join()</code>
                method. Using this method is similar to the <code>from()</code> method, except you
                can also specify a join condition in most cases.
            </para>

            <example id="zend.db.select.building.join.example">

                <title>Example of the join() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", p."product_name", l.*
//   FROM "products" AS p JOIN "line_items" AS l
//     ON p.product_id = l.product_id

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id', 'product_name'))
    ->join(array('l' => 'line_items'),
        'p.product_id = l.product_id');]]>
                </programlisting>

            </example>

            <para>
                The second argument to <code>join()</code> is a string that is the join condition.
                This is an expression that declares the criteria by which rows in one table match
                rows in the the other table. You can use correlation names in this expression.
            </para>

            <note>

                <para>
                    No quoting is applied to the expression you specify for the join condition; if
                    you have column names that need to be quoted, you must use
                    <code>quoteIdentifier()</code> as you form the string for the join condition.
                </para>

            </note>

            <para>
                The third argument to <code>join()</code> is an array of column names, like that
                used in the <code>from()</code> method. It defaults to "<code>*</code>", supports
                correlation names, expressions, and Zend_Db_Expr in the same way as the array of
                column names in the <code>from()</code> method.
            </para>

            <para>
                To select no columns from a table, use an empty array for the list of columns. This
                usage works in the <code>from()</code> method too, but typically you want some
                columns from the primary table in your queries, whereas you might want no columns
                from a joined table.
            </para>

            <example id="zend.db.select.building.join.example-no-columns">

                <title>Example of specifying no columns</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", p."product_name"
//   FROM "products" AS p JOIN "line_items" AS l
//     ON p.product_id = l.product_id

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id', 'product_name'))
    ->join(array('l' => 'line_items'),
        'p.product_id = l.product_id',
        array() ); // empty list of columns]]>
                </programlisting>

                <para>
                    Note the empty <code>array()</code> in the above example in place of a list of
                    columns from the joined table.
                </para>

            </example>

            <para>
                SQL has several types of joins. See the list below for the methods to support
                different join types in Zend_Db_Select.
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <command>INNER JOIN</command> with the
                        <code>join(table, join, [columns])</code> or
                        <code>joinInner(table, join, [columns])</code> methods.
                    </para>

                    <para>
                        This may be the most common type of join. Rows from each table are compared
                        using the join condition you specify. The result set includes only the rows
                        that satisfy the join condition. The result set can be empty if no rows
                        satisfy this condition.
                    </para>

                    <para>
                        All RDBMS brands support this join type.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <command>LEFT JOIN</command> with the
                        <code>joinLeft(table, condition, [columns])</code> method.
                    </para>

                    <para>
                        All rows from the left operand table are included, matching rows from the
                        right operand table included, and the columns from the right operand table
                        are filled with NULLs if no row exists matching the left table.
                    </para>

                    <para>
                        All RDBMS brands support this join type.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <command>RIGHT JOIN</command> with the
                        <code>joinRight(table, condition, [columns])</code> method.
                    </para>

                    <para>
                        Right outer join is the complement of left outer join. All rows from the
                        right operand table are included, matching rows from the left operand table
                        included, and the columns from the left operand table are filled with NULLs
                        if no row exists matching the right table.
                    </para>

                    <para>
                        Some RDBMS brands don't support this join type, but in general any right
                        join can be represented as a left join by reversing the order of the
                        tables.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <command>FULL JOIN</command> with the
                        <code>joinFull(table, condition, [columns])</code> method.
                    </para>

                    <para>
                        A full outer join is like combining a left outer join and a right outer
                        join. All rows from both tables are included, paired with each other on the
                        same row of the result set if they satisfy the join condition, and
                        otherwise paired with NULLs in place of columns from the other table.
                    </para>

                    <para>
                        Some RDBMS brands don't support this join type.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <command>CROSS JOIN</command> with the
                        <code>joinCross(table, [columns])</code> method.
                    </para>

                    <para>
                        A cross join is a Cartesian product. Every row in the first table is
                        matched to every row in the second table. Therefore the number of rows in
                        the result set is equal to the product of the number of rows in each table.
                        You can filter the result set using conditions in a WHERE clause; in this
                        way a cross join is similar to the old SQL-89 join syntax.
                    </para>

                    <para>
                        The <code>joinCross()</code> method has no parameter to specify the join
                        condition. Some RDBMS brands don't support this join type.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <command>NATURAL JOIN</command> with the
                        <code>joinNatural(table, [columns])</code> method.
                    </para>

                    <para>
                        A natural join compares any column(s) that appear with the same name in
                        both tables. The comparison is equality of all the column(s); comparing the
                        columns using inequality is not a natural join. Only natural inner joins
                        are supported by this API, even though SQL permits natural outer joins as
                        well.
                    </para>

                    <para>
                        The <code>joinNatural()</code> method has no parameter to specify the join
                        condition.
                    </para>
                </listitem>
            </itemizedlist>

            <para>
                In addition to these join methods, you can simplify your queries by using the
                JoinUsing methods. Instead of supplying a full condition to your join, you simply
                pass the column name on which to join and the Zend_Db_Select object completes the
                condition for you.
            </para>

            <example id="zend.db.select.building.joinusing.example">

                <title>Example of the joinUsing() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT *
//   FROM "table1"
//   JOIN "table2"
//   ON "table1".column1 = "table2".column1
//   WHERE column2 = 'foo'

$select = $db->select()
    ->from('table1')
    ->joinUsing('table2', 'column1')
    ->where('column2 = ?', 'foo');]]>
                </programlisting>

            </example>

            <para>
                Each of the applicable join methods in the Zend_Db_Select component has a
                corresponding 'using' method.
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <code>joinUsing(table, join, [columns])</code> and
                        <code>joinInnerUsing(table, join, [columns])</code>
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>joinLeftUsing(table, join, [columns])</code>
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>joinRightUsing(table, join, [columns])</code>
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>joinFullUsing(table, join, [columns])</code>
                    </para>
                </listitem>
            </itemizedlist>

        </sect3>

        <sect3 id="zend.db.select.building.where">

            <title>Adding a WHERE Clause</title>

            <para>
                You can specify criteria for restricting rows of the result set using the
                <code>where()</code> method. The first argument of this method is a SQL expression,
                and this expression is used in a SQL <code>WHERE</code> clause in the query.
            </para>

            <example id="zend.db.select.building.where.example">

                <title>Example of the where() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT product_id, product_name, price
//   FROM "products"
//   WHERE price > 100.00

$select = $db->select()
    ->from(
        'products',
        array('product_id', 'product_name', 'price'))
    ->where('price > 100.00');]]>
                </programlisting>

            </example>

            <note>

                <para>
                    No quoting is applied to expressions given to the <code>where()</code> or
                    <code>orWhere()</code> methods. If you have column names that need to be
                    quoted, you must use <code>quoteIdentifier()</code> as you form the string for
                    the condition.
                </para>

            </note>

            <para>
                The second argument to the <code>where()</code> method is optional. It is a value
                to substitute into the expression. Zend_Db_Select quotes the value and substitutes
                it for a question-mark ("<code>?</code>") symbol in the expression.
            </para>

            <para>
                This method accepts only one parameter. If you have an expression into which you
                need to substitute multiple variables, you must format the string manually,
                interpolating variables and performing quoting yourself.
            </para>

            <example id="zend.db.select.building.where.example-param">

                <title>Example of a parameter in the where() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT product_id, product_name, price
//   FROM "products"
//   WHERE (price > 100.00)

$minimumPrice = 100;

$select = $db->select()
    ->from(
        'products',
        array('product_id', 'product_name', 'price'))
    ->where('price > ?', $minimumPrice);]]>
                </programlisting>

            </example>

            <para>
                You can invoke the <code>where()</code> method multiple times on the same
                Zend_Db_Select object. The resulting query combines the multiple terms together
                using <code>AND</code> between them.
            </para>

            <example id="zend.db.select.building.where.example-and">

                <title>Example of multiple where() methods</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT product_id, product_name, price
//   FROM "products"
//   WHERE (price > 100.00)
//     AND (price < 500.00)

$minimumPrice = 100;
$maximumPrice = 500;

$select = $db->select()
    ->from('products',
        array('product_id', 'product_name', 'price'))
    ->where('price > ?', $minimumPrice)
    ->where('price < ?', $maximumPrice);]]>
                </programlisting>

            </example>

            <para>
                If you need to combine terms together using <code>OR</code>, use the
                <code>orWhere()</code> method. This method is used in the same way as the
                <code>where()</code> method, except that the term specified is preceded by
                <code>OR</code>, instead of <code>AND</code>.
            </para>

            <example id="zend.db.select.building.where.example-or">

                <title>Example of the orWhere() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT product_id, product_name, price
//   FROM "products"
//   WHERE (price < 100.00)
//     OR (price > 500.00)

$minimumPrice = 100;
$maximumPrice = 500;

$select = $db->select()
    ->from('products',
        array('product_id', 'product_name', 'price'))
    ->where('price < ?', $minimumPrice)
    ->orWhere('price > ?', $maximumPrice);]]>
                </programlisting>

            </example>

            <para>
                Zend_Db_Select automatically puts parentheses around each expression you specify
                using the <code>where()</code> or <code>orWhere()</code> methods. This helps to
                ensure that Boolean operator precedence does not cause unexpected results.
            </para>

            <example id="zend.db.select.building.where.example-parens">

                <title>Example of parenthesizing Boolean expressions</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT product_id, product_name, price
//   FROM "products"
//   WHERE (price < 100.00 OR price > 500.00)
//     AND (product_name = 'Apple')

$minimumPrice = 100;
$maximumPrice = 500;
$prod = 'Apple';

$select = $db->select()
    ->from('products',
        array('product_id', 'product_name', 'price'))
    ->where("price < $minimumPrice OR price > $maximumPrice")
    ->where('product_name = ?', $prod);]]>
                </programlisting>

            </example>

            <para>
                In the example above, the results would be quite different without the parentheses,
                because <code>AND</code> has higher precedence than <code>OR</code>. Zend_Db_Select
                applies the parentheses so the effect is that each expression in successive calls
                to the <code>where()</code> bind more tightly than the <code>AND</code> that
                combines the expressions.
            </para>

        </sect3>

        <sect3 id="zend.db.select.building.group">

            <title>Adding a GROUP BY Clause</title>

            <para>
                In SQL, the <code>GROUP BY</code> clause allows you to reduce the rows of a query
                result set to one row per unique value found in the column(s) named in the
                <code>GROUP BY</code> clause.
            </para>

            <para>
                In Zend_Db_Select, you can specify the column(s) to use for calculating the groups
                of rows using the <code>group()</code> method. The argument to this method is a
                column or an array of columns to use in the <code>GROUP BY</code> clause.
            </para>

            <example id="zend.db.select.building.group.example">

                <title>Example of the group() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", COUNT(*) AS line_items_per_product
//   FROM "products" AS p JOIN "line_items" AS l
//     ON p.product_id = l.product_id
//   GROUP BY p.product_id

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id'))
    ->join(array('l' => 'line_items'),
        'p.product_id = l.product_id',
        array('line_items_per_product' => 'COUNT(*)'))
    ->group('p.product_id');]]>
                </programlisting>

            </example>

            <para>
                Like the columns array in the <code>from()</code> method, you can use correlation
                names in the column name strings, and the column is quoted as an identifier unless
                the string contains parentheses or is an object of type Zend_Db_Expr.
            </para>

        </sect3>

        <sect3 id="zend.db.select.building.having">

            <title>Adding a HAVING Clause</title>

            <para>
                In SQL, the <code>HAVING</code> clause applies a restriction condition on groups of
                rows. This is similar to how a <code>WHERE</code> clause applies a restriction
                condition on rows. But the two clauses are different because <code>WHERE</code>
                conditions are applied before groups are defined, whereas <code>HAVING</code>
                conditions are applied after groups are defined.
            </para>

            <para>
                In Zend_Db_Select, you can specify conditions for restricting groups using the
                <code>having()</code> method. Its usage is similar to that of the
                <code>where()</code> method. The first argument is a string containing a SQL
                expression. The optional second argument is a value that is used to replace a
                positional parameter placeholder in the SQL expression. Expressions given in
                multiple invocations of the <code>having()</code> method are combined using the
                Boolean <code>AND</code> operator, or the <code>OR</code> operator if you use the
                <code>orHaving()</code> method.
            </para>

            <example id="zend.db.select.building.having.example">

                <title>Example of the having() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", COUNT(*) AS line_items_per_product
//   FROM "products" AS p JOIN "line_items" AS l
//     ON p.product_id = l.product_id
//   GROUP BY p.product_id
//   HAVING line_items_per_product > 10

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id'))
    ->join(array('l' => 'line_items'),
        'p.product_id = l.product_id',
        array('line_items_per_product' => 'COUNT(*)'))
    ->group('p.product_id')
    ->having('line_items_per_product > 10');]]>
                </programlisting>

            </example>

            <note>

                <para>
                    No quoting is applied to expressions given to the <code>having()</code> or
                    <code>orHaving()</code> methods. If you have column names that need to be
                    quoted, you must use <code>quoteIdentifier()</code> as you form the string for
                    the condition.
                </para>

            </note>

        </sect3>

        <sect3 id="zend.db.select.building.order">

            <title>Adding an ORDER BY Clause</title>

            <para>
                In SQL, the <code>ORDER BY</code> clause specifies one or more columns or
                expressions by which the result set of a query is sorted. If multiple columns are
                listed, the secondary columns are used to resolve ties; the sort order is
                determined by the secondary columns if the preceding columns contain identical
                values. The default sorting is from least value to greatest value. You can also
                sort by greatest value to least value for a given column in the list by specifying
                the keyword <code>DESC</code> after that column.
            </para>

            <para>
                In Zend_Db_Select, you can use the <code>order()</code> method to specify a column
                or an array of columns by which to sort. Each element of the array is a string
                naming a column. optionally with the <code>ASC</code> <code>DESC</code> keyword
                following it, separated by a space.
            </para>

            <para>
                Like in the <code>from()</code> and <code>group()</code> methods, column names are
                quoted as identifiers, unless they contain contain parentheses or are an object of
                type Zend_Db_Expr.
            </para>

            <example id="zend.db.select.building.order.example">

                <title>Example of the order() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", COUNT(*) AS line_items_per_product
//   FROM "products" AS p JOIN "line_items" AS l
//     ON p.product_id = l.product_id
//   GROUP BY p.product_id
//   ORDER BY "line_items_per_product" DESC, "product_id"

$select = $db->select()
    ->from(array('p' => 'products'),
        array('product_id'))
    ->join(array('l' => 'line_items'),
        'p.product_id = l.product_id',
        array('line_items_per_product' => 'COUNT(*)'))
    ->group('p.product_id')
    ->order(array('line_items_per_product DESC', 'product_id'));]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.building.limit">

            <title>Adding a LIMIT Clause</title>

            <para>
                Some RDBMS brands extend SQL with a query clause known as the <code>LIMIT</code>
                clause. This clause reduces the number of rows in the result set to at most a
                number you specify. You can also specify to skip a number of rows before starting
                to output. This feature makes it easy to take a subset of a result set, for example
                when displaying query results on progressive pages of output.
            </para>

            <para>
                In Zend_Db_Select, you can use the <code>limit()</code> method to specify the count
                of rows and the number of rows to skip. The first argument to this method is the
                desired count of rows. The second argument is the number of rows to skip.
            </para>

            <example id="zend.db.select.building.limit.example">

                <title>Example of the limit() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", p."product_name"
//   FROM "products" AS p
//   LIMIT 10, 20

$select = $db->select()
    ->from(array('p' => 'products'), array('product_id', 'product_name'))
    ->limit(10, 20);]]>
                </programlisting>

            </example>

            <note>

                <para>
                    The <code>LIMIT</code> syntax is not supported by all RDBMS brands. Some RDBMS
                    require different syntax to support similar functionality. Each
                    Zend_Db_Adapter_Abstract class includes a method to produce SQL appropriate for
                    that RDBMS.
                </para>

            </note>

            <para>
                Use the <code>limitPage()</code> method for an alternative way to specify row count
                and offset. This method allows you to limit the result set to one of a series of
                fixed-length subsets of rows from the query's total result set. In other words, you
                specify the length of a "page" of results, and the ordinal number of the single
                page of results you want the query to return. The page number is the first argument
                of the <code>limitPage()</code> method, and the page length is the second argument.
                Both arguments are required; they have no default values.
            </para>

            <example id="zend.db.select.building.limit.example2">

                <title>Example of the limitPage() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p."product_id", p."product_name"
//   FROM "products" AS p
//   LIMIT 10, 20

$select = $db->select()
    ->from(array('p' => 'products'), array('product_id', 'product_name'))
    ->limitPage(2, 10);]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.building.distinct">

            <title>Adding the DISTINCT Query Modifier</title>

            <para>
                The <code>distinct()</code> method enables you to add the <code>DISTINCT</code>
                keyword to your SQL query.
            </para>

            <example id="zend.db.select.building.distinct.example">

                <title>Example of the distinct() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT DISTINCT p."product_name"
//   FROM "products" AS p

$select = $db->select()
    ->distinct()
    ->from(array('p' => 'products'), 'product_name');]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.building.for-update">

            <title>Adding the FOR UPDATE Query Modifier</title>

            <para>
                The <code>forUpdate()</code> method enables you to add the <code>FOR UPDATE</code>
                modifier to your SQL query.
            </para>

            <example id="zend.db.select.building.for-update.example">

                <title>Example of forUpdate() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT FOR UPDATE p.*
//   FROM "products" AS p

$select = $db->select()
    ->forUpdate()
    ->from(array('p' => 'products'));]]>
                </programlisting>

            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.db.select.execute">

        <title>Executing Select Queries</title>

        <para>
            This section describes how to execute the query represented by a Zend_Db_Select object.
        </para>

        <sect3 id="zend.db.select.execute.query-adapter">

            <title>Executing Select Queries from the Db Adapter</title>

            <para>
                You can execute the query represented by the Zend_Db_Select object by passing it as
                the first argument to the <code>query()</code> method of a Zend_Db_Adapter_Abstract
                object. Use the Zend_Db_Select objects instead of a string query.
            </para>

            <para>
                The <code>query()</code> method returns an object of type Zend_Db_Statement or
                PDOStatement, depending on the adapter type.
            </para>

            <example id="zend.db.select.execute.query-adapter.example">

                <title>Example using the Db adapter's query() method</title>

                <programlisting role="php"><![CDATA[<?php
$select = $db->select()
  ->from('products');

$stmt = $db->query($select);
$result = $stmt->fetchAll();]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.execute.query-select">

            <title>Executing Select Queries from the Object</title>

            <para>
                As an alternative to using the <code>query()</code> method of the adapter object,
                you can use the <code>query()</code> method of the Zend_Db_Select object. Both
                methods return an object of type Zend_Db_Statement or PDOStatement, depending on
                the adapter type.
            </para>

            <example id="zend.db.select.execute.query-select.example">

                <title>Example using the Select object's query method</title>

                <programlisting role="php"><![CDATA[<?php
$select = $db->select()
    ->from('products');

$stmt = $select->query();
$result = $stmt->fetchAll();]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.execute.tostring">

            <title>Converting a Select Object to a SQL String</title>

            <para>
                If you need access to a string representation of the SQL query corresponding to the
                Zend_Db_Select object, use the <code>__toString()</code> method.
            </para>

            <example id="zend.db.select.execute.tostring.example">

                <title>Example of the __toString() method</title>

                <programlisting role="php"><![CDATA[<?php
$select = $db->select()
    ->from('products');

$sql = $select->__toString();
echo "$sql\n";

// The output is the string:
//   SELECT * FROM "products"]]>
                </programlisting>

            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.db.select.other">

        <title>Other methods</title>

        <para>
            This section describes other methods of the Zend_Db_Select class that are not covered
            above: <code>getPart()</code> and <code>reset()</code>.
        </para>

        <sect3 id="zend.db.select.other.get-part">

            <title>Retrieving Parts of the Select Object</title>

            <para>
                The <code>getPart()</code> method returns a representation of one part of your SQL
                query. For example, you can use this method to return the array of expressions for
                the <code>WHERE</code> clause, or the array of columns (or column expressions) that
                are in the <code>SELECT</code> list, or the values of the count and offset for the
                <code>LIMIT</code> clause.
            </para>

            <para>
                The return value is not a string containing a fragment of SQL syntax. The return
                value is an internal representation, which is typically an array structure
                containing values and expressions. Each part of the query has a different
                structure.
            </para>

            <para>
                The single argument to the <code>getPart()</code> method is a string that
                identifies which part of the Select query to return. For example, the string
                <code>'from'</code> identifies the part of the Select object that stores
                information about the tables in the <code>FROM</code> clause, including joined
                tables.
            </para>

            <para>
                The Zend_Db_Select class defines constants you can use for parts of the SQL query.
                You can use these constant definitions, or you can the literal strings.
            </para>

            <table id="zend.db.select.other.get-part.table">

                <title>Constants used by getPart() and reset()</title>

                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>Constant</entry>
                            <entry>String value</entry>
                        </row>
                    </thead>

                    <tbody>
                        <row>
                            <entry><code>Zend_Db_Select::DISTINCT</code></entry>
                            <entry><code>'distinct'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::FOR_UPDATE</code></entry>
                            <entry><code>'forupdate'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::COLUMNS</code></entry>
                            <entry><code>'columns'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::FROM</code></entry>
                            <entry><code>'from'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::WHERE</code></entry>
                            <entry><code>'where'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::GROUP</code></entry>
                            <entry><code>'group'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::HAVING</code></entry>
                            <entry><code>'having'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::ORDER</code></entry>
                            <entry><code>'order'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::LIMIT_COUNT</code></entry>
                            <entry><code>'limitcount'</code></entry>
                        </row>

                        <row>
                            <entry><code>Zend_Db_Select::LIMIT_OFFSET</code></entry>
                            <entry><code>'limitoffset'</code></entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>

            <example id="zend.db.select.other.get-part.example">

                <title>Example of the getPart() method</title>

                <programlisting role="php"><![CDATA[<?php
$select = $db->select()
    ->from('products')
    ->order('product_id');

// You can use a string literal to specify the part
$orderData = $select->getPart( 'order' );

// You can use a constant to specify the same part
$orderData = $select->getPart( Zend_Db_Select::ORDER );

// The return value may be an array structure, not a string.
// Each part has a different structure.
print_r( $orderData );]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.select.other.reset">

            <title>Resetting Parts of the Select Object</title>

            <para>
                The <code>reset()</code> method enables you to clear one specified part of the SQL
                query, or else clear all parts of the SQL query if you omit the argument.
            </para>

            <para>
                The single argument is optional. You can specify the part of the query to clear,
                using the same strings you used in the argument to the <code>getPart()</code>
                method. The part of the query you specify is reset to a default state.
            </para>

            <para>
                If you omit the parameter, <code>reset()</code> changes all parts of the query to
                their default state. This makes the Zend_Db_Select object equivalent to a new
                object, as though you had just instantiated it.
            </para>

            <example id="zend.db.select.other.reset.example">

                <title>Example of the reset() method</title>

                <programlisting role="php"><![CDATA[<?php
// Build this query:
//   SELECT p.*
//   FROM "products" AS p
//   ORDER BY "product_name"

$select = $db->select()
    ->from(array('p' => 'products')
    ->order('product_name');

// Changed requirement, instead order by a different columns:
//   SELECT p.*
//   FROM "products" AS p
//   ORDER BY "product_id"

// Clear one part so we can redefine it
$select->reset( Zend_Db_Select::ORDER );

// And specify a different column
$select->order('product_id');

// Clear all parts of the query
$select->reset();]]>
                </programlisting>

            </example>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.db.statement">

    <title>Zend_Db_Statement</title>

    <para>
        In addition to convenient methods such as <code>fetchAll()</code> and
        <code>insert()</code> documented in <xref linkend="zend.db.adapter" />,
        you can use a statement object to gain more options for running
        queries and fetching result sets.  This section describes how to get an
        instance of a statement object, and how to use its methods.
    </para>

    <para>
        Zend_Db_Statement is based on the PDOStatement object in the
        <ulink url="http://www.php.net/pdo">PHP Data Objects</ulink> extension.
    </para>

    <sect2 id="zend.db.statement.creating">

        <title>Creating a Statement</title>

        <para>
            Typically, a statement object is returned by the
            <code>query()</code> method of the database Adapter class.
            This method is a general way to prepare any SQL statement.
            The first argument is a string containing an SQL statement.
            The optional second argument is an array of values to bind
            to parameter placeholders in the SQL string.
        </para>

        <example id="zend.db.statement.creating.example1">
            <title>Creating a SQL statement object with query()</title>
            <programlisting role="php"><![CDATA[<?php
$stmt = $db->query('SELECT * FROM bugs WHERE reported_by = ? AND bug_status = ?',
                array('goofy', 'FIXED'));]]>
            </programlisting>
        </example>

        <para>
            The statement object corresponds to a SQL statement that has been
            prepared, and executed once with the bind-values specified.
            If the statement was a SELECT query or other type of statement
            that returns a result set, it is now ready to fetch results.
        </para>

        <para>
            You can create a statement with its contructor, but this is less
            typical usage.  There is no factory method to create this object,
            so you need to load the specific statement class and call its
            constructor.  Pass the Adapter object as the first argument, and
            a string containing an SQL statement as the second argument.
            The statement is prepared, but not executed.
        </para>

        <example id="zend.db.statement.creating.example2">
            <title>Using a SQL statement constructor</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Db/Statement/Mysqli.php';

$sql = 'SELECT * FROM bugs WHERE reported_by = ? AND bug_status = ?';

$stmt = new Zend_Db_Statement_Mysqli($db, $sql);]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.db.statement.executing">

        <title>Executing a Statement</title>

        <para>
            You need to execute a statement object if you create it using its
            constructor, or if you want to execute the same statement multiple
            times.  Use the <code>execute()</code> method of the statement
            object.  The single argument is an array of value to bind to
            parameter placeholders in the statement.
        </para>

        <para>
            If you use <emphasis>positional parameters</emphasis>, or those
            that are marked with a question mark symbol (<code>?</code>), pass
            the bind values in a plain array.
        </para>

        <example id="zend.db.statement.executing.example1">
            <title>Executing a statement with positional parameters</title>
            <programlisting role="php"><![CDATA[<?php
$sql = 'SELECT * FROM bugs WHERE reported_by = ? AND bug_status = ?';

$stmt = new Zend_Db_Statement_Mysqli($db, $sql);

$stmt->execute(array('goofy', 'FIXED'));]]>
            </programlisting>
        </example>

        <para>
            If you use <emphasis>named parameters</emphasis>, or those that are
            indicated by a string identifier preceded by a colon character
            (<code>:</code>), pass the bind values in an associative array.
            The keys of this array should match the parameter names.
        </para>

        <example id="zend.db.statement.executing.example2">
            <title>Executing a statement with named parameters</title>
            <programlisting role="php"><![CDATA[<?php
$sql = 'SELECT * FROM bugs WHERE reported_by = :reporter AND bug_status = :status';

$stmt = new Zend_Db_Statement_Mysqli($db, $sql);

$stmt->execute(array(':reporter' => 'goofy', ':status' => 'FIXED'));]]>
            </programlisting>
        </example>

        <para>
            PDO statements support both positional parameters and named
            parameters, but not both types in a single SQL statement.  Some of
            the Zend_Db_Statement classes for non-PDO extensions may support
            only one type of parameter or the other.
        </para>

    </sect2>

    <sect2 id="zend.db.statement.fetching">

        <title>Fetching Results from a <code>SELECT</code> Statement</title>

        <para>
            You can call methods on the statement object to retrieve rows from
            SQL statements that produce result set.  SELECT, SHOW, DESCRIBE and
            EXPLAIN are examples of statements that produce a result set.
            INSERT, UPDATE, and DELETE are examples of statements that don't
            produce a result set.  You can execute the latter SQL statements
            using Zend_Db_Statement, but you cannot call methods to fetch rows
            of results from them.
        </para>

        <sect3 id="zend.db.statement.fetching.fetch">

            <title>Fetching a Single Row from a Result Set</title>

            <para>
                To retrieve one row from the result set, use the
                <code>fetch()</code> method of the statement object.
                All three arguments of this method are optional:
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <emphasis role="strong">Fetch style</emphasis> is the
                        first argument.  This controls the structure in which
                        the row is returned.
                        See <xref linkend="zend.db.adapter.select.fetch-mode" />
                        for a description of the valid values and the
                        corresponding data formats.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Cursor orientation</emphasis>
                        is the second argument.  The default is
                        Zend_Db::FETCH_ORI_NEXT, which simply means that each
                        call to <code>fetch()</code> returns the next row in
                        the result set, in the order returned by the RDBMS.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Offset</emphasis> is the third
                        argument.
                        If the cursor orientation is Zend_Db::FETCH_ORI_ABS,
                        then the offset number is the ordinal number of the row
                        to return.
                        If the cursor orientation is Zend_Db::FETCH_ORI_REL,
                        then the offset number is relative to the cursor
                        position before <code>fetch()</code> was called.
                    </para>
                </listitem>
            </itemizedlist>

            <para>
                <code>fetch()</code> returns <code>false</code> if all rows of
                the result set have been fetched.
            </para>

            <example id="zend.db.statement.fetching.fetch.example">
                <title>Using fetch() in a loop</title>
                <programlisting role="php"><![CDATA[<?php
$stmt = $db->query('SELECT * FROM bugs');

while ($row = $stmt->fetch()) {
    echo $row['bug_description'];
}]]>
                </programlisting>
            </example>

            <para>
                See also <ulink url="http://www.php.net/PDOStatement-fetch">PDOStatement::fetch()</ulink>.
            </para>

        </sect3>

        <sect3 id="zend.db.statement.fetching.fetchall">

            <title>Fetching a Complete Result Set</title>

            <para>
                To retrieve all the rows of the result set in one step, use the
                <code>fetchAll()</code> method.  This is equivalent to calling
                the <code>fetch()</code> method in a loop and returning all
                the rows in an array.  The <code>fetchAll()</code> method accepts
                two arguments.  The first is the fetch style, as described above,
                and the second indicates the number of the column to return,
                when the fetch style is Zend_Db::FETCH_COLUMN.
            </para>

            <example id="zend.db.statement.fetching.fetchall.example">
                <title>Using fetchAll()</title>
                <programlisting role="php"><![CDATA[<?php
$stmt = $db->query('SELECT * FROM bugs');

$rows = $stmt->fetchAll();

echo $rows[0]['bug_description'];]]>
                </programlisting>
            </example>

            <para>
                See also <ulink url="http://www.php.net/PDOStatement-fetchAll">PDOStatement::fetchAll()</ulink>.
            </para>

        </sect3>

        <sect3 id="zend.db.statement.fetching.fetch-mode">

            <title>Changing the Fetch Mode</title>

            <para>
                By default, the statement object returns rows of the result set
                as associative arrays, mapping column names to column values.
                You can specify a different format for the statement class to
                return rows, just as you can in the Adapter class.  You can use
                the <code>setFetchMode()</code> method of the statement object
                to specify the fetch mode.  Specify the fetch mode using
                Zend_Db class constants FETCH_ASSOC, FETCH_NUM, FETCH_BOTH,
                FETCH_COLUMN, and FETCH_OBJ.
                See <xref linkend="zend.db.adapter.select.fetch-mode" />
                for more information on these modes.
                Subsequent calls to the statement methods <code>fetch()</code>
                or <code>fetchAll()</code> use the fetch mode that you specify.
            </para>

            <example id="zend.db.statement.fetching.fetch-mode.example">
                <title>Setting the fetch mode</title>
                <programlisting role="php"><![CDATA[<?php
$stmt = $db->query('SELECT * FROM bugs');

$stmt->setFetchMode(Zend_Db::FETCH_NUM);

$rows = $stmt->fetchAll();

echo $rows[0][0];]]>
                </programlisting>
            </example>

            <para>
                See also <ulink url="http://www.php.net/PDOStatement-setFetchMode">PDOStatement::setFetchMode()</ulink>.
            </para>

        </sect3>

        <sect3 id="zend.db.statement.fetching.fetchcolumn">

            <title>Fetching a Single Column from a Result Set</title>

            <para>
                To return a single column from the next row of the result set,
                use <code>fetchColumn()</code>.  The optional argument is the
                integer index of the column, and it defaults to 0.  This method
                returns a scalar value, or <code>false</code> if all rows of
                the result set have been fetched.
            </para>

            <para>
                Note this method operates differently than the
                <code>fetchCol()</code> method of the Adapter class.
                The <code>fetchColumn()</code> method of a statement returns a
                single value from one row.
                The <code>fetchCol()</code> method of an adapter returns an
                array of values, taken from the first column of all rows of the
                result set.
            </para>

            <example id="zend.db.statement.fetching.fetchcolumn.example">
                <title>Using fetchColumn()</title>
                <programlisting role="php"><![CDATA[<?php
$stmt = $db->query('SELECT bug_id, bug_description, bug_status FROM bugs');

$bug_status = $stmt->fetchColumn(2);]]>
                </programlisting>
            </example>

            <para>
                See also <ulink url="http://www.php.net/PDOStatement-fetchColumn">PDOStatement::fetchColumn()</ulink>.
            </para>

        </sect3>

        <sect3 id="zend.db.statement.fetching.fetchobject">

            <title>Fetching a Row as an Object</title>

            <para>
                To retrieve a row from the result set structured as an object,
                use the <code>fetchObject()</code>.  This method takes two
                optional arguments.  The first argument is a string that names
                the class name of the object to return; the default is
                'stdClass'.  The second argument is an array of values that
                will be passed to the constructor of that class.
            </para>

            <example id="zend.db.statement.fetching.fetchobject.example">
                <title>Using fetchObject()</title>
                <programlisting role="php"><![CDATA[<?php
$stmt = $db->query('SELECT bug_id, bug_description, bug_status FROM bugs');

$obj = $stmt->fetchObject();

echo $obj->bug_description;]]>
                </programlisting>
            </example>

            <para>
                See also <ulink url="http://www.php.net/PDOStatement-fetchObject">PDOStatement::fetchObject()</ulink>.
            </para>

        </sect3>

    </sect2>

    <!--
      @todo: binding parameters is not working yet.

    <sect2 id="zend.db.statement.binding-param">

        <title>Binding PHP Variables to Parameters</title>

        <para>
        </para>

        <example id="zend.db.statement.binding-param.example">
            <title>Binding parameters from PHP variables</title>
            <programlisting role="php"><![CDATA[<?php
]]>
            </programlisting>
        </example>

        <para>
            See also <ulink url="http://www.php.net/PDOStatement-bindParam">PDOStatement::bindParam()</ulink>.
        </para>

    </sect2>
    -->

    <!--
      @todo: binding columns is not working yet.
    <sect2 id="zend.db.statement.binding-column">

        <title>Binding PHP Variables to Query Results</title>

        <para>
        </para>

        <example id="zend.db.statement.binding-column.example">
            <title>Binding results to PHP variables</title>
            <programlisting role="php"><![CDATA[<?php
]]>
            </programlisting>
        </example>

        <para>
            See also <ulink url="http://www.php.net/PDOStatement-bindColumn">PDOStatement::bindColumn()</ulink>.
        </para>

    </sect2>
    -->

</sect1>
<sect1 id="zend.db.table.relationships">

    <title>Zend_Db_Table Relationships</title>

    <sect2 id="zend.db.table.relationships.introduction">

        <title>Introduction</title>

        <para>
            Tables have relationships to each other in a relational database. An entity in one
            table can be linked to one or more entities in another table by using referential
            integrity constraints defined in the database schema.
        </para>

        <para>
            The Zend_Db_Table_Row class has methods for querying related rows in other tables.
        </para>

    </sect2>

    <sect2 id="zend.db.table.relationships.defining">

        <title>Defining Relationships</title>

        <para>
            Define classes for each of your tables, extending the abstract class
            Zend_Db_Table_Abstract, as described in <xref linkend="zend.db.table.defining" />. Also
            see <xref linkend="zend.db.adapter.example-database" /> for a description of the
            example database for which the following example code is designed.
        </para>

        <para>
            Below are the PHP class definitions for these tables:
        </para>

        <programlisting role="php"><![CDATA[<?php
class Accounts extends Zend_Db_Table_Abstract
{
    protected $_name            = 'accounts';
    protected $_dependentTables = array('Bugs');
}

class Products extends Zend_Db_Table_Abstract
{
    protected $_name            = 'products';
    protected $_dependentTables = array('BugsProducts');
}

class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name            = 'bugs';

    protected $_dependentTables = array('BugsProducts');

    protected $_referenceMap    = array(
        'Reporter' => array(
            'columns'           => 'reported_by',
            'refTableClass'     => 'Accounts',
            'refColumns'        => 'account_name'
        ),
        'Engineer' => array(
            'columns'           => 'assigned_to',
            'refTableClass'     => 'Accounts',
            'refColumns'        => 'account_name'
        ),
        'Verifier' => array(
            'columns'           => array('verified_by'),
            'refTableClass'     => 'Accounts',
            'refColumns'        => array('account_name')
        )
    );
}

class BugsProducts extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs_products';

    protected $_referenceMap    = array(
        'Bug' => array(
            'columns'           => array('bug_id'),
            'refTableClass'     => 'Bugs',
            'refColumns'        => array('bug_id')
        ),
        'Product' => array(
            'columns'           => array('product_id'),
            'refTableClass'     => 'Products',
            'refColumns'        => array('product_id')
        )
    );

}]]>
        </programlisting>

        <para>
            If you use Zend_Db_Table to emulate cascading UPDATE and DELETE operations, declare the
            <code>$_dependentTables</code> array in the class for the parent table. List the class
            name for each dependent table. Use the class name, not the physical name of the SQL
            table.
        </para>

        <note>

            <para>
                Skip declaration of <code>$_dependentTables</code> if you use referential integrity
                constraints in the RDBMS server to implement cascading operations. See
                <xref linkend="zend.db.table.relationships.cascading" /> for more information.
            </para>

        </note>

        <para>
            Declare the <code>$_referenceMap</code> array in the class for each dependent table.
            This is an associative array of reference "rules". A reference rule identifies which
            table is the parent table in the relationship, and also lists which columns in the
            dependent table reference which columns in the parent table.
        </para>

        <para>
            The rule key is a string used as an index to the <code>$_referenceMap</code> array.
            This rule key is used to identify each reference relationship. Choose a descriptive
            name for this rule key. It's best to use a string that can be part of a PHP method
            name, as you will see later.
        </para>

        <para>
            In the example PHP code above, the rule keys in the Bugs table class are:
            <code>'Reporter'</code>, <code>'Engineer'</code>, <code>'Verifier'</code>, and
            <code>'Product'</code>.
        </para>

        <para>
            The value of each rule entry in the <code>$_referenceMap</code> array is also an
            associative array. The elements of this rule entry are described below:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis role="strong">columns</emphasis> => A string or an array of strings
                    naming the foreign key column name(s) in the dependent table.
                </para>

                <para>
                    It's common for this to be a single column, but some tables have multi-column
                    keys.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">refTableClass</emphasis> => The class name of the
                    parent table. Use the class name, not the physical name of the SQL table.
                </para>

                <para>
                    It's common for a dependent table to have only one reference to its parent
                    table, but some tables have multiple references to the same parent table. In
                    the example database, there is one reference from the <code>bugs</code> table
                    to the <code>products</code> table, but three references from the
                    <code>bugs</code> table to the <code>accounts</code> table. Put each reference
                    in a separate entry in the <code>$_referenceMap</code> array.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">refColumns</emphasis> => A string or an array of
                    strings naming the primary key column name(s) in the parent table.
                </para>

                <para>
                    It's common for this to be a single column, but some tables have multi-column
                    keys. If the reference uses a multi-column key, the order of columns in the
                    <code>'columns'</code> entry must match the order of columns in the
                    <code>'refColumns'</code> entry.
                </para>

                <para>
                    It is optional to specify this element. If you don't specify the
                    <code>refColumns</code>, the column(s) reported as the primary key columns of
                    the parent table are used by default.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">onDelete</emphasis> => The rule for an action to
                    execute if a row is deleted in the parent table. See
                    <xref linkend="zend.db.table.relationships.cascading" /> for more information.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">onUpdate</emphasis> => The rule for an action to
                    execute if values in primary key columns are updated in the parent table. See
                    <xref linkend="zend.db.table.relationships.cascading" /> for more information.
                </para>
            </listitem>
        </itemizedlist>

    </sect2>

    <sect2 id="zend.db.table.relationships.fetching.dependent">

        <title>Fetching a Dependent Rowset</title>

        <para>
            If you have a Row object as the result of a query on a parent table, you can fetch rows
            from dependent tables that reference the current row. Use the method:
        </para>

        <programlisting role="php"><![CDATA[<
$row->findDependentRowset($table, [$rule]);]]>
        </programlisting>

        <para>
            This method returns a Zend_Db_Table_Rowset_Abstract object, containing a set of rows
            from the dependent table <code>$table</code> that refer to the row identified by the
            <code>$row</code> object.
        </para>

        <para>
            The first argument <code>$table</code> can be a string that specifies the dependent
            table by its class name. You can also specify the dependent table by using an object of
            that table class.
        </para>

        <example id="zend.db.table.relationships.fetching.dependent.example">

            <title>Fetching a Dependent Rowset</title>

            <para>
                This example shows getting a Row object from the table <code>Accounts</code>, and
                finding the <code>Bugs</code> reported by that account.
            </para>

            <programlisting role="php"><![CDATA[<?php
$accountsTable      = new Accounts();
$accountsRowset     = $accountsTable->find(1234);
$user1234           = $accountsRowset->current();

$bugsReportedByUser = $user1234->findDependentRowset('Bugs');]]>
            </programlisting>

        </example>

        <para>
            The second argument <code>$rule</code> is optional. It is a string that names the rule
            key in the <code>$_referenceMap</code> array of the dependent table class. If you don't
            specify a rule, the first rule in the array that references the parent table is used.
            If you need to use a rule other than the first, you need to specify the key.
        </para>

        <para>
            In the example code above, the rule key is not specified, so the rule used by default
            is the first one that matches the parent table. This is the rule
            <code>'Reporter'</code>.
        </para>

        <example id="zend.db.table.relationships.fetching.dependent.example-by">

            <title>Fetching a Dependent Rowset By a Specific Rule</title>

            <para>
                This example shows getting a Row object from the table <code>Accounts</code>, and
                finding the <code>Bugs</code> assigned to be fixed by the user of that account. The
                rule key string that corresponds to this reference relationship in this example is
                <code>'Engineer'</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
$accountsTable      = new Accounts();
$accountsRowset     = $accountsTable->find(1234);
$user1234           = $accountsRowset->current();

$bugsAssignedToUser = $user1234->findDependentRowset('Bugs', 'Engineer');]]>
            </programlisting>

        </example>

        <para>
            You can also add criteria, ordering and limits to your relationships using the parent
            row's select object.
        </para>

        <para>

            <example id="zend.db.table.relationships.fetching.dependent.example-by-select">

                <title>Fetching a Dependent Rowset using a Zend_Db_Table_Select</title>

                <para>
                    This example shows getting a Row object from the table <code>Accounts</code>,
                    and finding the <code>Bugs</code> assigned to be fixed by the user of that
                    account, limited only to 3 rows and ordered by name.
                </para>

                <programlisting role="php"><![CDATA[<?php
$accountsTable      = new Accounts();
$accountsRowset     = $accountsTable->find(1234);
$user1234           = $accountsRowset->current();
$select             = $accountsTable->select()->order('name ASC')
                                              ->limit(3);

$bugsAssignedToUser = $user1234->findDependentRowset('Bugs', 'Engineer', $select);]]>
                </programlisting>

            </example>

            Alternatively, you can query rows from a dependent table using a special mechanism
            called a "magic method". Zend_Db_Table_Row_Abstract invokes the method:
            <code>findDependentRowset('&lt;TableClass&gt;', '&lt;Rule&gt;')</code> if you invoke a method on
            the Row object matching either of the following patterns:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>$row->find&lt;TableClass&gt;()</code>
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>$row->find&lt;TableClass&gt;By&lt;Rule&gt;()</code>
                </para>
            </listitem>
        </itemizedlist>

        <para>
            In the patterns above, <code>&lt;TableClass&gt;</code> and <code>&lt;Rule&gt;</code> are strings
            that correspond to the class name of the dependent table, and the dependent table's
            rule key that references the parent table.
        </para>

        <note>

            <para>
                Some application frameworks, such as Ruby on Rails, use a mechanism called
                "inflection" to allow the spelling of identifiers to change depending on usage. For
                simplicity, Zend_Db_Table_Row does not provide any inflection mechanism. The table
                identity and the rule key named in the method call must match the spelling of the
                class and rule key exactly.
            </para>

        </note>

        <example id="zend.db.table.relationships.fetching.dependent.example-magic">

            <title>Fetching Dependent Rowsets using the Magic Method</title>

            <para>
                This example shows finding dependent Rowsets equivalent to those in the previous
                examples. In this case, the application uses the magic method invocation instead of
                specifying the table and rule as strings.
            </para>

            <programlisting role="php"><![CDATA[<?php
$accountsTable    = new Accounts();
$accountsRowset   = $accountsTable->find(1234);
$user1234         = $accountsRowset->current();

// Use the default reference rule
$bugsReportedBy   = $user1234->findBugs();

// Specify the reference rule
$bugsAssignedTo   = $user1234->findBugsByEngineer();]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.db.table.relationships.fetching.parent">

        <title>Fetching a Parent Row</title>

        <para>
            If you have a Row object as the result of a query on a dependent table, you can fetch
            the row in the parent to which the dependent row refers. Use the method:
        </para>

        <programlisting role="php"><![CDATA[<
$row->findParentRow($table, [$rule]);]]>
        </programlisting>

        <para>
            There always should be exactly one row in the parent table referenced by a dependent
            row, therefore this method returns a Row object, not a Rowset object.
        </para>

        <para>
            The first argument <code>$table</code> can be a string that specifies the parent table
            by its class name. You can also specify the parent table by using an object of that
            table class.
        </para>

        <example id="zend.db.table.relationships.fetching.parent.example">

            <title>Fetching the Parent Row</title>

            <para>
                This example shows getting a Row object from the table <code>Bugs</code> (for
                example one of those bugs with status 'NEW'), and finding the row in the
                <code>Accounts</code> table for the user who reported the bug.
            </para>

            <programlisting role="php"><![CDATA[<?php
$bugsTable         = new Bugs();
$bugsRowset        = $bugsTable->fetchAll(array('bug_status = ?' => 'NEW'));
$bug1              = $bugsRowset->current();

$reporter          = $bug1->findParentRow('Accounts');]]>
            </programlisting>

        </example>

        <para>
            The second argument <code>$rule</code> is optional. It is a string that names the rule
            key in the <code>$_referenceMap</code> array of the dependent table class. If you don't
            specify a rule, the first rule in the array that references the parent table is used.
            If you need to use a rule other than the first, you need to specify the key.
        </para>

        <para>
            In the example above, the rule key is not specified, so the rule used by default is the
            first one that matches the parent table. This is the rule <code>'Reporter'</code>.
        </para>

        <example id="zend.db.table.relationships.fetching.parent.example-by">

            <title>Fetching a Parent Row By a Specific Rule</title>

            <para>
                This example shows getting a Row object from the table <code>Bugs</code>, and
                finding the account for the engineer assigned to fix that bug. The rule key string
                that corresponds to this reference relationship in this example is
                <code>'Engineer'</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
$bugsTable         = new Bugs();
$bugsRowset        = $bugsTable->fetchAll(array('bug_status = ?', 'NEW'));
$bug1              = $bugsRowset->current();

$engineer          = $bug1->findParentRow('Accounts', 'Engineer');]]>
            </programlisting>

        </example>

        <para>
            Alternatively, you can query rows from a parent table using a "magic method".
            Zend_Db_Table_Row_Abstract invokes the method:
            <code>findParentRow('&lt;TableClass&gt;', '&lt;Rule&gt;')</code> if you invoke a method
            on the Row object matching either of the following patterns:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>$row->findParent&lt;TableClass&gt;([Zend_Db_Table_Select $select])</code>
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>$row->findParent&lt;TableClass&gt;By&lt;Rule&gt;([Zend_Db_Table_Select
                    $select])</code>
                </para>
            </listitem>
        </itemizedlist>

        <para>
            In the patterns above, <code>&lt;TableClass&gt;</code> and <code>&lt;Rule&gt;</code>
            are strings that correspond to the class name of the parent table, and the dependent
            table's rule key that references the parent table.
        </para>

        <note>

            <para>
                The table identity and the rule key named in the method call must match the
                spelling of the class and rule key exactly.
            </para>

        </note>

        <example id="zend.db.table.relationships.fetching.parent.example-magic">

            <title>Fetching the Parent Row using the Magic Method</title>

            <para>
                This example shows finding parent Rows equivalent to those in the previous
                examples. In this case, the application uses the magic method invocation instead of
                specifying the table and rule as strings.
            </para>

            <programlisting role="php"><![CDATA[<?php
$bugsTable         = new Bugs();
$bugsRowset        = $bugsTable->fetchAll(array('bug_status = ?', 'NEW'));
$bug1              = $bugsRowset->current();

// Use the default reference rule
$reporter          = $bug1->findParentAccounts();

// Specify the reference rule
$engineer          = $bug1->findParentAccountsByEngineer();]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.db.table.relationships.fetching.many-to-many">

        <title>Fetching a Rowset via a Many-to-many Relationship</title>

        <para>
            If you have a Row object as the result of a query on one table in a many-to-many
            relationship (for purposes of the example, call this the "origin" table), you can
            fetch corresponding rows in the other table (call this the "destination" table) via an
            intersection table. Use the method:
        </para>

        <programlisting role="php"><![CDATA[<
$row->findManyToManyRowset($table, $intersectionTable, [$rule1, [$rule2, [Zend_Db_Table_Select $select]]]);]]>
        </programlisting>

        <para>
            This method returns a Zend_Db_Table_Rowset_Abstract containing rows from the table
            <code>$table</code>, satisfying the many-to-many relationship. The current Row object
            <code>$row</code> from the origin table is used to find rows in the intersection table,
            and that is joined to the destination table.
        </para>

        <para>
            The first argument <code>$table</code> can be a string that specifies the destination
            table in the many-to-many relationship by its class name. You can also specify the
            destination table by using an object of that table class.
        </para>

        <para>
            The second argument <code>$intersectionTable</code> can be a string that specifies the
            intersection table between the two tables in the the many-to-many relationship by its
            class name. You can also specify the intersection table by using an object of that
            table class.
        </para>

        <example id="zend.db.table.relationships.fetching.many-to-many.example">

            <title>Fetching a Rowset with the Many-to-many Method</title>

            <para>
                This example shows geting a Row object from from the origin table
                <code>Bugs</code>, and finding rows from the destination table
                <code>Products</code>, representing products related to that bug.
            </para>

            <programlisting role="php"><![CDATA[<?php
$bugsTable        = new Bugs();
$bugsRowset       = $bugsTable->find(1234);
$bug1234          = $bugsRowset->current();

$productsRowset   = $bug1234->findManyToManyRowset('Products', 'BugsProducts');]]>
            </programlisting>

        </example>

        <para>
            The third and fourth arguments <code>$rule1</code> and <code>$rule2</code> are
            optional. These are strings that name the rule keys in the <code>$_referenceMap</code>
            array of the intersection table.
        </para>

        <para>
            The <code>$rule1</code> key names the rule for the relationship from the intersection
            table to the origin table. In this example, this is the relationship from
            <code>BugsProducts</code> to <code>Bugs</code>.
        </para>

        <para>
            The <code>$rule2</code> key names the rule for the relationship from the intersection
            table to the destination table. In this example, this is the relationship from
            <code>Bugs</code> to <code>Products</code>.
        </para>

        <para>
            Similarly to the methods for finding parent and dependent rows, if you don't specify a
            rule, the method uses the first rule in the <code>$_referenceMap</code> array that
            matches the tables in the relationship. If you need to use a rule other than the first,
            you need to specify the key.
        </para>

        <para>
            In the example code above, the rule key is not specified, so the rules used by default
            are the first ones that match. In this case, <code>$rule1</code> is
            <code>'Reporter'</code> and <code>$rule2</code> is <code>'Product'</code>.
        </para>

        <example id="zend.db.table.relationships.fetching.many-to-many.example-by">

            <title>Fetching a Rowset with the Many-to-many Method By a Specific Rule</title>

            <para>
                This example shows geting a Row object from from the origin table
                <code>Bugs</code>, and finding rows from the destination table
                <code>Products</code>, representing products related to that bug.
            </para>

            <programlisting role="php"><![CDATA[<?php
$bugsTable        = new Bugs();
$bugsRowset       = $bugsTable->find(1234);
$bug1234          = $bugsRowset->current();

$productsRowset   = $bug1234->findManyToManyRowset('Products', 'BugsProducts', 'Bug');]]>
            </programlisting>

        </example>

        <para>
            Alternatively, you can query rows from the destination table in a many-to-many
            relationship using a "magic method." Zend_Db_Table_Row_Abstract invokes the method:
            <code>findManyToManyRowset('&lt;TableClass&gt;', '&lt;IntersectionTableClass&gt;',
            '&lt;Rule1&gt;', '&lt;Rule2&gt;')</code> if you invoke a method matching any of the
            following patterns:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>$row->find&lt;TableClass&gt;Via&lt;IntersectionTableClass&gt;
                    ([Zend_Db_Table_Select $select])</code>
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>$row->find&lt;TableClass&gt;Via&lt;IntersectionTableClass&gt;By&lt;Rule1&gt;
                    ([Zend_Db_Table_Select $select])</code>
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>$row->find&lt;TableClass&gt;Via&lt;IntersectionTableClass&gt;By&lt;Rule1&gt;And&lt;Rule2&gt;
                    ([Zend_Db_Table_Select $select])</code>
                </para>
            </listitem>
        </itemizedlist>

        <para>
            In the patterns above, <code>&lt;TableClass&gt;</code> and
            <code>&lt;IntersectionTableClass&gt;</code> are strings that correspond to the class
            names of the destination table and the intersection table, respectively.
            <code>&lt;Rule1&gt;</code> and <code>&lt;Rule2&gt;</code> are strings that correspond
            to the rule keys in the intersection table that reference the origin table and the
            destination table, respectively.
        </para>

        <note>

            <para>
                The table identities and the rule keys named in the method call must match the
                spelling of the class and rule key exactly.
            </para>

        </note>

        <example id="zend.db.table.relationships.fetching.many-to-many.example-magic">

            <title>Fetching Rowsets using the Magic Many-to-many Method</title>

            <para>
                This example shows finding rows in the destination table of a many-to-many
                relationship representing products related to a given bug.
            </para>

            <programlisting role="php"><![CDATA[<?php
$bugsTable        = new Bugs();
$bugsRowset       = $bugsTable->find(1234);
$bug1234          = $bugsRowset->current();

// Use the default reference rule
$products          = $bug1234->findProductsViaBugsProducts();

// Specify the reference rule
$products          = $bug1234->findProductsViaBugsProductsByBug();]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.db.table.relationships.cascading">

        <title>Cascading Write Operations</title>

        <note>

            <title>Declare DRI in the database:</title>

            <para>
                Declaring cascading operations in Zend_Db_Table is intended
                <emphasis role="strong">only</emphasis> for RDBMS brands that do not support
                declarative referential integrity (DRI).
            </para>

            <para>
                For example, if you use MySQL's MyISAM storage engine, or SQLite, these solutions
                do not support DRI. You may find it helpful to declare the cascading operations
                with Zend_Db_Table.
            </para>

            <para>
                If your RDBMS implements DRI and the <code>ON DELETE</code> and
                <code>ON UPDATE</code> clauses, you should declare these clauses in your database
                schema, instead of using the cascading feature in Zend_Db_Table. Declaring
                cascading DRI rules in the RDBMS is better for database performance, consistency,
                and integrity.
            </para>

            <para>
                Most importantly, do not declare cascading operations both in the RDBMS and in your
                Zend_Db_Table class.
            </para>

        </note>

        <para>
            You can declare cascading operations to execute against a dependent table when you
            apply an <code>UPDATE</code> or a <code>DELETE</code> to a row in a parent table.
        </para>

        <example id="zend.db.table.relationships.cascading.example-delete">

            <title>Example of a Cascading Delete</title>

            <para>
                This example shows deleting a row in the <code>Products</code> table, which is
                configured to automatically delete dependent rows in the <code>Bugs</code> table.
            </para>

            <programlisting role="php"><![CDATA[<?php
$productsTable  = new Products();
$productsRowset = $productsTable->find(1234);
$product1234    = $productsRowset->current();

$product1234->delete();
// Automatically cascades to Bugs table
// and deletes dependent rows.]]>
            </programlisting>

        </example>

        <para>
            Similarly, if you use <code>UPDATE</code> to change the value of a primary key in a
            parent table, you may want the value in foreign keys of dependent tables to be updated
            automatically to match the new value, so that such references are kept up to date.
        </para>

        <para>
            It's usually not necessary to update the value of a primary key that was generated by a
            sequence or other mechanism. But if you use a <emphasis>natural key</emphasis> that may
            change value occasionally, it is more likely that you need to apply cascading updates
            to dependent tables.
        </para>

        <para>
            To declare a cascading relationship in the Zend_Db_Table, edit the rules in the
            <code>$_referenceMap</code>. Set the associative array keys <code>'onDelete'</code> and
            <code>'onUpdate'</code> to the string 'cascade' (or the constant
            <code>self::CASCADE</code>). Before a row is deleted from the parent table, or its
            primary key values updated, any rows in the dependent table that refer to the parent's
            row are deleted or updated first.
        </para>

        <example id="zend.db.table.relationships.cascading.example-declaration">

            <title>Example Declaration of Cascading Operations</title>

            <para>
                In the example below, rows in the <code>Bugs</code> table are automatically deleted
                if the row in the <code>Products</code> table to which they refer is deleted. The
                <code>'onDelete'</code> element of the reference map entry is set to
                <code>self::CASCADE</code>.
            </para>

            <para>
                No cascading update is done in the example below if the primary key value in the
                parent class is changed. The <code>'onUpdate'</code> element of the reference map
                entry is <code>self::RESTRICT</code>. You can get the same result using the value
                <code>self::NO_ACTION</code>, or by omitting the <code>'onUpdate'</code> entry.
            </para>

            <programlisting role="php"><![CDATA[<?php
class BugsProducts extends Zend_Db_Table_Abstract
{
    ...
    protected $_referenceMap    = array(
        'Product' => array(
            'columns'           => array('product_id'),
            'refTableClass'     => 'Products',
            'refColumns'        => array('product_id'),
            'onDelete'          => self::CASCADE,
            'onUpdate'          => self::RESTRICT
        ),
        ...
    );
}]]>
            </programlisting>

        </example>

        <sect3 id="zend.db.table.relationships.cascading.notes">

            <title>Notes Regarding Cascading Operations</title>

            <para>
                <emphasis role="strong">Cascading operations invoked by Zend_Db_Table are not
                atomic.</emphasis>
            </para>

            <para>
                This means that if your database implements and enforces referential integrity
                constraints, a cascading <code>UPDATE</code> executed by a Zend_Db_Table class
                conflicts with the constraint, and results in a referential integrity violation.
                You can use cascading <code>UPDATE</code> in Zend_Db_Table
                <emphasis>only</emphasis> if your database does not enforce that referential
                integrity constraint.
            </para>

            <para>
                Cascading <code>DELETE</code> suffers less from the problem of referential
                integrity violations. You can delete dependent rows as a non-atomic action before
                deleting the parent row that they reference.
            </para>

            <para>
                However, for both <code>UPDATE</code> and <code>DELETE</code>, changing the
                database in a non-atomic way also creates the risk that another database user can
                see the data in an inconsistent state. For example, if you delete a row and all its
                dependent rows, there is a small chance that another database client program can
                query the database after you have deleted the dependent rows, but before you delete
                the parent row. That client program may see the parent row with no dependent rows,
                and assume this is the intended state of the data. There is no way for that client
                to know that its query read the database in the middle of a change.
            </para>

            <para>
                The issue of non-atomic change can be mitigated by using transactions to isolate
                your change. But some RDBMS brands don't support transactions, or allow clients to
                read "dirty" changes that have not been committed yet.
            </para>

            <para>
                <emphasis role="strong">Cascading operations in Zend_Db_Table are invoked only by
                Zend_Db_Table.</emphasis>
            </para>

            <para>
                Cascading deletes and updates defined in your Zend_Db_Table classes are applied if
                you execute the <code>save()</code> or <code>delete()</code> methods on the Row
                class. However, if you update or delete data using another interface, such as a
                query tool or another application, the cascading operations are not applied. Even
                when using <code>update()</code> and <code>delete()</code> methods in the
                Zend_Db_Adapter class, cascading operations defined in your Zend_Db_Table classes
                are not executed.
            </para>

            <para>
                <emphasis role="strong">No Cascading <code>INSERT</code>.</emphasis>
            </para>

            <para>
                There is no support for a cascading <code>INSERT</code>. You must insert a row to a
                parent table in one operation, and insert row(s) to a dependent table in a separate
                operation.
            </para>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.db.table">

    <title>Zend_Db_Table</title>

    <sect2 id="zend.db.table.introduction">

        <title>Introduction to Table Class</title>

        <para>
            The Zend_Db_Table class is an object-oriented interface to database tables. It provides
            methods for many common operations on tables. The base class is extensible, so you can
            add custom logic.
        </para>

        <para>
            The Zend_Db_Table solution is an implementation of the
            <ulink url="http://www.martinfowler.com/eaaCatalog/tableDataGateway.html">Table Data
            Gateway</ulink> pattern. The solution also includes a class that implements the
            <ulink url="http://www.martinfowler.com/eaaCatalog/rowDataGateway.html">Row Data
            Gateway</ulink> pattern.
        </para>

    </sect2>

    <sect2 id="zend.db.table.defining">

        <title>Defining a Table Class</title>

        <para>
            For each table in your database that you want to access, define a class that extends
            Zend_Db_Table_Abstract.
        </para>

        <sect3 id="zend.db.table.defining.table-schema">

            <title>Defining the Table Name and Schema</title>

            <para>
                Declare the database table for which this class is defined, using the protected
                variable <code>$_name</code>. This is a string, and must contain the name of the
                table spelled as it appears in the database.
            </para>

            <example id="zend.db.table.defining.table-schema.example1">

                <title>Declaring a table class with explicit table name</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';
}]]>
                </programlisting>

            </example>

            <para>
                If you don't specify the table name, it defaults to the name of the class. If you
                rely on this default, the class name must match the spelling of the table name as
                it appears in the database.
            </para>

            <example id="zend.db.table.defining.table-schema.example">

                <title>Declaring a table class with implicit table name</title>

                <programlisting role="php"><![CDATA[<?php
class bugs extends Zend_Db_Table_Abstract
{
    // table name matches class name
}]]>
                </programlisting>

            </example>

            <para>
                You can also declare the schema for the table, either with the protected variable
                <code>$_schema</code>, or with the schema prepended to the table name in the
                <code>$_name</code> property. Any schema specified with the <code>$_name</code>
                property takes precedence over a schema specified with the <code>$_schema</code>
                property. In some RDBMS brands, the term for schema is "database" or "tablespace,"
                but it is used similarly.
            </para>

            <example id="zend.db.table.defining.table-schema.example3">

                <title>Declaring a table class with schema</title>

                <programlisting role="php"><![CDATA[<?php
// First alternative:
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_schema = 'bug_db';
    protected $_name   = 'bugs';
}

// Second alternative:
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bug_db.bugs';
}

// If schemas are specified in both $_name and $_schema, the one
// specified in $_name takes precedence:

class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name   = 'bug_db.bugs';
    protected $_schema = 'ignored';
}]]>
                </programlisting>

            </example>

            <para>
                The schema and table names may also be specified via constructor configuration
                directives, which override any default values specified with the
                <code>$_name</code> and <code>$_schema</code> properties. A schema specification
                given with the <code>name</code> directive overrides any value provided with the
                <code>schema</code> option.
            </para>

            <example id="zend.db.table.defining.table-schema.example.constructor">

                <title>Declaring table and schema names upon instantiation</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
}

// First alternative:

$tableBugs = new Bugs(array('name' => 'bugs', 'schema' => 'bug_db'));

// Second alternative:

$tableBugs = new Bugs(array('name' => 'bug_db.bugs');

// If schemas are specified in both 'name' and 'schema', the one
// specified in 'name' takes precedence:

$tableBugs = new Bugs(array('name' => 'bug_db.bugs', 'schema' => 'ignored');]]>
                </programlisting>

            </example>

            <para>
                If you don't specify the schema name, it defaults to the schema to which your
                database adapter instance is connected.
            </para>

        </sect3>

        <sect3 id="zend.db.table.defining.primary-key">

            <title>Defining the Table Primary Key</title>

            <para>
                Every table must have a primary key. You can declare the column for the primary key
                using the protected variable <code>$_primary</code>. This is either a string that
                names the single column for the primary key, or else it is an array of column names
                if your primary key is a compound key.
            </para>

            <example id="zend.db.table.defining.primary-key.example">

                <title>Example of specifying the primary key</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';
    protected $_primary = 'bug_id';
}]]>
                </programlisting>

            </example>

            <para>
                If you don't specify the primary key, Zend_Db_Table_Abstract tries to discover the
                primary key based on the information provided by the <code>describeTable()</code>´
                method.
            </para>

            <note>

                <para>
                    Every table class must know which column(s) can be used to address rows
                    uniquely. If no primary key column(s) are specified in the table class
                    definition or the table constructor arguments, or discovered in the table
                    metadata provided by <code>describeTable()</code>, then the table cannot be
                    used with Zend_Db_Table.
                </para>

            </note>

        </sect3>

        <sect3 id="zend.db.table.defining.setup">

            <title>Overriding Table Setup Methods</title>

            <para>
                When you create an instance of a Table class, the constructor calls a set of
                protected methods that initialize metadata for the table. You can extend any of
                these methods to define metadata explicitly. Remember to call the method of the
                same name in the parent class at the end of your method.
            </para>

            <example id="zend.db.table.defining.setup.example">

                <title>Example of overriding the _setupTableName() method</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected function _setupTableName()
    {
        $this->_name = 'bugs';
        parent::_setupTableName();
    }
}]]>
                </programlisting>

            </example>

            <para>
                The setup methods you can override are the following:
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        <code>_setupDatabaseAdapter()</code> checks that an adapter has been
                        provided; gets a default adapter from the registry if needed. By overriding
                        this method, you can set a database adapter from some other source.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>_setupTableName()</code> defaults the table name to the name of the
                        class. By overriding this method, you can set the table name before this
                        default behavior runs.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>_setupMetadata()</code> sets the schema if the table name contains
                        the pattern "schema.table"; calls <code>describeTable()</code> to get
                        metadata information; defaults the <code>$_cols</code> array to the columns
                        reported by <code>describeTable()</code>. By overriding this method, you
                        can specify the columns.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <code>_setupPrimaryKey()</code> defaults the primary key columns to those
                        reported by <code>describeTable()</code>; checks that the primary key
                        columns are included in the <code>$_cols</code> array. By overriding this
                        method, you can specify the primary key columns.
                    </para>
                </listitem>
            </itemizedlist>

        </sect3>

        <sect3 id="zend.db.table.initialization">

            <title>Table initialization</title>

            <para>
                If application-specific logic needs to be initialized when a Table class is
                constructed, you can select to move your tasks to the <code>init()</code> method,
                which is called after all Table metadata has been processed. This is recommended
                over the <code>__construct</code> method if you do not need to alter the metadata
                in any programmatic way.

                <example id="zend.db.table.defining.init.usage.example">

                    <title>Example usage of init() method</title>

                    <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_observer;

    protected function init()
    {
        $this->_observer = new MyObserverClass();
    }
}]]>
                    </programlisting>

                </example>

            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.db.table.constructing">

        <title>Creating an Instance of a Table</title>

        <para>
            Before you use a Table class, create an instance using its constructor. The
            constructor's argument is an array of options. The most important option to a Table
            constructor is the database adapter instance, representing a live connection to an
            RDBMS. There are three ways of specifying the database adapter to a Table class, and
            these three ways are described below:
        </para>

        <sect3 id="zend.db.table.constructing.adapter">

            <title>Specifying a Database Adapter</title>

            <para>
                The first way to provide a database adapter to a Table class is by passing it as an
                object of type Zend_Db_Adapter_Abstract in the options array, identified by the key
                <code>'db'</code>.
            </para>

            <example id="zend.db.table.constructing.adapter.example">

                <title>Example of constructing a Table using an Adapter object</title>

                <programlisting role="php"><![CDATA[<?php
$db = Zend_Db::factory('PDO_MYSQL', $options);

$table = new Bugs(array('db' => $db));]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.table.constructing.default-adapter">

            <title>Setting a Default Database Adapter</title>

            <para>
                The second way to provide a database adapter to a Table class is by declaring an
                object of type Zend_Db_Adapter_Abstract to be a default database adapter for all
                subsequent instances of Tables in your application. You can do this with the static
                method <code>Zend_Db_Table_Abstract::setDefaultAdapter()</code>. The argument is an
                object of type Zend_Db_Adapter_Abstract.
            </para>

            <example id="zend.db.table.constructing.default-adapter.example">

                <title>Example of constructing a Table using a the Default Adapter</title>

                <programlisting role="php"><![CDATA[<?php
$db = Zend_Db::factory('PDO_MYSQL', $options);
Zend_Db_Table_Abstract::setDefaultAdapter($db);

// Later...

$table = new Bugs();]]>
                </programlisting>

            </example>

            <para>
                It can be convenient to create the database adapter object in a central place of
                your application, such as the bootstrap, and then store it as the default adapter.
                This gives you a means to ensure that the adapter instance is the same throughout
                your application. However, setting a default adapter is limited to a single adapter
                instance.
            </para>

        </sect3>

        <sect3 id="zend.db.table.constructing.registry">

            <title>Storing a Database Adapter in the Registry</title>

            <para>
                The third way to provide a database adapter to a Table class is by passing a string
                in the options array, also identified by the <code>'db'</code> key. The string is
                used as a key to the static Zend_Registry instance, where the entry at that key is
                an object of type Zend_Db_Adapter_Abstract.
            </para>

            <example id="zend.db.table.constructing.registry.example">

                <title>Example of constructing a Table using a Registry key</title>

                <programlisting role="php"><![CDATA[<?php
$db = Zend_Db::factory('PDO_MYSQL', $options);
Zend_Registry::set('my_db', $db);

// Later...

$table = new Bugs(array('db' => 'my_db'));]]>
                </programlisting>

            </example>

            <para>
                Like setting the default adapter, this gives you the means to ensure that the same
                adapter instance is used throughout your application. Using the registry is more
                flexible, because you can store more than one adapter instance. A given adapter
                instance is specific to a certain RDBMS brand and database instance. If your
                application needs access to multiple databases or even multiple database brands,
                then you need to use multiple adapters.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.db.table.insert">

        <title>Inserting Rows to a Table</title>

        <para>
            You can use the Table object to insert rows into the database table on which the Table
            object is based. Use the <code>insert()</code> method of your Table object. The
            argument is an associative array, mapping column names to values.
        </para>

        <example id="zend.db.table.insert.example">

            <title>Example of inserting to a Table</title>

            <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$data = array(
    'created_on'      => '2007-03-22',
    'bug_description' => 'Something wrong',
    'bug_status'      => 'NEW'
);

$table->insert($data);]]>
            </programlisting>

        </example>

        <para>
            By default, the values in your data array are inserted as literal values, using
            parameters. If you need them to be treated as SQL expressions, you must make sure they
            are distinct from plain strings. Use an object of type Zend_Db_Expr to do this.
        </para>

        <example id="zend.db.table.insert.example-expr">

            <title>Example of inserting expressions to a Table</title>

            <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$data = array(
    'created_on'      => new Zend_Db_Expr('CURDATE()'),
    'bug_description' => 'Something wrong',
    'bug_status'      => 'NEW'
);]]>
            </programlisting>

        </example>

        <para>
            In the examples of inserting rows above, it is assumed that the table has an
            auto-incrementing primary key. This is the default behavior of Zend_Db_Table_Abstract,
            but there are other types of primary keys as well. The following sections describe how
            to support different types of primary keys.
        </para>

        <sect3 id="zend.db.table.insert.key-auto">

            <title>Using a Table with an Auto-incrementing Key</title>

            <para>
                An auto-incrementing primary key generates a unique integer value for you if you
                omit the primary key column from your SQL <code>INSERT</code> statement.
            </para>

            <para>
                In Zend_Db_Table_Abstract, if you define the protected variable
                <code>$_sequence</code> to be the Boolean value <code>true</code>, then the class
                assumes that the table has an auto-incrementing primary key.
            </para>

            <example id="zend.db.table.insert.key-auto.example">

                <title>Example of declaring a Table with auto-incrementing primary key</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';

    // This is the default in the Zend_Db_Table_Abstract class;
    // you do not need to define this.
    protected $_sequence = true;
}]]>
                </programlisting>

            </example>

            <para>
                MySQL, Microsoft SQL Server, and SQLite are examples of RDBMS brands that support
                auto-incrementing primary keys.
            </para>

            <para>
                PostgreSQL has a <code>SERIAL</code> notation that implicitly defines a sequence
                based on the table and column name, and uses the sequence to generate key values
                for new rows. IBM DB2 has an <code>IDENTITY</code> notation that works similarly.
                If you use either of these notations, treat your Zend_Db_Table class as having an
                auto-incrementing column with respect to declaring the <code>$_sequence</code>
                member as <code>true</code>.
            </para>

        </sect3>

        <sect3 id="zend.db.table.insert.key-sequence">

            <title>Using a Table with a Sequence</title>

            <para>
                A sequence is a database object that generates a unique value, which can be used
                as a primary key value in one or more tables of the database.
            </para>

            <para>
                If you define <code>$_sequence</code> to be a string, then Zend_Db_Table_Abstract
                assumes the string to name a sequence object in the database. The sequence is
                invoked to generate a new value, and this value is used in the <code>INSERT</code>
                operation.
            </para>

            <example id="zend.db.table.insert.key-sequence.example">

                <title>Example of declaring a Table with a sequence</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';

    protected $_sequence = 'bug_sequence';
}]]>
                </programlisting>

            </example>

            <para>
                Oracle, PostgreSQL, and IBM DB2 are examples of RDBMS brands that support sequence
                objects in the database.
            </para>

            <para>
                PostgreSQL and IBM DB2 also have syntax that defines sequences implicitly and
                associated with columns. If you use this notation, treat the table as having an
                auto-incrementing key column. Define the sequence name as a string only in cases
                where you would invoke the sequence explicitly to get the next key value.
            </para>

        </sect3>

        <sect3 id="zend.db.table.insert.key-natural">

            <title>Using a Table with a Natural Key</title>

            <para>
                Some tables have a natural key. This means that the key is not automatically
                generated by the table or by a sequence. You must specify the value for the primary
                key in this case.
            </para>

            <para>
                If you define the <code>$_sequence</code> to be the Boolean value
                <code>false</code>, then Zend_Db_Table_Abstract assumes that the table has a
                natural primary key. You must provide values for the primary key columns in the
                array of data to the <code>insert()</code> method, or else this method throws a
                Zend_Db_Table_Exception.
            </para>

            <example id="zend.db.table.insert.key-natural.example">

                <title>Example of declaring a Table with a natural key</title>

                <programlisting role="php"><![CDATA[<?php
class BugStatus extends Zend_Db_Table_Abstract
{
    protected $_name = 'bug_status';

    protected $_sequence = false;
}]]>
                </programlisting>

            </example>

            <note>

                <para>
                    All RDBMS brands support tables with natural keys. Examples of tables that are
                    often declared as having natural keys are lookup tables, intersection tables in
                    many-to-many relationships, or most tables with compound primary keys.
                </para>

            </note>

        </sect3>

    </sect2>

    <sect2 id="zend.db.table.update">

        <title>Updating Rows in a Table</title>

        <para>
            You can update rows in a database table using the <code>update</code> method of a Table
            class. This method takes two arguments: an associative array of columns to change and
            new values to assign to these columns; and an SQL expression that is used in a
            <code>WHERE</code> clause, as criteria for the rows to change in the
            <code>UPDATE</code> operation.
        </para>

        <example id="zend.db.table.update.example">

            <title>Example of updating rows in a Table</title>

            <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$data = array(
    'updated_on'      => '2007-03-23',
    'bug_status'      => 'FIXED'
);

$where = $table->getAdapter()->quoteInto('bug_id = ?', 1234);

$table->update($data, $where);]]>
            </programlisting>

        </example>

        <para>
            Since the table <code>update()</code> method proxies to the database adapter
            <link linkend="zend.db.adapter.write.update"><code>update()</code></link> method, the
            second argument can be an array of SQL expressions. The expressions are combined as
            Boolean terms using an <code>AND</code> operator.
        </para>

        <note>

            <para>
                The values and identifiers in the SQL expression are not quoted for you. If you
                have values or identifiers that require quoting, you are responsible for doing
                this. Use the <code>quote()</code>, <code>quoteInto()</code>, and
                <code>quoteIdentifier()</code> methods of the database adapter.
            </para>

        </note>

    </sect2>

    <sect2 id="zend.db.table.delete">

        <title>Deleting Rows from a Table</title>

        <para>
            You can delete rows from a database table using the <code>delete()</code> method. This
            method takes one argument, which is an SQL expression that is used in a
            <code>WHERE</code> clause, as criteria for the rows to delete.
        </para>

        <example id="zend.db.table.delete.example">

            <title>Example of deleting rows from a Table</title>

            <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$where = $table->getAdapter()->quoteInto('bug_id = ?', 1235);

$table->delete($where);]]>
            </programlisting>

        </example>

        <para>
            The second argument can be an array of SQL expressions. The expressions are combined as
            Boolean terms using an <code>AND</code> operator.
        </para>

        <para>
            Since the table <code>delete()</code> method proxies to the database adapter
            <link linkend="zend.db.adapter.write.delete"><code>delete()</code></link> method, the
            second argument can be an array of SQL expressions. The expressions are combined as
            Boolean terms using an <code>AND</code> operator.
        </para>

        <note>

            <para>
                The values and identifiers in the SQL expression are not quoted for you. If you
                have values or identifiers that require quoting, you are responsible for doing
                this. Use the <code>quote()</code>, <code>quoteInto()</code>, and
                <code>quoteIdentifier()</code> methods of the database adapter.
            </para>

        </note>

    </sect2>

    <sect2 id="zend.db.table.find">

        <title>Finding Rows by Primary Key</title>

        <para>
            You can query the database table for rows matching specific values in the primary key,
            using the <code>find()</code> method. The first argument of this method is either a
            single value or an array of values to match against the primary key of the table.
        </para>

        <example id="zend.db.table.find.example">

            <title>Example of finding rows by primary key values</title>

            <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

// Find a single row
// Returns a Rowset
$rows = $table->find(1234);

// Find multiple rows
// Also returns a Rowset
$rows = $table->find(array(1234, 5678));]]>
            </programlisting>

        </example>

        <para>
            If you specify a single value, the method returns at most one row, because a primary
            key cannot have duplicate values and there is at most one row in the database table
            matching the value you specify. If you specify multiple values in an array, the method
            returns at most as many rows as the number of distinct values you specify.
        </para>

        <para>
            The <code>find()</code> method might return fewer rows than the number of values you
            specify for the primary key, if some of the values don't match any rows in the database
            table. The method even may return zero rows. Because the number of rows returned is
            variable, the <code>find()</code> method returns an object of type
            <classname>Zend_Db_Table_Rowset_Abstract</classname>.
        </para>

        <para>
            If the primary key is a compound key, that is, it consists of multiple columns, you can
            specify the additional columns as additional arguments to the <code>find()</code>
            method. You must provide as many arguments as the number of columns in the table's
            primary key.
        </para>

        <para>
            To find multiple rows from a table with a compound primary key, provide an array for
            each of the arguments. All of these arrays must have the same number of elements. The
            values in each array are formed into tuples in order; for example, the first element
            in all the array arguments define the first compound primary key value, then the second
            elements of all the arrays define the second compound primary key value, and so on.
        </para>

        <example id="zend.db.table.find.example-compound">

            <title>Example of finding rows by compound primary key values</title>

            <para>
                The call to <code>find()</code> below to match multiple rows can match two rows in
                the database. The first row must have primary key value (1234, 'ABC'), and the
                second row must have primary key value (5678, 'DEF').
            </para>

            <programlisting role="php"><![CDATA[<?php
class BugsProducts extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs_products';
    protected $_primary = array('bug_id', 'product_id');
}

$table = new BugsProducts();

// Find a single row with a compound primary key
// Returns a Rowset
$rows = $table->find(1234, 'ABC');

// Find multiple rows with compound primary keys
// Also returns a Rowset
$rows = $table->find(array(1234, 5678), array('ABC', 'DEF'));]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.db.table.fetch-all">

        <title>Querying for a Set of Rows</title>

        <sect3 id="zend.db.table.fetch-all.select">

            <title>Select API</title>

            <para>

                <warning>

                    <para>
                        The API for fetch operations has been superceded to allow a
                        <code>Zend_Db_Table_Select</code> object to modify the query. However, the
                        deprecated usage of the <code>fetchRow()</code> and <code>fetchAll()</code>
                        methods will continue to work without modification.
                    </para>

                    <para>
                        The following statements are all legal and functionally identical, however
                        it is recommended to update your code to take advantage of the new usage
                        where possible.
                    </para>

                    <para>

                        <programlisting role="php"><![CDATA[// Fetching a rowset
    $rows = $table->fetchAll('bug_status = "NEW"', 'bug_id ASC', 10, 0);
    $rows = $table->fetchAll($table->select()->where('bug_status = ?', 'NEW')
                                             ->order('bug_id ASC')
                                             ->limit(10, 0));

    // Fetching a single row
    $row = $table->fetchRow('bug_status = "NEW"', 'bug_id ASC');
    $row = $table->fetchRow($table->select()->where('bug_status = ?', 'NEW')
                                            ->order('bug_id ASC'));]]>
                        </programlisting>

                    </para>

                </warning>

            </para>

            <para>
                The <classname>Zend_Db_Table_Select</classname> object is an extension of the
                <classname>Zend_Db_Select</classname> object that applies specific restrictions to
                a query. The enhancements and restrictions are:
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        You <emphasis>can</emphasis> elect to return a subset of columns within a
                        fetchRow or fetchAll query. This can provide optimization benefits where
                        returning a large set of results for all columns is not desirable.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        You <emphasis>can</emphasis> specify columns that evaluate expressions from
                        within the selected table. However this will mean that the returned row or
                        rowset will be <property>readOnly</property> and cannot be used for save()
                        operations. A <code>Zend_Db_Table_Row</code> with
                        <property>readOnly</property> status will throw an exception if a
                        <code>save()</code> operation is attempted.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        You <emphasis>can</emphasis> allow JOIN clauses on a select to allow
                        multi-table lookups.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        You <emphasis>can not</emphasis> specify columns from a JOINed tabled to be
                        returned in a row/rowset. Doing so will trigger a PHP error. This was done
                        to ensure the integrity of the <code>Zend_Db_Table is retained</code>. i.e.
                        A <code>Zend_Db_Table_Row</code> should only reference columns derived from
                        its parent table.
                    </para>
                </listitem>
            </itemizedlist>

            <para>

                <example id="zend.db.table.qry.rows.set.simple.usage.example">

                    <title>Simple usage</title>

                    <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$select = $table->select();
$select->where('bug_status = ?', 'NEW');

$rows = $table->fetchAll($select);]]>
                    </programlisting>

                </example>

            </para>

            <para>
                Fluent interfaces are implemented across the component, so this can be rewritten
                this in a more abbreviated form.
            </para>

            <para>

                <example id="zend.db.table.qry.rows.set.fluent.interface.example">

                    <title>Example of fluent interface</title>

                    <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$rows = $table->fetchAll($table->select()->where('bug_status = ?', 'NEW'));]]>
                    </programlisting>

                </example>

            </para>

        </sect3>

        <sect3 id="zend.db.table.fetch-all.usage">

            <title>Fetching a rowset</title>

            <para>
                You can query for a set of rows using any criteria other than the primary key
                values, using the <code>fetchAll()</code> method of the Table class. This method
                returns an object of type <code>Zend_Db_Table_Rowset_Abstract</code>.
            </para>

            <example id="zend.db.table.qry.rows.set.finding.row.example">

                <title>Example of finding rows by an expression</title>

                <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$select = $table->select()->where('bug_status = ?', 'NEW');

$rows = $table->fetchAll($select);]]>
                </programlisting>

            </example>

            <para>
                You may also pass sorting criteria in an <code>ORDER BY</code> clause, as well as
                count and offset integer values, used to make the query return a specific subset of
                rows. These values are used in a <code>LIMIT</code> clause, or in equivalent logic
                for RDBMS brands that do not support the <code>LIMIT</code> syntax.
            </para>

            <example id="zend.db.table.fetch-all.example2">

                <title>Example of finding rows by an expression</title>

                <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$order  = 'bug_id';

// Return the 21st through 30th rows
$count  = 10;
$offset = 20;

$select = $table->select()->where(array('bug_status = ?' => 'NEW'))
                          ->order($order)
                          ->limit($count, $offset);

$rows = $table->fetchAll($select);]]>
                </programlisting>

            </example>

            <para>
                All of the arguments above are optional. If you omit the ORDER clause, the result
                set includes rows from the table in an unpredictable order. If no LIMIT clause is
                set, you retrieve every row in the table that matches the WHERE clause.
            </para>

        </sect3>

        <sect3 id="zend.db.table.advanced.usage">

            <title>Advanced usage</title>

            <para>
                For more specific and optimized requests, you may wish to limit the number of
                columns returned in a row/rowset. This can be achieved by passing a FROM clause to
                the select object. The first argument in the FROM clause is identical to that of a
                Zend_Db_Select object with the addition of being able to pass an instance of
                Zend_Db_Table_Abstract and have it automatically determine the table name.
            </para>

            <para>

                <example id="zend.db.table.qry.rows.set.retrieving.a.example">

                    <title>Retrieving specific columns</title>

                    <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$select = $table->select();
$select->from($table, array('bug_id', 'bug_description'))
       ->where('bug_status = ?', 'NEW');

$rows = $table->fetchAll($select);]]>
                    </programlisting>

                </example>

            </para>

            <para>

                <important>

                    <para>
                        The rowset contains rows that are still 'valid' - they simply contain a
                        subset of the columns of a table. If a save() method is called on a partial
                        row then only the fields available will be modified.
                    </para>

                </important>

                You can also specify expressions within a FROM clause and have these returned as a
                readOnly row/rowset. In this example we will return a rows from the bugs table that
                show an aggregate of the number of new bugs reported by individuals. Note the GROUP
                clause. The 'count' column will be made available to the row for evaluation and can
                be accessed as if it were part of the schema.
            </para>

            <para>

                <example id="zend.db.table.qry.rows.set.retrieving.b.example">

                    <title>Retrieving expressions as columns</title>

                    <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$select = $table->select();
$select->from($table, array('COUNT(reported_by) as `count`', 'reported_by'))
       ->where('bug_status = ?', 'NEW')
       ->group('reported_by');

$rows = $table->fetchAll($select);]]>
                    </programlisting>

                </example>

                You can also use a lookup as part of your query to further refine your fetch
                operations. In this example the accounts table is queried as part of a search for
                all new bugs reported by 'Bob'.
            </para>

            <para>

                <example id="zend.db.table.qry.rows.set.refine.example">

                    <title>Using a lookup table to refine the results of fetchAll()</title>

                    <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$select = $table->select();
$select->where('bug_status = ?', 'NEW')
       ->join('accounts', 'accounts.account_name = bugs.reported_by')
       ->where('accounts.account_name = ?', 'Bob');

$rows = $table->fetchAll($select);]]>
                    </programlisting>

                </example>

            </para>

            <para>
                The <classname>Zend_Db_Table_Select</classname> is primarily used to constrain and
                validate so that it may enforce the criteria for a legal SELECT query. However
                there may be certain cases where you require the flexibility of the
                Zend_Db_Table_Row component and do not require a writeable or deletable row. For
                this specific user case, it is possible to retrieve a row/rowset by passing a false
                value to setIntegrityCheck. The resulting row/rowset will be returned as a 'locked'
                row (meaning the save(), delete() and any field-setting methods will throw an
                exception).
            </para>

            <example id="zend.db.table.qry.rows.set.integrity.example">

                <title>Removing the integrity check on Zend_Db_Table_Select to allow JOINed rows</title>

                <programlisting><![CDATA[<?php
$table = new Bugs();

$select = $table->select()->setIntegrityCheck(false);
$select->where('bug_status = ?', 'NEW')
       ->join('accounts', 'accounts.account_name = bugs.reported_by', 'account_name')
       ->where('accounts.account_name = ?', 'Bob');

$rows = $table->fetchAll($select);]]>
                </programlisting>

            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.db.table.fetch-row">

        <title>Querying for a Single Row</title>

        <para>
            You can query for a single row using criteria similar to that of the
            <code>fetchAll()</code> method.
        </para>

        <example id="zend.db.table.fetch-row.example1">

            <title>Example of finding a single row by an expression</title>

            <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$select  = $table->select()->where('bug_status = ?', 'NEW')
                           ->order('bug_id');

$row = $table->fetchRow($select);]]>
            </programlisting>

        </example>

        <para>
            This method returns an object of type Zend_Db_Table_Row_Abstract. If the search
            criteria you specified match no rows in the database table, then
            <code>fetchRow()</code> returns PHP's <code>null</code> value.
        </para>

    </sect2>

    <sect2 id="zend.db.table.info">

        <title>Retrieving Table Metadata Information</title>

        <para>
            The Zend_Db_Table_Abstract class provides some information about its metadata. The
            <code>info()</code> method returns an array structure with information about the table,
            its columns and primary key, and other metadata.
        </para>

        <example id="zend.db.table.info.example">

            <title>Example of getting the table name</title>

            <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$info = $table->info();

echo "The table name is " . $info['name'] . "\n";]]>
            </programlisting>

        </example>

        <para>
            The keys of the array returned by the <code>info()</code> method are described below:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis role="strong">name</emphasis> => the name of the table.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">cols</emphasis> => an array, naming the column(s) of
                    the table.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">primary</emphasis> => an array, naming the column(s) in
                    the primary key.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">metadata</emphasis> => an associative array, mapping
                    column names to information about the columns. This is the information returned
                    by the <code>describeTable()</code> method.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">rowClass</emphasis> => the name of the concrete class
                    used for Row objects returned by methods of this table instance. This defaults
                    to Zend_Db_Table_Row.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">rowsetClass</emphasis> => the name of the concrete
                    class used for Rowset objects returned by methods of this table instance. This
                    defaults to Zend_Db_Table_Rowset.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">referenceMap</emphasis> => an associative array, with
                    information about references from this table to any parent tables. See
                    <xref linkend="zend.db.table.relationships.defining" />.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">dependentTables</emphasis> => an array of class names
                    of tables that reference this table. See
                    <xref linkend="zend.db.table.relationships.defining" />.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">schema</emphasis> => the name of the schema (or
                    database or tablespace) for this table.
                </para>
            </listitem>
        </itemizedlist>

    </sect2>

    <sect2 id="zend.db.table.metadata.caching">

        <title>Caching Table Metadata</title>

        <para>
            By default, <code>Zend_Db_Table_Abstract</code> queries the underlying database for
            <link linkend="zend.db.table.info">table metadata</link> upon instantiation of a table
            object. That is, when a new table object is created, the object's default behavior is
            to fetch the table metadata from the database using the adapter's
            <code>describeTable()</code> method.
        </para>

        <para>
            In some circumstances, particularly when many table objects are instantiated against
            the same database table, querying the database for the table metadata for each instance
            may be undesirable from a performance standpoint. In such cases, users may benefit by
            caching the table metadata retrieved from the database.
        </para>

        <para>
            There are two primary ways in which a user may take advantage of table metadata
            caching:

            <itemizedlist>
                <listitem>
                    <para>
                        <emphasis role="strong">Call
                        Zend_Db_Table_Abstract::setDefaultMetadataCache()</emphasis> - This allows
                        a developer to once set the default cache object to be used for all table
                        classes.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        <emphasis role="strong">Configure
                        Zend_Db_Table_Abstract::__construct()</emphasis> - This allows a developer
                        to set the cache object to be used for a particular table class instance.
                    </para>
                </listitem>
            </itemizedlist>

            In both cases, the cache specification must be either <code>null</code> (i.e., no cache
            used) or an instance of
            <link linkend="zend.cache.frontends.core"><code>Zend_Cache_Core</code></link>. The
            methods may be used in conjunction when it is desirable to have both a default metadata
            cache and the ability to change the cache for individual table objects.
        </para>

        <example id="zend.db.table.metadata.caching-default">

            <title>Using a Default Metadata Cache for all Table Objects</title>

            <para>
                The following code demonstrates how to set a default metadata cache to be used for
                all table objects:
            </para>

            <programlisting role="php"><![CDATA[<?php
// First, set up the Cache
require_once 'Zend/Cache.php';

$frontendOptions = array(
    'automatic_serialization' => true
    );

$backendOptions  = array(
    'cache_dir'                => 'cacheDir'
    );

$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);


// Next, set the cache to be used with all table objects
require_once 'Zend/Db/Table/Abstract.php';

Zend_Db_Table_Abstract::setDefaultMetadataCache($cache);


// A table class is also needed
class Bugs extends Zend_Db_Table_Abstract
{
    // ...
}


// Each instance of Bugs now uses the default metadata cache
$bugs = new Bugs();]]>
            </programlisting>

        </example>

        <example id="zend.db.table.metadata.caching-instance">

            <title>Using a Metadata Cache for a Specific Table Object</title>

            <para>
                The following code demonstrates how to set a metadata cache for a specific table
                object instance:
            </para>

            <programlisting role="php"><![CDATA[<?php
// First, set up the Cache
require_once 'Zend/Cache.php';

$frontendOptions = array(
    'automatic_serialization' => true
    );

$backendOptions  = array(
    'cache_dir'                => 'cacheDir'
    );

$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);

// A table class is also needed
require_once 'Zend/Db/Table/Abstract.php';

class Bugs extends Zend_Db_Table_Abstract
{
    // ...
}

// Configure an instance upon instantiation
$bugs = new Bugs(array('metadataCache' => $cache));]]>
            </programlisting>

        </example>

        <note>

            <title>Automatic Serialization with the Cache Frontend</title>

            <para>
                Since the information returned from the adapter's describeTable() method is an
                array, ensure that the <code>automatic_serialization</code> option is set to
                <code>true</code> for the <code>Zend_Cache_Core</code> frontend.
            </para>

        </note>

        <para>
            Though the above examples use <code>Zend_Cache_Backend_File</code>, developers may use
            whatever cache backend is appropriate for the situation. Please see
            <link linkend="zend.cache">Zend_Cache</link> for more information.
        </para>

    </sect2>

    <sect2 id="zend.db.table.extending">

        <title>Customizing and Extending a Table Class</title>

        <sect3 id="zend.db.table.extending.row-rowset">

            <title>Using Custom Row or Rowset Classes</title>

            <para>
                By default, methods of the Table class return a Rowset in instances of the concrete
                class Zend_Db_Table_Rowset, and Rowsets contain a collection of instances of the
                concrete class Zend_Db_Table_Row. You can specify an alternative class to use for
                either of these, but they must be classes that extend Zend_Db_Table_Rowset_Abstract
                and Zend_Db_Table_Row_Abstract, respectively.
            </para>

            <para>
                You can specify Row and Rowset classes using the Table constructor's options array,
                in keys <code>'rowClass'</code> and <code>'rowsetClass'</code> respectively.
                Specify the names of the classes using strings.
            </para>

            <example id="zend.db.table.extending.row-rowset.example">

                <title>Example of specifying the Row and Rowset classes</title>

                <programlisting role="php"><![CDATA[<?php
class My_Row extends Zend_Db_Table_Row_Abstract
{
    ...
}

class My_Rowset extends Zend_Db_Table_Rowset_Abstract
{
    ...
}

$table = new Bugs(
    array(
        'rowClass'    => 'My_Row',
        'rowsetClass' => 'My_Rowset'
    )
);

$where = $table->getAdapter()->quoteInto('bug_status = ?', 'NEW')

// Returns an object of type My_Rowset,
// containing an array of objects of type My_Row.
$rows = $table->fetchAll($where);]]>
                </programlisting>

            </example>

            <para>
                You can change the classes by specifying them with the <code>setRowClass()</code>
                and <code>setRowsetClass()</code> methods. This applies to rows and rowsets created
                subsequently; it does not change the class of any row or rowset objects you have
                created previously.
            </para>

            <example id="zend.db.table.extending.row-rowset.example2">

                <title>Example of changing the Row and Rowset classes</title>

                <programlisting role="php"><![CDATA[<?php
$table = new Bugs();

$where = $table->getAdapter()->quoteInto('bug_status = ?', 'NEW')

// Returns an object of type Zend_Db_Table_Rowset
// containing an array of objects of type Zend_Db_Table_Row.
$rowsStandard = $table->fetchAll($where);

$table->setRowClass('My_Row');
$table->setRowsetClass('My_Rowset');

// Returns an object of type My_Rowset,
// containing an array of objects of type My_Row.
$rowsCustom = $table->fetchAll($where);

// The $rowsStandard object still exists, and it is unchanged.]]>
                </programlisting>

            </example>

            <para>
                For more information on the Row and Rowset classes, see
                <xref linkend="zend.db.table.row" /> and <xref linkend="zend.db.table.rowset" />.
            </para>

        </sect3>

        <sect3 id="zend.db.table.extending.insert-update">

            <title>Defining Custom Logic for Insert, Update, and Delete</title>

            <para>
                You can override the <code>insert()</code> and <code>update()</code> methods in
                your Table class. This gives you the opportunity to implement custom code that is
                executed before performing the database operation. Be sure to call the parent class
                method when you are done.
            </para>

            <example id="zend.db.table.extending.insert-update.example">

                <title>Custom logic to manage timestamps</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';

    public function insert(array $data)
    {
        // add a timestamp
        if (empty($data['created_on'])) {
            $data['created_on'] = time();
        }
        return parent::insert($data);
    }

    public function update(array $data, $where)
    {
        // add a timestamp
        if (empty($data['updated_on'])) {
            $data['updated_on'] = time();
        }
        return parent::update($data, $where);
    }
}]]>
                </programlisting>

            </example>

            <para>
                You can also override the <code>delete()</code> method.
            </para>

        </sect3>

        <sect3 id="zend.db.table.extending.finders">

            <title>Define Custom Search Methods in Zend_Db_Table</title>

            <para>
                You can implement custom query methods in your Table class, if you have frequent
                need to do queries against this table with specific criteria. Most queries can be
                written using <code>fetchAll()</code>, but this requires that you duplicate code to
                form the query conditions if you need to run the query in several places in your
                application. Therefore it can be convenient to implement a method in the Table
                class to perform frequently-used queries against this table.
            </para>

            <example id="zend.db.table.extending.finders.example">

                <title>Custom method to find bugs by status</title>

                <programlisting role="php"><![CDATA[<?php
class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';

    public function findByStatus($status)
    {
        $where = $this->getAdapter()->quoteInto('bug_status = ?', $status);
        return $this->fetchAll($where, 'bug_id');
    }
}]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.table.extending.inflection">

            <title>Define Inflection in Zend_Db_Table</title>

            <para>
                Some people prefer that the table class name match a table name in the RDBMS by
                using a string transformation called <emphasis>inflection</emphasis>.
            </para>

            <para>
                For example, if your table class name is "<code>BugsProducts</code>", it would
                match the physical table in the database called "<code>bugs_products</code>," if
                you omit the explicit declaration of the <code>$_name</code> class property. In
                this inflection mapping, the class name spelled in "CamelCase" format would be
                transformed to lower case, and words are separated with an underscore.
            </para>

            <para>
                You can specify the database table name independently from the class name by
                declaring the table name with the <code>$_name</code> class property in each of
                your table classes.
            </para>

            <para>
                Zend_Db_Table_Abstract performs no inflection to map the class name to the table
                name. If you omit the declaration of <code>$_name</code> in your table class, the
                class maps to a database table that matches the spelling of the class name exactly.
            </para>

            <para>
                It is inappropriate to transform identifiers from the database, because this can
                lead to ambiguity or make some identifiers inaccessible. Using the SQL identifiers
                exactly as they appear in the database makes Zend_Db_Table_Abstract both simpler
                and more flexible.
            </para>

            <para>
                If you prefer to use inflection, then you must implement the transformation
                yourself, by overriding the <code>_setupTableName()</code> method in your Table
                classes. One way to do this is to define an abstract class that extends
                Zend_Db_Table_Abstract, and then the rest of your tables extend your new abstract
                class.
            </para>

            <example id="zend.db.table.extending.inflection.example">

                <title>Example of an abstract table class that implements inflection</title>

                <programlisting role="php"><![CDATA[<?php
abstract class MyAbstractTable extends Zend_Db_Table_Abstract
{
    protected function _setupTableName()
    {
        if (!$this->_name) {
            $this->_name = myCustomInflector(get_class($this));
        }
        parent::_setupTableName();
    }
}

class BugsProducts extends MyAbstractTable
{
}]]>
                </programlisting>

            </example>

            <para>
                You are responsible for writing the functions to perform inflection transformation.
                Zend Framework does not provide such a function.
            </para>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.db.table.row">

    <title>Zend_Db_Table_Row</title>

    <sect2 id="zend.db.table.row.introduction">

        <title>Introduction</title>

        <para>
            Zend_Db_Table_Row is a class that contains an individual row of a Zend_Db_Table object.
            When you run a query against a Table class, the result is returned in a set of
            Zend_Db_Table_Row objects. You can also use this object to create new rows and add them
            to the database table.
        </para>

        <para>
            Zend_Db_Table_Row is an implementation of the <ulink
            url="http://www.martinfowler.com/eaaCatalog/rowDataGateway.html">Row Data Gateway</ulink>
            pattern.
        </para>

    </sect2>

    <sect2 id="zend.db.table.row.read">

        <title>Fetching a Row</title>

        <para>
            Zend_Db_Table_Abstract provides methods <code>find()</code> and
            <code>fetchAll()</code>, which each return an object of type Zend_Db_Table_Rowset, and
            the method <code>fetchRow()</code>, which returns an object of type Zend_Db_Table_Row.
        </para>

        <example id="zend.db.table.row.read.example">

            <title>Example of fetching a row</title>

            <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$row = $bugs->fetchRow($bugs->select()->where('bug_id = ?', 1));]]>
            </programlisting>

        </example>

        <para>
            A Zend_Db_Table_Rowset object contains a collection of Zend_Db_Table_Row objects. See
            <xref linkend="zend.db.table.rowset" />.
        </para>

        <example id="zend.db.table.row.read.example-rowset">

            <title>Example of reading a row in a rowset</title>

            <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$rowset = $bugs->fetchAll($bugs->select()->where('bug_status = ?', 1));
$row = $rowset->current();]]>
            </programlisting>

        </example>

        <sect3 id="zend.db.table.row.read.get">

            <title>Reading column values from a row</title>

            <para>
                Zend_Db_Table_Row_Abstract provides accessor methods so you can reference columns
                in the row as object properties.
            </para>

            <example id="zend.db.table.row.read.get.example">

                <title>Example of reading a column in a row</title>

                <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$row = $bugs->fetchRow($bugs->select()->where('bug_id = ?', 1));

// Echo the value of the bug_description column
echo $row->bug_description;]]>
                </programlisting>

            </example>

            <note>

                <para>
                    Earlier versions of Zend_Db_Table_Row mapped these column accessors to the
                    database column names using a string transformation called
                    <emphasis>inflection</emphasis>.
                </para>

                <para>
                    Currently, Zend_Db_Table_Row does not implement inflection. Accessed property
                    names need to match the spelling of the column names as they appear in your
                    database.
                </para>

            </note>

        </sect3>

        <sect3 id="zend.db.table.row.read.to-array">

            <title>Retrieving Row Data as an Array</title>

            <para>
                You can access the row's data as an array using the <code>toArray()</code> method
                of the Row object. This returns an associative array of the colum names to the
                column values.
            </para>

            <example id="zend.db.table.row.read.to-array.example">

                <title>Example of using the toArray() method</title>

                <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$row = $bugs->fetchRow($bugs->select()->where('bug_id = ?', 1));

// Get the column/value associative array from the Row object
$rowArray = $row->toArray();

// Now use it as a normal array
foreach ($rowArray as $column => $value) {
    echo "Column: $column\n";
    echo "Value:  $value\n";
}]]>
                </programlisting>

            </example>

            <para>
                The array returned from <code>toArray()</code> is not updateable. You can modify
                values in the array as you can with any array, but you cannot save changes to this
                array to the database directly.
            </para>

        </sect3>

        <sect3 id="zend.db.table.row.read.relationships">

            <title>Fetching data from related tables</title>

            <para>
                The Zend_Db_Table_Row_Abstract class provides methods for fetching rows and rowsets
                from related tables. See <xref linkend="zend.db.table.relationships" /> for more
                information on table relationships.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.db.table.row.write">

        <title>Writing rows to the database</title>

        <sect3 id="zend.db.table.row.write.set">

            <title>Changing column values in a row</title>

            <para>
                You can set individual column values using column accessors, similar to how the
                columns are read as object properties in the example above.
            </para>

            <para>
                Using a column accessor to set a value changes the column value of the row object
                in your application, but it does not commit the change to the database yet. You can
                do that with the <code>save()</code> method.
            </para>

            <example id="zend.db.table.row.write.set.example">

                <title>Example of changing a column in a row</title>

                <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$row = $bugs->fetchRow($bugs->select()->where('bug_id = ?', 1));

// Change the value of one or more columns
$row->bug_status = 'FIXED';

// UPDATE the row in the database with new values
$row->save();]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.table.row.write.insert">

            <title>Inserting a new row</title>

            <para>
                You can create a new row for a given table with the <code>createRow()</code> method
                of the table class. You can access fields of this row with the object-oriented
                interface, but the row is not stored in the database until you call the
                <code>save()</code> method.
            </para>

            <example id="zend.db.table.row.write.insert.example">

                <title>Example of creating a new row for a table</title>

                <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$newRow = $bugs->createRow();

// Set column values as appropriate for your application
$newRow->bug_description = '...description...';
$newRow->bug_status = 'NEW';

// INSERT the new row to the database
$newRow->save();]]>
                </programlisting>

            </example>

            <para>
                The optional argument to the createRow() method is an associative array, with which
                you can populate fields of the new row.
            </para>

            <example id="zend.db.table.row.write.insert.example2">

                <title>Example of populating a new row for a table</title>

                <programlisting role="php"><![CDATA[<?php
$data = array(
    'bug_description' => '...description...',
    'bug_status'      => 'NEW'
);

$bugs = new Bugs();
$newRow = $bugs->createRow($data);

// INSERT the new row to the database
$newRow->save();]]>
                </programlisting>

            </example>

            <note>

                <para>
                    The <code>createRow()</code> method was called <code>fetchNew()</code> in
                    earlier releases of Zend_Db_Table. You are encouraged to use the new method
                    name, even though the old name continues to work for the sake of backward
                    compatibility.
                </para>

            </note>

        </sect3>

        <sect3 id="zend.db.table.row.write.set-from-array">

            <title>Changing values in multiple columns</title>

            <para>
                Zend_Db_Table_Row_Abstract provides the <code>setFromArray()</code> method to
                enable you to set several columns in a single row at once, specified in an
                associative array that maps the column names to values. You may find this method
                convenient for setting values both for new rows and for rows you need to update.
            </para>

            <example id="zend.db.table.row.write.set-from-array.example">

                <title>Example of using setFromArray() to set values in a new Row</title>

                <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$newRow = $bugs->createRow();

// Data are arranged in an associative array
$data = array(
    'bug_description' => '...description...',
    'bug_status'      => 'NEW'
);

// Set all the column values at once
$newRow->setFromArray($data);

// INSERT the new row to the database
$newRow->save();]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.table.row.write.delete">

            <title>Deleting a row</title>

            <para>
                You can call the <code>delete()</code> method on a Row object. This deletes rows in
                the database matching the primary key in the Row object.
            </para>

            <example id="zend.db.table.row.write.delete.example">

                <title>Example of deleting a row</title>

                <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$row = $bugs->fetchRow('bug_id = 1');

// DELETE this row
$row->delete();]]>
                </programlisting>

            </example>

            <para>
                You do not have to call <code>save()</code> to apply the delete; it is executed
                against the database immediately.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.db.table.row.serialize">

        <title>Serializing and unserializing rows</title>

        <para>
            It is often convenient to save the contents of a database row to be used later.
            <emphasis>Serialization</emphasis> is the name for the operation that converts an
            object into a form that is easy to save in offline storage (for example, a file).
            Objects of type Zend_Db_Table_Row_Abstract are serializable.
        </para>

        <sect3 id="zend.db.table.row.serialize.serializing">

            <title>Serializing a Row</title>

            <para>
                Simply use PHP's <code>serialize()</code> function to create a string containing a
                byte-stream representation of the Row object argument.
            </para>

            <example id="zend.db.table.row.serialize.serializing.example">

                <title>Example of serializing a row</title>

                <programlisting role="php"><![CDATA[<?php
$bugs = new Bugs();
$row = $bugs->fetchRow('bug_id = 1');

// Convert object to serialized form
$serializedRow = serialize($row);

// Now you can write $serializedRow to a file, etc.]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.table.row.serialize.unserializing">

            <title>Unserializing Row Data</title>

            <para>
                Use PHP's <code>unserialize()</code> function to restore a string containing a
                byte-stream representation of an object. The function returns the original object.
            </para>

            <para>
                Note that the Row object returned is in a <emphasis>disconnected</emphasis> state.
                You can read the Row object and its properties, but you cannot change values in the
                Row or execute other methods that require a database connection (for example,
                queries against related tables).
            </para>

            <example id="zend.db.table.row.serialize.unserializing.example">

                <title>Example of unserializing a serialized row</title>

                <programlisting role="php"><![CDATA[<?php
$rowClone = unserialize($serializedRow);

// Now you can use object properties, but read-only
echo $rowClone->bug_description;]]>
                </programlisting>

            </example>

            <note>

                <title>Why do Rows unserialize in a disconnected state?</title>

                <para>
                    A serialized object is a string that is readable to anyone who possesses it. It
                    could be a security risk to store parameters such as database account and
                    password in plain, unencrypted text in the serialized string. You would not
                    want to store such data to a text file that is not protected, or send it in an
                    email or other medium that is easily read by potential attackers. The reader of
                    the serialized object should not be able to use it to gain access to your
                    database without knowing valid credentials.
                </para>

            </note>

        </sect3>

        <sect3 id="zend.db.table.row.serialize.set-table">

            <title>Reactivating a Row as Live Data</title>

            <para>
                You can reactivate a disconnected Row, using the <code>setTable()</code> method.
                The argument to this method is a valid object of type Zend_Db_Table_Abstract, which
                you create. Creating a Table object requires a live connection to the database, so
                by reassociating the Table with the Row, the Row gains access to the database.
                Subsequently, you can change values in the Row object and save the changes to the
                database.
            </para>

            <example id="zend.db.table.row.serialize.set-table.example">

                <title>Example of reactivating a row</title>

                <programlisting role="php"><![CDATA[<?php
$rowClone = unserialize($serializedRow);

$bugs = new Bugs();

// Reconnect the row to a table, and
// thus to a live database connection
$rowClone->setTable($bugs);

// Now you can make changes to the row and save them
$rowClone->bug_status = 'FIXED';
$rowClone->save();]]>
                </programlisting>

            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.db.table.row.extending">

        <title>Extending the Row class</title>

        <para>
            Zend_Db_Table_Row is the default concrete class that extends
            Zend_Db_Table_Row_Abstract. You can define your own concrete class for instances of Row
            by extending Zend_Db_Table_Row_Abstract. To use your new Row class to store results of
            Table queries, specify the custom Row class by name either in the
            <code>$_rowClass</code> protected member of a Table class, or in the array argument of
            the constructor of a Table object.
        </para>

        <example id="zend.db.table.row.extending.example">

            <title>Specifying a custom Row class</title>

            <programlisting role="php"><![CDATA[<?php
class MyRow extends Zend_Db_Table_Row_Abstract
{
    // ...customizations
}

// Specify a custom Row to be used by default
// in all instances of a Table class.
class Products extends Zend_Db_Table_Abstract
{
    protected $_name = 'products';
    protected $_rowClass = 'MyRow';
}

// Or specify a custom Row to be used in one
// instance of a Table class.
$bugs = new Bugs(array('rowClass' => 'MyRow'));]]>
            </programlisting>

        </example>

        <sect3 id="zend.db.table.row.extending.overriding">

            <title>Row initialization</title>

            <para>
                If application-specific logic needs to be initialized when a row is constructed,
                you can select to move your tasks to the <code>init()</code> method, which is
                called after all row metadata has been processed. This is recommended over the
                <code>__construct</code> method if you do not need to alter the metadata in any
                programmatic way.

                <example id="zend.db.table.row.init.usage.example">

                    <title>Example usage of init() method</title>

                    <programlisting role="php"><![CDATA[<?php
class MyApplicationRow extends Zend_Db_Table_Row_Abstract
{
    protected $_role;

    protected function init()
    {
        $this->_role = new MyRoleClass();
    }
}]]>
                    </programlisting>

                </example>

            </para>

        </sect3>

        <sect3 id="zend.db.table.row.extending.insert-update">

            <title>Defining Custom Logic for Insert, Update, and Delete in Zend_Db_Table_Row</title>

            <para>
                The Row class calls protected methods <code>_insert()</code>,
                <code>_update()</code>, and <code>_delete()</code> before performing the
                corresponding operations <code>INSERT</code>, <code>UPDATE</code>, and
                <code>DELETE</code>. You can add logic to these methods in your custom Row
                subclass.
            </para>

            <para>
                If you need to do custom logic in a specific table, and the custom logic must occur
                for every operation on that table, it may make more sense to implement your custom
                code in the <code>insert()</code>, <code>update()</code> and <code>delete()</code>
                methods of your Table class. However, sometimes it may be necessary to do custom
                logic in the Row class.
            </para>

            <para>
                Below are some example cases where it might make sense to implement custom logic in
                a Row class instead of in the Table class:
            </para>

            <example id="zend.db.table.row.extending.overriding-example1">

                <title>Example of custom logic in a Row class</title>

                <para>
                    The custom logic may not apply in all cases of operations on the respective
                    Table. You can provide custom logic on demand by implementing it in a Row class
                    and creating an instance of the Table class with that custom Row class
                    specified. Otherwise, the Table uses the default Row class.
                </para>

                <para>
                    You need data operations on this table to record the operation to a
                    Zend_Log object, but only if the application configuration has enabled this
                    behavior.
                </para>

                <programlisting role="php"><![CDATA[<?php
class MyLoggingRow extends Zend_Db_Table_Row_Abstract
{
    protected function _insert()
    {
        $log = Zend_Registry::get('database_log');
        $log->info(Zend_Debug::dump($this->_data, "INSERT: $this->_tableClass", false));
    }
}

// $loggingEnabled is an example property that depends
// on your application configuration
if ($loggingEnabled) {
    $bugs = new Bugs(array('rowClass' => 'MyLoggingRow'));
} else {
    $bugs = new Bugs();
}]]>
                </programlisting>

            </example>

            <example id="zend.db.table.row.extending.overriding-example2">

                <title>Example of a Row class that logs insert data for multiple tables</title>

                <para>
                    The custom logic may be common to multiple tables. Instead of implementing the
                    same custom logic in every one of your Table classes, you can implement the
                    code for such actions in the definition of a Row class, and use this Row in
                    each of your Table classes.
                </para>

                <para>
                    In this example, the logging code is identical in all table classes.
                </para>

                <programlisting role="php"><![CDATA[<?php
class MyLoggingRow extends Zend_Db_Table_Row_Abstract
{
    protected function _insert()
    {
        $log = Zend_Registry::get('database_log');
        $log->info(Zend_Debug::dump($this->_data, "INSERT: $this->_tableClass", false));
    }
}

class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';
    protected $_rowClass = 'MyLoggingRow';
}

class Products extends Zend_Db_Table_Abstract
{
    protected $_name = 'products';
    protected $_rowClass = 'MyLoggingRow';
}]]>
                </programlisting>

            </example>

        </sect3>

        <sect3 id="zend.db.table.row.extending.inflection">

            <title>Define Inflection in Zend_Db_Table_Row</title>

            <para>
                Some people prefer that the table class name match a table name in the RDBMS by
                using a string transformation called <emphasis>inflection</emphasis>.
            </para>

            <para>
                Zend_Db classes do not implement inflection by default. See
                <xref linkend="zend.db.table.extending.inflection" /> for an explanation of this
                policy.
            </para>

            <para>
                If you prefer to use inflection, then you must implement the transformation yourself,
                by overriding the <code>_transformColumn()</code> method in a custom Row class, and
                using that custom Row class when you perform queries against your Table class.
            </para>

            <example id="zend.db.table.row.extending.inflection.example">

                <title>Example of defining an inflection transformation</title>

                <para>
                    This allows you to use an inflected version of the column name in the
                    accessors. The Row class uses the <code>_transformColumn()</code> method to
                    change the name you use to the native column name in the database table.
                </para>

                <programlisting role="php"><![CDATA[<?php
class MyInflectedRow extends Zend_Db_Table_Row_Abstract
{
    protected function _transformColumn($columnName)
    {
        $nativeColumnName = myCustomInflector($columnName);
        return $nativeColumnName;
    }
}

class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';
    protected $_rowClass = 'MyInflectedRow';
}

$bugs = new Bugs();
$row = $bugs->fetchNew();

// Use camelcase column names, and rely on the
// transformation function to change it into the
// native representation.
$row->bugDescription = 'New description';]]>
                </programlisting>

            </example>

            <para>
                You are responsible for writing the functions to perform inflection transformation.
                Zend Framework does not provide such a function.
            </para>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.db.table.rowset">

    <title>Zend_Db_Table_Rowset</title>

    <sect2 id="zend.db.table.rowset.introduction">

        <title>Introduction</title>

        <para>
            When you run a query against a Table class using the <code>find()</code> or <code>fetchAll()</code>
            methods, the result is returned in an object of type <code>Zend_Db_Table_Rowset_Abstract</code>. A Rowset
            contains a collection of objects descending from <code>Zend_Db_Table_Row_Abstract</code>. You can iterate
            through the Rowset and access individual Row objects, reading or modifying data in the Rows.
        </para>

    </sect2>

    <sect2 id="zend.db.table.rowset.fetch">

        <title>Fetching a Rowset</title>

        <para>
            <code>Zend_Db_Table_Abstract</code> provides methods <code>find()</code> and <code>fetchAll()</code>, each
            of which returns an object of type <code>Zend_Db_Table_Rowset_Abstract</code>.
        </para>

        <example id="zend.db.table.rowset.fetch.example">

            <title>Example of fetching a rowset</title>

            <programlisting role="php"><![CDATA[<?php

$bugs   = new Bugs();
$rowset = $bugs->fetchAll("bug_status = 'NEW'");]]></programlisting>

        </example>

    </sect2>

    <sect2 id="zend.db.table.rowset.rows">

        <title>Retrieving Rows from a Rowset</title>

        <para>
            The Rowset itself is usually less interesting than the Rows that it contains. This section illustrates how
            to get the Rows that comprise the Rowset.
        </para>

        <para>
            A legitimate query returns zero rows when no rows in the database match the query conditions. Therefore, a
            Rowset object might contain zero Row objects. Since <code>Zend_Db_Table_Rowset_Abstract</code> implements
            the <code>Countable</code> interface, you can use <code>count()</code> to determine the number of Rows in
            the Rowset.
        </para>

        <example id="zend.db.table.rowset.rows.counting.example">

            <title>Counting the Rows in a Rowset</title>

            <programlisting role="php"><![CDATA[<?php

$rowset   = $bugs->fetchAll("bug_status = 'FIXED'");

$rowCount = count($rowset);

if ($rowCount > 0) {
    echo "found $rowCount rows";
} else {
    echo 'no rows matched the query';
}]]></programlisting>

        </example>

        <example id="zend.db.table.rowset.rows.current.example">

            <title>Reading a Single Row from a Rowset</title>

            <para>
                The simplest way to access a Row from a Rowset is to use the <code>current()</code> method. This is
                particularly appropriate when the Rowset contains exactly one Row.
            </para>

            <programlisting role="php"><![CDATA[<?php

$bugs   = new Bugs();
$rowset = $bugs->fetchAll("bug_id = 1");
$row    = $rowset->current();]]></programlisting>

        </example>

        <para>
            If the Rowset contains zero rows, <code>current()</code> returns
            PHP's <code>null</code> value.
        </para>

        <example id="zend.db.table.rowset.rows.iterate.example">

            <title>Iterating through a Rowset</title>

            <para>
                Objects descending from <code>Zend_Db_Table_Rowset_Abstract</code> implement the <code>SeekableIterator</code>
                interface, which means you can loop through them using the <code>foreach</code> construct. Each value
                you retrieve this way is a <code>Zend_Db_Table_Row_Abstract</code> object that corresponds to one
                record from the table.
            </para>

            <programlisting role="php"><![CDATA[<?php

$bugs = new Bugs();

// fetch all records from the table
$rowset = $bugs->fetchAll();

foreach ($rowset as $row) {

    // output 'Zend_Db_Table_Row' or similar
    echo get_class($row) . "\n";

    // read a column in the row
    $status = $row->bug_status;

    // modify a column in the current row
    $row->assigned_to = 'mmouse';

    // write the change to the database
    $row->save();
}]]></programlisting>

        </example>

         <example id="zend.db.table.rowset.rows.seek.example">

            <title>Seeking to a known position into a Rowset</title>

            <para>
                <code>SeekableIterator</code> allows you to seek to a position that you would like the iterator to jump to.
                Simply use the <code>seek()</code> method for that. Pass it an integer representing the number of the Row
                you would like your Rowset to point to next, don't forget that it starts with index 0. If the index is wrong,
                ie doesn't exist, an exception will be thrown. You should use <code>count()</code> to check the number of
                results before seeking to a position.
            </para>

            <programlisting role="php"><![CDATA[<?php

$bugs = new Bugs();

// fetch all records from the table
$rowset = $bugs->fetchAll();

// takes the iterator to the 9th element (zero is one element) :
$rowset->seek(8);

// retrive it
$row9 = $rowset->current();

// and use it
$row9->assigned_to = 'mmouse';
$row9->save();]]></programlisting>

        </example>

            <para>
                <code>getRow()</code> allows you to get a specific row in the Rowset, knowing its position; don't forget
                however that positions start with index zero. The first parameter for <code>getRow()</code> is an integer
                for the position asked. The second optional parameter is a boolean; it tells the Rowset iterator if it must
                seek to that position in the same time, or not (default is false). This method returns a Zend_Db_Table_Row
                object by default. If the position requested does not exist, an exception will be thrown. Here is an example :
            </para>

            <programlisting role="php"><![CDATA[<?php

$bugs = new Bugs();

// fetch all records from the table
$rowset = $bugs->fetchAll();

// retrieve the 9th element immediatly :
$row9->getRow(8);

// and use it :
$row9->assigned_to = 'mmouse';
$row9->save();
}]]></programlisting>



        <para>
            After you have access to an individual Row object, you can manipulate the Row using methods described in
            <xref linkend="zend.db.table.row" />.
        </para>

    </sect2>

    <sect2 id="zend.db.table.rowset.to-array">

        <title>Retrieving a Rowset as an Array</title>

        <para>
            You can access all the data in the Rowset as an array using the <code>toArray()</code> method of the Rowset
            object. This returns an array containing one entry per Row. Each entry is an associative array having keys
            that correspond to column names and elements that correspond to the respective column values.
        </para>

        <example id="zend.db.table.rowset.to-array.example">

            <title>Using toArray()</title>

            <programlisting role="php"><![CDATA[<?php

$bugs   = new Bugs();
$rowset = $bugs->fetchAll();

$rowsetArray = $rowset->toArray();

$rowCount = 1;
foreach ($rowsetArray as $rowArray) {
    echo "row #$rowCount:\n";
    foreach ($rowArray as $column => $value) {
        echo "\t$column => $value\n";
    }
    ++$rowCount;
    echo "\n";
}]]></programlisting>
        </example>

        <para>
            The array returned from <code>toArray()</code> is not updateable. That is, you can modify values in the
            array as you can with any array, but changes to the array data are not propagated to the database.
        </para>

    </sect2>

    <sect2 id="zend.db.table.rowset.serialize">

        <title>Serializing and Unserializing a Rowset</title>

        <para>
            Objects of type <code>Zend_Db_Table_Rowset_Abstract</code> are serializable. In a similar fashion to
            serializing an individual Row object, you can serialize a Rowset and unserialize it later.
        </para>

        <example id="zend.db.table.rowset.serialize.example.serialize">

            <title>Serializing a Rowset</title>

            <para>
                Simply use PHP's <code>serialize()</code> function to create a string containing a byte-stream
                representation of the Rowset object argument.
            </para>

            <programlisting role="php"><![CDATA[<?php

$bugs   = new Bugs();
$rowset = $bugs->fetchAll();

// Convert object to serialized form
$serializedRowset = serialize($rowset);

// Now you can write $serializedRowset to a file, etc.]]></programlisting>

        </example>

        <example id="zend.db.table.rowset.serialize.example.unserialize">

            <title>Unserializing a Serialized Rowset</title>

            <para>
                Use PHP's <code>unserialize()</code> function to restore a string containing a byte-stream
                representation of an object.  The function returns the original object.
            </para>

            <para>
                Note that the Rowset object returned is in a <emphasis>disconnected</emphasis> state. You can iterate
                through the Rowset and read the Row objects and their properties, but you cannot change values in the
                Rows or execute other methods that require a database connection (for example, queries against related
                tables).
            </para>

            <programlisting role="php"><![CDATA[<?php

$rowsetDisconnected = unserialize($serializedRowset);

// Now you can use object methods and properties, but read-only
$row = $rowsetDisconnected->current();
echo $row->bug_description;]]></programlisting>

        </example>

        <note>
            <title>Why do Rowsets unserialize in a disconnected state?</title>
            <para>
                A serialized object is a string that is readable to anyone who possesses it. It could be a security
                risk to store parameters such as database account and password in plain, unencrypted text in the
                serialized string. You would not want to store such data to a text file that is not protected, or send
                it in an email or other medium that is easily read by potential attackers. The reader of the serialized
                object should not be able to use it to gain access to your database without knowing valid credentials.
            </para>
        </note>

        <para>
            You can reactivate a disconnected Rowset using the <code>setTable()</code> method.  The argument to this
            method is a valid object of type <code>Zend_Db_Table_Abstract</code>, which you create.  Creating a Table
            object requires a live connection to the database, so by reassociating the Table with the Rowset, the
            Rowset gains access to the database.  Subsequently, you can change values in the Row objects contained in
            the Rowset and save the changes to the database.
        </para>

        <example id="zend.db.table.rowset.serialize.example.set-table">

            <title>Reactivating a Rowset as Live Data</title>

            <programlisting role="php"><![CDATA[<?php

$rowset = unserialize($serializedRowset);

$bugs = new Bugs();

// Reconnect the rowset to a table, and
// thus to a live database connection
$rowset->setTable($bugs);

$row = $rowset->current();

// Now you can make changes to the row and save them
$row->bug_status = 'FIXED';
$row->save();]]></programlisting>

        </example>

        <para>
            Reactivating a Rowset with <code>setTable()</code> also reactivates all the Row objects contained in that
            Rowset.
        </para>

    </sect2>

    <sect2 id="zend.db.table.rowset.extending">

        <title>Extending the Rowset class</title>

        <para>
            You can use an alternative concrete class for instances of Rowsets
            by extending Zend_Db_Table_Rowset_Abstract.  Specify the custom
            Rowset class by name either in the <code>$_rowsetClass</code>
            protected member of a Table class, or in the array argument of the
            constructor of a Table object.
        </para>

        <example id="zend.db.table.rowset.extending.example">
            <title>Specifying a custom Rowset class</title>
            <programlisting role="php"><![CDATA[<?php

class MyRowset extends Zend_Db_Table_Rowset_Abstract
{
    // ...customizations
}

// Specify a custom Rowset to be used by default
// in all instances of a Table class.
class Products extends Zend_Db_Table_Abstract
{
    protected $_name = 'products';
    protected $_rowsetClass = 'MyRowset';
}

// Or specify a custom Rowset to be used in one
// instance of a Table class.
$bugs = new Bugs(array('rowsetClass' => 'MyRowset'));]]></programlisting>
        </example>

        <para>
            Typically, the standard Zend_Db_Rowset concrete class is
            sufficient for most usage.  However, you might find it useful
            to add new logic to a Rowset, specific to a given Table.
            For example, a new method could calculate an aggregate
            over all the Rows in the Rowset.
        </para>

        <example id="zend.db.table.rowset.extending.example-aggregate">
            <title>Example of Rowset class with a new method</title>
            <programlisting role="php"><![CDATA[<?php

class MyBugsRowset extends Zend_Db_Table_Rowset_Abstract
{
    /**
     * Find the Row in the current Rowset with the
     * greatest value in its 'updated_at' column.
     */
    public function getLatestUpdatedRow()
    {
        $max_updated_at = 0;
        $latestRow = null;
        foreach ($this as $row) {
            if ($row->updated_at > $max_updated_at) {
                $latestRow = $row;
            }
        }
        return $latestRow;
    }
}

class Bugs extends Zend_Db_Table_Abstract
{
    protected $_name = 'bugs';
    protected $_rowsetClass = 'MyBugsRowset';
}]]></programlisting>
        </example>

    </sect2>


</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.debug.dumping">

    <title>Dumping Variables</title>

    <para>
        The static method <code>Zend_Debug::dump()</code> prints or returns
        information about an expression.  This simple technique of debugging is
        common, because it is easy to use in an ad hoc fashion, and requires no
        initialization, special tools, or debugging environment.
    </para>

    <example id="zend.debug.dumping.example">
        <title>Example of dump() method</title>
        <programlisting role="php"><![CDATA[<?php

Zend_Debug::dump($var, $label=null, $echo=true);]]></programlisting>
    </example>

    <para>
        The <code>$var</code> argument specifies the expression or variable
        about which the <code>Zend_Debug::dump()</code> method outputs
        information.
    </para>

    <para>
        The <code>$label</code> argument is a string to be prepended to the
        output of <code>Zend_Debug::dump()</code>.  It may be useful, for
        example, to use labels if you are dumping information about multiple
        variables on a given screen.
    </para>

    <para>
        The boolean <code>$echo</code> argument specifies whether the output
        of <code>Zend_Debug::dump()</code> is echoed or not.
        If <code>true</code>, the output is echoed.
        Regardless of the value of the <code>$echo</code> argument, the
        return value of this method contains the output.
    </para>

    <para>
        It may be helpful to understand that internally,
        <code>Zend_Debug::dump()</code> method wraps the PHP function
        <ulink url="http://php.net/var_dump"><code>var_dump()</code></ulink>.
        If the output stream is detected as a web presentation,
        the output of <code>var_dump()</code> is escaped using
        <ulink url="http://php.net/htmlspecialchars"><code>htmlspecialchars()</code></ulink>
        and wrapped with (X)HTML <code>&lt;pre&gt;</code> tags.
    </para>

    <tip>
        <title>Debugging with Zend_Log</title>
        <para>
            Using <code>Zend_Debug::dump()</code> is best for ad hoc
            debugging during software development.  You can add code to dump
            a variable and then remove the code very quickly.
        </para>
        <para>
            Also consider the <link linkend="zend.log.overview">Zend_Log</link>
            component when writing more permanent debugging code.
            For example, you can use the <code>DEBUG</code> log level and the
            Stream log writer, to output the string returned by
            <code>Zend_Debug::dump()</code>.
        </para>
    </tip>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.exception.using">

    <title>Using Exceptions</title>

    <para>
        All exceptions thrown by Zend Framework classes should throw
        an exception that derives from the base class Zend_Exception.
    </para>

    <example id="zend.exception.using.example">
        <title>Example of catching an exception</title>
        <programlisting role="php"><![CDATA[<?php

try {
    Zend_Loader::loadClass('nonexistantclass');
} catch (Zend_Exception $e) {
    echo "Caught exception: " . get_class($e) . "\n";
    echo "Message: " . $e->getMessage() . "\n";
    // other code to recover from the failure.
}]]></programlisting>
    </example>

    <para>
        See the documentation for each respective Zend Framework
        component for more specific information on which methods
        throw exceptions, the circumstances for the exceptions,
        and which exception classes derive from Zend_Exception.
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.feed.consuming-atom">
<title>Consuming an Atom Feed</title>

    <para>
        <code>Zend_Feed_Atom</code> is used in much the same way as <code>Zend_Feed_Rss</code>. It provides
        the same access to feed-level properties and iteration over entries in the feed. The main
        difference is in the structure of the Atom protocol itself. Atom is a successor to RSS; it is more
        generalized protocol and it is designed to deal more easily with feeds that provide their full
        content inside the feed, splitting RSS' <code>description</code> tag into two elements,
        <code>summary</code> and <code>content</code>, for that purpose.
    </para>

    <example id="zend.feed.consuming-atom.example.usage">
        <title>Basic Use of an Atom Feed</title>
        <para>
            Read an Atom feed and print the <code>title</code> and <code>summary</code> of each entry:
        </para>
        <programlisting role="php"><![CDATA[<?php

$feed = new Zend_Feed_Atom('http://atom.example.com/feed/');
echo 'The feed contains ' . $feed->count() . ' entries.' . "\n\n";
foreach ($feed as $entry) {
    echo 'Title: ' . $entry->title() . "\n";
    echo 'Summary: ' . $entry->summary() . "\n\n";
}]]></programlisting>
    </example>

    <para>
        In an Atom feed you can expect to find the following feed properties:
    </para>

    <para>
        <itemizedlist>
            <listitem>
                <para><code>title</code> - The feed's title, same as RSS's channel title</para>
            </listitem>
            <listitem>
                <para><code>id</code> - Every feed and entry in Atom has a unique identifier</para>
            </listitem>
            <listitem>
                <para><code>link</code> - Feeds can have multiple links, which are distinguished by a
                <code>type</code> attribute</para>
                <para>
                    The equivalent to RSS's channel link would be <code>type="text/html"</code>. If the link
                    is to an alternate version of the same content that's in the feed, it would have a
                    <code>rel="alternate"</code> attribute.
                </para>
            </listitem>
            <listitem>
                <para><code>subtitle</code> - The feed's description, equivalent to RSS' channel description
                </para>
                <para><code>author->name()</code> - The feed author's name</para>
                <para><code>author->email()</code> - The feed author's email address</para>
            </listitem>
        </itemizedlist>
    </para>

    <para>
        Atom entries commonly have the following properties:
    </para>

    <para>
        <itemizedlist>
            <listitem>
                <para><code>id</code> - The entry's unique identifier</para>
            </listitem>
            <listitem>
                <para><code>title</code> - The entry's title, same as RSS item titles</para>
            </listitem>
            <listitem>
                <para><code>link</code> - A link to another format or an alternate view of this entry</para>
            </listitem>
            <listitem>
                <para><code>summary</code> - A summary of this entry's content</para>
            </listitem>
            <listitem>
                <para><code>content</code> - The full content of the entry; can be skipped if the feed just
                contains summaries</para>
            </listitem>
            <listitem>
                <para><code>author</code> - with <code>name</code> and <code>email</code> sub-tags like
                feeds have</para>
            </listitem>
            <listitem>
                <para><code>published</code> - the date the entry was published, in RFC 3339 format</para>
            </listitem>
            <listitem>
                <para><code>updated</code> - the date the entry was last updated, in RFC 3339 format</para>
            </listitem>
        </itemizedlist>
    </para>

    <para>
        For more information on Atom and plenty of resources, see
        <ulink url="http://www.atomenabled.org/">http://www.atomenabled.org/</ulink>.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.feed.consuming-atom-single-entry">
    <title>Consuming a Single Atom Entry</title>

    <para>
        Single Atom <code>&lt;entry&gt;</code> elements are also valid by themselves. Usually the URL for an
        entry is the feed's URL followed by <code>/&lt;entryId&gt;</code>, such as
        <code>http://atom.example.com/feed/1</code>, using the example URL we used above.
    </para>

    <para>
        If you read a single entry, you will still have a <code>Zend_Feed_Atom</code> object, but it will
        automatically create an "anonymous" feed to contain the entry.
    </para>

    <example id="zend.feed.consuming-atom-single-entry.example.atom">
        <title>Reading a Single-Entry Atom Feed</title>
        <programlisting role="php"><![CDATA[<?php

$feed = new Zend_Feed_Atom('http://atom.example.com/feed/1');
echo 'The feed has: ' . $feed->count() . ' entry.';

$entry = $feed->current();]]></programlisting>
    </example>

    <para>
        Alternatively, you could instantiate the entry object directly if you know you are accessing an
        <code>&lt;entry&gt;</code>-only document:
    </para>

    <example id="zend.feed.consuming-atom-single-entry.example.entryatom">
        <title>Using the Entry Object Directly for a Single-Entry Atom Feed</title>
        <programlisting role="php"><![CDATA[<?php

$entry = new Zend_Feed_Entry_Atom('http://atom.example.com/feed/1');
echo $entry->title();]]></programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.feed.consuming-rss">
    <title>Consuming an RSS Feed</title>
    <para>
        Reading an RSS feed is as simple as instantiating a <code>Zend_Feed_Rss</code> object with the URL
        of the feed:
    </para>
    <programlisting role="php"><![CDATA[<?php
$channel = new Zend_Feed_Rss('http://rss.example.com/channelName');]]>
    </programlisting>
    <para>
        If any errors occur fetching the feed, a <code>Zend_Feed_Exception</code> will be thrown.
    </para>

    <para>
        Once you have a feed object, you can access any of the standard RSS "channel" properties directly
        on the object:
    </para>
    <programlisting role="php"><![CDATA[<?php
echo $channel->title();]]>
    </programlisting>
    <para>
        Note the function syntax. <code>Zend_Feed</code> uses a convention of treating properties as XML
        object if they are requested with variable "getter" syntax (<code>$obj->property</code>) and as
        strings if they are access with method syntax (<code>$obj->property()</code>). This enables access
        to the full text of any individual node while still allowing full access to all children.
    </para>

    <para>
        If channel properties have attributes, they are accessible using PHP's array syntax:
    </para>
    <programlisting role="php"><![CDATA[<?php
echo $channel->category['domain'];]]>
    </programlisting>
    <para>
        Since XML attributes cannot have children, method syntax is not necessary for accessing attribute
        values.
    </para>

    <para>
        Most commonly you'll want to loop through the feed and do something with its entries.
        <code>Zend_Feed_Abstract</code> implements PHP's <code>Iterator</code> interface, so printing all
        titles of articles in a channel is just a matter of:
    </para>
    <programlisting role="php"><![CDATA[<?php
foreach ($channel as $item) {
    echo $item->title() . "\n";
}]]>
    </programlisting>
    <para>
        If you are not familiar with RSS, here are the standard elements you can expect to be available in
        an RSS channel and in individual RSS items (entries).
    </para>

    <para>
        Required channel elements:
    </para>

    <para>
        <itemizedlist>
            <listitem>
                <para><code>title</code> - The name of the channel</para>
            </listitem>
            <listitem>
                <para><code>link</code> - The URL of the web site corresponding to the channel</para>
            </listitem>
            <listitem>
                <para><code>description</code> - A sentence or several describing the channel</para>
            </listitem>
        </itemizedlist>
    </para>

    <para>
        Common optional channel elements:
    </para>

    <para>
        <itemizedlist>
            <listitem>
                <para><code>pubDate</code> - The publication date of this set of content, in RFC 822 date
                format</para>
            </listitem>
            <listitem>
                <para><code>language</code> - The language the channel is written in</para>
            </listitem>
            <listitem>
                <para><code>category</code> - One or more (specified by multiple tags) categories the
                channel belongs to</para>
            </listitem>
        </itemizedlist>
    </para>

    <para>
        RSS <code>&lt;item&gt;</code> elements do not have any strictly required elements. However, either
        <code>title</code> or <code>description</code> must be present.
    </para>

    <para>
        Common item elements:
    </para>

    <para>
        <itemizedlist>
            <listitem>
                <para><code>title</code> - The title of the item</para>
            </listitem>
            <listitem>
                <para><code>link</code> - The URL of the item</para>
            </listitem>
            <listitem>
                <para><code>description</code> - A synopsis of the item</para>
            </listitem>
            <listitem>
                <para><code>author</code> - The author's email address</para>
            </listitem>
            <listitem>
                <para><code>category</code> - One more more categories that the item belongs to</para>
            </listitem>
            <listitem>
                <para><code>comments</code> - URL of comments relating to this item</para>
            </listitem>
            <listitem>
                <para><code>pubDate</code> - The date the item was published, in RFC 822 date format</para>
            </listitem>
        </itemizedlist>
    </para>

    <para>
        In your code you can always test to see if an element is non-empty with:
    </para>
    <programlisting role="php"><![CDATA[<?php
if ($item->propname()) {
    // ... proceed.
}]]>
    </programlisting>

    <para>
        If you use <code>$item->propname</code> instead, you will always get an empty object which will
        evaluate to <code>TRUE</code>, so your check will fail.
    </para>

    <para>
        For further information, the official RSS 2.0 specification is available at:
        <ulink url="http://blogs.law.harvard.edu/tech/rss">http://blogs.law.harvard.edu/tech/rss</ulink>
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.feed.custom-feed">
    <title>Custom Feed and Entry Classes</title>

    <para>
        Finally, you can extend the <code>Zend_Feed</code> classes if you'd like to provide your own format or
        niceties like automatic handling of elements that should go into a custom namespace.
    </para>

    <para>
        Here is an example of a custom Atom entry class that handles its own <code>myns:</code> namespace
        entries. Note that it also makes the <code>registerNamespace()</code> call for you, so the end user
        doesn't need to worry about namespaces at all.
    </para>

    <example id="zend.feed.custom-feed.example.extending">
        <title>Extending the Atom Entry Class with Custom Namespaces</title>
        <programlisting role="php"><![CDATA[<?php
/**
 * The custom entry class automatically knows the feed URI (optional) and
 * can automatically add extra namespaces.
 */
class MyEntry extends Zend_Feed_Entry_Atom
{

    public function __construct($uri = 'http://www.example.com/myfeed/',
                                $xml = null)
    {
        parent::__construct($uri, $xml);

        Zend_Feed::registerNamespace('myns', 'http://www.example.com/myns/1.0');
    }

    public function __get($var)
    {
        switch ($var) {
            case 'myUpdated':
                // Translate myUpdated to myns:updated.
                return parent::__get('myns:updated');

            default:
                return parent::__get($var);
            }
    }

    public function __set($var, $value)
    {
        switch ($var) {
            case 'myUpdated':
                // Translate myUpdated to myns:updated.
                parent::__set('myns:updated', $value);
                break;

            default:
                parent::__set($var, $value);
        }
    }

    public function __call($var, $unused)
    {
        switch ($var) {
            case 'myUpdated':
                // Translate myUpdated to myns:updated.
                return parent::__call('myns:updated', $unused);

            default:
                return parent::__call($var, $unused);
        }
    }
}]]>
        </programlisting>
        <para>
            Then to use this class, you'd just instantiate it directly and set the <code>myUpdated</code>
            property:
        </para>
        <programlisting role="php"><![CDATA[<?php
$entry = new MyEntry();
$entry->myUpdated = '2005-04-19T15:30';

// method-style call is handled by __call function
$entry->myUpdated();  
// property-style call is handled by __get function
$entry->myUpdated;]]>
        </programlisting>
    </example>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.feed.findFeeds">
    <title>Retrieving Feeds from Web Pages</title>
    <para>
        Web pages often contain <code>&lt;link&gt;</code> tags that refer to feeds with content relevant to
        the particular page. <code>Zend_Feed</code> enables you to retrieve all feeds referenced by a web
        page with one simple method call:
    </para>
    <programlisting role="php"><![CDATA[<?php
$feedArray = Zend_Feed::findFeeds('http://www.example.com/news.html');]]>
    </programlisting>
    <para>
        Here the <code>findFeeds()</code> method returns an array of <code>Zend_Feed_Abstract</code>
        objects that are referenced by <code>&lt;link&gt;</code> tags on the news.html web page. Depending on
        the type of each feed, each respective entry in the <code>$feedArray</code> array may be a
        <code>Zend_Feed_Rss</code> or <code>Zend_Feed_Atom</code> instance. <code>Zend_Feed</code> will throw a
        <code>Zend_Feed_Exception</code> upon failure, such as an HTTP 404 response code or a malformed feed.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.feed.importing">

    <title>Importing Feeds</title>

    <para>
        <code>Zend_Feed</code> enables developers to retrieve feeds very easily. If you know the URI of a feed, simply
        use the <code>Zend_Feed::import()</code> method:
    </para>

    <programlisting role="php"><![CDATA[<?php
$feed = Zend_Feed::import('http://feeds.example.com/feedName');]]>
    </programlisting>

    <para>
        You can also use <code>Zend_Feed</code> to fetch the contents of a feed from a file or the contents of a PHP
        string variable:
    </para>

    <programlisting role="php"><![CDATA[<?php
// importing a feed from a text file
$feedFromFile = Zend_Feed::importFile('feed.xml');

// importing a feed from a PHP string variable
$feedFromPHP = Zend_Feed::importString($feedString);]]>
    </programlisting>

    <para>
        In each of the examples above, an object of a class that extends <code>Zend_Feed_Abstract</code> is returned
        upon success, depending on the type of the feed. If an RSS feed were retrieved via one of the import methods
        above, then a <code>Zend_Feed_Rss</code> object would be returned. On the other hand, if an Atom feed were
        imported, then a <code>Zend_Feed_Atom</code> object is returned. The import methods will also throw a
        <code>Zend_Feed_Exception</code> object upon failure, such as an unreadable or malformed feed.
    </para>

    <sect2 id="zend.feed.importing.custom">

        <title>Custom feeds</title>

        <para>
            <code>Zend_Feed</code> enables developers to create custom feeds very easily. You just have to create an
            array and to import it with Zend_Feed. This array can be imported with <code>Zend_Feed::importArray()</code>
            or with <code>Zend_Feed::importBuilder()</code>. In this last case the array will be computed on the fly by
            a custom data source implementing <code>Zend_Feed_Builder_Interface</code>.
        </para>

        <sect3 id="zend.feed.importing.custom.importarray">

            <title>Importing a custom array</title>

            <programlisting role="php"><![CDATA[<?php
// importing a feed from an array
$atomFeedFromArray = Zend_Feed::importArray($array);

// the following line is equivalent to the above; by default a Zend_Feed_Atom instance is returned
$atomFeedFromArray = Zend_Feed::importArray($array, 'atom');

// importing a rss feed from an array
$rssFeedFromArray = Zend_Feed::importArray($array, 'rss');]]>
            </programlisting>

            <para>
                The format of the array must conform to this structure:
            </para>

            <programlisting role="php"><![CDATA[<?php
array(
      'title'       => 'title of the feed', //required
      'link'        => 'canonical url to the feed', //required
      'lastUpdate'  => 'timestamp of the update date', // optional
      'published'   => 'timestamp of the publication date', //optional
      'charset'     => 'charset of the textual data', // required
      'description' => 'short description of the feed', //optional
      'author'      => 'author/publisher of the feed', //optional
      'email'       => 'email of the author', //optional
      'webmaster'   => 'email address for person responsible for technical issues' // optional, ignored if atom is used
      'copyright'   => 'copyright notice', //optional
      'image'       => 'url to image', //optional
      'generator'   => 'generator', // optional
      'language'    => 'language the feed is written in', // optional
      'ttl'         => 'how long in minutes a feed can be cached before refreshing', // optional, ignored if atom is used
      'rating'      => 'The PICS rating for the channel.', // optional, ignored if atom is used
      'cloud'       => array(
                             'domain'            => 'domain of the cloud, e.g. rpc.sys.com' // required
                             'port'              => 'port to connect to' // optional, default to 80
                             'path'              => 'path of the cloud, e.g. /RPC2' //required
                             'registerProcedure' => 'procedure to call, e.g. myCloud.rssPleaseNotify' // required
                             'protocol'          => 'protocol to use, e.g. soap or xml-rpc' // required
                             ), // a cloud to be notified of updates // optional, ignored if atom is used
      'textInput'   => array(
                             'title'       => 'the label of the Submit button in the text input area' // required,
                             'description' => 'explains the text input area' // required
                             'name'        => 'the name of the text object in the text input area' // required
                             'link'        => 'the URL of the CGI script that processes text input requests' // required
                             ) // a text input box that can be displayed with the feed // optional, ignored if atom is used
      'skipHours'   => array(
                             'hour in 24 format', // e.g 13 (1pm)
                             // up to 24 rows whose value is a number between 0 and 23
                             ) // Hint telling aggregators which hours they can skip // optional, ignored if atom is used
      'skipDays '   => array(
                             'a day to skip', // e.g Monday
                             // up to 7 rows whose value is a Monday, Tuesday, Wednesday, Thursday, Friday, Saturday or Sunday
                             ) // Hint telling aggregators which days they can skip // optional, ignored if atom is used
      'itunes'      => array(
                             'author'       => 'Artist column' // optional, default to the main author value
                             'owner'        => array(
                                                     'name' => 'name of the owner' // optional, default to main author value
                                                     'email' => 'email of the owner' // optional, default to main email value
                                                     ) // Owner of the podcast // optional
                             'image'        => 'album/podcast art' // optional, default to the main image value
                             'subtitle'     => 'short description' // optional, default to the main description value
                             'summary'      => 'longer description' // optional, default to the main description value
                             'block'        => 'Prevent an episode from appearing (yes|no)' // optional
                             'category'     => array(
                                                     array('main' => 'main category', // required
                                                           'sub'  => 'sub category' // optional
                                                           ),
                                                     // up to 3 rows
                                                     ) // 'Category column and in iTunes Music Store Browse' // required
                             'explicit'     => 'parental advisory graphic (yes|no|clean)' // optional
                             'keywords'     => 'a comma separated list of 12 keywords maximum' // optional
                             'new-feed-url' => 'used to inform iTunes of new feed URL location' // optional
                             ) // Itunes extension data // optional, ignored if atom is used
      'entries'     => array(
                             array(
                                   'title'        => 'title of the feed entry', //required
                                   'link'         => 'url to a feed entry', //required
                                   'description'  => 'short version of a feed entry', // only text, no html, required
                                   'guid'         => 'id of the article, if not given link value will used', //optional
                                   'content'      => 'long version', // can contain html, optional
                                   'lastUpdate'   => 'timestamp of the publication date', // optional
                                   'comments'     => 'comments page of the feed entry', // optional
                                   'commentRss'   => 'the feed url of the associated comments', // optional
                                   'source'       => array(
                                                           'title' => 'title of the original source' // required,
                                                           'url' => 'url of the original source' // required
                                                           ) // original source of the feed entry // optional
                                   'category'     => array(
                                                           array(
                                                                 'term' => 'first category label' // required,
                                                                 'scheme' => 'url that identifies a categorization scheme' // optional
                                                                 ),
                                                           array(
                                                                 //data for the second category and so on
                                                                 )
                                                           ) // list of the attached categories // optional
                                   'enclosure'    => array(
                                                           array(
                                                                 'url' => 'url of the linked enclosure' // required
                                                                 'type' => 'mime type of the enclosure' // optional
                                                                 'length' => 'length of the linked content in octets' // optional
                                                                 ),
                                                           array(
                                                                 //data for the second enclosure and so on
                                                                 )
                                                           ) // list of the enclosures of the feed entry // optional
                                   ),
                             array(
                                   //data for the second entry and so on
                                   )
                             )
       );]]>
            </programlisting>

            <para>
                References:
                <itemizedlist>
                    <listitem>
                        <para>
                            RSS 2.0 specification: <ulink url="http://blogs.law.harvard.edu/tech/rss">RSS 2.0</ulink>
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            Atom specification: <ulink url="http://tools.ietf.org/html/rfc4287">RFC 4287</ulink>
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            WFW specification: <ulink url="http://wellformedweb.org/news/wfw_namespace_elements">Well
                            Formed Web</ulink>
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            iTunes specification:
                            <ulink url="http://www.apple.com/itunes/store/podcaststechspecs.html">iTunes Technical
                            Specifications</ulink>
                        </para>
                    </listitem>
                </itemizedlist>
            </para>

        </sect3>

        <sect3 id="zend.feed.importing.custom.importbuilder">

            <title>Importing a custom data source</title>

            <para>
                You can create a Zeed_Feed instance from any data source implementing
                <code>Zend_Feed_Builder_Interface</code>. You just have to implement the <code>getHeader()</code> and
                <code>getEntries()</code> methods to be able to use your object with
                <code>Zend_Feed::importBuilder()</code>. As a simple reference implementation, you can use
                <code>Zend_Feed_Builder</code>, which takes an array in its constructor, performs some minor validation,
                and then can be used in the <code>importBuilder()</code> method. The <code>getHeader()</code> method
                must return an instance of <code>Zend_Feed_Builder_Header</code>, and <code>getEntries()</code> must
                return an array of <code>Zend_Feed_Builder_Entry</code> instances.
            </para>

            <note>
                <para>
                    <code>Zend_Feed_Builder</code> serves as a concrete implementation to demonstrate the usage. Users
                    are encouraged to make their own classes to implement <code>Zend_Feed_Builder_Interface</code>.
                </para>
            </note>

            <para>
                Here is an example of <code>Zend_Feed::importBuilder()</code> usage:
            </para>

            <programlisting role="php"><![CDATA[<?php
// importing a feed from a custom builder source
$atomFeedFromArray = Zend_Feed::importBuilder(new Zend_Feed_Builder($array));

// the following line is equivalent to the above; by default a Zend_Feed_Atom instance is returned
$atomFeedFromArray = Zend_Feed::importArray(new Zend_Feed_Builder($array), 'atom');

// importing a rss feed from a custom builder array
$rssFeedFromArray = Zend_Feed::importArray(new Zend_Feed_Builder($array), 'rss');]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.feed.importing.custom.dump">

            <title>Dumping the contents of a feed</title>

            <para>
                To dump the contents of a <code>Zend_Feed_Abstract</code> instance, you may use <code>send()</code> or
                <code>saveXml()</code> methods.
            </para>

            <programlisting role="php"><![CDATA[<?php
assert($feed instanceof Zend_Feed_Abstract);

// dump the feed to standard output
print $feed->saveXML();

// send http headers and dump the feed
$feed->send();]]>
            </programlisting>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.feed.introduction">
    <title>Introduction</title>
    <para>
        <code>Zend_Feed</code> provides functionality for consuming RSS and Atom feeds. It provides a
        natural syntax for accessing elements of feeds, feed attributes, and entry attributes.
        <code>Zend_Feed</code> also has extensive support for modifying feed and entry structure with the
        same natural syntax, and turning the result back into XML. In the future, this modification support
        could provide support for the Atom Publishing Protocol.
    </para>

    <para>
        Programmatically, <code>Zend_Feed</code> consists of a base <code>Zend_Feed</code> class, abstract
        <code>Zend_Feed_Abstract</code> and <code>Zend_Feed_Entry_Abstract</code> base classes for
        representing Feeds and Entries, specific implementations of feeds and entries for RSS and Atom, and
        a behind-the-scenes helper for making the natural syntax magic work.
    </para>

    <para>
        In the example below, we demonstrate a simple use case of retrieving an RSS feed and saving relevant
        portions of the feed data to a simple PHP array, which could then be used for printing the data, storing
        to a database, etc.
    </para>

    <note>
        <title>Be aware</title>
        <para>
            Many RSS feeds have different channel and item properties available. The RSS specification provides for
            many optional properties, so be aware of this when writing code to work with RSS data.
        </para>
    </note>

    <example id="zend.feed.introduction.example.rss">
        <title>Putting Zend_Feed to Work on RSS Feed Data</title>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Feed.php';

// Fetch the latest Slashdot headlines
try {
    $slashdotRss = Zend_Feed::import('http://rss.slashdot.org/Slashdot/slashdot');
} catch (Zend_Feed_Exception $e) {
    // feed import failed
    echo "Exception caught importing feed: {$e->getMessage()}\n";
    exit;
}

// Initialize the channel data array
$channel = array(
    'title'       => $slashdotRss->title(),
    'link'        => $slashdotRss->link(),
    'description' => $slashdotRss->description(),
    'items'       => array()
    );

// Loop over each channel item and store relevant data
foreach ($slashdotRss as $item) {
    $channel['items'][] = array(
        'title'       => $item->title(),
        'link'        => $item->link(),
        'description' => $item->description()
        );
}]]>
        </programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.feed.modifying-feed">
    <title>Modifying Feed and Entry structures</title>

    <para>
        <code>Zend_Feed</code>'s natural syntax extends to constructing and modifying feeds and entries as well
        as reading them. You can easily turn your new or modified objects back into well-formed XML for saving
        to a file or sending to a server.
    </para>

    <example id="zend.feed.modifying-feed.example.modifying">
        <title>Modifying an Existing Feed Entry</title>
        <programlisting role="php"><![CDATA[<?php
$feed = new Zend_Feed_Atom('http://atom.example.com/feed/1');
$entry = $feed->current();

$entry->title = 'This is a new title';
$entry->author->email = 'my_email@example.com';

echo $entry->saveXML();]]>
        </programlisting>
        <para>
            This will output a full (includes <code>&lt;?xml ... &gt;</code> prologue) XML representation of the
            new entry, including any necessary XML namespaces.
        </para>
        <para>
            Note that the above will work even if the existing entry does not already have an author tag. You can
            use as many levels of <code>-&gt;</code> access as you like before getting to an assignment; all of the
            intervening levels will be created for you automatically if necessary.
        </para>
    </example>

    <para>
        If you want to use a namespace other than <code>atom:</code>, <code>rss:</code>, or <code>osrss:</code>
        in your entry, you need to register the namespace with <code>Zend_Feed</code> using <code>
        Zend_Feed::registerNamespace()</code>. When you are modifying an existing element, it will always
        maintain its original namespace. When adding a new element, it will go into the default namespace if
        you do not explicitly specify another namespace.
    </para>

    <example id="zend.feed.modifying-feed.example.creating">
        <title>Creating an Atom Entry with Elements of Custom Namespaces</title>
        <programlisting role="php"><![CDATA[<?php
$entry = new Zend_Feed_Entry_Atom();
// id is always assigned by the server in Atom
$entry->title = 'my custom entry';
$entry->author->name = 'Example Author';
$entry->author->email = 'me@example.com';

// Now do the custom part.
Zend_Feed::registerNamespace('myns', 'http://www.example.com/myns/1.0');

$entry->{'myns:myelement_one'} = 'my first custom value';
$entry->{'myns:container_elt'}->part1 = 'first nested custom part';
$entry->{'myns:container_elt'}->part2 = 'second nested custom part';

echo $entry->saveXML();]]>
        </programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.filter.filter_chains">

    <title>Filter Chains</title>

    <para>
        Often multiple filters should be applied to some value in a particular order. For example, a
        login form accepts a username that should be only lowercase, alphabetic characters.
        <code>Zend_Filter</code> provides a simple method by which filters may be chained together. The
        following code illustrates how to chain together two filters for the submitted username:

        <programlisting role="php"><![CDATA[<?php
// Provides filter chaining capability
require_once 'Zend/Filter.php';

// Filters needed for the example
require_once 'Zend/Filter/Alpha.php';
require_once 'Zend/Filter/StringToLower.php';

// Create a filter chain and add filters to the chain
$filterChain = new Zend_Filter();
$filterChain->addFilter(new Zend_Filter_Alpha())
            ->addFilter(new Zend_Filter_StringToLower());

// Filter the username
$username = $filterChain->filter($_POST['username']);]]>
        </programlisting>

        Filters are run in the order they were added to <code>Zend_Filter</code>. In the above example, the
        username is first removed of any non-alphabetic characters, and then any uppercase characters are
        converted to lowercase.

    </para>

    <para>
        Any object that implements <code>Zend_Filter_Interface</code> may be used in a filter chain.
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.filter.inflector">
    <title>Zend_Filter_Inflector</title>

    <para>
        <code>Zend_Filter_Inflector</code> is a general purpose tool for
        rules-based inflection of strings to a given target.
    </para>

    <para>
        As an example, you may find you need to transform MixedCase or camelCasedWords into a
        path; for readability, OS policies, or other reasons, you also need to
        lower case this, and you want to separate the words using a dash ('-').
        An inflector can do this for you.
    </para>

    <para>
        <code>Zend_Filter_Inflector</code> implements
        <code>Zend_Filter_Interface</code>; you perform inflection by calling
        <code>filter()</code> on the object instance.
    </para>

    <example id="zend.filter.inflector.camel_case_example">
        <title>Transforming MixedCase and camelCaseText to another format</title>

        <programlisting role="php"><![CDATA[<?php
$inflector = new Zend_Filter_Inflector('pages/:page.:suffix');
$inflector->setRules(array(
    ':page'  => array('Word_CamelCaseToDash', 'StringToLower'),
    'suffix' => 'html'
));

$string   = 'camelCasedWords';
$filtered = $inflector->filter(array('page' => $string)); // pages/camel-cased-words.html

$string   = 'this_is_not_camel_cased';
$filtered = $inflector->filter(array('page' => $string)); // pages/this_is_not_camel_cased.html
?>]]></programlisting>
    </example>

    <sect2 id="zend.filter.inflector.operation">
        <title>Operation</title>

        <para>
            An inflector requires a <emphasis>target</emphasis> and one or more
            <emphasis>rules</emphasis>. A target is basically a string that
            defines placeholders for variables you wish to substitute. These are
            specified by prefixing with a ':': <code>:script</code>.
        </para>

        <para>
            When calling <code>filter()</code>, you then pass in an array of
            key/value pairs corresponding to the variables in the target.
        </para>

        <para>
            Each variable in the target can have zero or more rules associated
            with them. Rules may be either <emphasis>static</emphasis> or refer to a
            <code>Zend_Filter</code> class. Static rules will replace with the
            text provided. Otherwise, a class matching the rule provided will be
            used to inflect the text. Classes are typically specified using a
            short name indicating the filter name stripped of any common prefix.
        </para>

        <para>
            As an example, you can use any <code>Zend_Filter</code> concrete
            implementations; however, instead of referring to them as
            'Zend_Filter_Alpha' or 'Zend_Filter_StringToLower', you'd specify
            only 'Alpha' or 'StringToLower'.
        </para>
    </sect2>

     <sect2 id="zend.filter.inflector.paths">
        <title>Setting Paths To Alternate Filters</title>

        <para>
            <code>Zend_Filter_Inflector</code> uses
            <code>Zend_Loader_PluginLoader</code> to manage loading filters to
            use with inflection. By default, any filter prefixed with
            <code>Zend_Filter</code> will be available. To access filters with
            that prefix but which occur deeper in the hierarchy, such as the
            various Word filters, simply strip off the Zend_Filter prefix:
        </para>

        <programlisting role="php"><![CDATA[<?php
// use Zend_Filter_Word_CamelCaseToDash as a rule
$inflector->addRules(array('script' => 'Word_CamelCaseToDash'));
?>]]></programlisting>

        <para>
            To set alternate paths, <code>Zend_Filter_Inflector</code> has a
            utility method that proxies to the plugin loader,
            <code>addFilterPrefixPath()</code>:
        </para>
            
        <programlisting role="php"><![CDATA[<?php
$inflector->addFilterPrefixPath('My_Filter', 'My/Filter/');
?>]]></programlisting>

        <para>
            Alternatively, you can retrieve the plugin loader from the
            inflector, and interact with it directly:
        </para>

        <programlisting role="php"><![CDATA[<?php
$loader = $inflector->getPluginLoader();
$loader->addPrefixPath('My_Filter', 'My/Filter/');
?>]]></programlisting>

        <para>
            For more options on modifying the paths to filters, please see <link
                linkend="zend.loader.pluginloader">the PluginLoader
                documentation</link>.
        </para>
    </sect2>

    <sect2 id="zend.filter.inflector.targets">
        <title>Setting the Inflector Target</title>

        <para>
            The inflector target is a string with some placeholders for
            variables. Placeholders take the form of an identifier, a colon
            (':') by default, followed by a variable name: ':script', ':path',
            etc. The <code>filter()</code> method looks for the identifier
            followed by the variable name being replaced.
        </para>

        <para>
            You can change the identifier using the
            <code>setTargetReplacementIdentifier()</code> method, or passing it
            as the third argument to the constructor:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Via constructor:
$inflector = new Zend_Filter_Inflector('#foo/#bar.#sfx', null, '#');

// Via accessor:
$inflector->setTargetReplacementIdentifier('#');
?>]]></programlisting>

        <para>
            Typically, you will set the target via the constructor. However, you
            may want to re-set the target later (for instance, to modify the
            default inflector in core components, such as the
            <code>ViewRenderer</code> or <code>Zend_Layout</code>).
            <code>setTarget()</code> can be used for this purpose:
        </para>

        <programlisting role="php"><![CDATA[<?php
$inflector = $layout->getInflector();
$inflector->setTarget('layouts/:script.phtml');
?>]]></programlisting>

        <para>
            Additionally, you may wish to have a class member for your class
            that you can use to keep the inflector target updated -- without
            needing to directly update the target each time (thus saving on
            method calls). <code>setTargetReference()</code> allows you to do
            this:
        </para>

        <programlisting role="php"><![CDATA[<?php
class Foo
{
    /**
     * @var string Inflector target
     */
    protected $_target = 'foo/:bar/:baz.:suffix';

    /**
     * Constructor
     * @return void
     */
    public function __construct()
    {
        $this->_inflector = new Zend_Filter_Inflector();
        $this->_inflector->setTargetReference($this->_target);
    }

    /**
     * Set target; updates target in inflector
     * 
     * @param  string $target 
     * @return Foo
     */
    public function setTarget($target)
    {
        $this->_target = $target;
        return $this;
    }
}
?>]]></programlisting>
    </sect2>

    <sect2 id="zend.filter.inflector.rules">
        <title>Inflection Rules</title>

        <para>
            As mentioned in the introduction, there are two types of rules:
            static and filter-based.
        </para>
        
        <note>
            <para>
	            It is important to note that regardless of the method in which you add 
	            rules to the inflector, either one-by-one, or all-at-once; the order is very
	            important.  More specific names, or names that might contain other rule names,
	            must be added before least specific names.  For example, assuming the two rule
	            names 'moduleDir' and 'module', the 'moduleDir' rule should appear before module
	            since 'module' is contained within 'moduleDir'.  If 'module' were added before
	            'moduleDir', 'module' will match part of 'moduleDir' and process it leaving 'Dir'
	            inside of the target uninflected.
            </para>
        </note>

        <sect3 id="zend.filter.inflector.rules.static">
            <title>Static Rules</title>

            <para>
                Static rules do simple string substitution; use them when you
                have a segment in the target that will typically be static, but
                which you want to allow the developer to modify. Use the
                <code>setStaticRule()</code> method to set or modify the rule:
            </para>

            <programlisting role="php"><![CDATA[<?php
$inflector = new Zend_Filter_Inflector(':script.:suffix');
$inflector->setStaticRule('suffix', 'phtml');

// change it later:
$inflector->setStaticRule('suffix', 'php');
?>]]></programlisting>

            <para>
                Much like the target itself, you can also bind a static rule to
                a reference, allowing you to update a single variable instead of
                require a method call; this is often useful when your class uses
                an inflector internally, and you don't want your users to need
                to fetch the inflector in order to update it. The
                <code>setStaticRuleReference()</code> method is used to
                accomplish this:
            </para>

            <programlisting role="php"><![CDATA[<?php
class Foo
{
    /**
     * @var string Suffix
     */
    protected $_suffix = 'phtml';

    /**
     * Constructor
     * @return void
     */
    public function __construct()
    {
        $this->_inflector = new Zend_Filter_Inflector(':script.:suffix');
        $this->_inflector->setStaticRuleReference('suffix', $this->_suffix);
    }

    /**
     * Set suffix; updates suffix static rule in inflector
     * 
     * @param  string $suffix 
     * @return Foo
     */
    public function setSuffix($suffix)
    {
        $this->_suffix = $suffix;
        return $this;
    }
}
?>]]></programlisting>
        </sect3>

        <sect3 id="zend.filter.inflector.rules.filters">
            <title>Filter Inflector Rules</title>

            <para>
                <code>Zend_Filter</code> filters may be used as inflector rules
                as well. Just like static rules, these are bound to a target
                variable; unlike static rules, you may define multiple filters
                to use when inflecting. These filters are processed in order, so
                be careful to register them in an order that makes sense for the
                data you receive.
            </para>

            <para>
                Rules may be added using <code>setFilterRule()</code> (which
                overwrites any previous rules for that variable) or
                <code>addFilterRule()</code> (which appends the new rule to any
                existing rule for that variable). Filters are specified in one
                of the following ways:
            </para>

            <itemizedlist>
                <listitem><para>
                        <emphasis>String</emphasis>. The string may be a filter
                        class name, or a class name segment minus any prefix set
                        in the inflector's plugin loader (by default, minus the
                        'Zend_Filter' prefix).
                </para></listitem>

                <listitem><para>
                        <emphasis>Filter object</emphasis>. Any object instance
                        implementing <code>Zend_Filter_Interface</code> may be
                        passed as a filter.
                </para></listitem>

                <listitem><para>
                        <emphasis>Array</emphasis>. An array of one or more
                        strings or filter objects as defined above.
                </para></listitem>
            </itemizedlist>

            <programlisting role="php"><![CDATA[<?php
$inflector = new Zend_Filter_Inflector(':script.:suffix');

// Set rule to use Zend_Filter_Word_CamelCaseToDash filter
$inflector->setFilterRule('script', 'Word_CamelCaseToDash');

// Add rule to lowercase string
$inflector->addFilterRule('script', new Zend_Filter_StringToLower());

// Set rules en-masse
$inflector->setFilterRule('script', array(
    'Word_CamelCaseToDash',
    new Zend_Filter_StringToLower()
));
?>]]></programlisting>
        </sect3>

        <sect3 id="zend.filter.inflector.rules.multiple">
            <title>Setting Many Rules At Once</title>

            <para>
                Typically, it's easier to set many rules at once than to
                configure a single variable and its inflection rules at a time.
                <code>Zend_Filter_Inflector</code>'s <code>addRules()</code> and
                <code>setRules()</code> method allow this.
            </para>

            <para>
                Each method takes an array of variable/rule pairs, where the
                rule may be whatever the type of rule accepts (string, filter
                object, or array). Variable names accept a special notation to
                allow setting static rules and filter rules, according to the
                following notation:
            </para>

            <itemizedlist>
                <listitem><para>
                        <emphasis>':' prefix</emphasis>: filter rules.
                </para></listitem>

                <listitem><para>
                        <emphasis>No prefix</emphasis>: static rule.
                </para></listitem>
            </itemizedlist>

            <example id="zend.filter.inflector.rules.multiple.example">
                <title>Setting Multiple Rules at Once</title>

                <programlisting role="php"><![CDATA[<?php
// Could also use setRules() with this notation:
$inflector->addRules(array(
    // filter rules:
    ':controller' => array('CamelCaseToUnderscore','StringToLower'),
    ':action'     => array('CamelCaseToUnderscore','StringToLower'),

    // Static rule:
    'suffix'      => 'phtml'
));
?>]]></programlisting>
            </example>
        </sect3>
    </sect2>

    <sect2 id="zend.filter.inflector.utility">
        <title>Utility Methods</title>

        <para>
            <code>Zend_Filter_Inflector</code> has a number of utility methods
            for retrieving and setting the plugin loader, manipulating and
            retrieving rules, and controlling if and when exceptions are thrown.
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>setPluginLoader()</code> can be used when you have
                    configured your own plugin loader and wish to use it with
                    <code>Zend_Filter_Inflector</code>;
                    <code>getPluginLoader()</code> retrieves the currently set
                    one.
            </para></listitem>

            <listitem><para>
                    <code>setThrowTargetExceptionsOn()</code> can be used to
                    control whether or not <code>filter()</code> throws an
                    exception when a given replacement identifier passed to it
                    is not found in the target. By default, no exceptions are
                    thrown. <code>isThrowTargetExceptionsOn()</code> will tell
                    you what the current value is.
            </para></listitem>

            <listitem><para>
                    <code>getRules($spec = null)</code> can be used to retrieve all
                    registered rules for all variables, or just the rules for a
                    single variable.
            </para></listitem>

            <listitem><para>
                    <code>getRule($spec, $index)</code> fetches a single rule
                    for a given variable; this can be useful for fetching a
                    specific filter rule for a variable that has a filter chain.
                    <code>$index</code> must be passed.
            </para></listitem>

            <listitem><para>
                    <code>clearRules()</code> will clear all currently
                    registered rules.
            </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.filter.inflector.config">
        <title>Using Zend_Config with Zend_Filter_Inflector</title>

        <para>
            You can use <code>Zend_Config</code> to set rules, filter prefix
            paths, and other object state in your inflectors, either by passing
            a <code>Zend_Config</code> object to the constructor or <code>setConfig()</code>.
            The following settings may be specified:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>target</code> specifies the inflection target.
            </para></listitem>

            <listitem><para>
                    <code>filterPrefixPath</code> specifies one or more filter
                    prefix/path pairs for use with the inflector.
            </para></listitem>

            <listitem><para>
                    <code>throwTargetExceptionsOn</code> should be a boolean
                    indicating whether or not to throw exceptions when a
                    replacement identifier is still present after inflection.
            </para></listitem>

            <listitem><para>
                    <code>targetReplacementIdentifier</code> specifies the
                    character to use when identifiying replacement variables in
                    the target string.
            </para></listitem>

            <listitem><para>
                    <code>rules</code> specifies an array of inflection rules;
                    it should consist of keys that specify either values or
                    arrays of values, consistent with <code>addRules()</code>.
            </para></listitem>
        </itemizedlist>

        <example id="zend.filter.inflector.config.example">
            <title>Using Zend_Config with Zend_Filter_Inflector</title>

            <programlisting role="php"><![CDATA[<?php
// With the constructor:
$config    = new Zend_Config($options);
$inflector = new Zend_Filter_Inflector($config);

// Or with setConfig():
$inflector = new Zend_Filter_Inflector();
$inflector->setConfig($config);
?>]]></programlisting>
        </example>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.filter.set">

    <title>Standard Filter Classes</title>

    <para>
        The Zend Framework comes with a standard set of filters, which are ready for you to use.
    </para>

    <sect2 id="zend.filter.set.alnum">
        <title>Alnum</title>
        <para>
            Returns the string <code>$value</code>, removing all but alphabetic and digit characters. This filter
            includes an option to also allow white space characters.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.alpha">
        <title>Alpha</title>
        <para>
            Returns the string <code>$value</code>, removing all but alphabetic characters. This filter includes an
            option to also allow white space characters.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.basename">
        <title>BaseName</title>
        <para>
            Given a string containing a path to a file, this filter will return the base
            name of the file
        </para>
    </sect2>

    <sect2 id="zend.filter.set.digits">
        <title>Digits</title>
        <para>
            Returns the string <code>$value</code>, removing all but digit characters.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.dir">
        <title>Dir</title>
        <para>
            Returns directory name component of path.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.htmlentities">
        <title>HtmlEntities</title>
        <para>
            Returns the string <code>$value</code>, converting characters to their corresponding
            HTML entity equivalents where they exist.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.int">
        <title>Int</title>
        <para>
            Returns (int) <code>$value</code>
        </para>
    </sect2>

    <sect2 id="zend.filter.set.realpath">
        <title>RealPath</title>
        <para>
            Expands all symbolic links and resolves references to '/./', '/../' and extra '/'
            characters in the input path and return the canonicalized absolute pathname. The resulting
            path will have no symbolic link, '/./' or '/../' components.
        </para>
        <para>
            <code>Zend_Filter_RealPath</code> will return <code>FALSE</code>
            on failure, e.g. if the file does not exist. On BSD systems <code>Zend_Filter_RealPath</code>
            doesn't fail if only the last path component doesn't exist, while other systems will return
            <code>FALSE</code>.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.stringtolower">
        <title>StringToLower</title>
        <para>
            Returns the string <code>$value</code>, converting alphabetic characters to lowercase as necessary.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.stringtoupper">
        <title>StringToUpper</title>
        <para>
            Returns the string <code>$value</code>, converting alphabetic characters to uppercase as necessary.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.stringtrim">
        <title>StringTrim</title>
        <para>
            Returns the string <code>$value</code> with characters stripped from the beginning and end.
        </para>
    </sect2>

    <sect2 id="zend.filter.set.striptags">
        <title>StripTags</title>
        <para>
            This filter returns the input string, with all HTML and PHP tags stripped from it, except those that have
            been explicitly allowed. In addition to the ability to specify which tags are allowed, developers can
            specify which attributes are allowed across all allowed tags and for specific tags only. Finally, this
            filter offers control over whether comments (e.g., <code>&lt;!-- ... --&gt;</code>) are removed or
            allowed.
        </para>
    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.filter.writing_filters">

    <title>Writing Filters</title>

    <para>
        Zend_Filter supplies a set of commonly needed filters, but developers will often need to write custom
        filters for their particular use cases. The task of writing a custom filter is facilitated by
        implementing <code>Zend_Filter_Interface</code>.
    </para>

    <para>
        <code>Zend_Filter_Interface</code> defines a single method, <code>filter()</code>, that may be
        implemented by user classes. An object that implements this interface may be added to a filter chain
        with <code>Zend_Filter::addFilter()</code>.
    </para>

    <para>
        The following example demonstrates how to write a custom filter:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Filter/Interface.php';

class MyFilter implements Zend_Filter_Interface
{
    public function filter($value)
    {
        // perform some transformation upon $value to arrive on $valueFiltered

        return $valueFiltered;
    }
}]]>
        </programlisting>

    </para>

    <para>
        To add an instance of the above filter to a filter chain:

        <programlisting role="php"><![CDATA[<?php
$filterChain = new Zend_Filter();
$filterChain->addFilter(new MyFilter());]]>
        </programlisting>

    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.filter.introduction">

    <title>Introduction</title>

    <para>
        The Zend_Filter component provides a set of commonly needed data
        filters. It also provides a simple filter chaining mechanism by which
        multiple filters may be applied to a single datum in a user-defined
        order.
    </para>

    <sect2 id="zend.filter.introduction.definition">

        <title>What is a filter?</title>

        <para>
            In the physical world, a filter is typically used for removing
            unwanted portions of input, and the desired portion of the input
            passes through as filter output (e.g., coffee). In such scenarios,
            a filter is an operator that produces a subset of the input. This
            type of filtering is useful for web applications - removing illegal
            input, trimming unnecessary white space, etc.
        </para>

        <para>
            This basic definition of a filter may be extended to include
            generalized transformations upon input.  A common transformation
            applied in web applications is the escaping of HTML entities. For
            example, if a form field is automatically populated with untrusted
            input (e.g., from a web browser), this value should either be free
            of HTML entities or contain only escaped HTML entities, in order to
            prevent undesired behavior and security vulnerabilities. To meet
            this requirement, HTML entities that appear in the input must
            either be removed or escaped. Of course, which approach is more
            appropriate depends on the situation. A filter that removes the
            HTML entities operates within the scope of the first definition of
            filter - an operator that produces a subset of the input. A filter
            that escapes the HTML entities, however, transforms the input
            (e.g., "<code>&amp;</code>" is transformed to
            "<code>&amp;amp;</code>"). Supporting such use cases for web
            developers is important, and "to filter," in the context of using
            Zend_Filter, means to perform some transformations upon input data.
        </para>

    </sect2>

    <sect2 id="zend.filter.introduction.using">

        <title>Basic usage of filters</title>

        <para>
            Having this filter definition established provides the foundation
            for <code>Zend_Filter_Interface</code>, which requires a single
            method named <code>filter()</code> to be implemented by a filter
            class.
        </para>

        <para>
            Following is a basic example of using a filter upon two input data,
            the ampersand (<code>&amp;</code>) and double quote
            (<code>&quot;</code>) characters:

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Filter/HtmlEntities.php';

$htmlEntities = new Zend_Filter_HtmlEntities();

echo $htmlEntities->filter('&'); // &amp;
echo $htmlEntities->filter('"'); // &quot;]]>
            </programlisting>

        </para>

    </sect2>

    <sect2 id="zend.filter.introduction.static">

        <title>Using the static <code>get()</code> method</title>

        <para>
            If it's inconvenient to load a given filter class and create an
            instance of the filter, you can use the static method
            <code>Zend_Filter::get()</code> as an alternative invocation style.
            The first argument of this method is a data input value, that you
            would pass to the <code>filter()</code> method.  The second
            argument is a string, which corresponds to the basename of the
            filter class, relative to the Zend_Filter namespace.  The
            <code>get()</code> method automatically loads the class, creates an
            instance, and applies the <code>filter()</code> method to the data
            input.

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Filter.php';

echo Zend_Filter::get('&', 'HtmlEntities');]]>
            </programlisting>

        </para>

        <para>
            You can also pass an array of constructor arguments, if they
            are needed for the filter class.

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Filter.php';

echo Zend_Filter::get('"', 'HtmlEntities', array(ENT_QUOTES));]]>
            </programlisting>

        </para>

        <para>
            The static usage can be convenient for invoking a filter ad hoc,
            but if you have the need to run a filter for multiple inputs,
            it's more efficient to follow the first example above,
            creating an instance of the filter object and calling its
            <code>filter()</code> method.
        </para>

        <para>
            Also, the Zend_Filter_Input class allows you to instantiate and run
            multiple filter and validator classes on demand to process
            sets of input data.  See <xref linkend="zend.filter.input" />.
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.filter.input">
    <title>Zend_Filter_Input</title>

    <para>
        Zend_Filter_Input provides a declarative interface to associate
        multiple filters and validators, apply them to collections of data, and
        to retrieve input values after they have been processed by the filters
        and validators.  Values are returned in escaped format by default for
        safe HTML output.
    </para>

    <para>
        Consider the metaphor that this class is a cage for external data.
        Data enter the application from external sources, such as HTTP request
        parameters, HTTP headers, a web service, or even read from a database
        or another file.  Data are first put into the cage, and subsequently
        the application can access data only by telling the cage what the data
        should be and how they plan to use it.  The cage inspects the data for
        validity.  It might apply escaping to the data values for the
        appropriate context.  The cage releases data only if it can fulfill
        these responsibilities.  With a simple and convenient interface, it
        encourages good programming habits and makes developers think about how
        data are used.
    </para>

    <itemizedlist>
        <listitem>
            <para>
                <emphasis role="strong">Filters</emphasis> transform input
                values, by removing or changing characters within the value.
                The goal is to "normalize" input values until they match an
                expected format.  For example, if a string of numeric digits is
                needed, and the input value is "abc123", then it might be a
                reasonable transformation to change the value to the string
                "123".
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">Validators</emphasis> check input
                values against criteria and report whether they passed the test
                or not.  The value is not changed, but the check may fail.  For
                example, if a string must look like an email address, and the
                input value is "abc123", then the value is not considered
                valid.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">Escapers</emphasis> transform a value
                by removing magic behavior of certain characters.  In some
                output contexts, special characters have meaning.  For example,
                the characters '&lt;' and '&gt;' delimit HTML tags, and if a
                string containing those characters is output in an HTML
                context, the content between them might affect the output or
                functionality of the HTML presentation.  Escaping the
                characters removes the special meaning, so they are output as
                literal characters.
            </para>
        </listitem>
    </itemizedlist>

    <para>
        To use Zend_Filter_Input, perform the following steps:
    </para>

    <orderedlist numeration="arabic">
        <listitem>
            <para>
                Declare filter and validator rules
            </para>
        </listitem>
        <listitem>
            <para>
                Create the filter and validator processor
            </para>
        </listitem>
        <listitem>
            <para>
                Provide input data
            </para>
        </listitem>
        <listitem>
            <para>
                Retrieve validated fields and other reports
            </para>
        </listitem>
    </orderedlist>

    <para>
        The following sections describe the steps for using this class.
    </para>

    <sect2 id="zend.filter.input.declaring">

        <title>Declaring Filter and Validator Rules</title>

        <para>
            Before creating an instance of Zend_Filter_Input, declare an
            array of filter rules and and an array of validator rules.
            This associative array maps a rule name to a filter or
            validator or a chain of filters or validators.
        </para>

        <para>
            The following example filter rule set that declares the field
            'month' is filtered by Zend_Filter_Digits, and the field 'account'
            is filtered by Zend_Filter_StringTrim.  Then a validation rule set
            declares that the field 'account' is valid only if it contains only
            alphabetical characters.
        </para>

        <programlisting role="php"><![CDATA[<?php
$filters = array(
    'month'   => 'Digits',
    'account' => 'StringTrim'
);

$validators = array(
    'account' => 'Alpha'
);]]>
        </programlisting>

        <para>
            Each key in the <code>$filters</code> array above is the name of a rule for applying a
            filter to a specific data field.  By default, the name of the rule
            is also the name of the input data field to which to apply the
            rule.
        </para>

        <para>
            You can declare a rule in several formats:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    A single string scalar, which is mapped to a class name.
                    <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month'   => 'Digits',
);]]>
                    </programlisting>
                </para>
            </listitem>
            <listitem>
                <para>
                    An object instance of one of the classes that implement
                    Zend_Filter_Interface or Zend_Validate_Interface.
                    <programlisting role="php"><![CDATA[<?php
$digits = new Zend_Validate_Digits();

$validators = array(
    'month'   => $digits
);]]>
                    </programlisting>
                </para>
            </listitem>
            <listitem>
                <para>
                    An array, to declare a chain of filters or validators.
                    The elements of this array can be strings mapping to class
                    names or filter/validator objects, as in the cases
                    described above.  In addition, you can use a third choice:
                    an array containing a string mapping to the class name
                    followed by arguments to pass to its constructor.

                    <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month'   => array(
        'Digits',                // string
        new Zend_Validate_Int(), // object instance
        array('Between', 1, 12)  // string with constructor arguments
    )
);]]>
                    </programlisting>
                </para>
            </listitem>
        </itemizedlist>

        <note>
            <para>
                If you declare a filter or validator with constructor arguments
                in an array, then you must make an array for the rule, even if
                the rule has only one filter or validator.
            </para>
        </note>

        <para>
            You can use a special "wildcard" rule key <code>'*'</code> in
            either the filters array or the validators array.  This means that
            the filters or validators declared in this rule will be applied to
            all input data fields.  Note that the order of entries in the
            filters array or validators array is significant; the rules are
            applied in the same order in which you declare them.
        </para>

        <programlisting role="php"><![CDATA[<?php
$filters = array(
    '*'     => 'StringTrim',
    'month' => 'Digits'
);]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.filter.input.running">

        <title>Creating the Filter and Validator Processor</title>

        <para>
            After declaring the filters and validators arrays, use them as
            arguments in the constructor of Zend_Filter_Input.  This returns an
            object that knows all your filtering and validating rules, and you
            can use this object to process one or more sets of input data.
        </para>

        <programlisting role="php"><![CDATA[<?php
$input = new Zend_Filter_Input($filters, $validators);]]>
        </programlisting>

        <para>
            You can specify input data as the third constructor argument.  The
            data structure is an associative array.  The keys are field names,
            and the values are data values.  The standard <code>$_GET</code>
            and <code>$_POST</code> superglobal variables in PHP are examples
            of this format.  You can use either of these variables as input
            data for Zend_Filter_Input.
        </para>

        <programlisting role="php"><![CDATA[<?php
$data = $_GET;

$input = new Zend_Filter_Input($filters, $validators, $data);]]>
        </programlisting>

        <para>
            Alternatively, use the <code>setData()</code> method, passing
            an associative array of key/value pairs the same format as
            described above.
        </para>

        <programlisting role="php"><![CDATA[<?php
$input = new Zend_Filter_Input($filters, $validators);
$input->setData($newData);]]>
        </programlisting>

        <para>
            The <code>setData()</code> method redefines data in an existing
            Zend_Filter_Input object without changing the filtering and
            validation rules.  Using this method, you can run the same rules
            against different sets of input data.
        </para>

    </sect2>

    <sect2 id="zend.filter.input.results">

        <title>Retrieving Validated Fields and other Reports</title>

        <para>
            After you have declared filters and validators and created the
            input processor, you can retrieve reports of missing, unknown, and
            invalid fields.  You also can get the values of fields after
            filters have been applied.
        </para>

        <sect3 id="zend.filter.input.results.isvalid">

            <title>Querying if the input is valid</title>

            <para>
                If all input data pass the validation rules, the
                <code>isValid()</code> method returns <code>true</code>.
                If any field is invalid or any required field is missing,
                <code>isValid()</code> returns <code>false</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
if ($input->isValid()) {
  echo "OK\n";
}]]>
            </programlisting>

            <para>
                This method accepts an optional string argument, naming
                an individual field.  If the specified field passed validation
                and is ready for fetching, <code>isValid('fieldName')</code>
                returns <code>true</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
if ($input->isValid('month')) {
  echo "Field 'month' is OK\n";
}]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.filter.input.results.reports">

            <title>Getting Invalid, Missing, or Unknown Fields</title>

            <itemizedlist>
                <listitem>
                    <para>
                        <emphasis role="strong">Invalid</emphasis> fields are
                        those that don't pass one or more of their validation
                        checks.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Missing</emphasis> fields are
                        those that are not present in the input data, but were
                        declared with the metacommand
                        <code>'presence'=>'required'</code> (see the
                        <link linkend="zend.filter.input.metacommands.presence">later section</link>
                        on metacommands).
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis role="strong">Unknown</emphasis> fields are
                        those that are not declared in any rule in the array of
                        validators, but appear in the input data.
                    </para>
                </listitem>
            </itemizedlist>

            <programlisting role="php"><![CDATA[<?php
if ($input->hasInvalid() || $input->hasMissing()) {
  $messages = $input->getMessages();
}

// getMessages() simply returns the merge of getInvalid() and getMissing()

if ($input->hasInvalid()) {
  $invalidFields = $input->getInvalid();
}

if ($input->hasMissing()) {
  $missingFields = $input->getMissing();
}

if ($input->hasUnknown()) {
  $unknownFields = $input->getUnknown();
}]]>
            </programlisting>

            <para>
                The results of the <code>getMessages()</code> method is an
                associative array, mapping a rule name to an array of error
                messages related to that rule.  Note that the index of this
                array is the rule name used in the rule declaration, which may
                be different from the names of fields checked by the rule.
            </para>

            <para>
                The <code>getMessages()</code> method returns the merge of the
                arrays returned by the <code>getInvalid()</code> and
                <code>getMissing()</code>.  These methods return subsets of the
                messages, related to validation failures, or fields that were
                declared as required but missing from the input.
            </para>

            <para>
                The <code>getErrors()</code> method returns an associative array,
                mapping a rule name to an array of error identifiers.  Error
                identifiers are fixed strings, to identify the reason for a
                validation failure, while messages can be customized.
                See <xref linkend="zend.validate.introduction.using" /> for
                more information.
            </para>

            <para>
                You can specify the message returned by
                <code>getMissing()</code> using the 'missingMessage' option,
                as an argument to the Zend_Filter_Input constructor or using
                the <code>setOptions()</code> method.
            </para>

            <programlisting role="php"><![CDATA[<?php
$options = array(
    'missingMessage' => "Field '%field%' is required"
);

$input = new Zend_Filter_Input($filters, $validators, $data, $options);

// alternative method:

$input = new Zend_Filter_Input($filters, $validators, $data);
$input->setOptions($options);]]>
            </programlisting>

            <para>
                The results of the <code>getUnknown()</code> method is an
                associative array, mapping field names to field values.  Field
                names are used as the array keys in this case, instead of rule
                names, because no rule mentions the fields considered to be
                unknown fields.
            </para>

        </sect3>

        <sect3 id="zend.filter.input.results.escaping">

            <title>Getting Valid Fields</title>

            <para>
                All fields that are neither invalid, missing, nor unknown are
                considered valid.  You can get values for valid fields using a
                magic accessor.  There are also non-magic accessor methods
                <code>getEscaped()</code> and <code>getUnescaped()</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
$m = $input->month;                 // escaped output from magic accessor
$m = $input->getEscaped('month');   // escaped output
$m = $input->getUnescaped('month'); // not escaped]]>
            </programlisting>

            <para>
                By default, when retrieving a value, it is filtered with the
                Zend_Filter_HtmlEntities.  This is the default because it is
                considered the most common usage to output the value of a field
                in HTML.  The HtmlEntities filter helps prevent unintentional
                output of code, which can result in security problems.
            </para>

            <note>
                <para>
                    As shown above, you can retrieve the unescaped value using
                    the <code>getUnescaped()</code> method, but you must write
                    code to use the value safely, and avoid security issues
                    such as vulnerability to cross-site scripting attacks.
                </para>
            </note>

            <para>
                You can specify a different filter for escaping values, by
                specifying it in the constructor options array:
            </para>

            <programlisting role="php"><![CDATA[<?php
$options = array('escapeFilter' => 'StringTrim');
$input = new Zend_Filter_Input($filters, $validators, $data, $options);]]>
            </programlisting>

            <para>
                Alternatively, you can use the
                <code>setDefaultEscapeFilter()</code> method:
            </para>

            <programlisting role="php"><![CDATA[<?php
$input = new Zend_Filter_Input($filters, $validators, $data);
$input->setDefaultEscapeFilter(new Zend_Filter_StringTrim());]]>
            </programlisting>

            <para>
                In either usage, you can specify the escape filter as a string
                base name of the filter class, or as an object instance of a
                filter class.  The escape filter can be an instance of a filter
                chain, an object of the class Zend_Filter.
            </para>

            <para>
                Filters to escape output should be run in this way, to make
                sure they run after validation.  Other filters you declare in
                the array of filter rules are applied to input data before data
                are validated.  If escaping filters were run before validation,
                the process of validation would be more complex, and it would
                be harder to provide both escaped and unescaped versions of the
                data.  So it is recommended to declare filters to escape output
                using <code>setDefaultEscapeFilter()</code>, not in the
                <code>$filters</code> array.
            </para>

            <para>
                There is only one method <code>getEscaped()</code>, and
                therefore you can specify only one filter for escaping
                (although this filter can be a filter chain).  If you need a
                single instance of Zend_Filter_Input to return escaped output
                using more than one filtering method, you should extend
                Zend_Filter_Input and implement new methods in your subclass to
                get values in different ways.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.filter.input.metacommands">

        <title>Using Metacommands to Control Filter or Validator Rules</title>

        <para>
            In addition to declaring the mapping from fields to filters
            or validators, you can specify some "metacommands" in the array
            declarations, to control some optional behavior of
            Zend_Filter_Input.  Metacommands appear as string-indexed
            entries in a given filter or validator array value.
        </para>

        <sect3 id="zend.filter.input.metacommands.fields">

            <title>The <code>FIELDS</code> metacommand</title>

            <para>
                If the rule name for a filter or validator is different than
                the field to which it should apply, you can specify the
                field name with the 'fields' metacommand.
            </para>

            <para>
                You can specify this metacommand using the class constant
                <code>Zend_Filter_Input::FIELDS</code> instead of the
                string.
            </para>

            <programlisting role="php"><![CDATA[<?php
$filters = array(
    'month' => array(
        'Digits',        // filter name at integer index [0]
        'fields' => 'mo' // field name at string index ['fields']
    )
);]]>
            </programlisting>

            <para>
                In the example above, the filter rule applies the 'digits'
                filter to the input field named 'mo'.  The string 'month'
                simply becomes a mnemonic key for this filtering rule; it is
                not used as the field name if the field is specified with the
                'fields' metacommand, but it is used as the rule name.
            </para>

            <para>
                The default value of the 'fields' metacommand is the index of
                the current rule.  In the example above, if the 'fields'
                metacommand is not specified, the rule would apply to the input
                field named 'month'.
            </para>

            <para>
                Another use of the 'fields' metacommand is to specify fields
                for filters or validators that require multiple fields as
                input.  If the 'fields' metacommand is an array, the argument
                to the corresponding filter or validator is an array of the
                values of those fields.  For example, it is common for users to
                specify a password string in two fields, and they must type the
                same string in both fields.  Suppose you implement a validator
                class that takes an array argument, and returns
                <code>true</code> if all the values in the array are equal to
                each other.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'password' => array(
        'StringEquals',
        'fields' => array('password1', 'password2')
    )
);
// Invokes hypothetical class Zend_Validate_StringEquals, passing an array argument
// containing the values of the two input data fields named 'password1' and 'password2'.]]>
            </programlisting>

            <para>
                If the validation of this rule fails, the rule key
                (<code>'password'</code>) is used in the return value of
                <code>getInvalid()</code>, not any of the fields named in
                the 'fields' metacommand.
            </para>

        </sect3>

        <sect3 id="zend.filter.input.metacommands.presence">

            <title>The <code>PRESENCE</code> metacommand</title>

            <para>
                Each entry in the validator array may have a metacommand called
                'presence'.  If the value of this metacommand is 'required'
                then the field must exist in the input data, or else it is
                reported as a missing field.
            </para>

            <para>
                You can specify this metacommand using the class constant
                <code>Zend_Filter_Input::PRESENCE</code> instead of the
                string.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month' => array(
        'digits',
        'presence' => 'required'
    )
);]]>
            </programlisting>

            <para>
                The default value of this metacommand is 'optional'.
            </para>

        </sect3>

        <sect3 id="zend.filter.input.metacommands.default">

            <title>The <code>DEFAULT_VALUE</code> metacommand</title>

            <para>
                If a field is not present in the input data, and you specify a
                value for the 'default' metacommand for that rule, the field
                takes the value of the metacommand.
            </para>

            <para>
                You can specify this metacommand using the class constant
                <code>Zend_Filter_Input::DEFAULT_VALUE</code> instead of the
                string.
            </para>

            <para>
                This default value is assigned to the field before any of the
                validators are invoked.  The default value is applied to the
                field only for the current rule; if the same field is
                referenced in a subsequent rule, the field has no value when
                evaluating that rule.  Thus different rules can declare
                different default values for a given field.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month' => array(
        'digits',
        'default' => '1'
    )
);

// no value for 'month' field
$data = array();

$input = new Zend_Filter_Input(null, $validators, $data);
echo $input->month; // echoes 1]]>
            </programlisting>

            <para>
                If your rule uses the <code>FIELDS</code> metacommand
                to define an array of multiple fields, you can define
                an array for the <code>DEFAULT_VALUE</code> metacommand
                and the defaults of corresponding keys are used for any
                missing fields.  If <code>FIELDS</code> defines multiple
                fields but <code>DEFAULT_VALUE</code> is a scalar, then
                that default value is used as the value for any missing
                fields in the array.
            </para>

            <para>
                There is no default value for this metacommand.
            </para>

        </sect3>

        <sect3 id="zend.filter.input.metacommands.allow-empty">

            <title>The <code>ALLOW_EMPTY</code> metacommand</title>

            <para>
                By default, if a field exists in the input data, then
                validators are applied to it, even if the value of the field is
                an empty string (<code>''</code>).  This is likely to result in
                a failure to validate.  For example, if the validator checks
                for digit characters, and there are none because a zero-length
                string has no characters, then the validator reports the data
                as invalid.
            </para>

            <para>
                If in your case an empty string should be considered valid, you
                can set the metacommand 'allowEmpty' to <code>true</code>.
                Then the input data passes validation if it is present in the
                input data, but has the value of an empty string.
            </para>

            <para>
                You can specify this metacommand using the class constant
                <code>Zend_Filter_Input::ALLOW_EMPTY</code> instead of the
                string.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'address2' => array(
        'Alnum',
        'allowEmpty' => true
    )
);]]>
            </programlisting>

            <para>
                The default value of this metacommand is <code>false</code>.
            </para>

            <para>
                In the uncommon case that you declare a validation rule with
                no validators, but the 'allowEmpty' metacommand is
                <code>false</code> (that is, the field is considered invalid if
                it is empty), Zend_Filter_Input returns a default error message
                that you can retrieve with <code>getMessages()</code>.  You can
                specify this message using the 'notEmptyMessage' option, as an
                argument to the Zend_Filter_Input constructor or using the
                <code>setOptions()</code> method.
            </para>

            <programlisting role="php"><![CDATA[<?php
$options = array(
    'notEmptyMessage' => "A non-empty value is required for field '%field%'"
);

$input = new Zend_Filter_Input($filters, $validators, $data, $options);

// alternative method:

$input = new Zend_Filter_Input($filters, $validators, $data);
$input->setOptions($options);]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.filter.input.metacommands.break-chain">

            <title>The <code>BREAK_CHAIN</code> metacommand</title>

            <para>
                By default if a rule has more than one validator, all
                validators are applied to the input, and the resulting messages
                contain all error messages caused by the input.
            </para>

            <para>
                Alternatively, if the value of the 'breakChainOnFailure'
                metacommand is <code>true</code>, the validator chain
                terminates after the first validator fails.  The input data is
                not checked against subsequent validators in the chain, so it
                might cause more violations even if you correct the one
                reported.
            </para>

            <para>
                You can specify this metacommand using the class constant
                <code>Zend_Filter_Input::BREAK_CHAIN</code> instead of the
                string.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month' => array(
        'Digits',
        new Zend_Validate_Between(1,12),
        new Zend_Validate_GreaterThan(0),
        'breakChainOnFailure' => true
    )
);
$input = new Zend_Filter_Input(null, $validators);]]>
            </programlisting>

            <para>
                The default value of this metacommand is <code>false</code>.
            </para>

            <para>
                The validator chain class, Zend_Validate, is more flexible with
                respect to breaking chain execution than Zend_Filter_Input.
                With the former class, you can set the option to break the
                chain on failure independently for each validator in the chain.
                With the latter class, the defined value of the
                'breakChainOnFailure' metacommand for a rule applies uniformly
                for all validators in the rule.  If you require the more
                flexible usage, you should create the validator chain yourself,
                and use it as an object in the validator rule
                definition:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Create validator chain with non-uniform breakChainOnFailure attributes
$chain = new Zend_Validate();
$chain->addValidator(new Zend_Validate_Digits(), true);
$chain->addValidator(new Zend_Validate_Between(1,12), false);
$chain->addValidator(new Zend_Validate_GreaterThan(0), true);

// Declare validator rule using the chain defined above
$validators = array(
    'month' => $chain
);
$input = new Zend_Filter_Input(null, $validators);]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.filter.input.metacommands.messages">

            <title>The <code>MESSAGES</code> metacommand</title>

            <para>
                You can specify error messages for each validator in a rule
                using the metacommand 'messages'.  The value of this metacommand
                varies based on whether you have multiple validators in the
                rule, or if you want to set the message for a specific error
                condition in a given validator.
            </para>

            <para>
                You can specify this metacommand using the class constant
                <code>Zend_Filter_Input::MESSAGES</code> instead of the
                string.
            </para>

            <para>
                Below is a simple example of setting the default error message
                for a single validator.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month' => array(
        'digits',
        'messages' => 'A month must consist only of digits'
    )
);]]>
            </programlisting>

            <para>
                If you have multiple validators for which you want to set the
                error message, you should use an array for the value of the
                'messages' metacommand.
            </para>

            <para>
                Each element of this array is applied to the validator at the
                same index position.  You can specify a message for the
                validator at position <emphasis>n</emphasis> by using the value
                <emphasis>n</emphasis> as the array index.  Thus you can allow
                some validators to use their default message, while setting the
                message for a subsequent validator in the chain.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month' => array(
        'digits',
        new Zend_Validate_Between(1, 12),
        'messages' => array(
            // use default message for validator [0]
            // set new message for validator [1]
            1 => 'A month value must be between 1 and 12'
        )
    )
);]]>
            </programlisting>

            <para>
                If one of your validators has multiple error messages, they are
                identified by a message key.  There are different keys in each
                validator class, serving as identifiers for error messages that
                the respective validator class might generate.  Each validate
                class defines constants for its message keys.  You can use
                these keys in the 'messages' metacommand by passing an
                associative array instead of a string.
            </para>

            <programlisting role="php"><![CDATA[<?php
$validators = array(
    'month' => array(
        'digits', new Zend_Validate_Between(1, 12),
        'messages' => array(
            'A month must consist only of digits',
            array(
                Zend_Validate_Between::NOT_BETWEEN =>
                    'Month value %value% must be between %min% and %max%',
                Zend_Validate_Between::NOT_BETWEEN_STRICT =>
                    'Month value %value% must be strictly between %min% and %max%'
            )
        )
    )
);]]>
            </programlisting>

            <para>
                You should refer to documentation for each validator class to
                know if it has multiple error messages, the keys of these
                messages, and the tokens you can use in the message templates.
            </para>

        </sect3>

        <sect3 id="zend.filter.input.metacommands.global">

            <title>Using options to set metacommands for all rules</title>

            <para>
                The default value for 'allowEmpty', 'breakChainOnFailure', and
                'presence' metacommands can be set for all rules using the
                <code>$options</code> argument to the constructor of
                Zend_Filter_Input.  This allows you to set the default value
                for all rules, without requiring you to set the metacommand for
                every rule.
            </para>

            <programlisting role="php"><![CDATA[<?php
// The default is set so all fields allow an empty string.
$options = array('allowEmpty' => true);

// You can override this in a rule definition,
// if a field should not accept an empty string.
$validators = array(
    'month' => array(
        'Digits',
        'allowEmpty' => false
    )
);

$input = new Zend_Filter_Input($filters, $validators, $data, $options);]]>
            </programlisting>

            <para>
                The 'fields', 'messages', and 'default' metacommands cannot be
                set using this technique.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.filter.input.namespaces">

        <title>Adding Filter Class Namespaces</title>

        <para>
            By default, when you declare a filter or validator as a string,
            Zend_Filter_Input searches for the corresponding classes under
            the Zend_Filter or Zend_Validate namespaces.  For example,
            a filter named by the string 'digits' is found in the class
            Zend_Filter_Digits.
        </para>

        <para>
            If you write your own filter or validator classes, or use filters
            or validators provided by a third-party, the classes may exist in
            different namespaces than Zend_Filter or Zend_Validate.  You can
            tell Zend_Filter_Input to search more namespaces.  You can specify
            namespaces in the constructor options:
        </para>

        <programlisting role="php"><![CDATA[<?php
$options = array('inputNamespace' => 'My_Namespace');
$input = new Zend_Filter_Input($filters, $validators, $data, $options);]]>
        </programlisting>

        <para>
            Alternatively, you can use the addNamespace() method:
        </para>

        <programlisting role="php"><![CDATA[<?php
$input->addNamespace('Other_Namespace');

// Now the search order is:
// 1. My_Namespace
// 2. Other_Namespace
// 3. Zend_Filter
// 4. Zend_Validate]]>
        </programlisting>

        <para>
            You cannot remove Zend_Filter and Zend_Validate as namespaces, you
            only can add namespaces.  User-defined namespaces are searched
            first, Zend namespaces are searched last.
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.form.advanced">
    <title>Advanced Zend_Form Usage</title>

    <para>
        <code>Zend_Form</code> has a wealth of functionality, much of it aimed
        at experienced developers. This chapter aims to document some of this
        functionality with examples and use cases.
    </para>

    <sect2 id="zend.form.advanced.arrayNotation">
        <title>Array Notation</title>

        <para>
            Many experienced web developers like to group related form elements
            using array notation in the element names. For example, if you have
            two addresses you wish to capture, a shipping and a billing address,
            you may have identical elements; by grouping them in an array, you
            can ensure they are captured separately. Take the following form,
            for example:
        </para>

        <programlisting role="html"><![CDATA[
<form>
    <fieldset>
        <legend>Shipping Address</legend>
        <dl>
            <dt><label for="recipient">Ship to:</label></dt>
            <dd><input name="recipient" type="text" value="" /></dd>

            <dt><label for="address">Address:</label></dt>
            <dd><input name="address" type="text" value="" /></dd>

            <dt><label for="municipality">City:</label></dt>
            <dd><input name="municipality" type="text" value="" /></dd>

            <dt><label for="province">State:</label></dt>
            <dd><input name="province" type="text" value="" /></dd>

            <dt><label for="postal">Postal Code:</label></dt>
            <dd><input name="postal" type="text" value="" /></dd>
        </dl>
    </fieldset>

    <fieldset>
        <legend>Billing Address</legend>
        <dl>
            <dt><label for="payer">Bill To:</label></dt>
            <dd><input name="payer" type="text" value="" /></dd>

            <dt><label for="address">Address:</label></dt>
            <dd><input name="address" type="text" value="" /></dd>

            <dt><label for="municipality">City:</label></dt>
            <dd><input name="municipality" type="text" value="" /></dd>

            <dt><label for="province">State:</label></dt>
            <dd><input name="province" type="text" value="" /></dd>

            <dt><label for="postal">Postal Code:</label></dt>
            <dd><input name="postal" type="text" value="" /></dd>
        </dl>
    </fieldset>

    <dl>
        <dt><label for="terms">I agree to the Terms of Service</label></dt>
        <dd><input name="terms" type="checkbox" value="" /></dd>

        <dt></dt>
        <dd><input name="save" type="submit" value="Save" /></dd>
    </dl>
</form>
]]></programlisting>
        
        <para>
            In this example, the billing and shipping address contain some
            identical fields, which means one would overwrite the other. We can
            solve this solution using array notation:
        </para>

        <programlisting role="html"><![CDATA[
<form>
    <fieldset>
        <legend>Shipping Address</legend>
        <dl>
            <dt><label for="shipping-recipient">Ship to:</label></dt>
            <dd><input name="shipping[recipient]" id="shipping-recipient"
                type="text" value="" /></dd>

            <dt><label for="shipping-address">Address:</label></dt>
            <dd><input name="shipping[address]" id="shipping-address"
                type="text" value="" /></dd>

            <dt><label for="shipping-municipality">City:</label></dt>
            <dd><input name="shipping[municipality]" id="shipping-municipality"
                type="text" value="" /></dd>

            <dt><label for="shipping-province">State:</label></dt>
            <dd><input name="shipping[province]" id="shipping-province"
                type="text" value="" /></dd>

            <dt><label for="shipping-postal">Postal Code:</label></dt>
            <dd><input name="shipping[postal]" id="shipping-postal"
                type="text" value="" /></dd>
        </dl>
    </fieldset>

    <fieldset>
        <legend>Billing Address</legend>
        <dl>
            <dt><label for="billing-payer">Bill To:</label></dt>
            <dd><input name="billing[payer]" id="billing-payer"
                type="text" value="" /></dd>

            <dt><label for="billing-address">Address:</label></dt>
            <dd><input name="billing[address]" id="billing-address"
                type="text" value="" /></dd>

            <dt><label for="billing-municipality">City:</label></dt>
            <dd><input name="billing[municipality]" id="billing-municipality" 
                type="text" value="" /></dd>

            <dt><label for="billing-province">State:</label></dt>
            <dd><input name="billing[province]" id="billing-province"
                type="text" value="" /></dd>

            <dt><label for="billing-postal">Postal Code:</label></dt>
            <dd><input name="billing[postal]" id="billing-postal"
                type="text" value="" /></dd>
        </dl>
    </fieldset>

    <dl>
        <dt><label for="terms">I agree to the Terms of Service</label></dt>
        <dd><input name="terms" type="checkbox" value="" /></dd>

        <dt></dt>
        <dd><input name="save" type="submit" value="Save" /></dd>
    </dl>
</form>
]]></programlisting>

        <para>
            In the above sample, we now get separate addresses. In the submitted
            form, we'll now have three elements, the 'save' element for the
            submit, and then two arrays, 'shipping' and 'billing', each with
            keys for their various elements.
        </para>

        <para>
            <code>Zend_Form</code> attempts to automate this process with its
            <link linkend="zend.form.forms.subforms">sub forms</link>. By
            default, sub forms render using the array notation as shown in the
            previous HTML form listing, complete with ids. The array name is
            based on the sub form name, with the keys based on the elements
            contained in the sub form. Sub forms may be nested arbitrarily deep,
            and this will create nested arrays to reflect the structure.
            Additionally, the various validation routines in
            <code>Zend_Form</code> honor the array structure, ensuring that your
            form validates correctly, no matter how arbitrarily deep you nest
            your sub forms. You need do nothing to benefit from this; this
            behaviour is enabled by default.
        </para>

        <para>
            Additionally, there are facilities that allow you to turn on array
            notation conditionally, as well as specify the specific array to
            which an element or collection belongs:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Form::setIsArray($flag)</code>: By setting the
                    flag true, you can indicate that an entire form should be
                    treated as an array. By default, the form's name will be
                    used as the name of the array, unless
                    <code>setElementsBelongTo()</code> has been called. If the
                    form has no specified name, or if
                    <code>setElementsBelongTo()</code> has not been set, this
                    flag will be ignored (as there is no array name to which
                    the elements may belong).
                </para>

                <para>
                    You may determine if a form is being treated as an array
                    using the <code>isArray()</code> accessor.
                </para>
            </listitem>

            <listitem><para>
                    <code>Zend_Form::setElementsBelongTo($array)</code>:
                    Using this method, you can specify the name of an array to
                    which all elements of the form belong. You can determine the
                    name using the <code>getElementsBelongTo()</code> accessor.
            </para></listitem>
        </itemizedlist>

        <para>
            Additionally, on the element level, you can specify individual
            elements may belong to particular arrays using
            <code>Zend_Form_Element::setBelongsTo()</code> method.
            However, doing this may cause issues when validating your element,
            and is not recommended in most cases. However, you may occasionally
            want to know <emphasis>which</emphasis> array an element belongs to,
            which you may discover using the <code>getBelongsTo()</code>
            accessor. 
        </para>
    </sect2>

    <sect2 id="zend.form.advanced.multiPage">
        <title>Multi-Page Forms</title>

        <para>
            Currently, Multi-Page forms are not officially supported in
            <code>Zend_Form</code>; however, most support for implementing them
            is available and can be utilized with a little extra tooling.
        </para>

        <para>
            The key to creating a multi-page form is to utilize sub forms, but
            to display only one such sub form per page. This allows you to
            submit a single sub form at a time and validate it, but not process
            the form until all sub forms are complete.
        </para>

        <example id="zend.form.advanced.multiPage.registration">
            <title>Registration Form Example</title>

            <para>
                Let's use a registration form as an example. For our purposes,
                we want to capture the desired username and password on the
                first page, then the user's metadata -- given name, family name,
                and location -- and finally allow them to decide what mailing
                lists, if any, they wish to subscribe to.
            </para>

            <para>
                First, let's create our own form, and define several sub forms
                within it:
            </para>

            <programlisting role="php"><![CDATA[<?php
class My_Form_Registration extends Zend_Form
{
    public function init()
    {
        // Create user sub form: username and password
        $user = new Zend_Form_SubForm();
        $user->addElements(array(
            new Zend_Form_Element_Text('username', array(
                'required'   => true,
                'label'      => 'Username:',
                'filters'    => array('StringTrim', 'StringToLower'),
                'validators' => array(
                    'Alnum',
                    array('Regex', false, array('/^[a-z][a-z0-9]{2,}$/'))
                )
            )),

            new Zend_Form_Element_Password('password', array(
                'required'   => true,
                'label'      => 'Password:',
                'filters'    => array('StringTrim'),
                'validators' => array(
                    'NotEmpty',
                    array('StringLength', false, array(6))
                )
            )),
        ));

        // Create demographics sub form: given name, family name, and location
        $demog = new Zend_Form_SubForm();
        $demog->addElements(array(
            new Zend_Form_Element_Text('givenName', array(
                'required'   => true,
                'label'      => 'Given (First) Name:',
                'filters'    => array('StringTrim'),
                'validators' => array(
                    array('Regex', false, array('/^[a-z][a-z0-9., \'-]{2,}$/i'))
                )
            )),

            new Zend_Form_Element_Text('familyName', array(
                'required'   => true,
                'label'      => 'Family (Last) Name:',
                'filters'    => array('StringTrim'),
                'validators' => array(
                    array('Regex', false, array('/^[a-z][a-z0-9., \'-]{2,}$/i'))
                )
            )),

            new Zend_Form_Element_Text('location', array(
                'required'   => true,
                'label'      => 'Your Location:',
                'filters'    => array('StringTrim'),
                'validators' => array(
                    array('StringLength', false, array(2))
                )
            )),
        ));

        // Create mailing lists sub form
        $listOptions = array(
            'none'        => 'No lists, please',
            'fw-general'  =>  'Zend Framework General List',
            'fw-mvc'      =>  'Zend Framework MVC List',
            'fw-auth'     =>  'Zend Framwork Authentication and ACL List',
            'fw-services' => 'Zend Framework Web Services List',
        );
        $lists = new Zend_Form_SubForm();
        $lists->addElements(array(
            new Zend_Form_Element_MultiCheckbox('subscriptions', array(
                'label'        => 'Which lists would you like to subscribe to?',
                'multiOptions' => $listOptions,
                'required'     => true,
                'filters'      => array('StringTrim'),
                'validators'   => array(
                    array('InArray', false, array(array_keys($listOptions)))
                )
            )),
        ));

        // Attach sub forms to main form
        $this->addSubForms(array(
            'user'  => $user,
            'demog' => $demog,
            'lists' => $lists
        ));
    }
}
]]></programlisting>

            <para>
                Note that there are no submit buttons, and that we have done
                nothing with the sub form decorators -- which means that by
                default they will be displayed as fieldsets. We will need to be
                able to override these as we display each individual sub form,
                and add in submit buttons so we can actually process them --
                which will also require action and method properties. Let's add
                some scaffolding to our class to provide that information:
            </para>

            <programlisting role="php"><![CDATA[
class My_Form_Registration extends Zend_Form
{
    // ...

    /**
     * Prepare a sub form for display
     * 
     * @param  string|Zend_Form_SubForm $spec 
     * @return Zend_Form_SubForm
     */
    public function prepareSubForm($spec)
    {
        if (is_string($spec)) {
            $subForm = $this->{$spec};
        } elseif ($spec instanceof Zend_Form_SubForm) {
            $subForm = $spec;
        } else {
            throw new Exception('Invalid argument passed to ' . __FUNCTION__ . '()');
        }
        $this->setSubFormDecorators($subForm)
             ->addSubmitButton($subForm)
             ->addSubFormActions($subForm);
        return $subForm;
    }

    /**
     * Add form decorators to an individual sub form
     * 
     * @param  Zend_Form_SubForm $subForm
     * @return My_Form_Registration
     */
    public function setSubFormDecorators(Zend_Form_SubForm $subForm)
    {
        $subForm->setDecorators(array(
            'FormElements',
            array('HtmlTag', array('tag' => 'dl', 'class' => 'zend_form')),
            'Form',
        ));
        return $this;
    }

    /**
     * Add a submit button to an individual sub form
     * 
     * @param  Zend_Form_SubForm $subForm
     * @return My_Form_Registration
     */
    public function addSubmitButton(Zend_Form_SubForm $subForm)
    {
        $subForm->addElement(new Zend_Form_Element_Submit(
            'save', 
            array(
                'label'    => 'Save and continue',
                'required' => false,
                'ignore'   => true,
            )
        ));
        return $this;
    }

    /**
     * Add action and method to sub form
     * 
     * @param  Zend_Form_SubForm $subForm 
     * @return My_Form_Registration
     */
    public function addSubFormActions(Zend_Form_SubForm $subForm)
    {
        $subForm->setAction('/registration/process')
                ->setMethod('post');
        return $this;
    }
}
]]></programlisting>

            <para>
                Next, we need to add some scaffolding in our action controller,
                and have several considerations.  First, we need to make sure we
                persist form data between requests, so that we can determine
                when to quit.  Second, we need some logic to determine what form
                segments have already been submitted, and what sub form to
                display based on that information.  We'll use
                <code>Zend_Session_Namespace</code> to persist data, which will
                also help us answer the question of which form to submit.
            </para>

            <para>
                Let's create our controller, and add a method for retrieving a
                form instance:
            </para>

            <programlisting role="php"><![CDATA[<?php
class RegistrationController extends Zend_Controller_Action
{
    protected $_form;

    public function getForm()
    {
        if (null === $this->_form) {
            require_once 'My/Form/Registration.php';
            $this->_form = new My_Form_Registration();
        }
        return $this->_form;
    }
}
]]></programlisting>

            <para>
                Now, let's add some functionality for determining which form to
                display. Basically, until the entire form is considered valid,
                we need to continue displaying form segments. Additionally, we
                likely want to make sure they're in a particular order: user,
                demog, and then lists. We can determine what data has been
                submitted by checking our session namespace for particular keys
                representing each subform.
            </para>

            <programlisting role="php"><![CDATA[
class RegistrationController extends Zend_Controller_Action
{
    // ...

    protected $_namespace = 'RegistrationController';
    protected $_session;

    /**
     * Get the session namespace we're using
     * 
     * @return Zend_Session_Namespace
     */
    public function getSessionNamespace()
    {
        if (null === $this->_session) {
            require_once 'Zend/Session/Namespace.php';
            $this->_session = new Zend_Session_Namespace($this->_namespace);
        }

        return $this->_session;
    }

    /**
     * Get a list of forms already stored in the session
     * 
     * @return array
     */
    public function getStoredForms()
    {
        $stored = array();
        foreach ($this->getSessionNamespace() as $key => $value) {
            $stored[] = $key;
        }

        return $stored;
    }

    /**
     * Get list of all subforms available
     * 
     * @return array
     */
    public function getPotentialForms()
    {
        return array_keys($this->getForm()->getSubForms());
    }

    /**
     * What sub form was submitted?
     * 
     * @return false|Zend_Form_SubForm
     */
    public function getCurrentSubForm()
    {
        $request = $this->getRequest();
        if (!$request->isPost()) {
            return false;
        }

        foreach ($this->getPotentialForms() as $name) {
            if ($data = $request->getPost($name, false)) {
                if (is_array($data)) {
                    return $this->getForm()->getSubForm($name);
                    break;
                }
            }
        }

        return false;
    }

    /**
     * Get the next sub form to display
     * 
     * @return Zend_Form_SubForm|false
     */
    public function getNextSubForm()
    {
        $storedForms    = $this->getStoredForms();
        $potentialForms = $this->getPotentialForms();

        foreach ($potentialForms as $name) {
            if (!in_array($name, $storedForms)) {
                return $this->getForm()->getSubForm($name);
            }
        }

        return false;
    }
}
]]></programlisting>

            <para>
                The above methods allow us to use notations such as "<code>$subForm =
                    $this-&gt;getCurrentSubForm();</code>" to retrieve the current
                sub form for validation, or "<code>$next =
                    $this-&gt;getNextSubForm();</code>" to get the next one to
                display.
            </para>

            <para>
                Now, let's figure out how to process and display the various sub
                forms. We can use <code>getCurrentSubForm()</code> to determine
                if any sub forms have been submitted (false return values
                indicate none have been displayed or submitted), and
                <code>getNextSubForm()</code> to retrieve a form to display. We
                can then use the form's <code>prepareSubForm()</code> method to
                ensure the form is ready for display.
            </para>

            <para>
                When we have a form submission, we can validate the sub form,
                and then check to see if the entire form is now valid. To do
                these tasks, we'll need additional methods that ensure that
                submitted data is added to the session, and that when validating
                the form entire, we validate against all segments from the
                session:
            </para>

            <programlisting role="php"><![CDATA[<?php
class My_Form_Registration extends Zend_Form
{
    // ...
    
    /**
     * Is the sub form valid?
     * 
     * @param  Zend_Form_SubForm $subForm 
     * @param  array $data 
     * @return bool
     */
    public function subFormIsValid(Zend_Form_SubForm $subForm, array $data)
    {
        $name = $subForm->getName();
        if ($subForm->isValid($data)) {
            $this->getSessionNamespace()->$name = $subForm->getValues();
            return true;
        }

        return false;
    }

    /**
     * Is the full form valid?
     * 
     * @return bool
     */
    public function formIsValid()
    {
        $data = array();
        foreach ($this->getSessionNamespace() as $key => $info) {
            $data[$key] = $info;
        }

        return $this->getForm()->isValid($data);
    }
}
]]></programlisting>

            <para>
                Now that we have the legwork out of the way, let's build the
                actions for this controller. We'll need a landing page for the
                form, and then a 'process' action for processing the form.
            </para>

            <programlisting role="php"><![CDATA[<?php
class My_Form_Registration extends Zend_Form
{
    // ...

    public function indexAction()
    {
        // Either re-display the current page, or grab the "next" (first) 
        // sub form
        if (!$form = $this->getCurrentSubForm()) {
            $form = $this->getNextSubForm();
        }
        $this->view->form = $this->getForm()->prepareSubForm($form);
    }

    public function processAction()
    {
        if (!$form = $this->getCurrentSubForm()) {
            return $this->_forward('index');
        }

        if (!$this->subFormIsValid($form, $this->getRequest()->getPost())) {
            $this->view->form = $this->getForm()->prepareSubForm($form);
            return $this->render('index');
        }

        if (!$this->formIsValid()) {
            $form = $this->getNextSubForm();
            $this->view->form = $this->getForm()->prepareSubForm($form);
            return $this->render('index');
        }

        // Valid form!
        // Render information in a verification page
        $this->view->info = $this->getSessionNamespace();
        $this->render('verification');
    }
}
]]></programlisting>
            
            <para>
                As you'll notice, the actual code for processing the form is
                relatively simple. We check to see if we have a current sub form
                submission, and if not, we go back to the landing page. If we do
                have a sub form, we attempt to validate it, redisplaying it if
                it fails. If the sub form is valid, we then check to see if the
                form is valid, which would indicate we're done; if not, we
                display the next form segment. Finally, we display a
                verification page with the contents of the session.
            </para>

            <para>
                The view scripts are very simple:
            </para>

            <programlisting role="php"><![CDATA[
<? // registration/index.phtml ?>
<h2>Registration</h2>
<?= $this->form ?>

<? // registration/verification.phtml ?>
<h2>Thank you for registering!</h2>
<p>
    Here is the information you provided:
</p>

<?
// Have to do this construct due to how items are stored in session namespaces
foreach ($this->info as $info):
    foreach ($info as $form => $data): ?>
<h4><?= ucfirst($form) ?>:</h4>
<dl>
    <? foreach ($data as $key => $value): ?>
    <dt><?= ucfirst($key) ?></dt>
    <? if (is_array($value)):
        foreach ($value as $label => $val): ?>
    <dd><?= $val ?></dd>
        <? endforeach;
       else: ?>
    <dd><?= $this->escape($value) ?></dd>
    <? endif;
    endforeach; ?>
</dl>
<? endforeach;
endforeach ?>
]]></programlisting>
            
            <para>
                Upcoming releases of Zend Framework will include components to
                make multi page forms simpler by abstracting the session and
                ordering logic. In the meantime, the above example should serve
                as a reasonable guideline on how to accomplish this task for
                your site.
            </para>
        </example>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.form.decorators">
    <title>Creating Custom Form Markup Using Zend_Form_Decorator</title>

    <para>
        Rendering a form object is completely optional -- you do not need to use
        <code>Zend_Form</code>'s render() methods at all. However, if you do,
        decorators are used to render the various form objects. 
    </para>

    <para>
        An arbitrary number of decorators may be attached to each item
        (elements, display groups, sub forms, or the form object itself);
        however, only one decorator of a given type may be attached to each
        item.  Decorators are called in the order they are registered. Depending
        on the decorator, it may replace the content passed to it, or append or
        prepend the content.
    </para>

    <para>
        Object state is set via configuration options passed to the constructor
        or the decorator's <code>setOptions()</code> method. When creating
        decorators via an item's <code>addDecorator()</code> or related methods,
        options may be passed as an argument to the method. These can be used to
        specify placement, a separator to use between passed in content and
        newly generated content, and whatever options the decorator supports.
    </para>

    <para>
        Before each decorator's <code>render()</code> method is called, the
        current item is set in the decorator using <code>setElement()</code>,
        giving the decorator awareness of the item being rendered. This allows
        you to create decorators that only render specific portions of the item
        -- such as the label, the value, error messages, etc. By stringing
        together several decorators that render specific element segments, you
        can build complex markup representing the entire item.
    </para>

    <sect2 id="zend.form.decorators.operation">
        <title>Operation</title>

        <para>
            To configure a decorator, pass an array of options or a
            <code>Zend_Config</code> object to its constructor, an array to
            <code>setOptions()</code>, or a <code>Zend_Config</code> object to
            <code>setConfig()</code>.
        </para>

        <para>
            Standard options include:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>placement</code>: Placement can be either 'append' or
                    'prepend' (case insensitive), and indicates whether content
                    passed to <code>render()</code> will be appended or
                    prepended, respectively. In the case that a decorator
                    replaces the content, this setting is ignored. The default
                    setting is to append.
            </para></listitem>

            <listitem><para>
                    <code>separator</code>: The separator is used between the
                    content passed to <code>render()</code> and new content
                    generated by the decorator, or between items rendered by the
                    decorator (e.g. FormElements uses the separator between each
                    item rendered). In the case that a decorator replaces the
                    content, this setting may be ignored. The default value is
                    <code>PHP_EOL</code>.
            </para></listitem>
        </itemizedlist>

        <para>
            The decorator interface specifies methods for interacting with
            options. These include:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>setOption($key, $value)</code>: set a single option.
            </para></listitem>

            <listitem><para>
                    <code>getOption($key)</code>: retrieve a single option
                    value.
            </para></listitem>

            <listitem><para>
                    <code>getOptions()</code>: retrieve all options.
            </para></listitem>

            <listitem><para>
                    <code>removeOption($key)</code>: remove a single option.
            </para></listitem>

            <listitem><para>
                    <code>clearOptions()</code>: remove all options.
            </para></listitem>
        </itemizedlist>

        <para>
            Decorators are meant to interact with the various
            <code>Zend_Form</code> class types: <code>Zend_Form</code>,
            <code>Zend_Form_Element</code>, <code>Zend_Form_DisplayGroup</code>,
            and all classes deriving from them. The method
            <code>setElement()</code> allows you to set the object the
            decorator is currently working with, and <code>getElement()</code>
            is used to retrieve it.
        </para>

        <para>
            Each decorator's <code>render()</code> method accepts a string,
            <code>$content</code>. When the first decorator is called, this
            string is typically empty, while on subsequent calls it will be
            populated. Based on the type of decorator and the options passed in,
            the decorator will either replace this string, prepend the string,
            or append the string; an optional separator will be used in the
            latter two situations.
        </para>
    </sect2>

    <sect2 id="zend.form.decorators.standard">
        <title>Standard Decorators</title>

        <para>
            <code>Zend_Form</code> ships with many standard decorators; see
            <link linkend="zend.form.standardDecorators">the chapter on Standard
            Decorators</link> for details.
        </para>
    </sect2>

    <sect2 id="zend.form.decorators.custom">
        <title>Custom Decorators</title>

        <para>
            If you find your rendering needs are complex or need heavy
            customization, you should consider creating a custom decorator.
        </para>

        <para>
            Decorators need only implement
            <code>Zend_Decorator_Interface</code>. The interface specifies the
            following:
        </para>

        <programlisting role="php"><![CDATA[<?php
interface Zend_Decorator_Interface
{
    public function __construct($options = null);
    public function setElement($element);
    public function getElement();
    public function setOptions(array $options);
    public function setConfig(Zend_Config $config);
    public function setOption($key, $value);
    public function getOption($key);
    public function getOptions();
    public function removeOption($key);
    public function clearOptions();
    public function render($content);
}
?>]]></programlisting>

        <para>
            To make this simpler, you can simply extend
            <code>Zend_Decorator_Abstract</code>, which implements all methods
            except <code>render()</code>. 
        </para>

        <para>
            As an example, let's say you wanted to reduce the number of
            decorators you use, and build a "composite" decorator that took care
            of rendering the label, element, any error messages, and description
            in an HTML <code>div</code>. You might build such a 'Composite'
            decorator as follows:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_Decorator_Composite extends Zend_Form_Decorator_Abstract
{
    public function buildLabel()
    {
        $element = $this->getElement();
        $label = $element->getLabel();
        if ($translator = $element->getTranslator()) {
            $label = $translator->translate($label);
        }
        if ($element->getRequired()) {
            $label .= '*';
        }
        $label .= ':';
        return $element->getView()->formLabel($element->getName(), $label);
    }

    public function buildInput()
    {
        $element = $this->getElement();
        $helper  = $element->helper;
        return $element->getView()->$helper(
            $element->getName(),
            $element->getValue(),
            $element->getAttribs(),
            $element->options
        );
    }

    public function buildErrors()
    {
        $element  = $this->getElement();
        $messages = $element->getMessages();
        if (empty($messages)) {
            return '';
        }
        return '<div class="errors">' . $element->getView()->formErrors($messages) . '</div>';
    }

    public function buildDescription()
    {
        $element = $this->getElement();
        $desc    = $element->getDescription();
        if (empty($messages)) {
            return '';
        }
        return '<div class="description">' . $desc . '</div>';
    }

    public function render($content)
    {
        $element = $this->getElement();
        if (!$element instanceof Zend_Form_Element) {
            return $content;
        }
        if (null === $element->getView()) {
            return $content;
        }

        $separator = $this->getSeparator();
        $placement = $this->getPlacement();
        $label     = $this->buildLabel();
        $input     = $this->buildInput();
        $errors    = $this->buildErrors();
        $desc      = $this->buildDescription();

        $output = '<div class="form element">'
                . $label
                . $input
                . $errors
                . $desc
                . '</div>'

        switch ($placement) {
            case (self::PREPEND):
                return $output . $separator . $content;
            case (self::APPEND):
            default:
                return $content . $separator . $output;
        }
    }
}
?>]]></programlisting>

        <para>
            You can then place this in the decorator path:
        </para>

        <programlisting role="php"><![CDATA[<?php
// for an element:
$element->addPrefixPath('My_Decorator', 'My/Decorator/', 'decorator');

// for all elements:
$form->addElementPrefixPath('My_Decorator', 'My/Decorator/', 'decorator');
?>]]></programlisting>

        <para>
            You can then specify this decorator as 'Composite' and attach it to
            an element:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Overwrite existing decorators with this single one:
$element->setDecorators(array('Composite'));
?>]]></programlisting>

        <para>
            While this example showed how to create a decorator that renders
            complex output from several element properties, you can also create
            decorators that handle a single aspect of an element; the
            'Decorator' and 'Label' decorators are excellent examples of this
            practice. Doing so allows you to mix and match decorators to achieve
            complex output -- and also override single aspects of decoration to
            customize for your needs.
        </para>

        <para>
            For example, if you wanted to simply display that an error occurred
            when validating an element, but not display each of the individual
            validation error messages, you might create your own 'Errors'
            decorator:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_Decorator_Errors
{
    public function render($content = '')
    {
        $output = '<div class="errors">The value you provided was invalid;
            please try again</div>';

        $placement = $this->getPlacement();
        $separator = $this->getSeparator();

        switch ($placement) {
            case 'PREPEND':
                return $output . $separator . $content;
            case 'APPEND':
            default:
                return $content . $separator . $output;
        }
    }
}
?>]]></programlisting>
    
        <para>
            In this particular example, because the decorator's final segment,
            'Errors', matches the same as <code>Zend_Form_Decorator_Errors</code>,
            it will be rendered <emphasis>in place of</emphasis> that decorator
            -- meaning you would not need to change any decorators to modify the
            output. By naming your decorators after existing standard
            decorators, you can modify decoration without needing to modify your
            elements' decorators.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.form.elements">
    <title>Creating Form Elements Using Zend_Form_Element</title>

    <para>
        A form is made of elements, which typically correspond to HTML form
        input. Zend_Form_Element encapsulates single form elements, with the
        following areas of responsibility:
    </para>

    <itemizedlist>
        <listitem>
            <para>
                validation (is submitted data valid?)
            </para>

            <itemizedlist>
                <listitem><para>capturing of validation error codes and messages</para></listitem>
            </itemizedlist>
        </listitem>

        <listitem><para>
            filtering (how is the element escaped or normalized prior to
            validation and/or for output?)
        </para></listitem>

        <listitem><para>
            rendering (how is the element displayed?)
        </para></listitem>

        <listitem><para>
            metadata and attributes (what information further qualifies the element?)
        </para></listitem>
    </itemizedlist>

    <para>
        The base class, <code>Zend_Form_Element</code>, has reasonable defaults
        for many cases, but it is best to extend the class for commonly used
        special purpose elements. Additionally, Zend Framework ships with a
        number of standard XHTML elements; you can read about them <link
            linkend="zend.form.standardElements">in the Standard Elements
            chapter</link>.
    </para>

    <sect2 id="zend.form.elements.loaders">
        <title>Plugin Loaders</title>

        <para>
            <code>Zend_Form_Element</code> makes use of <link
                linkend="zend.loader.pluginloader">Zend_Loader_PluginLoader</link>
            to allow developers to specify locations of alternate validators,
            filters, and decorators. Each has its own plugin loader associated
            with it, and general accessors are used to retrieve and modify
            each.
        </para>

        <para>
            The following loader types are used with the various plugin loader
            methods: 'validate', 'filter', and 'decorator'. The type names are
            case insensitive.
        </para>

        <para>
            The methods used to interact with plugin loaders are as follows:
        </para>

        <itemizedlist>
            <listitem><para>
                <code>setPluginLoader($loader, $type)</code>:
                <code>$loader</code> is the plugin loader object itself, while
                <code>$type</code> is one of the types specified above.  This
                sets the plugin loader for the given type to the newly
                specified loader object.
            </para></listitem>

            <listitem><para>
                <code>getPluginLoader($type)</code>: retrieves the plugin
                loader associated with <code>$type</code>.
            </para></listitem>

            <listitem><para>
                <code>addPrefixPath($prefix, $path, $type = null)</code>: adds
                a prefix/path association to the loader specified by
                <code>$type</code>. If <code>$type</code> is null, it will
                attempt to add the path to all loaders, by appending the prefix
                with each of "_Validate", "_Filter", and "_Decorator"; and
                appending the path with "Validate/", "Filter/", and
                "Decorator/". If you have all your extra form element classes
                under a common hierarchy, this is a convenience method for
                setting the base prefix for them.
            </para></listitem>

            <listitem><para>
                <code>addPrefixPaths(array $spec)</code>: allows you to add
                many paths at once to one or more plugin loaders. It expects
                each array item to be an array with the keys 'path', 'prefix',
                and 'type'.
            </para></listitem>
        </itemizedlist>

        <para>
            Custom validators, filters, and decorators are an easy way to share
            functionality between forms and encapsulate custom functionality.
        </para>

        <example id="zend.form.elements.loaders.customLabel">
            <title>Custom Label</title>

            <para>
                One common use case for plugins is to provide replacements for
                standard classes. For instance, if you want to provide a
                different implementation of the 'Label' decorator -- for
                instance, to always append a colon -- you could create your own
                'Label' decorator with your own class prefix, and then add it to
                your prefix path.
            </para>

            <para>
                Let's start with a custom Label decorator. We'll give it the
                class prefix "My_Decorator", and the class itself will be in the
                file "My/Decorator/Label.php".
            </para>

            <programlisting role="php"><![CDATA[<?php
class My_Decorator_Label extends Zend_Form_Decorator_Abstract
{
    protected $_placement = 'PREPEND';

    public function render($content)
    {
        if (null === ($element = $this->getElement())) {
            return $content;
        }
        if (!method_exists($element, 'getLabel')) {
            return $content;
        }

        $label = $element->getLabel() . ':';

        if (null === ($view = $element->getView())) {
            return $this->renderLabel($content, $label);
        }

        $label = $view->formLabel($element->getName(), $label);

        return $this->renderLabel($content, $label);
    }

    public function renderLabel($content, $label)
    {
        $placement = $this->getPlacement();
        $separator = $this->getSeparator();

        switch ($placement) {
            case 'APPEND':
                return $content . $separator . $label;
            case 'PREPEND':
            default:
                return $label . $separator . $content;
        }
    }
}
]]></programlisting>

            <para>
                Now we can tell the element to use this plugin path when looking
                for decorators:
            </para>

            <programlisting role="php"><![CDATA[
$element->addPrefixPath('My_Decorator', 'My/Decorator/', 'decorator');
]]></programlisting>

            <para>
                Alternately, we can do that at the form level to ensure all
                decorators use this path:
            </para>

            <programlisting role="php"><![CDATA[
$form->addElementPrefixPath('My_Decorator', 'My/Decorator/', 'decorator');
]]></programlisting>

            <para>
                With this path added, when you add a decorator, the
                'My/Decorator/' path will be searched first to see if the
                decorator exists there. As a result, 'My_Decorator_Label' will
                now be used when the 'Label' decorator is requested.
            </para>
        </example>
    </sect2>

    <sect2 id="zend.form.elements.filters">
        <title>Filters</title>

        <para>
            It's often useful and/or necessary to perform some normalization on
            input prior to validation -- for instance, you may want to strip out
            all HTML, but run your validations on what remains to ensure the
            submission is valid. Or you may want to trim empty space surrounding
            input so that a StringLength validator will not return a false
            positive. These operations may be performed using
            <code>Zend_Filter</code>, and <code>Zend_Form_Element</code> has
            support for filter chains, allowing you to specify multiple,
            sequential filters to utilize.  Filtering happens both during
            validation and when you retrieve the element value via
            <code>getValue()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
$filtered = $element->getValue();
?>]]></programlisting>

        <para>
            Filters may be added to the chain in two ways:
        </para>

        <itemizedlist>
            <listitem><para>
                passing in a concrete filter instance
            </para></listitem>

            <listitem><para>
                providing a filter name -- either a short name or fully
                qualified class name
            </para></listitem>
        </itemizedlist>

        <para>
            Let's see some examples:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Concrete filter instance:
$element->addFilter(new Zend_Filter_Alnum());

// Fully qualified class name:
$element->addFilter('Zend_Filter_Alnum');

// Short filter name:
$element->addFilter('Alnum');
$element->addFilter('alnum');
?>]]></programlisting>

        <para>
            Short names are typically the filter name minus the prefix. In the
            default case, this will mean minus the 'Zend_Filter_' prefix.
            Additionally, the first letter need not be upper-cased.
        </para>

        <note>
            <title>Using Custom Filter Classes</title>

            <para>
                If you have your own set of filter classes, you can tell
                <code>Zend_Form_Element</code> about these using
                <code>addPrefixPath()</code>. For instance, if you have
                validators under the 'My_Filter' prefix, you can tell
                <code>Zend_Form_Element</code> about this as follows:
            </para>

            <programlisting role="php"><![CDATA[<?php
$element->addPrefixPath('My_Filter', 'My/Filter/', 'filter');
?>]]></programlisting>

            <para>
                (Recall that the third argument indicates which plugin loader
                on which to perform the action.)
            </para>
        </note>

        <para>
            If at any time you need the unfiltered value, use the
            <code>getUnfilteredValue()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
$unfiltered = $element->getUnfilteredValue();
?>]]></programlisting>

        <para>
            For more information on filters, see the <link
                linkend="zend.filter.introduction">Zend_Filter
                documentation</link>.
        </para>

        <para>
            Methods associated with filters include:
        </para>

        <itemizedlist>
            <listitem><para>
                <code>addFilter($nameOrFilter, array $options = null)</code>
            </para></listitem>

            <listitem><para>
                <code>addFilters(array $filters)</code>
            </para></listitem>

            <listitem><para>
                <code>setFilters(array $filters)</code> (overwrites all filters)
            </para></listitem>

            <listitem><para>
                <code>getFilter($name)</code> (retrieve a filter object by name)
            </para></listitem>

            <listitem><para>
                <code>getFilters()</code> (retrieve all filters)
            </para></listitem>

            <listitem><para>
                <code>removeFilter($name)</code> (remove filter by name)
            </para></listitem>

            <listitem><para>
                <code>clearFilters()</code> (remove all filters)
            </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.elements.validators">
        <title>Validators</title>

        <para>
            If you subscribe to the security mantra of "filter input, escape
            output," you'll want to validate ("filter input") your form input.
            In <code>Zend_Form</code>, each element includes its own validator
            chain, consisting of <code>Zend_Validate_*</code> validators.
        </para>

        <para>
            Validators may be added to the chain in two ways:
        </para>

        <itemizedlist>
            <listitem><para>
                passing in a concrete validator instance
            </para></listitem>

            <listitem><para>
                providing a validator name -- either a short name or fully
                qualified class name
            </para></listitem>
        </itemizedlist>

        <para>
            Let's see some examples:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Concrete validator instance:
$element->addValidator(new Zend_Validate_Alnum());

// Fully qualified class name:
$element->addValidator('Zend_Validate_Alnum');

// Short validator name:
$element->addValidator('Alnum');
$element->addValidator('alnum');
?>]]></programlisting>

        <para>
            Short names are typically the validator name minus the prefix. In
            the default case, this will mean minus the 'Zend_Validate_' prefix.
            Additionally, the first letter need not be upper-cased.
        </para>

        <note>
            <title>Using Custom Validator Classes</title>

            <para>
                If you have your own set of validator classes, you can tell
                <code>Zend_Form_Element</code> about these using
                <code>addPrefixPath()</code>. For instance, if you have
                validators under the 'My_Validator' prefix, you can tell
                <code>Zend_Form_Element</code> about this as follows:
            </para>

            <programlisting role="php"><![CDATA[<?php
$element->addPrefixPath('My_Validator', 'My/Validator/', 'validate');
?>]]></programlisting>

            <para>
                (Recall that the third argument indicates which plugin loader
                on which to perform the action.)
            </para>
        </note>

        <para>
            If failing a particular validation should prevent later validators
            from firing, pass boolean <code>true</code> as the second parameter:
        </para>

        <programlisting role="php"><![CDATA[<?php
$element->addValidator('alnum', true);
?>]]></programlisting>

        <para>
            If you are using a string name to add a validator, and the
            validator class accepts arguments to the constructor, you may pass
            these to the third parameter of <code>addValidator()</code> as an
            array:
        </para>

        <programlisting role="php"><![CDATA[<?php
$element->addValidator('StringLength', false, array(6, 20));
?>]]></programlisting>

        <para>
            Arguments passed in this way should be in the order in which they
            are defined in the constructor. The above example will instantiate
            the <code>Zend_Validate_StringLenth</code> class with its
            <code>$min</code> and <code>$max</code> parameters:
        </para>

        <programlisting role="php"><![CDATA[<?php
$validator = new Zend_Validate_StringLength(6, 20);
?>]]></programlisting>

        <note>
            <title>Providing Custom Validator Error Messages</title>

            <para>
                Some developers may wish to provide custom error messages for a
                validator. <code>Zend_Form_Element::addValidator()</code>'s
                <code>$options</code> argument allows you to do so by providing
                the key 'messages' and setting it to an array of key/value pairs
                for setting the message templates. You will need to know the
                error codes of the various validation error types for the
                particular validator.
            </para>

            <para>
                A better option is to use a <code>Zend_Translate_Adapter</code>
                with your form. Error codes are automatically passed to the
                adapter by the default Errors decorator; you can then specify
                your own error message strings by setting up translations for
                the various error codes of your validators.
            </para>
        </note>

        <para>
            You can also set many validators at once, using
            <code>addValidators()</code>. The basic usage is to pass an array
            of arrays, with each array containing 1 to 3 values, matching the
            constructor of <code>addValidator()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
$element->addValidators(array(
    array('NotEmpty', true),
    array('alnum'),
    array('stringLength', false, array(6, 20)),
));
?>]]></programlisting>

        <para>
            If you want to be more verbose or explicit, you can use the array
            keys 'validator', 'breakChainOnFailure', and 'options':
        </para>

        <programlisting role="php"><![CDATA[<?php
$element->addValidators(array(
    array(
        'validator'           => 'NotEmpty',
        'breakChainOnFailure' => true),
    array('validator' => 'alnum'),
    array(
        'validator' => 'stringLength',
        'options'   => array(6, 20)),
));
?>]]></programlisting>

        <para>
            This usage is good for illustrating how you could then configure
            validators in a config file:
        </para>

        <programlisting role="ini"><![CDATA[
element.validators.notempty.validator = "NotEmpty"
element.validators.notempty.breakChainOnFailure = true
element.validators.alnum.validator = "Alnum"
element.validators.strlen.validator = "StringLength"
element.validators.strlen.options.min = 6
element.validators.strlen.options.max = 20
]]></programlisting>

        <para>
            Notice that every item has a key, whether or not it needs one; this
            is a limitation of using configuration files -- but it also helps
            make explicit what the arguments are for. Just remember that any
            validator options must be specified in order.
        </para>

        <para>
            To validate an element, pass the value to 
            <code>isValid()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
if ($element->isValid($value)) {
    // valid
} else {
    // invalid
}
?>]]></programlisting>

        <note>
            <title>Validation Operates On Filtered Values</title>

            <para>
                <code>Zend_Form_Element::isValid()</code> filters values through
                the provided filter chain prior to validation. See <link
                    linkend="zend.form.elements.filters">the Filters
                    section</link> for more information.
            </para>
        </note>

        <note>
            <title>Validation Context</title>

            <para>
                <code>Zend_Form_Element::isValid()</code> supports an
                additional argument, <code>$context</code>.
                <code>Zend_Form::isValid()</code> passes the entire array of
                data being processed to <code>$context</code> when validating a
                form, and <code>Zend_Form_Element::isValid()</code>, in turn,
                passes it to each validator.  This means you can write
                validators that are aware of data passed to other form
                elements. As an example, consider a standard registration form
                that has fields for both password and a password confirmation;
                one validation would be that the two fields match. Such a
                validator might look like the following:
            </para>

            <programlisting role="php"><![CDATA[<?php
class My_Validate_PasswordConfirmation extends Zend_Validate_Abstract
{
    const NOT_MATCH = 'notMatch';

    protected $_messageTemplates = array(
        self::NOT_MATCH => 'Password confirmation does not match'
    );

    public function isValid($value, $context = null)
    {
        $value = (string) $value;
        $this->_setValue($value);

        if (is_array($context)) {
            if (isset($context['password_confirm'])
                && ($value == $context['password_confirm']))
            {
                return true;
            }
        } elseif (is_string($context) && ($value == $context)) {
            return true;
        }

        $this->_error(self::NOT_MATCH);
        return false;
    }
}
?>]]></programlisting>
        </note>

        <para>
            Validators are processed in order. Each validator is processed,
            unless a validator created with a true
            <code>breakChainOnFailure</code> value fails its validation. Be
            sure to specify your validators in a reasonable order.
        </para>

        <para>
            After a failed validation, you can retrieve the error codes and
            messages from the validator chain:
        </para>

        <programlisting role="php"><![CDATA[<?php
$errors   = $element->getErrors();
$messages = $element->getMessages();
?>]]></programlisting>

        <para>
            (Note: error messages returned are an associative array of error
            code / error message pairs.)
        </para>

        <para>
            In addition to validators, you can specify that an element is
            required, using <code>setRequired(true)</code>. By default, this
            flag is false, meaning that your validator chain will be skipped if
            no value is passed to <code>isValid()</code>. You can modify this
            behavior in a number of ways:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    By default, when an element is required, a flag,
                    'allowEmpty', is also true. This means that if a value
                    evaluating to empty is passed to <code>isValid()</code>, the
                    validators will be skipped. You can toggle this flag using
                    the accessor <code>setAllowEmpty($flag)</code>; when the
                    flag is false, then if a value is passed, the validators
                    will still run.
                </para>
            </listitem>

            <listitem>
                <para>
                    By default, if an element is required, but does not contain
                    a 'NotEmpty' validator, <code>isValid()</code> will add one
                    to the top of the stack, with the
                    <code>breakChainOnFailure</code> flag set. This makes the
                    required flag have semantic meaning: if no value is passed,
                    we immediately invalidate the submission and notify the
                    user, and prevent other validators from running on what we
                    already know is invalid data.
                </para>

                <para>
                    If you do not want this behavior, you can turn it off by
                    passing a false value to
                    <code>setAutoInsertNotEmptyValidator($flag)</code>; this
                    will prevent <code>isValid()</code> from placing the
                    'NotEmpty' validator in the validator chain.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            For more information on validators, see the <link
                linkend="zend.validate.introduction">Zend_Validate
                documentation</link>.
        </para>

        <note>
            <title>Using Zend_Form_Elements as general-purpose validators</title>

            <para>
                <code>Zend_Form_Element</code> implements
                <code>Zend_Validate_Interface</code>, meaning an element may
                also be used as a validator in other, non-form related
                validation chains.
            </para>
        </note>

        <para>
            Methods associated with validation include:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>setRequired($flag)</code> and
                    <code>isRequired()</code> allow you to set and retrieve the
                    status of the 'required' flag. When set to boolean <code>true</code>, this
                    flag requires that the element be in the data processed by
                    <code>Zend_Form</code>.
            </para></listitem>

            <listitem><para>
                    <code>setAllowEmpty($flag)</code> and
                    <code>getAllowEmpty()</code> allow you to modify the
                    behaviour of optional elements (i.e., elements where the
                    required flag is false). When the 'allow empty' flag is
                    true, empty values will not be passed to the validator
                    chain.
            </para></listitem>

            <listitem><para>
                    <code>setAutoInsertNotEmptyValidator($flag)</code> allows
                    you to specify whether or not a 'NotEmpty' validator will be
                    prepended to the validator chain when the element is
                    required. By default, this flag is true.
            </para></listitem>

            <listitem><para>
                <code>addValidator($nameOrValidator, $breakChainOnFailure = false, array $options = null)</code>
            </para></listitem>

            <listitem><para>
                <code>addValidators(array $validators)</code>
            </para></listitem>

            <listitem><para>
                <code>setValidators(array $validators)</code> (overwrites all validators)
            </para></listitem>

            <listitem><para>
                <code>getValidator($name)</code> (retrieve a validator object by name)
            </para></listitem>

            <listitem><para>
                <code>getValidators()</code> (retrieve all validators)
            </para></listitem>

            <listitem><para>
                <code>removeValidator($name)</code> (remove validator by name)
            </para></listitem>

            <listitem><para>
                <code>clearValidators()</code> (remove all validators)
            </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.elements.decorators">
        <title>Decorators</title>

        <para>
            One particular pain point for many web developers is the creation
            of the XHTML forms themselves. For each element, the developer
            needs to create markup for the element itself, typically a label,
            and, if they're being nice to their users, markup for displaying
            validation error messages. The more elements on the page, the less
            trivial this task becomes.
        </para>

        <para>
            <code>Zend_Form_Element</code> tries to solve this issue through
            the use of "decorators". Decorators are simply classes that have
            access to the element and a method for rendering content. For more
            information on how decorators work, please see the section on <link
                linkend="zend.form.decorators">Zend_Form_Decorator</link>.
        </para>

        <para>
            The default decorators used by <code>Zend_Form_Element</code> are:
        </para>

        <itemizedlist>
            <listitem><para>
                <emphasis>ViewHelper</emphasis>: specifies a view helper to use
                to render the element. The 'helper' element attribute can be
                used to specify which view helper to use. By default,
                <code>Zend_Form_Element</code> specifies the 'formText' view
                helper, but individual subclasses specify different helpers.
            </para></listitem>

            <listitem><para>
                <emphasis>Errors</emphasis>: appends error messages to the
                element using <code>Zend_View_Helper_FormErrors</code>. If none are present,
                nothing is appended.
            </para></listitem>

            <listitem><para>
                <emphasis>HtmlTag</emphasis>: wraps the element and errors in
                an HTML &lt;dd&gt; tag.
            </para></listitem>

            <listitem><para>
                <emphasis>Label</emphasis>: prepends a label to the element
                using <code>Zend_View_Helper_FormLabel</code>, and wraps it in a &lt;dt&gt;
                tag. If no label is provided, just the definition term tag is
                rendered.
            </para></listitem>
        </itemizedlist>

        <note>
            <title>Default Decorators Do Not Need to Be Loaded</title>

            <para>
                By default, the default decorators are loaded during object
                initialization. You can disable this by passing the
                'disableLoadDefaultDecorators' option to the constructor:
            </para>

            <programlisting role="php"><![CDATA[<?php
$element = new Zend_Form_Element('foo', array('disableLoadDefaultDecorators' => true));
]]></programlisting>
            
            <para>
                This option may be mixed with any other options you pass,
                both as array options or in a <code>Zend_Config</code> object.
            </para>
        </note>

        <para>
            Since the order in which decorators are registered matters -- first
            decorator registered is executed first -- you will need to make
            sure you register your decorators in an appropriate order, or
            ensure that you set the placement options in a sane fashion. To
            give an example, here is the code that registers the default
            decorators:
        </para>

        <programlisting role="php"><![CDATA[<?php
$this->addDecorators(array(
    array('ViewHelper'),
    array('Errors'),
    array('HtmlTag', array('tag' => 'dd')),
    array('Label', array('tag' => 'dt')),
));
?>]]></programlisting>

        <para>
            The initial content is created by the 'ViewHelper' decorator, which
            creates the form element itself. Next, the 'Errors' decorator
            fetches error messages from the element, and, if any are present,
            passes them to the 'FormErrors' view helper to render.  The next
            decorator, 'HtmlTag', wraps the element and errors in an HTML
            &lt;dd&gt; tag.  Finally, the last decorator, 'label', retrieves
            the element's label and passes it to the 'FormLabel' view helper,
            wrapping it in an HTML &lt;dt&gt; tag; the value is prepended to
            the content by default. The resulting output looks basically like
            this:
        </para>

        <programlisting role="html"><![CDATA[
<dt><label for="foo" class="optional">Foo</label></dt>
<dd>
    <input type="text" name="foo" id="foo" value="123" />
    <ul class="errors">
        <li>"123" is not an alphanumeric value</li>
    </ul>
</dd>
]]></programlisting>

        <para>
            For more information on decorators, read the <link
                linkend="zend.form.decorators">Zend_Form_Decorator
                section</link>.
        </para>

        <note>
            <title>Using Multiple Decorators of the Same Type</title>

            <para>
                Internally, <code>Zend_Form_Element</code> uses a decorator's
                class as the lookup mechanism when retrieving decorators. As a
                result, you cannot register multiple decorators of the same
                type; subsequent decorators will simply overwrite those that
                existed before.
            </para>

            <para>
                To get around this, you can use <emphasis>aliases</emphasis>.
                Instead of passing a decorator or decorator name as the first
                argument to <code>addDecorator()</code>, pass an array with a
                single element, with the alias pointing to the decorator object
                or name:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Alias to 'FooBar':
$element->addDecorator(array('FooBar' => 'HtmlTag'), array('tag' => 'div'));

// And retrieve later:
$decorator = $element->getDecorator('FooBar');
?>]]></programlisting>

            <para>
                In the <code>addDecorators()</code> and
                <code>setDecorators()</code> methods, you will need to pass
                the 'decorator' option in the array representing the decorator:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Add two 'HtmlTag' decorators, aliasing one to 'FooBar':
$element->addDecorators(
    array('HtmlTag', array('tag' => 'div')),
    array(
        'decorator' => array('FooBar' => 'HtmlTag'),
        'options' => array('tag' => 'dd')
    ),
);

// And retrieve later:
$htmlTag = $element->getDecorator('HtmlTag');
$fooBar  = $element->getDecorator('FooBar');
?>]]></programlisting>
        </note>

        <para>
            Methods associated with decorators include:
        </para>

        <itemizedlist>
            <listitem><para>
                <code>addDecorator($nameOrDecorator, array $options = null)</code>
            </para></listitem>

            <listitem><para>
                <code>addDecorators(array $decorators)</code>
            </para></listitem>

            <listitem><para>
                <code>setDecorators(array $decorators)</code> (overwrites all decorators)
            </para></listitem>

            <listitem><para>
                <code>getDecorator($name)</code> (retrieve a decorator object by name)
            </para></listitem>

            <listitem><para>
                <code>getDecorators()</code> (retrieve all decorators)
            </para></listitem>

            <listitem><para>
                <code>removeDecorator($name)</code> (remove decorator by name)
            </para></listitem>

            <listitem><para>
                <code>clearDecorators()</code> (remove all decorators)
            </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.elements.metadata">
        <title>Metadata and Attributes</title>

        <para>
            <code>Zend_Form_Element</code> handles a variety of attributes and
            element metadata. Basic attributes include:
        </para>

        <itemizedlist>
            <listitem><para>
                <emphasis>name</emphasis>: the element name. Uses the
                <code>setName()</code> and <code>getName()</code> accessors.
            </para></listitem>

            <listitem><para>
                <emphasis>label</emphasis>: the element label. Uses the
                <code>setLabel()</code> and <code>getLabel()</code> accessors.
            </para></listitem>

            <listitem><para>
                <emphasis>order</emphasis>: the index at which an element
                should appear in the form. Uses the <code>setOrder()</code> and
                <code>getOrder()</code> accessors.
            </para></listitem>

            <listitem><para>
                <emphasis>value</emphasis>: the current element value. Uses the
                <code>setValue()</code> and <code>getValue()</code> accessors.
            </para></listitem>

            <listitem><para>
                <emphasis>description</emphasis>: a description of the element;
                often used to provide tooltip or javascript contextual hinting
                describing the purpose of the element. Uses the
                <code>setDescription()</code> and <code>getDescription()</code>
                accessors.
            </para></listitem>

            <listitem><para>
                <emphasis>required</emphasis>: flag indicating whether or not
                the element is required when performing form validation. Uses
                the <code>setRequired()</code> and <code>getRequired()</code>
                accessors. This flag is false by default.
            </para></listitem>

            <listitem><para>
                <emphasis>allowEmpty</emphasis>: flag indicating whether or not
                a non-required (optional) element should attempt to validate
                empty values. When true, and the required flag is false, empty
                values are not passed to the validator chain, and presumed true.
                Uses the <code>setAllowEmpty()</code> and <code>getAllowEmpty()</code>
                accessors. This flag is true by default.
            </para></listitem>

            <listitem><para>
                <emphasis>autoInsertNotEmptyValidator</emphasis>: flag
                indicating whether or not to insert a 'NotEmpty' validator when
                the element is required. By default, this flag is true. Set the
                flag with <code>setAutoInsertNotEmptyValidator($flag)</code> and
                determine the value with
                <code>autoInsertNotEmptyValidator()</code>.
            </para></listitem>
        </itemizedlist>

        <para>
            Form elements may require additional metadata. For XHTML form
            elements, for instance, you may want to specify attributes such as
            the class or id. To facilitate this are a set of accessors:
        </para>

        <itemizedlist>
            <listitem><para>
                <emphasis>setAttrib($name, $value)</emphasis>: add an attribute
            </para></listitem>

            <listitem><para>
                <emphasis>addAttribs(array $attribs)</emphasis>: add many
                attributes at once
            </para></listitem>

            <listitem><para>
                <emphasis>setAttribs(array $attribs)</emphasis>: like
                addAttribs(), but overwrites
            </para></listitem>

            <listitem><para>
                <emphasis>getAttrib($name)</emphasis>: retrieve a single
                attribute value
            </para></listitem>

            <listitem><para>
                <emphasis>getAttribs()</emphasis>: retrieve all attributes as
                key/value pairs
            </para></listitem>

            <listitem><para>
                <emphasis>removeAttrib($name)</emphasis>: remove a single
                attribute
            </para></listitem>

            <listitem><para>
                <emphasis>clearAttribs()</emphasis>: clear all attributes
            </para></listitem>
        </itemizedlist>

        <para>
            Most of the time, however, you can simply access them as object
            properties, as <code>Zend_Form_Element</code> utilizes overloading
            to facilitate access to them:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Equivalent to $element->setAttrib('class', 'text'):
$element->class = 'text;
?>]]></programlisting>

        <para>
            By default, all attributes are passed to the view helper used by
            the element during rendering, and rendered as HTML attributes of
            the element tag.
        </para>
    </sect2>

    <sect2 id="zend.form.elements.standard">
        <title>Standard Elements</title>

        <para>
            <code>Zend_Form</code> ships with a number of standard elements; please read the
            <link linkend="zend.form.standardElements">Standard Elements</link>
            chapter for full details.
        </para>
    </sect2>

    <sect2 id="zend.form.elements.methods">
        <title>Zend_Form_Element Methods</title>

        <para>
            <code>Zend_Form_Element</code> has many, many methods. What follows
            is a quick summary of their signatures, grouped by type:
        </para>

        <itemizedlist>
            <listitem><para>Configuration:</para>
                <itemizedlist>
                    <listitem><para><code>setOptions(array $options)</code></para></listitem>
                    <listitem><para><code>setConfig(Zend_Config $config)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>I18N:</para>
                <itemizedlist>
                    <listitem><para><code>setTranslator(Zend_Translate_Adapter $translator = null)</code></para></listitem>
                    <listitem><para><code>getTranslator()</code></para></listitem>
                    <listitem><para><code>setDisableTranslator($flag)</code></para></listitem>
                    <listitem><para><code>translatorIsDisabled()</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Properties:</para>
                <itemizedlist>
                    <listitem><para><code>setName($name)</code></para></listitem>
                    <listitem><para><code>getName()</code></para></listitem>
                    <listitem><para><code>setValue($value)</code></para></listitem>
                    <listitem><para><code>getValue()</code></para></listitem>
                    <listitem><para><code>getUnfilteredValue()</code></para></listitem>
                    <listitem><para><code>setLabel($label)</code></para></listitem>
                    <listitem><para><code>getLabel()</code></para></listitem>
                    <listitem><para><code>setDescription($description)</code></para></listitem>
                    <listitem><para><code>getDescription()</code></para></listitem>
                    <listitem><para><code>setOrder($order)</code></para></listitem>
                    <listitem><para><code>getOrder()</code></para></listitem>
                    <listitem><para><code>setRequired($flag)</code></para></listitem>
                    <listitem><para><code>getRequired()</code></para></listitem>
                    <listitem><para><code>setAllowEmpty($flag)</code></para></listitem>
                    <listitem><para><code>getAllowEmpty()</code></para></listitem>
                    <listitem><para><code>setAutoInsertNotEmptyValidator($flag)</code></para></listitem>
                    <listitem><para><code>autoInsertNotEmptyValidator()</code></para></listitem>
                    <listitem><para><code>setIgnore($flag)</code></para></listitem>
                    <listitem><para><code>getIgnore()</code></para></listitem>
                    <listitem><para><code>getType()</code></para></listitem>
                    <listitem><para><code>setAttrib($name, $value)</code></para></listitem>
                    <listitem><para><code>setAttribs(array $attribs)</code></para></listitem>
                    <listitem><para><code>getAttrib($name)</code></para></listitem>
                    <listitem><para><code>getAttribs()</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Plugin loaders and paths:</para>
                <itemizedlist>
                    <listitem><para><code>setPluginLoader(Zend_Loader_PluginLoader_Interface $loader, $type)</code></para></listitem>
                    <listitem><para><code>getPluginLoader($type)</code></para></listitem>
                    <listitem><para><code>addPrefixPath($prefix, $path, $type = null)</code></para></listitem>
                    <listitem><para><code>addPrefixPaths(array $spec)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Validation:</para>
                <itemizedlist>
                    <listitem><para><code>addValidator($validator, $breakChainOnFailure = false, $options = array())</code></para></listitem>
                    <listitem><para><code>addValidators(array $validators)</code></para></listitem>
                    <listitem><para><code>setValidators(array $validators)</code></para></listitem>
                    <listitem><para><code>getValidator($name)</code></para></listitem>
                    <listitem><para><code>getValidators()</code></para></listitem>
                    <listitem><para><code>removeValidator($name)</code></para></listitem>
                    <listitem><para><code>clearValidators()</code></para></listitem>
                    <listitem><para><code>isValid($value, $context = null)</code></para></listitem>
                    <listitem><para><code>getErrors()</code></para></listitem>
                    <listitem><para><code>getMessages()</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Filters:</para>
                <itemizedlist>
                    <listitem><para><code>addFilter($filter, $options = array())</code></para></listitem>
                    <listitem><para><code>addFilters(array $filters)</code></para></listitem>
                    <listitem><para><code>setFilters(array $filters)</code></para></listitem>
                    <listitem><para><code>getFilter($name)</code></para></listitem>
                    <listitem><para><code>getFilters()</code></para></listitem>
                    <listitem><para><code>removeFilter($name)</code></para></listitem>
                    <listitem><para><code>clearFilters()</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Rendering:</para>
                <itemizedlist>
                    <listitem><para><code>setView(Zend_View_Interface $view = null)</code></para></listitem>
                    <listitem><para><code>getView()</code></para></listitem>
                    <listitem><para><code>addDecorator($decorator, $options = null)</code></para></listitem>
                    <listitem><para><code>addDecorators(array $decorators)</code></para></listitem>
                    <listitem><para><code>setDecorators(array $decorators)</code></para></listitem>
                    <listitem><para><code>getDecorator($name)</code></para></listitem>
                    <listitem><para><code>getDecorators()</code></para></listitem>
                    <listitem><para><code>removeDecorator($name)</code></para></listitem>
                    <listitem><para><code>clearDecorators()</code></para></listitem>
                    <listitem><para><code>render(Zend_View_Interface $view = null)</code></para></listitem>
                </itemizedlist>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.elements.config">
        <title>Configuration</title>

        <para>
            <code>Zend_Form_Element</code>'s constructor accepts either an
            array of options or a <code>Zend_Config</code> object containing
            options, and it can also be configured using either
            <code>setOptions()</code> or <code>setConfig()</code>. Generally
            speaking, keys are named as follows:
        </para>

        <itemizedlist>
            <listitem><para>
                If 'set' + key refers to a <code>Zend_Form_Element</code>
                method, then the value provided will be passed to that method.
            </para></listitem>

            <listitem><para>
                Otherwise, the value will be used to set an attribute.
            </para></listitem>
        </itemizedlist>

        <para>
            Exceptions to the rule include the following:
        </para>

        <itemizedlist>
            <listitem><para>
                <code>prefixPath</code> will be passed to
                <code>addPrefixPaths()</code>
            </para></listitem>

            <listitem>
                <para>
                    The following setters cannot be set in this way:
                </para>

                <itemizedlist>
                    <listitem><para>
                            <code>setAttrib</code> (though
                            <code>setAttribs</code> <emphasis>will</emphasis>
                            work)
                    </para></listitem>

                    <listitem><para><code>setConfig</code></para></listitem>

                    <listitem><para><code>setOptions</code></para></listitem>

                    <listitem><para><code>setPluginLoader</code></para></listitem>

                    <listitem><para><code>setTranslator</code></para></listitem>

                    <listitem><para><code>setView</code></para></listitem>
                </itemizedlist>
            </listitem>
        </itemizedlist>

        <para>
            As an example, here is a config file that passes configuration for
            every type of configurable data:
        </para>

        <programlisting role="ini"><![CDATA[
[element]
name = "foo"
value = "foobar"
label = "Foo:"
order = 10
required = true
allowEmpty = false
autoInsertNotEmptyValidator = true
description = "Foo elements are for examples"
ignore = false
attribs.id = "foo"
attribs.class = "element"
onclick = "autoComplete(this, '/form/autocomplete/element')" ; sets 'onclick' attribute
prefixPaths.decorator.prefix = "My_Decorator"
prefixPaths.decorator.path = "My/Decorator/"
disableTranslator = 0
validators.required.validator = "NotEmpty"
validators.required.breakChainOnFailure = true
validators.alpha.validator = "alpha"
validators.regex.validator = "regex"
validators.regex.options.pattern = "/^[A-F].*/$"
filters.ucase.filter = "StringToUpper"
decorators.element.decorator = "ViewHelper"
decorators.element.options.helper = "FormText"
decorators.label.decorator = "Label"
]]></programlisting>
    </sect2>

    <sect2 id="zend.form.elements.custom">
        <title>Custom Elements</title>

        <para>
            You can create your own custom elements by simply extending the
            <code>Zend_Form_Element</code> class. Common reasons to do so
            include:
        </para>

        <itemizedlist>
            <listitem><para>
                Elements that share common validators and/or filters
            </para></listitem>

            <listitem><para>
                Elements that have custom decorator functionality
            </para></listitem>
        </itemizedlist>

        <para>
            There are two methods typically used to extend an element:
            <code>init()</code>, which can be used to add custom initialization
            logic to your element, and <code>loadDefaultDecorators()</code>,
            which can be used to set a list of default decorators used by your
            element.
        </para>

        <para>
            As an example, let's say that all text elements in a form you are
            creating need to be filtered with <code>StringTrim</code>,
            validated with a common regular expression, and that you want to
            use a custom decorator you've created for displaying them,
            'My_Decorator_TextItem'; additionally, you have a number of standard
            attributes, including 'size', 'maxLength', and 'class' you wish to
            specify. You could define such an element as follows:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_Element_Text extends Zend_Form_Element
{
    public function init()
    {
        $this->addPrefixPath('My_Decorator', 'My/Decorator/', 'decorator')
             ->addFilters('StringTrim')
             ->addValidator('Regex', false, array('/^[a-z0-9]{6,}$/i'))
             ->addDecorator('TextItem')
             ->setAttrib('size', 30)
             ->setAttrib('maxLength', 45)
             ->setAttrib('class', 'text');
    }
}
?>]]></programlisting>

        <para>
            You could then inform your form object about the prefix path for
            such elements, and start creating elements:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->addPrefixPath('My_Element', 'My/Element/', 'element')
     ->addElement('foo', 'text');
?>]]></programlisting>

        <para>
            The 'foo' element will now be of type <code>My_Element_Text</code>,
            and exhibit the behaviour you've outlined.
        </para>

        <para>
            Another method you may want to override when extending
            <code>Zend_Form_Element</code> is the
            <code>loadDefaultDecorators()</code> method. This method
            conditionally loads a set of default decorators for your element;
            you may wish to substitute your own decorators in your extending
            class:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_Element_Text extends Zend_Form_Element
{
    public function loadDefaultDecorators()
    {
        $this->addDecorator('ViewHelper')
             ->addDecorator('DisplayError')
             ->addDecorator('Label')
             ->addDecorator('HtmlTag', array('tag' => 'div', 'class' => 'element'));
    }
}
?>]]></programlisting>

        <para>
            There are many ways to customize elements; be sure to read the API
            documentation of <code>Zend_Form_Element</code> to know all the
            methods available.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 tw=80 et:
-->
<sect1 id="zend.form.forms">
    <title>Creating Forms Using Zend_Form</title>

    <para>
        The <code>Zend_Form</code> class is used to aggregate form elements,
        display groups, and subforms. It can then perform the following actions
        on those items:
    </para>

    <itemizedlist>
        <listitem><para>
            Validation, including retrieving error codes and messages
        </para></listitem>

        <listitem><para>
            Value aggregation, including populating items and retrieving both
            filtered and unfiltered values from all items
        </para></listitem>

        <listitem><para>
            Iteration over all items, in the order in which they are entered or
            based on the order hints retrieved from each item
        </para></listitem>

        <listitem><para>
            Rendering of the entire form, either via a single decorator that
            peforms custom rendering or by iterating over each item in the form
        </para></listitem>
    </itemizedlist>

    <para>
        While forms created with <code>Zend_Form</code> may be complex, probably
        the best use case is for simple forms; it's best use is for Rapid
        Application Development and prototyping.
    </para>

    <para>
        At its most basic, you simply instantiate a form object:
    </para>

    <programlisting role="php"><![CDATA[<?php
// Generic form object:
$form = new Zend_Form();

// Custom form object:
$form = new My_Form()
?>]]></programlisting>

    <para>
        You can optionally pass in configuration, which will be used to set
        object state, as well as to potentially create new elements:
    </para>

    <programlisting role="php"><![CDATA[<?php
// Passing in configuration options:
$form = new Zend_Form($config);
?>]]></programlisting>

    <para>
        <code>Zend_Form</code> is iterable, and will iterate over elements,
        display groups, and subforms, using the order they were registered and
        any order index each may have. This is useful in cases where you wish to
        render the elements manually in the appropriate order.
    </para>

    <para>
        <code>Zend_Form</code>'s magic lies in its ability to serve as a factory
        for elements and display groups, as well as the ability to render itself
        through decorators.
    </para>

    <sect2 id="zend.form.forms.plugins">
        <title>Plugin Loaders</title>
        <para>
            <code>Zend_Form</code> makes use of
            <code>Zend_Loader_PluginLoader</code> to allow developers to specify
            locations of alternate elements and decorators. Each has its own
            plugin loader associated with it, and general accessors are used to
            retrieve and modify each.
        </para>

        <para>
            The following loader types are used with the various plugin loader
            methods: 'element' and 'decorator'. The type names are case
            insensitive.
        </para>

        <para>
            The methods used to interact with plugin loaders are as follows:
        </para>

        <itemizedlist>
            <listitem><para>
                <code>setPluginLoader($loader, $type)</code>: $loader is the
                plugin loader object itself, while type is one of the types
                specified above.  This sets the plugin loader for the given type
                to the newly specified loader object.
            </para></listitem>

            <listitem><para>
                <code>getPluginLoader($type)</code>: retrieves the plugin loader
                associated with $type.
            </para></listitem>

            <listitem><para>
                <code>addPrefixPath($prefix, $path, $type = null)</code>: adds a
                prefix/path association to the loader specified by $type. If
                $type is null, it will attempt to add the path to all loaders,
                by appending the prefix with each of "_Element" and
                "_Decorator"; and appending the path with "Element/" and
                "Decorator/". If you have all your extra form element classes
                under a common hierarchy, this is a convenience method for
                setting the base prefix for them.
            </para></listitem>

            <listitem><para>
                <code>addPrefixPaths(array $spec)</code>: allows you to add many
                paths at once to one or more plugin loaders. It expects each
                array item to be an array with the keys 'path', 'prefix', and
                'type'.
            </para></listitem>
        </itemizedlist>

        <para>
            Additionally, you can specify prefix paths for all elements and
            display groups created through a <code>Zend_Form</code> instance
            using the following methods:
        </para>

        <itemizedlist>
            <listitem><para>
                <code>addElementPrefixPath($prefix, $path, $type = null)</code>:
                Just like <code>addPrefixPath()</code>, you must specify a class
                prefix and a path. <code>$type</code>, when speified, must be
                one of the plugin loader types specified by
                <code>Zend_Form_Element</code>; see the <link
                    linkend="zend.form.elements.loaders">element plugins
                    section</link> for more information on valid
                <code>$type</code> values. If no <code>$type</code> is
                specified, the method will assume it is a general prefix for all
                types.
            </para></listitem>

            <listitem><para>
                <code>addDisplayGroupPrefixPath($prefix, $path)</code>:
                Just like <code>addPrefixPath()</code>, you must specify a class
                prefix and a path; however, since display groups only support
                decorators as plugins, no <code>$type</code> is necessary.
            </para></listitem>
        </itemizedlist>

        <para>
            Custom elements and decorators are an easy way to share
            functionality between forms and encapsulate custom functionality.
            See the <link
                linkend="zend.form.elements.loaders.customLabel">Custom Label
                example</link> in the elements documentation for an example of
            how custom elements can be used as replacements for standard
            classes.
        </para>
    </sect2>

    <sect2 id="zend.form.forms.elements">
        <title>Elements</title>
        <para>
            <code>Zend_Form</code> provides several accessors for adding and
            removing elements from the form. These can take element object
            instances or serve as factories for instantiating the element
            objects themselves.
        </para>

        <para>
            The most basic method for adding an element is
            <code>addElement()</code>.  This method can take either an object of
            type <code>Zend_Form_Element</code> (or of a class extending
            <code>Zend_Form_Element</code>), or arguments for building a new
            element -- including the element type, name, and any configuration
            options.
        </para>

        <para>
            As some examples:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Using an element instance:
$element = new Zend_Form_Element_Text('foo');
$form->addElement($element);

// Using a factory
// 
// Creates an element of type Zend_Form_Element_Text with the
// name of 'foo':
$form->addElement('text', 'foo');

// Pass label option to the element:
$form->addElement('text', 'foo', array('label' => 'Foo:'));
?>]]></programlisting>

        <note>
            <title>addElement() Implements Fluent Interface</title>

            <para>
                <code>addElement()</code> implements a fluent interface; that is
                to say, it returns the <code>Zend_Form</code> object, and not
                the element. This is done to allow you to chain together
                multiple addElement() methods or other form methods that
                implement the fluent interface (all setters in Zend_Form
                implement the pattern).
            </para>

            <para>
                If you wish to return the element instead, use
                <code>createElement()</code>, which is outlined below. Be aware,
                however, that <code>createElement()</code> does not attach the
                element to the form.
            </para>

            <para>
                Internally, <code>addElement()</code> actually uses
                <code>createElement()</code> to create the element before
                attaching it to the form.
            </para>
        </note>

        <para>
            Once an element has been added to the form, you can retrieve it by
            name. This can be done either by using the <code>getElement()</code>
            method or by using overloading to access the element as an object
            property:
        </para>

        <programlisting role="php"><![CDATA[<?php
// getElement():
$foo = $form->getElement('foo');

// As object property:
$foo = $form->foo;
?>]]></programlisting>

        <para>
            Occasionally, you may want to create an element without attaching it
            to the form (for instance, if you wish to make use of the various
            plugin paths registered with the form, but wish to later attach the
            object to a sub form). The <code>createElement()</code> method
            allows you to do so:
        </para>

        <programlisting role="php"><![CDATA[<?php
// $username becomes a Zend_Form_Element_Text object:
$username = $form->createElement('text', 'username');
?>]]></programlisting>

        <sect3 id="zend.form.forms.elements.values">
            <title>Populating and Retrieving Values</title>

            <para>
                After validating a form, you will typically need to retrieve the
                values so you can perform other operations, such as updating a
                database or notifying a web service. You can retrieve all values
                for all elements using <code>getValues()</code>;
                <code>getValue($name)</code> allows you to retrieve a single
                element's value by element name:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Get all values:
$values = $form->getValues();

// Get only 'foo' element's value:
$value = $form->getValue('foo');
?>]]></programlisting>

            <para>
                Sometimes you'll want to populate the form with specified values
                prior to rendering. This can be done with either the
                <code>setDefaults()</code> or <code>populate()</code>
                methods:
            </para>

            <programlisting role="php"><![CDATA[<?php
$form->setDefaults($data);
$form->populate($data);
?>]]></programlisting>
        </sect3>

        <sect3 id="zend.form.forms.elements.global">
            <title>Global Operations</title>

            <para>
                Occasionally you will want certain operations to affect all
                elements. Common scenarios include needing to set plugin prefix
                paths for all elements, setting decorators for all elements, and
                setting filters for all elements. As examples:
            </para>

            <example id="zend.form.forms.elements.global.allpaths">
                <title>Setting Prefix Paths for All Elements</title>

                <para>
                    You can set prefix paths for all elements by type, or using
                    a global prefix. As some examples:
                </para>

                <programlisting role="php"><![CDATA[<?php
// Set global prefix path:
// Creates paths for prefixes My_Foo_Filter, My_Foo_Validate,
// and My_Foo_Decorator
$form->addElementPrefixPath('My_Foo', 'My/Foo/');

// Just filter paths:
$form->addElementPrefixPath('My_Foo_Filter', 'My/Foo/Filter', 'filter');

// Just validator paths:
$form->addElementPrefixPath('My_Foo_Validate', 'My/Foo/Validate', 'validate');

// Just decorator paths:
$form->addElementPrefixPath('My_Foo_Decorator', 'My/Foo/Decorator', 'decorator');
?>]]></programlisting>
            </example>

            <example id="zend.form.forms.elements.global.decorators">
                <title>Setting Decorators for All Elements</title>

                <para>
                    You can set decorators for all elements.
                    <code>setElementDecorators()</code> accepts an array of
                    decorators, just like <code>setDecorators()</code>, and will
                    overwrite any previously set decorators in each element. In
                    this example, we set the decorators to simply a ViewHelper
                    and a Label:
                </para>

                <programlisting role="php"><![CDATA[<?php
$form->setElementDecorators(array(
    'ViewHelper',
    'Label'
));
?>]]></programlisting>
            </example>

                <note>
                    <title>Some Decorators are Inappropriate for Some Elements</title>

                    <para>
                        While <code>setElementDecorators()</code> may seem like
                        a good solution, there are some cases where it may
                        actually end up with unexpected results. For example,
                        the various button elements (Submit, Button, Reset)
                        currently use the label as the value of the button,
                        and only use ViewHelper and DtDdWrapper decorators --
                        preventing an additional label, errors, and hint from
                        being rendered; the example above would duplicate some
                        content (the label).
                    </para>

                    <para>
                        So, use this method wisely, and realize that you may
                        need to manually change some elements' decorators to
                        prevent unwanted output.
                    </para>
                </note>

            <example id="zend.form.forms.elements.global.filters">
                <title>Setting Filters for All Elements</title>

                <para>
                    In many cases, you may want to apply the same filter to all
                    elements; a common case is to <code>trim()</code> all values:
                </para>

        <programlisting role="php"><![CDATA[<?php
$form->setElementFilters(array('StringTrim'));
?>]]></programlisting>
            </example>
        </sect3>

        <sect3 id="zend.form.forms.elements.methods">
            <title>Methods For Interacting With Elements</title>

            <para>
                The following methods may be used to interact with elements:
            </para>

            <itemizedlist>
                <listitem><para>
                    <code>createElement($element, $name = null, $options = null)</code>
                </para></listitem>

                <listitem><para>
                    <code>addElement($element, $name = null, $options = null)</code>
                </para></listitem>

                <listitem><para>
                    <code>addElements(array $elements)</code>
                </para></listitem>

                <listitem><para>
                    <code>setElements(array $elements)</code>
                </para></listitem>

                <listitem><para>
                    <code>getElement($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>getElements()</code>
                </para></listitem>

                <listitem><para>
                    <code>removeElement($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>clearElements()</code>
                </para></listitem>

                <listitem><para>
                    <code>setDefaults(array $defaults)</code>
                </para></listitem>

                <listitem><para>
                    <code>setDefault($name, $value)</code>
                </para></listitem>

                <listitem><para>
                    <code>getValue($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>getValues()</code>
                </para></listitem>

                <listitem><para>
                    <code>getUnfilteredValue($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>getUnfilteredValues()</code>
                </para></listitem>

                <listitem><para>
                    <code>setElementFilters(array $filters)</code>
                </para></listitem>

                <listitem><para>
                    <code>setElementDecorators(array $decorators)</code>
                </para></listitem>

                <listitem><para>
                    <code>addElementPrefixPath($prefix, $path, $type = null)</code>
                </para></listitem>

                <listitem><para>
                    <code>addElementPrefixPaths(array $spec)</code>
                </para></listitem>
            </itemizedlist>
        </sect3>
    </sect2>

    <sect2 id="zend.form.forms.displaygroups">
        <title>Display Groups</title>

        <para>
            Display groups are a way to create virtual groupings of elements for
            display purposes. All elements remain accessible by name in the
            form, but when iterating over the form or rendering, any elements in
            a display group are rendered together. The most common use case for
            this is for grouping elements in fieldsets.
        </para>

        <para>
            The base class for display groups is
            <code>Zend_Form_DisplayGroup</code>.  While it can be instantiated
            directly, it is typically best to use <code>Zend_Form</code>'s
            <code>addDisplayGroup()</code> method to do so. This method takes an
            array of elements as its first argument, and a name for the display
            group as its second argument. You may optionally pass in an array of
            options or a <code>Zend_Config</code> object as the third argument.
        </para>

        <para>
            Assuming that the elements 'username' and 'password' are already set
            in the form, the following code would group these elements in a
            'login' display group:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->addDisplayGroup(array('username', 'password'), 'login');
?>]]></programlisting>

        <para>
            You can access display groups using the
            <code>getDisplayGroup()</code> method, or via overloading using the
            display group's name:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Using getDisplayGroup():
$login = $form->getDisplayGroup('login');

// Using overloading:
$login = $form->login;
?>]]></programlisting>

        <note>
            <title>Default Decorators Do Not Need to Be Loaded</title>

            <para>
                By default, the default decorators are loaded during object
                initialization. You can disable this by passing the
                'disableLoadDefaultDecorators' option when creating a display
                group:
            </para>

            <programlisting role="php"><![CDATA[<?php
$form->addDisplayGroup(
    array('foo', 'bar'), 
    'foobar', 
    array('disableLoadDefaultDecorators' => true)
);
]]></programlisting>
            
            <para>
                This option may be mixed with any other options you pass,
                both as array options or in a <code>Zend_Config</code> object.
            </para>
        </note>

        <sect3 id="zend.form.forms.displaygroups.global">
            <title>Global Operations</title>

            <para>
                Just as with elements, there are some operations which might
                affect all display groups; these include setting decorators and
                setting the plugin path in which to look for decorators.
            </para>

            <example id="zend.form.forms.displaygroups.global.paths">
                <title>Setting Decorator Prefix Path for All Display Groups</title>

                <para>
                    By default, display groups inherit whichever decorator paths
                    the form uses; however, if they should look in alternate
                    locations, you can use the
                    <code>addDisplayGroupPrefixPath()</code> method.
                </para>

                <programlisting role="php"><![CDATA[<?php
$form->addDisplayGroupPrefixPath('My_Foo_Decorator', 'My/Foo/Decorator');
?>]]></programlisting>
            </example>

            <example id="zend.form.forms.displaygroups.global.decorators">
                <title>Setting Decorators for All Display Groups</title>

                <para>
                    You can set decorators for all display groups.
                    <code>setDisplayGroupDecorators()</code> accepts an array of
                    decorators, just like <code>setDecorators()</code>, and will
                    overwrite any previously set decorators in each display
                    group. In this example, we set the decorators to simply a
                    fieldset (the FormElements decorator is necessary to ensure
                    that the elements are iterated):
                </para>

                <programlisting role="php"><![CDATA[<?php
$form->setDisplayGroupDecorators(array(
    'FormElements',
    'Fieldset'
));
?>]]></programlisting>
            </example>
        </sect3>

        <sect3 id="zend.form.forms.displaygroups.customClasses">
            <title>Using Custom Display Group Classes</title>

            <para>
                By default, <code>Zend_Form</code> uses the
                <code>Zend_Form_DisplayGroup</code> class for display groups.
                You may find you need to extend this class in order to provided
                custom functionality. <code>addDisplayGroup()</code> does not
                allow passing in a concrete instance, but does allow specifying
                the class to use as one of its options, using the
                'displayGroupClass' key:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Use the 'My_DisplayGroup' class
$form->addDisplayGroup(
    array('username', 'password'), 
    'user',
    array('displayGroupClass' => 'My_DisplayGroup')
);
?>]]></programlisting>

            <para>
                If the class has not yet been loaded, <code>Zend_Form</code>
                will attempt to do so using <code>Zend_Loader</code>.
            </para>

            <para>
                You can also specify a default display group class to use with
                the form such that all display groups created with the form
                object will use that class:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Use the 'My_DisplayGroup' class for all display groups:
$form->setDefaultDisplayGroupClass('My_DisplayGroup');
?>]]></programlisting>

            <para>
                This setting may be specified in configurations as
                'defaultDisplayGroupClass', and will be loaded early to ensure
                all display groups use that class.
            </para>
        </sect3>

        <sect3 id="zend.form.forms.displaygroups.interactionmethods">
            <title>Methods for Interacting With Display Groups</title>

            <para>
                The following methods may be used to interact with display
                groups:
            </para>

            <itemizedlist>
                <listitem><para>
                    <code>addDisplayGroup(array $elements, $name, $options = null)</code>
                </para></listitem>

                <listitem><para>
                    <code>addDisplayGroups(array $groups)</code>
                </para></listitem>

                <listitem><para>
                    <code>setDisplayGroups(array $groups)</code>
                </para></listitem>

                <listitem><para>
                    <code>getDisplayGroup($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>getDisplayGroups()</code>
                </para></listitem>

                <listitem><para>
                    <code>removeDisplayGroup($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>clearDisplayGroups()</code>
                </para></listitem>

                <listitem><para>
                    <code>setDisplayGroupDecorators(array $decorators)</code>
                </para></listitem>

                <listitem><para>
                    <code>addDisplayGroupPrefixPath($prefix, $path)</code>
                </para></listitem>

                <listitem><para>
                    <code>setDefaultDisplayGroupClass($class)</code>
                </para></listitem>

                <listitem><para>
                    <code>getDefaultDisplayGroupClass($class)</code>
                </para></listitem>
            </itemizedlist>
        </sect3>

        <sect3 id="zend.form.forms.displaygroups.methods">
            <title>Zend_Form_DisplayGroup Methods</title>

            <para>
                <code>Zend_Form_DisplayGroup</code> has the following methods,
                grouped by type:
            </para>

            <itemizedlist>
                <listitem><para>Configuration:</para>
                    <itemizedlist>
                        <listitem><para><code>setOptions(array $options)</code></para></listitem>

                        <listitem><para><code>setConfig(Zend_Config $config)</code></para></listitem>
                    </itemizedlist>
                </listitem>

                <listitem><para>Metadata:</para>
                    <itemizedlist>
                        <listitem><para><code>setAttrib($key, $value)</code></para></listitem>

                        <listitem><para><code>addAttribs(array $attribs)</code></para></listitem>

                        <listitem><para><code>setAttribs(array $attribs)</code></para></listitem>

                        <listitem><para><code>getAttrib($key)</code></para></listitem>

                        <listitem><para><code>getAttribs()</code></para></listitem>

                        <listitem><para><code>removeAttrib($key)</code></para></listitem>

                        <listitem><para><code>clearAttribs()</code></para></listitem>

                        <listitem><para><code>setName($name)</code></para></listitem>

                        <listitem><para><code>getName()</code></para></listitem>

                        <listitem><para><code>setDescription($value)</code></para></listitem>

                        <listitem><para><code>getDescription()</code></para></listitem>

                        <listitem><para><code>setLegend($legend)</code></para></listitem>

                        <listitem><para><code>getLegend()</code></para></listitem>

                        <listitem><para><code>setOrder($order)</code></para></listitem>

                        <listitem><para><code>getOrder()</code></para></listitem>
                    </itemizedlist>
                </listitem>

                <listitem><para>Elements:</para>
                    <itemizedlist>
                        <listitem><para><code>createElement($type, $name, array $options = array())</code></para></listitem>

                        <listitem><para><code>addElement($typeOrElement, $name, array $options = array())</code></para></listitem>

                        <listitem><para><code>addElements(array $elements)</code></para></listitem>

                        <listitem><para><code>setElements(array $elements)</code></para></listitem>

                        <listitem><para><code>getElement($name)</code></para></listitem>

                        <listitem><para><code>getElements()</code></para></listitem>

                        <listitem><para><code>removeElement($name)</code></para></listitem>

                        <listitem><para><code>clearElements()</code></para></listitem>
                    </itemizedlist>
                </listitem>

                <listitem><para>Plugin loaders:</para>
                    <itemizedlist>
                        <listitem><para><code>setPluginLoader(Zend_Loader_PluginLoader $loader)</code></para></listitem>

                        <listitem><para><code>getPluginLoader()</code></para></listitem>

                        <listitem><para><code>addPrefixPath($prefix, $path)</code></para></listitem>

                        <listitem><para><code>addPrefixPaths(array $spec)</code></para></listitem>
                    </itemizedlist>
                </listitem>

                <listitem><para>Decorators:</para>
                    <itemizedlist>
                        <listitem><para><code>addDecorator($decorator, $options = null)</code></para></listitem>

                        <listitem><para><code>addDecorators(array $decorators)</code></para></listitem>

                        <listitem><para><code>setDecorators(array $decorators)</code></para></listitem>

                        <listitem><para><code>getDecorator($name)</code></para></listitem>

                        <listitem><para><code>getDecorators()</code></para></listitem>

                        <listitem><para><code>removeDecorator($name)</code></para></listitem>

                        <listitem><para><code>clearDecorators()</code></para></listitem>
                    </itemizedlist>
                </listitem>

                <listitem><para>Rendering:</para>
                    <itemizedlist>
                        <listitem><para><code>setView(Zend_View_Interface $view = null)</code></para></listitem>

                        <listitem><para><code>getView()</code></para></listitem>

                        <listitem><para><code>render(Zend_View_Interface $view = null)</code></para></listitem>
                    </itemizedlist>
                </listitem>

                <listitem><para>I18N:</para>
                    <itemizedlist>
                        <listitem><para><code>setTranslator(Zend_Translate_Adapter $translator = null)</code></para></listitem>

                        <listitem><para><code>getTranslator()</code></para></listitem>

                        <listitem><para><code>setDisableTranslator($flag)</code></para></listitem>

                        <listitem><para><code>translatorIsDisabled()</code></para></listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>
        </sect3>
    </sect2>

    <sect2 id="zend.form.forms.subforms">
        <title>Sub Forms</title>

        <para>
            Sub forms serve several purposes:
        </para>

        <itemizedlist>
            <listitem><para>
                Creating logical element groups. Since sub forms are simply
                forms, you can validate subforms as individual entities.
            </para></listitem>

            <listitem><para>
                Creating multi-page forms. Since sub forms are simply forms, you
                can display a separate sub form per page, building up multi-page
                forms where each form has its own validation logic.  Only once
                all sub forms validate would the form be considered complete.
            </para></listitem>

            <listitem><para>
                Display groupings. Like display groups, sub forms, when rendered
                as part of a larger form, can be used to group elements. Be
                aware, however, that the master form object will have no
                awareness of the elements in sub forms.
            </para></listitem>
        </itemizedlist>

        <para>
            A sub form may be a <code>Zend_Form</code> object, or, more
            typically, a <code>Zend_Form_SubForm</code> object. The latter
            contains decorators suitable for inclusion in a larger form (i.e.,
            it does not render additional HTML form tags, but does group
            elements). To attach a sub form, simply add it to the form and give
            it a name:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->addSubForm($subForm, 'subform');
?>]]></programlisting>

        <para>
            You can retrieve a sub form using either
            <code>getSubForm($name)</code> or overloading using the sub form
            name:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Using getSubForm():
$subForm = $form->getSubForm('subform');

// Using overloading:
$subForm = $form->subform;
?>]]></programlisting>

        <para>
            Sub forms are included in form iteration, though the elements it
            contains are not.
        </para>

        <sect3 id="zend.form.forms.subforms.global">
            <title>Global Operations</title>

            <para>
                Like elements and display groups, there are some operations that
                might need to affect all sub forms. Unlike display groups and
                elements, however, sub forms inherit most functionality from the
                master form object, and the only real operation that may need to
                be performed globally is setting decorators for sub forms. For
                this purpose, there is the <code>setSubFormDecorators()</code>
                method. In the next example, we'll set the decorator for all
                subforms to be simply a fieldset (the FormElements decorator is
                needed to ensure its elements are iterated):
            </para>

            <programlisting role="php"><![CDATA[<?php
$form->setSubFormDecorators(array(
    'FormElements',
    'Fieldset'
));
?>]]></programlisting>
        </sect3>

        <sect3 id="zend.form.forms.subforms.methods">
            <title>Methods for Interacting With Sub Forms</title>

            <para>
                The following methods may be used to interact with sub forms:
            </para>

            <itemizedlist>
                <listitem><para>
                    <code>addSubForm(Zend_Form $form, $name, $order = null)</code>
                </para></listitem>

                <listitem><para>
                    <code>addSubForms(array $subForms)</code>
                </para></listitem>

                <listitem><para>
                    <code>setSubForms(array $subForms)</code>
                </para></listitem>

                <listitem><para>
                    <code>getSubForm($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>getSubForms()</code>
                </para></listitem>

                <listitem><para>
                    <code>removeSubForm($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>clearSubForms()</code>
                </para></listitem>

                <listitem><para>
                    <code>setSubFormDecorators(array $decorators)</code>
                </para></listitem>
            </itemizedlist>
        </sect3>
    </sect2>

    <sect2 id="zend.form.forms.metadata">
        <title>Metadata and Attributes</title>

        <para>
            While a form's usefulness primarily derives from the elements it
            contains, it can also contain other metadata, such as a name (often
            used as a unique ID in the HTML markup); the form action and method;
            the number of elements, groups, and sub forms it contains; and
            arbitrary metadata (usually used to set HTML attributes for the form
            tag itself).
        </para>

        <para>
            You can set and retrieve a form's name using the name accessors:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Set the name:
$form->setName('registration');

// Retrieve the name:
$name = $form->getName();
?>]]></programlisting>

        <para>
            To set the action (url to which the form submits) and method (method
            by which it should submit, e.g., 'POST' or 'GET'), use the action
            and method accessors:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Set the action and method:
$form->setAction('/user/login')
     ->setMethod('post');
?>]]></programlisting>

        <note>
            <para>
                The method and action are only used internally for rendering,
                and not for any sort of validation.
            </para>
        </note>

        <para>
            <code>Zend_Form</code> implements the <code>Countable</code>
            interface, allowing you to pass it as an argument to count:
        </para>

        <programlisting role="php"><![CDATA[<?php
$numItems = count($form);
?>]]></programlisting>

        <para>
            Setting arbitrary metadata is done through the attribs accessors.
            Since overloading in <code>Zend_Form</code> is used to access
            elements, display groups, and sub forms, this is the only method for
            accessing metadata.
        </para>

        <programlisting role="php"><![CDATA[<?php
// Setting attributes:
$form->setAttrib('class', 'zend-form')
     ->addAttribs(array(
         'id'       => 'registration',
         'onSubmit' => 'validate(this)',
     ));

// Retrieving attributes:
$class = $form->getAttrib('class');
$attribs = $form->getAttribs();

// Remove an attribute:
$form->removeAttrib('onSubmit');

// Clear all attributes:
$form->clearAttribs();
?>]]></programlisting>
    </sect2>

    <sect2 id="zend.form.forms.decorators">
        <title>Decorators</title>

        <para>
            Creating the markup for a form is often a time-consuming task,
            particularly if you plan on re-using the same markup to show things
            such as validation errors, submitted values, etc.
            <code>Zend_Form</code>'s answer to this issue is
            <emphasis>decorators</emphasis>.
        </para>

        <para>
            Decorators for <code>Zend_Form</code> objects can be used to render
            a form. The FormElements decorator will iterate through all items in
            a form -- elements, display groups, and sub forms -- and render
            them, returning the result. Additional decorators may then be used
            to wrap this content, or append or prepend it.
        </para>

        <para>
            The default decorators for <code>Zend_Form</code> are FormElements,
            HtmlTag (wraps in a definition list), and Form; the equivalent code
            for creating them is as follows:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->setDecorators(array(
    'FormElements',
    array('HtmlTag', array('tag' => 'dl')),
    'Form'
));
?>]]></programlisting>

        <para>
            This creates output like the following:
        </para>

        <programlisting role="html"><![CDATA[
<form action="/form/action" method="post">
<dl>
...
</dl>
</form>
]]></programlisting>

        <para>
            Any attributes set on the form object will be used as HTML
            attributes of the <code>&lt;form&gt;</code> tag.
        </para>

        <note>
            <title>Default Decorators Do Not Need to Be Loaded</title>

            <para>
                By default, the default decorators are loaded during object
                initialization. You can disable this by passing the
                'disableLoadDefaultDecorators' option to the constructor:
            </para>

            <programlisting role="php"><![CDATA[<?php
$form = new Zend_Form(array('disableLoadDefaultDecorators' => true));
]]></programlisting>
            
            <para>
                This option may be mixed with any other options you pass,
                both as array options or in a <code>Zend_Config</code> object.
            </para>
        </note>

        <note>
            <title>Using Multiple Decorators of the Same Type</title>

            <para>
                Internally, <code>Zend_Form</code> uses a decorator's
                class as the lookup mechanism when retrieving decorators. As a
                result, you cannot register multiple decorators of the same
                type; subsequent decorators will simply overwrite those that
                existed before.
            </para>

            <para>
                To get around this, you can use aliases. Instead of passing a
                decorator or decorator name as the first argument to
                <code>addDecorator()</code>, pass an array with a single
                element, with the alias pointing to the decorator object or
                name:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Alias to 'FooBar':
$form->addDecorator(array('FooBar' => 'HtmlTag'), array('tag' => 'div'));

// And retrieve later:
$form = $element->getDecorator('FooBar');
?>]]></programlisting>

            <para>
                In the <code>addDecorators()</code> and
                <code>setDecorators()</code> methods, you will need to pass
                the 'decorator' option in the array representing the decorator:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Add two 'HtmlTag' decorators, aliasing one to 'FooBar':
$form->addDecorators(
    array('HtmlTag', array('tag' => 'div')),
    array(
        'decorator' => array('FooBar' => 'HtmlTag'), 
        'options' => array('tag' => 'dd')
    ),
);

// And retrieve later:
$htmlTag = $form->getDecorator('HtmlTag');
$fooBar  = $form->getDecorator('FooBar');
?>]]></programlisting>
        </note>

        <para>
            You may create your own decorators for generating the form. One
            common use case is if you know the exact HTML you wish to use; your
            decorator could create the exact HTML and simply return it,
            potentially using the decorators from individual elements or display
            groups.
        </para>

        <para>
            The following methods may be used to interact with decorators:
        </para>

        <itemizedlist>
                <listitem><para>
                    <code>addDecorator($decorator, $options = null)</code>
                </para></listitem>

                <listitem><para>
                    <code>addDecorators(array $decorators)</code>
                </para></listitem>

                <listitem><para>
                    <code>setDecorators(array $decorators)</code>
                </para></listitem>

                <listitem><para>
                    <code>getDecorator($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>getDecorators()</code>
                </para></listitem>

                <listitem><para>
                    <code>removeDecorator($name)</code>
                </para></listitem>

                <listitem><para>
                    <code>clearDecorators()</code>
                </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.forms.validation">
        <title>Validation</title>

        <para>
            A primary use case for forms is validating submitted data.
            <code>Zend_Form</code> allows you to validate an entire form at once
            or a partial form, as well as to automate validation responses for
            XmlHttpRequests (AJAX).  If the submitted data is not valid, it has
            methods for retrieving the various error codes and messages for
            elements and sub forms failing validations.
        </para>

        <para>
            To validate a full form, use the <code>isValid()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
if (!$form->isValid($_POST)) {
    // failed validation
}
?>]]></programlisting>

        <para>
            <code>isValid()</code> will validate every required element, and any
            unrequired element contained in the submitted data.
        </para>

        <para>
            Sometimes you may need to validate only a subset of the data; for
            this, use <code>isValidPartial($data)</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
if (!$form->isValidPartial($data)) {
    // failed validation
}
?>]]></programlisting>

        <para>
            <code>isValidPartial()</code> only attempts to validate those items
            in the data for which there are matching elements; if an element is
            not represented in the data, it is skipped.
        </para>

        <para>
            When validating elements or groups of elements for an AJAX request,
            you will typically be validating a subset of the form, and want the
            response back in JSON. <code>processAjax()</code> does precisely
            that:
        </para>

        <programlisting role="php"><![CDATA[<?php
$json = $form->processAjax($data);
?>]]></programlisting>

        <para>
            You can then simply send the JSON response to the client. If the
            form is valid, this will be a boolean true response. If not, it will
            be a javascript object containing key/message pairs, where each
            'message' is an array of validation error messages.
        </para>

        <para>
            For forms that fail validation, you can retrieve both error codes
            and error messages, using <code>getErrors()</code> and
            <code>getMessages()</code>, respectively:
        </para>

        <programlisting role="php"><![CDATA[<?php
$codes = $form->getErrors();
$messages = $form->getMessage();
?>]]></programlisting>

        <note>
            <para>
                Since the messages returned by <code>getMessages()</code> are an
                array of error code/message pairs, <code>getErrors()</code> is
                typically not needed.
            </para>
        </note>

        <para>
            You can retrieve codes and error messages for individual elements by
            simply passing the element name to each:
        </para>

        <programlisting role="php"><![CDATA[<?php
$codes = $form->getErrors('username');
$messages = $form->getMessages('username');
?>]]></programlisting>

        <note>
            <para>
                Note: When validating elements, <code>Zend_Form</code> sends a
                second argument to each element's <code>isValid()</code> method:
                the array of data being validated. This can then be used by
                individual validators to allow them to utilize other submitted
                values when determining the validity of the data. An example
                would be a registration form that requires both a password and
                password confirmation; the password element could use the
                password confirmation as part of its validation. 
            </para>
        </note>
    </sect2>

    <sect2 id="zend.form.forms.methods">
        <title>Methods</title>

        <para>
            The following is a full list of methods available to
            <code>Zend_Form</code>, grouped by type:
        </para>

        <itemizedlist>
            <listitem><para>Configuration and Options:</para>
                <itemizedlist>
                    <listitem><para><code>setOptions(array $options)</code></para></listitem>

                    <listitem><para><code>setConfig(Zend_Config $config)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Plugin Loaders and paths:</para>
                <itemizedlist>
                    <listitem><para><code>setPluginLoader(Zend_Loader_PluginLoader_Interface $loader, $type = null)</code></para></listitem>

                    <listitem><para><code>getPluginLoader($type = null)</code></para></listitem>

                    <listitem><para><code>addPrefixPath($prefix, $path, $type = null) </code></para></listitem>

                    <listitem><para><code>addPrefixPaths(array $spec)</code></para></listitem>

                    <listitem><para><code>addElementPrefixPath($prefix, $path, $type = null)</code></para></listitem>

                    <listitem><para><code>addElementPrefixPaths(array $spec)</code></para></listitem>

                    <listitem><para><code>addDisplayGroupPrefixPath($prefix, $path)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Metadata:</para>
                <itemizedlist>
                    <listitem><para><code>setAttrib($key, $value)</code></para></listitem>

                    <listitem><para><code>addAttribs(array $attribs)</code></para></listitem>

                    <listitem><para><code>setAttribs(array $attribs)</code></para></listitem>

                    <listitem><para><code>getAttrib($key)</code></para></listitem>

                    <listitem><para><code>getAttribs()</code></para></listitem>

                    <listitem><para><code>removeAttrib($key)</code></para></listitem>

                    <listitem><para><code>clearAttribs()</code></para></listitem>

                    <listitem><para><code>setAction($action)</code></para></listitem>

                    <listitem><para><code>getAction()</code></para></listitem>

                    <listitem><para><code>setMethod($method)</code></para></listitem>

                    <listitem><para><code>getMethod()</code></para></listitem>

                    <listitem><para><code>setName($name)</code></para></listitem>

                    <listitem><para><code>getName()</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Elements:</para>
                <itemizedlist>
                    <listitem><para><code>addElement($element, $name = null, $options = null)</code></para></listitem>

                    <listitem><para><code>addElements(array $elements)</code></para></listitem>

                    <listitem><para><code>setElements(array $elements)</code></para></listitem>

                    <listitem><para><code>getElement($name)</code></para></listitem>

                    <listitem><para><code>getElements()</code></para></listitem>

                    <listitem><para><code>removeElement($name)</code></para></listitem>

                    <listitem><para><code>clearElements()</code></para></listitem>

                    <listitem><para><code>setDefaults(array $defaults)</code></para></listitem>

                    <listitem><para><code>setDefault($name, $value)</code></para></listitem>

                    <listitem><para><code>getValue($name)</code></para></listitem>

                    <listitem><para><code>getValues()</code></para></listitem>

                    <listitem><para><code>getUnfilteredValue($name)</code></para></listitem>

                    <listitem><para><code>getUnfilteredValues()</code></para></listitem>

                    <listitem><para><code>setElementFilters(array $filters)</code></para></listitem>

                    <listitem><para><code>setElementDecorators(array $decorators)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Sub forms:</para>
                <itemizedlist>
                    <listitem><para><code>addSubForm(Zend_Form $form, $name, $order = null)</code></para></listitem>

                    <listitem><para><code>addSubForms(array $subForms)</code></para></listitem>

                    <listitem><para><code>setSubForms(array $subForms)</code></para></listitem>

                    <listitem><para><code>getSubForm($name)</code></para></listitem>

                    <listitem><para><code>getSubForms()</code></para></listitem>

                    <listitem><para><code>removeSubForm($name)</code></para></listitem>

                    <listitem><para><code>clearSubForms()</code></para></listitem>

                    <listitem><para><code>setSubFormDecorators(array $decorators)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Display groups:</para>
                <itemizedlist>
                    <listitem><para><code>addDisplayGroup(array $elements, $name, $options = null)</code></para></listitem>

                    <listitem><para><code>addDisplayGroups(array $groups)</code></para></listitem>

                    <listitem><para><code>setDisplayGroups(array $groups)</code></para></listitem>

                    <listitem><para><code>getDisplayGroup($name)</code></para></listitem>

                    <listitem><para><code>getDisplayGroups()</code></para></listitem>

                    <listitem><para><code>removeDisplayGroup($name)</code></para></listitem>

                    <listitem><para><code>clearDisplayGroups()</code></para></listitem>

                    <listitem><para><code>setDisplayGroupDecorators(array $decorators)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Validation</para>
                <itemizedlist>
                    <listitem><para><code>populate(array $values)</code></para></listitem>

                    <listitem><para><code>isValid(array $data)</code></para></listitem>

                    <listitem><para><code>isValidPartial(array $data)</code></para></listitem>

                    <listitem><para><code>processAjax(array $data)</code></para></listitem>

                    <listitem><para><code>persistData()</code></para></listitem>

                    <listitem><para><code>getErrors($name = null)</code></para></listitem>

                    <listitem><para><code>getMessages($name = null)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>Rendering:</para>
                <itemizedlist>
                    <listitem><para><code>setView(Zend_View_Interface $view = null)</code></para></listitem>

                    <listitem><para><code>getView()</code></para></listitem>

                    <listitem><para><code>addDecorator($decorator, $options = null)</code></para></listitem>

                    <listitem><para><code>addDecorators(array $decorators)</code></para></listitem>

                    <listitem><para><code>setDecorators(array $decorators)</code></para></listitem>

                    <listitem><para><code>getDecorator($name)</code></para></listitem>

                    <listitem><para><code>getDecorators()</code></para></listitem>

                    <listitem><para><code>removeDecorator($name)</code></para></listitem>

                    <listitem><para><code>clearDecorators()</code></para></listitem>

                    <listitem><para><code>render(Zend_View_Interface $view = null)</code></para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>I18N:</para>
                <itemizedlist>
                    <listitem><para><code>setTranslator(Zend_Translate_Adapter $translator = null)</code></para></listitem>

                    <listitem><para><code>getTranslator()</code></para></listitem>

                    <listitem><para><code>setDisableTranslator($flag)</code></para></listitem>

                    <listitem><para><code>translatorIsDisabled()</code></para></listitem>
                </itemizedlist>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.forms.config">
        <title>Configuration</title>

        <para>
            <code>Zend_Form</code> is fully configurable via
            <code>setOptions()</code> and <code>setConfig()</code> (or by
            passing options or a <code>Zend_Config</code> object to the
            constructor).  Using these methods, you can specify form elements,
            display groups, decorators, and metadata.
        </para>

        <para>
            As a general rule, if 'set' + the option key refers to a
            <code>Zend_Form</code> method, then the value provided will be
            passed to that method. If the accessor does not exist, the key is
            assumed to reference an attribute, and will be passed to
            <code>setAttrib()</code>.
        </para>

        <para>
            Exceptions to the rule include the following:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>prefixPaths</code> will be passed to
                    <code>addPrefixPaths()</code>
            </para></listitem>

            <listitem><para>
                <code>elementPrefixPaths</code> will be passed to
                <code>addElementPrefixPaths()</code>
            </para></listitem>

            <listitem><para>
                <code>displayGroupPrefixPaths</code> will be passed to
                <code>addDisplayGroupPrefixPaths()</code>
            </para></listitem>

            <listitem>
                <para>the following setters cannot be set in this way:</para>

                <itemizedlist>
                    <listitem><para><code>setAttrib (though setAttribs *will* work)</code></para></listitem>

                    <listitem><para><code>setConfig</code></para></listitem>

                    <listitem><para><code>setDefault</code></para></listitem>

                    <listitem><para><code>setOptions</code></para></listitem>

                    <listitem><para><code>setPluginLoader</code></para></listitem>

                    <listitem><para><code>setSubForms</code></para></listitem>

                    <listitem><para><code>setTranslator</code></para></listitem>

                    <listitem><para><code>setView</code></para></listitem>
                </itemizedlist>
            </listitem>
        </itemizedlist>

        <para>
            As an example, here is a config file that passes configuration for
            every type of configurable data:
        </para>

        <programlisting role="ini"><![CDATA[
[element]
name = "registration"
action = "/user/register"
method = "post"
attribs.class = "zend_form"
attribs.onclick = "validate(this)"

disableTranslator = 0

prefixPaths.element.prefix = "My_Element"
prefixPaths.element.path = "My/Element/"
elementPrefixPaths.validate.prefix = "My_Validate"
elementPrefixPaths.validate.path = "My/Validate/"
displayGroupPrefixPaths.prefix = "My_Group"
displayGroupPrefixPaths.path = "My/Group/"

elements.username.type = "text"
elements.username.options.label = "Username"
elements.username.options.validators.alpha.validator = "Alpha"
elements.username.options.filters.lcase = "StringToLower"
; more elements, of course...

elementFilters.trim = "StringTrim"
;elementDecorators.trim = "StringTrim"

displayGroups.login.elements.username = "username"
displayGroups.login.elements.password = "password"
displayGroupDecorators.elements.decorator = "FormElements"
displayGroupDecorators.fieldset.decorator = "Fieldset"

decorators.elements.decorator = "FormElements"
decorators.fieldset.decorator = "FieldSet"
decorators.fieldset.decorator.options.class = "zend_form"
decorators.form.decorator = "Form"
?>]]></programlisting>

        <para>
            The above could easily be abstracted to an XML or PHP array-based
            configuration file.
        </para>
    </sect2>

    <sect2 id="zend.form.forms.custom">
        <title>Custom forms</title>

        <para>
            An alternative to using configuration-based forms is to subclass
            <code>Zend_Form</code>. This has several benefits:
        </para>

        <itemizedlist>
            <listitem><para>
                You can unit test your form easily to ensure validations and
                rendering perform as expected.
            </para></listitem>

            <listitem><para>
                Fine-grained control over individual elements.
            </para></listitem>

            <listitem><para>
                Re-use of form objects, and greater portability (no need to
                track config files).
            </para></listitem>

            <listitem><para>
                Implementing custom functionality.
            </para></listitem>
        </itemizedlist>

        <para>
            The most typical use case would be to use the
            <code>init()</code> method to setup specific form elements and
            configuration:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_Form_Login extends Zend_Form
{
    public function init()
    {
        $username = new Zend_Form_Element_Text('username');
        $username->class = 'formtext';
        $username->setLabel('Username:')
                 ->setDecorators(array(
                     array('ViewHelper', array('helper' => 'formText')),
                     array('Label', array('class' => 'label'))
                 ));

        $password = new Zend_Form_Element_Password('password');
        $password->class = 'formtext';
        $password->setLabel('Username:')
                 ->setDecorators(array(
                     array('ViewHelper', array('helper' => 'formPassword')),
                     array('Label', array('class' => 'label'))
                 ));

        $submit = new Zend_Form_Element_Submit('login');
        $submit->class = 'formsubmit';
        $submit->setValue('Login')
               ->setDecorators(array(
                   array('ViewHelper', array('helper' => 'formSubmit'))
               ));

        $this->addElements(array(
            $username,
            $password,
            $submit
        ));

        $this->setDecorators(array(
            'FormElements',
            'Fieldset',
            'Form'
        ));
    }
}
?>]]></programlisting>

        <para>
            This form can then be instantiated with simply:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form = new My_Form_Login();
?>]]></programlisting>

        <para>
            and all functionality is already setup and ready; no config files
            needed. (Note that this example is greatly simplified, as it
            contains no validators or filters for the elements.)
        </para>

        <para>
            Another common reason for extension is to define a set of
            default decorators. You can do this by overriding the
            <code>loadDefaultDecorators()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_Form_Login extends Zend_Form
{
    public function loadDefaultDecorators()
    {
        $this->setDecorators(array(
            'FormElements',
            'Fieldset',
            'Form'
        ));
    }
}
]]></programlisting>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.form.i18n">
    <title>Internationalization of Zend_Form</title>

    <para>
        Increasingly, developers need to tailor their content for multiple
        languages and regions. Zend_Form aims to make such a task trivial, and
        leverages functionality in both <link
            linkend="zend.translate">Zend_Translate</link> and <link
            linkend="zend.validate">Zend_Validate</link> to do so.
    </para>

    <para>
        By default, no internationalisation (i18n) is performed. To turn on i18n
        features in <code>Zend_Form</code>, you will need to instantiate a
        <code>Zend_Translate</code> object with an appropriate adapter, and
        attach it to <code>Zend_Form</code> and/or <code>Zend_Validate</code>.
        See the <link linkend="zend.translate">Zend_Translate
            documentation</link> for more information on creating the translate
        object and translation files
    </para>

    <note>
        <title>Translation Can Be Turned Off Per Item</title>

        <para>
            You can disable translation for any form, element, display group, or
            sub form by calling its <code>setDisableTranslator($flag)</code>
            method or passing a <code>disableTranslator</code> option to the
            object. This can be useful when you want to selectively disable
            translation for individual elements or sets of elements.
        </para>
    </note>

    <sect2 id="zend.form.i18n.initialization">
        <title>Initializing I18n in Forms</title>

        <para>
            In order to initialize i18n in forms, you will need either a
            <code>Zend_Translate</code> object or a
            <code>Zend_Translate_Adapter</code> object, as detailed in the
            <code>Zend_Translate</code> documentation.  Once you have a
            translation object, you have several options:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis>Easiest:</emphasis> add it to the registry. All i18n
                    aware components of Zend Framework will autodiscover a translate
                    object that is in the registry under the 'Zend_Translate' key
                    and use it to perform translation and/or localization:
                </para>

                <programlisting role="php"><![CDATA[<?php
// use the 'Zend_Translate' key; $translate is a Zend_Translate object:
Zend_Registry::set('Zend_Translate', $translate);
?>]]></programlisting>

                <para>
                    This will be picked up by <code>Zend_Form</code>,
                    <code>Zend_Validate</code>, and
                    <code>Zend_View_Helper_Translate</code>.
                </para>
            </listitem>

            <listitem>
                <para>
                    If all you are worried about is translating validation error
                    messages, you can register the translation object with
                    <code>Zend_Validate_Abstract</code>:
                </para>

                <programlisting role="php"><![CDATA[<?php
// Tell all validation classes to use a specific translate adapter:
Zend_Validate_Abstract::setDefaultTranslator($translate);
?>]]></programlisting>
            </listitem>

            <listitem>
                <para>
                    Alternatively, you can attach to the <code>Zend_Form</code>
                    object as a global translator. This has the side effect of also
                    translating validation error messages:
                </para>

                <programlisting role="php"><![CDATA[<?php
// Tell all form classes to use a specific translate adapter, as well as use
// this adapter to translate validation error messages:
Zend_Form::setDefaultTranslator($translate);
?>]]></programlisting>
            </listitem>

            <listitem>
                <para>
                    Finally, you can attach a translator to a specific form instance
                    or to specific elements using their <code>setTranslator()</code>
                    methods:
                </para>

                <programlisting role="php"><![CDATA[<?php
// Tell *this* form instance to use a specific translate adapter; it will also
// be used to translate validation error messages for all elements:
$form->setTranslator($translate);

// Tell *this* element to use a specific translate adapter; it will also be used
// to translate validation error messages for this particular element:
$element->setTranslator($translate);
?>]]></programlisting>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.i18n.standard">
        <title>Standard I18N Targets</title>

        <para>
            Now that you've attached a translation object to, what exactly can
            you translate by default?
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis>Validation error messages.</emphasis> Validation
                    error messages may be translated. To do so, use the various
                    error code constants from the <code>Zend_Validate</code>
                    validation classes as the message IDs. For more information
                    on these codes, see the <link
                        linkend="zend.validate">Zend_Validate</link>
                    documentation.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis>Labels.</emphasis> Element labels will be
                    translated, if a translation exists.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis>Fieldset Legends.</emphasis> Display groups and
                    sub forms render in fieldsets by default. The Fieldset
                    decorator attempts to translate the legend before rendering
                    the fieldset.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis>Form and Element Descriptions.</emphasis> All form
                    types (element, form, display group, sub form) allow
                    specifying an optional item description. The Description
                    decorator can be used to render this, and by default will
                    take the value and attempt to translate it.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis>Multi-option Values.</emphasis> For the various
                    items inheriting from <code>Zend_Form_Element_Multi</code>
                    (including the MultiCheckbox, Multiselect, and Radio
                    elements), the option values (not keys) will be translated
                    if a translation is available; this means that the option
                    labels presented to the user will be translated.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis>Submit and Button Labels.</emphasis> The various
                    Submit and Button elements (Button, Submit, and Reset) will
                    translate the label displayed to the user.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 tw=80 et:
-->
<sect1 id="zend.form.introduction">
    <title>Zend_Form</title>

    <para>
        Zend_Form simplifies form creation and handling in your web
        application.  It accomplishes the following goals:                                        
    </para>

    <itemizedlist>
        <listitem><para>Element input filtering and validation</para></listitem>
        <listitem><para>Element ordering</para></listitem>
        <listitem><para>Element and Form rendering, including escaping</para></listitem>
        <listitem><para>Element and form grouping</para></listitem>
        <listitem><para>Element and form-level configuration</para></listitem>
    </itemizedlist>

    <para>
        It heavily leverages other Zend Framework components to accomplish its
        goals, including <code>Zend_Config</code>, <code>Zend_Validate</code>,
        <code>Zend_Filter</code>, <code>Zend_Loader_PluginLoader</code>, and
        optionally <code>Zend_View</code>.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.form.quickstart">
    <title>Zend_Form Quick Start</title>

    <para>
        This quick start guide is intended to cover the basics of creating,
        validating, and rendering forms using <code>Zend_Form</code>.
    </para>

    <sect2 id="zend.form.quickstart.create">
        <title>Create a form object</title>

        <para>
            Creating a form object is very simple: simply instantiate
            <code>Zend_Form</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form = new Zend_Form;
?>]]></programlisting>

        <para>
            For advanced use cases, you may want to create a
            <code>Zend_Form</code> subclass, but for simple forms, you can
            create a form programmatically using a <code>Zend_Form</code>
            object.
        </para>

        <para>
            If you wish to specify the form action and method (always good
            ideas), you can do so with the <code>setAction()</code> and
            <code>setMethod()</code> accessors:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->setAction('/resource/process')
     ->setMethod('post');
?>]]></programlisting>

        <para>
            The above code sets the form action to the partial URL
            "/resource/process" and the form method to HTTP POST. This will be
            reflected during final rendering.
        </para>

        <para>
            You can set additional HTML attributes for the
            <code>&lt;form&gt;</code> tag by using the setAttrib() or
            setAttribs() methods.  For instance, if you wish to set the id, set
            the "id" attribute:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->setAttrib('id', 'login');
?>]]></programlisting>
    </sect2>

    <sect2 id="zend.form.quickstart.elements">
        <title>Add elements to the form</title>

        <para>
            A form is nothing without its elements. <code>Zend_Form</code>
            ships with some default elements that render XHTML via
            <code>Zend_View</code> helpers. These are as follows:
        </para>

        <itemizedlist>
            <listitem><para>
                button
            </para></listitem>

            <listitem><para>
                checkbox (or many checkboxes at once with multiCheckbox)
            </para></listitem>

            <listitem><para>
                hidden
            </para></listitem>

            <listitem><para>
                image
            </para></listitem>

            <listitem><para>
                password
            </para></listitem>

            <listitem><para>
                radio
            </para></listitem>

            <listitem><para>
                reset
            </para></listitem>

            <listitem><para>
                select (both regular and multi-select types)
            </para></listitem>

            <listitem><para>
                submit
            </para></listitem>

            <listitem><para>
                text
            </para></listitem>

            <listitem><para>
                textarea
            </para></listitem>
        </itemizedlist>

        <para>
            You have two options for adding elements to a form: you can
            instantiate concrete elements and pass in these objects, or you can
            pass in simply the element type and have <code>Zend_Form</code>
            instantiate an object of the correct type for you.
        </para>

        <para>
            As some examples:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Instantiating an element and passing to the form object:
$form->addElement(new Zend_Form_Element_Text('username'));

// Passing a form element type to the form object:
$form->addElement('text', 'username');
?>]]></programlisting>

        <para>
            By default, these do not have any validators or filters. This means
            you will need to configure your elements with minimally validators,
            and potentially filters. You can either do this (a) before you pass
            the element to the form, (b) via configuration options passed in
            when creating an element via <code>Zend_Form</code>, or (c) by
            pulling the element from the form object and configuring it after
            the fact.
        </para>

        <para>
            Let's first look at creating validators for a concrete element
            instance. You can either pass in <code>Zend_Validate_*</code>
            objects, or the name of a validator to utilize:
        </para>

        <programlisting role="php"><![CDATA[<?php
$username = new Zend_Form_Element_Text('username');

// Passing a Zend_Validate_* object:
$username->addValidator(new Zend_Validate_Alnum());

// Passing a validator name:
$username->addValidator('alnum');
?>]]></programlisting>

        <para>
            When using this second option, if the validator can accept
            constructor arguments, you can pass those in an array as the third
            parameter:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Pass a pattern
$username->addValidator('regex', false, array('/^[a-z]/i'));
?>]]></programlisting>

        <para>
            (The second parameter is used to indicate whether or not failure of
            this validator should prevent later validators from running; by
            default, this is false.)
        </para>

        <para>
            You may also wish to specify an element as required. This can be
            done using either an accessor or by passing an option when creating
            the element. In the former case:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Make this element required:
$username->setRequired(true);
?>]]></programlisting>

        <para>
            When an element is required, a 'NotEmpty' validator is added to the
            top of the validator chain, ensuring that the element has a value
            when required.
        </para>

        <para>
            Filters are registered in basically the same way as validators. For
            illustration purposes, let's add a filter to lowercase the final
            value:
        </para>

        <programlisting role="php"><![CDATA[<?php
$username->addFilter('StringtoLower');
?>]]></programlisting>

        <para>
            So, our final element setup might look like this:
        </para>

        <programlisting role="php"><![CDATA[<?php
$username->addValidator('alnum')
         ->addValidator('regex', false, array('/^[a-z]/'))
         ->setRequired(true)
         ->addFilter('StringToLower');

// or, more compactly:
$username->addValidators(array('alnum',
        array('regex', false, '/^[a-z]/i')
    ))
    ->setRequired(true)
    ->addFilters(array('StringToLower'));
?>]]></programlisting>


        <para>
            Simple as this is, doing this for every single element in a form
            can be a bit tedious. Let's try option (b) from above. When we
            create a new element using <code>Zend_Form::addElement()</code> as
            a factory, we can optionally pass in configuration options. These
            can include validators and filters to utilize. So, to do all of the
            above implicitly, try the following:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->addElement('text', 'username', array(
    'validators' => array(
        'alnum',
        array('regex', false, '/^[a-z]/i')
    ),
    'required' => true,
    'filters'  => array('StringToLower'),
));
?>]]></programlisting>

        <note><para>
            If you find you are setting up elements using the same options in
            many locations, you may want to consider creating your own
            <code>Zend_Form_Element</code> subclass and utilizing that class
            instead; this will save you typing in the long-run.
        </para></note>
    </sect2>

    <sect2 id="zend.form.quickstart.render">
        <title>Render a form</title>

        <para>
            Rendering a form is simple. Most elements use a
            <code>Zend_View</code> helper to render themselves, and thus need a
            view object in order to render.  Other than that, you have two
            options: use the form's render() method, or simply echo it.
        </para>

        <programlisting role="php"><![CDATA[<?php
// Explicitly calling render(), and passing an optional view object:
echo $form->render($view);

// Assuming a view object has been previously set via setView():
echo $form;
?>]]></programlisting>

        <para>
            By default, <code>Zend_Form</code> and
            <code>Zend_Form_Element</code> will attempt to use the view object
            initialized in the <code>ViewRenderer</code>, which means you won't
            need to set the view manually when using the Zend Framework MVC.
            Rendering a form in a view script is then as simple as:
        </para>

        <programlisting role="php"><![CDATA[
<?= $this->form ?>
]]></programlisting>

        <para>
            Under the hood, <code>Zend_Form</code> uses "decorators" to perform
            rendering. These decorators can replace content, append content, or
            prepend content, and have full introspection to the element passed
            to them. As a result, you can combine multiple decorators to
            achieve custom effects. By default, <code>Zend_Form_Element</code>
            actually combines four decorators to achieve its output; setup
            looks something like this:
        </para>

        <programlisting role="php"><![CDATA[<?php
$element->addDecorators(array(
    'ViewHelper',
    'Errors',
    array('HtmlTag', array('tag' => 'dd')),
    array('Label', array('tag' => 'dt')),
));
?>]]></programlisting>

        <para>
            (Where &lt;HELPERNAME&gt; is the name of a view helper to use, and varies
            based on the element.)
        </para>

        <para>
            The above creates output like the following:
        </para>

        <programlisting role="html"><![CDATA[
<dt><label for="username" class="required">Username</dt>
<dd>
    <input type="text" name="username" value="123-abc" />
    <ul class="errors">
        <li>'123-abc' has not only alphabetic and digit characters</li>
        <li>'123-abc' does not match against pattern '/^[a-z]/i'</li>
    </ul>
</dd>
]]></programlisting>

        <para>
            (Albeit not with the same formatting.)
        </para>

        <para>
            You can change the decorators used by an element if you wish to
            have different output; see the section on decorators for more
            information.
        </para>

        <para>
            The form itself simply loops through the elements, and dresses them
            in an HTML <code>&lt;form&gt;</code>. The action and method you
            provided when setting up the form are provided to the
            <code>&lt;form&gt;</code> tag, as are any attributes you set via
            <code>setAttribs()</code> and family. 
        </para>

        <para>
            Elements are looped either in the order in which they were
            registered, or, if your element contains an order attribute, that
            order will be used. You can set an element's order using:
        </para>

        <programlisting role="php"><![CDATA[<?php
$element->setOrder(10);
?>]]></programlisting>

        <para>
            Or, when creating an element, by passing it as an option:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->addElement('text', 'username', array('order' => 10));
?>]]></programlisting>
    </sect2>

    <sect2 id="zend.form.quickstart.validate">
        <title>Check if a form is valid</title>

        <para>
            After a form is submitted, you will need to check and see if it
            passes validations. Each element is checked against the data
            provided; if a key matching the element name is not present, and
            the item is marked as required, validations are run with a null
            value.
        </para>

        <para>
            Where does the data come from? You can use <code>$_POST</code> or
            <code>$_GET</code>, or any other data source you might have at hand
            (web service requests, for instance):
        </para>

        <programlisting role="php"><![CDATA[<?php
if ($form->isValid($_POST)) {
    // success!
} else {
    // failure!
}
?>]]></programlisting>

        <para>
            With AJAX requests, you sometimes can get away with validating
            single element, or groups of elements.
            <code>isValidPartial()</code> will validate a partial form. Unlike
            <code>isValid()</code>, however, if a particular key is not
            present, it will not run validations for that particular element:
        </para>

        <programlisting role="php"><![CDATA[<?php
if ($form->isValidPartial($_POST)) {
    // elements present all passed validations
} else {
    // one or more elements tested failed validations
}
?>]]></programlisting>

        <para>
            An additional method, <code>processAjax()</code>, can also be used
            for validating partial forms. Unlike <code>isValidPartial()</code>,
            it returns a JSON-formatted string containing error messages on
            failure.
        </para>

        <para>
            Assuming your validations have passed, you can now fetch the
            filtered values:
        </para>

        <programlisting role="php"><![CDATA[<?php
$values = $form->getValues();
?>]]></programlisting>

        <para>
            If you need the unfiltered values at any point, use:
        </para>

        <programlisting role="php"><![CDATA[<?php
$unfiltered = $form->getUnfilteredValues();
?>]]></programlisting>
    </sect2>

    <sect2 id="zend.form.quickstart.errorstatus">
        <title>Get error status</title>

        <para>
            So, your form failed validations? In most cases, you can simply
            render the form again, and errors will be displayed when using the
            default decorators:
        </para>

        <programlisting role="php"><![CDATA[<?php
if (!$form->isValid($_POST)) {
    echo $form;

    // or assign to the view object and render a view...
    $this->view->form = $form;
    return $this->render('form');
}
?>]]></programlisting>

        <para>
            If you want to inspect the errors, you have two methods.
            <code>getErrors()</code> returns an associative array of element
            names / codes (where codes is an array of error codes).
            <code>getMessages()</code> returns an associative array of element
            names / messages (where messages is an associative array of error
            code / error message pairs). If a given element does not have any
            errors, it will not be included in the array.
        </para>
    </sect2>

    <sect2 id="zend.form.quickstart.puttingtogether">
        <title>Putting it together</title>

        <para>
            Let's build a simple login form. It will need elements
            representing:
        </para>

        <itemizedlist>
            <listitem><para>username</para></listitem>
            <listitem><para>password</para></listitem>
            <listitem><para>submit</para></listitem>
        </itemizedlist>

        <para>
            For our purposes, let's assume that a valid username should be
            alphanumeric characters only, start with a letter, have a minimum
            length of 6, and maximum length of 20; they will be normalized to
            lowercase. Passwords must be a minimum of 6 characters.  We'll
            simply toss the submit value when done, so it can remain
            unvalidated.
        </para>

        <para>
            We'll use the power of <code>Zend_Form</code>'s configuration
            options to build the form:
        </para>

        <programlisting role="php"><![CDATA[<?php


$form = new Zend_Form();
$form->setAction('/usr/login')
     ->setMethod('post');

// Create and configure username element:
$username = $form->createElement('text', 'username');
$username->addValidator('alnum')
         ->addValidator('regex', false, array('/^[a-z]+/'))
         ->addValidator('stringLength', false, array(6, 20))
         ->setRequired(true)
         ->addFilter('StringToLower');

// Create and configure password element:
$password = $form->createElement('password', 'password');
$password->addValidator('StringLength', false, array(6))
         ->setRequired(true);

// Add elements to form:
$form->addElement($username)
     ->addElement($password)
     // use addElement() as a factory to create 'Login' button:
     ->addElement('submit', 'login', array('label' => 'Login'));
?>]]></programlisting>

        <para>
            Next, we'll create a controller for handling this:
        </para>

        <programlisting role="php"><![CDATA[<?php
class UserController extends Zend_Controller_Action
{
    public function getForm()
    {
        // create form as above
        return $form;
    }

    public function indexAction()
    {
        // render user/form.phtml
        $this->view->form = $this->getForm();
        $this->render('form');
    }

    public function loginAction()
    {
        if (!$this->getRequest()->isPost()) {
            return $this->_forward('index');
        }
        $form = $this->getForm();
        if (!$form->isValid($_POST)) {
            // Failed validation; redisplay form
            $this->view->form = $form;
            return $this->render('form');
        }
        
        $values = $form->getValues();
        // now try and authenticate....
    }
}
?>]]></programlisting>

        <para>
            And a view script for displaying the form:
        </para>

<programlisting role="php"><![CDATA[
<h2>Please login:</h2>
<?= $this->form ?>
]]></programlisting>

        <para>
            As you'll note from the controller code, there's more work to do:
            while the submission may be valid, you may still need to do some
            authentication using <code>Zend_Auth</code>, for instance.
        </para>
    </sect2>

    <sect2 id="zend.form.quickstart.config">
        <title>Using a Zend_Config object</title>

        <para>
            All <code>Zend_Form</code> classes are configurable using
            <code>Zend_Config</code>; you can either pass a
            <code>Zend_Config</code> object to the constructor or pass it in
            via <code>setConfig()</code>. Let's look at how we might create the
            above form using an INI file. First, let's follow the
            recommendations, and place our configurations into sections
            reflecting the release location, and focus on the 'development'
            section. Next, we'll setup a section for the given controller
            ('user'), and a key for the form ('login'):
        </para>

        <programlisting role="ini"><![CDATA[
[development]
; general form metainformation
user.login.action = "/user/login"
user.login.method = "post"

; username element
user.login.elements.username.type = "text"
user.login.elements.username.options.validators.alnum.validator = "alnum"
user.login.elements.username.options.validators.regex.validator = "regex"
user.login.elements.username.options.validators.regex.options.pattern = "/^[a-z]/i"
user.login.elements.username.options.validators.strlen.validator = "StringLength"
user.login.elements.username.options.validators.strlen.options.min = "6"
user.login.elements.username.options.validators.strlen.options.max = "20"
user.login.elements.username.options.required = true
user.login.elements.username.options.filters.lower.filter = "StringToLower"

; password element
user.login.elements.password.type = "password"
user.login.elements.password.options.validators.strlen.validator = "StringLength"
user.login.elements.password.options.validators.strlen.options.min = "6"
user.login.elements.password.options.required = true

; submit element
user.login.elements.submit.type = "submit"
]]></programlisting>

        <para>
            You could then pass this to the form constructor:
        </para>

        <programlisting role="php"><![CDATA[<?php
$config = new Zend_Config_Ini($configFile, 'development');
$form   = new Zend_Form($config->user->login);
?>]]></programlisting>

        <para>
            and the entire form will be defined.
        </para>
    </sect2>

    <sect2 id="zend.form.quickstart.conclusion">
        <title>Conclusion</title>

        <para>
            Hopefully with this little tutorial, you should now be well on your
            way to unlocking the power and flexibility of
            <code>Zend_Form</code>. Read on for more in-depth information!
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.form.standardDecorators">
    <title>Standard Form Decorators Shipped With Zend Framework</title>

    <para>
        <code>Zend_Form</code> ships with several standard decorators. For more
        information on general decorator usage, see <link
            linkend="zend.form.decorators">the Decorators section</link>.
    </para>

    <sect2 id="zend.form.standardDecorators.callback">
        <title>Zend_Form_Decorator_Callback</title>

        <para>
            The Callback decorator can execute an arbitrary callback to
            render content. Callbacks should be specified via the 'callback'
            option passed in the decorator configuration, and can be any
            valid PHP callback type. Callbacks should accept three
            arguments, <code>$content</code> (the original content passed to
            the decorator), <code>$element</code> (the item being
            decorated), and an array of <code>$options</code>. As an example
            callback:
        </para>

        <programlisting role="php"><![CDATA[<?php
class Util
{
    public static function label($content, $element, array $options)
    {
        return '<span class="label">' . $element->getLabel() . "</span>";
    }
}
?>]]></programlisting>

        <para>
            This callback would be specified as <code>array('Util',
                'label')</code>, and would generate some (bad) HTML markup
            for the label. The Callback decorator would then either replace,
            append, or prepend the original content with the return value of
            this.
        </para>

        <para>
            The Callback decorator allows specifying a null value for the
            placement option, which will replace the original content with
            the callback return value; 'prepend' and 'append' are still
            valid as well.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.description">
        <title>Zend_Form_Decorator_Description</title>

        <para>
            The Description decorator can be used to display a description set
            on a <code>Zend_Form</code>, <code>Zend_Form_Element</code>, or
            <code>Zend_Form_DisplayGroup</code> item; it pulls the description
            using the object's <code>getDescription()</code> method. Common use
            cases are for providing UI hints for your elements.
        </para>

        <para>
            By default, if no description is present, no output is generated. If
            the description is present, then it is wrapped in an HTML
            <code>p</code> tag by default, though you may specify a tag by
            passing a <code>tag</code> option when creating the decorator, or
            calling <code>setTag()</code>. You may additionally specify a class
            for the tag using the <code>class</code> option or by calling
            <code>setClass()</code>; by default, the class 'hint' is used.
        </para>

        <para>
            The description is escaped using the view object's escaping
            mechanisms by default. You can disable this by passing a
            <code>false</code> value to the decorator's 'escape' option or
            <code>setEscape()</code> method.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.dtDdWrapper">
        <title>Zend_Form_Decorator_DtDdWrapper</title>

        <para>
            The default decorators utilize definition lists
            (<code>&lt;dl&gt;</code>) to render form elements. Since form
            items can appear in any order, display groups and sub forms can
            be interspersed with other form items. To keep these particular
            item types within the definition list, the DtDdWrapper creates a
            new, empty definition term (<code>&lt;dt&gt;</code>) and wraps
            its content in a new definition datum (<code>&lt;dd&gt;</code>).
            The output looks something like this:
        </para>

        <programlisting role="html"><![CDATA[
<dt></dt>
<dd><fieldset id="subform">
    <legend>User Information</legend>
    ...
</fieldset></dd>
]]></programlisting>

        <para>
            This decorator replaces the content provided to it by wrapping
            it within the <code>&lt;dd&gt;</code> element.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.errors">
        <title>Zend_Form_Decorator_Errors</title>

        <para>
            Element errors get their own decorator with the Errors
            decorator. This decorator proxies to the FormErrors view helper,
            which renders error messages in an unordered list
            (<code>&lt;ul&gt;</code>) as list items. The
            <code>&lt;ul&gt;</code> element receives a class of "errors".
        </para>

        <para>
            The Errors decorator can either prepend or append the content
            provided to it.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.fieldset">
        <title>Zend_Form_Decorator_Fieldset</title>

        <para>
            Display groups and sub forms render their content within
            fieldsets by default. The Fieldset decorator checks for either a
            'legend' option or a <code>getLegend()</code> method in the
            registered element, and uses that as a legend if non-empty. Any
            content passed in is wrapped in the HTML fieldset, replacing the
            original content. Any attributes set in the decorated item are
            passed to the fieldset as HTML attributes.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.form">
        <title>Zend_Form_Decorator_Form</title>

        <para>
            <code>Zend_Form</code> objects typically need to render an HTML
            form tag. The Form decorator proxies to the Form view helper. It
            wraps any provided content in an HTML form element, using the
            <code>Zend_Form</code> object's action and method, and any
            attributes as HTML attributes.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.formElements">
        <title>Zend_Form_Decorator_FormElements</title>

        <para>
            Forms, display groups, and sub forms are collections of
            elements. In order to render these elements, they utilize the
            FormElements decorator, which iterates through all items,
            calling <code>render()</code> on each and joining them with the
            registered separator. It can either append or prepend content
            passed to it.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.htmlTag">
        <title>Zend_Form_Decorator_HtmlTag</title>

        <para>
            The HtmlTag decorator allows you to utilize HTML tags to
            decorate content; the tag utilized is passed in the 'tag'
            option, and any other options are used as HTML attributes to
            that tag. The tag by default is assumed to be block level, and
            replaces the content by wrapping it in the given tag. However,
            you can specify a placement to append or prepend a tag as well.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.image">
        <title>Zend_Form_Decorator_Image</title>

        <para>
            The Image decorator allows you to create an HTML image input
            (<code>&lt;input type="image" ... /&gt;</code>), and optionally
            render it within another HTML tag.
        </para>

        <para>
            By default, the decorator uses the element's src property, which can
            be set with the <code>setImage()</code> method, as the image
            source. Additionally, the element's label will be used as the alt
            tag, and the <code>imageValue</code> (manipulated with the Image
            element's <code>setImageValue()</code> and
            <code>getImageValue()</code> accessors) will be used for the value.
        </para>

        <para>
            To specify an HTML tag with which to wrap the element, either pass a
            'tag' option to the decorator, or explicitly call
            <code>setTag()</code>.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.label">
        <title>Zend_Form_Decorator_Label</title>

        <para>
            Form elements typically have labels, and the Label decorator is
            used to render these labels. It proxies to the FormLabel view
            helper, and pulls the element label using the
            <code>getLabel()</code> method of the element. If no label is
            present, none is rendered. By default, labels are translated when a
            translation adapter exists and a translation for the label exists.
        </para>

        <para>
            You may optionally specify a 'tag' option; if provided, it wraps
            the label in that block-level tag. If the 'tag' option is
            present, and no label present, the tag is rendered with no
            content. You can specify the class to use with the tag with the
            'class' option or by calling <code>setClass()</code>.
        </para>

        <para>
            Additionally, you can specify prefixes and suffixes to use when
            displaying the element, based on whether or not the label is for an
            optional or required element. Common use cases would be to append a
            ':' to the label, or a '*' indicating an item is required. You can
            do so with the following options and methods:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>optionalPrefix</code>: set the text to prefix the
                    label with when the element is optional. Use the
                    <code>setOptionalPrefix()</code> and
                    <code>getOptionalPrefix()</code> accessors to manipulate it.
            </para></listitem>

            <listitem><para>
                    <code>optionalSuffix</code>: set the text to append the
                    label with when the element is optional. Use the
                    <code>setOptionalSuffix()</code> and
                    <code>getOptionalSuffix()</code> accessors to manipulate it.
            </para></listitem>

            <listitem><para>
                    <code>requiredPrefix</code>: set the text to prefix the
                    label with when the element is required. Use the
                    <code>setRequiredPrefix()</code> and
                    <code>getRequiredPrefix()</code> accessors to manipulate it.
            </para></listitem>

            <listitem><para>
                    <code>requiredSuffix</code>: set the text to append the
                    label with when the element is required. Use the
                    <code>setRequiredSuffix()</code> and
                    <code>getRequiredSuffix()</code> accessors to manipulate it.
            </para></listitem>
        </itemizedlist>

        <para>
            By default, the Label decorator prepends to the provided
            content; specify a 'placement' option of 'append' to place it
            after the content.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.viewHelper">
        <title>Zend_Form_Decorator_ViewHelper</title>

        <para>
            Most elements utilize <code>Zend_View</code> helpers for
            rendering, and this is done with the ViewHelper decorator. With
            it, you may specify a 'helper' tag to explicitly set the view
            helper to utilize; if none is provided, it uses the last segment
            of the element's class name to determine the helper, prepending
            it with the string 'form': e.g., 'Zend_Form_Element_Text' would
            look for a view helper of 'formText'. 
        </para>

        <para>
            Any attributes of the provided element are passed to the view
            helper as element attributes.
        </para>

        <para>
            By default, this decorator appends content; use the 'placement'
            option to specify alternate placement.
        </para>
    </sect2>

    <sect2 id="zend.form.standardDecorators.viewScript">
        <title>Zend_Form_Decorator_ViewScript</title>

        <para>
            Sometimes you may wish to use a view script for creating your
            elements; this way you can have fine-grained control over your
            elements, turn the view script over to a designer, or simply create
            a way to easily override setting based on which module you're using
            (each module could optionally override element view scripts to suit
            their own needs). The ViewScript decorator solves this problem.
        </para>

        <para>
            The ViewScript decorator requires a 'viewScript' option, either
            provided to the decorator, or as an attribute of the element. It
            then renders that view script as a partial script, meaning each call
            to it has its own variable scope; no variables from the view will be
            injected other than the element itself. Several variables are then
            populated:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>element</code>: the element being decorated
            </para></listitem>

            <listitem><para>
                    <code>content</code>: the content passed to the decorator
            </para></listitem>

            <listitem><para>
                    <code>decorator</code>: the decorator object itself
            </para></listitem>

            <listitem><para>
                    Additionally, all options passed to the decorator via
                    <code>setOptions()</code> that are not used internally (such
                    as placement, separator, etc.) are passed to the view script
                    as view variables.
            </para></listitem>
        </itemizedlist>

        <para>
            As an example, you might have the following element:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Setting the decorator for the element to a single, ViewScript, decorator,
// specifying the viewScript as an option, and some extra options:
$element->setDecorators(array(array('ViewScript', array(
    'viewScript' => '_element.phtml',
    'class'      => 'form element'
))));

// OR specifying the viewScript as an element attribute:
$element->viewScript = '_element.phtml';
$element->setDecorators(array(array('ViewScript', array('class' => 'form element'))));
?>]]></programlisting>
        
        <para>
            You could then have a view script something like this:
        </para>

        <programlisting role="php"><![CDATA[
<div class="<?= $this->class ?>">
    <?= $this->formLabel($this->element->getName(), $this->element->getLabel()) ?>
    <?= $this->{$this->element->helper}(
        $this->element->getName(),
        $this->element->getValue(), 
        $this->element->getAttribs()
    ) ?>
    <?= $this->formErrors($this->element->getMessages()) ?>
    <div class="hint"><?= $this->element->getDescription() ?></div>
</div>
]]></programlisting>

        <note>
            <title>Replacing content with a view script</title>

            <para>
                You may find it useful for the view script to replace the
                content provided to the decorator -- for instance, if you want
                to wrap it. You can do so by specifying a boolean false value
                for the decorator's 'placement' option:
            </para>

            <programlisting role="php"><![CDATA[<?php
// At decorator creation:
$element->addDecorator('ViewScript', array('placement' => false));

// Applying to an existing decorator instance:
$decorator->setOption('placement', false);

// Applying to a decorator already attached to an element:
$element->getDecorator('ViewScript')->setOption('placement', false);

// Within a view script used by a decorator:
$this->decorator->setOption('placement', false);
?>]]></programlisting>
        </note>

        <para>
            Using the ViewScript decorator is recommended for when you want to
            have very fine-grained control over how your elements are rendered.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 tw=80 et:
-->
<sect1 id="zend.form.standardElements">
    <title>Standard Form Elements Shipped With Zend Framework</title>

    <para>
        Zend Framework ships with concrete element classes covering most HTML
        form elements. Most simply specify a particular view helper for use when
        decorating the element, but several offer additional functionality. The
        following is a list of all such classes, as well as descriptions of the
        functionality they offer.
    </para>

    <sect2 id="zend.form.standardElements.button">
        <title>Zend_Form_Element_Button</title>

        <para>
            Used for creating HTML button elements,
            <code>Zend_Form_Element_Button</code> extends <link
                linkend="zend.form.standardElements.submit">Zend_Form_Element_Submit</link>,
            deriving its custom functionality. It specifies the 'formButton'
            view helper for decoration.
        </para>

        <para>
            Like the submit element, it uses the element's label as the element
            value for display purposes; in other words, to set the text of the
            button, set the value of the element. The label will be translated
            if a translation adapter is present.
        </para>

        <para>
            Because the label is used as part of the element, the button element
            uses only the <link
                linkend="zend.form.standardDecorators.viewHelper">ViewHelper</link>
            and <link
                linkend="zend.form.standardDecorators.dtDdWrapper">DtDdWrapper</link>
            decorators.
        </para>

        <para>
            After populating or validating a form, you can check if the given
            button was clicked using the <code>isChecked()</code> method.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.checkbox">
        <title>Zend_Form_Element_Checkbox</title>

        <para>
            HTML checkboxes allow you return a specific value, but basically
            operate as booleans: when it is checked, the value is submitted;
            when it's not checked, nothing is submitted. Internally,
            Zend_Form_Element_Checkbox enforces this state.
        </para>
            
        <para>
            By default, the checked value is '1', and the unchecked value '0'.
            You can specify the values to use using the
            <code>setCheckedValue()</code> and <code>setUncheckedValue()</code>
            accessors, respectively. Internally, any time you set the value, if
            the provided value matches the checked value, then it is set, but
            any other value causes the unchecked value to be set.
        </para>

        <para>
            Additionally, setting the value sets the <code>checked</code>
            property of the checkbox. You can query this using
            <code>isChecked()</code> or simply accessing the property. Using the
            <code>setChecked($flag)</code> method will both set the state of the
            flag as well as set the approriate checked or unchecked value in the
            element. Please use this method when setting the checked state of a
            checkbox element to ensure the value is set properly.
        </para>

        <para>
            <code>Zend_Form_Element_Checkbox</code> uses the 'formCheckbox' view
            helper. The checked value is always used to populate it.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.hidden">
        <title>Zend_Form_Element_Hidden</title>

        <para>
            Hidden elements merely inject data that should be submitted, but
            which the user should not manipulate.
            <code>Zend_Form_Element_Hidden</code> accomplishes this through use
            of the 'formHidden' view helper.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.hash">
        <title>Zend_Form_Element_Hash</title>

        <para>
            This element provides protection from CSRF attacks on forms,
            ensuring the data is submitted by the user session that generated
            the form and not by a rogue script. Protection is achieved by adding
            a hash element to a form and verifying it when the form is
            submitted.
        </para>

        <para>
            The name of the hash element should be unique. It is recommended to use
            the <literal>salt</literal> option for the element, two hashes with
            same names and different salts would not collide:
        </para>

        <programlisting role="php"><![CDATA[<?php
$form->addElement('hash', 'no_csrf_foo', array('salt' => 'unique'));
?>]]></programlisting>
        
        <para>
            You can set the salt later using the <code>setSalt($salt)</code>
            method.
        </para>

        <para>
            Internally, the element stores a unique identifier using
            <code>Zend_Session_Namespace</code>, and checks for it at
            submission (checking that the TTL has not expired). The 'Identical'
            validator is then used to ensure the submitted hash matches the
            stored hash.
        </para>

        <para>
            The 'formHidden' view helper is used to render the element in the
            form.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.Image">
        <title>Zend_Form_Element_Image</title>

        <para>
            Images can be used as form elements, and allow you to specify
            graphical elements as form buttons.
        </para>

        <para>
            Images need an image source. <code>Zend_Form_Element_Image</code>
            allows you to specify this by using the <code>setImage()</code>
            accessor (or 'image' configuration key). You can also optionally specify a value to use when
            submitting the image using the <code>setImageValue()</code> accessor
            (or 'imageValue' configuration key). When the value set for the
            element matches the <code>imageValue</code>, then the accessor
            <code>isChecked()</code> will return true. 
        </para>

        <para>
            The Image element uses the 
            <link linkend="zend.form.standardDecorators.image">Image
                Decorator</link> for rendering (as well as the standard Errors,
            HtmlTag, and Label decorators). You can optionally specify a tag to
            the <code>Image</code> decorator that will then wrap the image
            element.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.multiCheckbox">
        <title>Zend_Form_Element_MultiCheckbox</title>

        <para>
            Often you have a set of related checkboxes, and you wish to group
            the results. This is much like a <link
                linkend="zend.form.standardElements.multiselect">Multiselect</link>,
            but instead of them being in a dropdown list, you need to show
            checkbox/value pairs.
        </para>

        <para>
            <code>Zend_Form_Element_MultiCheckbox</code> makes this a snap. Like
            all other elements extending the base Multi element, you can specify
            a list of options, and easily validate against that same list. The
            'formMultiCheckbox' view helper ensures that these are returned as
            an array in the form submission.
        </para>

        <para>
            You may manipulate the various checkbox options using the following
            methods:
        </para>

        <itemizedlist>
            <listitem><para><code>addMultiOption($option, $value)</code></para></listitem>

            <listitem><para><code>addMultiOptions(array $options)</code></para></listitem>

            <listitem><para><code>setMultiOptions(array $options)</code>
                    (overwrites existing options)</para></listitem>

            <listitem><para>getMultiOption($option)</para></listitem>

            <listitem><para>getMultiOptions()</para></listitem>

            <listitem><para><code>removeMultiOption($option)</code></para></listitem>

            <listitem><para><code>clearMultiOptions()</code></para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.standardElements.multiselect">
        <title>Zend_Form_Element_Multiselect</title>

        <para>
            XHTML <code>select</code> elements allow a 'multiple' attribute,
            indicating multiple options may be selected for submission, instead
            of the usual one. <code>Zend_Form_Element_Multiselect</code> extends
            <link
                linkend="zend.form.standardElements.select">Zend_Form_Element_Select</link>,
            and sets the <code>multiple</code> attribute to 'multiple'. Like
            other classes that inherit from the base
            <code>Zend_Form_Element_Multi</code> class, you can manipulate the
            options for the select using:
        </para>

        <itemizedlist>
            <listitem><para><code>addMultiOption($option, $value)</code></para></listitem>

            <listitem><para><code>addMultiOptions(array $options)</code></para></listitem>

            <listitem><para><code>setMultiOptions(array $options)</code>
                    (overwrites existing options)</para></listitem>

            <listitem><para>getMultiOption($option)</para></listitem>

            <listitem><para>getMultiOptions()</para></listitem>

            <listitem><para><code>removeMultiOption($option)</code></para></listitem>

            <listitem><para><code>clearMultiOptions()</code></para></listitem>
        </itemizedlist>

        <para>
            If a translation adapter is registered with the form and/or element,
            option values will be translated for display purposes.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.password">
        <title>Zend_Form_Element_Password</title>

        <para>
            Password elements are basically normal text elements -- except that
            you typically do not want the submitted password displayed in error
            messages or the element itself when the form is re-displayed.
        </para>

        <para>
            <code>Zend_Form_Element_Password</code> achieves this by calling
            <code>setObscureValue(true)</code> on each validator (ensuring that
            the password is obscured in validation error messages), and using
            the 'formPassword' view helper (which does not display the value
            passed to it).
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.radio">
        <title>Zend_Form_Element_Radio</title>

        <para>
            Radio elements allow you to specify several options, of which you
            need a single value returned. <code>Zend_Form_Element_Radio</code>
            extends the base <code>Zend_Form_Element_Multi</code> class,
            allowing you to specify a number of options, and then uses the
            <code>formRadio</code> view helper to display these.
        </para>

        <para>
            Like all elements extending the Multi element base class, the
            following methods may be used to manipulate the radio options
            displayed:
        </para>

        <itemizedlist>
            <listitem><para><code>addMultiOption($option, $value)</code></para></listitem>

            <listitem><para><code>addMultiOptions(array $options)</code></para></listitem>

            <listitem><para><code>setMultiOptions(array $options)</code>
                    (overwrites existing options)</para></listitem>

            <listitem><para>getMultiOption($option)</para></listitem>

            <listitem><para>getMultiOptions()</para></listitem>

            <listitem><para><code>removeMultiOption($option)</code></para></listitem>

            <listitem><para><code>clearMultiOptions()</code></para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.form.standardElements.reset">
        <title>Zend_Form_Element_Reset</title>

        <para>
            Reset buttons are typically used to clear a form, and are not part
            of submitted data. However, as they serve a purpose in the display,
            they are included in the standard elements.
        </para>

        <para>
            <code>Zend_Form_Element_Reset</code> extends <link
                linkend="zend.form.standardElements.submit">Zend_Form_Element_Submit</link>.
            As such, the label is used for the button display, and will be
            translated if a translation adapter is present. It utilizes only the
            'ViewHelper' and 'DtDdWrapper' decorators, as there should never be
            error messages for such elements, nor will a label be necessary.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.select">
        <title>Zend_Form_Element_Select</title>

        <para>
            Select boxes are a common way of limiting to specific choices for a
            given form datum. <code>Zend_Form_Element_Select</code> allows you
            to generate these quickly and easily.
        </para>

        <para>
            As it extends the base Multi element, the following methods may be
            used to manipulate the select options:
        </para>

        <itemizedlist>
            <listitem><para><code>addMultiOption($option, $value)</code></para></listitem>

            <listitem><para><code>addMultiOptions(array $options)</code></para></listitem>

            <listitem><para><code>setMultiOptions(array $options)</code>
                    (overwrites existing options)</para></listitem>

            <listitem><para>getMultiOption($option)</para></listitem>

            <listitem><para>getMultiOptions()</para></listitem>

            <listitem><para><code>removeMultiOption($option)</code></para></listitem>

            <listitem><para><code>clearMultiOptions()</code></para></listitem>
        </itemizedlist>

        <para>
            <code>Zend_Form_Element_Select</code> uses the 'formSelect' view
            helper for decoration.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.submit">
        <title>Zend_Form_Element_Submit</title>

        <para>
            Submit buttons are used to submit a form. You may use multiple
            submit buttons; you can use the button used to submit the form to
            decide what action to take with the data submitted.
            <code>Zend_Form_Element_Submit</code> makes this decisioning easy,
            by adding a <code>isChecked()</code> method; as only one button
            element will be submitted by the form, after populating or
            validating the form, you can call this method on each submit button
            to determine which one was used.
        </para>

        <para>
            <code>Zend_Form_Element_Submit</code> uses the label as the "value"
            of the submit button, translating it if a translation adapter is
            present. <code>isChecked()</code> checks the submitted value against
            the label in order to determine if the button was used.
        </para>

        <para>
            The <link
                linkend="zend.form.standardDecorators.viewHelper">ViewHelper</link>
            and <link
                linkend="zend.form.standardDecorators.dtDdWrapper">DtDdWrapper</link>
            decorators to render the element. No label decorator is used, as the
            button label is used when rendering the element; also, typically,
            you will not associate errors with a submit element.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.text">
        <title>Zend_Form_Element_Text</title>

        <para>
            By far the most prevalent type of form element is the text element,
            allowing for limited text entry; it's an ideal element for most data
            entry. <code>Zend_Form_Element_Text</code> simply uses the
            'formText' view helper to display the element.
        </para>
    </sect2>

    <sect2 id="zend.form.standardElements.textarea">
        <title>Zend_Form_Element_Textarea</title>

        <para>
            Textareas are used when large quantities of text are expected, and
            place no limits on the amount of text submitted (other than maximum
            size limits as dictated by your server or PHP).
            <code>Zend_Form_Element_Textarea</code> uses the 'textArea' view
            helper to display such elements, placing the value as the content of
            the element.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 tw=80 et:
-->
<sect1 id="zend.gdata.introduction">
    <title>Introduction to Gdata</title>
    <para>
        Google Data APIs provide programmatic interface to some of Google's
        online services.  The Google data Protocol is based upon the
        <ulink url="http://ietfreport.isoc.org/idref/draft-ietf-atompub-protocol/">Atom Publishing Protocol</ulink>
        and allows client applications to retrieve data matching queries,
        post data, update data and delete data using standard HTTP and the
        Atom syndication formation.

        The Zend_Gdata component is a PHP 5 interface for accessing Google Data
        from PHP.  The Zend_Gdata component also supports accessing other services
        implementing the Atom Publishing Protocol.
    </para>

    <para>
        See
        <ulink url="http://code.google.com/apis/gdata/">http://code.google.com/apis/gdata/</ulink>
        for more information about Google Data API.
    </para>

    <para>
        The services that are accessible by Zend_Gdata include the
        following:

        <itemizedlist>
            <listitem>
                <para>
                    <link linkend="zend.gdata.calendar">Google Calendar</link>
                    is a popular online calendar application.
                </para>
            </listitem>
            <listitem>
                <para>
                    <link linkend="zend.gdata.spreadsheets">Google Spreadsheets</link>
                    provides an online collaborative spreadsheets tool which
                    can be used as a simple data store for your applications.
                </para>
            </listitem>
            <listitem>
                <para>
                    <link linkend="zend.gdata.docs">Google Documents List</link>
                    provides an online list of all spreadsheets, word processing documents,
                    and presentations stored in a Google account.
                </para>
            </listitem>
            <listitem>
                <para>
                    <link linkend="zend.gdata.gapps">Google Provisioning</link>
                    provides the ability to create, retrieve, update, and
                    delete user accounts, nicknames, and email lists on a
                    Google Apps hosted domain.
                </para>
            </listitem>
            <listitem>
                <para>
                    <link linkend="zend.gdata.gbase">Google Base</link>
                    provides the ability to retrieve, post, update, and
                    delete items in Google Base.
                </para>
            </listitem>
            <listitem>
                <para>
                    <link linkend="zend.gdata.youtube">YouTube</link>
                    provides the ability to search and retrieve videos,
                    comments, favorites, subscriptions, user profiles
                    and more.
                </para>
            </listitem>
            <listitem>
                <para>
                    <link linkend="zend.gdata.photos">Picasa Web Albums</link>
                    provides an online photo sharing application.
                </para>
            </listitem>
            <listitem>
                <para>
                    <ulink url="http://code.google.com/apis/blogger/developers_guide_php.html">Google Blogger</ulink>
                    is a popular Internet provider of
                    "push-button publishing" and syndication.
                </para>
            </listitem>
            <listitem>
                <para>
                    Google CodeSearch
                    allows you to search public source code from many projects.
                </para>
            </listitem>
            <listitem>
                <para>
                    Google Notebook
                    allows you to view public Notebook content.
                </para>
            </listitem>
        </itemizedlist>
    </para>

    <note>
        <title>Unsupported services</title>
        <para>
            Zend_Gdata does not provide an interface to any other Google
            service, such as Search, Gmail, Translation, or Maps.
            Only services that support the Google Data API are supported.
        </para>
    </note>

    <sect2 id="zend.gdata.introduction.structure">
        <title>Structure of Zend_Gdata</title>
        <para>
            Zend_Gata is composed of several types of classes:
            <itemizedlist>
                <listitem>
                    <para>
                        Service classes - inheriting from Zend_Gdata_App.
                        These also include other classes such as Zend_Gdata,
                        Zend_Gdata_Spreadsheets, etc.  These classes enable
                        interacting with APP or GData services and provide the
                        ability to retrieve feeds, retrieve entries, post
                        entries, update entries and delete entries.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Query classes - inheriting from Zend_Gdata_Query.
                        These also include other classes for specific services,
                        such as Zend_Gdata_Spreadsheets_ListQuery and
                        Zend_Gdata_Spreadsheets_CellQuery.  Query classes
                        provide methods used to construct a query for data
                        to be retrieved from GData services.  Methods include
                        getters and setters like <code>setUpdatedMin()</code>,
                        <code>setStartIndex()</code>, and
                        <code>getPublishedMin()</code>.  The query classes also
                        have a method to generate a URL representing the
                        constructed query -- <code>getQueryUrl</code>.
                        Alternatively, the query string component of the URL
                        can be retrieved used the <code>getQueryString()</code>
                        method.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Feed classes - inheriting from Zend_Gdata_App_Feed.
                        These also include other classes such as
                        Zend_Gdata_Feed,
                        Zend_Gdata_Spreadsheets_SpreadsheetFeed,
                        and Zend_Gdata_Spreadsheets_ListFeed.
                        These classes represent feeds of entries retrieved
                        from services.  They are primarily used to retrieve
                        data returned from services.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Entry classes - inheriting from Zend_Gdata_App_Entry.
                        These also include other classes such as
                        Zend_Gdata_Entry, and Zend_Gdata_Spreadsheets_ListEntry.
                        These classes represent entries retrieved from
                        services or used for constructing data to send to
                        services.  In addition to being able to set the
                        properties of an entry (such as the spreadsheet cell
                        value), you can use an entry object to send update
                        or delete requests to a service.  For example,
                        you can call <code>$entry->save()</code> to save
                        changes made to an entry back to service from which
                        the entry initiated, or <code>$entry->delete()</code>
                        to delete an entry from the server.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Other Data model classes - inheriting from
                        Zend_Gdata_App_Extension.  These include classes such
                        as Zend_Gdata_App_Extension_Title (representing the
                        atom:title XML element), Zend_Gdata_Extension_When
                        (representing the gd:when XML element used by the
                        GData Event "Kind"), and
                        Zend_Gdata_Extension_Cell (representing the gs:cell
                        XML element used by Google Spreadsheets).  These
                        classes are used purely to store the data retrieved
                        back from services and for constructing data to be
                        sent to services.  These include getters and setters 
                        such as
                        <code>setText()</code> to set the child text
                        node of an element, <code>getText()</code> to retrieve
                        the text node of an element, <code>getStartTime()</code>
                        to retrieve the start time attribute of a When element,
                        and other similiar methods.
                        The data model classes also include methods such as
                        <code>getDOM()</code> to retrieve a DOM representation
                        of the element and all children and
                        <code>transferFromDOM()</code> to construct a data
                        model representation of a DOM tree.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
    </sect2>

    <sect2 id="zend.gdata.introduction.services">
        <title>Interacting with Google Services</title>
        <para>
            Google data services are based upon the Atom Publishing Protocol
            (APP) and the Atom syndication format.  To interact with APP or
            Google services using the Zend_Gdata component, you need to use
            the service classes such as Zend_Gdata_App, Zend_Gdata,
            Zend_Gdata_Spreadsheets, etc.  These service classes provide
            methods to retrieve data from services as feeds, insert new
            entries into feeds, update entries, and delete entries.
        </para>

        <para>
            Note: A full example of working with Zend_Gdata is available in the
            <code>demos/Zend/Gdata</code> directory.  This example is runnable
            from the command-line, but the methods contained within are easily
            portable to a web application.
        </para>
    </sect2>

    <sect2 id="zend.gdata.introdduction.magicfactory">
        <title>Obtaining instances of Zend_Gdata classes</title>
        <para>
            The Zend Framework naming standards require that all classes be
            named based upon the directory structure in which they are located.
            For instance, extensions related to Spreadsheets are stored in:
            <code>Zend/Gdata/Spreadsheets/Extension/...</code> and, as a result
            of this, are named
            <code>Zend_Gdata_Spreadsheets_Extension_...</code>.
            This causes a lot of typing if you're trying to construct a new
            instance of a spreadsheet cell element!
        </para>
        <para>
            We've implemented a magic factory method in all service classes
            (such as Zend_Gdata_App, Zend_Gdata, Zend_Gdata_Spreadsheets) that
            should make constructing new instances of data model, query and
            other classes much easier.  This magic factory is implemented by
            using the magic <code>__call</code> method to intercept all attempts
            to call <code>$service->newXXX(arg1, arg2, ...)</code>.  Based off
            the value of XXX, a search is performed in all registered 'packages'
            for the desired class.  Here's some examples:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata_Spreadsheets');

$ss = new Zend_Gdata_Spreadsheets();

// creates a Zend_Gdata_App_Spreadsheets_CellEntry
$entry = $ss->newCellEntry();

// creates a Zend_Gdata_App_Spreadsheets_Extension_Cell
$cell = $ss->newCell();
$cell->setText('My cell value');
$cell->setRow('1');
$cell->setColumn('3');
$entry->cell = $cell;

// ... $entry can then be used to send an update to a Google Spreadsheet]]>
        </programlisting>

        <para>
            Each service class in the inheritance tree is responsible for
            registering the appropriate 'packages' (directories) which are to
            be searched when calling the magic factory method.
        </para>
    </sect2>


    <sect2 id="zend.gdata.introduction.authentication">
        <title>Google Data Client Authentication</title>
        <para>
            Most Google Data services require client applications to
            authenticate against the Google server before accessing
            private data, or saving or deleting data.
            There are two implementations of authentication for Google Data:
            <link linkend="zend.gdata.authsub">AuthSub</link> and
            <link linkend="zend.gdata.clientlogin">ClientLogin</link>.
            Zend_Gdata offers class interfaces for both of these methods.
        </para>

        <para>
            Most other types of queries against Google Data services do not
            require authentication.
        </para>

    </sect2>

    <sect2 id="zend.gdata.introduction.dependencies">
        <title>Dependencies</title>
        <para>
            Zend_Gdata makes use of
            <link linkend="zend.http.client">Zend_Http_Client</link> to send
            requests to google.com and fetch results.  The response to most
            Google Data requests is returned as a subclass of the
            Zend_Gdata_App_Feed or Zend_Gdata_App_Entry classes.
        </para>

        <para>
            Zend_Gdata assumes your PHP application is running on a host that
            has a direct connection to the Internet.
            The Zend_Gdata client operates by contacting Google Data servers.
        </para>

    </sect2>

    <sect2 id="zend.gdata.introduction.creation">
        <title>Creating a new Gdata client</title>

        <para>
            Create a new object of class Zend_Gdata_App, Zend_Gdata, or one
            of the subclasses available that offer helper methods for
            service-specific behavior.
        </para>

        <para>
            The single optional parameter to the Zend_Gdata_App constructor
            is an instance of
            <link linkend="zend.http.client">Zend_Http_Client</link>.
            If you don't pass this parameter, Zend_Gdata creates a default
            Zend_Http_Client object, which will not have associated
            credentials to access private feeds.  Specifying the
            Zend_Http_Client object also allows you to
            pass configuration options to that client object.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Http_Client');
Zend_Loader::loadClass('Zend_Gdata');

$client = new Zend_Http_Client();
$client->setConfig( ...options... );

$gdata = new Zend_Gdata($client);]]>
        </programlisting>

        <para>
            Also see the sections on authentication for methods to
            create an authenticated Zend_Http_Client object.
        </para>

    </sect2>

    <sect2 id="zend.gdata.introduction.parameters">
        <title>Common query parameters</title>

        <para>
            You can specify parameters to customize queries with Zend_Gdata.
            Query parameters are specified using subclasses of Zend_Gdata_Query.
            The Zend_Gdata_Query class includes methods to set all query
            parameters used throughout GData services.  Individual services,
            such as Spreadsheets, also provide query classes to defined
            parameters which are custom to the particular service and feeds.
            Spreadsheets includes a CellQuery class to query the Cell Feed
            and a ListQuery class to query the List Feed, as different
            query parameters are applicable to each of those feed types.

            The GData-wide parameters are described below.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    The <code>q</code> parameter specifies a full-text
                    query.  The value of the parameter is a string.
                </para>
                <para>
                    Set this parameter with the <code>setQuery()</code>
                    function.
                </para>
            </listitem>

            <listitem>
                <para>
                    The <code>alt</code> parameter specifies the feed type.
                    The value of the parameter can be
                    <code>atom</code>,
                    <code>rss</code>,
                    <code>json</code>,
                    or <code>json-in-script</code>.
                    If you don't specify this parameter, the default feed type
                    is <code>atom</code>.  NOTE: Only the output of the
                    atom feed format can be processed using
                    <code>Zend_Gdata</code>.
                    The <code>Zend_Http_Client</code> could be used to retrieve
                    feeds in other formats, using query URLs generated by the
                    <code>Zend_Gdata_Query</code> class and its subclasses.
                </para>
                <para>
                    Set this parameter with the <code>setAlt()</code>
                    function.
                </para>
            </listitem>

            <listitem>
                <para>
                    The <code>maxResults</code> parameter limits the number
                    of entries in the feed.  The value of the parameter is
                    an integer.  The number of entries returned in the feed
                    will not exceed this value.
                </para>
                <para>
                    Set this parameter with the <code>setMaxResults()</code>
                    function.
                </para>
            </listitem>

            <listitem>
                <para>
                    The <code>startIndex</code> parameter specifies the
                    ordinal number of the first entry returned in the feed.
                    Entries before this number are skipped.
                </para>
                <para>
                    Set this parameter with the <code>setStartIndex()</code>
                    function.
                </para>
            </listitem>

            <listitem>
                <para>
                    The <code>updatedMin</code> and <code>updatedMax</code>
                    parameters specify bounds on the entry date.
                    If you specify a value for <code>updatedMin</code>,
                    no entries that were updated earlier than the date
                    you specify are included in the feed.  Likewise
                    no entries updated after the date specified by
                    <code>updatedMax</code> are included.
                </para>
                <para>
                    You can use numeric timestamps, or a variety of
                    date/time string representations as the value for
                    these parameters.
                </para>
                <para>
                    Set this parameter with the <code>setUpdatedMin()</code>
                    and <code>setUpdatedMax()</code> functions.
                </para>
            </listitem>

        </itemizedlist>

        <para>
            There is a <code>get</code> function for each
            <code>set</code> function.
        </para>

        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Query();
$query->setMaxResults(10);
echo $query->getMaxResults();   // returns 10]]>
        </programlisting>

        <para>
            The Zend_Gdata class also implements "magic" getter and
            setter methods, so you can use the name of the parameter
            as a virtual member of the class.
        </para>

        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Query();
$query->maxResults = 10;
echo $query->maxResults;        // returns 10]]>
        </programlisting>

        <para>
            You can clear all parameters with the <code>resetParameters()</code>
            function.  This is useful to do if you reuse a Zend_Gdata
            object for multiple queries.
        </para>

        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Query();
$query->maxResults = 10;
// ...get feed...

$query->resetParameters();      // clears all parameters
// ...get a different feed...]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.gdata.introduction.getfeed">
        <title>Fetching a feed</title>

        <para>
            Use the <code>getFeed()</code> function to retrieve
            a feed from a specified URI.
            This function returns an instance of class specified
            as the second argument to getFeed, which defaults to
            Zend_Gdata_Feed.
        </para>

        <programlisting role="php"><![CDATA[<?php
$gdata = new Zend_Gdata();
$query = new Zend_Gdata_Query(
        'http://www.blogger.com/feeds/blogID/posts/default');
$query->setMaxResults(10);
$feed = $gdata->getFeed($query);]]>
        </programlisting>

        <para>
            See later sections for special functions in each
            helper class for Google Data services.  These
            functions help you to get feeds from the URI that is
            appropriate for the respective service.
        </para>

    </sect2>

    <sect2 id="zend.gdata.introduction.paging">
        <title>Working with multi-page feeds</title>
        
        <para>
            When retrieving a feed that contains a large number of entries,
            the feed may be broken up into many smaller "pages" of feeds. When
            this occurs, each page will contain a link to the next page in the
            series. This link can be accessed by calling
            <code>getLink('next')</code>. The following example shows how to
            retrieve the next page of a feed:
        </para>
        
        <programlisting role="php"><![CDATA[<?php
function getNextPage($feed) {
    $nextURL = $feed->getLink('next');
    if ($nextURL !== null) {
        return $gdata->getFeed($nextURL);
    } else {
        return null;
    }
}]]>
        </programlisting>

        <para>
            If you would prefer not to work with pages in your application,
            pass the first page of the feed into
            <code>Zend_Gdata_App::retrieveAllEntriesForFeed()</code>, which
            will consolidate all entries from each page into a single feed.
            This example shows how to use this function:
        </para>

        <programlisting role="php"><![CDATA[<?php
$gdata = new Zend_Gdata();
$query = new Zend_Gdata_Query(
        'http://www.blogger.com/feeds/blogID/posts/default');
$feed = $gdata->retrieveAllEntriesForFeed($gdata->getFeed($query));]]>
        </programlisting>

        <para>
            Keep in mind when calling this function that it may take a long
            time to complete on large feeds. You may need to increase PHP's
            execution time limit by calling <code>set_time_limit()</code>.
        </para>
        
    </sect2>

    <sect2 id="zend.gdata.introduction.usefeedentry">
        <title>Working with data in feeds and entries</title>

        <para>
            After retrieving a feed, you can read the data from the feed
            or the entries contained in the feed using either the accessors
            defined in each of the data model classes or the magic
            accessors.  Here's an example:
        </para>

        <programlisting role="php"><![CDATA[<?php
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
$gdata = new Zend_Gdata($client);
$query = new Zend_Gdata_Query(
        'http://www.blogger.com/feeds/blogID/posts/default');
$query->setMaxResults(10);
$feed = $gdata->getFeed($query);
foreach ($feed as $entry) {
    // using the magic accessor
    echo 'Title: ' . $entry->title->text;
    // using the defined accessors
    echo 'Content: ' . $entry->getContent()->getText();
}]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.gdata.introduction.updateentry">
        <title>Updating entries</title>

        <para>
            After retrieving an entry, you can update that entry and save
            changes back to the server.  Here's an example:
        </para>

        <programlisting role="php"><![CDATA[<?php
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
$gdata = new Zend_Gdata($client);
$query = new Zend_Gdata_Query(
        'http://www.blogger.com/feeds/blogID/posts/default');
$query->setMaxResults(10);
$feed = $gdata->getFeed($query);
foreach ($feed as $entry) {
    // update the title to append 'NEW'
    echo 'Old Title: ' . $entry->title->text;
    $entry->title->text = $entry->title->text . ' NEW';

    // update the entry on the server
    $newEntry = $entry->save();
    echo 'New Title: ' . $newEntry->title->text;
}]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.gdata.introduction.post">
        <title>Posting entries to Google servers</title>

        <para>
            The Zend_Gdata object has a function <code>post()</code>
            with which you can upload data to save new entries
            to Google Data services.
        </para>

        <para>
            You can use the data model classes for each service to
            construct the appropriate entry to post to Google's
            services.  The <code>post()</code> function will
            accept a child of Zend_Gdata_App_Entry as data to
            post to the service.  The method returns a child
            of Zend_Gdata_App_Entry which represents the state
            of the entry as it was returned from the server.
        </para>

        <para>
            Alternatively, you could construct the XML structure
            for an entry as a string and pass the string to the
            <code>post()</code> function.
        </para>

        <programlisting role="php"><![CDATA[<?php
$gdata = new Zend_Gdata($authenticatedHttpClient);

$entry = $gdata->newEntry();
$entry->title = $gdata->newTitle('Playing football at the park');
$content = $gdata->newContent('We will visit the park and play a few football matches');
$content->setType('text');
$entry->content = $content;

$entryResult = $gdata->insertEntry($entry,
        'http://www.blogger.com/feeds/blogID/posts/default');

echo 'The <id> of the resulting entry is: ' . $entryResult->id->text;]]>
        </programlisting>

        <para>
            To post entries, you must be using an authenticated
            Zend_Http_Client that you created using the Zend_Gdata_AuthSub
            or Zend_Gdata_ClientLogin classes.
        </para>

    </sect2>

    <sect2 id="zend.gdata.introduction.delete">
        <title>Deleting entries on Google servers</title>

        <para>
            Option 1: The Zend_Gdata object has a function <code>delete()</code>
            with which you can delete entries from Google Data
            services.  Pass the edit URL value from
            a feed entry to the <code>delete()</code> method.
        </para>

        <para>
            Option 2: Alternatively, you can call <code>$entry->delete()</code>
            on an entry retrieved from a Google service.
        </para>

        <programlisting role="php"><![CDATA[<?php
$gdata = new Zend_Gdata($authenticatedHttpClient);
// a Google Data feed
$feedUri = ...;
$feed = $gdata->getFeed($feedUri);
foreach ($feed as $feedEntry) {
    // Option 1 - delete the entry directly
    $feedEntry->delete();
    // Option 2 - delete the entry by passing the edit URL to $gdata->delete()
    // $gdata->delete($feedEntry->getEditLink()->href);
}]]>
        </programlisting>

        <para>
            To delete entries, you must be using an authenticated
            Zend_Http_Client that you created using the Zend_Gdata_AuthSub
            or Zend_Gdata_ClientLogin classes.
        </para>

    </sect2>

</sect1>
<sect1 id="zend.gdata.authsub">
    <title>Authenticating with AuthSub</title>

    <para>
        The AuthSub mechanism enables you to write web applications
        that acquire authenticated access Google Data services,
        without having to write code that handles user credentials.
    </para>

    <para>
        See <ulink url="http://code.google.com/apis/accounts/AuthForWebApps.html">http://code.google.com/apis/accounts/AuthForWebApps.html</ulink>
        for more information about Google Data AuthSub authentication.
    </para>

    <para>
        The Google documentation says the ClientLogin mechanism is appropriate
        for "installed applications" whereas the AuthSub mechanism is
        for "web applications."  The difference is that AuthSub requires
        interaction from the user, and a browser interface that can react
        to redirection requests.  The ClientLogin solution uses PHP code to
        supply the account credentials; the user is not required to enter her
        credentials interactively.
    </para>

    <para>
        The account credentials supplied via the AuthSub mechanism are
        entered by the user of the web application.  Therefore they must be
        account credentials that are known to that user.
    </para>

    <note>
        <title>Registered applications</title>
        <para>
            Zend_Gdata currently does not support use of secure tokens, because
            the AuthSub authentication does not support passing a digital certificate
            to acquire a secure token.
        </para>
    </note>

    <sect2 id="zend.gdata.authsub.login">
        <title>Creating an AuthSub authenticated Http Client</title>

        <para>
            Your PHP application should provide a hyperlink to the
            Google URL that performs authentication.  The static function
            <code>Zend_Gdata_AuthSub::getAuthSubTokenUri()</code>
            provides the correct URL.  The arguments to this function include
            the URL to your PHP applicaion so that Google can redirect the
            user's browser back to your application after the user's
            credentials have been verified.
        </para>

        <para>
            After Google's authentication server redirects the user's browser
            back to the current application, a GET request parameter is set,
            called <code>token</code>.
            The value of this parameter is a single-use token that can be
            used for authenticated access.
            This token can be converted into a multi-use token and stored
            in your session.
        </para>

        <para>
            Then use the token value in a call to
            <code>Zend_Gdata_AuthSub::getHttpClient()</code>.
            This function returns an instance of Zend_Http_Client,
            with appropriate headers set so that subsequent requests your
            application submits using that Http Client are also authenticated.
        </para>

        <para>
            Below is an example of PHP code for a web application
            to acquire authentication to use the Google Calendar service
            and create a Zend_Gdata client object using that authenticated
            Http Client.
        </para>

        <programlisting role="php"><![CDATA[<?php
$my_calendar = 'http://www.google.com/calendar/feeds/default/private/full';

if (!isset($_SESSION['cal_token'])) {
    if (isset($_GET['token'])) {
        // You can convert the single-use token to a session token.
        $session_token =  Zend_Gdata_AuthSub::getAuthSubSessionToken($_GET['token']);
        // Store the session token in our session.
        $_SESSION['cal_token'] = $session_token;
    } else {
        // Display link to generate single-use token
        $googleUri = Zend_Gdata_AuthSub::getAuthSubTokenUri(
            'http://'. $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'],
            $my_calendar, 0, 1);
        echo "Click <a href='$googleUri'>here</a> to authorize this application.";
        exit();
    }
}

// Create an authenticated HTTP Client to talk to Google.
$client = Zend_Gdata_AuthSub::getHttpClient($_SESSION['cal_token']);

// Create a Gdata object using the authenticated Http Client
$cal = new Zend_Gdata_Calendar($client);]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.gdata.authsub.logout">
        <title>Revoking AuthSub authentication</title>

        <para>
            To terminate the authenticated status of a given token, use the
            <code>Zend_Gdata_AuthSub::AuthSubRevokeToken()</code>
            static function.  Otherwise, the token is still valid for
            some time.
        </para>

        <programlisting role="php"><![CDATA[<?php
// Carefully construct this value to avoid application security problems.
$php_self = htmlentities(substr($_SERVER['PHP_SELF'], 0, strcspn($_SERVER['PHP_SELF'], "\n\r")), ENT_QUOTES);

if (isset($_GET['logout'])) {
    Zend_Gdata_AuthSub::AuthSubRevokeToken($_SESSION['cal_token']);
    unset($_SESSION['cal_token']);
    header('Location: ' . $php_self);
    exit();
}]]>
        </programlisting>

    <note>
        <title>Security notes</title>
        <para>
            The treatment of the <code>$php_self</code> variable in the
            example above is a general security guideline, it is not
            specific to Zend_Gdata.  You should always filter content you
            output to http headers.
        </para>
        <para>
            Regarding revoking authentication tokens, it is recommended to
            do this when the user is finished with her Google Data session.
            The possibility that someone can intercept the token and use
            it for malicious purposes is very small, but nevertheless it is
            a good practice to terminate authenticated access to any service.
        </para>
    </note>

    </sect2>

</sect1>
<sect1 id="zend.gdata.calendar">
    <title>Using Google Calendar</title>
    <para>
        You can use the
        <code>Zend_Gdata_Calendar</code>
        class to view, create, update, and delete events in the online Google Calendar service.
    </para>
    <para>
        See
        <ulink url="http://code.google.com/apis/calendar/overview.html">http://code.google.com/apis/calendar/overview.html</ulink>
        for more information about the Google Calendar API.
    </para>
    <sect2 id="zend.gdata.calendar.connecting">
        <title>Connecting To The Calendar Service</title>
        <para>
            The Google Calendar API, like all GData APIs, is based off of the Atom Publishing Protoco (APP),
            an XML based format for managing web-based resources. Traffic between a client and the Google
            Calendar servers occurs over HTTP and allows for both authenticated and unauthenticated connections.
        </para>
        <para>
            Before any transactions can occur, this connection needs to be made. Creating a connection to the
            calendar servers involves two steps: creating an HTTP client and binding a
            <code>Zend_Gdata_Calendar</code>
            service instance to that client.
        </para>
        <sect3 id="zend.gdata.calendar.connecting.authentication">
            <title>Authentication</title>
            <para>
                The Google Calendar API allows access to both public and private calendar feeds. Public feeds
                do not require authentication, but are read-only and offer reduced functionality. Private feeds
                offers the most complete functionality but requires an authenticated connection to the calendar
                servers. There are three authentication schemes that are supported by Google Calendar:
            </para>
            <itemizedlist>
                <listitem>
                    <para>
                        <firstterm>ClientAuth</firstterm>
                        provides direct username/password authentication to the
                        calendar servers. Since this scheme requires that users
                        provide your application with their password, this
                        authentication is only recommended when other
                        authentication schemes are insufficient.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>AuthSub</firstterm>
                        allows authentication to the calendar servers via a
                        Google proxy server. This provides the same level of
                        convenience as ClientAuth but without the security
                        risk, making this an ideal choice for web-based
                        applications.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>MagicCookie</firstterm>
                        allows authentication based on a semi-random URL
                        available from within the Google Calendar interface.
                        This is the simplest authentication scheme to
                        implement, but requires that users manually retrieve
                        their secure URL before they can authenticate, doesn't
                        provide access to calendar lists, and is limited to
                        read-only access.
                    </para>
                </listitem>
            </itemizedlist>
            <para>
                The
                <code>Zend_Gdata</code>
                library provides support for all three authentication schemes.
                The rest of this chapter will assume that you are familiar the
                authentication schemes available and how to create an
                appropriate authenticated connection. For more information,
                please see section the
                <link linkend="zend.gdata.introduction.authentication">Authentication section</link>
                of this manual or the
                <ulink url="http://code.google.com/apis/gdata/auth.html">Authentication Overview in the Google Data API Developer's Guide</ulink>.
            </para>
        </sect3>
        <sect3 id="zend.gdata.calendar.connecting.service">
            <title>Creating A Service Instance</title>
            <para>
                In order to interact with Google Calendar, this library provides the
                <code>Zend_Gdata_Calendar</code> service class. This class provides a common interface to the
                Google Data and Atom Publishing Protocol models and assists in marshaling requests to and from
                the calendar servers.
            </para>
            <para>
                Once deciding on an authentication scheme, the next step is to create an instance of
                <code>Zend_Gdata_Calendar</code>. The class constructor takes an instance of
                <code>Zend_Http_Client</code> as a single argument. This provides an interface for AuthSub
                and ClientAuth authentication, as both of these require creation of a special authenticated
                HTTP client. If no arguments are provided, an unauthenticated instance of
                <code>Zend_Http_Client</code> will be automatically created.
            </para>
            <para>The example below shows how to create a Calendar service class using ClientAuth authentication:</para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata');
Zend_Loader::loadClass('Zend_Gdata_ClientLogin');
Zend_Loader::loadClass('Zend_Gdata_Calendar');
Zend_Loader::loadClass('Zend_Http_Client');

// Parameters for ClientAuth authentication
$service = Zend_Gdata_Calendar::AUTH_SERVICE_NAME;
$user = "sample.user@gmail.com";
$pass = "pa$$w0rd";

// Create an authenticated HTTP client
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);

// Create an instance of the Calendar service
$service = new Zend_Gdata_Calendar($client);]]>
            </programlisting>
            <para>A Calendar service using AuthSub can be created in a similar, though slightly more lengthy fashion:</para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata');
Zend_Loader::loadClass('Zend_Gdata_AuthSub');
Zend_Loader::loadClass('Zend_Gdata_Calendar');
Zend_Loader::loadClass('Zend_Http_Client');

/** Retrieve the current URL so that the AuthSub server knows where to
 * redirect the user after authentication is complete.
 */
function getCurrentUrl()
{
    global $_SERVER;

    // Filter php_self to avoid a security vulnerability.
    $php_request_uri = htmlentities(substr($_SERVER['REQUEST_URI'], 0, strcspn($_SERVER['REQUEST_URI'], "\n\r")), ENT_QUOTES);

    if (isset($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) == 'on') {
        $protocol = 'https://';
    } else {
        $protocol = 'http://';
    }
    $host = $_SERVER['HTTP_HOST'];
    if ($_SERVER['HTTP_PORT'] != '' &&
        (($protocol == 'http://' && $_SERVER['HTTP_PORT'] != '80') ||
        ($protocol == 'https://' && $_SERVER['HTTP_PORT'] != '443'))) {
        $port = ':' . $_SERVER['HTTP_PORT'];
    } else {
        $port = '';
    }
    return $protocol . $host . $port . $php_request_uri;
}

/** Obtain an AuthSub authenticated HTTP client, redirecting the user to the
 *  AuthSub server to login if necessary.
 */
function getAuthSubHttpClient()
{
    global $_SESSION, $_GET;

    // If there is no AuthSub session or one-time token waiting for us,
    // redirect the user to the AuthSub server to get one.
    if (!isset($_SESSION['sessionToken']) && !isset($_GET['token'])) {
        // Parameters to give to AuthSub server
        $next = getCurrentUrl();
        $scope = "http://www.google.com/calendar/feeds/";
        $secure = false;
        $session = true;

        // Redirect the user to the AuthSub server to sign in

        $authSubUrl = Zend_Gdata_AuthSub::getAuthSubTokenUri($next, $scope, $secure, $session);
         header("HTTP/1.0 307 Temporary redirect");

         header("Location: " . $authSubUrl);

         exit();
    }

    // Convert an AuthSub one-time token into a session token if needed
    if (!isset($_SESSION['sessionToken']) && isset($_GET['token'])) {
        $_SESSION['sessionToken'] =
            Zend_Gdata_AuthSub::getAuthSubSessionToken($_GET['token']);
    }

    // At this point we are authenticated via AuthSub and can obtain an
    // authenticated HTTP client instance

    // Create an authenticated HTTP client
    $client = Zend_Gdata_AuthSub::getHttpClient($_SESSION['sessionToken']);
    return $client;
}

// -> Script execution begins here <-

// Make sure http://code.google.com/apis/gdata/reference.html#Queriesthat the user has a valid session, so we can record the
// AuthSub session token once it is available.
session_start();

// Create an instance of the Calendar service, redirecting the user
// to the AuthSub server if necessary.
$service = new Zend_Gdata_Calendar(getAuthSubHttpClient());]]>
            </programlisting>
            <para>Finally, an unauthenticated server can be created for use with either public feeds or MagicCookie authentication:</para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata');
Zend_Loader::loadClass('Zend_Gdata_Calendar');


// Create an instance of the Calendar service using an unauthenticated HTTP client

$service = new Zend_Gdata_Calendar();]]>
            </programlisting>
            <para>
                Note that MagicCookie authentication is not supplied with the HTTP connection, but is instead
                specified along with the desired visibility when submitting queries. See the section on retrieving
                events below for an example.
            </para>
        </sect3>
    </sect2>
    <sect2 id="zend.gdata.calendar_retrieval">
        <title>Retrieving A Calendar List</title>
        <para>
            The calendar service supports retrieving a list of calendars for the authenticated user. This is
            the same list of calendars which are displayed in the Google Calendar UI, except those marked as
            "<code>hidden</code>" are also available.
        </para>
        <para>
            The calendar list is always private and must be accessed over an authenticated connection. It is
            not possible to retrieve another user's calendar list and it cannot be accessed using MagicCookie
            authentication. Attempting to access a calendar list without holding appropriate credentials will
            fail and result in a 401 (Authentication Required) status code.
        </para>
        <programlisting role="php"><![CDATA[<?php
$service = Zend_Gdata_Calendar::AUTH_SERVICE_NAME;
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
$service = new Zend_Gdata_Calendar($client);

try {
    $listFeed= $service->getCalendarListFeed();
} catch (Zend_Gdata_App_Exception $e) {
    echo "Error: " . $e->getResponse();
}]]>
        </programlisting>
        <para>
            Calling <code>getCalendarListFeed()</code> creates a new instance of
            <code>Zend_Gdata_Calendar_ListFeed</code> containing each available calendar as an instance of
            <code>Zend_Gdata_Calendar_ListEntry</code>. After retrieving the feed, you can use the iterator
            and accessors contained within the feed to inspect the enclosed calendars.
        </para>
        <programlisting role="php"><![CDATA[<?php
echo "<h1>Calendar List Feed</h1>";
echo "<ul>";
foreach ($listFeed as $calendar) {
    echo "<li>" . $calendar->title . " (Event Feed: " . $calendar->id . ")</li>";
}
echo "</ul>";]]>
        </programlisting>
    </sect2>
    <sect2 id="zend.gdata.event_retrieval">
        <title>Retrieving Events</title>
        <para>
            Like the list of calendars, events are also retrieved using the <code>Zend_Gdata_Calendar</code>
            service class. The event list returned is of type <code>Zend_Gdata_Calendar_EventFeed</code>
            and contains each event as an instance of <code>Zend_Gdata_Calendar_EventEntry</code>. As before,
            the iterator and accessors contained within the event feed instance allow inspection of individual
            events.
        </para>
        <sect3 id="zend.gdata.event_retrieval.queries">
            <title>Queries</title>
            <para>
                When retrieving events using the Calendar API, specially constructed query URLs are used to
                describe what events should be returned. The <code>Zend_Gdata_Calendar_EventQuery</code>
                class simplifies this task by automatically constructing a query URL based on provided
                parameters. A full list of these parameters is available at the
                <ulink url="http://code.google.com/apis/gdata/reference.html#Queries">Queries section of the Google Data APIs Protocol Reference</ulink>
                . However, there are three parameters that are worth special attention:
            </para>
            <itemizedlist>
                <listitem>
                    <para>
                        <firstterm>User</firstterm>
                        is used to specify the user whose calendar is being
                        searched for, and is specified as an email address. If
                        no user is provided, "default" will be used instead to
                        indicate the currently authenticated user (if
                        authenticated).
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>Visibility</firstterm>
                        specifies whether a users public or private calendar
                        should be searched. If using an unauthenticated session
                        and no MagicCookie is available, only the public feed
                        will be available.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>Projection</firstterm>
                        specifies how much data should be returned by the
                        server and in what format. In most cases you will want
                        to use the "full" projection. Also available is the
                        "basic" projection, which places most meta-data into
                        each event's content field as human readable text, and
                        the "composite" projection which includes complete text
                        for any comments alongside each event. The "composite"
                        view is often much larger than the "full" view.
                    </para>
                </listitem>
            </itemizedlist>
        </sect3>
        <sect3 id="zend.gdata.event_retrieval.start_time">
            <title>Retrieving Events In Order Of Start Time</title>
            <para>
                The example below illustrates the use of the <code>Zend_Gdata_Query</code> class and specifies
                the private visibility feed, which requires that an authenticated connection is available to
                the calendar servers. If a MagicCookie is being used for authentication, the visibility should
                be instead set to "<code>private-magicCookieValue</code>", where magicCookieValue is the random
                string obtained when viewing the private XML address in the Google Calendar UI. Events are
                requested chronologically by start time and only events occurring in the future are returned.
            </para>
            <programlisting role="php"><![CDATA[<?php
$query = $service->newEventQuery();
$query->setUser('default');
// Set to $query->setVisibility('private-magicCookieValue') if using MagicCookie auth
$query->setVisibility('private');
$query->setProjection('full');
$query->setOrderby('starttime');
$query->setFutureevents('true');

// Retrieve the event list from the calendar server
try {
    $eventFeed = $service->getCalendarEventFeed($query);
} catch (Zend_Gdata_App_Exception $e) {
    echo "Error: " . $e->getResponse();
}

// Iterate through the list of events, outputting them as an HTML list
echo "<ul>";
foreach ($eventFeed as $event) {
    echo "<li>" . $event->title . " (Event ID: " . $event->id . ")</li>";
}
echo "</ul>";]]>
            </programlisting>
            <para>
                Additional properties such as ID, author, when, event status, visibility, web content,
                and content, among others are available within <code>Zend_Gdata_Calendar_EventEntry</code>.
                Refer to the
                <ulink url="http://framework.zend.com/apidoc/core/">Zend Framework API Documentation</ulink>
                and the
                <ulink url="http://code.google.com/apis/gdata/reference.html">Calendar Protocol Reference</ulink>
                for a complete list.
            </para>
        </sect3>
        <sect3 id="zend.gdata.event_retrieval.date_range">
            <title>Retrieving Events In A Specified Date Range</title>
            <para>
                To print out all events within a certain range, for example from December 1, 2006 through
                December 15, 2007, add the following two lines to the previous sample. Take care to remove
                "<code>$query->setFutureevents('true')</code>", since´<code>futureevents</code> will override
                <code>startMin</code> and <code>startMax</code>.
            </para>
            <programlisting role="php"><![CDATA[<?php
$query->setStartMin('2006-12-01');
$query->setStartMax('2006-12-16');]]>
            </programlisting>
            <para>
                Note that <code>startMin</code> is inclusive whereas <code>startMax</code>
                is exclusive. As a result, only events through 2006-12-15 23:59:59 will be returned.
            </para>
        </sect3>
        <sect3 id="zend.gdata.event_retrieval.fulltext">
            <title>Retrieving Events By Fulltext Query</title>
            <para>
                To print out all events which contain a specific word, for example "dogfood", use the
                <code>setQuery()</code>
                method when creating the query.
            </para>
            <programlisting role="php"><![CDATA[<?php
$query->setQuery("dogfood");]]>
            </programlisting>
        </sect3>
        <sect3 id="zend.gdata.event_retrieval.individual">
            <title>Retrieving Individual Events</title>
            <para>
                Individual events can be retrieved by specifying their event ID as part of the query. Instead
                of calling <code>getCalendarEventFeed()</code>, <code>getCalendarEventEntry()</code>
                should be called instead.
            </para>
            <programlisting role="php"><![CDATA[<?php
$query = $service->newEventQuery();
$query->setUser('default');
$query->setVisibility('private');
$query->setProjection('full');
$query->setEvent($eventId);

try {
    $event = $service->getCalendarEventEntry($query);
} catch (Zend_Gdata_App_Exception $e) {
    echo "Error: " . $e->getResponse();
}]]>
            </programlisting>
            <para>
                In a similar fashion, if the event URL is known, it can be passed directly into
                <code>getCalendarEntry()</code>
                to retrieve a specific event. In this case, no query object is required since the event
                URL contains all the necessary information to retrieve the event.
            </para>
            <programlisting role="php"><![CDATA[<?php
$eventURL = "http://www.google.com/calendar/feeds/default/private/full/g829on5sq4ag12se91d10uumko";

try {
    $event = $service->getCalendarEventEntry($eventURL);
} catch (Zend_Gdata_App_Exception $e) {
    echo "Error: " . $e->getResponse();
}]]>
            </programlisting>
        </sect3>
    </sect2>
    <sect2 id="zend.gdata.calendar.creating_events">
        <title>Creating Events</title>
        <sect3 id="zend.gdata.calendar.creating_events.single">
            <title>Creating Single-Occurrence Events</title>
            <para>
                Events are added to a calendar by creating an instance of <code>Zend_Gdata_EventEntry</code>
                and populating it with the appropriate data. The calendar service instance
                (<code>Zend_Gdata_Calendar</code>) is then used to used to transparently covert the event
                into XML and POST it to the calendar server. Creating events requires either an AuthSub
                or ClientAuth authenticated connection to the calendar server.
            </para>
            <para>At a minimum, the following attributes should be set:</para>
            <itemizedlist>
                <listitem>
                    <para>
                        <firstterm>Title</firstterm>
                        provides the headline that will appear above the event
                        within the Google Calendar UI.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>When</firstterm>
                        indicates the duration of the event and, optionally,
                        any reminders that are associated with it. See the next
                        section for more information on this attribute.
                    </para>
                </listitem>
            </itemizedlist>
            <para>Other useful attributes that may optionally set include:</para>
            <itemizedlist>
                <listitem>
                    <para>
                        <firstterm>Author</firstterm>
                        provides information about the user who created the
                        event.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>Content</firstterm>
                        provides additional information about the event which
                        appears when the event details are requested from
                        within Google Calendar.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>EventStatus</firstterm>
                        indicates whether the event is confirmed, tentative, or
                        canceled.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>Hidden</firstterm>
                        removes the event from the Google Calendar UI.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>Transparency</firstterm>
                        indicates whether the event should be consume time on
                        the user's free/busy list.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>WebContent</firstterm>
                        allows links to external content to be provided within
                        an event.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>Where</firstterm>
                        indicates the location of the event.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>Visibility</firstterm>
                        allows the event to be hidden from the public event
                        lists.
                    </para>
                </listitem>
            </itemizedlist>
            <para>
                For a complete list of event attributes, refer to the
                <ulink url="http://framework.zend.com/apidoc/core/">Zend Framework API Documentation</ulink>
                and the
                <ulink url="http://code.google.com/apis/gdata/reference.html">Calendar Protocol Reference</ulink>.
                Attributes that can contain multiple values, such as where, are implemented as arrays and need
                to be created accordingly. Be aware that all of these attributes require objects as parameters.
                Trying instead to populate them using strings or primitives will result in errors during conversion
                to XML.
            </para>
            <para>
                Once the event has been populated, it can be uploaded to the calendar server by passing it as an
                argument to the calendar service's <code>insertEvent()</code> function.
            </para>
            <programlisting role="php"><![CDATA[<?php
// Create a new entry using the calendar service's magic factory method
$event= $service->newEventEntry();

// Populate the event with the desired information
// Note that each attribute is crated as an instance of a matching class
$event->title = $service->newTitle("My Event");
$event->where = array($service->newWhere("Mountain View, California"));
$event->content = $service->newContent(" This is my awesome event. RSVP required.");

// Set the date using RFC 3339 format.
$startDate = "2008-01-20";
$startTime = "14:00";
$endDate = "2008-01-20";
$endTime = "16:00";
$tzOffset = "-08";

$when = $service->newWhen();
$when->startTime = "{$startDate}T{$startTime}:00.000{$tzOffset}:00";
$when->endTime = "{$endDate}T{$endTime}:00.000{$tzOffset}:00";
$event->when = array($when);

// Upload the event to the calendar server
// A copy of the event as it is recorded on the server is returned
$newEvent = $service->insertEvent($event);]]>
            </programlisting>
        </sect3>
        <sect3 id="zend.gdata.calendar.creating_events.schedulers_reminders">
            <title>Event Schedules and Reminders</title>
            <para>
                An event's starting time and duration are determined by the value of its when property, which
                contains the properties <code>startTime</code>, <code>endTime</code>, and <code>valueString</code>.
                <code>StartTime</code> and <code>EndTime</code> control the duration of the event, while
                <code>valueString</code> provides a way to store a friendly, human readable version of the
                duration such as "This Afternoon". Note that even when using <code>valueString</code>,
                <code>startTime</code> and <code>endTime</code> still must be be set to valid values.
            </para>
            <para>
                All-day events can be scheduled by specifying only the date omitting the time when setting
                <code>startTime</code>
                and
                <code>endTime</code>
                . Likewise, zero-duration events can be specified by omitting the
                <code>endTime</code>
                . In all cases, date/time values should be provided in
                <ulink url="http://www.ietf.org/rfc/rfc3339.txt">RFC3339</ulink>
                format.
            </para>
            <programlisting role="php"><![CDATA[<?php
// Schedule the event to occur on December 05, 2007 at 2 PM PST (UTC-8) with a duration of one hour.
$when = $service->newWhen();
$when->startTime = "2007-12-05T14:00:00-08:00";
$when->endTime="2007-12-05T15:00:00:00-08:00";

// Specify a optional human readable value for the above date
$when->valueString = "This Afternoon";

// Apply the when property to an event
$event->when = $when;]]>
            </programlisting>
            <para>
                The <code>when</code> attribute also controls when reminders are sent to a user. Reminders
                are stored in an array and each event may have up to find reminders associated with it.
            </para>
            <para>
                For a <code>reminder</code> to be valid, it needs to have two attributes set: <code>method</code>
                and a time. <code>Method</code> can accept one of the following strings: "alert", "email",
                or "sms". The time should be entered as an integer and can be set with either the property
                <code>minutes</code>, <code>hours</code>, <code>days</code>, or <code>absoluteTime</code>.
                However, a valid request may only have one of these attributes set. If a mixed time is
                desired, convert to the most precise unit available. For example, 1 hour and 30 minutes
                should be entered as 90 minutes.
            </para>
            <programlisting role="php"><![CDATA[<?php
// Create a new reminder object. It should be set send an email message to the user 10 minutes beforehand.
$reminder = $service->newReminder();
$reminder->method = "email";
$reminder->minutes = "10";

// Apply the reminder to an existing event's when property
$when = $event->when[0];
$when->reminders = array($reminder);]]>
            </programlisting>
        </sect3>
        <sect3 id="zend.gdata.calendar.creating_events.recurring">
            <title>Creating Recurring Events</title>
            <para>
                Recurring events are created the same way as single-occurrence events, except a recurrence
                attribute should be provided instead of a where attribute. The recurrence attribute should
                hold a string describing the event's recurrence pattern using properties defined in the
                iCalendar standard (<ulink url="http://www.ietf.org/rfc/rfc2445.txt">RFC 2445</ulink>).
            </para>
            <para>
                Exceptions to the recurrence pattern will usually be specified by a distinct
                <code>recurrenceException</code> attribute. However, the iCalendar standard provides a
                secondary format for defining recurrences, and the possibility that either may be used
                must be accounted for.
            </para>
            <para>
                Due to the complexity of parsing recurrence patterns, further information on this them
                is outside the scope of this document. However, more information can be found in the
                <ulink url="http://code.google.com/apis/gdata/elements.html#gdRecurrence">Common Elements section of the Google Data APIs Developer Guide</ulink>
                , as well as in RFC 2445.
            </para>
            <programlisting role="php"><![CDATA[<?php
 // Create a new entry using the calendar service's magic factory method
$event= $service->newEventEntry();

// Populate the event with the desired information
// Note that each attribute is crated as an instance of a matching class
$event->title = $service->newTitle("My Recurring Event");
$event->where = array($service->newWhere("Palo Alto, California"));
$event->content = $service->newContent(" This is my other awesome event, occurring all-day every Tuesday from 2007-05-01 until 207-09-04. No RSVP required.");

// Set the duration and frequency by specifying a recurrence pattern.

$recurrence = "DTSTART;VALUE=DATE:20070501\r\n" .
        "DTEND;VALUE=DATE:20070502\r\n" .
        "RRULE:FREQ=WEEKLY;BYDAY=Tu;UNTIL=20070904\r\n";

$event->recurrence = $service->newRecurrence($recurrence);

// Upload the event to the calendar server
// A copy of the event as it is recorded on the server is returned
$newEvent = $service->insertEvent($event);]]>
            </programlisting>
        </sect3>
        <sect3 id="zend.gdata.calendar.creating_events.quickadd">
            <title>Using QuickAdd</title>
            <para>
                QuickAdd is a feature which allows events to be created using free-form text entry.
                For example, the string "Dinner at Joe's Diner on Thursday" would create an event with
                the title "Dinner", location "Joe's Diner", and date "Thursday". To take advantage of
                QuickAdd, create a new <code>QuickAdd</code> property set to "true" and store the
                freeform text as a <code>content</code> property.
            </para>
            <programlisting role="php"><![CDATA[<?php
// Create a new entry using the calendar service's magic factory method
$event= $service->newEventEntry();

// Populate the event with the desired information
$event->content= $service->newContent("Dinner at Joe's Diner on Thursday");
$event->quickAdd = $service->newQuickAdd("true");

// Upload the event to the calendar server
// A copy of the event as it is recorded on the server is returned
$newEvent = $service->insertEvent($event);]]>
            </programlisting>
        </sect3>
    </sect2>
    <sect2 id="zend.gdata.calendar.modifying_events">
        <title>Modifying Events</title>
        <para>
            Once an instance of an event has been obtained, the event's attributes can be locally modified
            in the same way as when creating an event. Once all modifications are complete, calling the event's
            <code>save()</code> method will upload the changes to the calendar server and return a copy of
            the event as it was created on the server.
        </para>
        <para>
            In the event another user has modified the event since the local copy was retrieved,
            <code>save()</code> will fail and the server will return a 409 (Conflict) status code.
            To resolve this a fresh copy of the event must be retrieved from the server before attempting
            to resubmit any modifications.
        </para>
        <programlisting role="php"><![CDATA[<?php
// Get the first event in the user's event list
$event = $eventFeed[0];

// Change the title to a new value
$event->title = $service->newTitle("Woof!");

// Upload the changes to the server
try {
    $event->save();
} catch (Zend_Gdata_App_Exception $e) {
    echo "Error: " . $e->getResponse();
}]]>
        </programlisting>
    </sect2>
    <sect2 id="zend.gdata.calendar.deleting_events">
        <title>Deleting Events</title>
        <para>
            Calendar events can be deleted either by calling the calendar service's
            <code>delete()</code>
            method and providing the edit URL of an event or by calling an existing event's own
            <code>delete()</code>
            method.
        </para>
        <para>
            In either case, the deleted event will still show up on a user's private event feed if an
            <code>updateMin</code> query parameter is provided. Deleted events can be distinguished
            from regular events because they will have their <code>eventStatus</code>
            property set to "http://schemas.google.com/g/2005#event.canceled".
        </para>
        <programlisting role="php"><![CDATA[<?php
// Option 1: Events can be deleted directly
$event->delete();]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
// Option 2: Events can be deleted supplying the edit URL of the event to the calendar service, if known
$service->delete($event->getEditLink()->href);]]>
        </programlisting>
    </sect2>
    <sect2 id="zend.gdata.calendar.comments">
        <title>Accessing Event Comments</title>
        <para>
            When using the full event view, comments are not directly stored within an entry. Instead,
            each event contains a URL to it's associated comment feed which must be manually requested.
        </para>
        <para>
            Working with comments is fundamentally similar to working with events, with the only
            significant difference being that a different feed and event class should be used and that´
            the additional meta-data for events such as where and when does not exist for comments.
            Specifically, the comment's author is stored in the <code>author</code>
            property, and the comment text is stored in the <code>content</code> property.
        </para>
        <programlisting role="php"><![CDATA[<?php
// Extract the comment URL from the first event in a user's feed list
$event = $eventFeed[0];
$commentUrl = $event->comments->feedLink->url;

// Retrieve the comment list for the event
try {
$commentFeed = $service->getFeed($commentUrl);
} catch (Zend_Gdata_App_Exception $e) {
    echo "Error: " . $e->getResponse();
}

// Output each comment as an HTML list
echo "<ul>";
foreach ($commentFeed as $comment) {
    echo "<li><em>Comment By: " . $comment->author->name "</em><br/>" . $comment->content . "</li>";
}
echo "</ul>";]]>
        </programlisting>
    </sect2>
</sect1>
<sect1 id="zend.gdata.clientlogin">
    <title>Authenticating with ClientLogin</title>

    <para>
        The ClientLogin mechanism enables you to write PHP application
        that acquire authenticated access to Google Services,
        specifying a user's credentials in the Http Client.
    </para>

    <para>
        See
        <ulink url="http://code.google.com/apis/accounts/AuthForInstalledApps.html"> http://code.google.com/apis/accounts/AuthForInstalledApps.html </ulink>
        for more information about Google Data ClientLogin authentication.
    </para>

    <para>
        The Google documentation says the ClientLogin mechanism is appropriate
        for "installed applications" whereas the AuthSub mechanism is
        for "web applications."  The difference is that AuthSub requires
        interaction from the user, and a browser interface that can react
        to redirection requests.  The ClientLogin solution uses PHP code to
        supply the account credentials; the user is not required to enter her
        credentials interactively.
    </para>

    <para>
        The account credentials supplied via the ClientLogin mechanism must
        be valid credentials for Google services, but they are not required
        to be those of the user who is using the PHP application.
    </para>

    <sect2 id="zend.gdata.clientlogin.login">
        <title>Creating a ClientLogin authenticated Http Client</title>

        <para>
            The process of creating an authenticated Http client using
            the ClientLogin mechanism is to call the static function
            <code>Zend_Gdata_ClientLogin::getHttpClient()</code>
            and pass the Google account credentials in plain text.
            The return value of this function is an object of class
            Zend_Http_Client.
        </para>

        <para>
            The optional third parameter is the name of the Google Data
            service.  For instance, this can be 'cl' for Google Calendar.
            The default is "xapi", which is recognized by Google Data
            servers as a generic service name.
        </para>

        <para>
            The optional fourth parameter is an instance of Zend_Http_Client.
            This allows you to set options in the client, such as proxy
            server settings.  If you pass <code>null</code> for this
            parameter, a generic Zend_Http_Client object is created.
        </para>

        <para>
            The optional fifth parameter is a short string that Google Data
            servers use to identify the client application for logging
            purposes.  By default this is string "Zend-ZendFramework";
        </para>

        <para>
          The optional sixth parameter is a string ID for a 
          <trademark>CAPTCHA</trademark> challenge that has been issued by 
          the server. It is only necessary when logging in after receiving 
          a <trademark>CAPTCHA</trademark> challenge from a previous
          login attempt.
        </para>

        <para>
          The optional seventh parameter is a user's response to a 
          <trademark>CAPTCHA</trademark> challenge that has been issued by 
          the server. It is only necessary when logging in after receiving 
          a <trademark>CAPTCHA</trademark> challenge from a previous
          login attempt.
        </para>

        <para>
            Below is an example of PHP code for a web application
            to acquire authentication to use the Google Calendar service
            and create a Zend_Gdata client object using that authenticated
            Zend_Http_Client.
        </para>

        <programlisting role="php"><![CDATA[<?php
// Enter your Google account credentials
$email = 'johndoe@gmail.com';
$passwd = 'xxxxxxxx';
try {
   $client = Zend_Gdata_ClientLogin::getHttpClient($email, $passwd, 'cl');
} catch (Zend_Gdata_App_CaptchaRequiredException $cre) {
    echo 'URL of CAPTCHA image: ' . $cre->getCaptchaUrl() . "\n";
    echo 'Token ID: ' . $cre->getCaptchaToken() . "\n"; 
} catch (Zend_Gdata_App_AuthException $ae) {
   echo 'Problem authenticating: ' . $ae->exception() . "\n";
}

$cal = new Zend_Gdata_Calendar($client);]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.gdata.clientlogin.terminating">
        <title>Terminating a ClientLogin authenticated Http Client</title>

        <para>
            There is no method to revoke ClientLogin authentication as there
            is in the AuthSub token-based solution.  The credentials used
            in the ClientLogin authentication are the login and password
            to a Google account, and therefore these can be used repeatedly
            in the future.
        </para>

    </sect2>

</sect1>
<sect1 id="zend.gdata.docs">
    <title>Using Google Documents List Data API</title>

    <para>
        The Google Documents List Data API allows client applications to 
        upload documents to Google Documents and list them in the form of 
        Google Data API ("GData") feeds. Your client application can request
        a list of a user's documents, and query the content in an existing 
        document.
    </para>

    <para>
        See
        <ulink url="http://code.google.com/apis/documents/overview.html">http://code.google.com/apis/documents/overview.html</ulink>
        for more information about the Google Documents List API.
    </para>

    <sect2 id="zend.gdata.docs.listdocuments">
        <title>Get a List of Documents</title>
        <para>
            You can get a list of the Google Documents for a particular user by using
            the <code>getDocumentListFeed</code> method of the docs
            service.  The service will return a
            <code>Zend_Gdata_Docs_DocumentListFeed</code> object
            containing a list of documents associated with the authenticated
            user.
        </para>

        <programlisting role="php"><![CDATA[<?php
$service = Zend_Gdata_Docs::AUTH_SERVICE_NAME;
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
$docs = new Zend_Gdata_Docs($client);
$feed = $docs->getDocumentListFeed();]]>
        </programlisting>

        <para>
        The resulting <code>Zend_Gdata_Docs_DocumentListFeed</code> object 
        represents the response from the server. This feed contains a list of
        <code>Zend_Gdata_Docs_DocumentListEntry</code> objects 
        (<code>$feed->entries</code>), each of which represents a single 
        Google Document.                                
        </para>
    </sect2>

    <sect2 id="zend.gdata.docs.creating">
        <title>Upload a Document</title>
        <para>
            You can create a new Google Document by uploading a word
            processing document, spreadsheet, or presentation. This example
            is from the interactive Docs.php sample which comes with the
            library. It demonstrates uploading a file and printing
            information about the result from the server.
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Upload the specified document
 *
 * @param Zend_Gdata_Docs $docs The service object to use for communicating
 *     with the Google Documents server.
 * @param boolean $html True if output should be formatted for display in a
 *     web browser.
 * @param string $originalFileName The name of the file to be uploaded. The
 *     mime type of the file is determined from the extension on this file
 *     name. For example, test.csv is uploaded as a comma seperated volume
 *     and converted into a spreadsheet.
 * @param string $temporaryFileLocation (optional) The file in which the
 *     data for the document is stored. This is used when the file has been
 *     uploaded from the client's machine to the server and is stored in
 *     a temporary file which does not have an extension. If this parameter
 *     is null, the file is read from the originalFileName.
 */
function uploadDocument($docs, $html, $originalFileName,
                        $temporaryFileLocation) {
  $fileToUpload = $originalFileName;
  if ($temporaryFileLocation) {
    $fileToUpload = $temporaryFileLocation;
  }

  // Upload the file and convert it into a Google Document. The original
  // file name is used as the title of the document and the mime type
  // is determined based on the extension on the original file name.
  $newDocumentEntry = $docs->uploadFile($fileToUpload, $originalFileName,
      null, Zend_Gdata_Docs::DOCUMENTS_LIST_FEED_URI);

  echo "New Document Title: ";

  if ($html) {
      // Find the URL of the HTML view of this document.
      $alternateLink = '';
      foreach ($newDocumentEntry->link as $link) {
          if ($link->getRel() === 'alternate') {
              $alternateLink = $link->getHref();
          }
      }
      // Make the title link to the document on docs.google.com.
      echo "<a href=\"$alternateLink\">\n";
  }
  echo $newDocumentEntry->title."\n";
  if ($html) {echo "</a>\n";}
}]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.gdata.docs.queries">
        <title>Searching the documents feed</title>
        <para>
            You can search the Document List using some of the <ulink
            url="http://code.google.com/apis/gdata/reference.html#Queries">standard
            Google Data API query parameters</ulink>. Categories are used to 
            restrict the 
            type of document (word processor document, spreadsheet) returned.
            The full-text query string is used to search the content of all 
            the documents. More detailed information on parameters specific 
            to the Documents List can be found in the <ulink 
            url="http://code.google.com/apis/documents/reference.html#Parameters">Documents List Data API Reference Guide</ulink>.
        </para>
    
        <sect3 id="zend.gdata.docs.listwpdocuments">
            <title>Get a List of Word Processing Documents</title>
            <para>
                You can also request a feed containing all of your documents of a specific type. For example, to see a list of your work processing documents, you would perform a category query as follows.
            </para>
    
            <programlisting role="php"><![CDATA[<?php
$feed = $docs->getDocumentListFeed(
    'http://docs.google.com/feeds/documents/private/full/-/document');]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.gdata.docs.listspreadsheets">
            <title>Get a List of Spreadsheets</title>
            <para>
                To request a list of your Google Spreadsheets, use the following category query:
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $docs->getDocumentListFeed(
    'http://docs.google.com/feeds/documents/private/full/-/spreadsheet');]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.gdata.docs.textquery">
            <title>Performing a text query</title>
            <para>
                You can search the content of documents by using a
                <code>Zend_Gdata_Docs_Query</code> in your request. A Query object
                can be used to construct the query URI, with the search term being
                passed in as a parameter. Here is an example method which queries
                the documents list for documents which contain the search string:
            </para>
            <programlisting role="php"><![CDATA[<?php
$docsQuery = new Zend_Gdata_Docs_Query();
$docsQuery->setQuery($query);
$feed = $client->getDocumentListFeed($docsQuery);]]>
            </programlisting>
        </sect3>

    </sect2>

</sect1>
<sect1 id="zend.gdata.exception">
    <title>Catching Gdata Exceptions</title>

    <para>
        The <code>Zend_Gdata_App_Exception</code> class is a base class
        for exceptions thrown by Zend_Gdata.  You can catch any exception
        thrown by Zend_Gdata by catching Zend_Gdata_App_Exception.
    </para>

    <programlisting role="php"><![CDATA[<?php
try {
    $client = Zend_Gdata_ClientLogin::getHttpClient($username, $password);
} catch(Zend_Gdata_App_Exception $ex) {
    // Report the exception to the user
    die($ex->getMessage());
}]]>
    </programlisting>

    <para>
        The following exception subclasses are used by Zend_Gdata:

        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Gdata_App_AuthException</code>
                    indicates that the user's account credentials were not valid.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Gdata_App_BadMethodCallException</code>
                    indicates that a method was called for a service
                    that does not support the method.  For example,
                    the CodeSearch service does not support <code>post()</code>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Gdata_App_HttpException</code>
                    indicates that an HTTP request was not successful.
                    Provides the ability to get the full Zend_Http_Response
                    object to determine the exact cause of the failure in
                    cases where <code>$e->getMessage()</code> does not provide
                    enough details.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Gdata_App_InvalidArgumentException</code>
                    is thrown when the application provides a value that
                    is not valid in a given context.  For example,
                    specifying a Calendar visibility value of "banana",
                    or fetching a Blogger feed without specifying
                    any blog name.
                </para>
              </listitem>
              <listitem>
                <para>
                  <code>Zend_Gdata_App_CaptchaRequiredException</code>
                  is thrown when a ClientLogin attempt receives a
                  <trademark>CAPTCHA</trademark> challenge from the 
                  authentication service. This exception contains a token 
                  ID and a URL to a <trademark>CAPTCHA</trademark> 
                  challenge image. The image is a visual puzzle that 
                  should be displayed to the user. After
                  collecting the user's response to the challenge 
                  image, the response can be included with the next 
                  ClientLogin attempt.The user can alternatively be 
                  directed to this website:
                  <ulink url="https://www.google.com/accounts/DisplayUnlockCaptcha"/>
                  Further information can be found in the 
                  <link linkend="zend.gdata.clientlogin">ClientLogin documentation</link>.
                </para>
              </listitem>
        </itemizedlist>
    </para>

    <para>
        You can use these exception subclasses to handle specific exceptions
        differently.  See the API documentation for information on which
        exception subclasses are thrown by which methods in Zend_Gdata.
    </para>

    <programlisting role="php"><![CDATA[<?php
try {
    $client = Zend_Gdata_ClientLogin::getHttpClient($username, $password, $service);
} catch(Zend_Gdata_App_AuthException $authEx) {
    // The user's credentials were incorrect.
    // It would be appropriate to give the user a second try.
    ...
} catch(Zend_Gdata_App_HttpException $httpEx) {
    // Google Data servers cannot be contacted.
    die($httpEx->getMessage);}]]>
    </programlisting>

</sect1>
<sect1 id="zend.gdata.gapps">
    <title>Using Google Apps Provisioning</title>
    
    <para>
        Google Apps is a service which allows domain administrators to offer
        their users managed access to Google services such as Mail, Calendar,
        and Docs &amp; Spreadsheets. The Provisioning API offers a programatic
        interface to configure this service. Specifically, this API allows
        administrators the ability to create, retrieve, update, and delete
        user accounts, nicknames, and email lists.
    </para>
    
    <para>
        This library implements version 2.0 of the Provisioning API. Access to
        your account via the Provisioning API must be manually enabled for
        each domain using the Google Apps control panel. Only certain
        account types are able to enable this feature.
    </para>
    
    <para>
        For more information on the Google Apps Provisioning API, including
        instructions for enabling API access, refer to the <ulink
        url="http://code.google.com/apis/calendar/overview.html">Provisioning
        API V2.0 Reference</ulink>.
    </para>
    
    <note>
        <title>Authentication</title>
        <para>
            The Provisioning API does not support authentication via AuthSub
            and anonymous access is not permitted. All HTTP connections must
            be authenticated using ClientAuth authentication.
            </para>
    </note>
    
    <sect2 id="zend.gdata.gapps.domain">
        <title>Setting the current domain</title>
        
        <para>
            In order to use the Provisioning API, the domain being
            administered needs to be specified in all request URIs. In order
            to ease development, this information is stored within both the
            Gapps service and query classes to use when constructing
            requests.
        </para>
        
        <sect3 id="zend.gdata.gapps.domain.service">
            <title>Setting the domain for the service class</title>
            
            <para>
                To set the domain for requests made by the service class,
                either call <code>setDomain()</code> or specify the domain
                when instantiating the service class. For example:
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$domain = "example.com";
$gdata = new Zend_Gdata_Gapps($client, $domain);
?>]]></programlisting>
        
        </sect3>
        
        <sect3 id="zend.gdata.gapps.domain.query">
            <title>Setting the domain for query classes</title>
            
            <para>
                Setting the domain for requests made by query classes is
                similar to setting it for the service class-either call
                <code>setDomain()</code> or specify the domain when creating
                the query. For example:
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$domain = "example.com";
$query = new Zend_Gdata_Gapps_UserQuery($domain, $arg);
?>]]></programlisting>
            
            <para>
                When using a service class factory method to create a query,
                the service class will automatically set the query's domain to
                match its own domain. As a result, it is not necessary to
                specify the domain as part of the constructor arguments.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$domain = "example.com";
$gdata = new Zend_Gdata_Gapps($client, $domain);
$query = $gdata->newUserQuery($arg);
?>]]></programlisting>
            
        </sect3>
        
    </sect2>
    
    <sect2 id="zend.gdata.gapps.users">
        <title>Interacting with users</title>
        
        <para>
            Each user account on a Google Apps hosted domain is represented as
            an instance of Zend_Gdata_Gapps_UserEntry. This class provides
            access to all account properties including name, username,
            password, access rights, and current quota.
        </para>
        
        <sect3 id="zend.gdata.gapps.users.creating">
            <title>Creating a user account</title>
            
            <para>
                User accounts can be created by calling the
                <code>createUser()</code> convenience method:
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$gdata->createUser('foo', 'Random', 'User', '••••••••');
?>]]></programlisting>
                        
            <para>
                Users can also be created by instantiating UserEntry,
                providing a username, given name, family name, and password,
                then calling <code>insertUser()</code> on a service object to
                upload the entry to the server.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$user = $gdata->newUserEntry();
$user->login = $gdata->newLogin();
$user->login->username = 'foo';
$user->login->password = '••••••••';
$user->name = $gdata->newName();
$user->name->givenName = 'Random';
$user->name->familyName = 'User';
$user = $gdata->insertUser($user);
?>]]></programlisting>
            
            <para>
                The user's password should normally be provided as cleartext.
                Optionally, the password can be provided as an SHA-1 digest if
                <code>login->passwordHashFunction</code> is set to 'SHA-1'.
            </para>
            
        </sect3>
        
        <sect3 id="zend.gdata.gapps.users.retrieving">
            <title>Retrieving a user account</title>
            
            <para>
                Individual user accounts can be retrieved by calling the
                <code>retrieveUser()</code> convenience method. If the user is
                not found, <code>null</code> will be returned.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$user = $gdata->retrieveUser('foo');

echo 'Username: ' . $user->login->userName . "\n";
echo 'Given Name: ' . $user->login->givenName . "\n";
echo 'Family Name: ' . $user->login->familyName . "\n";
echo 'Suspended: ' . ($user->login->suspended ? 'Yes' : 'No') . "\n";
echo 'Admin: ' . ($user->login->admin ? 'Yes' : 'No') . "\n"
echo 'Must Change Password: ' . ($user->login->changePasswordAtNextLogin ? 'Yes' : 'No') . "\n";
echo 'Has Agreed To Terms: ' . ($user->login->agreedToTerms ? 'Yes' : 'No') . "\n";
?>]]></programlisting>
            
            <para>
                Users can also be retrieved by creating an
                instance of Zend_Gdata_Gapps_UserQuery, setting its username
                property to equal the username of the user that is to be
                retrieved, and calling <code>getUserEntry()</code> on a
                service object with that query.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$query = $gdata->newUserQuery('foo');
$user = $gdata->getUserEntry($query);

echo 'Username: ' . $user->login->userName . "\n";
echo 'Given Name: ' . $user->login->givenName . "\n";
echo 'Family Name: ' . $user->login->familyName . "\n";
echo 'Suspended: ' . ($user->login->suspended ? 'Yes' : 'No') . "\n";
echo 'Admin: ' . ($user->login->admin ? 'Yes' : 'No') . "\n"
echo 'Must Change Password: ' . ($user->login->changePasswordAtNextLogin ? 'Yes' : 'No') . "\n";
echo 'Has Agreed To Terms: ' . ($user->login->agreedToTerms ? 'Yes' : 'No') . "\n";
?>]]></programlisting>
            
            <para>
                If the specified user cannot be located a ServiceException
                will be thrown with an error code of
                Zend_Gdata_Gapps_Error::ENTITY_DOES_NOT_EXIST.
                ServiceExceptions will be covered in <xref
                linkend="zend.gdata.gapps.exceptions" />.
            </para>
            
        </sect3>
        
        <sect3 id="zend.gdata.gapps.users.retrievingAll">
            <title>Retrieving all users in a domain</title>
            
            <para>
                To retrieve all users in a domain, call the
                <code>retrieveAllUsers()</code> convenience method.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->retrieveAllUsers();

foreach ($feed as $user) {
    echo "  * " . $user->login->username . ' (' . $user->name->givenName .
        ' ' . $user->name->familyName . ")\n";
}
?>]]></programlisting>
            
            <para>
                This will create a Zend_Gdata_Gapps_UserFeed object which
                holds each user on the domain. 
            </para>
            
            <para>
                Alternatively, call <code>getUserFeed()</code> with no 
                options. Keep in mind that on larger
                domains this feed may be paged by the server. For more
                information on paging, see <xref
                linkend="zend.gdata.introduction.paging" />.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->getUserFeed();

foreach ($feed as $user) {
    echo "  * " . $user->login->username . ' (' . $user->name->givenName .
        ' ' . $user->name->familyName . ")\n";
}

?>]]></programlisting>
                        
        </sect3>
        
        <sect3 id="zend.gdata.gapps.users.updating">
            <title>Updating a user account</title>
            
            <para>
                The easiest way to update a user account is to retrieve the
                user as described in the previous sections, make any desired
                changes, then call <code>save()</code> on that user. Any
                changes made will be propagated to the server.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$user = $gdata->retrieveUser('foo');
$user->name->givenName = 'Foo';
$user->name->familyName = 'Bar';
$user = $user->save();
?>]]></programlisting>
            
            <sect4 id="zend.gdata.gapps.users.updating.resettingPassword">
                <title>Resetting a user's password</title>
                
                <para>
                    A user's password can be reset to a new value by updating
                    the <code>login->password</code> property.
                </para>
                
                <programlisting role="php"><![CDATA[<?php
$user = $gdata->retrieveUser('foo');
$user->login->password = '••••••••';
$user = $user->save();
?>]]></programlisting>
                
                <para>
                    Note that it is not possible to recover a password in this
                    manner as stored passwords are not made available via the
                    Provisioning API for security reasons.
                </para>
                
            </sect4>
            
            <sect4 id="zend.gdata.gapps.users.updating.forcingPasswordChange">
                <title>Forcing a user to change their password</title>

                <para>
                    A user can be forced to change their password at their
                    next login by setting the
                    <code>login->changePasswordAtNextLogin</code> property to
                    <code>true</code>.
                </para>

                <programlisting role="php"><![CDATA[<?php
$user = $gdata->retrieveUser('foo');
$user->login->changePasswordAtNextLogin = true;
$user = $user->save();
?>]]></programlisting>

                <para>
                    Similarly, this can be undone by setting the
                    <code>login->changePasswordAtNextLogin</code> property to
                    <code>false</code>.
                </para>

            </sect4>
            
            <sect4 id="zend.gdata.gapps.users.updating.suspendingAccount">
                <title>Suspending a user account</title>

                <para>
                    Users can be restricted from logging in without deleting
                    their user account by instead
                    <emphasis>suspending</emphasis> their user account.
                    Accounts can be suspended or restored by using the
                    <code>suspendUser()</code> and <code>restoreUser()</code>
                    convenience methods:
                </para>

                <programlisting role="php"><![CDATA[<?php
$gdata->suspendUser('foo');
$gdata->restoreUser('foo');
?>]]></programlisting>

                <para>
                    Alternatively, you can set the UserEntry's
                    <code>login->suspended</code> property to
                    <code>true</code>.
                </para>

                <programlisting role="php"><![CDATA[<?php
$user = $gdata->retrieveUser('foo');
$user->login->suspended = true;
$user = $user->save();
?>]]></programlisting>

                <para>
                    To restore the user's access, set the
                    <code>login->suspended</code> property to
                    <code>false</code>.
                </para>

            </sect4>

            <sect4 id="zend.gdata.gapps.users.updating.grantingAdminRights">
                <title>Granting administrative rights</title>

                <para>
                    Users can be granted the ability to administer your domain
                    by setting their <code>login->admin</code> property to
                    <code>true</code>.
                </para>

                <programlisting role="php"><![CDATA[<?php
$user = $gdata->retrieveUser('foo');
$user->login->admin = true;
$user = $user->save();
?>]]></programlisting>

                <para>
                    And as expected, setting a user's <code>login->admin</code>
                    property to <code>false</code> revokes their
                    administrative rights.
                </para>

            </sect4>
            
        </sect3>
        
        <sect3 id="zend.gdata.gapps.users.deleting">
            <title>Deleting user accounts</title>
            
            <para>
                Deleting a user account to which you already hold a UserEntry
                is a simple as calling <code>delete()</code> on that
                entry.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$user = $gdata->retrieveUser('foo');
$user->delete();
?>]]></programlisting>
            
            <para>
                If you do not have access to a UserEntry object for an
                account, use the <code>deleteUser()</code> convenience method.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$gdata->deleteUser('foo');
?>]]></programlisting>
            
        </sect3>
        
    </sect2>
    
    <sect2 id="zend.gdata.gapps.nicknames">
        <title>Interacting with nicknames</title>
        
        <para>
            Nicknames serve as email aliases for existing users. Each nickname
            contains precisely two key properties: its name and its owner. Any
            email addressed to a nickname is forwarded to the user who owns
            that nickname.
        </para>
        
        <para>
            Nicknames are represented as an instances of
            Zend_Gdata_Gapps_NicknameEntry.
        </para>
        
        <sect3 id="zend.gdata.gapps.nicknames.creating">
            <title>Creating a nickname</title>
            
            <para>
                Nicknames can be created by calling the
                <code>createNickname()</code> convenience method:
            </para>

            <programlisting role="php"><![CDATA[<?php
$gdata->createNickname('foo', 'bar');
?>]]></programlisting>

            <para>
                Nicknames can also be created by instantiating NicknameEntry,
                providing the nickname with a name and an owner, then calling
                <code>insertNickname()</code> on a service object to upload
                the entry to the server.
            </para>

            <programlisting role="php"><![CDATA[<?php
$nickname = $gdata->newNicknameEntry();
$nickname->login = $gdata->newLogin('foo');
$nickname->nickname = $gdata->newNickname('bar');
$nickname = $gdata->insertNickname($nickname);
?>]]></programlisting>
        
        </sect3>
        
        <sect3 id="zend.gdata.gapps.nicknames.retrieving">
            <title>Retrieving a nickname</title>
            
            <para>
                Nicknames can be retrieved by calling the
                <code>retrieveNickname()</code> convenience method. This will
                return <code>null</code> if a user is not found.
            </para>

            <programlisting role="php"><![CDATA[<?php
$nickname = $gdata->retrieveNickname('bar');

echo 'Nickname: ' . $nickname->nickname->name . "\n";
echo 'Owner: ' . $nickname->login->username . "\n";
?>]]></programlisting>

            <para>
                Individual nicknames can also be retrieved by creating an
                instance of Zend_Gdata_Gapps_NicknameQuery, setting its
                nickname property to equal the nickname that is to be
                retrieved, and calling <code>getNicknameEntry()</code> on a
                service object with that query.
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = $gdata->newNicknameQuery('bar');
$nickname = $gdata->getNicknameEntry($query);

echo 'Nickname: ' . $nickname->nickname->name . "\n";
echo 'Owner: ' . $nickname->login->username . "\n";
?>]]></programlisting>

            <para>
                As with users, if no corresponding nickname is found a
                ServiceException will be thrown with an error code of
                Zend_Gdata_Gapps_Error::ENTITY_DOES_NOT_EXIST. Again, these
                will be discussed in <xref linkend="zend.gdata.gapps.exceptions"
                />.
            </para>

        </sect3>

        <sect3 id="zend.gdata.gapps.nicknames.retrievingUser">
            <title>Retrieving all nicknames for a user</title>

            <para>
                To retrieve all nicknames associated with a given user, call
                the convenience method <code>retrieveNicknames()</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->retrieveNicknames('foo');

foreach ($feed as $nickname) {
    echo '  * ' . $nickname->nickname->name . "\n";
}
?>]]></programlisting>

            <para>
                This will create a Zend_Gdata_Gapps_NicknameFeed object which
                holds each nickname associated with the specified user.
            </para>

            <para>
                Alternatively, create a new Zend_Gdata_Gapps_NicknameQuery,
                set its username property to the desired user, and submit the
                query by calling <code>getNicknameFeed()</code> on a service
                object.
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = $gdata->newNicknameQuery();
$query->setUsername('foo');
$feed = $gdata->getNicknameFeed($query);

foreach ($feed as $nickname) {
    echo '  * ' . $nickname->nickname->name . "\n";
}
?>]]></programlisting>

        </sect3>

        <sect3 id="zend.gdata.gapps.nicknames.retrievingAll">
            <title>Retrieving all nicknames in a domain</title>
            <para>
                To retrieve all nicknames in a feed, simply call the
                convenience method <code>retrieveAllNicknames()</code>
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->retrieveAllNicknames();

foreach ($feed as $nickname) {
    echo '  * ' . $nickname->nickname->name . ' => ' . 
        $nickname->login->username . "\n";
}
?>]]></programlisting>

            <para>
                This will create a Zend_Gdata_Gapps_NicknameFeed object which
                holds each nickname on the domain.
            </para>
            
            <para>
                Alternatively, call <code>getNicknameFeed()</code> on a 
                service object with no arguments.
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->getNicknameFeed();

foreach ($feed as $nickname) {
    echo '  * ' . $nickname->nickname->name . ' => ' . 
        $nickname->login->username . "\n";
}
?>]]></programlisting>

        </sect3>

        <sect3 id="zend.gdata.gapps.nicknames.deleting">
            <title>Deleting a nickname</title>

            <para>
                Deleting a nickname to which you already hold a NicknameEntry
                for is a simple as calling <code>delete()</code> on that
                entry.
            </para>

            <programlisting role="php"><![CDATA[<?php
$nickname = $gdata->retrieveNickname('bar');
$nickname->delete();
?>]]></programlisting>

            <para>
                For nicknames which you do not hold a NicknameEntry for, use
                the <code>deleteNickname()</code> convenience method.
            </para>

            <programlisting role="php"><![CDATA[<?php
$gdata->deleteNickname('bar');
?>]]></programlisting>

        </sect3>
            
    </sect2>
        
    <sect2 id="zend.gdata.gapps.emailLists">
        <title>Interacting with email lists</title>
        
        <para>
            Email lists allow several users to retrieve email addressed to a
            single email address. Users do not need to be a
            member of this domain in order to subscribe to an email list
            provided their complete email address (including domain) is used.
        </para>
        
        <para>
            Each email list on a domain is represented as an instance of
            Zend_Gdata_Gapps_EmailListEntry.
        </para>
        
        <sect3 id="zend.gdata.gapps.emailLists.creating">
            <title>Creating an email list</title>

            <para>
                Email lists can be created by calling the
                <code>createEmailList()</code> convenience method:
            </para>

            <programlisting role="php"><![CDATA[<?php
$gdata->createEmailList('friends');
?>]]></programlisting>

            <para>
                Email lists can also be created by instantiating
                EmailListEntry, providing a name for the list, then calling
                <code>insertEmailList()</code> on a service object to upload
                the entry to the server.
            </para>

            <programlisting role="php"><![CDATA[<?php
$list = $gdata->newEmailListEntry();
$list->emailList = $gdata->newEmailList('friends');
$list = $gdata->insertEmailList($list);
?>]]></programlisting>

        </sect3>
        
        <sect3 id="zend.gdata.gapps.emailList.retrieve">
            <title>Retrieving all email lists to which a recipient is
            subscribed</title>

            <para>
                To retrieve all email lists to which a particular recipient is
                subscribed, call the <code>retrieveEmailLists()</code>
                convenience method:
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->retrieveEmailLists('baz@somewhere.com');

foreach ($feed as $list) {
    echo '  * ' . $list->emailList->name . "\n";
}
?>]]></programlisting>

            <para>
                This will create a Zend_Gdata_Gapps_EmailListFeed object which
                holds each email list associated with the specified recipient.
            </para>
            
            <para>
                Alternatively, create a new Zend_Gdata_Gapps_EmailListQuery,
                set its recipient property to the desired email address, and
                submit the query by calling <code>getEmailListFeed()</code> on
                a service object.
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = $gdata->newEmailListQuery();
$query->setRecipient('baz@somewhere.com');
$feed = $gdata->getEmailListFeed($query);

foreach ($feed as $list) {
    echo '  * ' . $list->emailList->name . "\n";
}
?>]]></programlisting>

        </sect3>

        <sect3 id="zend.gdata.gapps.emailLists.retrievingAll">
            <title>Retrieving all email lists in a domain</title>

            <para>
                To retrieve all email lists in a domain, call the convenience
                method <code>retrieveAllEmailLists()</code>.
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->retrieveAllEmailLists();

foreach ($feed as $list) {
    echo '  * ' . $list->emailList->name . "\n";
}
?>]]></programlisting>

            <para>
                This will create a Zend_Gdata_Gapps_EmailListFeed object which
                holds each email list on the domain.
            </para>
            
            <para>
                Alternatively, call <code>getEmailListFeed()</code> on a
                service object with no arguments.
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->getEmailListFeed();

foreach ($feed as $list) {
    echo '  * ' . $list->emailList->name . "\n";
}
?>]]></programlisting>
            
        </sect3>
        
        <sect3 id="zend.gdata.gapps.emailList.deleting">
            <title>Deleting an email list</title>

            <para>
                To delete an email list, call the deleteEmailList()
                convenience method:
            </para>

            <programlisting role="php"><![CDATA[<?php
$gdata->deleteEmailList('friends');
?>]]></programlisting>

        </sect3>
        
    </sect2>
    
    <sect2 id="zend.gdata.gapps.emailListRecipients">
        <title>Interacting with email list recipients</title>
        
        <para>
            Each recipient subscribed to an email list is represented by an
            instance of Zend_Gdata_Gapps_EmailListRecipient. Through this
            class, individual recipients can be added and removed from email
            lists.
        </para>
        
        <sect3 id="zend.gdata.gapps.emailListRecipients.adding">
            <title>Adding a recipient to an email list</title>
            
            <para>
                To add a recipient to an email list, simply call the
                <code>addRecipientToEmailList()</code> convenience method:
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$gdata->addRecipientToEmailList('bar@somewhere.com', 'friends');
?>]]></programlisting>
            
        </sect3>
        
        <sect3 id="zend.gdata.gapps.emailListRecipients.retrieving">
            <title>Retrieving the list of subscribers to an email list</title>

            <para>
                The convenience method <code>retrieveAllRecipients()</code>
                can be used retrieve teh list of subscribers to an email list:
            </para>

            <programlisting role="php"><![CDATA[<?php
$feed = $gdata->retrieveAllRecipients('friends');

foreach ($feed as $recipient) {
    echo '  * ' . $recipient->who->email . "\n";
}
?>]]></programlisting>
            
            <para>
                Alternatively, construct a new EmailListRecipientQuery, set
                its emailListName property to match the desired email list,
                and call <code>getEmailListRecipientFeed()</code> on a service
                object.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$query = $gdata->newEmailListRecipientQuery();
$query->setEmailListName('friends');
$feed = $gdata->getEmailListRecipientFeed($query);

foreach ($feed as $recipient) {
    echo '  * ' . $recipient->who->email . "\n";
}
?>]]></programlisting>
            
            <para>
                This will create a Zend_Gdata_Gapps_EmailListRecipientFeed
                object which holds each recipient for the selected email list.
            </para>
            
        </sect3>
        
        <sect3 id="zend.gdata.gapps.emailListRecipients.removing">
            <title>Removing a recipient from an email list</title>
            
            <para>
                To remove a recipient from an email list, call the
                <code>removeRecipientFromEmailList()</code> convenience
                method:
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$gdata->removeRecipientFromEmailList('baz@somewhere.com', 'friends');
?>]]></programlisting>
            
        </sect3>
        
    </sect2>
    
    <sect2 id="zend.gdata.gapps.exceptions">
        <title>Handling errors</title>
        
        <para>
            In addition to the standard suite of exceptions thrown by
            Zend_Gdata, requests using the Provisioning API may also throw a
            <code>Zend_Gdata_Gapps_ServiceException</code>. These exceptions
            indicate that a API specific error occurred which prevents the
            request from completing.
        </para>
        
        <para>
            Each ServiceException instance may hold one or more Error objects.
            Each of these objects contains an error code, reason, and
            (optionally) the input which triggered the exception. A complete
            list of known error codes is provided in the Zend Framework API
            documentation under Zend_Gdata_Gapps_Error. Additionally, the
            authoritative error list is available online at <ulink
            url="http://code.google.com/apis/apps/gdata_provisioning_api_v2.0_reference.html#appendix_d">Google
            Apps Provisioning API V2.0 Reference: Appendix D</ulink>.
        </para>
        
        <para>
            While the complete list of errors received is available within
            ServiceException as an array by calling <code>getErrors()</code>,
            often it is convenient to know if one specific error occurred. For
            these cases the presence of an error can be determined by calling
            <code>hasError()</code>.
        </para>
        
        <para>
            The following example demonstrates how to detect if a requested
            resource doesn't exist and handle the fault gracefully:
        </para>
        
        <programlisting role="php"><![CDATA[<?php
function retrieveUser ($username) {
    $query = $gdata->newUserQuery($username);
    try {
        $user = $gdata->getUserEntry($query);
    } catch (Zend_Gdata_Gapps_ServiceException $e) {
        // Set the user to null if not found
        if ($e->hasError(Zend_Gdata_Gapps_Error::ENTITY_DOES_NOT_EXIST)) {
            $user = null;
        } else {
            throw $e;
        }
    }
    return $user;
}
?>]]></programlisting>
        
    </sect2>
    
</sect1>
<sect1 id="zend.gdata.gbase">
    <title>Using Google Base</title>
    <para>
        The Google Base data API is designed to enable developers to do two things:
        <itemizedlist>
            <listitem>
                <para>
                    Query Google Base data to create applications and mashups.
                </para>
                </listitem>
            <listitem>
                <para>
                    Input and manage Google Base items programmatically.
                </para>
            </listitem>
        </itemizedlist>
    </para>
    <para>
        There are two item feeds: snippets feed and customer items feeds. The snippets feed contains all Google Base data and is available to anyone to query against without a need for authentication. The customer items feed is a customer-specific subset of data and only a customer/owner can access this feed to insert, update, or delete their own data. Queries are constructed the same way against both types of feeds.
    </para>
    <para>
        See <ulink url="http://code.google.com/apis/base/">http://code.google.com/apis/base</ulink>
        for more information about the Google Base API.
    </para>
    <sect2 id="zend.gdata.gbase.connect">
        <title>Connect To The Base Service</title>
        <para>
            The Google Base API, like all GData APIs, is based off of the Atom Publishing Protocol (APP), an XML based format for managing web-based resources. Traffic between a client and the Google Base servers occurs over HTTP and allows for both authenticated and unauthenticated connections.
        </para>
        <para>
            Before any transactions can occur, this connection needs to be made. Creating a connection to the base servers involves two steps: creating an HTTP client and binding a
            <code>Zend_Gdata_Gbase</code> service instance to that client.
        </para>
        <sect3 id="zend.gdata.gbase.connect.authentication">
            <title>Authentication</title>
            <para>
                The Google Base API allows access to both public and private base feeds. Public feeds do not require authentication, but are read-only and offer reduced functionality. Private feeds offers the most complete functionality but requires an authenticated connection to the base servers. There are three authentication schemes that are supported by Google Base:
            </para>
            <itemizedlist>
                <listitem>
                    <para>
                        <firstterm>ClientAuth</firstterm>
                        provides direct username/password authentication to the base servers. Since this scheme requires that users provide your application with their password, this authentication is only recommended when other authentication schemes are insufficient.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>AuthSub</firstterm>
                        allows authentication to the base servers via a Google proxy server. This provides the same level of convenience as ClientAuth but without the security risk, making this an ideal choice for web-based applications.
                    </para>
                </listitem>
            </itemizedlist>
            <para>
                The <code>Zend_Gdata</code>
                library provides support for all three authentication schemes. The rest of this chapter will assume that you are familiar the authentication schemes available and how to create an appropriate authenticated connection. For more information, please see section <xref linkend="zend.gdata.introduction.authentication" />.
                or the
                <ulink url="http://code.google.com/apis/gdata/auth.html">Authentication Overview in the Google Data API Developer's Guide</ulink>.
            </para>
        </sect3>
        <sect3 id="zend.gdata.gbase.connect.service">
            <title>Create A Service Instance</title>
            <para>
                In order to interact with Google Base, this library provides the
                <code>Zend_Gdata_Gbase</code>
                service class. This class provides a common interface to the Google Data and Atom Publishing Protocol models and assists in marshaling requests to and from the base servers.
            </para>
            <para>
                Once deciding on an authentication scheme, the next step is to create an instance of
                <code>Zend_Gdata_Gbase</code>
                . This class takes in an instance of
                <code>Zend_Http_Client</code>
                as a single argument. This provides an interface for AuthSub and ClientAuth authentication, as both of these creation of a special authenticated HTTP client. If no arguments are provided, an unauthenticated instance of
                <code>Zend_Http_Client</code>
                will be automatically created.
            </para>
            <para>
                The example below shows how to create a Base service class using ClientAuth authentication:
            </para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata_ClientLogin');
Zend_Loader::loadClass('Zend_Gdata_Gbase');

// Parameters for ClientAuth authentication
$service = Zend_Gdata_Gbase::AUTH_SERVICE_NAME;
$user = "sample.user@gmail.com";
$pass = "pa$$w0rd";

// Create an authenticated HTTP client
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);

// Create an instance of the Base service
$service = new Zend_Gdata_Gbase($client);]]>
</programlisting>
<para>A Base service using AuthSub can be created in a similar, though slightly more lengthy fashion:</para>
<programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata_AuthSub');
Zend_Loader::loadClass('Zend_Gdata_Gbase');

/** Retrieve the current URL so that the AuthSub server knows where to
 * redirect the user after authentication is complete.
 */
function getCurrentUrl()
{
    global $_SERVER;

    // Filter php_self to avoid a security vulnerability.
    $php_request_uri = htmlentities(substr($_SERVER['REQUEST_URI'], 0, strcspn($_SERVER['REQUEST_URI'], "\n\r")), ENT_QUOTES);

    if (isset($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) == 'on') {
        $protocol = 'https://';
    } else {
        $protocol = 'http://';
    }
    $host = $_SERVER['HTTP_HOST'];
    if ($_SERVER['HTTP_PORT'] != '' &&
        (($protocol == 'http://' && $_SERVER['HTTP_PORT'] != '80') ||
        ($protocol == 'https://' && $_SERVER['HTTP_PORT'] != '443'))) {
        $port = ':' . $_SERVER['HTTP_PORT'];
    } else {
        $port = '';
    }
    return $protocol . $host . $port . $php_request_uri;
}

/** Obtain an AuthSub authenticated HTTP client, redirecting the user to the
 *  AuthSub server to login if necessary.
 */
function getAuthSubHttpClient()
{
    global $_SESSION, $_GET;

    // If there is no AuthSub session or one-time token waiting for us,
    // redirect the user to the AuthSub server to get one.
    if (!isset($_SESSION['sessionToken']) && !isset($_GET['token'])) {
        // Parameters to give to AuthSub server
        $next = getCurrentUrl();
        $scope = "http://www.google.com/base/feeds/items/";
        $secure = false;
        $session = true;

        // Redirect the user to the AuthSub server to sign in

        $authSubUrl = Zend_Gdata_AuthSub::getAuthSubTokenUri($next, $scope, $secure, $session);
         header("HTTP/1.0 307 Temporary redirect");

         header("Location: " . $authSubUrl);

         exit();
    }

    // Convert an AuthSub one-time token into a session token if needed
    if (!isset($_SESSION['sessionToken']) && isset($_GET['token'])) {
        $_SESSION['sessionToken'] =
            Zend_Gdata_AuthSub::getAuthSubSessionToken($_GET['token']);
    }

    // At this point we are authenticated via AuthSub and can obtain an
    // authenticated HTTP client instance

    // Create an authenticated HTTP client
    $client = Zend_Gdata_AuthSub::getHttpClient($_SESSION['sessionToken']);
    return $client;
}

// -> Script execution begins here <-

// Make sure http://code.google.com/apis/gdata/reference.html#Queriesthat the user has a valid session, so we can record the
// AuthSub session token once it is available.
session_start();

// Create an instance of the Base service, redirecting the user
// to the AuthSub server if necessary.
$service = new Zend_Gdata_Gbase(getAuthSubHttpClient());]]>
</programlisting>
<para>Finally, an unauthenticated server can be created for use with snippets feeds:</para>
<programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata_Gbase');

// Create an instance of the Base service using an unauthenticated HTTP client
$service = new Zend_Gdata_Gbase();]]>
            </programlisting>
        </sect3>
    </sect2>
    <sect2 id="zend.gdata.gbase.retrieve">
        <title>Retrieve Items</title>
        <para>
            You can query customer items feed or snippets feed to retrieve items. It involves two steps, sending a query and iterating through the returned feed.
        </para>
        <sect3 id="zend.gdata.gbase.retrieve.query">
            <title>Send a Structured Query</title>
            <para>
                You can send a structured query to retrieve items from your own customer items feed or from the public snippets feed.
            </para>
            <para>
                When retrieveing items using the Base API, specially constructed query URLs are used to describe what events should be returned. The  <code>Zend_Gdata_Gbase_ItemQuery</code> and <code>Zend_Gdata_Gbase_SnippetQuery</code> classes simplify this task by automatically constructing a query URL based on provided parameters. 
            </para>
            <sect4 id="zend.gdata.gbase.retrieve.query.customeritems">
                <title>Query Customer Items Feed</title>
                <para>
                    To execute a query against the customer items feed, invoke <code>newItemQuery()</code> and <code>getGbaseItemFeed()</code> methods:
                </para>
                <programlisting role="php"><![CDATA[<?php
$service = new Zend_Gdata_Gbase($client);
$query = $service->newItemQuery();
$query->setBq('[title:Programming]');
$query->setOrderBy('modification_time');
$query->setSortOrder('descending');
$query->setMaxResults('5');
$feed = $service->getGbaseItemFeed($query);]]>
                </programlisting>
                <para>
                    A full list of these paremeters is available at the <ulink url="http://code.google.com/apis/base/items-feed.html#QueParameters">Query parameters section</ulink> of the Customer Items Feed documentation.
                </para>
            </sect4>
            <sect4 id="zend.gdata.gbase.retrieve.query.snippets">
                <title>Query Snippets Feed</title>
                <para>
                    To execute a query against the public snippets feed, invoke <code>newSnippetQuery()</code> and <code>getGbaseSnippetFeed()</code> methods:
                </para>
                <programlisting role="php"><![CDATA[<?php
$service = new Zend_Gdata_Gbase();
$query = $service->newSnippetQuery();
$query->setBq('[title:Programming]');
$query->setOrderBy('modification_time');
$query->setSortOrder('descending');
$query->setMaxResults('5');
$feed = $service->getGbaseSnippetFeed($query);]]>
                </programlisting>
                <para>
                    A full list of these paremeters is available at the <ulink url="http://code.google.com/apis/base/snippets-feed.html#Parameters">Query parameters section</ulink> of the Snippets Feed documentation.
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.gdata.gbase.retrieve.iterate">
            <title>Iterate through the Items</title>
            <para>
                Google Base items can contain item-specific attributes such as <code>&lt;g:main_ingredient&gt;</code> and <code>&lt;g:weight&gt;</code>.
            </para>
            <para>
                To iterate through all attributes of a given item, invoke <code>getGbaseAttributes()</code> and iterate through the results:
            </para>
            <programlisting role="php"><![CDATA[<?php
foreach ($feed->entries as $entry) {
  // Get all attributes and print out the name and text value of each attribute
  $baseAttributes = $entry->getGbaseAttributes();
  foreach ($baseAttributes as $attr) {
    echo "Attribute " . $attr->name . " : " . $attr->text . "<br>";
  }
}]]>
            </programlisting>
            <para>
                Or, you can look for specific attribute name and iterate through the results that match:
            </para>
            <programlisting role="php"><![CDATA[<?php
foreach ($feed->entries as $entry) {
  // Print all main ingredients <g:main_ingredient>
  $baseAttributes = $entry->getGbaseAttribute("main_ingredient");
  foreach ($baseAttributes as $attr) {
    echo "Main ingredient: " . $attr->text . "<br>";
  }
}]]>
            </programlisting>
        </sect3>
    </sect2>
    <sect2 id="zend.gdata.gbase.crud">
        <title>Insert, Update, and Delete Customer Items</title>
        <para>
            A customer/owner can access his own Customer Items feed to insert, update, or delete their items. These operations do not apply to the public snippets feed.
        </para>
        <para>
            You can test a feed operation before it is actually executed by setting the dry-run flag (<code>$dryRun</code>) to <code>true</code>. Once you are sure that you want to submit the data, set it to <code>false</code> to execute the operation.
        </para>
		<sect3 id="zend.gdata.gbase.crud.insert">
			<title>Insert an Item</title>
            <para>
                Items can be added by using the <code>insertGbaseItem()</code> method for the Base service:
            </para>
            <programlisting role="php"><![CDATA[<?php
$service = new Zend_Gdata_Gbase($client);
$newEntry = $service->newItemEntry();

// Add title
$title = "PHP Developer Handbook";
$newEntry->title = $service->newTitle(trim($title));

// Add some content
$content = "Essential handbook for PHP developers.";
$newEntry->content = $service->newContent($content);
$newEntry->content->type = 'text';

// Define product type
$itemType = "Products";
$newEntry->itemType = $itemType;

// Add item specific attributes
$newEntry->addGbaseAttribute("product_type", "book", "text");
$newEntry->addGbaseAttribute("price", "12.99 USD", "floatUnit");
$newEntry->addGbaseAttribute("quantity", "10", "int");
$newEntry->addGbaseAttribute("weight", "2.2 lbs", "numberUnit");
$newEntry->addGbaseAttribute("condition", "New", "text");
$newEntry->addGbaseAttribute("author", "John Doe", "text");
$newEntry->addGbaseAttribute("edition", "First Edition", "text");
$newEntry->addGbaseAttribute("pages", "253", "number");
$newEntry->addGbaseAttribute("publisher", "My Press", "text");
$newEntry->addGbaseAttribute("year", "2007", "number");
$newEntry->addGbaseAttribute("payment_accepted", "Google Checkout", "text");

$dryRun = true;
$createdEntry = $service->insertGbaseItem($newEntry, $dryRun);]]>
            </programlisting>
        </sect3>
        <sect3 id="zend.gdata.gbase.crud.modify">
            <title>Modify an Item</title>
            <para>
                You can update each attribute element of an item as you iterate through them:
            </para>
            <programlisting role="php"><![CDATA[<?php
// Update the title
$newTitle = "PHP Developer Handbook Second Edition";
$entry->title = $service->newTitle($newTitle);

// Find <g:price> attribute and update the price
$baseAttributes = $entry->getGbaseAttribute("price");
if (is_object($baseAttributes[0])) {
  $newPrice = "16.99 USD";
  $baseAttributes[0]->text = $newPrice;
}

// Find <g:pages> attribute and update the number of pages
$baseAttributes = $entry->getGbaseAttribute("pages");
if (is_object($baseAttributes[0])) {
  $newPages = "278";
  $baseAttributes[0]->text = $newPages;

  // Update the attribute type from "number" to "int"
  if ($baseAttributes[0]->type == "number") {
    $newType = "int";
    $baseAttributes[0]->type = $newType;
  }
}

// Remove <g:label> attributes
$baseAttributes = $entry->getGbaseAttribute("label");
foreach ($baseAttributes as $note) {
  $entry->removeGbaseAttribute($note);
}

// Add new attributes
$entry->addGbaseAttribute("note", "PHP 5", "text");
$entry->addGbaseAttribute("note", "Web Programming", "text");

// Save the changes by invoking save() on the entry object itself
$dryRun = true;
$entry->save($dryRun);

// Or, save the changes by calling updateGbaseItem() on the service object
// $dryRun = true;
// $service->updateGbaseItem($entry, $dryRun);
]]>
            </programlisting>
            <para>
                After making the changes, either invoke <code>save($dryRun)</code> method on the <code>Zend_Gdata_Gbase_ItemEntry</code> object or call <code>updateGbaseItem($entry, $dryRun)</code> method on the <code>Zend_Gdata_Gbase</code> object to save the changes.
            </para>
        </sect3>
		<sect3 id="zend.gdata.gbase.crud.delete">
			<title>Delete an Item</title>
            <para>
                You can remove an item by calling <code>deleteGbaseItem()</code> method:
            </para>
            <programlisting role="php"><![CDATA[<?php
$dryRun = false;
$service->deleteGbaseItem($entry, $dryRun);]]>
            </programlisting>
            <para>
                Alternatively, you can invoke <code>delete()</code> on the <code>Zend_Gdata_Gbase_ItemEntry</code> object:
            </para>
            <programlisting role="php"><![CDATA[<?php
$dryRun = false;
$entry->delete($dryRun);]]>
            </programlisting>
        </sect3>
    </sect2>
</sect1>
<sect1 id="zend.gdata.photos">
    <title>Using Picasa Web Albums</title>
    
    <para>
        Picasa Web Albums is a service which allows users to maintain albums of
        their own pictures, and browse the albums and pictures of others.
        The API offers a programatic interface to this service, allowing
        users to add to, update, and remove from their albums, as well as
        providing the ability to tag and comment on photos.
    </para>
    
    <para>
        Access to public albums and photos is not restricted by account,
        however, a user must be logged in for non-read-only access.
    </para>
    
    <para>
        For more information on the API, including
        instructions for enabling API access, refer to the <ulink
        url="http://code.google.com/apis/picasaweb/overview.html">Picasa
        Web Albums Data API Overview</ulink>.
    </para>
    
    <note>
        <title>Authentication</title>
        <para>
            The API provides authentication via AuthSub (recommended)
            and ClientAuth. HTTP connections must be authenticated for write
            support, but non-authenticated connections have read-only access.
        </para>
    </note>
    
    <sect2 id="zend.gdata.photos.connecting">
        <title>Connecting To The Service</title>
        <para>
            The Picasa Web Albums API, like all GData APIs, is based off of the Atom Publishing Protocol (APP),
            an XML based format for managing web-based resources. Traffic between a client and the
            servers occurs over HTTP and allows for both authenticated and unauthenticated connections.
        </para>
        
        <para>
            Before any transactions can occur, this connection needs to be made. Creating a connection to the
            Picasa servers involves two steps: creating an HTTP client and binding a
            <code>Zend_Gdata_Photos</code>
            service instance to that client.
        </para>
        
        <sect3 id="zend.gdata.photos.connecting.authentication">
            <title>Authentication</title>
            <para>
                The Google Picasa API allows access to both public and private photo feeds. Public feeds
                do not require authentication, but are read-only and offer reduced functionality. Private feeds
                offers the most complete functionality but requires an authenticated connection to the Picasa
                servers. There are three authentication schemes that are supported by Google Picasa :
            </para>
            
            <itemizedlist>
                <listitem>
                    <para>
                        <firstterm>ClientAuth</firstterm>
                        provides direct username/password authentication to the
                        Picasa servers. Since this scheme requires that users
                        provide your application with their password, this
                        authentication is only recommended when other
                        authentication schemes are insufficient.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <firstterm>AuthSub</firstterm>
                        allows authentication to the Picasa servers via a
                        Google proxy server. This provides the same level of
                        convenience as ClientAuth but without the security
                        risk, making this an ideal choice for web-based
                        applications.
                    </para>
                </listitem>
            </itemizedlist>
            
            <para>
                The
                <code>Zend_Gdata</code>
                library provides support for both authentication schemes.
                The rest of this chapter will assume that you are familiar the
                authentication schemes available and how to create an
                appropriate authenticated connection. For more information,
                please see section the
                <link linkend="zend.gdata.introduction.authentication">Authentication section</link>
                of this manual or the
                <ulink url="http://code.google.com/apis/gdata/auth.html">Authentication Overview in the Google Data API Developer's Guide</ulink>.
            </para>
        </sect3>
    
        <sect3 id="zend.gdata.photos.connecting.service">
            <title>Creating A Service Instance</title>
            <para>
                In order to interact with the servers, this library provides the
                <code>Zend_Gdata_Photos</code> service class. This class provides a common interface to the
                Google Data and Atom Publishing Protocol models and assists in marshaling requests to and from
                the servers.
            </para>
            
            <para>
                Once deciding on an authentication scheme, the next step is to create an instance of
                <code>Zend_Gdata_Photos</code>. The class constructor takes an instance of
                <code>Zend_Http_Client</code> as a single argument. This provides an interface for AuthSub
                and ClientAuth authentication, as both of these require creation of a special authenticated
                HTTP client. If no arguments are provided, an unauthenticated instance of
                <code>Zend_Http_Client</code> will be automatically created.
            </para>
            
            <para>The example below shows how to create a service class using ClientAuth authentication:</para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata');
Zend_Loader::loadClass('Zend_Gdata_ClientLogin');
Zend_Loader::loadClass('Zend_Gdata_Photos');
Zend_Loader::loadClass('Zend_Http_Client');

// Parameters for ClientAuth authentication
$service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
$user = "sample.user@gmail.com";
$pass = "pa$$w0rd";

// Create an authenticated HTTP client
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);

// Create an instance of the service
$service = new Zend_Gdata_Photos($client);]]>
            </programlisting>
            
            <para>A service instance using AuthSub can be created in a similar, though slightly more lengthy fashion:</para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata');
Zend_Loader::loadClass('Zend_Gdata_AuthSub');
Zend_Loader::loadClass('Zend_Gdata_Photos');
Zend_Loader::loadClass('Zend_Http_Client');

session_start();

/**
 * Returns the full URL of the current page, based upon env variables
 * 
 * Env variables used:
 * $_SERVER['HTTPS'] = (on|off|)
 * $_SERVER['HTTP_HOST'] = value of the Host: header
 * $_SERVER['SERVER_PORT'] = port number (only used if not http/80,https/443)
 * $_SERVER['REQUEST_URI'] = the URI after the method of the HTTP request
 *
 * @return string Current URL
 */
function getCurrentUrl() 
{
    global $_SERVER;

    /**
     * Filter php_self to avoid a security vulnerability.
     */
    $php_request_uri = htmlentities(substr($_SERVER['REQUEST_URI'], 0,
    strcspn($_SERVER['REQUEST_URI'], "\n\r")), ENT_QUOTES);

    if (isset($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) == 'on') {
        $protocol = 'https://';
    } else {
        $protocol = 'http://';
    }
    $host = $_SERVER['HTTP_HOST'];
    if ($_SERVER['SERVER_PORT'] != '' &&
        (($protocol == 'http://' && $_SERVER['SERVER_PORT'] != '80') ||
        ($protocol == 'https://' && $_SERVER['SERVER_PORT'] != '443'))) {
            $port = ':' . $_SERVER['SERVER_PORT'];
    } else {
        $port = '';
    }
    return $protocol . $host . $port . $php_request_uri;
}

/**
 * Returns the AuthSub URL which the user must visit to authenticate requests 
 * from this application.
 *
 * Uses getCurrentUrl() to get the next URL which the user will be redirected
 * to after successfully authenticating with the Google service.
 *
 * @return string AuthSub URL
 */
function getAuthSubUrl() 
{
    $next = getCurrentUrl();
    $scope = 'http://picasaweb.google.com/data';
    $secure = false;
    $session = true;
    return Zend_Gdata_AuthSub::getAuthSubTokenUri($next, $scope, $secure, 
        $session);
}

/**
 * Returns a HTTP client object with the appropriate headers for communicating
 * with Google using AuthSub authentication.
 *
 * Uses the $_SESSION['sessionToken'] to store the AuthSub session token after
 * it is obtained.  The single use token supplied in the URL when redirected 
 * after the user succesfully authenticated to Google is retrieved from the 
 * $_GET['token'] variable.
 *
 * @return Zend_Http_Client
 */
function getAuthSubHttpClient() 
{
    global $_SESSION, $_GET;
    if (!isset($_SESSION['sessionToken']) && isset($_GET['token'])) {
        $_SESSION['sessionToken'] = 
            Zend_Gdata_AuthSub::getAuthSubSessionToken($_GET['token']);
    } 
    $client = Zend_Gdata_AuthSub::getHttpClient($_SESSION['sessionToken']);
    return $client;
}

/**
 * Create a new instance of the service, redirecting the user
 * to the AuthSub server if necessary.
 */
$service = new Zend_Gdata_Photos(getAuthSubHttpClient());]]>
            </programlisting>
            
            <para>Finally, an unauthenticated server can be created for use with public feeds:</para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata');
Zend_Loader::loadClass('Zend_Gdata_Photos');

// Create an instance of the service using an unauthenticated HTTP client

$service = new Zend_Gdata_Photos();]]>
            </programlisting>
        </sect3>
    </sect2>
    
    <sect2 id="zend.gdata.photos.queries">
        <title>Understanding and Constructing Queries</title>
        <para>
            The primary method to request data from the service is by constructing a query.  There are query
            classes for each of the following types:
        </para>
        
        <itemizedlist>
            <listitem>
                <para>
                    <firstterm>User</firstterm>
                    is used to specify the user whose data is being searched for, and is specified as a username.
                    If no user is provided, "default" will be used instead to indicate the currently authenticated
                    user (if authenticated).
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>Album</firstterm>
                    is used to specify the album which is being searched for, and is specified as either an id,
                    or an album name.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>Photo</firstterm>
                    is used to specify the photo which is being searched for, and is specified as an id.
                </para>
            </listitem>
        </itemizedlist>
        
        <para>A new <code>UserQuery</code> can be constructed as followed:</para>
        <programlisting role="php"><![CDATA[<?php
$service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
$service = new Zend_Gdata_Photos($client);

$query = new Zend_Gdata_Photos_UserQuery();
$query->setUser("sample.user");]]>
        </programlisting>
        
        <para>
            For each query, a number of parameters limiting the search can be requested, or specified, 
            with get(Parameter) and set(Parameter), respectively.  They are as follows:
        </para>
        
        <itemizedlist>
            <listitem>
                <para>
                    <firstterm>Projection</firstterm>
                    sets the format of the data returned in the feed, as either "api" or "base".  Normally,
                    "api" is desired.  The default is "api".
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>Type</firstterm>
                    sets the type of element to be returned, as either "feed" or "entry".  The default is "feed".
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>Access</firstterm>
                    sets the visibility of items to be returned, as "all", "public", or "private".  The default is
                    "all".  Non-public elements will only be returned if the query is searching for the
                    authenticated user.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>Tag</firstterm>
                    sets a tag filter for returned items.  When a tag is set, only items tagged with this value
                    will return.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>Kind</firstterm>
                    sets the kind of elements to return.  When kind is specified, only entries that match this
                    value will be returned.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>ImgMax</firstterm>
                    sets the maximum image size for entries returned.  Only image entries smaller than this value
                    will be returned.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>Thumbsize</firstterm>
                    sets the thumbsize of entries that are returned.  Any retrieved entry will have a thumbsize
                    equal to this value.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>User</firstterm>
                    sets the user whose data is being searched for.  The default is "default".
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>AlbumId</firstterm>
                    sets the id of the album being searched for.  This element only applies to album and photo queries.
                    In the case of photo queries, this specifies the album that contains the requested photo.  The
                    album id is mutually exclusive with the album's name.  Setting one unsets the other.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>AlbumName</firstterm>
                    sets the name of the album being searched for.  This element only applies to the album and photo
                    queries.  In the case of photo queries, this specifies the album that contains the requested photo.
                    The album name is mutually exclusive with the album's id.  Setting one unsets the other.
                </para>
            </listitem>
            <listitem>
                <para>
                    <firstterm>PhotoId</firstterm>
                    sets the id of the photo being searched for.  This element only applies to photo queries.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>
    
    <sect2 id="zend.gdata.photos.retrieval">
        <title>Retrieving Feeds And Entries</title>
        <para>
            The service has functions to retrieve a feed, or individual entries, for users, albums,
            and individual photos.
        </para>
        
        <sect3 id="zend.gdata.photos.user_retrieval">
            <title>Retrieving A User</title>
            <para>
                The service supports retrieving a user feed and list of the user's content.  If the requested
                user is also the authenticated user, entries marked as "<code>hidden</code>" will also be returned.
            </para>
        
            <para>The user feed can be accessed by passing the username to the <code>getUserFeed</code> method:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    try {
        $userFeed = $service->getUserFeed("sample.user");
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        
            <para>Or, the feed can be accessed by constructing a query, first:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_UserQuery();
    $query->setUser("sample.user");

    try {
        $userFeed = $service->getUserFeed(null, $query);
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        
            <para>Constructing a query also provides the ability to request a user entry object:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_UserQuery();
    $query->setUser("sample.user");
    $query->setType("entry");

    try {
        $userEntry = $service->getUserEntry($query);
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.album_retrieval">
            <title>Retrieving An Album</title>
            <para>The service supports retrieving an album feed and a list of the album's content.</para>
        
            <para>
                The album feed is accessed by constructing a query object and passing it to <code>getAlbumFeed</code>:
            </para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_AlbumQuery();
    $query->setUser("sample.user");
    $query->setAlbumId("1");

    try {
        $albumFeed = $service->getAlbumFeed($query);
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        
            <para>
                Alternatively, the query object can be given an album name with <code>setAlbumName</code>.  Setting
                the album name is mutually exclusive with setting the album id, and setting one will unset the other.
            </para>
        
            <para>Constructing a query also provides the ability to request an album entry object:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_AlbumQuery();
    $query->setUser("sample.user");
    $query->setAlbumId("1");
    $query->setType("entry");

    try {
        $albumEntry = $service->getAlbumEntry($query);
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.photo_retrieval">
            <title>Retrieving A Photo</title>
            <para>The service supports retrieving a photo feed and a list of associated comments and tags.</para>
        
            <para>
                The photo feed is accessed by constructing a query object and passing it to <code>getPhotoFeed</code>:
            </para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_PhotoQuery();
    $query->setUser("sample.user");
    $query->setAlbumId("1");
    $query->setPhotoId("100");

    try {
        $photoFeed = $service->getPhotoFeed($query);
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        
            <para>Constructing a query also provides the ability to request a photo entry object:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_PhotoQuery();
    $query->setUser("sample.user");
    $query->setAlbumId("1");
    $query->setPhotoId("100");
    $query->setType("entry");

    try {
        $photoEntry = $service->getPhotoEntry($query);
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.comment_retrieval">
            <title>Retrieving A Comment</title>
            <para>
                The service supports retrieving comments from a feed of a different type.  By setting a query
                to return a kind of "comment", a feed request can return comments associated with a specific user,
                album, or photo.
            </para>
        
            <para>Performing an action on each of the comments on a given photo can be accomplished as follows:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_PhotoQuery();
    $query->setUser("sample.user");
    $query->setAlbumId("1");
    $query->setPhotoId("100");
    $query->setKind("comment");

    try {
        $photoFeed = $service->getPhotoFeed($query);
    
        foreach ($photoFeed as $entry) {
            if ($entry instanceof Zend_Gdata_Photos_CommentEntry) {
                // Do something with the comment
            }
        }
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.tag_retrieval">
            <title>Retrieving A Tag</title>
            <para>
                The service supports retrieving tags from a feed of a different type.  By setting a query
                to return a kind of "tag", a feed request can return tags associated with a specific photo.
            </para>
        
            <para>Performing an action on each of the tags on a given photo can be accomplished as follows:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $query = new Zend_Gdata_Photos_PhotoQuery();
    $query->setUser("sample.user");
    $query->setAlbumId("1");
    $query->setPhotoId("100");
    $query->setKind("tag");

    try {
        $photoFeed = $service->getPhotoFeed($query);
    
        foreach ($photoFeed as $entry) {
            if ($entry instanceof Zend_Gdata_Photos_TagEntry) {
                // Do something with the tag
            }
        }
    } catch (Zend_Gdata_App_Exception $e) {
        echo "Error: " . $e->getResponse();
    }]]>
            </programlisting>
        </sect3>
        
    </sect2>
    
    <sect2 id="zend.gdata.photos.creation">
        <title>Creating Entries</title>
        <para>The service has functions to create albums, photos, comments, and tags.</para>
    
        <sect3 id="zend.gdata.photos.album_creation">
            <title>Creating An Album</title>
            <para>The service supports creating a new album for an authenticated user:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $entry = new Zend_Gdata_Photos_AlbumEntry();
    $entry->setTitle($service->newTitle("test album"));

    $service->insertAlbumEntry($entry);]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.photo_creation">
            <title>Creating A Photo</title>
            <para>The service supports creating a new photo for an authenticated user:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    // $photo is the name of a file uploaded via an HTML form

    $fd = $service->newMediaFileSource($photo["tmp_name"]);
    $fd->setContentType($photo["type"]);

    $entry = new Zend_Gdata_Photos_PhotoEntry();
    $entry->setMediaSource($fd);
    $entry->setTitle($service->newTitle($photo["name"]));

    $albumQuery = new Zend_Gdata_Photos_AlbumQuery;
    $albumQuery->setUser("sample.user");
    $albumQuery->setAlbumId("1");

    $albumEntry = $service->getAlbumEntry($albumQuery);

    $service->insertPhotoEntry($entry, $albumEntry);]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.comment_creation">
            <title>Creating A Comment</title>
            <para>The service supports creating a new comment for a photo:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $entry = new Zend_Gdata_Photos_CommentEntry();
    $entry->setTitle($service->newTitle("comment"));
    $entry->setContent($service->newContent("comment"));

    $photoQuery = new Zend_Gdata_Photos_PhotoQuery;
    $photoQuery->setUser("sample.user");
    $photoQuery->setAlbumId("1");
    $photoQuery->setPhotoId("100");
    $photoQuery->setType('entry');

    $photoEntry = $service->getPhotoEntry($photoQuery);

    $service->insertCommentEntry($entry, $photoEntry);]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.tag_creation">
            <title>Creating A Tag</title>
            <para>The service supports creating a new tag for a photo:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $entry = new Zend_Gdata_Photos_TagEntry();
    $entry->setTitle($service->newTitle("tag"));

    $photoQuery = new Zend_Gdata_Photos_PhotoQuery;
    $photoQuery->setUser("sample.user");
    $photoQuery->setAlbumId("1");
    $photoQuery->setPhotoId("100");
    $photoQuery->setType('entry');

    $photoEntry = $service->getPhotoEntry($photoQuery);

    $service->insertTagEntry($entry, $photoEntry);]]>
            </programlisting>
        </sect3>
    
    </sect2>
    
    <sect2 id="zend.gdata.photos.deletion">
        <title>Deleting Entries</title>
        <para>The service has functions to delete albums, photos, comments, and tags.</para>
        
        <sect3 id="zend.gdata.photos.album_deletion">
            <title>Deleting An Album</title>
            <para>The service supports deleting an album for an authenticated user:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $albumQuery = new Zend_Gdata_Photos_AlbumQuery;
    $albumQuery->setUser("sample.user");
    $albumQuery->setAlbumId("1");
    $albumQuery->setType('entry');

    $entry = $service->getAlbumEntry($albumQuery);

    $service->deleteAlbumEntry($entry, true);]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.photo_deletion">
            <title>Deleting A Photo</title>
            <para>The service supports deleting a photo for an authenticated user:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $photoQuery = new Zend_Gdata_Photos_PhotoQuery;
    $photoQuery->setUser("sample.user");
    $photoQuery->setAlbumId("1");
    $photoQuery->setPhotoId("100");
    $photoQuery->setType('entry');

    $entry = $service->getPhotoEntry($photoQuery);

    $service->deletePhotoEntry($entry, true);]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.comment_deletion">
            <title>Deleting A Comment</title>
            <para>The service supports deleting a comment for an authenticated user:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $photoQuery = new Zend_Gdata_Photos_PhotoQuery;
    $photoQuery->setUser("sample.user");
    $photoQuery->setAlbumId("1");
    $photoQuery->setPhotoId("100");
    $photoQuery->setType('entry');

    $path = $photoQuery->getQueryUrl() . '/commentid/' . "1000";

    $entry = $service->getCommentEntry($path);

    $service->deleteCommentEntry($entry, true);]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.tag_deletion">
            <title>Deleting A Tag</title>
            <para>The service supports deleting a tag for an authenticated user:</para>
            <programlisting role="php"><![CDATA[<?php
    $service = Zend_Gdata_Photos::AUTH_SERVICE_NAME;
    $client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
    $service = new Zend_Gdata_Photos($client);

    $photoQuery = new Zend_Gdata_Photos_PhotoQuery;
    $photoQuery->setUser("sample.user");
    $photoQuery->setAlbumId("1");
    $photoQuery->setPhotoId("100");
    $photoQuery->setKind("tag");
    $query = $photoQuery->getQueryUrl();

    $photoFeed = $service->getPhotoFeed($query);

    foreach ($photoFeed as $entry) {
        if ($entry instanceof Zend_Gdata_Photos_TagEntry) {
            if ($entry->getContent() == $tagContent) {
                $tagEntry = $entry;
            }
        }
    }

    $service->deleteTagEntry($tagEntry, true);]]>
            </programlisting>
        </sect3>
    
        <sect3 id="zend.gdata.photos.optimistic_concurrenty">
            <title>Optimistic Concurrency (Notes On Deletion)</title>
            <para>
                GData feeds, including those of the Picasa Web Albums service, implement optimistic concurrency,
                a versioning system that prevents users from overwriting changes, inadvertently.  When
                deleting a entry through the service class, if the entry has been modified since it was
                last fetched, an exception will be thrown, unless explicitly set otherwise (in which case
                the deletion is retried on the updated entry).
            </para>
        
            <para>
                An example of how to handle versioning during a deletion is shown by <code>deleteAlbumEntry</code>:
            </para>
            <programlisting role="php"><![CDATA[<?php
    // $album is the albumEntry to be deleted
    try {
        $this->delete($album);
    } catch (Zend_Gdata_App_HttpException $e) {
        if ($e->getResponse->getStatus() === 409) {
            $entry = new Zend_Gdata_Photos_AlbumEntry($e->getResponse()->getBody());
            $this->delete($entry->getLink('edit')->href);
        } else {
            throw $e;
        }
    }]]>
            </programlisting>
        </sect3>
        
    </sect2>
</sect1>
<sect1 id="zend.gdata.spreadsheets">
    <title>Using Google Spreadsheets</title>

    <para>
        The Google Spreadsheets data API allows client applications to view
        and update Spreadsheets content in the form of Google data API feeds.
        Your client application can request a list of a user's spreadsheets,
        edit or delete content in an existing Spreadsheets worksheet, and
        query the content in an existing Spreadsheets worksheet.
    </para>

    <para>
        See
        <ulink url="http://code.google.com/apis/spreadsheets/overview.html">http://code.google.com/apis/spreadsheets/overview.html</ulink>
        for more information about the Google Spreadsheets API.
    </para>

    <sect2 id="zend.gdata.spreadsheets.creating">
        <title>Create a Spreadsheet</title>
        <para>
            The Spreadsheets data API does not currently provide a way to
            programatically create or delete a spreadsheet.
        </para>
    </sect2>

    <sect2 id="zend.gdata.spreadsheets.listspreadsheets">
        <title>Get a List of Spreadsheets</title>
        <para>
            You can get a list of spreadsheets for a particular user by using
            the <code>getSpreadsheetFeed</code> method of the Spreadsheets
            service.  The service will return a
            <code>Zend_Gdata_Spreadsheets_SpreadsheetFeed</code> object
            containing a list of spreadsheets associated with the authenticated
            user.
        </para>

        <programlisting role="php"><![CDATA[<?php
$service = Zend_Gdata_Spreadsheets::AUTH_SERVICE_NAME;
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);
$spreadsheetService = new Zend_Gdata_Spreadsheets($client);
$feed = $spreadsheetService->getSpreadsheetFeed();]]>
        </programlisting>
    </sect2>

     <sect2 id="zend.gdata.spreadsheets.listworksheets">
        <title>Get a List of Worksheets</title>
        <para>
            A given spreadsheet may contain multiple worksheets. For each
            spreadsheet, there's a worksheets metafeed listing all the
            worksheets in that spreadsheet.
        </para>

        <para>
            Given the spreadsheet key from the &lt;id&gt; of a
            <code>Zend_Gdata_Spreadsheets_SpreadsheetEntry</code>
            object you've already retrieved, you can fetch a feed
            containing a list of worksheets associated with that spreadsheet.
        </para>

        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Spreadsheets_DocumentQuery();
$query->setSpreadsheetKey($spreadsheetKey);
$feed = $spreadsheetService->getWorksheetFeed($query);]]>
        </programlisting>

        <para>
            The resulting <code>Zend_Gdata_Spreadsheets_WorksheetFeed</code>
            object feed represents the response from the server. Among other
            things, this feed contains a list of
            <code>Zend_Gdata_Spreadsheets_WorksheetEntry </code>
            objects (<code>$feed->entries</code>), each of which represents a
            single worksheet.
        </para>

    </sect2>

    <sect2 id="zend.gdata.spreadsheets.listfeeds">
        <title>Interacting With List-based Feeds</title>
        <para>
            A given worksheet generally contains multiple rows, each
            containing multiple cells. You can request data from the
            worksheet either as a list-based feed, in which each entry
            represents a row, or as a cell-based feed, in which each
            entry represents a single cell. For information on cell-based
            feeds, see <link linkend="zend.gdata.spreadsheets.cellfeeds">Interacting with cell-based feeds</link>.
        </para>

        <para>
            The following sections describe how to get a list-based feed,
            add a row to a worksheet, and send queries with various query
            parameters.
        </para>

        <para>
            The list feed makes some assumptions about how the data is laid
            out in the spreadsheet.
        </para>

        <para>
            In particular, the list feed treats the first row of the
            worksheet as a header row; Spreadsheets dynamically creates
            XML elements named after the contents of header-row cells.
            Users who want to provide Gdata feeds should not put any data
            other than column headers in the first row of a worksheet.
        </para>

        <para>
            The list feed contains all rows after the first row up to the
            first blank row. The first blank row terminates the data set.
            If expected data isn't appearing in a feed, check the worksheet
            manually to see whether there's an unexpected blank row in the
            middle of the data. In particular, if the second row of the
            spreadsheet is blank, then the list feed will contain no data.
        </para>

        <para>
            A row in a list feed is as many columns wide as the worksheet itself.
        </para>

        <sect3 id="zend.gdata.spreadsheets.listfeeds.get">
            <title>Get a List-based Feed</title>
            <para>
                To retrieve a worksheet's list feed, use the
                <code>getListFeed</code> method of the Spreadsheets service.
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Spreadsheets_ListQuery();
$query->setSpreadsheetKey($spreadsheetKey);
$query->setWorksheetId($worksheetId);
$listFeed = $spreadsheetService->getListFeed($query);]]>
            </programlisting>

            <para>
                The resulting <code>Zend_Gdata_Spreadsheets_ListFeed</code>
                object <code>$listfeed</code> represents a response from the
                server. Among other things, this feed contains an array of
                <code>Zend_Gdata_Spreadsheets_ListEntry</code> objects
                (<code>$listFeed->entries</code>), each of which represents
                a single row in a worksheet.
            </para>

            <para>
              Each <code>Zend_Gdata_Spreadsheets_ListEntry</code> contains an
              array, <code>custom</code>, which contains the data for that
              row. You can extract and display this array:
            </para>

            <programlisting role="php"><![CDATA[<?php
$rowData = $listFeed->entries[1]->getCustom();
foreach($rowData as $customEntry) {
  echo $customEntry->getColumnName() . " = " . $customEntry->getText();
}]]>
            </programlisting>
            
            <para>
              An alternate version of this array, <code>customByName</code>,
              allows direct access to an entry's cells by name. This is
              convenient when trying to access a specific header:
            </para>
            
            <programlisting role="php"><![CDATA[<?php
$customEntry = $listFeed->entries[1]->getCustomByName('my_heading');
echo $customEntry->getColumnName() . " = " . $customEntry->getText();]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.gdata.spreadsheets.listfeeds.reverse">
            <title>Reverse-sort Rows</title>

            <para>
                By default, rows in the feed appear in the same order as the
                corresponding rows in the GUI; that is, they're in order by
                row number. To get rows in reverse order, set the reverse
                properties of the <code>Zend_Gdata_Spreadsheets_ListQuery</code>
                object to true:
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Spreadsheets_ListQuery();
$query->setSpreadsheetKey($spreadsheetKey);
$query->setWorksheetId($worksheetId);
$query->setReverse('true');
$listFeed = $spreadsheetService->getListFeed($query);]]>
            </programlisting>

            <para>
                Note that if you want to order (or reverse sort) by a
                particular column, rather than by position in the worksheet,
                you can set the <code>orderby</code> value of the
                <code>Zend_Gdata_Spreadsheets_ListQuery</code> object to
                <code>column:&lt;the header of that column&gt;</code>.
            </para>
        </sect3>

        <sect3 id="zend.gdata.spreadsheets.listfeeds.sq">
            <title>Send a Structured Query</title>

            <para>
                You can set a <code>Zend_Gdata_Spreadsheets_ListQuery</code>'s
                <code>sq</code> value to produce a feed with entries that meet
                the specified criteria. For example, suppose you have a worksheet
                containing personnel data, in which each row represents
                information about a single person. You wish to retrieve all rows
                in which the person's name is "John" and the person's age is over
                25. To do so, you would set <code>sq</code> as follows:
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Spreadsheets_ListQuery();
$query->setSpreadsheetKey($spreadsheetKey);
$query->setWorksheetId($worksheetId);
$query->setSpreadsheetQuery('name=John and age>25');
$listFeed = $spreadsheetService->getListFeed($query);]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.gdata.spreadsheets.listfeeds.addrow">
            <title>Add a Row</title>

            <para>
                Rows can be added to a spreadsheet by using the
                <code>insertRow</code> method of the Spreadsheet service.
            </para>

            <programlisting role="php"><![CDATA[<?php
$insertedListEntry = $spreadsheetService->insertRow($rowData, $spreadsheetKey, $worksheetId);]]>
            </programlisting>

            <para>
                The <code>$rowData</code> parameter contains an array of column
                keys to data values.  The method returns a
                <code>Zend_Gdata_Spreadsheets_SpreadsheetsEntry</code> object
                which represents the inserted row.
            </para>

            <para>
                Spreadsheets inserts the new row immediately after the last row
                that appears in the list-based feed, which is to say
                immediately before the first entirely blank row.
            </para>
        </sect3>

        <sect3 id="zend.gdata.spreadsheets.listfeeds.editrow">
            <title>Edit a Row</title>

            <para>
                Once a <code>Zend_Gdata_Spreadsheets_ListEntry</code> object
                is fetched, its rows can be updated by using the
                <code>updateRow</code> method of the Spreadsheet service.
            </para>

            <programlisting role="php"><![CDATA[<?php
$updatedListEntry = $spreadsheetService->updateRow($oldListEntry, $newRowData);]]>
            </programlisting>

            <para>
                The <code>$oldListEntry</code> parameter contains the list entry
                to be updated.  <code>$newRowData</code> contains an array of
                column keys to data values, to be used as the new row data.
                The method returns a
                <code>Zend_Gdata_Spreadsheets_SpreadsheetsEntry</code> object
                which represents the updated row.
            </para>
        </sect3>

        <sect3 id="zend.gdata.spreadsheets.listfeeds.deleterow">
            <title>Delete a Row</title>

            <para>
                To delete a row, simply invoke <code>deleteRow</code> on the
                <code>Zend_Gdata_Spreadsheets</code> object with the existing
                entry to be deleted:
            </para>

            <programlisting role="php"><![CDATA[<?php
$spreadsheetService->deleteRow($listEntry);]]>
            </programlisting>

            <para>
                Alternatively, you can call the <code>delete</code> method of
                the entry itself:
            </para>

            <programlisting role="php"><![CDATA[<?php
$listEntry->delete();]]>
            </programlisting>
        </sect3>

    </sect2>

    <sect2 id="zend.gdata.spreadsheets.cellfeeds">
        <title>Interacting With Cell-based Feeds</title>

        <para>
            In a cell-based feed, each entry represents a single cell.
        </para>

        <para>
            Note that we don't recommend interacting with both a cell-based
            feed and a list-based feed for the same worksheet at the same time.
        </para>


        <sect3 id="zend.gdata.spreadsheets.cellfeeds.get">
            <title>Get a Cell-based Feed</title>
            <para>
                To retrieve a worksheet's cell feed, use the
                <code>getCellFeed</code> method of the Spreadsheets service.
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Spreadsheets_CellQuery();
$query->setSpreadsheetKey($spreadsheetKey);
$query->setWorksheetId($worksheetId);
$cellFeed = $spreadsheetService->getCellFeed($query);]]>
            </programlisting>

            <para>
                The resulting <code>Zend_Gdata_Spreadsheets_CellFeed</code>
                object <code>$cellFeed</code> represents a response from the
                server. Among other things, this feed contains an array of
                <code>Zend_Gdata_Spreadsheets_CellEntry</code> objects
                (<code>$cellFeed>entries</code>), each of which represents
                a single cell in a worksheet.  You can display this information:
            </para>

            <programlisting role="php"><![CDATA[<?php
foreach($cellFeed as $cellEntry) {
  $row = $cellEntry->cell->getRow();
  $col = $cellEntry->cell->getColumn();
  $val = $cellEntry->cell->getText();
  echo "$row, $col = $val\n";
}]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.gdata.spreadsheets.cellfeeds.cellrangequery">
            <title>Send a Cell Range Query</title>

            <para>
                Suppose you wanted to retrieve the cells in the first column
                of a worksheet. You can request a cell feed containing only
                this column as follows:
            </para>

            <programlisting role="php"><![CDATA[<?php
$query = new Zend_Gdata_Spreadsheets_CellQuery();
$query->setMinCol(1);
$query->setMaxCol(1);
$query->setMinRow(2);
$feed = $spreadsheetService->getCellsFeed($query);]]>
            </programlisting>

            <para>
                This requests all the data in column 1, starting with row 2.
            </para>
        </sect3>

        <sect3 id="zend.gdata.spreadsheets.cellfeeds.updatecell">
            <title>Change Contents of a Cell</title>

            <para>
                To modify the contents of a cell, call
                <code>updateCell</code> with the row, column,
                and new value of the cell.
            </para>

            <programlisting role="php"><![CDATA[<?php
$updatedCell = $spreadsheetService->updateCell($row, $col, $inputValue, $spreadsheetKey, $worksheetId);]]>
            </programlisting>

            <para>
                The new data is placed in the specified cell in the worksheet.
                If the specified cell contains data already, it will be
                overwritten.  Note: Use <code>updateCell</code> to change
                the data in a cell, even if the cell is empty.
            </para>
        </sect3>

    </sect2>

</sect1>
<sect1 id="zend.gdata.youtube">
    <title>Using the YouTube data API</title>
    
    <para>
        The YouTube data API offers read-only access to YouTube's content 
        in the form of Google data ("GData") feeds.  The API gives access to
        lists of videos matching specific criteria, popular videos, and more.
        It also allows access to public information about YouTube users, including
        playlists, subscriptions and contacts.
    </para>
    
    <para>
        For more information on the YouTube data API, please refer
        to the <ulink url="http://code.google.com/apis/youtube/">
        YouTube data API documentation</ulink>.
    </para>
    
    <note>
        <title>Authentication</title>
        <para>
            The YouTube data API currently allows read-only access to public 
            data, so no authentication is required.
            </para>
    </note>
    
    <sect2 id="zend.gdata.youtube.videos">
        <title>Retrieving video feeds</title>
        
        <para>
            The YouTube data API provides numerous feeds that return a list of 
            videos, such as standard feeds, related videos, video responses, 
            user's uploads, and user's favorites. For example, the 
            user's uploads feed returns all videos uploaded by a specific user. 
            See the <ulink url="http://code.google.com/apis/youtube/reference.html#Feeds">
            reference guide</ulink> for a detailed list of all feeds. All the 
            feeds described in this section are "video feeds" -- feeds that return 
            lists of videos.
        </para>
        
        <sect3 id="zend.gdata.youtube.videos.searching">
            <title>Searching for videos by metadata</title>
            
            <para>
                You can retrieve a list of videos that match specified 
                search criteria, using the video feed.  The following query
                looks for videos which contain the word "cat" in their 
                metadata, starting with the 10th video and displaying 20 
                videos per page, ordered by the view count.
            </para>
            
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata_YouTube');

$yt = new Zend_Gdata_YouTube();
$query = $yt->newVideoQuery();
$query->videoQuery = 'cat';
$query->startIndex = 10;
$query->maxResults = 20;
$query->orderBy = 'viewCount';

echo $query->queryUrl . "\n";
$videoFeed = $yt->getVideoFeed($query); 

foreach ($videoFeed as $videoEntry) {
  echo "---------VIDEO----------\n";
  echo "Title: " . $videoEntry->mediaGroup->title->text . "\n";
  echo "\nDescription:\n";
  echo $videoEntry->mediaGroup->description->text;
  echo "\n\n\n";
}
?>]]></programlisting>
    
            <para>
                For more details on the different query parameters, please 
                refer to the <ulink url="http://code.google.com/apis/youtube/reference.html#Parameters">
                Reference Guide</ulink>.  There are helper functions in
                Zend_Gdata_YouTube_VideoQuery for each of these parameters.
            </para> 
        </sect3>

        <sect3 id="zend.gdata.youtube.videos.searchingcategories">
            <title>Searching for videos by categories and tags/keywords</title>
    
            <para>
                Searching for videos in specific categories is done by
                generating a <ulink url="http://code.google.com/apis/youtube/reference.html#CategorySearch">
                specially formatted URL</ulink>.  For example, to search for 
                comedy videos which contain the keyword dog:
            </para>
    
            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$query = $yt->newVideoQuery();
$query->category = 'Comedy/dog';

echo $query->queryUrl . "\n";
$videoFeed = $yt->getVideoFeed($query); 
]]></programlisting>
        </sect3>
 
        <sect3 id="zend.gdata.youtube.videos.standard">
            <title>Retrieving standard feeds</title>
            
            <para>
                The YouTube data API has a number of 
                <ulink url="http://code.google.com/apis/youtube/reference.html#VideoFeeds">
                standard feeds</ulink>.  These standard feeds can be retrieved
                as Zend_Gdata_YouTube_VideoFeed objects using the specified 
                URLs, but many also have helper methods in Zend_Gdata_YouTube.
            </para>

            <para>
                To retrieve the top rated videos using the helper method:
            </para>

            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();

$videoFeed = $yt->getTopRatedVideoFeed(); 
]]></programlisting>

            <para>
                There are also query parameters to specify the time period
                over which the standard feed is computed.  Only valid with the
                top_rated and most_viewed standard feeds.
            </para>

            <para>
                For example, to retrieve the top rated videos for today:
            </para> 

            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$query = $yt->newVideoQuery();
$query->setTime('today');
$videoFeed = $yt->getTopRatedVideoFeed($query); 
]]></programlisting> 
            <para>
                Alternatively, you could just retrieve the feed using the
                URL:
            </para>

            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$query = $yt->newVideoQuery('http://gdata.youtube.com/feeds/standardfeeds/top_rated');
$query->setTime('today');
$videoFeed = $yt->getVideoFeed($query); 
]]></programlisting>
        </sect3>

        <sect3 id="zend.gdata.youtube.videos.user">
            <title>Retrieving videos uploaded by a user</title>

            <para>
                You can retrieve a list of videos uploaded by a particular user
                using a simple helper method. This example retrieves videos 
                uploaded by the user 'liz'.
            </para>

            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$videoFeed = $yt->getUserUploads('liz'); 
]]></programlisting>
        </sect3>

        <sect3 id="zend.gdata.youtube.videos.favorites">
            <title>Retrieving videos favorited by a user</title>

            <para>
                You can retrieve a list of a user's favorite videos
                using a simple helper method. This example retrieves videos 
                favorited by the user 'liz'.
            </para>

            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$videoFeed = $yt->getUserFavorites('liz'); 
]]></programlisting>
        </sect3>

        <sect3 id="zend.gdata.youtube.videos.responses">
            <title>Retrieving video responses for a video</title>

            <para>
                You can retrieve a list of a video's video responses
                using a simple helper method. This example retrieves video
                response for a video with the ID 'abc123813abc'.
            </para>

            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$videoFeed = $yt->getVideoResponseFeed('abc123813abc'); 
]]></programlisting>
        </sect3>
    </sect2>

    <sect2 id="zend.gdata.youtube.comments">
        <title>Retrieving video comments</title>

        <para>
            The comments for each YouTube video can be retrieved in 
            several ways.  To retrieve the comments for the video with 
            the ID 'abc123813abc', use the following code: 
        </para>

        <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$commentFeed = $yt->getVideoCommentFeed('abc123813abc'); 

foreach ($commentFeed as $commentEntry) {
    echo $commentEntry->title->text . "\n";
    echo $commentEntry->content->text . "\n\n\n";
} 
]]></programlisting>

        <para>
            Comments can also be retrieved for a video if you have
            a copy of the Zend_Gdata_YouTube_VideoEntry object:
        </para>

            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$videoEntry = $yt->getVideoEntry('abc123813abc'); 
// we don't know the video ID in this example, but we do have the URL
$commentFeed = $yt->getVideoCommentFeed(null, $videoEntry->comments->href);
]]></programlisting>
        
    </sect2>

    <sect2 id="zend.gdata.youtube.playlists">
        <title>Retrieving playlist feeds</title>

        <para>
            The YouTube data API provides information about users, including
            profiles, playlists, subscriptions, and more.
        </para>
    
        <sect3 id="zend.gdata.youtube.playlists.user">
            <title>Retrieving the playlists of a user</title>
        
            <para>
                The library provides a helper method to retrieve
                the playlists associated with a given user.  To retrieve the
                playlists for the user 'liz':
            </para>
            <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$playlistListFeed = $yt->getPlaylistListFeed('liz'); 

foreach ($playlistListFeed as $playlistEntry) {
    echo $playlistEntry->title->text . "\n";
    echo $playlistEntry->description->text . "\n";
    echo $playlistEntry->getPlaylistVideoFeedUrl() . "\n\n\n";
} 
]]></programlisting>
        </sect3>

        <sect3 id="zend.gdata.youtube.playlists.special">
            <title>Retrieving a specific playlist</title>
        
            <para>
                The library provides a helper method to retrieve
                the videos associated with a given playlist.  To retrieve the
                playlists for a specific playlist entry:
            </para>
            <programlisting role="php"><![CDATA[
$playlistVideoFeed = $yt->getPlaylistVideoFeed($playlistEntry->getPlaylistVideoFeedUrl()); 
]]></programlisting>
        </sect3>
    </sect2> 

    <sect2 id="zend.gdata.youtube.subscriptions">
        <title>Retrieving a list of a user's subscriptions</title>
        
        <para>
            A user can have several types of subscriptions: channel 
            subscription, tag subscription, or favorites subscription.
            A Zend_Gdata_YouTube_SubscriptionEntry is used to represent
            individual subscriptions.
        </para>

        <para>
            To retrieve all subscriptions for the user 'liz':
        </para>
        <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$subscriptionFeed = $yt->getSubscriptionFeed('liz'); 

foreach ($subscriptionFeed as $subscriptionEntry) {
    echo $subscriptionEntry->title->text . "\n";
} 
]]></programlisting>
    </sect2>

    <sect2 id="zend.gdata.youtube.profile">
        <title>Retrieving a user's profile</title>
        
        <para>
            You can retrieve the public profile information
            for any YouTube user.  To retrieve the profile
            for the user 'liz':
        </para>

        <programlisting role="php"><![CDATA[
$yt = new Zend_Gdata_YouTube();
$userProfile = $yt->getUserProfile('liz'); 
echo "username: " . $userProfile->username->text . "\n";
echo "age: " . $userProfile->age->text . "\n";
echo "hometown: " . $userProfile->hometown->text . "\n"; 
]]></programlisting>
    </sect2>
 
</sect1>
<sect1 id="zend.http.client.adapters">
    <title>Zend_Http_Client - Connection Adapters</title>

    <sect2 id="zend.http.client.adapters.overview">
        <title>Overview</title>
        <para>
            Zend_Http_Client is based on a connection adapter design. The
            connection adapter is the object in charge of performing the
            actual connection to the server, as well as writing requests
            and reading responses.
            This connection adapter can be replaced, and you can create and
            extend the default connection adapters to suite your special needs,
            without the need to extend or replace the entire HTTP client
            class, and with the same interface.
        </para>
        <para>
            Currently, the Zend_Http_Client class provides three built-in
            connection adapters:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>Zend_Http_Client_Adapter_Socket</code> (default)
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Http_Client_Adapter_Proxy</code>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Http_Client_Adapter_Test</code>
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <para>
            The Zend_Http_Client object's adapter connection adapter is set
            using the 'adapter' configuration option. When instantiating the
            client object, you can set the 'adapter' configuration option to
            a string containing the adapter's name (eg. 'Zend_Http_Client_Adapter_Socket')
            or to a variable holding an adapter object (eg <code>
            new Zend_Http_Client_Adapter_test</code>). You can also set the
            adapter later, using the Zend_Http_Client->setConfig() method.
        </para>
    </sect2>

    <sect2 id="zend.http.client.adapters.socket">
        <title>The Socket Adapter</title>
        <para>
            The default connection adapter is the Zend_Http_Client_Adapter_Socket
            adapter - this adapter will be used unless you explicitly set the
            connection adapter. The Socket adapter is based on PHP's built-in
            fsockopen() function, and does not require any special extensions or
            compilation flags.
        </para>
        <para>
            The Socket adapter allows several extra configuration options that 
            can be set using <code>Zend_Http_Client->setConfig()</code> or 
            passed to the client constructor. All of them are related to HTTPS
            connections, and are not relevant when connecting to non-secure 
            HTTP servers: 
            <table id="zend.http.client.adapter.socket.configuration.table">
                <title>Zend_Http_Client_Adapter_Socket configuration parameters</title>
                <tgroup cols="4">
                    <thead>
                        <row>
                            <entry>Parameter</entry>
                            <entry>Description</entry>
                            <entry>Expected Values</entry>
                            <entry>Default Value</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>ssltransport</entry>
                            <entry>SSL transport layer (eg. 'sslv2', 'tls')</entry>
                            <entry>string</entry>
                            <entry>ssl</entry>
                        </row>
                        <row>
                            <entry>sslcert</entry>
                            <entry>PEM encoded SSL certificate file path</entry>
                            <entry>string</entry>
                            <entry>'/path/to/cert.pem'</entry>
                        </row>
                        <row>
                            <entry>sslpassphrase</entry>
                            <entry>Passphrase for the SSL certificate file</entry>
                            <entry>string</entry>
                            <entry>'s0mes3cre7'</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            
            <note>
                <title>HTTPS SSL Stream Parameters</title>
                <para>
                    All the above parameters are related to the SSL layer used 
                    in HTTPS connections. While the default settings should work
                    for most applications, you might need to change them if the
                    server you are connecting to requires special client setup. 
                    If so, you should read the sections about SSL transport 
                    layers and options <ulink url="http://www.php.net/manual/en/transports.phphttp://framework.zend.com/manual/en/zend.search.lucene.searching.html#transports.inet">here</ulink>.
                </para>
            </note>
        </para>
        <example id="zend.http.client.adapters.socket.example-1">
            <title>Changing the HTTPS transport layer</title>
            <programlisting role="php"><![CDATA[<?php
// Set the configuration parameters
$config = array(
    'adapter'      => 'Zend_Http_Client_Adapter_Socket',
    'ssltransport' => 'tls'
);

// Instantiate a client object
$client = Zend_Http_Client('https://www.example.com', $config);

// The following request will be sent over a TLS secure connection.
$response = $client->request();]]>
            </programlisting>
        </example>
        <para>
            The result of the example above will be similar to opening a TCP
            connection using the following PHP command:
        </para>
        <para>
            <code>fsockopen('tls://www.example.com', 443)</code>
        </para>
    </sect2>

    <sect2 id="zend.http.client.adapters.proxy">
        <title>The Proxy Adapter</title>
        <para>
            The Zend_Http_Client_Adapter_Proxy adapter is similar to the default
            Socket adapter - only the connection is made through an HTTP proxy
            server instead of a direct connection to the target server. This
            allows usage of Zend_Http_Client behind proxy servers - which is
            sometimes needed for security or performance reasons.
        </para>

        <para>
            Using the Proxy adapter requires several additional configuration
            parameters to be set, in addition to the default 'adapter' option:
            <table id="zend.http.client.adapters.proxy.table">
                <title>Zend_Http_Client configuration parameters</title>
                <tgroup cols="4">
                    <thead>
                        <row>
                            <entry>Parameter</entry>
                            <entry>Description</entry>
                            <entry>Expected Type</entry>
                            <entry>Example Value</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>proxy_host</entry>
                            <entry>Proxy server address</entry>
                            <entry>string</entry>
                            <entry>'proxy.myhost.com' or '10.1.2.3'</entry>
                        </row>
                        <row>
                            <entry>proxy_port</entry>
                            <entry>Proxy server TCP port</entry>
                            <entry>integer</entry>
                            <entry>8080 (default) or 81</entry>
                        </row>
                        <row>
                            <entry>proxy_user</entry>
                            <entry>Proxy user name, if required</entry>
                            <entry>string</entry>
                            <entry>'shahar' or '' for none (default)</entry>
                        </row>
                        <row>
                            <entry>proxy_pass</entry>
                            <entry>Proxy password, if required</entry>
                            <entry>string</entry>
                            <entry>'secret' or '' for none (default)</entry>
                        </row>
                        <row>
                            <entry>proxy_auth</entry>
                            <entry>Proxy HTTP authentication type</entry>
                            <entry>string</entry>
                            <entry>Zend_Http_Client::AUTH_BASIC (default)</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
        <para>
            proxy_host should always be set - if it is not set, the client will
            fall back to a direct connection using Zend_Http_Client_Adapter_Socket.
            proxy_port defaults to '8080' - if your proxy listens on a different
            port you must set this one as well.
        </para>
        <para>
            proxy_user and proxy_pass are only required if your proxy server
            requires you to authenticate. Providing these will add a 'Proxy-Authentication'
            header to the request. If your proxy does not require authentication,
            you can leave these two options out.
        </para>
        <para>
            proxy_auth sets the proxy authentication type, if your proxy server
            requires authentication. Possibly values are similar to the ones
            accepted by the Zend_Http_Client::setAuth() method. Currently, only
            basic authentication (Zend_Http_Client::AUTH_BASIC) is supported.
        </para>
        <example id="zend.http.client.adapters.proxy.example-1">
            <title>Using Zend_Http_Client behind a proxy server</title>
            <programlisting role="php"><![CDATA[<?php
// Set the configuration parameters
$config = array(
    'adapter'    => 'Zend_Http_Client_Adapter_Proxy',
    'proxy_host' => 'proxy.int.zend.com',
    'proxy_port' => 8000,
    'proxy_user' => 'shahar.e',
    'proxy_pass' => 'bananashaped'
);

// Instantiate a client object
$client = Zend_Http_Client('http://www.example.com', $config);

// Continue working...]]>
            </programlisting>
        </example>
        <para>
            As mentioned, if proxy_host is not set or is set to a blank string,
            the connection will fall back to a regular direct connection. This
            allows you to easily write your application in a way that allows a
            proxy to be used optionally, according to a configuration parameter.
        </para>
    </sect2>

    <sect2 id="zend.http.client.adapters.test">
        <title>The Test Adapter</title>
        <para>
            Sometimes, it is very hard to test code that relies on HTTP connections.
            For example, testing an application that pulls an RSS feed from a remote
            server will require a network connection, which is not always available.
        </para>
        <para>
            For this reason, the Zend_Http_Client_Adapter_Test adapter is
            provided. You can write your application to use Zend_Http_Client,
            and just for testing purposes, for example in your unit testing
            suite, you can replace the default adapter with a Test adapter (a
            mock object), allowing you to run tests without actually
            performing server connections.
        </para>
        <para>
            The Zend_Http_Client_Adapter_Test adapter provides an additional
            method, setResponse() method. This method takes one parameter,
            which represents an HTTP response as either text or a Zend_Http_Response
            object. Once set, your Test adapter will always return this response,
            without even performing an actual HTTP request.
        </para>
        <example id="zend.http.client.adapters.test.example-1">
            <title>Testing Against a Single HTTP Response Stub</title>
            <programlisting role="php"><![CDATA[<?php
// Instantiate a new adapter and client
$adapter = new Zend_Http_Client_Adapter_Test();
$client = Zend_Http_Client('http://www.example.com', array(
    'adapter' => $adapter
));

// Set the expected response
$adapter->setResponse(
    "HTTP/1.1 200 OK"        . "\r\n" .
    "Content-type: text/xml" . "\r\n" .
                               "\r\n" .
    '<?xml version="1.0" encoding="UTF-8"?>' .
    '<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/"' .
    '     xmlns:wfw="http://wellformedweb.org/CommentAPI/"' .
    '     xmlns:dc="http://purl.org/dc/elements/1.1/">' .
    '  <channel>' .
    '    <title>Premature Optimization</title>' .
    // and so on...
    '</rss>');

$response = $client->request('GET');
// .. continue parsing $response..]]>
            </programlisting>
        </example>
        <para>
            The above example shows how you can preset your HTTP client to
            return the response you need. Then, you can continue testing your
            own code, without being dependent on a network connection, the server's
            response, etc. In this case, the test would continue to check how
            the application parses the XML in the response body.
        </para>

        <para>
            Sometimes, a single method call to an object can result in that
            object performing multiple HTTP transactions. In this case, it's
            not possible to use setResponse() alone because there's no
            opportunity to set the next response(s) your program might need
            before returning to the caller.
        </para>
        <example id="zend.http.client.adapters.test.example-2">
            <title>Testing Against Multiple HTTP Response Stubs</title>
            <programlisting role="php"><![CDATA[<?php
// Instantiate a new adapter and client
$adapter = new Zend_Http_Client_Adapter_Test();
$client = Zend_Http_Client('http://www.example.com', array(
    'adapter' => $adapter
));

// Set the first expected response
$adapter->setResponse(
    "HTTP/1.1 302 Found"      . "\r\n" .
    "Location: /"             . "\r\n" .
    "Content-Type: text/html" . "\r\n" .
                                "\r\n" .
    '<html>' .
    '  <head><title>Moved</title></head>' .
    '  <body><p>This page has moved.</p></body>' .
    '</html>');

// Set the next successive response
$adapter->addResponse(
    "HTTP/1.1 200 OK"         . "\r\n" .
    "Content-Type: text/html" . "\r\n" .
                                "\r\n" .
    '<html>' .
    '  <head><title>My Pet Store Home Page</title></head>' .
    '  <body><p>...</p></body>' .
    '</html>');

// inject the http client object ($client) into your object
// being tested and then test your object's behavior below]]>
            </programlisting>
        </example>
        <para>
            The setResponse() method clears any responses in the
            Zend_Http_Client_Adapter_Test's buffer and sets the
            first response that will be returned.  The addResponse()
            method will add successive responses.
        </para>
        <para>
            The responses will be replayed in the order that they
            were added.  If more requests are made than the number
            of responses stored, the responses will cycle again
            in order.
        </para>
        <para>
            In the example above, the adapter is configured to test your
            object's behavior when it encounters a 302 redirect. Depending on
            your application, following a redirect may or may not be desired
            behavior. In our example, we expect that the redirect will be
            followed and we configure the test adapter to help us test this.
            The initial 302 response is set up with the setResponse() method
            and the 200 response to be returned next is added with the
            addResponse() method. After configuring the test adapter, inject
            the HTTP client containing the adapter into your object under test
            and test its behavior.
        </para>
    </sect2>

    <sect2 id="zend.http.client.adapters.extending">
        <title>Creating your own connection adapters</title>
        <para>
            You can create your own connection adapters and use them. You could, for
            example, create a connection adapter that uses persistent sockets,
            or a connection adapter with caching abilities, and use them as
            needed in your application.
        </para>
        <para>
            In order to do so, you must create your own adapter class that implements
            the Zend_Http_Client_Adapter_Interface interface. The following example
            shows the skeleton of a user-implemented adapter class. All the public
            functions defined in this example must be defined in your adapter as well:
        </para>
        <example id="zend.http.client.adapters.extending.example-1">
            <title>Creating your own connection adapter</title>
            <programlisting role="php"><![CDATA[<?php
class MyApp_Http_Client_Adapter_BananaProtocol implements Zend_Http_Client_Adapter_Interface
{
    /**
     * Set the configuration array for the adapter
     *
     * @param array $config
     */
    public function setConfig($config = array())
    {
        // This rarely changes - you should usually copy the implementation
        // in Zend_Http_Client_Adapter_Socket.
    }

    /**
     * Connect to the remote server
     *
     * @param string  $host
     * @param int     $port
     * @param boolean $secure
     */
    public function connect($host, $port = 80, $secure = false)
    {
        // Set up the connection to the remote server
    }

    /**
     * Send request to the remote server
     *
     * @param string        $method
     * @param Zend_Uri_Http $url
     * @param string        $http_ver
     * @param array         $headers
     * @param string        $body
     * @return string Request as text
     */
    public function write($method, $url, $http_ver = '1.1', $headers = array(), $body = '')
    {
        // Send request to the remote server.
        // This function is expected to return the full request (headers and body) as a string
    }

    /**
     * Read response from server
     *
     * @return string
     */
    public function read()
    {
        // Read response from remote server and return it as a string
    }

    /**
     * Close the connection to the server
     *
     */
    public function close()
    {
        // Close the connection to the remote server - called last.
    }
}

// Then, you could use this adapter:
$client = new Zend_Http_Client(array(
    'adapter' => 'MyApp_Http_Client_Adapter_BananaProtocol'
));]]>
            </programlisting>
        </example>
    </sect2>
</sect1>
<sect1 id="zend.http.client.advanced">
    <title>Zend_Http_Client - Advanced Usage</title>

    <sect2 id="zend.http.client.redirections">
        <title>HTTP Redirections</title>
        <para>
            By default, Zend_Http_Client automatically handles HTTP redirections,
            and will follow up to 5 redirections. This can be changed by setting
            the 'maxredirects' configuration parameter.
        </para>
        <para>
            According to the HTTP/1.1 RFC, HTTP 301 and 302 responses should be
            treated by the client by resending the same request to the
            specified location - using the same request method. However, most
            clients to not implement this and always use a GET request when
            redirecting. By default, Zend_Http_Client does the same - when
            redirecting on a 301 or 302 response, all GET and POST parameters
            are reset, and a GET request is sent to the new location. This
            behavior can be changed by setting the 'strictredirects' configuration
            parameter to boolean TRUE:
            <example id="zend.http.client.redirections.example-1">
                <title>Forcing RFC 2616 Strict Redirections on 301 and 302 Responses</title>
                <programlisting role="php"><![CDATA[<?php
// Strict Redirections
$client->setConfig(array('strictredirects' => true));

// Non-strict Redirections
$client->setConfig(array('strictredirects' => false));]]>
                </programlisting>
            </example>
        </para>
        <para>
            You can always get the number of redirections done after sending a
            request using the getRedirectionsCount() method.
        </para>
    </sect2>

    <sect2 id="zend.http.client.cookies">
        <title>Adding Cookies and Using Cookie Persistence</title>
        <para>
            Zend_Http_Client provides an easy interface for adding cookies
            to your request, so that no direct header modification is
            required. This is done using the setCookie() method. This method
            can be used in several ways:
            <example id="zend.http.client.cookies.example-1">
                <title>Setting Cookies Using setCookie()</title>
                <programlisting role="php"><![CDATA[<?php
// Easy and simple: by providing a cookie name and cookie value
$client->setCookie('flavor', 'chocolate chips');

// By directly providing a raw cookie string (name=value)
// Note that the value must be already URL encoded
$client->setCookie('flavor=chocolate%20chips');

// By providing a Zend_Http_Cookie object
$cookie = Zend_Http_Cookie::fromString('flavor=chocolate%20chips');
$client->setCookie($cookie);]]>
                </programlisting>
            </example>
            For more information about Zend_Http_Cookie objects, see
            <xref linkend="zend.http.cookies" />.
        </para>
        <para>
            Zend_Http_Client also provides the means for cookie stickiness -
            that is having the client internally store all sent and received
            cookies, and resend them automatically on subsequent requests. This
            is useful, for example when you need to log in to a remote site
            first and receive and authentication or session ID cookie before
            sending further requests.
            <example id="zend.http.client.cookies.example-2">
                <title>Enabling Cookie Stickiness</title>
                <programlisting role="php"><![CDATA[<?php
// To turn cookie stickiness on, set a Cookie Jar
$client->setCookieJar();

// First request: log in and start a session
$client->setUri('http://example.com/login.php');
$client->setParameterPost('user', 'h4x0r');
$client->setParameterPost('password', '1337');
$client->request('POST');

// The Cookie Jar automatically stores the cookies set
// in the response, like a session ID cookie.

// Now we can send our next request - the stored cookies
// will be automatically sent.
$client->setUri('http://example.com/read_member_news.php');
$client->request('GET');]]>
                </programlisting>
            </example>
            For more information about the Zend_Http_CookieJar class, see
            <xref linkend="zend.http.cookies.cookiejar" />.
        </para>
    </sect2>

    <sect2 id="zend.http.client.custom_headers">
        <title>Setting Custom Request Headers</title>
        <para>
            Setting custom headers can be done by using the setHeaders() method.
            This method is quite diverse and can be used in several ways, as
            the following example shows:
            <example id="zend.http.client.custom_headers.example-1">
                <title>Setting A Single Custom Request Header</title>
                <programlisting role="php"><![CDATA[<?php
// Setting a single header, overwriting any previous value
$client->setHeaders('Host', 'www.example.com');

// Another way of doing the exact same thing
$client->setHeaders('Host: www.example.com');

// Setting several values for the same header (useful mostly for Cookie headers):
$client->setHeaders('Cookie', array(
    'PHPSESSID=1234567890abcdef1234567890abcdef',
    'language=he'
));]]>
                </programlisting>
            </example>
        </para>
        <para>
            setHeader() can also be easily used to set multiple headers in one
            call, by providing an array of headers as a single parameter:
            <example id="zend.http.client.custom_headers.example-2">
                <title>Setting Multiple Custom Request Headers</title>
                <programlisting role="php"><![CDATA[<?php
// Setting multiple headers, overwriting any previous value
$client->setHeaders(array(
    'Host' => 'www.example.com',
    'Accept-encoding' => 'gzip,deflate',
    'X-Powered-By' => 'Zend Framework'));

// The array can also contain full array strings:
$client->setHeaders(array(
    'Host: www.example.com',
    'Accept-encoding: gzip,deflate',
    'X-Powered-By: Zend Framework'));]]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.http.client.file_uploads">
        <title>File Uploads</title>
        <para>
            You can upload files through HTTP using the setFileUpload method.
            This method takes a file name as the first parameter, a form name
            as the second parameter, and data as a third optional parameter.
            If the third data parameter is null, the first file name parameter
            is considered to be a real file on disk, and Zend_Http_Client will
            try to read this file and upload it. If the data parameter is not
            null, the first file name parameter will be sent as the file name,
            but no actual file needs to exist on the disk.
            The second form name parameter is always required, and is equivalent
            to the "name" attribute of an &gt;input&lt; tag, if the file was to
            be uploaded through an HTML form.
            A fourth optional parameter provides the file's content-type. If
            not specified, and Zend_Http_Client reads the file from the disk,
            the mime_content_type function will be used to guess the file's
            content type, if it is available. In any case, the default MIME
            type will be application/octet-stream.
            <example id="zend.http.client.file_uploads.example-1">
                <title>Using setFileUpload to Upload Files</title>
                <programlisting role="php"><![CDATA[<?php
// Uploading arbitrary data as a file
$text = 'this is some plain text';
$client->setFileUpload('some_text.txt', 'upload', $text, 'text/plain');

// Uploading an existing file
$client->setFileUpload('/tmp/Backup.tar.gz', 'bufile');

// Send the files
$client->submit('POST');]]>
                </programlisting>
            </example>
            In the first example, the $text variable is uploaded and will be
            available as $_FILES['upload'] on the server side. In the second
            example, the existing file /tmp/Backup.tar.gz is uploaded to the
            server and will be available as $_FILES['bufile']. The content type
            will be guesses automatically if possible - and if not, the content
            type will be set to 'application/octet-stream'.
        </para>
        <note>
            <title>Uploading files</title>
            <para>
                When uploading files, the HTTP request content-type is
                automatically set to multipart/form-data. Keep in mind that
                you must send a POST or PUT request in order to upload files.
                Most servers will ignore the requests body on other request
                methods.
            </para>
        </note>
    </sect2>
    <sect2 id="zend.http.client.raw_post_data">
        <title>Sending Raw POST Data</title>
        <para>
            You can use a Zend_Http_Client to send raw POST data using the
            setRawData() method. This method takes two parameters: the first
            is the data to send in the request body. The second optional
            parameter is the content-type of the data. While this parameter is
            optional, you should usually set it before sending the request -
            either using setRawData(), or with another method: setEncType().
            <example id="zend.http.client.raw_post_data.example-1">
                <title>Sending Raw POST Data</title>
                <programlisting role="php"><![CDATA[<?php
$xml = '<book>' .
       '  <title>Islands in the Stream</title>' .
       '  <author>Ernest Hemingway</author>' .
       '  <year>1970</year>' .
       '</book>';

$client->setRawData($xml, 'text/xml')->request('POST');

// Another way to do the same thing:
$client->setRawData($xml)->setEncType('text/xml')->request('POST');]]>
                </programlisting>
            </example>
            The data should be available on the server side through PHP's
            $HTTP_RAW_POST_DATA variable or through the php://input stream.
        </para>
        <note>
            <title>Using raw POST data</title>
            <para>
                Setting raw POST data for a request will override any POST
                parameters or file uploads. You should not try to use both on
                the same request. Keep in mind that most servers will ignore
                the request body unless you send a POST request.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.http.client.http_authentication">
        <title>HTTP Authentication</title>
        <para>
            Currently, Zend_Http_Client only supports basic HTTP authentication.
            This feature is utilized using the setAuth() method. The method
            takes 3 parameters: The user name, the password and an optional
            authentication type parameter. As mentioned, currently only basic
            authentication is supported (digest authentication support is
            planned).
            <example id="zend.http.client.http_authentication.example-1">
                <title>Setting HTTP Authentication User and Password</title>
                <programlisting role="php"><![CDATA[<?php
// Using basic authentication
$client->setAuth('shahar', 'myPassword!', Zend_Http_Client::AUTH_BASIC);

// Since basic auth is default, you can just do this:
$client->setAuth('shahar', 'myPassword!');]]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.http.client.multiple_requests">
        <title>Sending Multiple Requests With the Same Client</title>
        <para>
            Zend_Http_Client was also designed specifically to handle several
            consecutive requests with the same object. This is useful in cases
            where a script requires data to be fetched from several places, or
            when accessing a specific HTTP resource requires logging in and
            obtaining a session cookie, for example.
        </para>
        <para>
            When performing several requests to the same host, it is highly
            recommended to enable the 'keepalive' configuration flag. This way,
            if the server supports keep-alive connections, the connection to the
            server will only be closed once all requests are done and the Client
            object is destroyed. This prevents the overhead of opening and
            closing TCP connections to the server.
        </para>
        <para>
            When you perform several requests with the same client, but want
            to make sure all the request-specific parameters are cleared, you
            should use the resetParameters() method. This ensures that GET and
            POST parameters, request body and request-specific headers are
            reset and are not reused in the next request.
        </para>
        <note>
            <title>Reseting parameters</title>
            <para>
                Note that non-request specific headers are not reset when the
                resetParameters method is used. As a matter of fact, only the
                'Content-length' and 'Content-type' headers are reset. This
                allows you to set-and-forget headers like 'Accept-language' and
                'Accept-encoding'
            </para>
        </note>
        <para>
            Another feature designed specifically for consecutive requests is
            the Cookie Jar object. Cookie Jars allow you to automatically save
            cookies set by the server in the first request, and send them on
            consecutive requests transparently. This allows, for example, going
            through an authentication request before sending the actual data
            fetching request.
        </para>
        <para>
            If your application requires one authentication request per user,
            and consecutive requests might be performed in more than one script
            in your application, it might be a good idea to store the Cookie Jar
            object in the user's session. This way, you will only need to
            authenticate the user once every session.
        </para>
        <example id="zend.http.client.multiple_requests.example-1">
            <title>Performing consecutive requests with one client</title>
            <programlisting role="php"><![CDATA[<?php
// First, instantiate the client
$client = new Zend_Http_Client('http://www.example.com/fetchdata.php', array(
    'keepalive' => true
));

// Do we have the cookies stored in our session?
if (isset($_SESSION['cookiejar']) &&
    $_SESSION['cookiejar'] instanceof Zend_Http_CookieJar)) {

    $client->setCookieJar($_SESSION['cookiejar']);
} else {
    // If we don't, authenticate and store cookies
    $client->setCookieJar();
    $client->setUri('http://www.example.com/login.php');
    $client->setParameterPost(array(
        'user' => 'shahar',
        'pass' => 'somesecret'
    ));
    $client->request(Zend_Http_Client::POST);

    // Now, clear parameters and set the URI to the original one
    // (note that the cookies that were set by the server are now
    // stored in the jar)
    $client->resetParameters();
    $client->setUri('http://www.example.com/fetchdata.php');
}

$response = $client->request(Zend_Http_Client::GET);

// Store cookies in session, for next page
$_SESSION['cookiejar'] = $client->getCookieJar();]]>
            </programlisting>
        </example>
    </sect2>
</sect1>
<sect1 id="zend.http.client">
    <title>Zend_Http_Client - Introduction</title>

    <sect2 id="zend.http.client.introduction">
        <title>Introduction</title>
        <para>
            Zend_Http_Client provides an easy interface for preforming Hyper-Text
            Transfer Protocol (HTTP) requests. Zend_Http_Client supports most simple
            features expected from an HTTP client, as well as some more complex
            features such as HTTP authentication and file uploads. Successful
            requests (and most unsuccessful ones too) return a Zend_Http_Response
            object, which provides access to the response's headers and body (see
            <xref linkend="zend.http.response" />).
        </para>
        <para>
            The class constructor optionally accepts a URL as it's first parameter
            (can be either a string or a Zend_Uri_Http object), and an optional
            array of configuration parameters. Both can be left out,
            and set later using the setUri() and setConfig() methods.
            <example id="zend.http.client.introduction.example-1">
                <title>Instantiating a Zend_Http_Client object</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Http/Client.php';

$client = new Zend_Http_Client('http://example.org', array(
    'maxredirects' => 0,
    'timeout'      => 30));

// This is actually exactly the same:
$client = new Zend_Http_Client();
$client->setUri('http://example.org');
$client->setConfig(array(
    'maxredirects' => 0,
    'timeout'      => 30));]]>
                </programlisting>
            </example>
        </para>
    </sect2>
    <sect2 id="zend.http.client.configuration">
        <title>Configuration Parameters</title>
        <para>
            The constructor and setConfig() method accept an associative array
            of configuration parameters. Setting these parameters is optional,
            as they all have default values.
            <table id="zend.http.client.configuration.table">
                <title>Zend_Http_Client configuration parameters</title>
                <tgroup cols="4">
                    <thead>
                        <row>
                            <entry>Parameter</entry>
                            <entry>Description</entry>
                            <entry>Expected Values</entry>
                            <entry>Default Value</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>maxredirects</entry>
                            <entry>Maximum number of redirections to follow (0 = none)</entry>
                            <entry>integer</entry>
                            <entry>5</entry>
                        </row>
                        <row>
                            <entry>strict</entry>
                            <entry>When set to false, some validation functions will be skipped. Usually this should not be changed</entry>
                            <entry>boolean</entry>
                            <entry>true</entry>
                        </row>
                        <row>
                            <entry>strictredirects</entry>
                            <entry>Whether to strictly follow the RFC when redirecting (see <xref linkend="zend.http.client.redirections" />)</entry>
                            <entry>boolean</entry>
                            <entry>false</entry>
                        </row>
                        <row>
                            <entry>useragent</entry>
                            <entry>User agent identifier string (sent in request headers)</entry>
                            <entry>string</entry>
                            <entry>'Zend_Http_Client'</entry>
                        </row>
                        <row>
                            <entry>timeout</entry>
                            <entry>Connection timeout (seconds)</entry>
                            <entry>integer</entry>
                            <entry>10</entry>
                        </row>
                        <row>
                            <entry>httpversion</entry>
                            <entry>HTTP protocol version (usually '1.1' or '1.0')</entry>
                            <entry>string</entry>
                            <entry>'1.1'</entry>
                        </row>
                        <row>
                            <entry>adapter</entry>
                            <entry>Connection adapter class to use (see <xref linkend="zend.http.client.adapters" />)</entry>
                            <entry>mixed</entry>
                            <entry>'Zend_Http_Client_Adapter_Socket'</entry>
                        </row>
                        <row>
                            <entry>keepalive</entry>
                            <entry>Whether to enable keep-alive connections with the server. Useful and might improve performance if several
                            consecutive requests to the same server are performned.</entry>
                            <entry>boolean</entry>
                            <entry>false</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
    </sect2>
    <sect2 id="zend.http.client.basic-requests">
        <title>Performing Basic HTTP Requests</title>
        <para>
            Performing simple HTTP requests is very easily done using the
            request() method, and rarely needs more than three lines of code:
            <example id="zend.http.client.basic-requests.example-1">
                <title>Performing a Simple GET Request</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Http/Client.php';

$client = new Zend_Http_Client('http://example.org');
$response = $client->request();]]>
                </programlisting>
            </example>
            The request() method takes one optional parameter - the request method.
            This can be either GET, POST, PUT, HEAD, DELETE, TRACE, OPTIONS or
            CONNECT as defined by the HTTP protocol
            <footnote>
              <para>
                See RFC 2616 - <ulink url="http://www.w3.org/Protocols/rfc2616/rfc2616.html" />.
              </para>
            </footnote>.
            For convenience, these are all defined as class constants:
            Zend_Http_Request::GET, Zend_Http_Request::POST and so on.
        </para>
        <para>
            If no method is specified, the method set by the last setMethod()
            call is used. If setMethod() was never called, the default request
            method is GET (see the above example).
            <example id="zend.http.client.basic-requests.example-2">
                <title>Using Request Methods Other Than GET</title>
                <programlisting role="php"><![CDATA[<?php
// Preforming a POST request
$response = $client->request('POST');

// Yet another way of preforming a POST request
$client->setMethod(Zend_Http_Client::POST);
$response = $client->request();]]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.http.client.parameters">
        <title>Adding GET and POST parameters </title>
        <para>
            Adding GET parameters to an HTTP request is quite simple, and can
            be done either by specifying them as part of the URL, or by using
            the setParameterGet() method.
            This method takes the GET parameter's name as it's first parameter,
            and the GET parameter's value as it's second parameter.
            For convenience, the setParameterGet() method can also accept a
            single associative array of name => value GET variables - which may
            be more comfortable when several GET parameters need to be set.
            <example id="zend.http.client.parameters.example-1">
                <title>Setting GET Parameters</title>
                <programlisting role="php"><![CDATA[<?php
// Setting a get parameter using the setParameterGet method
$client->setParameterGet('knight', 'lancelot');

// This is equivalent to setting such URL:
$client->setUri('http://example.com/index.php?knight=lancelot');

// Adding several parameters with one call
$client->setParameterGet(array(
    'first_name'  => 'Bender',
    'middle_name' => 'Bending'
    'made_in'     => 'Mexico',
));]]>
                </programlisting>
            </example>
        </para>
        <para>
            While GET parameters can be sent with every request method, POST
            parameters are only sent in the body of POST requests. Adding POST
            parameters to a request is very similar to adding GET parameters,
            and can be done with the setParameterPost() method, which is
            similar to the setParameterGet() method in structure.
            <example id="zend.http.client.parameters.example-2">
                <title>Setting POST Parameters</title>
                <programlisting role="php"><![CDATA[<?php
// Setting a POST parameter
$client->setParameterPost('language', 'fr');

// Setting several POST parameters, one of them with several values
$client->setParameterPost(array(
    'language'  => 'es',
    'country'   => 'ar',
    'selection' => array(45, 32, 80)
));]]>
                </programlisting>
            </example>
            Note that when sending POST requests, you can set both GET and
            POST parameters. On the other hand, while setting POST parameters
            for a non-POST request will not trigger and error, it is useless.
            Unless the request is a POST request, POST parameters are simply
            ignored.
        </para>
    </sect2>

    <sect2 id="zend.http.client.accessing_last">
        <title>Accessing Last Request and Response</title>
        <para>
            Zend_Http_Client provides methods of accessing the last request
            sent and last response received by the client object.
            <code>Zend_Http_Client->getLastRequest()</code> takes no parameters
            and returns the last HTTP request sent by the client as a string.
            Similarly, <code>Zend_Http_Client->getLastResponse()</code> returns
            the last HTTP response received by the client as a
            <link linkend="zend.http.response">Zend_Http_Response</link> object.
        </para>
    </sect2>

</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.http.cookies">
    <title>Zend_Http_Cookie and Zend_Http_CookieJar</title>

    <sect2 id="zend.http.cookies.introduction">
        <title>Introduction</title>
        <para>
            Zend_Http_Cookie, as expected, is a class that represents an HTTP
            cookie. It provides methods for parsing HTTP response strings,
            collecting cookies, and easily accessing their properties. It also
            allows checking if a cookie matches against a specific scenario, IE
            a request URL, expiration time, secure connection, etc.
        </para>
        <para>
            Zend_Http_CookieJar is an object usually used by Zend_Http_Client to
            hold a set of Zend_Http_Cookie objects. The idea is that if a
            Zend_Http_CookieJar object is attached to a Zend_Http_Client object,
            all cookies going from and into the client through HTTP requests and
            responses will be stored by the CookieJar object. Then, when the client
            will send another request, it will first ask the CookieJar object for
            all cookies matching the request. These will be added to the request
            headers automatically. This is highly useful in cases where you need to
            maintain a user session over consecutive HTTP requests, automatically
            sending the session ID cookies when required. Additionally, the
            Zend_Http_CookieJar object can be serialized and stored in $_SESSION
            when needed.
        </para>
    </sect2>

    <sect2 id="zend.http.cookies.cookie.instantiating">
        <title>Instantiating Zend_Http_Cookie Objects</title>
        <para>
            Instantiating a Cookie object can be done in two ways:
            <itemizedlist>
                <listitem>
                    <para>
                    Through the constructor, using the following syntax:
                    <code>new Zend_Http_Cookie(string $name, string $value, string $domain, [int $expires, [string $path, [boolean $secure]]]);</code>
                    </para>
                    <itemizedlist>
                        <listitem>
                            <para>
                            <code>$name</code>: The name of the cookie (eg. 'PHPSESSID') (required)
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$value</code>: The value of the cookie  (required)
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$domain</code>: The cookie's domain (eg. '.example.com') (required)
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$expires</code>: Cookie expiration time, as UNIX time stamp (optional, defaults to null).
                            If not set, cookie will be treated as a 'session cookie' with no expiration time.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$path</code>: Cookie path, eg. '/foo/bar/' (optional, defaults to '/')
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$secure</code>: Boolean, Whether the cookie is to be sent over secure (HTTPS)
                            connections only (optional, defaults to boolean FALSE)
                            </para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>
                    By calling the fromString() static method, with a cookie string as represented in the
                    'Set-Cookie' HTTP response header or 'Cookie' HTTP request header. In this case, the
                    cookie value must already be encoded. When the cookie string does not contain a 'domain'
                    part, you must provide a reference URI according to which the cookie's domain and path
                    will be set.
                    </para>
                </listitem>
            </itemizedlist>
            <example id="zend.http.cookies.cookie.instantiating.example-1">
               <title>Instantiating a Zend_Http_Cookie object</title>
               <programlisting role="php"><![CDATA[<?php
// First, using the constructor. This cookie will expire in 2 hours
$cookie = new Zend_Http_Cookie('foo', 'bar', '.example.com', time() + 7200, '/path');

// You can also take the HTTP response Set-Cookie header and use it.
// This cookie is similar to the previous one, only it will not expire, and
// will only be sent over secure connections
$cookie = Zend_Http_Cookie::fromString('foo=bar; domain=.example.com; path=/path; secure');

// If the cookie's domain is not set, you have to manually specify it
$cookie = Zend_Http_Cookie::fromString('foo=bar; secure;', 'http://www.example.com/path');]]>
                </programlisting>
            </example>
            <note>
                <para>
                When instantiating a cookie object using the Zend_Http_Cookie::fromString() method, the
                cookie value is expected to be URL encoded, as cookie strings should be. However, when
                using the constructor, the cookie value string is expected to be the real, decoded value.
                </para>
            </note>
        </para>
        <para>
            A cookie object can be transferred back into a string, using the __toString() magic method.
            This method will produce a HTTP request "Cookie" header string, showing the cookie's name
            and value, and terminated by a semicolon (';').
            The value will be URL encoded, as expected in a Cookie header:
            <example id="zend.http.cookies.cookie.instantiating.example-2">
               <title>Stringifying a Zend_Http_Cookie object</title>
               <programlisting role="php"><![CDATA[<?php
// Create a new cookie
$cookie = new Zend_Http_Cookie('foo', 'two words', '.example.com', time() + 7200, '/path');

// Will print out 'foo=two+words;' :
echo $cookie->__toString();

// This is actually the same:
echo (string) $cookie;

// In PHP 5.2 and higher, this also works:
echo $cookie;]]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.http.cookies.cookie.accessors">
        <title>Zend_Http_Cookie getter methods</title>
        <para>
            Once a Zend_Http_Cookie object is instantiated, it provides several getter methods to get
            the different properties of the HTTP cookie:
            <itemizedlist>
                <listitem>
                    <para>
                    <code>string getName()</code>: Get the name of the cookie
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>string getValue()</code>: Get the real, decoded value of the cookie
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>string getDomain()</code>: Get the cookie's domain
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>string getPath()</code>: Get the cookie's path, which defaults to '/'
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>int getExpiryTime()</code>: Get the cookie's expiration time, as UNIX time stamp. If
                    the cookie has no expiration time set, will return NULL.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <para>
            Additionally, several boolean tester methods are provided:
            <itemizedlist>
                <listitem>
                    <para>
                    <code>boolean isSecure()</code>: Check whether the cookie is set to be sent over secure
                    connections only. Generally speaking, if true the cookie should only be sent over HTTPS.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>boolean isExpired(int $time = null)</code>: Check whether the cookie is expired or not.
                    If the cookie has no expiration time, will always return true. If $time is provided, it will
                    override the current time stamp as the time to check the cookie against.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>boolean isSessionCookie()</code>: Check whether the cookie is a "session cookie" - that
                    is a cookie with no expiration time, which is meant to expire when the session ends.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <para>
            <example id="zend.http.cookies.cookie.accessors.example-1">
                <title>Using getter methods with Zend_Http_Cookie</title>
                <programlisting role="php"><![CDATA[<?php
// First, create the cookie
$cookie = Zend_Http_Cookie::fromString('foo=two+words; domain=.example.com; path=/somedir; secure; expires=Wednesday, 28-Feb-05 20:41:22 UTC');

echo $cookie->getName();   // Will echo 'foo'
echo $cookie->getValue();  // will echo 'two words'
echo $cookie->getDomain(); // Will echo '.example.com'
echo $cookie->getPath();   // Will echo '/'

echo date('Y-m-d', $cookie->getExpiryTime());
// Will echo '2005-02-28'

echo ($cookie->isExpired() ? 'Yes' : 'No');
// Will echo 'Yes'

echo ($cookie->isExpired(strtotime('2005-01-01') ? 'Yes' : 'No');
// Will echo 'No'

echo ($cookie->isSessionCookie() ? 'Yes' : 'No');
// Will echo 'No']]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.http.cookies.cookie.matching">
        <title>Zend_Http_Cookie: Matching against a scenario</title>
        <para>
            The only real logic contained in a Zend_Http_Cookie object, is in the match() method.
            This method is used to test a cookie against a given HTTP request scenario, in order
            to tell whether the cookie should be sent in this request or not. The method has
            the following syntax and parameters:
            <code>boolean Zend_Http_Cookie->match(mixed $uri, [boolean $matchSessionCookies, [int $now]]);</code>
            <itemizedlist>
                <listitem>
                    <para>
                    <code>mixed $uri</code>: A Zend_Uri_Http object with a domain name and path to be checked.
                    Optionally, a string representing a valid HTTP URL can be passed instead. The cookie will
                    match if the URL's scheme (HTTP or HTTPS), domain and path all match.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>boolean $matchSessionCookies</code>: Whether session cookies should be matched or not.
                    Defaults to true. If set to false, cookies with no expiration time will never match.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>int $now</code>: Time (represented as UNIX time stamp) to check a cookie against
                    for expiration. If not specified, will default to the current time.
                    </para>
                </listitem>
            </itemizedlist>
            <example id="zend.http.cookies.cookie.matching.example-1">
                <title>Matching cookies</title>
                <programlisting role="php"><![CDATA[<?php
// Create the cookie object - first, a secure session cookie
$cookie = Zend_Http_Cookie::fromString('foo=two+words; domain=.example.com; path=/somedir; secure;');

$cookie->match('https://www.example.com/somedir/foo.php');
// Will return true

$cookie->match('http://www.example.com/somedir/foo.php');
// Will return false, because the connection is not secure

$cookie->match('https://otherexample.com/somedir/foo.php');
// Will return false, because the domain is wrong

$cookie->match('https://example.com/foo.php');
// Will return false, because the path is wrong

$cookie->match('https://www.example.com/somedir/foo.php', false);
// Will return false, because session cookies are not matched

$cookie->match('https://sub.domain.example.com/somedir/otherdir/foo.php');
// Will return true

// Create another cookie object - now, not secure, with expiration time in two hours
$cookie = Zend_Http_Cookie::fromString('foo=two+words; domain=www.example.com; expires=' . date(DATE_COOKIE, time() + 7200));

$cookie->match('http://www.example.com/');
// Will return true

$cookie->match('https://www.example.com/');
// Will return true - non secure cookies can go over secure connections as well!

$cookie->match('http://subdomain.example.com/');
// Will return false, because the domain is wrong

$cookie->match('http://www.example.com/', true, time() + (3 * 3600));
// Will return false, because we added a time offset of +3 hours to current time]]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.http.cookies.cookiejar">
        <title>The Zend_Http_CookieJar Class: Instantiation</title>
        <para>
            In most cases, there is no need to directly instantiate a
            Zend_Http_CookieJar object. If you want to attach a new cookie jar
            to your Zend_Http_Client object, just call the
            Zend_Http_Client->setCookieJar() method, and a new, empty cookie jar
            will be attached to your client. You could later get this cookie jar
            using Zend_Http_Client->getCookieJar().
        </para>
        <para>
            If you still wish to manually instantiate a CookieJar object, you
            can do so by calling "new Zend_Http_CookieJar()" directly - the
            constructor method does not take any parameters. Another way to
            instantiate a CookieJar object is to use the static Zend_Http_CookieJar::fromResponse()
            method. This method takes two parameters: a Zend_Http_Response object,
            and a reference URI, as either a string or a Zend_Uri_Http object.
            This method will return a new Zend_Http_CookieJar object, already
            containing the cookies set by the passed HTTP response. The reference
            URI will be used to set the cookie's domain and path, if they are
            not defined in the Set-Cookie headers.
        </para>
    </sect2>

    <sect2 id="zend.http.cookies.cookiejar.adding_cookies">
        <title>Adding Cookies to a Zend_Http_CookieJar object</title>
        <para>
            Usually, the Zend_Http_Client object you attached your CookieJar object
            to will automatically add cookies set by HTTP responses to your jar. If
            you wish to manually add cookies to your jar, this can be done by using
            two methods:
            <itemizedlist>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar->addCookie($cookie[, $ref_uri])</code>: Add a
                    single cookie to the jar. $cookie can be either a Zend_Http_Cookie
                    object or a string, which will be converted automatically into a
                    Cookie object. If a string is provided, you should also provide
                    $ref_uri - which is a reference URI either as a string or
                    Zend_Uri_Http object, to use as the cookie's default domain and path.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar->addCookiesFromResponse($response, $ref_uri)</code>:
                    Add all cookies set in a single HTTP response to the jar. $response is
                    expected to be a Zend_Http_Response object with Set-Cookie headers. $ref_uri
                    is the request URI, either as a string or a Zend_Uri_Http object, according
                    to which the cookies' default domain and path will be set.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
    </sect2>

    <sect2 id="zend.http.cookies.cookiejar.getting_cookies">
        <title>Retrieving Cookies From a Zend_Http_CookieJar object</title>
        <para>
            Just like with adding cookies, there is usually no need to manually
            fetch cookies from a CookieJar object. Your Zend_Http_Client object
            will automatically fetch the cookies required for an HTTP request
            for you. However, you can still use 3 provided methods to fetch
            cookies from the jar object: <code>getCookie()</code>,
            <code>getAllCookies()</code>, and <code>getMatchingCookies()</code>.
        </para>
        <para>
            It is important to note that each one of these methods takes a
            special parameter, which sets the return type of the method. This
            parameter can have 3 values:
            <itemizedlist>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar::COOKIE_OBJECT</code>: Return
                    a Zend_Http_Cookie object. If the method returns more than
                    one cookie, an array of objects will be returned.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar::COOKIE_STRING_ARRAY</code>: Return
                    cookies as strings, in a "foo=bar" format, suitable for sending
                    in a HTTP request "Cookie" header. If more than one cookie is
                    returned, an array of strings is returned.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar::COOKIE_STRING_CONCAT</code>: Similar to
                    COOKIE_STRING_ARRAY, but if more than one cookie is returned, this
                    method will concatenate all cookies into a single, long string
                    separated by semicolons (;), and return it. This is especially useful
                    if you want to directly send all matching cookies in a single HTTP
                    request "Cookie" header.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <para>
            The structure of the different cookie-fetching methods is described below:
            <itemizedlist>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar->getCookie($uri, $cookie_name[, $ret_as])</code>:
                    Get a single cookie from the jar, according to it's URI (domain and path)
                    and name. $uri is either a string or a Zend_Uri_Http object representing the
                    URI. $cookie_name is a string identifying the cookie name. $ret_as
                    specifies the return type as described above. $ret_type is optional, and
                    defaults to COOKIE_OBJECT.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar->getAllCookies($ret_as)</code>: Get all
                    cookies from the jar. $ret_as specifies the return type as described
                    above. If not specified, $ret_type defaults to COOKIE_OBJECT.
                    </para>
                </listitem>
                <listitem>
                    <para>
                    <code>Zend_Http_CookieJar->getMatchingCookies($uri[, $matchSessionCookies[, $ret_as[, $now]]])</code>:
                    Get all cookies from the jar that match a specified scenario, that is a URI and expiration time.
                    <itemizedlist>
                        <listitem>
                            <para>
                            <code>$uri</code> is either a Zend_Uri_Http object or a string specifying the
                            connection type (secure or non-secure), domain and path to match against.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$matchSessionCookies</code> is a boolean telling whether to match session
                            cookies or not. Session cookies are cookies that have no specified expiration
                            time. Defaults to true.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$ret_as</code> specifies the return type as described above. If not
                            specified, defaults to COOKIE_OBJECT.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                            <code>$now</code> is an integer representing the UNIX time stamp to consider
                            as "now" - that is any cookies who are set to expire before this time will
                            not be matched. If not specified, defaults to the current time.
                            </para>
                        </listitem>
                    </itemizedlist>
                    You can read more about cookie matching here:
                    <xref linkend="zend.http.cookies.cookie.matching" />.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.http.response">
    <title>Zend_Http_Response</title>

    <sect2 id="zend.http.response.introduction">
        <title>Introduction</title>
        <para>
            Zend_Http_Response provides easy access to an HTTP responses
            message, as well as a set of static methods for parsing HTTP
            response messages. Usually, Zend_Http_Response is used as an object
            returned by a Zend_Http_Client request.
        </para>
        <para>
            In most cases, a Zend_Http_Response object will be instantiated
            using the factory() method, which reads a string containing an HTTP
            response message, and returns a new Zend_Http_Response object:
            <example id="zend.http.response.introduction.example-1">
                <title>Instantiating a Zend_Http_Response object using the factory method</title>
                <programlisting role="php"><![CDATA[<?php
$str = '';
$sock = fsockopen('www.example.com', 80);
$req =     "GET / HTTP/1.1\r\n" .
        "Host: www.example.com\r\n" .
        "Connectoin: close\r\n" .
        "\r\n";

fwrite($sock, $req);
while ($buff = fread($sock, 1024))
    $str .= $sock;

$response = Zend_Http_Response::factory($str);]]>
                </programlisting>
            </example>
        </para>
        <para>
            You can also use the contractor method to create a new response
            object, by specifying all the parameters of the response:
        </para>
        <para>
            <code>
                public function __construct($code, $headers, $body = null, $version = '1.1', $message = null)
            </code>
        </para>
        <itemizedlist>
            <listitem>
                <para>
                    <code>$code</code>: The HTTP response code (eg. 200, 404, etc.)
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$headers</code>: An associative array of HTTP response headers (eg. 'Host' => 'example.com')
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$body</code>: The response body as a string
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$version</code>: The HTTP response version (usually 1.0 or 1.1)
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$message</code>: The HTTP response message (eg 'OK', 'Internal Server Error').
                    If not specified, the message will be set according to the response code
                </para>
            </listitem>
        </itemizedlist>
    </sect2>
    <sect2 id="zend.http.response.testers">
        <title>Boolean Tester Methods</title>
        <para>
            Once a Zend_Http_Response object is instantiated, it provides several
            methods that can be used to test the type of the response. These all
            return Boolean true or false:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>Boolean isSuccessful()</code>: Whether the request was successful or not. Returns
                        TRUE for HTTP 1xx and 2xx response codes
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Boolean isError()</code>: Whether the response code implies an error or not. Returns
                        TRUE for HTTP 4xx (client errors) and 5xx (server errors) response codes
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Boolean isRedirect()</code>: Whether the response is a redirection response or not. Returns
                        TRUE for HTTP 3xx response codes
                    </para>
                </listitem>
            </itemizedlist>
            <example id="zend.http.response.testers.example-1">
                <title>Using the isError() method to validate a response</title>
                <programlisting role="php"><![CDATA[<?php
if ($response->isError()) {
  echo "Error transmitting data.\n"
  echo "Server reply was: " . $response->getStatus() . " " . $response->getMessage() . "\n";
}
// .. process the response here...]]>
                </programlisting>
            </example>
        </para>
    </sect2>
    <sect2 id="zend.http.response.acessors">
        <title>Accessor Methods</title>
        <para>
            The main goal of the response object is to provide easy access to
            various response parameters.
            <itemizedlist>
                <listitem>
                    <para>
                        <code>int getStatus()</code>: Get the HTTP response status code (eg. 200, 504, etc.)
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string getMessage()</code>: Get the HTTP response status message (eg. "Not Found",
                        "Authorization Required")
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string getBody()</code>: Get the fully decoded HTTP response body
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string getRawBody()</code>: Get the raw, possibly encoded HTTP response body. If
                        the body was decoded using GZIP encoding for example, it will not be decoded.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>array getHeaders()</code>: Get the HTTP response headers as an associative array
                        (eg. 'Content-type' => 'text/html')
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string|array getHeader($header)</code>: Get a specific HTTP response header, specified
                        by $header
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string getHeadersAsString($status_line = true, $br = "\n")</code>: Get the entire
                        set of headers as a string. If $status_line is true (default), the first status
                        line (eg. "HTTP/1.1 200 OK") will also be returned. Lines are broken with the
                        $br parameter (Can be, for example, "&lt;br /&gt;")
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string asString($br = "\n")</code>: Get the entire response message as a string.
                        Lines are broken with the $br parameter (Can be, for example, "&lt;br /&gt;")
                    </para>
                </listitem>
            </itemizedlist>
            <example id="zend.http.response.acessors.example-1">
                <title>Using Zend_Http_Response Accessor Methods</title>
                <programlisting role="php"><![CDATA[<?php
if ($response->getStatus() == 200) {
  echo "The request returned the following information:<br />";
  echo $response->getBody();
} else {
  echo "An error occurred while fetching data:<br />";
  echo $response->getStatus() . ": " . $response->getMessage();
}]]>
                </programlisting>
            </example>
            <note>
                <title>Always check return value</title>
                <para>
                    Since a response can contain several instances of the same header,
                    the getHeader() method and getHeaders() method may return either a
                    single string, or an array of strings for each header. You should
                    always check whether the returned value is a string or array.
                </para>
            </note>
            <example id="zend.http.response.acessors.example-2">
                <title>Accessing Response Headers</title>
                <programlisting role="php"><![CDATA[<?php
$ctype = $response->getHeader('Content-type');
if (is_array($ctype)) $ctype = $ctype[0];

$body = $response->getBody();
if ($ctype == 'text/html' || $ctype == 'text/xml') {
  $body = htmlentities($body);
}

echo $body;]]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.http.response.static_parsers">
        <title>Static HTTP Response Parsers</title>
        <para>
            The Zend_Http_Response class also includes several internally-used
            methods for processing and parsing HTTP response messages. These
            methods are all exposed as static methods, which means they can be
            used externally, even if you do not need to instantiate a response
            object, and just want to extract a specific part of the response.
            <itemizedlist>
                <listitem>
                    <para>
                        <code>int Zend_Http_Response::extractCode($response_str)</code>: Extract
                        and return the HTTP response code (eg. 200 or 404) from $response_str
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string Zend_Http_Response::extractMessage($response_str)</code>: Extract
                        and return the HTTP response message (eg. "OK" or "File Not Found") from $response_str
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string Zend_Http_Response::extractVersion($response_str)</code>: : Extract
                        and return the HTTP version (eg. 1.1 or 1.0) from $response_str
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>array Zend_Http_Response::extractHeaders($response_str)</code>: Extract
                        and return the HTTP response headers from $response_str as an array
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string Zend_Http_Response::extractBody($response_str)</code>: Extract
                        and return the HTTP response body from $response_str
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string Zend_Http_Response::responseCodeAsText($code = null, $http11 = true)</code>:
                        Get the standard HTTP response message for a response code $code. For example,
                        will return "Internal Server Error" if $code is 500. If $http11 is true (default),
                        will return HTTP/1.1 standard messages - otherwise HTTP/1.0 messages will be returned.
                        If $code is not specified, this method will return all known HTTP response codes as an
                        associative (code => message) array.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <para>
            Apart from parser methods, the class also includes a set of decoders for common HTTP
            response transfer encodings:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>string Zend_Http_Response::decodeChunkedBody($body)</code>: Decode
                        a complete "Content-Transfer-Encoding: Chunked" body
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string Zend_Http_Response::decodeGzip($body)</code>: Decode
                        a "Content-Encoding: gzip" body
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>string Zend_Http_Response::decodeDeflate($body)</code>: Decode
                        a "Content-Encoding: deflate" body
                    </para>
                </listitem>
            </itemizedlist>
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.infocard.basics">
    <title>Introduction</title>

    <para>
        The <code>Zend_InfoCard</code> component implements relying-party
        support for Information Cards.  Infomation Cards are used for identity
        management on the internet and authentication of users to web sites
        (called relying parties). 
    </para>

    <para>
        Detailed information about information cards and their importance to the
        internet identity metasystem can be found on the <ulink
            url="http://www.identityblog.com/">IdentityBlog</ulink>
    </para>

    <sect2 id="zend.infocard.basics.theory">
        <title>Basic Theory of Usage</title>

        <para>
            Usage of <code>Zend_InfoCard</code> can be done one of two ways:
            either as part of the larger <code>Zend_Auth</code> component via
            the <code>Zend_InfoCard</code> authentication adapter or as a
            stand-alone component. In both cases an information card can be
            requested from a user by using the following HTML block in your HTML
            login form:
        </para>

        <programlisting role="html"><![CDATA[
<form action="http://example.com/server" method="POST">
  <input type='image' src='/images/ic.png' align='center' 
        width='120px' style='cursor:pointer' />
  <object type="application/x-informationCard" 
          name="xmlToken">
   <param name="tokenType" 
         value="urn:oasis:names:tc:SAML:1.0:assertion" />
   <param name="requiredClaims" 
         value="http://.../claims/privatepersonalidentifier 
         http://.../claims/givenname 
         http://.../claims/surname" />
 </object>
</form>
    ]]></programlisting>

        <para>
            In the example above, the <code>requiredClaims</code>
            <code>&lt;param&gt;</code> tag is used to identify pieces of
            information known as claims (i.e. person's first name, last name)
            which the web site (a.k.a "relying party") needs in order a user to
            authenticate using an information card. For your reference, the full
            URI (for instance the <code>givenname</code> claim) is as follows:
            <code>http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname</code>
        </para>

        <para>
            When the above HTML is activated by a user (clicks on it), the
            browser will bring up a card selection program which not only shows
            them which information cards meet the requirements of the site, but
            also allows them to select which information card to use if multiple
            meet the criteria. This information card is transmitted as an XML
            document to the specified <code>POST</code> URL and is ready to be
            processed by the <code>Zend_InfoCard</code> component.
        </para>

        <para>
            Note, Information cards can only be <code>HTTP POST</code>ed to
            SSL-encrypted URLs. Please consult your web server's documentation
            on how to set up SSL encryption.
        </para>
    </sect2>

    <sect2 id="zend.infocard.basics.auth">
        <title>Using as part of Zend_Auth</title>

        <para>
            In order to use the component as part of the <code>Zend_Auth</code>
            authentication system, you must use the provided
            <code>Zend_Auth_Adapter_InfoCard</code> to do so (not available in
            the standalone <code>Zend_InfoCard</code> distribution). An example
            of its usage is shown below:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/InfoCard/Auth/Adapter.php';
require_once 'Zend/Auth.php';

if (isset($_POST['xmlToken'])) {

    $adapter = new Zend_Auth_Adapter_InfoCard($_POST['xmlToken']);
    
    $adapter->addCertificatePair('/usr/local/Zend/apache2/conf/server.key',
                                 '/usr/local/Zend/apache2/conf/server.crt');
    
    
    $auth = Zend_Auth::getInstance();
    
    $result = $auth->authenticate($adapter);
    
    switch ($result->getCode()) {
        case Zend_Auth_Result::SUCCESS:
            $claims = $result->getIdentity();
            print "Given Name: {$claims->givenname}<br />";
            print "Surname: {$claims->surname}<br />";
            print "Email Address: {$claims->emailaddress}<br />";
            print "PPI: {$claims->getCardID()}<br />";
            break;
        case Zend_Auth_Result::FAILURE_CREDENTIAL_INVALID:
            print "The Credential you provided did not pass validation";
            break;
        default:
        case Zend_Auth_Result::FAILURE:
            print "There was an error processing your credentials.";
            break;
    }
    
    if (count($result->getMessages()) > 0) {
        print "<pre>";
        var_dump($result->getMessages());
        print "</pre>";
    }
    
    
}

?>
<hr />
<div id="login" style="font-family: arial; font-size: 2em;">
<p>Simple Login Demo</p>
 <form method="post">
  <input type="submit" value="Login" />
   <object type="application/x-informationCard" name="xmlToken">
    <param name="tokenType" 
          value="urn:oasis:names:tc:SAML:1.0:assertion" />
    <param name="requiredClaims" 
          value="http://.../claims/givenname 
                 http://.../claims/surname 
                 http://.../claims/emailaddress 
                 http://.../claims/privatepersonalidentifier" />
  </object>
 </form>
</div>
]]></programlisting>

        <para>
            In the example above, we first create an instance of the
            <code>Zend_Auth_Adapter_InfoCard</code> and pass the XML data posted
            by the card selector into it. Once an instance has been created you
            must then provide at least one SSL certificate public/private key
            pair used by the web server which received the <code>HTTP
                POST</code>.  These files are used to validate the destination
            of the information posted to the server and are a requirement when
            using Information Cards. 
        </para>

        <para>
            Once the adapter has been configured you can then use the standard
            <code>Zend_Auth</code> facilities to validate the provided
            information card token and authenticate the user by examining the
            identity provided by the <code>getIdentity()</code> method.
        </para>
    </sect2>

    <sect2 id="zend.infocard.basics.standalone">
        <title>Using the Zend_InfoCard component standalone</title>

        <para>
            It is also possible to use the Zend_InfoCard component as a
            standalone component by interacting with the
            <code>Zend_InfoCard</code> class directly. Using the Zend_InfoCard
            class is very similar to its use with the <code>Zend_Auth</code>
            component. An example of its use is shown below:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/InfoCard.php';

if (isset($_POST['xmlToken'])) {
    $infocard = new Zend_InfoCard();
    $infocard->addCertificatePair('/usr/local/Zend/apache2/conf/server.key',
                                   '/usr/local/Zend/apache2/conf/server.crt');

    $claims = $infocard->process($_POST['xmlToken']);
    
    if($claims->isValid()) {
        print "Given Name: {$claims->givenname}<br />";
        print "Surname: {$claims->surname}<br />";
        print "Email Address: {$claims->emailaddress}<br />";
        print "PPI: {$claims->getCardID()}<br />";
    } else {
        print "Error Validating identity: {$claims->getErrorMsg()}";
    }
}

?>
<hr />
<div id="login" style="font-family: arial; font-size: 2em;">
 <p>Simple Login Demo</p>
 <form method="post">
  <input type="submit" value="Login" />
   <object type="application/x-informationCard" name="xmlToken">
    <param name="tokenType" 
          value="urn:oasis:names:tc:SAML:1.0:assertion" />
    <param name="requiredClaims" 
          value="http://.../claims/givenname 
                 http://.../claims/surname 
                 http://.../claims/emailaddress 
                 http://.../claims/privatepersonalidentifier" />
   </object>
 </form>
</div>
]]></programlisting>

        <para>
            In the example above we use the <code>Zend_InfoCard</code> component
            indepdently to validate the token provided by the user. As was the
            case with the <code>Zend_Auth_Adapter_InfoCard</code>, we create an
            instance of <code>Zend_InfoCard</code> and then set one or more SSL
            certificate public/private key pairs used by the web server. Once
            configured we can use the <code>process()</code> method to process
            the information card and return the results
        </para>
    </sect2>

    <sect2 id="zend.infocard.basics.claims">
        <title>Working with a Claims object</title>

        <para>
            Regardless of if the <code>Zend_InfoCard</code> component is used as
            a standalone component or as part of <code>Zend_Auth</code> via the
            <code>Zend_Auth_Adapter_InfoCard</code>, in both cases the ultimate
            result of the processing of an information card is a
            <code>Zend_InfoCard_Claims</code> object. This object contains the
            assertions (a.k.a. claims) made by the submitting user based on the
            data requested by your web site when the user authenticated. As
            shown in the examples above, the validitiy of the information card
            can be ascertained by calling the
            <code>Zend_InfoCard_Claims::isVaild()</code> method. Claims
            themselves can either be retrieved by simply accessing the
            identifier desired (i.e. <code>givenname</code>) as a property of
            the object or through the <code>getClaim()</code> method. 
        </para>

        <para>
            In most cases you will never need to use the <code>getClaim()</code>
            method. However, if your <code>requiredClaims</code> mandate that
            you request claims from multiple different sources/namespaces then
            you will need to extract them explictally using this method (simply
            pass it the full URI of the claim to retrieve its value from within
            the information card). Generally speaking however, the
            <code>Zend_InfoCard</code> component will set the default URI for
            claims to be the one used the most frequently within the information
            card itself and the simplified property-access method can be used.
        </para>

        <para>
            As part of the validation process, it is up to the developer to
            examine the issuing source of the claims contained within the
            information card and decide if that source is a trusted source of
            information. To do so, the <code>getIssuer()</code> method is
            provided within the <code>Zend_InfoCard_Claims</code> object which
            returns the URI of the issuer of the information card claims.
        </para>
    </sect2>

    <sect2 id="zend.infocard.basics.attaching">
        <title>Attaching Information Cards to existing accounts</title>

        <para>
            It is possible to add support for information cards to an existing
            authentication system by storing the private personal identifier
            (PPI) to a previously traditionally-authenticated account and
            including at least the
            <code>http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier</code>
            claim as part of the <code>requiredClaims</code> of the request. If
            this claim is requested then the <code>Zend_InfoCard_Claims</code>
            object will provide a unique identifier for the specific card that
            was submitted by calling the <code>getCardID()</code> method.
        </para>

        <para>
            An example of how to attach an information card to an existing
            traditional-authentication account is shown below:
        </para>

        <programlisting role="php"><![CDATA[<?php
// ... 
public function submitinfocardAction() 
{
    if (!isset($_REQUEST['xmlToken'])) {
        throw new ZBlog_Exception("Expected an encrypted token but was not provided");
    }
    
    $infoCard = new Zend_InfoCard();
    $infoCard->addCertificatePair(SSL_CERTIFICATE_PRIVATE, SSL_CERTIFICATE_PUB);
    
    try {
        $claims = $infoCard->process($request['xmlToken']);
    } catch(Zend_InfoCard_Exception $e) {
        // TODO Error processing your request
        throw $e;
    }
    
    if ($claims->isValid()) {
        $db = ZBlog_Data::getAdapter();

        $ppi = $db->quote($claims->getCardID());
        $fullname = $db->quote("{$claims->givenname} {$claims->surname}");
        
        $query = "UPDATE blogusers 
                     SET ppi = $ppi, 
                         real_name = $fullname 
                   WHERE username='administrator'";
        
        try {
            $db->query($query);
        } catch(Exception $e) {
            // TODO Failed to store in DB
        }
        
        $this->view->render();
        return;
    } else {
        throw new ZBlog_Exception("Infomation card failed security checks");
    }
}
?>]]></programlisting>
    </sect2>

    <sect2 id="zend.infocard.basics.adapters">
        <title>Creating Zend_InfoCard adapters</title>

        <para>
            The <code>Zend_InfoCard</code> component was designed to allow for
            growth in the information card standard through the use of a modular
            architecture. At this time many of these hooks are unused and can be
            ignored, however there is one aspect which should be implemented in
            any serious information card implementation: The
            <code>Zend_InfoCard_Adapter</code>.
        </para>

        <para>
            The <code>Zend_InfoCard</code> adapter is used as a callback
            mechanism within the component to perform various tasks, such as
            storing and retrieving Assertion IDs for information cards when they
            are processed by the component.  While storing the assertion IDs of
            submitted information cards is not necessary, failing to do so opens
            up the possibility of the authentication scheme being compromised
            through a replay attack. 
        </para>

        <para>
            To prevent this, one must implement the
            <code>Zend_InfoCard_Adapter_Interface</code> and then set an
            instance of this interface prior to calling either the
            <code>process()</code> (standalone) or <code>authenticate()</code>
            method (as a <code>Zend_Auth</code> adapter. To set this interface
            the <code>setAdapter()</code> method is used. In the example below
            we set a <code>Zend_InfoCard</code> adapter and use it within our
            application:
        </para>

        <programlisting role="php"><![CDATA[<?php
class myAdapter implements Zend_InfoCard_Adapter_Interface 
{
    public function storeAssertion($assertionURI, $assertionID, $conditions) 
    {
        /* Store the assertion and its conditions by ID and URI */
    }
    
    public function retrieveAssertion($assertionURI, $assertionID) 
    {
        /* Retrieve the assertion by URI and ID */
    }
    
    public function removeAssertion($assertionURI, $assertionID) 
    {
        /* Delete a given assertion by URI/ID */
    }
}

$adapter  = new myAdapter();

$infoCard = new Zend_InfoCard();
$infoCard->addCertificatePair(SSL_PRIVATE, SSL_PUB);
$infoCard->setAdapter($adapter);

$claims = $infoCard->process($_POST['xmlToken']);
?>]]></programlisting>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.json.basics">
    <title>Basic Usage</title>
    <para>
        Usage of <code>Zend_Json</code> involves using the two public static
        methods available: <code>Zend_Json::encode()</code> and
        <code>Zend_Json::decode()</code>.
    </para>
    <programlisting role="php"><![CDATA[<?php
// Retrieve a value:
$phpNative = Zend_Json::decode($encodedValue);

// Encode it to return to the client:
$json = Zend_Json::encode($phpNative);]]>
    </programlisting>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.json.introduction">
    <title>Introduction</title>
    <para>
        <code>Zend_Json</code> provides convenience methods for serializing
        native PHP to JSON and decoding JSON to native PHP. For more information
        on JSON, <ulink url="http://www.json.org/">visit the JSON project
        site</ulink>.
    </para>
    <para>
        JSON, JavaScript Object Notation, can be used for data
        interchange between JavaScript and other languages. Since JSON can be
        directly evaluated by JavaScript, it is a more efficient and lightweight
        format than XML for exchanging data with JavaScript clients.
    </para>

    <para>
        In addition, <code>Zend_Json</code> provides a useful way to convert any
        arbitrary XML formatted string into a JSON formatted string. This built-in
        feature will enable PHP developers to transform the enterprise data
        encoded in XML format into JSON format before sending it to browser-based
        Ajax client applications. It provides an easy way to do dynamic data 
        conversion on the server-side code thereby avoiding unnecessary XML
        parsing in the browser-side applications. It offers a nice utility
        function that results in easier application-specific data processing techniques. 
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.json.objects">
    <title>JSON Objects</title>
    <para>
        When encoding PHP objects as JSON, all public properties of that object
        will be encoded in a JSON object.
    </para>
    <para>
        JSON does not allow object references, so care should be taken not to
        encode objects with recursive references. If you have issues with
        recursion, <code>Zend_Json::encode()</code> and
        <code>Zend_Json_Encoder::encode()</code> allow an optional second
        parameter to check for recursion; if an object is serialized twice, an
        exception will be thrown.
    </para>
    <para>
        Decoding JSON objects poses an additional difficulty, however, since
        Javascript objects correspond most closesly to PHP's associative array.
        Some suggest that a class identifier should be passed, and an object
        instance of that class should be created and populated with the
        key/value pairs of the JSON object; others feel this could pose a
        substantial security risk.
    </para>
    <para>
        By default, <code>Zend_Json</code> will decode JSON objects as
        associative arrays. However, if you desire an object returned, you can
        specify this:
    </para>
    <programlisting role="php"><![CDATA[<?php
// Decode JSON objects as PHP objects
$phpNative = Zend_Json::decode($encodedValue, Zend_Json::TYPE_OBJECT);]]>
    </programlisting>
    <para>
        Any objects thus decoded are returned as <code>StdClass</code> objects
        with properties corresponding to the key/value pairs in the JSON
        notation.
    </para>
    <para>
        The recommendation of the Zend Framework is that the individual
        developer should decide how to decode JSON objects. If an object of a
        specified type should be created, it can be created in the developer
        code and populated with the values decoded using <code>Zend_Json</code>.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.json.xml2json">
    <title>XML to JSON conversion</title>
    <para>
        <code>Zend_Json</code> provides a convenience method for transforming
        XML formatted data into JSON format. This feature was inspired from an
        <ulink url="http://www.ibm.com/developerworks/xml/library/x-xml2jsonphp/">
        IBM developerWorks article</ulink>.
    </para>

    <para>
        <code>Zend_Json</code> includes a static function called <code>Zend_Json::fromXml()</code>.
        This function will generate JSON from a given XML input. This function takes any aribitrary
        XML string as an input parameter. It also takes an optional boolean input parameter to instruct the
        conversion logic to ignore or not ignore the XML attributes during the conversion process. If this
        optional input parameter is not given, then the default behavior is to ignore the XML attributes.
        This function call is made as shown below:
    </para>
    <programlisting role="php"><![CDATA[
        // fromXml function simply takes a String containing XML contents as input.
        $jsonContents = Zend_Json::fromXml($xmlStringContents, true);?>]]>
    </programlisting>

    <para>
        <code>Zend_Json::fromXml()</code> function does the conversion of the XML formatted string input
        parameter and returns the equivalent JSON formatted string output. In case of any XML input format
        error or conversion logic error, this function will throw an exception. The conversion logic also
        uses recursive techniques to traverse the XML tree. It supports recursion upto 25 levels deep.
        Beyond that depth, it will throw a <code>Zend_Json_Exception</code>. There are several XML files with varying
        degree of complexity provided in the tests directory of the Zend Framework. They can be used to
        test the functionality of the xml2json feature.
    </para>

    <para>
        The following is a simple example that shows both the XML input string passed to
        and the JSON output string returned as a result from the
        <code>Zend_Json::fromXml()</code> function. This example used the optional function parameter as
        not to ignore the XML attributes during the conversion. Hence, you can notice that the
        resulting JSON string includes a representation of the XML attributes present in the XML input string.
    </para>

    <para>
        XML input string passed to <code>Zend_Json::fromXml()</code> function:
    </para>

    <programlisting role="php"><![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<books>
    <book id="1">
        <title>Code Generation in Action</title>
        <author><first>Jack</first><last>Herrington</last></author>
        <publisher>Manning</publisher>
    </book>

    <book id="2">
        <title>PHP Hacks</title>
        <author><first>Jack</first><last>Herrington</last></author>
        <publisher>O'Reilly</publisher>
    </book>

    <book id="3">
        <title>Podcasting Hacks</title>
        <author><first>Jack</first><last>Herrington</last></author>
        <publisher>O'Reilly</publisher>
    </book>
</books> ?>]]>
    </programlisting>

    <para>
        JSON output string returned from <code>Zend_Json::fromXml()</code> function:
    </para>

    <programlisting role="php"><![CDATA[
{
   "books" : {
      "book" : [ {
         "@attributes" : {
            "id" : "1"
         },
         "title" : "Code Generation in Action",
         "author" : {
            "first" : "Jack", "last" : "Herrington"
         },
         "publisher" : "Manning"
      }, {
         "@attributes" : {
            "id" : "2"
         },
         "title" : "PHP Hacks", "author" : {
            "first" : "Jack", "last" : "Herrington"
         },
         "publisher" : "O'Reilly"
      }, {
         "@attributes" : {
            "id" : "3"
         },
         "title" : "Podcasting Hacks", "author" : {
            "first" : "Jack", "last" : "Herrington"
         },
         "publisher" : "O'Reilly"
      }
   ]}
}  ?>]]>
    </programlisting>

    <para>
        More details about this xml2json feature can be found in the original proposal itself.
        Take a look at the
        <ulink url="http://tinyurl.com/2tfa8z">Zend_xml2json proposal</ulink>.
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.layout.advanced">
    <title>Zend_Layout Advanced Usage</title>

    <para>
        <code>Zend_Layout</code> has a number of use cases for the advanced
        developer who wishes to adapt it for different view implementations,
        file system layouts, and more.
    </para>

    <para>
        The major points of extension are:
    </para>

    <itemizedlist>
        <listitem><para>
                <emphasis>Custom view objects.</emphasis>
                <code>Zend_Layout</code> allows you to utilize any class that
                implements <code>Zend_View_Interface</code>. 
        </para></listitem>

        <listitem><para>
                <emphasis>Custom front controller plugins.</emphasis>
                <code>Zend_Layout</code> ships with a standard front controller
                plugin that automates rendering of layouts prior to returning
                the response. You can substitute your own plugin.
        </para></listitem>

        <listitem><para>
                <emphasis>Custom action helpers.</emphasis>
                <code>Zend_Layout</code> ships with a standard action helper
                that should be suitable for most needs as it is a dumb proxy
                to the layout object itself.
        </para></listitem>

        <listitem><para>
                <emphasis>Custom layout script path resolution</emphasis>.
                <code>Zend_Layout</code> allows you to use your own <link
                    linkend="zend.filter.inflector">inflector</link> for layout
                script path resolution, or simply to modify the attached
                inflector to specify your own inflection rules.
        </para></listitem>
    </itemizedlist>

    <sect2 id="zend.layout.advanced.view">
        <title>Custom View Objects</title>

        <para>
            <code>Zend_Layout</code> allows you to use any class implementing
            <code>Zend_View_Interface</code> or extending
            <code>Zend_View_Abstract</code> for rendering your layout script.
            Simply pass in your custom view object as a parameter to the
            constructor/<code>startMvc()</code>, or set it using the
            <code>setView()</code> accessor:
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new My_Custom_View();
$layout->setView($view);
?>]]></programlisting>

        <note>
            <title>Not all Zend_View implementations are equal</title>

            <para>
                While <code>Zend_Layout</code> allows you to use any class
                implementing <code>Zend_View_Interface</code>, you may run into
                issues if they can not utilize the various
                <code>Zend_View</code> helpers, particularly the layout and
                <link linkend="zend.view.helpers.initial.placeholder">placeholder</link>
                helpers. This is because <code>Zend_Layout</code> makes
                variables set in the object available via itself and
                <link linkend="zend.view.helpers.initial.placeholder">placeholders</link>. 
            </para>

            <para>
                If you need to use a custom <code>Zend_View</code>
                implementation that does not support these helpers, you will
                need to find a way to get the layout variables to the view. This
                can be done by either extending the <code>Zend_Layout</code>
                object and altering the <code>render()</code> method to pass
                variables to the view, or creating your own plugin class that
                passes them prior to rendering the layout.
            </para>

            <para>
                Alternately, if your view implementation supports any sort of
                plugin capability, you can access the variables via the
                'Zend_Layout' placeholder, using the <link linkend="zend.view.helpers.initial.placeholder">placeholder
                    helper</link>:
            </para>

            <programlisting role="php"><![CDATA[<?php
$placeholders = new Zend_View_Helper_Placeholder();
$layoutVars   = $placeholders->placeholder('Zend_Layout')->getArrayCopy();
?>]]></programlisting>
        </note>
    </sect2>

    <sect2 id="zend.layout.advanced.plugin">
        <title>Custom Front Controller Plugins</title>

        <para>
            When used with the MVC components, <code>Zend_Layout</code>
            registers a front controller plugin that renders the layout as the
            last action prior to exiting the dispatch loop. In most cases, the
            default plugin will be suitable, but should you desire to write
            your own, you can specify the name of the plugin class to load by
            passing the <code>pluginClass</code> option to the
            <code>startMvc()</code> method.
        </para>

        <para>
            Any plugin class you write for this purpose will need to extend
            <code>Zend_Controller_Plugin_Abstract</code>, and should accept a
            layout object instance as an argument to the constructor. Otherwise,
            the details of your implementation are up to you.
        </para>

        <para>
            The default plugin class used is
            <code>Zend_Layout_Controller_Plugin_Layout</code>.
        </para>
    </sect2>

    <sect2 id="zend.layout.advanced.helper">
        <title>Custom Action Helpers</title>

        <para>
            When used with the MVC components, <code>Zend_Layout</code>
            registers an action controller helper with the helper broker. The
            default helper,
            <code>Zend_Layout_Controller_Action_Helper_Layout</code>, acts as a
            dumb proxy to the layout object instance itself, and should be
            suitable for most use cases.
        </para>

        <para>
            Should you feel the need to write custom functionality, simply write
            an action helper class extending
            <code>Zend_Controller_Action_Helper_Abstract</code> and pass the
            class name as the <code>helperClass</code> option to the
            <code>startMvc()</code> method.  Details of the implementation are
            up to you.
        </para>
    </sect2>

    <sect2 id="zend.layout.advanced.inflector">
        <title>Custom Layout Script Path Resolution: Using the Inflector</title>

        <para>
            <code>Zend_Layout</code> uses <code>Zend_Filter_Inflector</code> to
            establish a filter chain for translating a layout name to a layout
            script path. By default, it uses the rules 'CamelCaseToDash'
            followed by 'StringToLower', and the suffix 'phtml' to transform the
            name to a path. As some examples:
        </para>

        <itemizedlist>
            <listitem><para>
                    'foo' will be transformed to 'foo.phtml'.
            </para></listitem>

            <listitem><para>
                    'FooBarBaz' will be transformed to 'foo-bar-baz.phtml'.
            </para></listitem>
        </itemizedlist>

        <para>
            You have three options for modifying inflection: modify the
            inflection target and/or view suffix via <code>Zend_Layout</code>
            accessors, modify the inflector rules and target of the inflector
            associated with the <code>Zend_Layout</code> instance, or create
            your own inflector instance and pass it to
            <code>Zend_Layout::setInflector()</code>.
        </para>

        <example id="zend.layout.advanced.inflector.accessors">
            <title>Using Zend_Layout accessors to modify the inflector</title>

            <para>
                The default <code>Zend_Layout</code> inflector uses static
                references for the target and view script suffix, and 
                has accessors for setting these values.
            </para>

            <programlisting role="php"><![CDATA[<?php
// Set the inflector target:
$layout->setInflectorTarget('layouts/:script.:suffix');

// Set the layout view script suffix:
$layout->setViewSuffix('php');
?>]]></programlisting>
        </example>

        <example id="zend.layout.advanced.inflector.directmodification">
            <title>Direct modification of Zend_Layout inflector</title>

            <para>
                Inflectors have a target and one or more rules. The default
                target used with <code>Zend_Layout</code> is ':script.:suffix';
                ':script' is passed the registered layout name, while ':suffix'
                is a static rule of the inflector.
            </para>

            <para>
                Let's say you want the layout script to end in the suffix
                'html', and that you want to separate MixedCase and camelCased words with
                underscores instead of dashes, and not lowercase the name.
                Additionally, you want it to look in a 'layouts' subdirectory
                for the script.
            </para>

            <programlisting role="php"><![CDATA[<?php
$layout->getInflector()->setTarget('layouts/:script.:suffix')
                       ->setStaticRule('suffix', 'html')
                       ->setFilterRule(array('CamelCaseToUnderscore'));
?>]]></programlisting>
        </example>

        <example id="zend.layout.advanced.inflector.custom">
            <title>Custom inflectors</title>

            <para>
                In most cases, modifying the existing inflector will be enough.
                However, you may have an inflector you wish to use in several
                places, with different objects of different types.
                <code>Zend_Layout</code> supports this.
            </para>

            <programlisting role="php"><![CDATA[<?php
$inflector = new Zend_Filter_Inflector('layouts/:script.:suffix');
$inflector->addRules(array(
    ':script' => array('CamelCaseToUnderscore'),
    'suffix'  => 'html'
));
$layout->setInflector($inflector);
?>]]></programlisting>
        </example>

        <note>
            <title>Inflection can be disabled</title>

            <para>
                Inflection can be disabled and enabled using accessors on the
                <code>Zend_Layout</code> object. This can be useful if you want
                to specify an absolute path for a layout view script, or know
                that the mechanism you will be using for specifying the layout
                script does not need inflection. Simply use the
                <code>enableInflection()</code> and
                <code>disableInflection()</code> methods.
            </para>
        </note>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.layout.introduction">
    <title>Introduction</title>

    <para>
        <code>Zend_Layout</code> implements a classic Two Step View pattern,
        allowing developers to wrap application content within another view,
        usually representing the site template. Such templates are often termed
        <emphasis>layouts</emphasis> by other projects, and Zend Framework has
        adopted this term for consistency.
    </para>

    <para>
        The main goals of <code>Zend_Layout</code> are as follows:
    </para>

    <itemizedlist>
        <listitem><para>
                Automate selection and rendering of layouts when used with the
                Zend Framework MVC components.
        </para></listitem>

        <listitem><para>
                Provide separate scope for layout related variables and content.
        </para></listitem>

        <listitem><para>
                Allow configuration, including layout name, layout script
                resolution (inflection), and layout script path.
        </para></listitem>

        <listitem><para>
                Allow disabling layouts, changing layout scripts, and other
                states; allow these actions from within action controllers and
                view scripts.
        </para></listitem>

        <listitem><para>
                Follow same script resolution rules (inflection) as the <link
                linkend="zend.controller.actionhelpers.viewrenderer">ViewRenderer</link>,
                but allow them to also use different rules.
        </para></listitem>

        <listitem><para>
                Allow usage without Zend Framework MVC components.
        </para></listitem>
    </itemizedlist>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.layout.options">
    <title>Zend_Layout Configuration Options</title>

    <para>
        <code>Zend_Layout</code> has a variety of configuration options. These
        may be set by calling the appropriate accessors, passing an array or
        <code>Zend_Config</code> object to the constructor or
        <code>startMvc()</code>, passing an array of options to
        <code>setOptions()</code>, or passing a <code>Zend_Config</code> object
        to <code>setConfig()</code>.
    </para>

    <itemizedlist>
        <listitem><para>
                <emphasis>layout</emphasis>: the layout to use. Uses the
                current inflector to resolve the name provided to the
                appropriate layout view script. By default, this value is
                'layout' and resolves to 'layout.phtml'. Accessors
                are <code>setLayout()</code> and <code>getLayout()</code>.
        </para></listitem>

        <listitem><para>
                <emphasis>layoutPath</emphasis>: the base path to layout view
                scripts. Accessors are <code>setLayoutPath()</code> and
                <code>getLayoutPath()</code>.
        </para></listitem>

        <listitem><para>
                <emphasis>contentKey</emphasis>: the layout variable used for
                default content (when used with the MVC). Default value is
                'content'. Accessors are <code>setContentKey()</code> and
                <code>getContentKey()</code>.
        </para></listitem>

        <listitem><para>
                <emphasis>mvcSuccessfulActionOnly</emphasis>: when using the
                MVC, if an action throws an exception and this flag is true, the
                layout will not be rendered (this is to prevent double-rendering
                of the layout when the <link linkend="zend.controller.plugins.standard.errorhandler">ErrorHandler
                plugin</link> is in use). By default, the flat is true.
                Accessors are <code>setMvcSuccessfulActionOnly()</code> and
                <code>getMvcSuccessfulActionOnly()</code>.
        </para></listitem>

        <listitem><para>
                <emphasis>view</emphasis>: the view object to use when
                rendering. When used with the MVC, <code>Zend_Layout</code> will
                attempt to use the view object registered with <link
                    linkend="zend.controller.actionhelpers.viewrenderer">the
                    ViewRenderer</link> if no view object has been passed to it
                explicitly. Accessors are <code>setView()</code> and
                <code>getView()</code>.
        </para></listitem>

        <listitem><para>
                <emphasis>helperClass</emphasis>: the action helper class to use
                when using <code>Zend_Layout</code> with the MVC components. By
                default, this is
                <code>Zend_Layout_Controller_Action_Helper_Layout</code>.
                Accessors are <code>setHelperClass()</code> and
                <code>getHelperClass()</code>.
        </para></listitem>

        <listitem><para>
                <emphasis>pluginClass</emphasis>: the front controller plugin
                class to use when using <code>Zend_Layout</code> with the MVC
                components. By default, this is
                <code>Zend_Layout_Controller_Plugin_Layout</code>.  Accessors
                are <code>setPluginClass()</code> and
                <code>getPluginClass()</code>.
        </para></listitem>

        <listitem><para>
                <emphasis>inflector</emphasis>: the inflector to use when
                resolving layout names to layout view script paths; see <link
                    linkend="zend.layout.advanced.inflector">the
                    <code>Zend_Layout</code> inflector documentation for more
                    details</link>. Accessors are <code>setInflector()</code>
                and <code>getInflector()</code>.
        </para></listitem>
    </itemizedlist>

    <note>
        <title>helperClass and pluginClass must be passed to startMvc()</title>

        <para>
            In order for the <code>helperClass</code> and
            <code>pluginClass</code> settings to have effect, they must be
            passed in as options to <code>startMvc()</code>; if set later, they
            have no affect.
        </para>
    </note>

    <sect2 id="zend.layout.options.examples">
        <title>Examples</title>

        <para>
            The following examples assume the following <code>$options</code>
            array and <code>$config</code> object:
        </para>

        <programlisting role="php"><![CDATA[<?php
$options = array(
    'layout'     => 'foo',
    'layoutPath' => '/path/to/layouts',
    'contentKey' => 'CONTENT',           // ignored when MVC not used
);
?>]]></programlisting>

        <programlisting role="php"><![CDATA[<?php
/**
[layout]
layout = "foo"
layoutPath = "/path/to/layouts"
contentKey = "CONTENT"
*/
$config = new Zend_Config_Ini('/path/to/layout.ini', 'layout');
?>]]></programlisting>

        <example id="zend.layout.options.examples.constructor">
            <title>Passing options to the constructor or startMvc()</title>

            <para>
                Both the constructor and the <code>startMvc()</code> static
                method can accept either an array of options or a
                <code>Zend_Config</code> object with options in order to
                configure the <code>Zend_Layout</code> instance.
            </para>

            <para>
                First, let's look at passing an array:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Using constructor:
$layout = new Zend_Layout($options);

// Using startMvc():
$layout = Zend_Layout::startMvc($options);
?>]]></programlisting>

            <para>
                And now using a config object:
            </para>

            <programlisting role="php"><![CDATA[<?php 
$config = new Zend_Config_Ini('/path/to/layout.ini', 'layout');

// Using constructor:
$layout = new Zend_Layout($config);

// Using startMvc():
$layout = Zend_Layout::startMvc($config);
?>]]></programlisting>

            <para>
                Basically, this is the easiest way to customize your
                <code>Zend_Layout</code> instance.
            </para>
        </example>

        <example id="zend.layout.options.examples.setoptionsconfig">
            <title>Using setOption() and setConfig()</title>

            <para>
                Sometimes you need to configure the <code>Zend_Layout</code>
                object after it has already been instantiated;
                <code>setOptions()</code> and <code>setConfig()</code> give you
                a quick and easy way to do so:
            </para>

            <programlisting role="php"><![CDATA[<?php
// Using an array of options:
$layout->setOptions($options);

// Using a Zend_Config object:
$layout->setConfig($options);
?>]]></programlisting>
        
            <para>
                Note, however, that certain options, such as
                <code>pluginClass</code> and <code>helperClass</code>, will have
                no affect when passed using this method; they need to be passed
                to the constructor or <code>startMvc()</code> method.
            </para>
        </example>

        <example id="zend.layout.options.examples.accessors">
            <title>Using Accessors</title>

            <para>
                Finally, you can also configure your <code>Zend_Layout</code>
                instance via accessors. All accessors implement a fluent
                interface, meaning their calls may be chained:
            </para>

            <programlisting role="php"><![CDATA[<?php
$layout->setLayout('foo')
       ->setLayoutPath('/path/to/layouts')
       ->setContentKey('CONTENT');
?>]]></programlisting>
        </example>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.layout.quickstart">
    <title>Zend_Layout Quick Start</title>

    <para>
        There are two primary use cases for <code>Zend_Layout</code>: with the
        Zend Framework MVC, and without.
    </para>

    <sect2 id="zend.layout.quickstart.layouts">
        <title>Layout scripts</title>

        <para>
            In both cases, however, you'll need to create a layout script.
            Layout scripts simply utilize Zend_View (or whatever view
            implementation you are using). Layout variables are registered with
            a <code>Zend_Layout</code> <link linkend="zend.view.helpers.initial.placeholder">placeholder</link>, 
            and may be accessed via the placeholder helper or by fetching them
            as object properties of the layout object via the layout helper.
        </para>

        <para>
            As an example:
        </para>

        <programlisting role="php"><![CDATA[
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>My Site</title>
</head>
<body>
<?php 
    // fetch 'content' key using layout helper:
    echo $this->layout()->content; 

    // fetch 'foo' key using placeholder helper:
    echo $this->placeholder('Zend_Layout')->foo;

    // fetch layout object and retrieve various keys from it:
    $layout = $this->layout();
    echo $layout->bar;
    echo $layout->baz;
?>
</body>
</html>
]]></programlisting>

        <para>
            Because <code>Zend_Layout</code> utilizes <code>Zend_View</code> for
            rendering, you can also use any view helpers registered, and also
            have access to any previously assigned view variables. Particularly
            useful are the various <link
                linkend="zend.view.helpers.initial.placeholder">placeholder
                helpers</link>, as they allow you to
            retrieve content for areas such as the &lt;head&gt; section,
            navigation, etc.:
        </para>

        <programlisting role="php"><![CDATA[
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <?= $this->headTitle() ?>
    <?= $this->headScript() ?>
    <?= $this->headStyle() ?>
</head>
<body>
    <?= $this->render('header.phtml') ?>

    <div id="nav"><?= $this->placeholder('nav') ?></div>

    <div id="content"><?= $this->layout()->content ?></div>

    <?= $this->render('footer.phtml') ?>
</body>
</html>
]]></programlisting>
    </sect2>

    <sect2 id="zend.layout.quickstart.mvc">
        <title>Using Zend_Layout with the Zend Framework MVC</title>

        <para>
            <code>Zend_Controller</code> offers a rich set of functionality for
            extension via its <link linkend="zend.controller.plugins">front
            controller plugins</link> and <link
            linkend="zend.controller.actionhelpers">action controller
            helpers</link>. <code>Zend_View</code> also has <link
            linkend="zend.view.helpers">helpers</link>. <code>Zend_Layout</code>
            takes advantage of these various extension points when used with the
            MVC components.
        </para>

        <para>
            <code>Zend_Layout::startMvc()</code> creates an instance of
            <code>Zend_Layout</code> with any optional configuration you provide
            it. It then registers a front controller plugin that renders the
            layout with any application content once the dispatch loop is done,
            and registers an action helper to allow access to the layout object
            from your action controllers. Additionally, you may at any time grab
            the layout instance from within a view script using the
            <code>layout</code> view helper.
        </para>

        <para>
            First, let's look at how to initialize Zend_Layout for use with the
            MVC:
        </para>

        <programlisting role="php"><![CDATA[<?php
// In your bootstrap:
Zend_Layout::startMvc();
?>]]></programlisting>
        
        <para>
            <code>startMvc()</code> can take an optional array of options or
            <code>Zend_Config</code> object to customize the instance; these
            options are detailed in <xref linkend="zend.layout.options" />.
        </para>

        <para>
            In an action controller, you may then access the layout instance as
            an action helper:
        </para>

        <programlisting role="php"><![CDATA[<?php
class FooController extends Zend_Controller_Action
{
    public function barAction()
    {
        // disable layouts for this action:
        $this->_helper->layout->disableLayout();
    }

    public function bazAction()
    {
        // use different layout script with this action:
        $this->_helper->layout->setLayout('foobaz');
    };
}
?>]]></programlisting>

        <para>
            In your view scripts, you can then access the layout object via the
            <code>layout</code> view helper. This view helper is slightly
            different than others in that it takes no arguments, and returns an
            object instead of a string value. This allows you to immediately
            call methods on the layout object:
        </para>

        <programlisting role="php"><![CDATA[
<?php $this->layout()->setLayout('foo'); // set alternate layout ?>
]]></programlisting>

        <para>
            At any time, you can fetch the <code>Zend_Layout</code> instance
            registered with the MVC via the <code>getMvcInstance()</code> static
            method:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Returns null if startMvc() has not first been called
$layout = Zend_Layout::getMvcInstance(); 
?>]]></programlisting>

        <para>
            Finally, <code>Zend_Layout</code>'s front controller plugin has one
            important feature in addition to rendering the layout: it retrieves
            all named segments from the response object and assigns them as
            layout variables, assigning the 'default' segment to the variable
            'content'. This allows you to access your application content and
            render it in your view scripts.
        </para>

        <para>
            As an example, let's say your code first hits
            <code>FooController::indexAction()</code>, which renders some
            content to the default response segment, and then forwards to
            <code>NavController::menuAction()</code>, which renders content to
            the 'nav' response segment. Finally, you forward to
            <code>CommentController::fetchAction()</code> and fetch some
            comments, but render those to the default response segment as well
            (which appends content to that segment). Your view script could then
            render each separately:
        </para>

        <programlisting role="php"><![CDATA[
<body>
    <!-- renders /nav/menu -->
    <div id="nav"><?= $this->layout()->nav ?></div>

    <!-- renders /foo/index + /comment/fetch -->
    <div id="content"><?= $this->layout()->content ?></div>
</body>
]]></programlisting>
        
        <para>
            This feature is particularly useful when used in conjunction with
            the ActionStack <link linkend="zend.controller.actionhelpers.actionstack">action
            helper</link> and <link
            linkend="zend.controller.plugins.standard.actionstack">plugin</link>,
            which you can use to setup a stack of actions through
            which to loop, and thus create widgetized pages.
        </para>
    </sect2>

    <sect2 id="zend.layout.quickstart.standalone">
        <title>Using Zend_Layout as a Standalone Component</title>

        <para>
            As a standalone component, Zend_Layout does not offer nearly as many
            features or as much convenience as when used with the MVC. However,
            it still has two chief benefits:
        </para>

        <itemizedlist>
            <listitem><para>
                    Scoping of layout variables.
            </para></listitem>

            <listitem><para>
                    Isolation of layout view script from other view scripts.
            </para></listitem>
        </itemizedlist>

        <para>
            When used as a standalone component, simply instantiate the layout
            object, use the various accessors to set state, set variables as
            object properties, and render the layout:
        </para>

        <programlisting role="php"><![CDATA[<?php
$layout = new Zend_Layout();

// Set a layout script path:
$layout->setLayoutPath('/path/to/layouts');

// set some variables:
$layout->content = $content;
$layout->nav     = $nav;

// choose a different layout script:
$layout->setLayout('foo');

// render final layout
echo $layout->render();
?>]]></programlisting>
    </sect2>

    <sect2 id="zend.layout.quickstart.example">
        <title>Sample Layout</title>

        <para>
            Sometimes a picture is worth a thousand words. The following is a
            sample layout script showing how it might all come together.
        </para>

         <para>
            <inlinegraphic align="center" valign="middle"
                fileref="figures/zend.layout.quickstart.example.png" format="PNG" />
        </para>

        <para>
            The actual order of elements may vary, depending on the CSS you've
            setup; for instance, if you're using absolute positioning, you may
            be able to have the navigation displayed later in the document, but
            still show up at the top; the same could be said for the sidebar or
            header. The actual mechanics of pulling the content remain the same,
            however.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.ldap.using">

    <title>Introduction</title>

    <note>
        <title>Minimal Functionality</title>
        <para>
            Currently this class is designed only to satisfy the limited functionality necessary for the
            <link linkend="zend.auth.adapter.ldap"><code>Zend_Auth_Adapter_Ldap</code></link> authentication adapter.
            Operations such as searching, creating, modifying or renaming entries in the directory are currently not
            supported and will be defined at a later time.
        </para>
    </note>

    <para>
        <code>Zend_Ldap</code> is a class for performing LDAP operations including but not limited to binding,
        searching and modifying entries in an LDAP directory.
    </para>

    <sect2 id="zend.ldap.using.theory-of-operation">

        <title>Theory of Operation</title>

        <para>
            This component currently consists of two classes, <code>Zend_Ldap</code> and
            <code>Zend_Ldap_Exception</code>. The <code>Zend_Ldap</code> class conceptually represents a binding to a
            single LDAP server. The parameters for binding may be provided explicitly or in the form of an options
            array.
        </para>

        <para>
            Using the <code>Zend_Ldap</code> class depends on the type of LDAP server and is best summarized with some
            simple examples.
        </para>

        <para>
            If you are using OpenLDAP, a simple example looks like the following (note that the
            <code>bindRequiresDn</code> option is important if you are <emphasis>not</emphasis> using AD):

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Ldap.php';

$options = array(
    'host' => 's0.foo.net',
    'username' => 'CN=user1,DC=foo,DC=net',
    'password' => 'pass1',
    'bindRequiresDn' => true,
    'accountDomainName' => 'foo.net',
    'baseDn' => 'OU=Sales,DC=foo,DC=net',
);
$ldap = new Zend_Ldap($options);
$acctname = $ldap->getCanonicalAccountName('abaker', Zend_Ldap::ACCTNAME_FORM_DN);
echo "$acctname\n";]]></programlisting>

        </para>

        <para>
            If you are using Microsoft AD a simple example is:

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Ldap.php';

$options = array(
    'host' => 'dc1.w.net',
    'useSsl' => true,
    'username' => 'user1@w.net',
    'password' => 'pass1',
    'accountDomainName' => 'w.net',
    'accountDomainNameShort' => 'W',
    'baseDn' => 'CN=Users,DC=w,DC=net',
);
$ldap = new Zend_Ldap($options);
$acctname = $ldap->getCanonicalAccountName('bcarter', Zend_Ldap::ACCTNAME_FORM_DN);
echo "$acctname\n";]]></programlisting>

            Note that we use the <code>getCanonicalAccountName()</code> method to retrieve the account DN here only
            because that is what exercises the most of what little code is currently present in this class.
        </para>

        <sect3 id="zend.ldap.using.theory-of-operation.username-canonicalization-automatic">

            <title>Automatic Username Canonicalization When Binding</title>

            <para>
                If <code>bind()</code> is called with a non-DN username but <code>bindRequiresDN</code> is
                <code>true</code> and no username in DN form was supplied as an option, the bind will fail. However, if
                a username in DN form is supplied in the options array, <code>Zend_Ldap</code> will first bind with
                that username, retrieve the account DN for the username supplied to <code>bind()</code> and then re-
                bind with that DN.
            </para>

            <para>
                This behavior is critical to <code>Zend_Auth_Adapter_Ldap</code>, which passes the username supplied by
                the user directly to <code>bind()</code>.
            </para>

            <para>
                The following example illustrates how the non-DN username '<code>abaker</code>' can be used with
                <code>bind()</code>:

                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Ldap.php';

$options = array(
        'host' => 's0.foo.net',
        'username' => 'CN=user1,DC=foo,DC=net',
        'password' => 'pass1',
        'bindRequiresDn' => true,
        'accountDomainName' => 'foo.net',
        'baseDn' => 'OU=Sales,DC=foo,DC=net',
);
$ldap = new Zend_Ldap($options);
$ldap->bind('abaker', 'moonbike55');
$acctname = $ldap->getCanonicalAccountName('abaker', Zend_Ldap::ACCTNAME_FORM_DN);
echo "$acctname\n";]]></programlisting>

                The <code>bind()</code> call in this example sees that the username '<code>abaker</code>' is not in DN
                form, finds <code>bindRequiresDn</code> is <code>true</code>, uses
                '<code>CN=user1,DC=foo,DC=net</code>' and '<code>pass1</code>' to bind, retrieves the DN for
                '<code>abaker</code>', unbinds and then rebinds with the newly discovered
                '<code>CN=Alice Baker,OU=Sales,DC=foo,DC=net</code>'.
            </para>

        </sect3>

        <sect3 id="zend.ldap.using.theory-of-operation.options">

            <title>Zend_Ldap Options</title>

            <para>
                The <code>Zend_Ldap</code> component accepts an array of options either supplied to the constructor or
                through the <code>setOptions()</code> method. The permitted options are as follows:

                <table id="zend.ldap.using.theory-of-operation.options.table">
                  <title>Zend_Ldap Options</title>
                  <tgroup cols="2">
                    <thead>
                      <row>
                        <entry>Name</entry>
                        <entry>Description</entry>
                      </row>
                    </thead>
                    <tbody>
                      <row>
                        <entry>host</entry>
                        <entry>
                            The default hostname of LDAP server if not supplied to <code>connect()</code> (also may be
                            used when trying to canonicalize usernames in <code>bind()</code>).
                        </entry>
                      </row>
                      <row>
                        <entry>port</entry>
                        <entry>
                            Default port of LDAP server if not supplied to <code>connect()</code>.
                        </entry>
                      </row>
                      <row>
                        <entry>useSsl</entry>
                        <entry>
                            Whether or not the LDAP client should use SSL / TLS encrypted transport. A value of
                            <code>true</code> is strongly favored in production environments to prevent passwords from
                            be transmitted in clear text. The default value is <code>false</code>, as servers
                            frequently require that a certificate be installed separately after installation.
                        </entry>
                      </row>
                      <row>
                        <entry>username</entry>
                        <entry>
                            The default credentials username. Some servers require that this be in DN form.
                        </entry>
                      </row>
                      <row>
                        <entry>password</entry>
                        <entry>
                            The default credentials password (used only with username above).
                        </entry>
                      </row>
                      <row>
                        <entry>bindRequiresDn</entry>
                        <entry>
                            If <code>true</code>, this instructs <code>Zend_Ldap</code> to retrieve the DN for the
                            account used to bind if the username is not already in DN form. The default value is
                            <code>false</code>.
                        </entry>
                      </row>
                      <row>
                        <entry>baseDn</entry>
                        <entry>
                            The default base DN used for searching (e.g., for accounts). This option is required for
                            most account related operations and should indicate the DN under which accounts are
                            located.
                        </entry>
                      </row>
                      <row>
                        <entry>accountCanonicalForm</entry>
                        <entry>
                            A small integer indicating the form to which account names should be canonicalized. See the
                            <emphasis>Account Name Canonicalization</emphasis> section below.
                        </entry>
                      </row>
                      <row>
                        <entry>accountDomainName</entry>
                        <entry>
                            The FQDN domain for which the target LDAP server is an authority (e.g., example.com).
                        </entry>
                      </row>
                      <row>
                        <entry>accountDomainNameShort</entry>
                        <entry>
                            The 'short' domain for which the target LDAP server is an authority. This is usually used
                            to specify the NetBIOS domain name for Windows networks but may also be used by non-AD
                            servers.
                        </entry>
                      </row>
                      <row>
                        <entry>accountFilterFormat</entry>
                        <entry>
                            The LDAP search filter used to search for accounts. This string is a
                            <ulink url="http://php.net/printf"><code>printf()</code></ulink> style expression that must
                            contain one '<code>%s</code>' to accomodate the username. The default value is
                            '<code>(&amp;(objectClass=user)(sAMAccountName=%s))</code>' unless
                            <code>bindRequiresDn</code> is set to <code>true</code>, in which case the default is
                            '<code>(&amp;(objectClass=posixAccount)(uid=%s))</code>'. Users of custom schemas may need
                            to change this option.
                        </entry>
                      </row>
                    </tbody>
                  </tgroup>
                </table>

            </para>

        </sect3>

        <sect3 id="zend.ldap.using.theory-of-operation.account-name-canonicalization">

            <title>Account Name Canonicalization</title>

            <para>
                The <code>accountDomainName</code> and <code>accountDomainNameShort</code> options are used for two
                purposes: (1) they facilitate multi-domain authentication and failover capability, and (2) they are
                also used to canonicalize usernames. Specifically, names are canonicalized to the form specified by the
                <code>accountCanonicalForm</code> option. This option may one of the following values:

                <table id="zend.ldap.using.theory-of-operation.account-name-canonicalization.table">
                  <title><code>accountCanonicalForm</code></title>
                  <tgroup cols="3">
                    <thead>
                      <row>
                        <entry>Name</entry>
                        <entry>Value</entry>
                        <entry>Example</entry>
                      </row>
                    </thead>
                    <tbody>
                      <row>
                        <entry><code>ACCTNAME_FORM_DN</code></entry>
                        <entry>1</entry>
                        <entry>CN=Alice Baker,CN=Users,DC=example,DC=com</entry>
                      </row>
                      <row>
                        <entry><code>ACCTNAME_FORM_USERNAME</code></entry>
                        <entry>2</entry>
                        <entry>abaker</entry>
                      </row>
                      <row>
                        <entry><code>ACCTNAME_FORM_BACKSLASH</code></entry>
                        <entry>3</entry>
                        <entry>EXAMPLE\abaker</entry>
                      </row>
                      <row>
                        <entry><code>ACCTNAME_FORM_PRINCIPAL</code></entry>
                        <entry>4</entry>
                        <entry>abaker@example.com</entry>
                      </row>
                    </tbody>
                  </tgroup>
                </table>

            </para>

            <para>
                The default canonicalization depends on what account domain name options were supplied. If
                <code>accountDomainNameShort</code> was supplied, the default <code>accountCanonicalForm</code> value
                is <code>ACCTNAME_FORM_BACKSLASH</code>. Otherwise, if <code>accountDomainName</code> was supplied, the
                default is <code>ACCTNAME_FORM_PRINCIPAL</code>.
            </para>

            <para>
                Account name canonicalization ensures that the string used to identify an account is consistent
                regardless of what was supplied to <code>bind()</code>. For example, if the user supplies an account
                name of <emphasis>abaker@example.com</emphasis> or just <emphasis>abaker</emphasis> and the
                <code>accountCanonicalForm</code> is set to 3, the resulting canonicalized name would be
                <emphasis>EXAMPLE\abaker</emphasis>.
            </para>

        </sect3>

        <sect3 id="zend.ldap.using.theory-of-operation.multi-domain-failover">

            <title>Multi-domain Authentication and Failover</title>

            <para>
                The <code>Zend_Ldap</code> component by itself makes no attempt to authenticate with multiple servers.
                However, <code>Zend_Ldap</code> is specifically designed to handle this scenario gracefully. The
                required technique is to simply iterate over an array of arrays of server options and attempt to bind
                with each server. As described above <code>bind()</code> will automatically canonicalize each name, so
                it does not matter if the user passes <code>abaker@foo.net</code> or <code>W\bcarter</code> or
                <code>cdavis</code> - the <code>bind()</code> method will only succeed if the credentials were
                successfully used in the bind.
            </para>

            <para>
                Consider the following example that illustrates the technique required to implement multi-domain
                authentication and failover:

                <programlisting role="php"><![CDATA[<?php
$acctname = 'W\\user2';
$password = 'pass2';

$multiOptions = array(
    'server1' => array(
        'host' => 's0.foo.net',
        'username' => 'CN=user1,DC=foo,DC=net',
        'password' => 'pass1',
        'bindRequiresDn' => true,
        'accountDomainName' => 'foo.net',
        'accountDomainNameShort' => 'FOO',
        'accountCanonicalForm' => 4, // ACCT_FORM_PRINCIPAL
        'baseDn' => 'OU=Sales,DC=foo,DC=net',
    ),
    'server2' => array(
        'host' => 'dc1.w.net',
        'useSsl' => true,
        'username' => 'user1@w.net',
        'password' => 'pass1',
        'accountDomainName' => 'w.net',
        'accountDomainNameShort' => 'W',
        'accountCanonicalForm' => 4, // ACCT_FORM_PRINCIPAL
        'baseDn' => 'CN=Users,DC=w,DC=net',
    ),
);

$ldap = new Zend_Ldap();

foreach ($multiOptions as $name => $options) {

    echo "Trying to bind using server options for '$name'\n";

    $ldap->setOptions($options);
    try {
        $ldap->bind($acctname, $password);
        $acctname = $ldap->getCanonicalAccountName($acctname);
        echo "SUCCESS: authenticated $acctname\n";
        return;
    } catch (Zend_Ldap_Exception $zle) {
        echo '  ' . $zle->getMessage() . "\n";
        if ($zle->getCode() === Zend_Ldap_Exception::LDAP_X_DOMAIN_MISMATCH) {
            continue;
        }
    }
}]]></programlisting>

                If the bind fails for any reason, the next set of server options is tried.
            </para>

            <para>
                The <code>getCanonicalAccountName</code> call gets the canonical account name that the application
                would presumably use to associate data with such as preferences. The
                <code>accountCanonicalForm = 4</code> in all server options ensures that the canonical form is
                consistent regardless of which server was ultimately used.
            </para>

            <para>
                The special <code>LDAP_X_DOMAIN_MISMATCH</code> exception occurs when an account name with a domain
                component was supplied (e.g., <code>abaker@foo.net</code> or <code>FOO\abaker</code> and not just
                <code>abaker</code>) but the domain component did not match either domain in the currently selected
                server options. This exception indicates that the server is not an authority for the account. In this
                case, the bind will not be performed, thereby eliminating unnecessary communication with the server.
                Note that the <code>continue</code> instruction has no effect in this example, but in practice for
                error handling and debugging purposes, you will probably want to check for
                <code>LDAP_X_DOMAIN_MISMATCH</code> as well as <code>LDAP_NO_SUCH_OBJECT</code> and
                <code>LDAP_INVALID_CREDENTIALS</code>.
            </para>

            <para>
                The above code is very similar to code used within
                <link linkend="zend.auth.adapter.ldap"><code>Zend_Auth_Adapter_Ldap</code></link>. In fact, we
                recommend that you simply use that authentication adapter for multi-domain + failover LDAP based
                authentication (or copy the code).
            </para>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.loader.pluginloader">
    <title>Loading Plugins</title>

    <para>
        A number of Zend Framework components are pluggable, and allow loading
        of dynamic functionality by specifying a class prefix and path to class
        files that are not necessarily on the <code>include_path</code> or do
        not necessarily follow traditional naming conventions.
        <code>Zend_Loader_PluginLoader</code> provides common functionality for
        this process.
    </para>

    <para>
        The basic usage of the <code>PluginLoader</code> follows Zend Framework
        naming conventions of one class per file, using the underscore as a
        directory separator when resolving paths. It allows passing an optional
        class prefix to prepend when determining if a particular plugin class is
        loaded. Additionally, paths are searched in LIFO order. Due to the LIFO
        search and the class prefixes, this allows you to namespace your
        plugins, and thus override plugins from paths registered earlier. 
    </para>

    <sect2 id="zend.loader.pluginloader.usage">
        <title>Basic Use Case</title>

        <para>
            First, let's assume the following directory structure and class
            files, and that the toplevel directory and library directory are on
            the include_path:
        </para>

        <programlisting role="txt"><![CDATA[
application/
    modules/
        foo/
            views/
                helpers/
                    FormLabel.php
                    FormSubmit.php
        bar/
            views/
                helpers/
                    FormSubmit.php
library/
    Zend/
        View/
            Helper/
                FormLabel.php
                FormSubmit.php
                FormText.php
]]></programlisting>

        <para>
            Now, let's create a plugin loader to address the various view
            helper repositories available:
        </para>

        <programlisting role="php"><![CDATA[<?php
$loader = new Zend_Loader_PluginLoader();
$loader->addPrefixPath('Zend_View_Helper', 'Zend/View/Helper/')
       ->addPrefixPath('Foo_View_Helper', 'application/modules/foo/views/helpers')
       ->addPrefixPath('Bar_View_Helper', 'application/modules/bar/views/helpers');
?>]]></programlisting>

        <para>
            We can then load a given view helper using just the portion of the
            class name following the prefixes as defined when adding the paths:
        </para>

        <programlisting role="php"><![CDATA[<?php
// load 'FormText' helper:
$formTextClass = $loader->load('FormText'); // 'Zend_View_Helper_FormText';

// load 'FormLabel' helper:
$formLabelClass = $loader->load('FormLabel'); // 'Foo_View_Helper_FormLabel' 

// load 'FormSubmit' helper:
$formSubmitClass = $loader->load('FormSubmit'); // 'Bar_View_Helper_FormSubmit' 
?>]]></programlisting>

        <para>
            Once the class is loaded, we can now instantiate it.
        </para>

        <note>
            <title>Multiple paths may be registered for a given prefix</title>

            <para>
                In some cases, you may use the same prefix for multiple paths.
                <code>Zend_Loader_PluginLoader</code> actually registers an
                array of paths for each given prefix; the last one registered
                will be the first one checked. This is particularly useful if
                you are utilizing incubator components.
            </para>
        </note>

        <note>
            <title>Paths may be defined at instantiation</title>

            <para>
                You may optionally provide an array of prefix / path pairs (or
                prefix / paths -- plural paths are allowed) as a parameter to
                the constructor:
            </para>

            <programlisting role="php"><![CDATA[<?php
$loader = new Zend_Loader_PluginLoader(array(
    'Zend_View_Helper' => 'Zend/View/Helper/',
    'Foo_View_Helper'  => 'application/modules/foo/views/helpers',
    'Bar_View_Helper'  => 'application/modules/bar/views/helpers'
));
?>]]></programlisting>
        </note>

        <para>
            <code>Zend_Loader_PluginLoader</code> also optionally allows you to
            share plugins across plugin-aware objects, without needing to
            utilize a singleton instance. It does so via a static registry.
            Indicate the registry name at instantiation as the second parameter
            to the constructor:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Store plugins in static registry 'foobar':
$loader = new Zend_Loader_PluginLoader(array(), 'foobar');
?>]]></programlisting>

        <para>
            Other components that instantiate the <code>PluginLoader</code>
            using the same registry name will then have access to already loaded
            paths and plugins.
        </para>
    </sect2>

    <sect2 id="zend.loader.pluginloader.paths">
        <title>Manipulating Plugin Paths</title>

        <para>
            The example in the previous section shows how to add paths to a
            plugin loader. What if you want to determine the paths already
            loaded, or remove one or more?
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>getPaths($prefix = null)</code> returns all paths as
                    prefix / path pairs if no <code>$prefix</code> is provided,
                    or just the paths registered for a given prefix if a
                    <code>$prefix</code> is present.
            </para></listitem>

            <listitem><para>
                    <code>clearPaths($prefix = null)</code> will clear all
                    registered paths by default, or only those associated with a
                    given prefix, if the <code>$prefix</code> is provided and
                    present in the stack.
            </para></listitem>

            <listitem><para>
                    <code>removePrefixPath($prefix, $path = null)</code> allows
                    you to selectively remove a specific path associated with a
                    given prefix. If no <code>$path</code> is provided, all
                    paths for that prefix are removed. If a <code>$path</code>
                    is provided and exists for that prefix, only that path will
                    be removed.
            </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.loader.pluginloader.checks">
        <title>Testing for Plugins and Retrieving Class Names</title>

        <para>
            Sometimes you simply want to determine if a plugin class has been
            loaded before you perform an action. <code>isLoaded()</code> takes a
            plugin name, and returns the status.
        </para>

        <para>
            Another common use case for the <code>PluginLoader</code> is to
            determine fully qualified plugin class names of loaded classes;
            <code>getClassName()</code> provides this functionality.  Typically,
            this would be used in conjunction with <code>isLoaded()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
if ($loader->isLoaded('Adapter')) {
    $class   = $loader->getClassName('Adapter');
    $adapter = call_user_func(array($class, 'getInstance'));
}
?>]]></programlisting>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.loader.load">

    <title>Loading Files and Classes Dynamically</title>

    <para>
        The Zend_Loader class includes methods to help you load files dynamically.
    </para>

    <tip>
        <title>Zend_Loader vs. require_once()</title>
        <para>
            The <code>Zend_Loader</code> methods are best used if the filename you need to
            load is variable.  For example, if it is based on a parameter from
            user input or method argument.  If you are loading a file or a
            class whose name is constant, there is no benefit to using
            <code>Zend_Loader</code> over using traditional PHP functions such as
            <ulink url="http://php.net/require_once"><code>require_once()</code></ulink>.
        </para>
    </tip>

    <sect2 id="zend.loader.load.file">

        <title>Loading Files</title>

        <para>
            The static method <code>Zend_Loader::loadFile()</code> loads a PHP
            file.  The file loaded may contain any PHP code.
            The method is a wrapper for the PHP function
            <ulink url="http://php.net/include"><code>include()</code></ulink>.
            This method throws <code>Zend_Exception</code> on failure, for example
            if the specified file does not exist.
        </para>

        <example id="zend.loader.load.file.example">
            <title>Example of loadFile() method</title>
            <programlisting role="php"><![CDATA[<?php
Zend_Loader::loadFile($filename, $dirs=null, $once=false);]]>
            </programlisting>
    </example>

        <para>
            The <code>$filename</code> argument specifies the filename to load,
            which must not contain any path information.
            A security check is performed on <code>$filename</code>.
            The <code>$filename</code> may only contain alphanumeric characters,
            dashes ("-"), underscores ("_"), or periods (".").
            No such restriction is placed on the <code>$dirs</code> argument.
        </para>

        <para>
            The <code>$dirs</code> argument specifies directories to search for
            the file.  If <code>NULL</code>, only the <code>include_path</code>
            is searched.  If a string or an array, the directory or directories
            specified will be searched, and then the <code>include_path</code>.
        </para>

        <para>
            The <code>$once</code> argument is a boolean.  If <code>TRUE</code>,
            <code>Zend_Loader::loadFile()</code> uses the PHP function
            <ulink url="http://php.net/include"><code>include_once()</code></ulink>
            for loading the file, otherwise the PHP function
            <ulink url="http://php.net/include_once"><code>include()</code></ulink>
            is used.
        </para>

    </sect2>

    <sect2 id="zend.loader.load.class">

        <title>Loading Classes</title>

        <para>
            The static method <code>Zend_Loader::loadClass($class, $dirs)</code>
            loads a PHP file and then checks for the existance of the class.
        </para>

        <example id="zend.loader.load.class.example">
            <title>Example of loadClass() method</title>
            <programlisting role="php"><![CDATA[<?php
Zend_Loader::loadClass('Container_Tree',
    array(
        '/home/production/mylib',
        '/home/production/myapp'
    )
);]]>
            </programlisting>
        </example>

        <para>
            The string specifying the class is converted to a relative path
            by substituting directory separates for underscores, and appending
            '.php'.  In the example above, 'Container_Tree' becomes 'Container/Tree.php'.
        </para>

        <para>
            If <code>$dirs</code> is a string or an array,
            <code>Zend_Loader::loadClass()</code> searches the directories in
            the order supplied.  The first matching file is loaded.  If the file
            does not exist in the specified <code>$dirs</code>, then the
            <code>include_path</code> for the PHP environment is searched.
        </para>

        <para>
            If the file is not found or the class does not exist after the load,
            <code>Zend_Loader::loadClass()</code> throws a <code>Zend_Exception</code>.
        </para>

        <para>
            <code>Zend_Loader::loadFile()</code> is used for loading, so the
            class name may only contain alphanumeric characters and the hyphen
            ('-'), underscore ('_'), and period ('.').
        </para>

    </sect2>

    <sect2 id="zend.loader.load.isreadable">

        <title>Testing if a File is Readable</title>

        <para>
            The static method <code>Zend_Loader::isReadable($pathname)</code>
            returns <code>TRUE</code> if a file at the specified pathname exists
            and is readable, <code>FALSE</code> otherwise.
        </para>

        <example id="zend.loader.load.isreadable.example">
            <title>Example of isReadable() method</title>
            <programlisting role="php"><![CDATA[<?php
if (Zend_Loader::isReadable($filename)) {
    // do something with $filename
}]]>
            </programlisting>
        </example>

        <para>
            The <code>$filename</code> argument specifies the filename to
            check.  This may contain path information.
            This method is a wrapper for the PHP function
            <ulink url="http://php.net/is_readable"><code>is_readable()</code></ulink>.
            The PHP function does not search the <code>include_path</code>,
            while <code>Zend_Loader::isReadable()</code> does.
        </para>

    </sect2>

    <sect2 id="zend.loader.load.autoload">

        <title>Using the Autoloader</title>

        <para>
            The <code>Zend_Loader</code> class contains a method you can register with the
            PHP SPL autoloader.  <code>Zend_Loader::autoload()</code> is the
            callback method.  As a convenience, <code>Zend_Loader</code> provides the
            <code>registerAutoload()</code> function register its
            <code>autoload()</code> method.  If the <code>spl_autoload</code>
            extension is not present in your PHP environment, then
            <code>registerAutoload()</code> method throws a <code>Zend_Exception</code>.
        </para>

        <example id="zend.loader.load.autoload.example">
            <title>Example of registering the autoloader callback method</title>
            <programlisting role="php"><![CDATA[<?php
Zend_Loader::registerAutoload();]]>
            </programlisting>
        </example>

        <para>
            After registering the Zend Framework autoload callback, you can
            reference classes from the Zend Framework without having to load
            them explicitly.  The <code>autoload()</code> method uses
            <code>Zend_Loader::loadClass()</code> automatically when you
            reference a class.
        </para>

        <para>
            If you have extended the <code>Zend_Loader</code> class, you can give an
            optional argument to <code>registerAutoload()</code>, to specify
            the class from which to register an <code>autoload()</code> method.
        </para>

        <example id="zend.loader.load.autoload.example-extended">
            <title>Example of registering the autoload callback method from an
                extended class</title>
            <para>
                Because of the semantics of static function references in PHP,
                you must implement code for both <code>loadClass()</code>
                and <code>autoload()</code>, and the <code>autoload()</code>
                must call <code>self::loadClass()</code>.  If your
                <code>autoload()</code> method delegates to its parent to
                call <code>self::loadClass()</code>, then it calls the
                method of that name in the parent class, not the subclass.
            </para>
            <programlisting role="php"><![CDATA[<?php
class My_Loader extends Zend_Loader
{
    public static function loadClass($class, $dirs = null)
    {
        parent::loadClass($class, $dirs);
    }

    public static function autoload($class)
    {
        try {
            self::loadClass($class);
            return $class;
        } catch (Exception $e) {
            return false;
        }
    }
}

Zend_Loader::registerAutoload('My_Loader');]]>
            </programlisting>
        </example>

        <para>
            You can remove an autoload callback.  The
            <code>registerAutoload()</code> has an optional second argument,
            which is <code>true</code> by default.  If this argument is
            <code>false</code>, the autoload callback in unregistered from the
            SPL autoload stack instead of registered.
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.locale.languages">

    <title>Supported Languages for Locales</title>

    <para>
        <code>Zend_Locale</code> provides information for the following languages.
        <table id="zend.locale.languages.table">
            <title>List of all supported languages</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Locale</entry>
                        <entry>Language</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>aa</entry>
                        <entry>Afar</entry>
                    </row>
                    <row>
                        <entry>af</entry>
                        <entry>Afrikaans</entry>
                    </row>
                    <row>
                        <entry>ak</entry>
                        <entry>Akan</entry>
                    </row>
                    <row>
                        <entry>am</entry>
                        <entry>Amharic</entry>
                    </row>
                    <row>
                        <entry>ar</entry>
                        <entry>Arabic</entry>
                    </row>
                    <row>
                        <entry>as</entry>
                        <entry>Assamese</entry>
                    </row>
                    <row>
                        <entry>az</entry>
                        <entry>Azerbaijani</entry>
                    </row>
                    <row>
                        <entry>be</entry>
                        <entry>Belarusian</entry>
                    </row>
                    <row>
                        <entry>bg</entry>
                        <entry>Bulgarian</entry>
                    </row>
                    <row>
                        <entry>bn</entry>
                        <entry>Bengali</entry>
                    </row>
                    <row>
                        <entry>bo</entry>
                        <entry>Tibetan</entry>
                    </row>
                    <row>
                        <entry>bs</entry>
                        <entry>Bosnian</entry>
                    </row>
                    <row>
                        <entry>byn</entry>
                        <entry>Blin</entry>
                    </row>
                    <row>
                        <entry>ca</entry>
                        <entry>Catalan</entry>
                    </row>
                    <row>
                        <entry>cch</entry>
                        <entry>Atsam</entry>
                    </row>
                    <row>
                        <entry>cop</entry>
                        <entry>Coptic</entry>
                    </row>
                    <row>
                        <entry>cs</entry>
                        <entry>Czech</entry>
                    </row>
                    <row>
                        <entry>cy</entry>
                        <entry>Welsh</entry>
                    </row>
                    <row>
                        <entry>da</entry>
                        <entry>Danish</entry>
                    </row>
                    <row>
                        <entry>de</entry>
                        <entry>German</entry>
                    </row>
                    <row>
                        <entry>dv</entry>
                        <entry>Divehi</entry>
                    </row>
                    <row>
                        <entry>dz</entry>
                        <entry>Dzongkha</entry>
                    </row>
                    <row>
                        <entry>ee</entry>
                        <entry>Ewe</entry>
                    </row>
                    <row>
                        <entry>el</entry>
                        <entry>Greek</entry>
                    </row>
                    <row>
                        <entry>en</entry>
                        <entry>English</entry>
                    </row>
                    <row>
                        <entry>eo</entry>
                        <entry>Esperanto</entry>
                    </row>
                    <row>
                        <entry>es</entry>
                        <entry>Spanish</entry>
                    </row>
                    <row>
                        <entry>et</entry>
                        <entry>Estonian</entry>
                    </row>
                    <row>
                        <entry>eu</entry>
                        <entry>Basque</entry>
                    </row>
                    <row>
                        <entry>fa</entry>
                        <entry>Persian</entry>
                    </row>
                    <row>
                        <entry>fi</entry>
                        <entry>Finnish</entry>
                    </row>
                    <row>
                        <entry>fil</entry>
                        <entry>Filipino</entry>
                    </row>
                    <row>
                        <entry>fo</entry>
                        <entry>Faroese</entry>
                    </row>
                    <row>
                        <entry>fr</entry>
                        <entry>French</entry>
                    </row>
                    <row>
                        <entry>fur</entry>
                        <entry>Friulian</entry>
                    </row>
                    <row>
                        <entry>ga</entry>
                        <entry>Irish</entry>
                    </row>
                    <row>
                        <entry>gaa</entry>
                        <entry>Ga</entry>
                    </row>
                    <row>
                        <entry>gez</entry>
                        <entry>Geez</entry>
                    </row>
                    <row>
                        <entry>gl</entry>
                        <entry>Gallegan</entry>
                    </row>
                    <row>
                        <entry>gu</entry>
                        <entry>Gujarati</entry>
                    </row>
                    <row>
                        <entry>gv</entry>
                        <entry>Manx</entry>
                    </row>
                    <row>
                        <entry>ha</entry>
                        <entry>Hausa</entry>
                    </row>
                    <row>
                        <entry>haw</entry>
                        <entry>Hawaiian</entry>
                    </row>
                    <row>
                        <entry>he</entry>
                        <entry>Hebrew</entry>
                    </row>
                    <row>
                        <entry>hi</entry>
                        <entry>Hindi</entry>
                    </row>
                    <row>
                        <entry>hr</entry>
                        <entry>Croatian</entry>
                    </row>
                    <row>
                        <entry>hu</entry>
                        <entry>Hungarian</entry>
                    </row>
                    <row>
                        <entry>hy</entry>
                        <entry>Armenian</entry>
                    </row>
                    <row>
                        <entry>ia</entry>
                        <entry>Interlingua</entry>
                    </row>
                    <row>
                        <entry>id</entry>
                        <entry>Indonesian</entry>
                    </row>
                    <row>
                        <entry>ig</entry>
                        <entry>Igbo</entry>
                    </row>
                    <row>
                        <entry>ii</entry>
                        <entry>Sichuan Yi</entry>
                    </row>
                    <row>
                        <entry>is</entry>
                        <entry>Icelandic</entry>
                    </row>
                    <row>
                        <entry>it</entry>
                        <entry>Italian</entry>
                    </row>
                    <row>
                        <entry>iu</entry>
                        <entry>Inuktitut</entry>
                    </row>
                    <row>
                        <entry>ja</entry>
                        <entry>Japanese</entry>
                    </row>
                    <row>
                        <entry>ka</entry>
                        <entry>Georgian</entry>
                    </row>
                    <row>
                        <entry>kaj</entry>
                        <entry>Jju</entry>
                    </row>
                    <row>
                        <entry>kam</entry>
                        <entry>Kamba</entry>
                    </row>
                    <row>
                        <entry>kcg</entry>
                        <entry>Tyap</entry>
                    </row>
                    <row>
                        <entry>kfo</entry>
                        <entry>Koro</entry>
                    </row>
                    <row>
                        <entry>kk</entry>
                        <entry>Kazakh</entry>
                    </row>
                    <row>
                        <entry>kl</entry>
                        <entry>Kalaallisut</entry>
                    </row>
                    <row>
                        <entry>km</entry>
                        <entry>Khmer</entry>
                    </row>
                    <row>
                        <entry>kn</entry>
                        <entry>Kannada</entry>
                    </row>
                    <row>
                        <entry>ko</entry>
                        <entry>Korean</entry>
                    </row>
                    <row>
                        <entry>kok</entry>
                        <entry>Konkani</entry>
                    </row>
                    <row>
                        <entry>kpe</entry>
                        <entry>Kpelle</entry>
                    </row>
                    <row>
                        <entry>ku</entry>
                        <entry>Kurdish</entry>
                    </row>
                    <row>
                        <entry>kw</entry>
                        <entry>Cornish</entry>
                    </row>
                    <row>
                        <entry>ky</entry>
                        <entry>Kirghiz</entry>
                    </row>
                    <row>
                        <entry>ln</entry>
                        <entry>Lingala</entry>
                    </row>
                    <row>
                        <entry>lo</entry>
                        <entry>Lao</entry>
                    </row>
                    <row>
                        <entry>lt</entry>
                        <entry>Lithuanian</entry>
                    </row>
                    <row>
                        <entry>lv</entry>
                        <entry>Latvian</entry>
                    </row>
                    <row>
                        <entry>mk</entry>
                        <entry>Macedonian</entry>
                    </row>
                    <row>
                        <entry>ml</entry>
                        <entry>Malayalam</entry>
                    </row>
                    <row>
                        <entry>mn</entry>
                        <entry>Mongolian</entry>
                    </row>
                    <row>
                        <entry>mr</entry>
                        <entry>Marathi</entry>
                    </row>
                    <row>
                        <entry>ms</entry>
                        <entry>Malay</entry>
                    </row>
                    <row>
                        <entry>mt</entry>
                        <entry>Maltese</entry>
                    </row>
                    <row>
                        <entry>my</entry>
                        <entry>Burmese</entry>
                    </row>
                    <row>
                        <entry>nb</entry>
                        <entry>Norwegian Bokmal</entry>
                    </row>
                    <row>
                        <entry>ne</entry>
                        <entry>Nepali</entry>
                    </row>
                    <row>
                        <entry>nl</entry>
                        <entry>Dutch</entry>
                    </row>
                    <row>
                        <entry>nn</entry>
                        <entry>Norwegian Nynorsk</entry>
                    </row>
                    <row>
                        <entry>nr</entry>
                        <entry>South Ndebele</entry>
                    </row>
                    <row>
                        <entry>nso</entry>
                        <entry>Northern Sotho</entry>
                    </row>
                    <row>
                        <entry>ny</entry>
                        <entry>Nyanja; Chichewa; Chewa</entry>
                    </row>
                    <row>
                        <entry>om</entry>
                        <entry>Oromo</entry>
                    </row>
                    <row>
                        <entry>or</entry>
                        <entry>Oriya</entry>
                    </row>
                    <row>
                        <entry>pa</entry>
                        <entry>Punjabi</entry>
                    </row>
                    <row>
                        <entry>pl</entry>
                        <entry>Polish</entry>
                    </row>
                    <row>
                        <entry>ps</entry>
                        <entry>Pashto (Pushto)</entry>
                    </row>
                    <row>
                        <entry>pt</entry>
                        <entry>Portuguese</entry>
                    </row>
                    <row>
                        <entry>ro</entry>
                        <entry>Romanian</entry>
                    </row>
                    <row>
                        <entry>ru</entry>
                        <entry>Russian</entry>
                    </row>
                    <row>
                        <entry>rw</entry>
                        <entry>Kinyarwanda</entry>
                    </row>
                    <row>
                        <entry>sa</entry>
                        <entry>Sanskrit</entry>
                    </row>
                    <row>
                        <entry>se</entry>
                        <entry>Northern Sami</entry>
                    </row>
                    <row>
                        <entry>sh</entry>
                        <entry>Serbo-Croatian</entry>
                    </row>
                    <row>
                        <entry>sid</entry>
                        <entry>Sidamo</entry>
                    </row>
                    <row>
                        <entry>sk</entry>
                        <entry>Slovak</entry>
                    </row>
                    <row>
                        <entry>sl</entry>
                        <entry>Slovenian</entry>
                    </row>
                    <row>
                        <entry>so</entry>
                        <entry>Somali</entry>
                    </row>
                    <row>
                        <entry>sq</entry>
                        <entry>Albanian</entry>
                    </row>
                    <row>
                        <entry>sr</entry>
                        <entry>Serbian</entry>
                    </row>
                    <row>
                        <entry>ss</entry>
                        <entry>Swati</entry>
                    </row>
                    <row>
                        <entry>ssy</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>st</entry>
                        <entry>Southern Sotho</entry>
                    </row>
                    <row>
                        <entry>sv</entry>
                        <entry>Swedish</entry>
                    </row>
                    <row>
                        <entry>sw</entry>
                        <entry>Swahili</entry>
                    </row>
                    <row>
                        <entry>syr</entry>
                        <entry>Syriac</entry>
                    </row>
                    <row>
                        <entry>ta</entry>
                        <entry>Tamil</entry>
                    </row>
                    <row>
                        <entry>te</entry>
                        <entry>Telugu</entry>
                    </row>
                    <row>
                        <entry>tg</entry>
                        <entry>Tajik</entry>
                    </row>
                    <row>
                        <entry>th</entry>
                        <entry>Thai</entry>
                    </row>
                    <row>
                        <entry>ti</entry>
                        <entry>Tigrinya</entry>
                    </row>
                    <row>
                        <entry>tig</entry>
                        <entry>Tigre</entry>
                    </row>
                    <row>
                        <entry>tn</entry>
                        <entry>Tswana</entry>
                    </row>
                    <row>
                        <entry>to</entry>
                        <entry>Tonga</entry>
                    </row>
                    <row>
                        <entry>tr</entry>
                        <entry>Turkish</entry>
                    </row>
                    <row>
                        <entry>ts</entry>
                        <entry>Tsonga</entry>
                    </row>
                    <row>
                        <entry>tt</entry>
                        <entry>Tatar</entry>
                    </row>
                    <row>
                        <entry>ug</entry>
                        <entry>Uighur</entry>
                    </row>
                    <row>
                        <entry>uk</entry>
                        <entry>Ukrainian</entry>
                    </row>
                    <row>
                        <entry>und</entry>
                        <entry>Unknown or Invalid Language</entry>
                    </row>
                    <row>
                        <entry>ur</entry>
                        <entry>Urdu</entry>
                    </row>
                    <row>
                        <entry>uz</entry>
                        <entry>Uzbek</entry>
                    </row>
                    <row>
                        <entry>ve</entry>
                        <entry>Venda</entry>
                    </row>
                    <row>
                        <entry>vi</entry>
                        <entry>Vietnamese</entry>
                    </row>
                    <row>
                        <entry>wal</entry>
                        <entry>Walamo</entry>
                    </row>
                    <row>
                        <entry>wo</entry>
                        <entry>Wolof</entry>
                    </row>
                    <row>
                        <entry>xh</entry>
                        <entry>Xhosa</entry>
                    </row>
                    <row>
                        <entry>yo</entry>
                        <entry>Yorubs</entry>
                    </row>
                    <row>
                        <entry>zh</entry>
                        <entry>Chinese</entry>
                    </row>
                    <row>
                        <entry>zu</entry>
                        <entry>Zulu</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.locale.regions">

    <title>Supported Regions for Locales</title>

    <para>
        <code>Zend_Locale</code> provides information for the following regions.
        <table id="zend.locale.regions.table">
            <title>List of all supported regions</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Locale</entry>
                        <entry>Region</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>AE</entry>
                        <entry>United Arab Emirates</entry>
                    </row>
                    <row>
                        <entry>AF</entry>
                        <entry>Afghanistan</entry>
                    </row>
                    <row>
                        <entry>AL</entry>
                        <entry>Albania</entry>
                    </row>
                    <row>
                        <entry>AM</entry>
                        <entry>Armenia</entry>
                    </row>
                    <row>
                        <entry>AR</entry>
                        <entry>Argentina</entry>
                    </row>
                    <row>
                        <entry>AS</entry>
                        <entry>American Samoa</entry>
                    </row>
                    <row>
                        <entry>AT</entry>
                        <entry>Austria</entry>
                    </row>
                    <row>
                        <entry>AU</entry>
                        <entry>Australia</entry>
                    </row>
                    <row>
                        <entry>AZ</entry>
                        <entry>Azerbaijan</entry>
                    </row>
                    <row>
                        <entry>BA</entry>
                        <entry>Bosnia and Herzegovina</entry>
                    </row>
                    <row>
                        <entry>BD</entry>
                        <entry>Bangladesh</entry>
                    </row>
                    <row>
                        <entry>BE</entry>
                        <entry>Belgium</entry>
                    </row>
                    <row>
                        <entry>BG</entry>
                        <entry>Bulgaria</entry>
                    </row>
                    <row>
                        <entry>BH</entry>
                        <entry>Bahrain</entry>
                    </row>
                    <row>
                        <entry>BN</entry>
                        <entry>Brunei</entry>
                    </row>
                    <row>
                        <entry>BO</entry>
                        <entry>Bolivia</entry>
                    </row>
                    <row>
                        <entry>BR</entry>
                        <entry>Brazil</entry>
                    </row>
                    <row>
                        <entry>BT</entry>
                        <entry>Bhutan</entry>
                    </row>
                    <row>
                        <entry>BW</entry>
                        <entry>Botswana</entry>
                    </row>
                    <row>
                        <entry>BY</entry>
                        <entry>Belarus</entry>
                    </row>
                    <row>
                        <entry>BZ</entry>
                        <entry>Belize</entry>
                    </row>
                    <row>
                        <entry>CA</entry>
                        <entry>Canada</entry>
                    </row>
                    <row>
                        <entry>CD</entry>
                        <entry>Congo (Kinshasa)</entry>
                    </row>
                    <row>
                        <entry>CG</entry>
                        <entry>Congo (Brazzaville)</entry>
                    </row>
                    <row>
                        <entry>CH</entry>
                        <entry>Switzerland</entry>
                    </row>
                    <row>
                        <entry>CL</entry>
                        <entry>Chile</entry>
                    </row>
                    <row>
                        <entry>CN</entry>
                        <entry>China</entry>
                    </row>
                    <row>
                        <entry>CO</entry>
                        <entry>Colombia</entry>
                    </row>
                    <row>
                        <entry>CR</entry>
                        <entry>Costa Rica</entry>
                    </row>
                    <row>
                        <entry>CS</entry>
                        <entry>Serbia And Montenegro</entry>
                    </row>
                    <row>
                        <entry>CY</entry>
                        <entry>Cyprus</entry>
                    </row>
                    <row>
                        <entry>CZ</entry>
                        <entry>Czech Republic</entry>
                    </row>
                    <row>
                        <entry>DE</entry>
                        <entry>Germany</entry>
                    </row>
                    <row>
                        <entry>DJ</entry>
                        <entry>Djibouti</entry>
                    </row>
                    <row>
                        <entry>DK</entry>
                        <entry>Denmark</entry>
                    </row>
                    <row>
                        <entry>DO</entry>
                        <entry>Dominican Republic</entry>
                    </row>
                    <row>
                        <entry>DZ</entry>
                        <entry>Algeria</entry>
                    </row>
                    <row>
                        <entry>EC</entry>
                        <entry>Ecuador</entry>
                    </row>
                    <row>
                        <entry>EE</entry>
                        <entry>Estonia</entry>
                    </row>
                    <row>
                        <entry>EG</entry>
                        <entry>Egypt</entry>
                    </row>
                    <row>
                        <entry>ER</entry>
                        <entry>Eritrea</entry>
                    </row>
                    <row>
                        <entry>ES</entry>
                        <entry>Spain</entry>
                    </row>
                    <row>
                        <entry>ET</entry>
                        <entry>Ethiopia</entry>
                    </row>
                    <row>
                        <entry>FI</entry>
                        <entry>Finland</entry>
                    </row>
                    <row>
                        <entry>FO</entry>
                        <entry>Faroe Islands</entry>
                    </row>
                    <row>
                        <entry>FR</entry>
                        <entry>France</entry>
                    </row>
                    <row>
                        <entry>GB</entry>
                        <entry>United Kingdom</entry>
                    </row>
                    <row>
                        <entry>GE</entry>
                        <entry>Georgia</entry>
                    </row>
                    <row>
                        <entry>GH</entry>
                        <entry>Ghana</entry>
                    </row>
                    <row>
                        <entry>GL</entry>
                        <entry>Greenland</entry>
                    </row>
                    <row>
                        <entry>GN</entry>
                        <entry>Guinea</entry>
                    </row>
                    <row>
                        <entry>GR</entry>
                        <entry>Greece</entry>
                    </row>
                    <row>
                        <entry>GT</entry>
                        <entry>Guatemala</entry>
                    </row>
                    <row>
                        <entry>GU</entry>
                        <entry>Guam</entry>
                    </row>
                    <row>
                        <entry>HK</entry>
                        <entry>Hong Kong S.A.R., China</entry>
                    </row>
                    <row>
                        <entry>HN</entry>
                        <entry>Honduras</entry>
                    </row>
                    <row>
                        <entry>HR</entry>
                        <entry>Croatia</entry>
                    </row>
                    <row>
                        <entry>HU</entry>
                        <entry>Hungary</entry>
                    </row>
                    <row>
                        <entry>ID</entry>
                        <entry>Indonesia</entry>
                    </row>
                    <row>
                        <entry>IE</entry>
                        <entry>Ireland</entry>
                    </row>
                    <row>
                        <entry>IL</entry>
                        <entry>Israel</entry>
                    </row>
                    <row>
                        <entry>IN</entry>
                        <entry>India</entry>
                    </row>
                    <row>
                        <entry>IQ</entry>
                        <entry>Iraq</entry>
                    </row>
                    <row>
                        <entry>IR</entry>
                        <entry>Iran</entry>
                    </row>
                    <row>
                        <entry>IS</entry>
                        <entry>Iceland</entry>
                    </row>
                    <row>
                        <entry>IT</entry>
                        <entry>Italy</entry>
                    </row>
                    <row>
                        <entry>JM</entry>
                        <entry>Jamaica</entry>
                    </row>
                    <row>
                        <entry>JO</entry>
                        <entry>Jordan</entry>
                    </row>
                    <row>
                        <entry>JP</entry>
                        <entry>Japan</entry>
                    </row>
                    <row>
                        <entry>KE</entry>
                        <entry>Kenya</entry>
                    </row>
                    <row>
                        <entry>KG</entry>
                        <entry>Kyrgyzstan</entry>
                    </row>
                    <row>
                        <entry>KH</entry>
                        <entry>Cambodia</entry>
                    </row>
                    <row>
                        <entry>KR</entry>
                        <entry>South Korea</entry>
                    </row>
                    <row>
                        <entry>KW</entry>
                        <entry>Kuwait</entry>
                    </row>
                    <row>
                        <entry>KZ</entry>
                        <entry>Kazakhstan</entry>
                    </row>
                    <row>
                        <entry>LA</entry>
                        <entry>Laos</entry>
                    </row>
                    <row>
                        <entry>LB</entry>
                        <entry>Lebanon</entry>
                    </row>
                    <row>
                        <entry>LI</entry>
                        <entry>Liechtenstein</entry>
                    </row>
                    <row>
                        <entry>LR</entry>
                        <entry>Liberia</entry>
                    </row>
                    <row>
                        <entry>LT</entry>
                        <entry>Lithuania</entry>
                    </row>
                    <row>
                        <entry>LU</entry>
                        <entry>Luxembourg</entry>
                    </row>
                    <row>
                        <entry>LV</entry>
                        <entry>Latvia</entry>
                    </row>
                    <row>
                        <entry>LY</entry>
                        <entry>Libya</entry>
                    </row>
                    <row>
                        <entry>MA</entry>
                        <entry>Morocco</entry>
                    </row>
                    <row>
                        <entry>MC</entry>
                        <entry>Monaco</entry>
                    </row>
                    <row>
                        <entry>ME</entry>
                        <entry>Montenegro</entry>
                    </row>
                    <row>
                        <entry>MH</entry>
                        <entry>Marshall Islands</entry>
                    </row>
                    <row>
                        <entry>MK</entry>
                        <entry>Macedonia</entry>
                    </row>
                    <row>
                        <entry>MM</entry>
                        <entry>Myanmar</entry>
                    </row>
                    <row>
                        <entry>MN</entry>
                        <entry>Mongolia</entry>
                    </row>
                    <row>
                        <entry>MO</entry>
                        <entry>Macao S.A.R., China</entry>
                    </row>
                    <row>
                        <entry>MP</entry>
                        <entry>Northern Mariana Islands</entry>
                    </row>
                    <row>
                        <entry>MT</entry>
                        <entry>Malta</entry>
                    </row>
                    <row>
                        <entry>MV</entry>
                        <entry>Maldives</entry>
                    </row>
                    <row>
                        <entry>MW</entry>
                        <entry>Malawi</entry>
                    </row>
                    <row>
                        <entry>MX</entry>
                        <entry>Mexico</entry>
                    </row>
                    <row>
                        <entry>MY</entry>
                        <entry>Malaysia</entry>
                    </row>
                    <row>
                        <entry>NA</entry>
                        <entry>Namibia</entry>
                    </row>
                    <row>
                        <entry>NE</entry>
                        <entry>Niger</entry>
                    </row>
                    <row>
                        <entry>NG</entry>
                        <entry>Nigeria</entry>
                    </row>
                    <row>
                        <entry>NI</entry>
                        <entry>Nicaragua</entry>
                    </row>
                    <row>
                        <entry>NL</entry>
                        <entry>Netherlands</entry>
                    </row>
                    <row>
                        <entry>NO</entry>
                        <entry>Norway</entry>
                    </row>
                    <row>
                        <entry>NP</entry>
                        <entry>Nepal</entry>
                    </row>
                    <row>
                        <entry>NZ</entry>
                        <entry>New Zealand</entry>
                    </row>
                    <row>
                        <entry>OM</entry>
                        <entry>Oman</entry>
                    </row>
                    <row>
                        <entry>PA</entry>
                        <entry>Panama</entry>
                    </row>
                    <row>
                        <entry>PE</entry>
                        <entry>Peru</entry>
                    </row>
                    <row>
                        <entry>PH</entry>
                        <entry>Philippines</entry>
                    </row>
                    <row>
                        <entry>PK</entry>
                        <entry>Pakistan</entry>
                    </row>
                    <row>
                        <entry>PL</entry>
                        <entry>Poland</entry>
                    </row>
                    <row>
                        <entry>PR</entry>
                        <entry>Puerto Rico</entry>
                    </row>
                    <row>
                        <entry>PT</entry>
                        <entry>Portugal</entry>
                    </row>
                    <row>
                        <entry>PY</entry>
                        <entry>Paraguay</entry>
                    </row>
                    <row>
                        <entry>QA</entry>
                        <entry>Qatar</entry>
                    </row>
                    <row>
                        <entry>RO</entry>
                        <entry>Romania</entry>
                    </row>
                    <row>
                        <entry>RS</entry>
                        <entry>Serbia</entry>
                    </row>
                    <row>
                        <entry>RU</entry>
                        <entry>Russia</entry>
                    </row>
                    <row>
                        <entry>RW</entry>
                        <entry>Rwanda</entry>
                    </row>
                    <row>
                        <entry>SA</entry>
                        <entry>Saudi Arabia</entry>
                    </row>
                    <row>
                        <entry>SD</entry>
                        <entry>Sudan</entry>
                    </row>
                    <row>
                        <entry>SE</entry>
                        <entry>Sweden</entry>
                    </row>
                    <row>
                        <entry>SG</entry>
                        <entry>Singapore</entry>
                    </row>
                    <row>
                        <entry>SI</entry>
                        <entry>Slovenia</entry>
                    </row>
                    <row>
                        <entry>SK</entry>
                        <entry>Slovakia</entry>
                    </row>
                    <row>
                        <entry>SN</entry>
                        <entry>Senegal</entry>
                    </row>
                    <row>
                        <entry>SO</entry>
                        <entry>Somalia</entry>
                    </row>
                    <row>
                        <entry>SV</entry>
                        <entry>El Salvador</entry>
                    </row>
                    <row>
                        <entry>SY</entry>
                        <entry>Syria</entry>
                    </row>
                    <row>
                        <entry>TG</entry>
                        <entry>Togo</entry>
                    </row>
                    <row>
                        <entry>TH</entry>
                        <entry>Thailand</entry>
                    </row>
                    <row>
                        <entry>TJ</entry>
                        <entry>Tajikistan</entry>
                    </row>
                    <row>
                        <entry>TN</entry>
                        <entry>Tunisia</entry>
                    </row>
                    <row>
                        <entry>TO</entry>
                        <entry>Tonga</entry>
                    </row>
                    <row>
                        <entry>TR</entry>
                        <entry>Turkey</entry>
                    </row>
                    <row>
                        <entry>TT</entry>
                        <entry>Trinidad and Tobago</entry>
                    </row>
                    <row>
                        <entry>TW</entry>
                        <entry>Taiwan</entry>
                    </row>
                    <row>
                        <entry>TZ</entry>
                        <entry>Tanzania</entry>
                    </row>
                    <row>
                        <entry>UA</entry>
                        <entry>Ukraine</entry>
                    </row>
                    <row>
                        <entry>UM</entry>
                        <entry>United States Minor Outlying Islands</entry>
                    </row>
                    <row>
                        <entry>US</entry>
                        <entry>United States</entry>
                    </row>
                    <row>
                        <entry>UY</entry>
                        <entry>Uruguay</entry>
                    </row>
                    <row>
                        <entry>UZ</entry>
                        <entry>Uzbekistan</entry>
                    </row>
                    <row>
                        <entry>VE</entry>
                        <entry>Venezuela</entry>
                    </row>
                    <row>
                        <entry>VI</entry>
                        <entry>U.S. Virgin Islands</entry>
                    </row>
                    <row>
                        <entry>VN</entry>
                        <entry>Vietnam</entry>
                    </row>
                    <row>
                        <entry>YE</entry>
                        <entry>Yemen</entry>
                    </row>
                    <row>
                        <entry>YU</entry>
                        <entry>Yugoslavian Union</entry>
                    </row>
                    <row>
                        <entry>ZA</entry>
                        <entry>South Africa</entry>
                    </row>
                    <row>
                        <entry>ZW</entry>
                        <entry>Zimbabwe</entry>
                    </row>
                    <row>
                        <entry>ZZ</entry>
                        <entry>Unknown or Invalid Region</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.locale.date.datesandtimes">

    <title>Working with Dates and Times</title>

    <para>
        <code>Zend_Locale_Format</code> provides several methods for working with dates and times to help convert and
        normalize between different formats for different locales. Use <code>Zend_Date</code> for manipulating dates,
        and working with date strings that already conform to
        <link linkend="zend.date.constants">one of the many internationally recognized standard formats, or one of the localized date formats supported by <code>Zend_Date</code>
        </link>
        . Using an existing, pre-defined format offers advantages, including the use of well-tested code, and the
        assurance of some degree of portability and interoperability (depending on the standard used). The examples
        below do not follow these recommendations, since using non-standard date formats would needlessly increase the
        difficulty of understanding these examples.
    </para>

    <sect2 id="zend.locale.date.normalize">

        <title>Normalizing Dates and Times</title>

        <para>
            The <code>getDate()</code> method parses strings containing dates in localized formats. The results are
            returned in a structured array, with well-defined keys for each part of the date. In addition, the array
            will contain a key 'date_format' showing the format string used to parse the input date string. Since a
            localized date string may not contain all parts of a date/time, the key-value pairs are optional. For
            example, if only the year, month, and day is given, then all time values are supressed from the returned
            array, and vice-versa if only hour, minute, and second were given as input. If no date or time can be found
            within the given input, an exception will be thrown.
        </para>

        <para>
            If <code>setOption(array('fix_date' => true))</code> is set the <code>getDate()</code> method adds a key 'fixed'
            with a whole number value indicating if the input date string required "fixing" by rearranging the day,
            month, or year in the input to fit the format used.
        </para>

        <table id="zend.locale.date.normalize.table-1">
            <title>Key values for getDate() with option 'fix_date'</title>
            <tgroup cols='4'>
                <thead>
                    <row>
                        <entry>value</entry>
                        <entry>meaning</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>0</entry>
                        <entry>nothing to fix</entry>
                    </row>
                    <row>
                        <entry>1</entry>
                        <entry>fixed false month</entry>
                    </row>
                    <row>
                        <entry>2</entry>
                        <entry>swapped day and year</entry>
                    </row>
                    <row>
                        <entry>3</entry>
                        <entry>swapped month and year</entry>
                    </row>
                    <row>
                        <entry>4</entry>
                        <entry>swapped month and day</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            For those needing to specify explicitly the format of the date string, the following format token specifiers
            are supported. If an invalid format specifier is used, such as the PHP 'i' specifier when in ISO format
            mode, then an error will be thrown by the methods in Zend_Locale_Format that support user-defined formats.
        </para>

        <para>
            These specifiers (below) are a small subset of the full "ISO" set supported by Zend_Date's
            <code>toString()</code>. If you need to use PHP <code>date()</code> compatible format specifiers, then first
            call <code>setOptions(array('format_type' => 'php'))</code>. And if you want to convert only one special format
            string from PHP <code>date()</code> compatible format to "ISO" format use <code>convertPhpToIsoFormat()</code>.
            Currently, the only practical difference relates to the specifier for minutes ('m' using the ISO default,
            and 'i' using the PHP date format).
        </para>

        <table id="zend.locale.date.normalize.table-2">
            <title>Return values</title>
            <tgroup cols='4'>
                <thead>
                    <row>
                        <entry>getDate() format character</entry>
                        <entry>Array key</entry>
                        <entry>Returned value</entry>
                        <entry>Minimum</entry>
                        <entry>Maximum</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>d</entry>
                        <entry>day</entry>
                        <entry>integer</entry>
                        <entry>1</entry>
                        <entry>31</entry>
                    </row>
                    <row>
                        <entry>M</entry>
                        <entry>month</entry>
                        <entry>integer</entry>
                        <entry>1</entry>
                        <entry>12</entry>
                    </row>
                    <row>
                        <entry>y</entry>
                        <entry>year</entry>
                        <entry>integer</entry>
                        <entry>no limit</entry>
                        <entry>PHP integer's maximum</entry>
                    </row>
                    <row>
                        <entry>h</entry>
                        <entry>hour</entry>
                        <entry>integer</entry>
                        <entry>0</entry>
                        <entry>PHP integer's maximum</entry>
                    </row>
                    <row>
                        <entry>m</entry>
                        <entry>minute</entry>
                        <entry>integer</entry>
                        <entry>0</entry>
                        <entry>PHP integer's maximum</entry>
                    </row>
                    <row>
                        <entry>s</entry>
                        <entry>second</entry>
                        <entry>integer</entry>
                        <entry>0</entry>
                        <entry>PHP integer's maximum</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <example id="zend.locale.date.normalize.example-1">
            <title>Normalizing a date</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$dateString = Zend_Locale_Format::getDate('13.04.2006', array('date_format' => 'dd.MM.yyyy'));
$dateObject = Zend_Date('13.04.2006', array('date_format' => 'dd.MM.yyyy')); // creates a Zend_Date object for this date

print_r($dateString); // outputs:

Array
(
    [format] => dd.MM.yyyy
    [day] => 13
    [month] => 4
    [year] => 2006
)

// alternatively, some types of problems with input data can be automatically corrected
$date2 = Zend_Locale_Format::getDate('04.13.2006', array('date_format' => 'dd.MM.yyyy', 'fix_date' => true));

print_r($date); // outputs:

Array
(
    [format] => dd.MM.yyyy
    [day] => 13
    [month] => 4
    [year] => 2006
    [fixed] => 4
)]]>
            </programlisting>
        </example>

        <para>
            Since <code>getDate()</code> is "locale-aware", specifying the <code>$locale</code> is sufficient for date
            strings adhering to that locale's format. The option '<code>fix_date</code>' uses simple tests to
            determine if the day or month is not valid, and then applies heuristics to try and correct any detected
            problems. Note the use of '<code>Zend_Locale_Format::STANDARD</code>' as the value for
            '<code>date_format</code>' to prevent the use of a class-wide default date format set using
            <code>setOptions()</code>. This forces getDate to use the default date format for <code>$locale</code>.
        </para>

        <example id="zend.locale.date.normalize.example-2">
            <title>Normalizing a date by locale</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$date = Zend_Locale_Format::getDate('13.04.2006', array('date_format' => Zend_Locale_Format::STANDARD, 'locale' => $locale));

print_r ($date);]]>
            </programlisting>
        </example>

        <para>
            A complete date and time is returned when the input contains both a date and time in the expected format.
        </para>

        <example id="zend.locale.date.normalize.example-3">
            <title>Normalizing a date with time</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$date = Zend_Locale_Format::getDate('13.04.2005 22:14:55', array('date_format' => Zend_Locale_Format::STANDARD, 'locale' => $locale);

print_r ($date);]]>
            </programlisting>
        </example>

        <para>
            If a specific format is desired, specify the <code>$format</code> argument, without giving a
            <code>$locale</code>. Only single-letter codes (H, m, s, y, M, d), and MMMM and EEEE are supported in the
            <code>$format</code>.
        </para>

        <example id="zend.locale.date.normalize.example-4">
            <title>Normalizing a userdefined date</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$date = Zend_Locale_Format::getDate('13200504T551422', array('date_format' => 'ddyyyyMM ssmmHH');

print_r ($date);]]>
            </programlisting>
        </example>

        <para>
            The format can include the following signs :
        </para>

        <table id="zend.locale.date.normalize.table-3">
            <title>Format definition</title>
            <tgroup cols='2'>
                <thead>
                    <row>
                        <entry>Format Letter</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>d or dd</entry>
                        <entry>1 or 2 digit day</entry>
                    </row>
                    <row>
                        <entry>M or MM</entry>
                        <entry>1 or 2 digit month</entry>
                    </row>
                    <row>
                        <entry>y or yy</entry>
                        <entry>1 or 2 digit year</entry>
                    </row>
                    <row>
                        <entry>yyyy</entry>
                        <entry>4 digit year</entry>
                    </row>
                    <row>
                        <entry>h</entry>
                        <entry>1 or 2 digit hour</entry>
                    </row>
                    <row>
                        <entry>m</entry>
                        <entry>1 or 2 digit minute</entry>
                    </row>
                    <row>
                        <entry>s</entry>
                        <entry>1 or 2 digit second</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            Examples for proper formats are
        </para>

        <table id="zend.locale.date.normalize.table-4">
            <title>Example formats</title>
            <tgroup cols='3'>
                <thead>
                    <row>
                        <entry>Formats</entry>
                        <entry>Input</entry>
                        <entry>Output</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>dd.MM.yy</entry>
                        <entry>1.4.6</entry>
                        <entry>['day'] => 1,
                                   ['month'] => 4,
                                   ['year'] => 6</entry>
                    </row>
                    <row>
                        <entry>dd.MM.yy</entry>
                        <entry>01.04.2006</entry>
                        <entry>['day'] => 1, ['month'] => 4, ['year'] => 2006</entry>
                    </row>
                    <row>
                        <entry>yyyyMMdd</entry>
                        <entry>1.4.6</entry>
                        <entry>['day'] => 6, ['month'] => 4, ['year'] => 1</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <note>
            <title>Database date format</title>
            <para>
                To parse a database date value (f.e. MySql or MsSql), use Zend_Date's ISO_8601 format instead of
                getDate().
            </para>
        </note>

        <para>
            The option '<code>fix_date</code>' uses simple tests to determine if the day or month is not
            valid, and then applies heuristics to try and correct any detected problems. <code>getDate()</code>
            automatically detects and corrects some kinds of problems with input, such as misplacing the year:
        </para>

        <example id="zend.locale.date.normalize.example-5">
            <title>Automatic correction of input dates</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$date = Zend_Locale_Format::getDate('41.10.20', array('date_format' => 'ddMMyy', 'fix_date' => true));

// instead of 41 for the day, the 41 will be returned as year value
print_r ($date);]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.date.test">

        <title>Testing Dates</title>

        <para>
            Use <code>checkDateFormat($inputString, array('date_format' => $format, $locale))</code> to check if a given string
            contains all expected date parts. The <code>checkDateFormat()</code> method uses <code>getDate()</code>, but without
            the option <code>'fixdate'</code> to avoid returning true when the input fails to conform to the date
            format. If errors are detected in the input, such as swapped values for months and days, the
            option <code>'fixdate'</code> method will apply heuristics to "correct" dates before determining their
            validity.
        </para>

        <example id="zend.locale.date.test.example-1">
            <title>Date testing</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
// using the default date format for 'de_AT', is this a valid date?
if (Zend_Locale_Format::checkDateFormat('13.Apr.2006', array('date_format' => Zend_Locale_Format::STANDARD, $locale)) {
    print "date";
} else {
    print "not a date";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.time.normalizing">

        <title>Normalizing a Time</title>

        <para>
            Normally, a time will be returned with a date, if the input contains both. If the proper format is not
            known, but the locale relevant to the user input is known, then <code>getTime()</code> should be used,
            because it uses the default time format for the selected locale.
        </para>

        <example id="zend.locale.time.normalizing.example-1">
            <title>Normalize an unknown time</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
if (Zend_Locale_Format::getTime('13:44:42', array('date_format' => Zend_Locale_Format::STANDARD, 'locale' => $locale)) {
    print "time";
} else {
    print "not a time";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.time.test">

        <title>Testing Times</title>

        <para>
            Use <code>checkDateFormat()</code> to check if a given string contains a proper time.
            The usage is exact the same as with checking Dates, only <code>date_format</code>
            should contain the parts which you expect to have.
        </para>

        <example id="zend.locale.time.test.example-1">
            <title>Testing a time</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
if (Zend_Locale_Format::checkDateFormat('13:44:42', array('date_format' => 'HH:mm:ss', 'locale' => $locale)) {
    print "time";
} else {
    print "not a time";
}]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.locale.functions">

    <title>Using Zend_Locale</title>

    <para>
        <code>Zend_Locale</code> also provides localized information about locales for each locale,
        including localized names for other locales, days of the week, month names, etc.
    </para>

    <sect2 id="zend.locale.copying">

        <title>Copying, Cloning, and Serializing Locale Objects</title>

        <para>
            Use
            <ulink url="http://php.net/language.oop5.cloning">object cloning</ulink>
            to duplicate a locale object exactly and efficiently. Most locale-aware methods also accept string
            representations of locales, such as the result of <code>$locale->toString()</code>.
        </para>

        <example id="zend.locale.copying.example-1">
            <title>clone</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('ar');

// Save the $locale object as a serialization
$serializedLocale = $locale->serialize();
// re-create the original object
$localeObject = unserialize($serializedLocale);

// Obtain a string identification of the locale
$stringLocale = $locale->toString();

// Make a cloned copy of the $local object
$copiedLocale = clone $locale;

print "copied: ", $copiedLocale->toString();
print "copied: ", $copiedLocale; // PHP automatically calls toString() via __toString();]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.equals">

        <title>Equality</title>

        <para>
            <code>Zend_Locale</code> also provides a convenience function to compare two locales. All locale-aware
            classes should provide a similar equality check.
        </para>

        <example id="zend.locale.equals.example-1">
            <title>Check for equal locales</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale();
$mylocale = new Zend_Locale('en_US');

// Check if locales are equal
if ($locale->equals($mylocale)) {
    print "Locales are equal";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.getdefault">

        <title>Default locales</title>

        <para>
            The method <code>getDefault()</code> returns an array of relevant locales using information from the user's
            web browser (if available), information from the environment of the host server, and ZF settings. As with
            the constructor for <code>Zend_Locale</code>, the first parameter selects a preference of which information
            to consider
            <link linkend="zend.locale.selection">(<code>BROWSER</code>, <code>ENVIRONMENT</code>, or <code>FRAMEWORK)</code>
            </link>
            first. The second parameter toggles between returning all matching locales or only the first/best match.
            Locale-aware components normally use only the first locale. A quality rating is included, when available.
        </para>

        <example id="zend.locale.getdefault.example-1">
            <title>Get default locales</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale();

// Return all default locales
$found = $locale->getDefault();
print_r($found);

// Return only browser locales
$found2 = $locale->getDefault(Zend_Locale::BROWSER,TRUE);
print_r($found2);]]>
            </programlisting>
        </example>

        <para>
            To obtain only the default locales relevent to the
            <link linkend="zend.locale.selection"><code>BROWSER</code>, <code>ENVIRONMENT</code>, or <code>FRAMEWORK</code>
            </link>
            , use the corresponding method:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>getEnvironment()</code>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>getBrowser()</code>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>getLocale()</code>
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

    <sect2 id="zend.locale.setlocale">

        <title>Set a new locale</title>

        <para>
            A new locale can be set with the function <code>setLocale()</code>. This function takes a locale string as
            parameter. If no locale is given, a locale is
            <link linkend="zend.locale.selection">automatically selected</link>
            . Since Zend_Locale objects are "light", this method exists primarily to cause side-effects for code that
            have references to the existing instance object.
        </para>

        <example id="zend.locale.setlocale.example-1">
            <title>setLocale</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale();

// Actual locale
print $locale->toString();

// new locale
$locale->setLocale('aa_DJ');
print $locale->toString();]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.getlocale">

        <title>Getting the language and region</title>

        <para>
            Use <code>getLanguage()</code> to obtain a string containing the two character language code from the string
            locale identifier. Use <code>getRegion()</code> to obtain a string containing the two character region code
            from the string locale identifier.
        </para>

        <example id="zend.locale.getlocale.example-1">
            <title>getLanguage and getRegion</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale();

// if locale is 'de_AT' then 'de' will be returned as language
print $locale->getLanguage();

// if locale is 'de_AT' then 'AT' will be returned as region
print $locale->getRegion();]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.getdata">

        <title>Obtaining localized strings</title>

        <para>
            <code>getTranslationList()</code> gives you access to localized informations of several types. These
            information are useful if you want to display localized data to a customer without the need
            of translating it. They are already available for your usage.
        </para>

        <para>
            The requested list of information is always returned as named array. If you want to give more than
            one value to a explicit type where you wish to receive values from, you have to give an array
            instead of multiple values.
        </para>

        <example id="zend.locale.getdata.example-1">
            <title>getTranslationList</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$list = $locale->getTranslationList('language');

print_r ($list);
// example key -> value pairs...
// [de] -> Deutsch
// [en] -> Englisch

// use one of the returned key as value for the getTranslation() method of another language
print $locale->getTranslation('de', 'language', 'zh');
// returns the translation for the language 'de' in chinese]]>
            </programlisting>
        </example>

        <para>
            You can receive this informations for all languages. But not all of the informations are completly
            available for all languages. Some of these types are also available through an own function for
            simplicity. See this list for detailed informations.
        </para>

        <table id="zend.locale.getdata.table-1">
            <title>Details for getTranslationList($type = null, $locale = null, $value = null)</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Type</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry><emphasis role="strong">Language</emphasis></entry>
                        <entry>Returns a localized list of all languages. The language part of the locale
                            is returned as key and the translation as value. For your convinience use the
                            <code>getLanguageTranslationList()</code> method</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Script</emphasis></entry>
                        <entry>Returns a localized list of all scripts. The script is returned as key and the
                            translation as value. For your convinience use the
                            <code>getScriptTranslationList()</code> method</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Territory</emphasis></entry>
                        <entry>Returns a localized list of all territories. This contains countries,
                            continents and territories. To get only territories and continents
                            use '1' as value. To get only countries use '2' as value. The country part of
                            the locale is used as key where applicable. In the other case the official ISO
                            code for this territory is used. The translated territory is returned as value.
                            For your convinience use the <code>getCountryTranslationList()</code> method
                            to receive all countries and the <code>getTerritoryTranslationList()</code>
                            method to receive all territories without countries. When you omit the value
                            you will get a list with both.</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Variant</emphasis></entry>
                        <entry>Returns a localized list of known variants of scripts. The variant is
                            returned as key and the translation as value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Key</emphasis></entry>
                        <entry>Returns a localized list of known keys. This keys are generic values used
                            in translation. These are normally calendar, collation and currency. The key
                            is returned as array key and the translation as value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Type</emphasis></entry>
                        <entry>Returns a localized list of known types of keys. These are variants of types
                            of calendar representations and types of collations. When you use 'collation' as
                            value you will get all types of collations returned. When you use 'calendar' as
                            value you will get all types of calendars returned. When you omit the value you
                            will get a list all both returned. The type is used as key and the translation as
                            value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Layout</emphasis></entry>
                        <entry>Returns a list of rules which describes how to format special text parts</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Characters</emphasis></entry>
                        <entry>Returns a list of allowed characters within this locale</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Delimiters</emphasis></entry>
                        <entry>Returns a list of allowed quoting characters for this locale</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Measurement</emphasis></entry>
                        <entry>Returns a list of known measurement values. This list is depreciated</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Months</emphasis></entry>
                        <entry>Returns a list of all month representations within this locale. There are
                            several different represenations which are all returned as sub array. If you omit
                            the value you will get a list of all months from the 'gregorian' calendar returned.
                            You can give any known calendar as value to get a list of months from this calendar
                            returned. Use <link linkend="zend.date.introduction">Zend_Date</link> for
                            simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Month</emphasis></entry>
                        <entry>Returns a localized list of all month names for this locale. If you omit the
                            value you will get the normally used gregorian full name of the months where each
                            month number is used as key and the translated month is returned as value. You
                            can get the months for different calendars and formats if you give an array as value.
                            The first array entry has to be the calendar, the second the used context and the
                            third the width to return. Use <link linkend="zend.date.introduction">Zend_Date</link>
                            for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Days</emphasis></entry>
                        <entry>Returns a list of all day representations within this locale. There are
                            several different represenations which are all returned as sub array. If you omit
                            the value you will get a list of all days from the 'gregorian' calendar returned.
                            You can give any known calendar as value to get a list of days from this calendar
                            returned. Use <link linkend="zend.date.introduction">Zend_Date</link> for
                            simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Day</emphasis></entry>
                        <entry>Returns a localized list of all day names for this locale. If you omit the
                            value you will get the normally used gregorian full name of the days where the
                            english day abbreviation is used as key and the translated day is returned as
                            value. You can get the days for different calendars and formats if you give an
                            array as value. The first array entry has to be the calendar, the second the used
                            context and the third the width to return. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Week</emphasis></entry>
                        <entry>Returns a list of values used for proper week calculations within a locale.
                            Use <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Quarters</emphasis></entry>
                        <entry>Returns a list of all quarter representations within this locale. There are
                            several different represenations which are all returned as sub array. If you omit
                            the value you will get a list of all quarters from the 'gregorian' calendar returned.
                            You can give any known calendar as value to get a list of quarters from this calendar
                            returned</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Quarter</emphasis></entry>
                        <entry>Returns a localized list of all quarter names for this locale. If you omit the
                            value you will get the normally used gregorian full name of the quarters where each
                            quarter number is used as key and the translated quarter is returned as value. You
                            can get the quarters for different calendars and formats if you give an array as
                            value. The first array entry has to be the calendar, the second the used context
                            and the third the width to return</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Eras</emphasis></entry>
                        <entry>Returns a list of all era representations within this locale. If you omit
                            the value you will get a list of all eras from the 'gregorian' calendar returned.
                            You can give any known calendar as value to get a list of eras from this calendar
                            returned</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Era</emphasis></entry>
                        <entry>Returns a localized list of all era names for this locale. If you omit the
                            value you will get the normally used gregorian full name of the eras where each
                            era number is used as key and the translated era is returned as value. You
                            can get the eras for different calendars and formats if you give an array as
                            value. The first array entry has to be the calendar and the second the width to
                            return</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Date</emphasis></entry>
                        <entry>Returns a localized list of all date formats for this locale. The name of the
                            dateformat is used as key and the format itself as value.If you omit the value you
                            will get the date formats for the gregorian calendar returned. You can get the
                            date formats for different calendars if you give the wished calendar as string.
                            Use <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Time</emphasis></entry>
                        <entry>Returns a localized list of all time formats for this locale. The name of the
                            timeformat is used as key and the format itself as value. If you omit the value you
                            will get the time formats for the gregorian calendar returned. You can get the
                            time formats for different calendars if you give the wished calendar as string.
                            Use <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DateTime</emphasis></entry>
                        <entry>Returns a localized list of all known date-time formats for this locale. The name
                            of the date-time format is used as key and the format itself as value. If you
                            omit the value you will get the date-time formats for the gregorian calendar returned.
                            You can get the date-time formats for different calendars if you give the wished
                            calendar as string. Use <link linkend="zend.date.introduction">Zend_Date</link>
                            for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Field</emphasis></entry>
                        <entry>Returns a localized list of date fields which can be used to display calendars
                            or date strings like 'month' or 'year' in a wished language. If you omit the value
                            you will get this list for the gregorian calendar returned. You can get the
                            list for different calendars if you give the wished calendar as string</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Relative</emphasis></entry>
                        <entry>Returns a localized list of relative dates which can be used to display
                            textual relative dates like 'yesterday' or 'tomorrow' in a wished language.
                            If you omit the value you will get this list for the gregorian calendar
                            returned. You can get the list for different calendars if you give the wished
                            calendar as string</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Symbols</emphasis></entry>
                        <entry>Returns a localized list of characters used for number representations</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">NameToCurrency</emphasis></entry>
                        <entry>Returns a localized list of names for currencies. The currency is used as key
                            and the translated name as value. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyToName</emphasis></entry>
                        <entry>Returns a list of currencies for localized names. The translated name is used
                            as key and the currency as value. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencySymbol</emphasis></entry>
                        <entry>Returns a list of known localized currency symbols for currencies. The
                            currency is used as key and the symbol as value. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Question</emphasis></entry>
                        <entry>Returns a list of localized strings for acceptance ('yes') and
                            negotation ('no'). Use
                            <link linkend="zend.locale.getquestion">Zend_Locale's getQuestion method</link>
                            for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyFraction</emphasis></entry>
                        <entry>Returns a list of fractions for currency values. The currency is used as key and
                            the fraction as integer value. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyRounding</emphasis></entry>
                        <entry>Returns a list of how to round which currency. The currency is used as key and
                            the rounding as integer value. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyToRegion</emphasis></entry>
                        <entry>Returns a list of currencies which are known to be used within a region.
                            The ISO3166 value ('region') is used as array key and the ISO4217 value
                            ('currency') as array value. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">RegionToCurrency</emphasis></entry>
                        <entry>Returns a list of regions where a currency is used . The ISO4217 value ('currency')
                            is used as array key and the ISO3166 value ('region') as array value. When a currency
                            is used in several regions these regions are seperated with a whitespace. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">RegionToTerritory</emphasis></entry>
                        <entry>Returns a list of territories with the countries or sub territories which are
                            included within that territory. The ISO territory code ('territory') is used as
                            array key and the ISO3166 value ('region') as array value. When a territory contains
                            several regions these regions are seperated with a whitespace</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TerritoryToRegion</emphasis></entry>
                        <entry>Returns a list of regions and the territories where these regions are located.
                            The ISO3166 code ('region') is used as array key and the ISO territory code
                            ('territory') as array value. When a region is located in several territories
                            these territories are seperated with a whitespace</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">ScriptToLanguage</emphasis></entry>
                        <entry>Returns a list of scripts which are used within a language. The language code
                            is used as array key and the script code as array value. When a language contains
                            several scripts these scripts are seperated with a whitespace</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">LanguageToScript</emphasis></entry>
                        <entry>Returns a list of languages which are using a script. The script code
                            is used as array key and the language code as array value. When a script is used
                            in several languages these languages are seperated with a whitespace</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TerritoryToLanguage</emphasis></entry>
                        <entry>Returns a list of countries which are using a language. The country code
                            is used as array key and the language code as array value. When a language is used in
                            several countries these countries are seperated with a whitespace</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">LanguageToTerritory</emphasis></entry>
                        <entry>Returns a list of countries and the languages spoken within these countries.
                            The country code is used as array key and the language code as array value. When
                            a territory is using several languages these languages are seperated with a
                            whitespace</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TimezoneToWindows</emphasis></entry>
                        <entry>Returns a list of windows timezones and the related ISO timezone. The windows
                            timezone is used as array key and the ISO timezone as array value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">WindowsToTimezone</emphasis></entry>
                        <entry>Returns a list of ISO timezones and the related windows timezone. The ISO
                            timezone is used as array key and the windows timezone as array value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TerritoryToTimezone</emphasis></entry>
                        <entry>Returns a list of regions or territories and the related ISO timezone. The
                            ISO timezone is used as array key and the territory code as array value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TimezoneToTerritory</emphasis></entry>
                        <entry>Returns a list of timezones and the related region or territory code. The
                            region or territory code is used as array key and the ISO timezone as array
                            value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CityToTimezone</emphasis></entry>
                        <entry>Returns a localized list of cities which can be used as translation for a
                            related timezone. Not for all timezones is a translation available, but for a
                            user is the real city written in his languages more accurate than the ISO name
                            of this timezone. The ISO timezone is used as array key and the translated
                            city as array value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TimezoneToCity</emphasis></entry>
                        <entry>Returns a list of timezones for localized city names. The localized city is
                            used as array key and the ISO timezone name as array value</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            If you are in need of a single translated value, you can use the <code>getTranslation()</code>
            method. It returns always a string but it accepts some different types than the
            <code>getTranslationList()</code> method. Also value is the same as before with one difference.
            You have to give the detail you want to get returned as additional value.
        </para>

        <note>
            <para>
                Because you have almost always give a value as detail this parameter has to be given
                as first parameter. This differs from the <code>getTranslationList()</code> method.
            </para>
        </note>

        <para>
            See the following table for detailed informations: 
        </para>

        <table id="zend.locale.getdata.table-2">
            <title>Details for getTranslation($value = null, $type = null, $locale = null)</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Type</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry><emphasis role="strong">Language</emphasis></entry>
                        <entry>Returns a translation for a language. To select the wished translation
                            you must give the language code as value. For your convinience use the
                            <code>getLanguageTranslation($value)</code> method</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Script</emphasis></entry>
                        <entry>Returns a translation for a script. To select the wished translation you
                            must give the script code as value. For your convinience use the
                            <code>getScriptTranslation($value)</code> method</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Territory</emphasis> or
                            <emphasis role="strong">Country</emphasis></entry>
                        <entry>Returns a translation for a territory. This can be countries, continents
                            and territories. To select the wished variant you must give the territory
                            code as value. For your convinience use the
                            <code>getCountryTranslation($value)</code> method.</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Variant</emphasis></entry>
                        <entry>Returns a translation for a script variant. To select the wished variant
                            you must give the variant code as value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Key</emphasis></entry>
                        <entry>Returns translation for a known keys. This keys are generic values used
                            in translation. These are normally calendar, collation and currency. To
                            select the wished key you must give the key code as value</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DateChars</emphasis></entry>
                        <entry>Returns a character table which contains all characters used when displaying
                            dates</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DefaultCalendar</emphasis></entry>
                        <entry>Returns the default calendar for the given locale. For most locales this
                            will be 'gregorian'. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">MonthContext</emphasis></entry>
                        <entry>Returns the default context for months which is used within the given
                            calendar. If you omit the value the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DefaultMonth</emphasis></entry>
                        <entry>Returns the default format for months which is used within the given
                            calendar. If you omit the value the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Month</emphasis></entry>
                        <entry>Returns a translation for a month. You have to give the number of the month
                            as integer value. It has to be between 1 and 12. If you want to receive data for
                            other calendars, contexts or formats, then you must give an array instead of an
                            integer with the expected values. The array has to look like this: <code>array(
                            'calendar', 'context', 'format', 'month number')</code>. If you give only an
                            integer then the default values are the 'gregorian' calendar, the context
                            'format' and the format 'wide'. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DayContext</emphasis></entry>
                        <entry>Returns the default context for ´days which is used within the given
                            calendar. If you omit the value the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DefaultDay</emphasis></entry>
                        <entry>Returns the default format for days which is used within the given
                            calendar. If you omit the value the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Day</emphasis></entry>
                        <entry>Returns a translation for a day. You have to give the english abbreviation
                            of the day as string value ('sun', 'mon', etc.). If you want to receive data
                            for other calendars, contexts or format, then you must give an array instead of
                            an integer with the expected values. The array has to look like this:
                            <code>array('calendar', 'context', 'format', 'day abbreviation')</code>. If you
                            give only an string then the default values are the 'gregorian' calendar,
                            the context 'format' and the format 'wide'. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Quarter</emphasis></entry>
                        <entry>Returns a translation for a quarter. You have to give the number of the
                            quarter as integer and it has to be between 1 and 4. If you want to receive
                            data for other calendars, contexts or formats, then you must give an array
                            instead of an integer with the expected values. The array has to look like this:
                            <code>array('calendar', 'context', 'format', 'quarter number')</code>. If you
                            give only an string then the default values are the 'gregorian' calendar,
                            the context 'format' and the format 'wide'</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Am</emphasis></entry>
                        <entry>Returns a translation for 'AM' in a expected locale. If you want to receive
                            data for other calendars an string with the expected calendar. If you omit the
                            value then the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Pm</emphasis></entry>
                        <entry>Returns a translation for 'PM' in a expected locale. If you want to receive
                            data for other calendars an string with the expected calendar. If you omit the
                            value then the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Era</emphasis></entry>
                        <entry>Returns a translation for an era within a locale. You have to give the era
                            number as string or integer. If you want to receive data for other calendars or
                            formats, then you must give an array instead of the era number with the expected
                            values. The array has to look like this:
                            <code>array('calendar', 'format', 'era number')</code>. If you give only an
                            string then the default values are the 'gregorian' calendar and the 'abbr'
                            format</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DefaultDate</emphasis></entry>
                        <entry>Returns the default date format which is used within the given
                            calendar. If you omit the value the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Date</emphasis></entry>
                        <entry>Returns the date format for an given calendar or format within a locale.
                            If you omit the value then the 'gregorian' calendar will be used with the
                            'medium' format. If you give a string then the 'gregorian' calendar will be
                            used with the given format. Or you can also give an array which will have to
                            look like this: <code>array('calendar', 'format')</code>. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DefaultTime</emphasis></entry>
                        <entry>Returns the default time format which is used within the given
                            calendar. If you omit the value the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Time</emphasis></entry>
                        <entry>Returns the time format for an given calendar or format within a locale.
                            If you omit the value then the 'gregorian' calendar will be used with the
                            'medium' format. If you give a string then the 'gregorian' calendar will be
                            used with the given format. Or you can also give an array which will have to
                            look like this: <code>array('calendar', 'format')</code>. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DateTime</emphasis></entry>
                        <entry>Returns the datetime format for the given locale which indicates how to
                            display date with times in the same string within the given calendar. If you
                            omit the value the 'gregorian' calendar will be used. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Field</emphasis></entry>
                        <entry>Returns a translated date field which can be used to display calendars or
                            date strings like 'month' or 'year' in a wished language. You must give the
                            field which has to be returned as string. In this case the 'gregorian'
                            calendar will be used. You can get the field for other calendar formats if you
                            give an array which has to look like this:
                            <code>array('calendar', 'date field')</code></entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Relative</emphasis></entry>
                        <entry>Returns a translated date which is relative to today which can include date
                            strings like 'yesterday' or 'tomorrow' in a wished language. You have to give
                            the number of days relative to tomorrow to receive the expected string. Yesterday
                            would be '-1', tomorrow '1' and so on. This will use the 'gregorian' calendar. If
                            you want to get relative dates for other calendars you will have to give an array
                            which has to look like this: <code>array('calendar', 'relative days')</code>. Use
                            <link linkend="zend.date.introduction">Zend_Date</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">DecimalNumber</emphasis></entry>
                        <entry>Returns the format for decimal numbers within a given locale. Use
                            <link linkend="zend.locale.parsing">Zend_Locale_Format</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">ScientificNumber</emphasis></entry>
                        <entry>Returns the format for scientific numbers within a given locale</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">PercentNumber</emphasis></entry>
                        <entry>Returns the format for percentage numbers within a given locale</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyNumber</emphasis></entry>
                        <entry>Returns the format for displaying currency numbers within a given locale. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">NameToCurrency</emphasis></entry>
                        <entry>Returns the translated name for a given currency. The currency has to be
                            given in ISO format which is for example 'EUR' for the currency 'euro'. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyToName</emphasis></entry>
                        <entry>Returns a currency for a given localized name. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencySymbol</emphasis></entry>
                        <entry>Returns the used symbol for a currency within a given locale. Not for all
                            currencies exists a symbol. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">Question</emphasis></entry>
                        <entry>Returns a localized string for acceptance ('yes') and
                            negotation ('no'). You have to give either 'yes' or 'no' as value to receive the
                            expected string. Use
                            <link linkend="zend.locale.getquestion">Zend_Locale's getQuestion method</link>
                            for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyFraction</emphasis></entry>
                        <entry>Returns the fraction to use for a given currency. You must give the currency
                            as ISO value. Use <link linkend="zend.currency.introduction">Zend_Currency</link>
                            for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyRounding</emphasis></entry>
                        <entry>Returns how to round a given currency. You must give the currency
                            as ISO value. If you omit the currency then the 'DEFAULT' rounding will be
                            returned. Use <link linkend="zend.currency.introduction">Zend_Currency</link>
                            for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CurrencyToRegion</emphasis></entry>
                        <entry>Returns the currency for a given region. The region code has to be given
                            as ISO3166 string for example 'AT' for austria. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">RegionToCurrency</emphasis></entry>
                        <entry>Returns the regions where a currency is used. The currency has to be given
                            as ISO4217 code for example 'EUR' for euro. When a currency is used in multiple
                            regions, these regions are seperated with a whitespace character. Use
                            <link linkend="zend.currency.introduction">Zend_Currency</link> for simplicity</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">RegionToTerritory</emphasis></entry>
                        <entry>Returns the regions for a given territory. The territory has to be given as
                            ISO4217 string for example '001' for world. The regions within this territory
                            are seperated with a whitespace character</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TerritoryToRegion</emphasis></entry>
                        <entry>Returns the territories where a given region is located. The region has to be
                            given in ISO3166 string for example 'AT' for austria. When a region is located in
                            multiple territories then these territories are seperated with a whitespace
                            character</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">ScriptToLanguage</emphasis></entry>
                        <entry>Returns the scripts which are used within a given language. The language has
                            to be given as ISO language code for example 'en' for english. When multiple
                            scripts are used within a language then these scripts are seperated with a
                            whitespace character</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">LanguageToScript</emphasis></entry>
                        <entry>Returns the languages which are used within a given script. The script has to be
                            given as ISO script code for example 'Latn' for latin. When a script is used in
                            multiple languages then these languages are seperated with a whitespace
                            character</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TerritoryToLanguage</emphasis></entry>
                        <entry>Returns the territories where a given language is used. The language has
                            to be given as ISO language code for example 'en' for english. When multiple
                            territories exist where this language is used then these territories are
                            seperated with a whitespace character</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">LanguageToTerritory</emphasis></entry>
                        <entry>Returns the languages which are used within a given territory. The territory
                            has to be given as ISO3166 code for example 'IT' for italia. When a language
                            is used in multiple territories then these territories are seperated with a
                            whitespace character</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TimezoneToWindows</emphasis></entry>
                        <entry>Returns a ISO timezone for a given windows timezone</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">WindowsToTimezone</emphasis></entry>
                        <entry>Returns a windows timezone for a given ISO timezone</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TerritoryToTimezone</emphasis></entry>
                        <entry>Returns the territory for a given ISO timezone</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TimezoneToTerritory</emphasis></entry>
                        <entry>Returns the ISO timezone for a given territory</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">CityToTimezone</emphasis></entry>
                        <entry>Returns the localized city for a given ISO timezone. Not for all timezones
                            does a city translation exist</entry>
                    </row>
                    <row>
                        <entry><emphasis role="strong">TimezoneToCity</emphasis></entry>
                        <entry>Returns the ISO timezone for a given localized city name. Not for all cities
                            does a timezone exist</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <note>
            <para>
                With Zend Framework 1.5 several old types have been renamed. This has to be done because
                of several new types, some misspelling and to increase the usability. See this table for
                a list of old to new types:  
            </para>
        </note>

        <table id="zend.locale.getdata.table-3">
            <title>Differences between ZF 1.0 and ZF 1.5</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Old type</entry>
                        <entry>New type</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Country</entry>
                        <entry>Territory (with value '2')</entry>
                    </row>
                    <row>
                        <entry>Calendar</entry>
                        <entry>Type (with value 'calendar')</entry>
                    </row>
                    <row>
                        <entry>Month_Short</entry>
                        <entry>Month (with array('gregorian', 'format', 'abbreviated')</entry>
                    </row>
                    <row>
                        <entry>Month_Narrow</entry>
                        <entry>Month (with array('gregorian', 'stand-alone', 'narrow')</entry>
                    </row>
                    <row>
                        <entry>Month_Complete</entry>
                        <entry>Months</entry>
                    </row>
                    <row>
                        <entry>Day_Short</entry>
                        <entry>Day (with array('gregorian', 'format', 'abbreviated')</entry>
                    </row>
                    <row>
                        <entry>Day_Narrow</entry>
                        <entry>Day (with array('gregorian', 'stand-alone', 'narrow')</entry>
                    </row>
                    <row>
                        <entry>DateFormat</entry>
                        <entry>Date</entry>
                    </row>
                    <row>
                        <entry>TimeFormat</entry>
                        <entry>Time</entry>
                    </row>
                    <row>
                        <entry>Timezones</entry>
                        <entry>CityToTimezone</entry>
                    </row>
                    <row>
                        <entry>Currency</entry>
                        <entry>NameToCurrency</entry>
                    </row>
                    <row>
                        <entry>Currency_Sign</entry>
                        <entry>CurrencySymbol</entry>
                    </row>
                    <row>
                        <entry>Currency_Detail</entry>
                        <entry>CurrencyToRegion</entry>
                    </row>
                    <row>
                        <entry>Territory_Detail</entry>
                        <entry>TerritoryToRegion</entry>
                    </row>
                    <row>
                        <entry>Language_Detail</entry>
                        <entry>LanguageToTerritory</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            The example below demonstrates how to obtain the names of things in different languages.
        </para>

        <example id="zend.locale.getdata.example-3">
            <title>getTranslationList</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('en_US');
// prints the names of all countries in German language
print_r($locale->getTranslationList('country', 'de'));]]>
            </programlisting>
        </example>

        <para>
            The next example shows how to find the name of a language in another language, when the two letter
            iso country code is not known.
        </para>

        <example id="zend.locale.getdata.example-4">
            <title>Converting country name in one language to another</title>
            <programlisting role="php"><![CDATA[<?php
require 'Zend/Locale.php';
$locale = new Zend_Locale('en_US');
$code2name = $locale->getLanguageTranslationList();
$name2code = array_flip($code2name);
$frenchCode = $name2code['French'];
echo $locale->getLanguageTranslation($frenchCode, 'de_AT');
// output is the German name of the French language]]>
            </programlisting>
        </example>

        <para>
            To gain some familiarity with what is available, try the example and examine the output.
        </para>

        <example id="zend.locale.getdata.example-5">
            <title>All available translations</title>
            <programlisting role="php"><![CDATA[<?php
// obtain a list of all the translation lists
$lists = $locale->getTranslationList();

// show all translation lists available (lots of output, all in English language)
foreach ($lists as $list) {
    echo "List $list = ";
    print_r($locale->getTranslationList($list));
}]]>
            </programlisting>
        </example>

        <para>
            To generate a list of all languages known by Zend_Locale, with each language name shown in its own language,
            try the example below in a web page. Similarly, <code>getCountryTranslationList()</code> and
            <code>getCountryTranslation()</code> could be used to create a table mapping your native language names for
            regions to the names of the regions shown in another language. Use a
            <code>try .. catch</code> block to handle exceptions that occur when using a locale that does not exist. Not
            all languages are also locales. In the example, below exceptions are ignored to prevent early termination.
        </para>

        <example id="zend.locale.getdata.example-6">
            <title>All Languages written in their native language</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$sourceLanguage = null; // set to your native language code
$locale = new Zend_Locale($sourceLanguage);
$list = $locale->getLanguageTranslationList();

foreach($list as $language => $content) {
    try {
        $output = $locale->getLanguageTranslation($language, $language);
        if (is_string($output)) {
            print "\n<br>[".$language."] ".$output;
        }
    } catch (Exception $e) {
        continue;
    }
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.getquestion">

        <title>Obtaining translations for "yes" and "no"</title>

        <para>
            Frequently, programs need to solicit a "yes" or "no" response from the user. Use <code>getQuestion()</code>
            to obtain an array containing the correct word(s) or regex strings to use for prompting the user in a
            particular $locale (defaults to the current object's locale). The returned array will contain the
            following informations :
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis role="strong">yes and no</emphasis>: A generic string representation for yes
                    and no responses. This will contain the first and most generic response from yesarray and
                    noarray.
                </para>

                <para>
                    <emphasis role="strong">yesarray and noarray</emphasis>: An array with all known yes and
                    no responses. Several languages have more than just two responses. In general this is the
                    full string and it's abbreviation.
                </para>

                <para>
                    <emphasis role="strong">yesexpr and noexpr</emphasis>: An generated regex which allows you
                    to handle user response, and search for yes or no.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            All of this informations are of course localized and depend on the set locale. See the following
            example for the informations you can receive:
        </para>

        <example id="zend.locale.getquestion.example-1">
            <title>getQuestion()</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale();
// Question strings
print_r($locale->getQuestion('de'));

- - - Output - - -

Array
(
    [yes] => ja
    [no] => nein
    [yesarray] => Array
        (
            [0] => ja
            [1] => j
        )

    [noarray] => Array
        (
            [0] => nein
            [1] => n
        )

    [yesexpr] => ^([jJ][aA]?)|([jJ]?)
    [noexpr] => ^([nN]([eE][iI][nN])?)|([nN]?)
)]]>
            </programlisting>
        </example>

        <note>
            <para>
                Until 1.0.3 <emphasis role="strong">yesabbr</emphasis> from the underlaying locale data was also
                available. Since 1.5 this information is no longer standalone available, but you will find the
                information from it within <emphasis role="strong">yesarray</emphasis>.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.locale.getlocalelist">

        <title>Get a list of all known locales</title>

        <para>
            Sometimes you will want to get a list of all known locales. This can be used for several tasks
            like the creation of a selectbox. For this purpose you can use the static
            <code>getLocaleList()</code> method which will return a list of all known locales.
        </para>

        <example id="zend.locale.getlocalelist.example-1">
            <title>getLocaleList()</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$localelist = Zend_Locale::getLocaleList();
]]>
            </programlisting>
        </example>

        <note>
            <para>
                Note that the locales are returned as key of the array you will receive. The value is always
                a boolean true.
            </para>
        </note>
    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.locale.introduction">

    <title>Introduction</title>

    <para>
        <code>Zend_Locale</code> is the Frameworks answer to the question, "How can the same application be used around
        the whole world?" Most people will say, "That's easy. Let's translate all our output to several languages."
        However, using simple translation tables to map phrases from one language to another is not sufficient.
        Different regions will have different conventions for first names, surnames, salutory titles, formatting of
        numbers, dates, times, currencies, etc.
    </para>

    <para>
        We need
        <ulink url="http://en.wikipedia.org/wiki/L10n">Localization</ulink>
        and complementary
        <ulink url="http://en.wikipedia.org/wiki/L10n">Internationalization</ulink>
        . Both are often abbreviated to <code>L10N</code> and <code>I18N</code>. Internationalization refers more to
        support for use of systems, regardless of special needs unique to groups of users related by language, region,
        number format conventions, financial conventions, time and date conventions, etc. Localization involves adding
        explicit support to systems for special needs of these unique groups, such as language translation, and support
        for local customs or conventions for communicating plurals, dates, times, currencies, names, symbols, sorting
        and ordering, etc. <code>L10N</code> and <code>I18N</code> compliment each other. The Zend Framework provides
        support for these through a combination of components, including Zend_Locale, Zend_Date, Zend_Measure,
        Zend_Translate, Zend_Currency, and Zend_TimeSync.
    </para>

    <tip>
        <title>Zend_Locale and setLocale()</title>
        <para>
            <ulink url="http://php.net/setlocale">PHP's documentation</ulink> states that <code>setlocale()</code>
            is not threadsave because it is maintained per process and not per thread. This means that, in
            multithreaded environments, you can have the problem that the locale changes while the script
            never has changed the locale itself. This can lead to unexpected behaviour when you use
            <code>setlocale()</code> in your scripts.
        </para>
        <para>
            When you are using <code>Zend_Locale</code> you will not have this limitations, because
            <code>Zend_Locale</code> is not related to or coupled with PHP's <code>setlocale()</code>.
        </para>
    </tip>

    <sect2 id="zend.locale.whatislocalization">

        <title>What is Localization</title>

        <para>
            Localization means that an application (or homepage) can be used from different users which speak different
            languages. But as you already have expected Localization means more than only translating strings. It
            includes
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    <code>Zend_Locale</code> - Backend support of locales available for localization support within
                    other ZF components.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Translate</code> - Translating of strings.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Date</code> - Localization of dates, times.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Calendar</code> - Localization of calendars (support for non-Gregorian calendar systems)
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Currency</code> - Localization of currencies.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Locale_Format</code> - Parsing and generating localized numbers.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Locale_Data</code> - Retrieve localized standard strings as country names, language names
                    and
                    <ulink url="http://unicode.org/cldr/">more from the CLDR</ulink>
                    .
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>TODO</code> - Localization of collations
                </para>
            </listitem>
        </itemizedlist>

    </sect2>

    <sect2 id="zend.locale.whatis">

        <title>
            <ulink url="http://unicode.org/reports/tr35/#Locale">What is a Locale?</ulink>
        </title>

        <para>
            Each computer user makes use of Locales, even when they don't know it. Applications lacking localization
            support, normally have implicit support for one particular locale (the locale of the author). When a class
            or function makes use of localization, we say it is <code>locale-aware</code>. How does the code know which
            localization the user is expecting?
        </para>

        <para>
            A locale string or object identifying a supported locale gives <code>Zend_Locale</code> and it's subclasses
            access to information about the language and region expected by the user. Correct formatting, normalization,
            and conversions are made based on this information.
        </para>

    </sect2>

    <sect2 id="zend.locale.representation">

        <title>How are Locales Represented?</title>

        <para>
            Locale identifiers consist of information about the user's language and preferred/primary geographic region
            (e.g. state or province of home or workplace). The locale identifier strings used in the Zend Framework are
            internationally defined standard abbreviations of language and region, written as
            <code>language_REGION</code>. Both the language and region parts are abbreviated to alphabetic, ASCII
            characters.
        </para>

        <note>
            <para>
                Be aware that there exist not only locales with 2 characters as most people think. Also there
                are languages and regions which are not only abbreviated with 2 characters. Therefor you should
                NOT strip the region and language yourself, but use Zend_Locale when you want to strip language
                or region from a locale string. Otherwise you could have unexpected behaviour within your code
                when you do this yourself.
            </para>
        </note>

        <para>
            A user from USA would expect the language <code>English</code> and the region <code>USA</code>, yielding the
            locale identifier "en_US". A user in Germany would expect the language <code>German</code> and the region
            <code>Germany</code>, yielding the locale identifier "de_DE". See the
            <ulink url="http://unicode.org/cldr/data/diff/supplemental/languages_and_territories.html">list of pre-defined locale and region combinations</ulink>
            , if you need to select a specific locale within the Zend Framework.
        </para>

        <example id="zend.locale.representation.example-1">
            <title>Choosing a specific locale</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend_Locale';
$locale = new Zend_Locale('de_DE'); // German language _ Germany]]>
            </programlisting>
        </example>

        <para>
            A German user in America might expect the language <code>German</code> and the region <code>USA</code>, but
            these non-standard mixes are not supported directly as recognized "locales". Instead, if an invalid
            combination is used, then it will automatically be truncated by dropping the region code. For example,
            "de_IS" would be truncated to "de", and "xh_RU" would be truncated to "xh", because neither of these
            combinations are valid. Additionally, if the base language code is not supported (e.g. "zz_US") or does not
            exist, then a default "root" locale will be used. The "root" locale has default definitions for
            internationally recognized representations of dates, times, numbers, currencies, etc. The truncation process
            depends on the requested information, since some combinations of language and region might be valid for one
            type of data (e.g. dates), but not for another (e.g. currency format).
        </para>

        <para>
            Beware of historical changes, as ZF components do not know about or attempt to track the numerous timezone
            changes made over many years by many regions. For example,
            <ulink url="http://www.statoids.com/tus.html">we can see a historical list</ulink>
            showing dozens of changes made by governments to when and if a particular region observes Daylight Savings
            Time, and even which timezone a particular geographic area belongs. Thus, when performing date math, the
            math performed by ZF components will not adjust for these changes, but instead will give the correct time
            for the timezone using current, modern rules for DST and timezone assignment for geographic regions.
        </para>

    </sect2>

    <sect2 id="zend.locale.selection">

        <title>Selecting the Right Locale</title>

        <para>
            For most situations, <code>new Zend_Locale()</code> will automatically select the correct locale, with
            preference given to information provided by the user's web browser. However, if <code>new
            Zend_Locale(Zend_Locale::ENVIRONMENT)</code> is used, then preference will be given to using the host
            server's environment configuration, as described below.
        </para>

        <example id="zend.locale.selection.example-1">
            <title>Automatically selecting a locale</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';
$locale  = new Zend_Locale();
$locale1 = new Zend_Locale(Zend_Locale::BROWSER);     // default behavior, same as above
$locale2 = new Zend_Locale(Zend_Locale::ENVIRONMENT); // prefer settings on host server
$locale3 = new Zend_Locale(Zend_Locale::FRAMEWORK);   // perfer framework app default settings]]>
            </programlisting>
        </example>

        <para>
            The seach algorithm used by <code>Zend_Locale</code> for automatic selection of a locale uses three sources
            of information:
            <orderedlist>
                <listitem>
                    <para>
                        const <code>Zend_Locale::BROWSER</code> - The user's Web browser provides information with each
                        request, which is published by PHP in the global variable <code>HTTP_ACCEPT_LANGUAGE</code>. If
                        no matching locale can be found, then preference is given to <code>ENVIRONMENT</code> and lastly
                        <code>FRAMEWORK</code>.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        const <code>Zend_Locale::ENVIRONMENT</code> - PHP publishes the host server's locale via the PHP
                        internal function <code>setlocale()</code>. If no matching locale can be found, then preference
                        is given to FRAMEWORK and lastly BROWSER.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        const <code>Zend_Locale::FRAMEWORK</code> - When the Zend Framework has a standardized way of
                        specifying component defaults (planned, but not yet available), then using this constant during
                        instantiation will give preference to choosing a locale based on these defaults. If no matching
                        locale can be found, then preference is given to <code>ENVIRONMENT</code> and lastly
                        <code>BROWSER</code>.
                    </para>
                </listitem>
            </orderedlist>
        </para>

    </sect2>


    <sect2 id="zend.locale.selection.automatic">

        <title>Usage of automatic Locales</title>

        <para>
            <code>Zend_Locale</code> provides three additionally locales. These locales do not belong to
            any language or region. They are "automatic" locales which means that they have the same effect
            as the method <code>getDefault()</code> but without the negative effects like creating an instance. 
            These "automatic" locales can be used anywhere, where also a standard locale and also the
            definition of a locale, it's string representation, can be used. This offers simplicity for
            situations like working with locales which are provided by a browser.
        </para>

        <para>
            There are three locales which have a slightly different behaviour:

            <orderedlist>
                <listitem>
                    <para>
                        <code>'browser'</code> - <code>Zend_Locale</code> should work with the information
                        which is provided by the user's Web browser. It is published by PHP in the global
                        variable <code>HTTP_ACCEPT_LANGUAGE</code>.
                    </para>
                    <para>
                        If a user provides more than one locale within his browser, <code>Zend_Locale</code>
                        will use the first found locale. If the user does not provide a locale or the script is
                        being called from the commandline the automatic locale <code>'environment'</code>
                        will automatically be used and returned.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>'environment'</code> - <code>Zend_Locale</code> should work with the information
                        which is provided by the host server. It is published by PHP via the internal function
                        <code>setlocale()</code>.
                    </para>
                    <para>
                        If a environment provides more than one locale, <code>Zend_Locale</code> will use the
                        first found locale. If the host does not provide a locale the automatic locale
                        <code>'browser'</code> will automatically be used and returned.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>'auto'</code> - <code>Zend_Locale</code> should automatically detect any locale
                        which can be worked with. It will first search for a users locale and then, if not
                        successfull, search for the host locale.
                    </para>
                    <para>
                        If no locale can be detected, it will throw an exception and tell you that the
                        automatical detection has been failed.
                    </para>
                </listitem>
            </orderedlist>
        </para>

        <example id="zend.locale.selection.automatic.example-1">
            <title>Using automatic locales</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';
require_once 'Zend/Date.php';

// without automatic detection
//$locale = new Zend_Locale(Zend_Locale::BROWSER);
//$date = new Zend_Date($locale);

// with automatic detection
$date = new Zend_Date('auto');]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.defaultlocale">

        <title>Using a default Locale</title>

        <para>
            In some environments it is not possible to detect a locale automatically. You can expect this
            behaviour when you get an request from commandline or the requesting browser has no language tag
            set and additionally your server has the default locale 'C' set or another properitary locale.
        </para>

        <para>
            In such cases <code>Zend_Locale</code> will normally throw an exception with a message that
            the automatic detection of any locale was not successfull. You have two options to handle such
            a situation. Either through setting a new locale per hand, or defining a default locale.
        </para>

        <example id="zend.locale.defaultlocale.example-1">
            <title>Handling locale exceptions</title>
            <programlisting role="php"><![CDATA[<?php
// within the bootstrap file
require_once 'Zend/Locale.php';

try {
    $locale = new Zend_Locale('auto');
} catch (Zend_Locale_Exception $e) {
    $locale = new Zend_Locale('de');
}

// within your model/controller
$date = new Zend_Date($locale);]]>
            </programlisting>
        </example>

        <para>
            But this has one big negative effect. You will have to set your locale object within
            every class using <code>Zend_Locale</code>. This could become very unhandy if you are using
            multiple classes.
        </para>

        <para>
            Since Zend Framework Release 1.5 there is a much better way to handle this. You can set a
            default locale which the static <code>setDefault()</code> method. Of course, every unknown
            or not full qualified locale will also throw an exception. <code>setDefault()</code> should
            be the first call before you initiate any class using <code>Zend_Locale</code>. See the
            following example for details:
        </para>

        <example id="zend.locale.defaultlocale.example-2">
            <title>Setting a default locale</title>
            <programlisting role="php"><![CDATA[<?php
// within the bootstrap file
require_once 'Zend/Locale.php';

Zend_Locale::setDefault('de');

// within your model/controller
$date = new Zend_Date();]]>
            </programlisting>
        </example>

        <para>
            In the case that no locale can be detected, automatically the locale
            <emphasis role="strong">de</emphasis> will be used. Otherwise, the detected locale will be used.
        </para>

    </sect2>

    <sect2 id="zend.locale.interoperate">

        <title>ZF Locale-Aware Classes</title>

        <para>
            In the ZF, locale-aware classes rely on <code>Zend_Locale</code> to automatically select a locale, as
            explained above. For example, in a ZF web application, constructing a date using <code>Zend_Date</code>
            without specifying a locale results in an object with a locale based on information provided by the current
            user's web browser.
        </para>

        <example id="zend.locale.interoperate.example-1">
            <title>Dates default to correct locale of web users</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';
$date = new Zend_Date('2006',Zend_Date::YEAR);]]>
            </programlisting>
        </example>

        <para>
            To override this default behavior, and force locale-aware ZF components to use specific locales, regardless
            of the origin of your website visitors, explicitly specify a locale as the third argument to the
            constructor.
        </para>

        <example id="zend.locale.interoperate.example-2">
            <title>Overriding default locale selection</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';
require_once 'Zend/Measure/Temperature.php';

$usLocale = new Zend_Locale('en_US');
$date = new Zend_Date('2006', Zend_Date::YEAR, $usLocale);
$temp = new Zend_Measure_Temperature('100,10', Zend_Measure::TEMPERATURE, $usLocale);]]>
            </programlisting>
        </example>

        <para>
            If you know many objects should all use the same default locale, explicitly specify the default locale to
            avoid the overhead of each object determining the default locale.
        </para>

        <example id="zend.locale.interoperate.example-3">
            <title>Performance optimization when using a default locale</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Date.php';
require_once 'Zend/Measure/Temperature.php';

$locale = new Zend_Locale();
$date = new Zend_Date('2006', Zend_Date::YEAR, $locale);
$temp = new Zend_Measure_Temperature('100,10', Zend_Measure::TEMPERATURE, $locale);]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.formatoptions">

        <title>Zend_Locale_Format::setOptions(array $options)</title>

        <para>
            The 'precision' option of a value is used to truncate or stretch extra digits. A value of '-1' disables
            modification of the number of digits in the fractional part of the value. The 'locale' option helps when
            parsing numbers and dates using separators and month names. The date format 'format_type' option selects between
            CLDR/ISO date format specifier tokens and PHP's date() tokens. The 'fix_date' option enables or disables
            heuristics that attempt to correct invalid dates. The 'number_format' option specifies a default number
            format for use with <code>toNumber()</code> (see
            <xref
                linkend= "zend.locale.number.localize"/>
            ).
        </para>

        <para>
            The 'date_format' option can be used to specify a default date format string, but beware of using getDate(),
            checkdateFormat() and getTime() after using setOptions() with a 'date_format'. To use these four methods
            with the default date format for a locale, use array('date_format' => null, 'locale' => $locale) for their
            options.
        </para>

        <example id="zend.locale.formatoptions.example-1">
            <title>Dates default to correct locale of web users</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';
Zend_Locale_Format::setOptions(array('locale' => 'en_US', 'fix_date' => true, 'format_type' => 'php'));]]>
            </programlisting>
        </example>

        <para>
            For working with the standard definitions of a locale the option Zend_Locale_Format::STANDARD can be used.
            Setting the option Zend_Locale_Format::STANDARD for date_format uses the standard definitions from the actual
            set locale. Setting it for number_format uses the standard number format for this locale.
            And setting it for locale uses the standard locale for this environment or browser.
        </para>

        <example id="zend.locale.formatoptions.example-2">
            <title>Using STANDARD definitions for setOptions()</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';
Zend_Locale_Format::setOptions(array('locale' => 'en_US', 'date_format' => 'dd.MMMM.YYYY'));
// overriding the global set date format
$date = Zend_Locale_Format::getDate('2007-04-20, array('date_format' => Zend_Locale_Format::STANDARD);

// global setting of the standard locale
Zend_Locale_Format::setOptions(array('locale' => Zend_Locale_Format::STANDARD, 'date_format' => 'dd.MMMM.YYYY'));]]>
            </programlisting>
        </example>

    </sect2>


    <sect2 id="zend.locale.cache">

        <title>Speed up Zend_Locale and it's subclasses</title>

        <para>
            <code>Zend_Locale</code> and it's subclasses can be speed up by the usage of <code>Zend_Cache</code>.
            Use the static method <code>Zend_Locale::setCache($cache)</code> if you are using
            <code>Zend_Locale</code>. <code>Zend_Locale_Format</code> can be speed up the using the option
            <code>cache</code> within <code>Zend_Locale_Format::setOptions(array('cache' => $adapter));</code>.
            If you are using both classes you should only set an cache for <code>Zend_Locale</code>, otherwise
            the data would be cached twice.
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.locale.parsing">

    <title>Normalization and Localization</title>

    <para>
        <code>Zend_Locale_Format</code> is a internal component used by Zend_Locale. All locale aware classes use
        <code>Zend_Locale_Format</code> for normalization and localization of numbers and dates. Normalization involves
        parsing input from a variety of data respresentations, like dates, into a standardized, structured
        representation, such as a PHP array with year, month, and day elements.
    </para>

    <para>
        The exact same string containing a number or a date might mean different things to people with different customs
        and conventions. Disambiguation of numbers and dates requires rules about how to interpret these strings and
        normalize the values into a standardized data structure. Thus, all methods in <code>Zend_Locale_Format</code>
        require a locale in order to parse the input data.
        <note>
            <title>Default "root" Locale</title>
            <para>
                If no locale is specified, then normalization and localization will use the standard "root" locale,
                which might yield unexpected behavior, if the input originated in a different locale, or output for a
                specific locale was expected.
            </para>
        </note>
    </para>

    <sect2 id="zend.locale.number.normalize">

        <title>Number normalization: getNumber($input, Array $options)</title>

        <para>
            There are many
            <ulink url="http://en.wikipedia.org/wiki/Numeral">number systems</ulink>
            different from the common
            <ulink url="http://en.wikipedia.org/wiki/Decimal">decimal system</ulink>
            (e.g. "3.14"). Numbers can be normalized with the <code>getNumber()</code> function to obtain the standard
            decimal representation. For all number-related discussions in this manual,
            <ulink url="http://en.wikipedia.org/wiki/Arabic_numerals">Arabic/European numerals (0,1,2,3,4,5,6,7,8,9)</ulink>
            are implied, unless explicitly stated otherwise. The options array may contain a 'locale' to define grouping
            and decimal characters. The array may also have a 'precision' to truncate excess digits from the result.
        </para>

        <example id="zend.locale.number.normalize.example-1">
            <title>Number normalization</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::getNumber('13.524,678', array('locale' => $locale, 'precision' => 3));

print $number; // will return 13524.678]]>
            </programlisting>
        </example>

        <sect3 id="zend.locale.number.normalize.precision">

            <title>Precision and Calculations</title>

            <para>
                Since <code>getNumber($value, array $options = array())</code> can normalize extremely large numbers,
                check the result carefully before using finite precision calculations, such as ordinary PHP math
                operations. For example, <code>if ((string)int_val($number) != $number) { use
                <ulink url="http://www.php.net/bc">BCMath</ulink>
                or
                <ulink url="http://www.php.net/gmp">GMP</ulink>
                </code>. Most PHP installations support the BCMath extension.
            </para>

            <para>
                Also, the precision of the resulting decimal representation can be rounded to a desired length with
                <code>getNumber()</code> with the option <code>'precision'</code>. If no precision is given,
                no rounding occurs. Use only PHP integers to specify the precision.
            </para>

            <para>
                If the resulting decimal representation should be truncated to a desired length instead of rounded
                the option <code>'number_format'</code> can be used instead. Define the length of the decimal
                representation with the desired length of zeros. The result will then not be rounded.
                So if the defined precision within <code>number_format</code> is zero the value "1.6" will
                return "1", not "2. See the example nearby:
            </para>

            <example id="zend.locale.number.normalize.precision.example-1">
                <title>Number normalization with precision</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::getNumber('13.524,678', array('precision' => 1, 'locale' => $locale));
print $number; // will return 13524.7

$number = Zend_Locale_Format::getNumber('13.524,678', array('number_format' => '#.00', 'locale' => $locale));
print $number; // will return 13524.67]]>
                </programlisting>
            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.locale.number.localize">

        <title>Number localization</title>

        <para>
            <code>toNumber($value, array $options = array())</code> can localize numbers to the
            <link linkend="zend.locale.regions">supported locales</link>
            . This function will return a localized string of the given number in a conventional format for a specific
            locale. The 'number_format' option explicitly specifies a non-default number format for use with
            <code>toNumber()</code>.
        </para>

        <example id="zend.locale.number.localize.example-1">
            <title>Number localization</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::toNumber(13547.36, array('locale' => $locale));

// will return 13.547,36
print $number;]]>
            </programlisting>
        </example>

        <para>
            <note>
                <title>Unlimited length</title>
                <para>
                    <code>toNumber()</code> can localize numbers with unlimited length. It is not related to integer or
                    float limitations.
                </para>
            </note>
        </para>

        <para>
            The same way as within <code>getNumber()</code>, <code>toNumber()</code> handles precision. If no precision
            is given, the complete localized number will be returned.
        </para>

        <example id="zend.locale.number.localize.example-2">
            <title>Number localization with precision</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::toNumber(13547.3678, array('precision' => 2, 'locale' => $locale));

// will return 13.547,37
print $number;]]>
            </programlisting>
        </example>

        <para>
            Using the option 'number_format' a self defined format for generating a number can be defined.
            The format itself has to be given in CLDR format as described below. The locale is used to get
            seperation, precission and other number formatting signs from it. German for example defines
            ',' as precission seperation and in english the '.' sign is used.
        </para>

        <table id="zend.locale.number.localize.table-1">
            <title>Format tokens for self generated number formats
            </title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Token</entry>
                        <entry>Description</entry>
                        <entry>Example format</entry>
                        <entry>Generated output</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>#0</entry>
                        <entry>Generates a number without precission and seperation</entry>
                        <entry>#0</entry>
                        <entry>1234567</entry>
                    </row>
                    <row>
                        <entry>,</entry>
                        <entry>Generates a seperation with the length from seperation to next seperation or to 0</entry>
                        <entry>#,##0</entry>
                        <entry>1,234,567</entry>
                    </row>
                    <row>
                        <entry>#,##,##0</entry>
                        <entry>Generates a standard seperation of 3 and all following seperations with 2</entry>
                        <entry>#,##,##0</entry>
                        <entry>12,34,567</entry>
                    </row>
                    <row>
                        <entry>.</entry>
                        <entry>Generates a precission</entry>
                        <entry>#0.#</entry>
                        <entry>1234567.1234</entry>
                    </row>
                    <row>
                        <entry>0</entry>
                        <entry>Generates a precission with a defined length</entry>
                        <entry>#0.00</entry>
                        <entry>1234567.12</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <example id="zend.locale.number.localize.example-3">
            <title>Using a self defined number format</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::toNumber(13547.3678, array('number_format' => '#,#0.00', 'locale' => 'de'));

// will return 1.35.47,36
print $number;

$number = Zend_Locale_Format::toNumber(13547.3, array('number_format' => '#,##0.00', 'locale' => 'de'));

// will return 13.547,30
print $number;]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.number.test">

        <title>Number testing</title>

        <para>
            <code>isNumber($value, array $options = array())</code> checks if a given string is a number and returns
            true or false.
        </para>

        <example id="zend.locale.number.test.example-1">
            <title>Number testing</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale();
if (Zend_Locale_Format::isNumber('13.445,36', array('locale' => 'de_AT')) {
    print "Number";
} else {
    print "not a Number";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.float.normalize">

        <title>Float value normalization</title>

        <para>
            Floating point values can be parsed with the <code>getFloat($value, array $options = array())</code>
            function. A floating point value will be returned.
        </para>

        <example id="zend.locale.float.normalize.example-1">
            <title>Floating point value normalization</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::getFloat('13.524,678', array('precision' => 2, 'locale' => $locale));

// will return 13524.68
print $number;]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.float.localize">

        <title>Floating point value localization</title>

        <para>
            <code>toFloat()</code> can localize floating point values. This function will return a localized string of
            the given number.
        </para>

        <example id="zend.locale.float.localize.example-1">
            <title>Floating point value localization</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::toFloat(13547.3655, array('precision' => 1, 'locale' => $locale));

// will return 13.547,4
print $number;]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.float.test">

        <title>Floating point value testing</title>

        <para>
            <code>isFloat($value, array $options = array())</code> checks if a given string is a floating point value
            and returns true or false.
        </para>

        <example id="zend.locale.float.test.example-1">
            <title>Floating point value testing</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
if (Zend_Locale_Format::isFloat('13.445,36', array('locale' => $locale)) {
    print "float";
} else {
    print "not a float";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.integer.normalize">

        <title>Integer value normalization</title>

        <para>
            Integer values can be parsed with the <code>getInteger()</code> function. A integer value will be returned.
        </para>

        <example id="zend.locale.integer.normalize.example-1">
            <title>Integer value normalization</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::getInteger('13.524,678', array('locale' => $locale));

// will return 13524
print $number;]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.integer.localize">

        <title>Integer point value localization</title>

        <para>
            <code>toInteger($value, array $options = array())</code> can localize integer values. This function will
            return a localized string of the given number.
        </para>

        <example id="zend.locale.integer.localize.example-1">
            <title>Integer value localization</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
$number = Zend_Locale_Format::toInteger(13547.3655, array('locale' => $locale));

// will return 13.547
print $number;]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.integer.test">

        <title>Integer value testing</title>

        <para>
            <code>isInteger($value, array $options = array())</code> checks if a given string is a integer value and
            returns true or false.
        </para>

        <example id="zend.locale.integer.test.example-1">
            <title>Integer value testing</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$locale = new Zend_Locale('de_AT');
if (Zend_Locale_Format::isInteger('13.445', array('locale' => $locale)) {
    print "integer";
} else {
    print "not a integer";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.locale.numbersystems">

        <title>Numeral System Conversion</title>

        <para>
            <code>Zend_Locale_Format::convertNumerals()</code> converts digits between different
            <ulink url="http://en.wikipedia.org/wiki/Arabic_numerals">numeral systems</ulink>
            , including the standard Arabic/European/Latin numeral system (0,1,2,3,4,5,6,7,8,9), not to be confused with
            <ulink url="http://en.wikipedia.org/wiki/Eastern_Arabic_numerals">Eastern Arabic numerals</ulink>
            sometimes used with the Arabic language to express numerals. Attempts to use an unsupported numeral system
            will result in an exception, to avoid accidentally performing an incorrect conversion due to a spelling
            error. All characters in the input, which are not numerals for the selected numeral system, are copied to
            the output with no conversion provided for unit separator characters.  <code>Zend_Locale*</code> components
            rely on the data provided by CLDR (see their
            <ulink url="http://unicode.org/cldr/data/diff/supplemental/languages_and_scripts.html?sortby=date">
                list of scripts grouped by language</ulink>).
        </para>

        <para>
            In CLDR and hereafter, the Europena/Latin numerals will
            be referred to as "Latin" or by the assigned 4-letter code "Latn".
            Also, the CLDR refers to this numeral systems as "scripts".
        </para>

        <para>
            Suppose a web form collected a numeric input expressed using Eastern Arabic digits "١‎٠٠".
            Most software and PHP functions expect input using Arabic numerals. Fortunately, converting this input
            to it's equivalent Latin numerals "100" requires little effort using
            <code>convertNumerals($inputNumeralString, $sourceNumeralSystem, $destNumeralSystem)</code>
            , which returns the <code>$input</code> with numerals in the script <code>$sourceNumeralSystem</code>
            converted to the script <code>$destNumeralSystem</code>.
        </para>

        <example id="zend.locale.numbersystems.example-1">
            <title>Converting numerals from Eastern Arabic scripts to European/Latin scripts</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$arabicScript = "١‎٠٠";   // Arabic for "100" (one hundred)
$latinScript = Zend_Locale_Format::convertNumerals($arabicScript, 'Arab', 'Latn');

print "\nOriginal:   " . $arabicScript;
print "\nNormalized: " . $latinScript;]]>
            </programlisting>
        </example>

        <para>
            Similarly, any of the supported numeral systems may be converted to any other supported numeral system.
        </para>

        <example id="zend.locale.numbersystems.example-2">
            <title>Converting numerals from Latin script to Eastern Arabic script</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Locale.php';

$latinScript = '123';
$arabicScript = Zend_Locale_Format::convertNumerals($latinScript, 'Latn', 'Arab');

print "\nOriginal:  " . $latinScript;
print "\nLocalized: " . $arabicScript;]]>
            </programlisting>
        </example>

        <example id="zend.locale.numbersystems.example-3">
            <title>Getting 4 letter CLDR script code using a native-language name of the script</title>
            <programlisting role="php"><![CDATA[<?php
function getScriptCode($scriptName, $locale)
{
    $scripts2names = Zend_Locale_Data::getList($locale, 'script');
    $names2scripts = array_flip($scripts2names);
    return $names2scripts[$scriptName];
}
echo getScriptCode('Latin', 'en'); // outputs "Latn"
echo getScriptCode('Tamil', 'en'); // outputs "Taml"
echo getScriptCode('tamoul', 'fr'); // outputs "Taml"]]>
            </programlisting>
        </example>

        <sect3 id="zend.locale.appendix.numberscripts.supported">

            <title>List of supported numeral systems</title>

            <para>
                <table id="zend.locale.appendix.numberscripts.supported.table">
                    <title>List of supported numeral systems</title>
                    <tgroup cols="2">
                        <thead>
                            <row>
                                <entry>Notation Name</entry>
                                <entry>Script</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Arabic</entry>
                                <entry>Arab</entry>
                            </row>
                            <row>
                                <entry>Balinese</entry>
                                <entry>Bali</entry>
                            </row>
                            <row>
                                <entry>Bengali</entry>
                                <entry>Beng</entry>
                            </row>
                            <row>
                                <entry>Devanagari</entry>
                                <entry>Deva</entry>
                            </row>
                            <row>
                                <entry>Gujarati</entry>
                                <entry>Gujr</entry>
                            </row>
                            <row>
                                <entry>Gurmukhi</entry>
                                <entry>Guru</entry>
                            </row>
                            <row>
                                <entry>Kannada</entry>
                                <entry>Knda</entry>
                            </row>
                            <row>
                                <entry>Khmer</entry>
                                <entry>Khmr</entry>
                            </row>
                            <row>
                                <entry>Lao</entry>
                                <entry>Laoo</entry>
                            </row>
                            <row>
                                <entry>Limbu</entry>
                                <entry>Limb</entry>
                            </row>
                            <row>
                                <entry>Malayalam</entry>
                                <entry>Mlym</entry>
                            </row>
                            <row>
                                <entry>Mongolian</entry>
                                <entry>Mong</entry>
                            </row>
                            <row>
                                <entry>Myanmar</entry>
                                <entry>Mymr</entry>
                            </row>
                            <row>
                                <entry>New_Tai_Lue</entry>
                                <entry>Talu</entry>
                            </row>
                            <row>
                                <entry>Nko</entry>
                                <entry>Nkoo</entry>
                            </row>
                            <row>
                                <entry>Oriya</entry>
                                <entry>Orya</entry>
                            </row>
                            <row>
                                <entry>Tamil</entry>
                                <entry>Taml</entry>
                            </row>
                            <row>
                                <entry>Telugu</entry>
                                <entry>Telu</entry>
                            </row>
                            <row>
                                <entry>Thai</entry>
                                <entry>Tale</entry>
                            </row>
                            <row>
                                <entry>Tibetan</entry>
                                <entry>Tibt</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>

        </sect3>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.log.filters">
    <title>Filters</title>

    <para>
      A Filter object blocks a message from being written to the log.
    </para>

    <sect2 id="zend.log.filters.all-writers">
      <title>Filtering for All Writers</title>

      <para>
        To filter before all writers, you can add any number of Filters to a
        Log object using the <code>addFilter()</code> method:

        <programlisting role="php"><![CDATA[<?php
$logger = new Zend_Log();

$writer = new Zend_Log_Writer_Stream('php://output');
$logger->addWriter($writer);

$filter = new Zend_Log_Filter_Priority(Zend_Log::CRIT);
$logger->addFilter($filter);

// blocked
$logger->info('Informational message');

// logged
$logger->emerg('Emergency message');]]>
        </programlisting>

        When you add one or more Filters to the Log object, the message must pass
        through all of the Filters before any Writers receives it.
      </para>
    </sect2>

    <sect2 id="zend.log.filters.single-writer">
      <title>Filtering for a Writer Instance</title>

      <para>
        To filter only on a specific Writer instance, use the
        <code>addFilter</code> method of that Writer:

        <programlisting role="php"><![CDATA[<?php
$logger = new Zend_Log();

$writer1 = new Zend_Log_Writer_Stream('/path/to/first/logfile');
$logger->addWriter($writer1);

$writer2 = new Zend_Log_Writer_Stream('/path/to/second/logfile');
$logger->addWriter($writer2);

// add a filter only to writer2
$filter = new Zend_Log_Filter_Priority(Zend_Log::CRIT);
$writer2->addFilter($filter);

// logged to writer1, blocked from writer2
$logger->info('Informational message');

// logged by both writers
$logger->emerg('Emergency message');]]>
        </programlisting>
    </para>
  </sect2>
</sect1>
<sect1 id="zend.log.formatters">
  <title>Formatters</title>
  <para>
    A Formatter is an object that is responsible for taking an <code>event</code> array
    describing a log event and outputting a string with a formatted log line.
  </para>

  <para>
    Some Writers are not line-oriented and cannot use a Formatter.  An example is the
    Database Writer, which inserts the event items directly into database columns.  For
    Writers that cannot support a Formatter, an exception is thrown if you attempt to
    set a Formatter.
  </para>

  <sect2 id="zend.log.formatters.simple">
    <title>Simple Formatting</title>
    <para>
      <code>Zend_Log_Formatter_Simple</code> is the default formatter.  It is configured
      automatically when you specify no formatter.  The default configuration is equivalent
      to the following:

      <programlisting role="php"><![CDATA[<?php
$format = '%timestamp% %priorityName% (%priority%): %message%' . PHP_EOL;
$formatter = new Zend_Log_Formatter_Simple($format);]]>
      </programlisting>
    </para>

    <para>
      A formatter is set on an individual Writer object using the Writer's
      <code>setFormatter()</code> method:

      <programlisting role="php"><![CDATA[<?php
$writer = new Zend_Log_Writer_Stream('php://output');
$formatter = new Zend_Log_Formatter_Simple('hello %message%' . PHP_EOL);
$writer->setFormatter($formatter);

$logger = new Zend_Log();
$logger->addWriter($writer);

$logger->info('there');

// outputs "hello there"]]>
      </programlisting>
    </para>

    <para>
      The constructor of <code>Zend_Log_Formatter_Simple</code> accepts a single
      parameter: the format string.  This string contains keys surrounded by
      percent signs (e.g. <code>%message%</code>).  The format string may
      contain any key from the event data array.
    </para>
  </sect2>

  <sect2 id="zend.log.formatters.xml">
    <title>Formatting to XML</title>
    <para>
      <code>Zend_Log_Formatter_Xml</code> formats log data into XML strings.
      By default, it automatically logs all items in the event data array:

      <programlisting role="php"><![CDATA[<?php
$writer = new Zend_Log_Writer_Stream('php://output');
$formatter = new Zend_Log_Formatter_Xml();
$writer->setFormatter($formatter);

$logger = new Zend_Log();
$logger->addWriter($writer);

$logger->info('informational message');]]>
      </programlisting>
    </para>

    <para>
      The code above outputs the following XML (space added for clarity):

      <programlisting role="xml"><![CDATA[
<logEntry>
  <timestamp>2007-04-06T07:24:37-07:00</timestamp>
  <message>informational message</message>
  <priority>6</priority>
  <priorityName>INFO</priorityName>
</logEntry>]]>
      </programlisting>
    </para>

    <para>
      It's possible to customize the root element as well as specify a mapping
      of XML elements to the items in the event data array.  The constructor
      of <code>Zend_Log_Formatter_Xml</code> accepts a string with the name of
      the root element as the first parameter and an associative array with
      the element mapping as the second parameter:

      <programlisting role="php"><![CDATA[<?php
$writer = new Zend_Log_Writer_Stream('php://output');
$formatter = new Zend_Log_Formatter_Xml('log', array('msg' => 'message', 'level' => 'priorityName'));
$writer->setFormatter($formatter);

$logger = new Zend_Log();
$logger->addWriter($writer);

$logger->info('informational message');]]>
      </programlisting>

      The code above changes the root element from its default of
      <code>logEntry</code> to <code>log</code>.  It also maps the element
      <code>msg</code> to the event data item <code>message</code>.  This
      results in the following output:

      <programlisting role="xml"><![CDATA[
<log>
  <msg>informational message</msg>
  <level>INFO</level>
</log>]]>
      </programlisting>
    </para>

  </sect2>
</sect1>
<sect1 id="zend.log.overview">
    <title>Overview</title>

    <para>
      <code>Zend_Log</code> is a component for general purpose logging.
      It supports multiple log backends, formatting messages sent to the log,
      and filtering messages from being logged. These functions are divided
      into the following objects:

      <itemizedlist>
        <listitem>
          <para>
            A Log (instance of <code>Zend_Log</code>) is the object that your
            application uses the most. You can have as many Log objects as you
            like; they do not interact. A Log object must contain at
            least one Writer, and can optionally contain one or more Filters.
          </para>
        </listitem><listitem>
          <para>
            A Writer (inherits from <code>Zend_Log_Writer_Abstract</code>) is
            responsible for saving data to storage.
          </para>
        </listitem><listitem>
          <para>
            A Filter (implements <code>Zend_Log_Filter_Interface</code>)
            blocks log data from being saved. A filter may be applied to an
            individual Writer, or to a Log where it is applied before all
            Writers. In either case, filters may be chained.
          </para>
        </listitem><listitem>
          <para>
            A Formatter (implements <code>Zend_Log_Formatter_Interface</code>)
            can format the log data before it is written by a Writer. Each
            Writer has exactly one Formatter.
          </para>
        </listitem>
      </itemizedlist>
    </para>

    <sect2 id="zend.log.overview.creating-a-logger">
      <title>Creating a Log</title>
      <para>
        To get started logging, instantiate a Writer and then pass it to a Log
        instance:

        <programlisting role="php"><![CDATA[<?php
$logger = new Zend_Log();
$writer = new Zend_Log_Writer_Stream('php://output');

$logger->addWriter($writer);]]>
        </programlisting>

        It is important to note that the Log must
        have at least one Writer.  You can add any number of Writers using the
        Log's <code>addWriter()</code> method.
      </para>

      <para>
        Alternatively, you can pass a Writer directly to constructor of Log as
        a shortcut:

        <programlisting role="php"><![CDATA[<?php
$writer = new Zend_Log_Writer_Stream('php://output');
$logger = new Zend_Log($writer);]]>
        </programlisting>

        The Log is now ready to use.
      </para>
    </sect2>

    <sect2 id="zend.log.overview.logging-messages">
      <title>Logging Messages</title>

      <para>
        To log a message, call the <code>log()</code> method of a Log instance
        and pass it the message with a corresponding priority:

      <programlisting role="php"><![CDATA[<?php
$logger->log('Informational message', Zend_Log::INFO);]]>
      </programlisting>

      The first parameter of the <code>log()</code> method is a string <code>message</code> and the second
      parameter is an integer <code>priority</code>.  The priority must be one of the priorities recognized
      by the Log instance.  This is explained in the next section.
    </para>

    <para>
      A shortcut is also available. Instead of calling the <code>log()</code> method, you can
      call a method by the same name as the priority:

      <programlisting role="php"><![CDATA[<?php
$logger->log('Informational message', Zend_Log::INFO);
$logger->info('Informational message');

$logger->log('Emergency message', Zend_Log::EMERG);
$logger->emerg('Emergency message');]]>
      </programlisting>
    </para>
  </sect2>

  <sect2 id="zend.log.overview.destroying-a-logger">
    <title>Destroying a Log</title>
    <para>
      If the Log object is no longer needed, set the variable containing it to
      <code>null</code> to destroy it. This will automatically call the
      <code>shutdown()</code> instance method of each attached Writer before
      the Log object is destroyed:

      <programlisting role="php"><![CDATA[<?php
$logger = null;]]>
      </programlisting>

      Explicitly destroying the log in this way is optional and is performed
      automatically at PHP shutdown.
    </para>
  </sect2>

  <sect2 id="zend.log.overview.builtin-priorities">
    <title>Using Built-in Priorities</title>
    <para>
      The <code>Zend_Log</code> class defines the following priorities:

      <programlisting role="php"><![CDATA[
EMERG   = 0;  // Emergency: system is unusable
ALERT   = 1;  // Alert: action must be taken immediately
CRIT    = 2;  // Critical: critical conditions
ERR     = 3;  // Error: error conditions
WARN    = 4;  // Warning: warning conditions
NOTICE  = 5;  // Notice: normal but significant condition
INFO    = 6;  // Informational: informational messages
DEBUG   = 7;  // Debug: debug messages]]>
      </programlisting>

      These priorities are always available, and a convenience method of the same name
      is available for each one.
    </para>

    <para>
      The priorities are not arbitrary. They come from the BSD <code>syslog</code> protocol,
      which is described in <ulink url="http://tools.ietf.org/html/rfc3164">RFC-3164</ulink>.
      The names and corresponding priority numbers are also
      compatible with another PHP logging system,
      <ulink url="http://pear.php.net/package/log">PEAR Log</ulink>,
      which perhaps promotes interoperability between it and <code>Zend_Log</code>.
    </para>

    <para>
      Priority numbers descend in order of importance. <code>EMERG</code> (0)
      is the most important priority. <code>DEBUG</code> (7) is the least
      important priority of the built-in priorities. You may define priorities
      of lower importance than <code>DEBUG</code>. When
      selecting the priority for your log message, be aware of this priority
      hierarchy and choose appropriately.
    </para>
  </sect2>

  <sect2 id="zend.log.overview.user-defined-priorities">
    <title>Adding User-defined Priorities</title>

    <para>
      User-defined priorities can be added at runtime using the Log's
      <code>addPriority()</code> method:

      <programlisting role="php"><![CDATA[<?php
$logger->addPriority('FOO', 8);]]>
      </programlisting>

      The snippet above creates a new priority, <code>FOO</code>, whose
      value is <code>8</code>. The new priority is then available for logging:

      <programlisting role="php"><![CDATA[<?php
$logger->log('Foo message', 8);
$logger->foo('Foo Message');]]>
      </programlisting>

      New priorities cannot overwrite existing ones.
    </para>
  </sect2>

  <sect2 id="zend.log.overview.understanding-fields">
    <title>Understanding Log Events</title>

    <para>
      When you call the <code>log()</code> method or one of its shortcuts, a
      log event is created. This is simply an associative array with data
      describing the event that is passed to the writers. The following keys
      are always created in this array: <code>timestamp</code>,
      <code>message</code>, <code>priority</code>, and
      <code>priorityName</code>.
    </para>

    <para>
      The creation of the <code>event</code> array is completely transparent.
      However, knowledge of the <code>event</code> array is required for adding an
      item that does not exist in the default set above.
    </para>

    <para>
      To add a new item to every future event, call the <code>setEventItem()</code>
      method giving a key and a value:

      <programlisting role="php"><![CDATA[<?php
$logger->setEventItem('pid', getmypid());]]>
      </programlisting>

      The example above sets a new item named <code>pid</code> and populates
      it with the PID of the current process. Once a new item has been
      set, it is available automatically to all writers along with all of the
      other data event data during logging. An item can be overwritten at any
      time by calling the <code>setEventItem()</code> method again.
    </para>

    <para>
      Setting a new event item with <code>setEventItem()</code> causes the
      new item to be sent to all writers of the logger. However, this does
      not guarantee that the writers actually record the item. This is
      because the writers won't know what to do with it unless a formatter
      object is informed of the new item. Please see the section on Formatters
      to learn more.
    </para>
  </sect2>
</sect1>
<sect1 id="zend.log.writers">
  <title>Writers</title>
  <para>
    A Writer is an object that inherits from <code>Zend_Log_Writer_Abstract</code>.  A Writer's
    responsibility is to record log data to a storage backend.
  </para>

  <sect2 id="zend.log.writers.stream">
    <title>Writing to Streams</title>
    <para>
      <code>Zend_Log_Writer_Stream</code> sends log
      data to a <ulink url="http://www.php.net/stream">PHP stream</ulink>.
    </para>

    <para>
      To write log data to the PHP output buffer, use the URL <code>php://output</code>.  Alternatively,
      you can may like to send log data directly to a stream like <code>STDERR</code>
      (<code>php://stderr</code>).

      <programlisting role="php"><![CDATA[<?php
$writer = new Zend_Log_Writer_Stream('php://output');
$logger = new Zend_Log($writer);

$logger->info('Informational message');]]>
      </programlisting>
    </para>

    <para>
      To write data to a file, use one of the
      <ulink url="http://www.php.net/manual/en/wrappers.php#wrappers.file">Filesystem
      URLs</ulink>:

      <programlisting role="php"><![CDATA[<?php
$writer = new Zend_Log_Writer_Stream('/path/to/logfile');
$logger = new Zend_Log($writer);

$logger->info('Informational message');]]>
      </programlisting>

      By default, the stream opens in the append mode (<code>"a"</code>).
      To open it with a different mode, the Zend_Log_Writer_Stream constructor
      accepts an optional second parameter for the mode.
    </para>

    <para>
      The constructor of <code>Zend_Log_Writer_Stream</code> also accepts an existing stream resource:

      <programlisting role="php"><![CDATA[<?php
$stream = @fopen('/path/to/logfile', 'a', false);
if (! $stream) {
    throw new Exception('Failed to open stream');
}

$writer = new Zend_Log_Writer_Stream($stream);
$logger = new Zend_Log($writer);

$logger->info('Informational message');]]>
      </programlisting>

      You cannot specify the mode for existing stream resources. Doing so
      causes a <code>Zend_Log_Exception</code> to be thrown.
    </para>
  </sect2>

  <sect2 id="zend.log.writers.database">
    <title>Writing to Databases</title>
    <para>
      <code>Zend_Log_Writer_Db</code> writes log information to a database table using
      <code>Zend_Db</code>.  The constructor of <code>Zend_Log_Writer_Db</code> receives
      a <code>Zend_Db_Adapter</code> instance, a table name, and a mapping of database
      columns to event data items:

      <programlisting role="php"><![CDATA[<?php
$params = array ('host'     => '127.0.0.1',
                 'username' => 'malory',
                 'password' => '******',
                 'dbname'   => 'camelot');
$db = Zend_Db::factory('PDO_MYSQL', $params);

$columnMapping = array('lvl' => 'priority', 'msg' => 'message');
$writer = new Zend_Log_Writer_Db($db, 'log_table_name', $columnMapping);

$logger = new Zend_Log($writer);

$logger->info('Informational message');]]>
      </programlisting>

      The example above writes a single row of log data to the database table named
      <code>log_table_name</code> table.  The database column named <code>lvl</code>
      receives the priority number and the column named <code>msg</code> receives the
      log message.
    </para>

  </sect2>

  <sect2 id="zend.log.writers.null">
    <title>Stubbing Out the Writer</title>
    <para>
      The <code>Zend_Log_Writer_Null</code> is a stub that does not write log data to anything.
      It is useful for disabling logging or stubbing out logging during tests:

      <programlisting role="php"><![CDATA[<?php
$writer = new Zend_Log_Writer_Null;
$logger = new Zend_Log($writer);

// goes nowhere
$logger->info('Informational message');]]>
      </programlisting>
    </para>
  </sect2>

  <sect2 id="zend.log.writers.mock">
    <title>Testing with the Mock</title>
    <para>
      The <code>Zend_Log_Writer_Mock</code> is a very simple writer that records
      the raw data it receives in an array exposed as a public property.

      <programlisting role="php"><![CDATA[<?php
$mock = new Zend_Log_Writer_Mock;
$logger = new Zend_Log($mock);

$logger->info('Informational message');

var_dump($mock->events[0]);

// Array
// (
//    [timestamp] => 2007-04-06T07:16:37-07:00
//    [message] => Informational message
//    [priority] => 6
//    [priorityName] => INFO
// )]]>
      </programlisting>
    </para>

    <para>
      To clear the events logged by the mock, simply set <code>$mock->events = array()</code>.
    </para>
  </sect2>

  <sect2 id="zend.log.writers.compositing">
    <title>Compositing Writers</title>

    <para>
      There is no composite Writer object. However, a Log instance can write
      to any number of Writers. To do this, use the <code>addWriter()</code>
      method:

      <programlisting role="php"><![CDATA[<?php
$writer1 = new Zend_Log_Writer_Stream('/path/to/first/logfile');
$writer2 = new Zend_Log_Writer_Stream('/path/to/second/logfile');

$logger = new Zend_Log();
$logger->addWriter($writer1);
$logger->addWriter($writer2);

// goes to both writers
$logger->info('Informational message');]]>
      </programlisting>
    </para>
  </sect2>
</sect1>
<sect1 id="zend.mail.adding-recipients">
    <title>Adding Recipients</title>
    <para>
        Recipients can be added in three ways:
        <itemizedlist>
        <listitem>
        <para><code>addTo()</code>: Adds a recipient to the mail with a "To" header</para>
        </listitem>
        <listitem>
        <para><code>addCc()</code>: Adds a recipient to the mail with a "Cc" header</para>
        </listitem>
        <listitem>
        <para><code>addBcc()</code>: Adds a recipient to the mail not visible in the header.</para>
        </listitem>
        </itemizedlist>
    </para>
    <note>
        <title>Additional parameter</title>
        <para>
            <code>addTo()</code> and <code>addCc()</code> accept a second optional parameter that is used as a
            human-readable name of the recipient for the header.
        </para>
    </note>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.mail.additional-headers">
    <title>Additional Headers</title>
    <para>
        Arbitrary mail headers can be set by using the <code>addHeader()</code> method. It requires two
        parameters containing the name and the value of the header field. A third optional parameter determines
        if the header should have only one or multiple values:
    </para>
    <example id="zend.mail.additional-headers.example-1">
        <title>Adding E-Mail Message Headers</title>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();
$mail->addHeader('X-MailGenerator', 'MyCoolApplication');
$mail->addHeader('X-greetingsTo', 'Mom', true); // multiple values
$mail->addHeader('X-greetingsTo', 'Dad', true);]]>
        </programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.attachments">
    <title>Attachments</title>
    <para>
        Files can be attached to an e-mail using the <code>createAttachment()</code> method. The default behaviour
        of <code>Zend_Mail</code> is to assume the attachment is a binary object (application/octet-stream),
        should be transferred with base64 encoding, and is handled as an attachment. These assumptions can be
        overridden by passing more parameters to <code>createAttachment()</code>:
    </para>
    <example id="zend.mail.attachments.example-1">
        <title>E-Mail Messages with Attachments</title>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();
// build message...
$mail->createAttachment($someBinaryString);
$mail->createAttachment($myImage, 'image/gif', Zend_Mime::DISPOSITION_INLINE, Zend_Mime::ENCODING_8BIT);]]>
        </programlisting>
    </example>
    <para>
        If you want more control over the MIME part generated for this attachment you can use the return value
        of <code>createAttachment()</code> to modify its attributes. The <code>createAttachment()</code> method
        returns a <code>Zend_Mime_Part</code> object:
    </para>
    <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();

$at = $mail->createAttachment($myImage);
$at->type        = 'image/gif';
$at->disposition = Zend_Mime::DISPOSITION_INLINE;
$at->encoding    = Zend_Mime::ENCODING_8BIT;
$at->filename    = 'test.gif';

$mail->send();]]>
    </programlisting>
    <para>
        An alternative is to create an instance of <code>Zend_Mime_Part</code> and add it with <code>addAttachment()</code>:
    </para>
    <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();

$at = new Zend_Mime_Part($myImage);
$at->type        = 'image/gif';
$at->disposition = Zend_Mime::DISPOSITION_INLINE;
$at->encoding    = Zend_Mime::ENCODING_8BIT;
$at->filename    = 'test.gif';

$mail->addAttachment($at);

$mail->send();]]>
    </programlisting>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.boundary">
    <title>Controlling the MIME Boundary</title>
    <para>
        In a multipart message a MIME boundary for separating the different parts of the message is normally
        generated at random. In some cases, however, you might want to specify the MIME boundary that is used.
        This can be done using the <code>setMimeBoundary()</code> method, as in the following example:
    </para>
    <example id="zend.mail.boundary.example-1">
        <title>Changing the MIME Boundary</title>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();
$mail->setMimeBoundary('=_' . md5(microtime(1) . $someId++);
// build message...]]>
        </programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.character-sets">
    <title>Character Sets</title>
    <para>
        <code>Zend_Mail</code> does not check for the correct character set of the mail parts. When
        instantiating <code>Zend_Mail</code>, a charset for the e-mail itself may be given. It defaults to
        <code>iso-8859-1</code>. The application has to make sure that all parts added to that mail object
        have their content encoded in the correct character set. When creating a new mail part, a different
        charset can be given for each part.
    </para>
    <note>
        <title>Only in text format</title>
        <para>
            Character sets are only applicable for message parts in text format.
        </para>
    </note>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.mail.different-transports">
    <title>Using Different Transports</title>
    <para>
        In case you want to send different e-mails through different connections, you can also pass the
        transport object directly to <code>send()</code> without a prior call to
        <code>setDefaultTransport()</code>. The passed object will override the default transport for the
        actual <code>send()</code> request:
    </para>
    <example id="zend.mail.different-transports.example-1">
        <title>Using Different Transports</title>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();
// build message...
require_once 'Zend/Mail/Transport/Smtp.php';
$tr1 = new Zend_Mail_Transport_Smtp('server@example.com');
$tr2 = new Zend_Mail_Transport_Smtp('other_server@example.com');
$mail->send($tr1);
$mail->send($tr2);
$mail->send();  // use default again]]>
        </programlisting>
    </example>
    <note>
        <title>Additional transports</title>
        <para>
            Additional transports can be written by implementing <code>Zend_Mail_Transport_Interface</code>.
        </para>
    </note>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.encoding">
    <title>Encoding</title>
    <para>
        Text and HTML message bodies are encoded with the quotedprintable mechanism by default. All other
        attachments are encoded via base64 if no other encoding is given in the <code>addAttachment()</code>
        call or assigned to the MIME part object later. 7Bit and 8Bit encoding currently only pass on the
        binary content data.
    </para>
    <para>
        <code>Zend_Mail_Transport_Smtp</code> encodes lines starting with one dot or two dots so that the mail
        does not violate the SMTP protocol.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.mail.html-mails">
    <title>HTML E-Mail</title>
    <para>
        To send an e-mail in HTML format, set the body using the method <code>setBodyHTML()</code> instead of
        <code>setBodyText()</code>. The MIME content type will automatically be set to <code>text/html</code>
        then. If you use both HTML and Text bodies, a multipart/alternative MIME message will automatically be
        generated:
    </para>
    <example id="zend.mail.html-mails.example-1">
        <title>Sending HTML E-Mail</title>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();
$mail->setBodyText('My Nice Test Text');
$mail->setBodyHtml('My Nice <b>Test</b> Text');
$mail->setFrom('somebody@example.com', 'Some Sender');
$mail->addTo('somebody_else@example.com', 'Some Recipient');
$mail->setSubject('TestSubject');
$mail->send();]]>
        </programlisting>
    </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.introduction">

    <title>Introduction</title>

    <sect2 id="zend.mail.introduction.getting-started">

        <title>Getting started</title>

        <para>
            <code>Zend_Mail</code> provides generalized functionality to compose and send both text and MIME-compliant
            multipart e-mail messages. Mail can be sent with <code>Zend_Mail</code> via the default <code>Zend_Mail_Transport_Sendmail</code>
            transport or via <code>Zend_Mail_Transport_Smtp</code>.
        </para>

        <example id="zend.mail.introduction.example-1">

            <title>Simple E-Mail with Zend_Mail</title>

            <para>
                A simple e-mail consists of some recipients, a subject, a body and a sender. To send such a mail using
                <code>Zend_Mail_Transport_Sendmail</code>, do the following:
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();
$mail->setBodyText('This is the text of the mail.');
$mail->setFrom('somebody@example.com', 'Some Sender');
$mail->addTo('somebody_else@example.com', 'Some Recipient');
$mail->setSubject('TestSubject');
$mail->send();]]>
            </programlisting>

        </example>
    
        <note>
            <title>Minimum definitions</title>
            <para>
                In order to send an e-mail with <code>Zend_Mail</code> you have to specify at least one recipient, a
                sender (e.g., with <code>setFrom()</code>), and a message body (text and/or HTML).
            </para>
        </note>

        <para>
            For most mail attributes there are "get" methods to read the information stored in the mail object. For
            further details, please refer to the API documentation. A special one is <code>getRecipients()</code>.
            It returns an array with all recipient e-mail addresses that were added prior to the method call.
        </para>

        <para>
            For security reasons, <code>Zend_Mail</code> filters all header fields to prevent header injection with
            newline (<code>\n</code>) characters.
        </para>

        <para>
            You also can use most methods of the <code>Zend_Mail</code> object with a convenient fluent interface. A fluent
            interface means that each method returns a reference to the object on which it was called, so you can
            immediately call another method.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
$mail = new Zend_Mail();
$mail->setBodyText('This is the text of the mail.')
    ->setFrom('somebody@example.com', 'Some Sender')
    ->addTo('somebody_else@example.com', 'Some Recipient')
    ->setSubject('TestSubject')
    ->send();]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.mail.introduction.sendmail">

        <title>Configuring the default sendmail transport</title>

        <para>
            The default transport for a <code>Zend_Mail</code> instance is <code>Zend_Mail_Transport_Sendmail</code>.
            It is essentially a wrapper to the PHP <ulink url="http://php.net/mail"><code>mail()</code></ulink> function. 
            If you wish to pass additional parameters to the <ulink url="http://php.net/mail"><code>mail()</code></ulink> function, 
            simply create a new transport instance and pass your parameters to the constructor. The new transport instance
            can then act as the default <code>Zend_Mail</code> transport, or it can be passed to the <code>send()</code>
            method of <code>Zend_Mail</code>.
        </para>

        <example id="zend.mail.introduction.sendmail.example-1">

            <title>Passing additional parameters to the Zend_Mail_Transport_Sendmail transport</title>

            <para>
                This example shows how to change the Return-Path of the <ulink url="http://php.net/mail"><code>mail()</code></ulink>
                function.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
require_once 'Zend/Mail/Transport/Sendmail.php';

$tr = new Zend_Mail_Transport_Sendmail('-freturn_to_me@example.com');
Zend_Mail::setDefaultTransport($tr);

$mail = new Zend_Mail();
$mail->setBodyText('This is the text of the mail.');
$mail->setFrom('somebody@example.com', 'Some Sender');
$mail->addTo('somebody_else@example.com', 'Some Recipient');
$mail->setSubject('TestSubject');
$mail->send();]]>
            </programlisting>

        </example>

        <note>
            <title>Safe mode restrictions</title>
            <para>
                The optional additional parameters will be cause the <ulink url="http://php.net/mail"><code>mail()</code></ulink> function to fail
                if PHP is running in safe mode.
            </para>
        </note>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.multiple-emails">
    <title>Sending Multiple Mails per SMTP Connection</title>

    <para>
        By default a single SMTP transport creates a single connection and
        re-uses it for the lifetime of the script execution. You may send multiple
        e-mails through this SMTP connection. A RSET command is issued before each
        delivery to ensure the correct SMTP handshake is followed.
    </para>

    <example id="zend.mail.multiple-emails.example-1">

        <title>Sending Multiple Mails per SMTP Connection</title>

        <programlisting role="php"><![CDATA[<?php
// Load classes
require_once 'Zend/Mail.php';

// Create transport
require_once 'Zend/Mail/Transport/Smtp.php';
$transport = new Zend_Mail_Transport_Smtp('localhost');

// Loop through messages
for ($i = 0; $i > 5; $i++) {
    $mail = new Zend_Mail();
    $mail->addTo('studio@peptolab.com', 'Test');
    $mail->setFrom('studio@peptolab.com', 'Test');
    $mail->setSubject('Demonstration - Sending Multiple Mails per SMTP Connection');
    $mail->setBodyText('...Your message here...');
    $mail->send($transport);
}]]>
        </programlisting>

    </example>
    
    <para>
        If you wish to have a separate connection for each mail
        delivery, you will need to create and destroy your transport before and
        after each <function>send()</function> method is called. Or alternatively,
        you can manipulate the connection between each delivery by accessing the
        transport's protocol object.
    </para>

    <example id="zend.mail.multiple-emails.example-2">

        <title>Manually controlling the transport connection</title>

        <programlisting role="php"><![CDATA[<?php

// Load classes
require_once 'Zend/Mail.php';

// Create transport
require_once 'Zend/Mail/Transport/Smtp.php';
$transport = new Zend_Mail_Transport_Smtp();

require_once 'Zend/Mail/Protocol/Smtp.php';
$protocol = new Zend_Mail_Protocol_Smtp('localhost');
$protocol->connect();
$protocol->helo('localhost');

$transport-&gt;setConnection($protocol);

// Loop through messages
for ($i = 0; $i > 5; $i++) {
    $mail = new Zend_Mail();
    $mail->addTo('studio@peptolab.com', 'Test');
    $mail->setFrom('studio@peptolab.com', 'Test');
    $mail->setSubject('Demonstration - Sending Multiple Mails per SMTP Connection');
    $mail->setBodyText('...Your message here...');

    // Manually control the connection
    $protocol->rset();
    $mail->send($transport);
}

$protocol->quit();
$protocol->disconnect();]]>
        </programlisting>

    </example>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.mail.sending">
    <title>Sending via SMTP</title>
    <para>
        To send mail via SMTP, <code>Zend_Mail_Transport_Smtp</code> needs to be created and registered with
        <code>Zend_Mail</code> before the <code>send()</code> method is called. For all remaining
        <code>Zend_Mail::send()</code> calls in the current script, the SMTP transport will then be used:
    </para>
    <example id="zend.mail.sending.example-1">
        <title>Sending E-Mail via SMTP</title>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail/Transport/Smtp.php';
$tr = new Zend_Mail_Transport_Smtp('mail.example.com');
Zend_Mail::setDefaultTransport($tr);]]>
        </programlisting>
    </example>
    <para>
        The <code>setDefaultTransport()</code> method and the constructor of
        <code>Zend_Mail_Transport_Smtp</code> are not expensive. These two lines can be processed at script
        setup time (e.g., config.inc or similar) to configure the behaviour of the <code>Zend_Mail</code> class
        for the rest of the script. This keeps configuration information out of the application logic - whether
        mail is sent via SMTP or <ulink url="http://php.net/mail"><code>mail()</code></ulink>, what mail server
        to use, etc.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.smtp-authentication">
  <title>SMTP Authentication</title>

  <para><code>Zend_Mail</code> supports the use of SMTP Authentication, which
  can be enabled be passing the 'auth' parameter to the configuration array in
  the <code>Zend_Mail_Transport_Smtp</code> constructor. The available
  built-in Authentication methods are PLAIN, LOGIN and CRAM-MD5 which all
  expect a 'username' and 'password' value in the configuration array.</para>

  <example id="zend.mail.smtp-authentication.example-1">
    <title>Enabling authentication within Zend_Mail_Transport_Smtp</title>

    <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
require_once 'Zend/Mail/Transport/Smtp.php';

$config = array('auth' => 'login',
                'username' => 'myusername',
                'password' => 'password');

$transport = new Zend_Mail_Transport_Smtp('mail.server.com', $config);

$mail = new Zend_Mail();
$mail->setBodyText('This is the text of the mail.');
$mail->setFrom('sender@test.com', 'Some Sender');
$mail->addTo('recipient@test.com', 'Some Recipient');
$mail->setSubject('TestSubject');
$mail->send($transport);]]>
    </programlisting>
  </example>

  <note>
    <title>Authentication types</title>

    <para>
        The authentication type is case-insensitive but has no punctuation.
        E.g. to use CRAM-MD5 you would pass 'auth' => 'crammd5' in the
        <code>Zend_Mail_Transport_Smtp</code> constructor.</para>
  </note>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.smtp-secure">
  <title>Securing SMTP Transport</title>

  <para><code>Zend_Mail</code> also supports the use of either TLS or SSL to
  secure a SMTP connection. This can be enabled be passing the 'ssl' parameter
  to the configuration array in the <code>Zend_Mail_Transport_Smtp</code>
  constructor with a value of either 'ssl' or 'tls'. A port can optionally be
  supplied, otherwise it defaults to 25 for TLS or 465 for SSL.</para>

  <example id="zend.mail.smtp-secure.example-1">
    <title>Enabling a secure connection within
    Zend_Mail_Transport_Smtp</title>

    <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Mail.php';
require_once 'Zend/Mail/Transport/Smtp.php';

$config = array('ssl' => 'tls',
                'port' => 25); // Optional port number supplied

$transport = new Zend_Mail_Transport_Smtp('mail.server.com', $config);

$mail = new Zend_Mail();
$mail->setBodyText('This is the text of the mail.');
$mail->setFrom('sender@test.com', 'Some Sender');
$mail->addTo('recipient@test.com', 'Some Recipient');
$mail->setSubject('TestSubject');
$mail->send($transport);]]>
    </programlisting>
  </example>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.mail.read">
    <title>Reading Mail Messages</title>

    <para>
        <code>Zend_Mail</code> can read mail messages from several local or remote mail storages. All of them have the
        same basic API to count and fetch messages and some of them implement additional interfaces for not so common
        features. For a feature overview of the implemented storages see the following table.
    </para>

    <table id="zend.mail.read.table-1">
        <title>Mail Read Feature Overview</title>
        <tgroup cols="5">
            <thead>
                <row>
                    <entry>Feature</entry>
                    <entry>Mbox</entry>
                    <entry>Maildir</entry>
                    <entry>Pop3</entry>
                    <entry>IMAP</entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>Storage type</entry>
                    <entry>local</entry>
                    <entry>local</entry>
                    <entry>remote</entry>
                    <entry>remote</entry>
                </row>
                <row>
                    <entry>Fetch message</entry>
                    <entry>Yes</entry>
                    <entry>Yes</entry>
                    <entry>Yes</entry>
                    <entry>Yes</entry>
                </row>
                <row>
                    <entry>Fetch mime-part</entry>
                    <entry>emulated</entry>
                    <entry>emulated</entry>
                    <entry>emulated</entry>
                    <entry>emulated</entry>
                </row>
                <row>
                    <entry>Folders</entry>
                    <entry>Yes </entry>
                    <entry>Yes</entry>
                    <entry>No</entry>
                    <entry>Yes</entry>
                </row>
                <row>
                    <entry>Create message/folder</entry>
                    <entry>No</entry>
                    <entry>todo</entry>
                    <entry>No</entry>
                    <entry>todo</entry>
                </row>
                <row>
                    <entry>Flags</entry>
                    <entry>No</entry>
                    <entry>Yes</entry>
                    <entry>No</entry>
                    <entry>Yes</entry>
                </row>
                <row>
                    <entry>Quota</entry>
                    <entry>No</entry>
                    <entry>Yes</entry>
                    <entry>No</entry>
                    <entry>No</entry>
                </row>
            </tbody>
        </tgroup>
    </table>

    <sect2 id="zend.mail.read-example">
        <title>Simple example using Pop3</title>

        <programlisting role="php"><![CDATA[<?php
$mail = new Zend_Mail_Storage_Pop3(array('host'     => 'localhost',
                                         'user'     => 'test',
                                         'password' => 'test'));

echo $mail->countMessages() . " messages found\n";
foreach ($mail as $message) {
    echo "Mail from '{$message->from}': {$message->subject}\n";
}]]>
        </programlisting>

    </sect2>
    <sect2 id="zend.mail.read-open-local">
        <title>Opening a local storage</title>

        <para>
            Mbox and Maildir are the two supported formats for local mail storages, both in their most simple formats.
        </para>
        <para>
            If you want to read from a Mbox file you only need to give the filename to the constructor of
            <code>Zend_Mail_Storage_Mbox</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
$mail = new Zend_Mail_Storage_Mbox(array('filename' => '/home/test/mail/inbox'));]]>
        </programlisting>

        <para>Maildir is very similar but needs a dirname:</para>

        <programlisting role="php"><![CDATA[<?php
$mail = new Zend_Mail_Storage_Maildir(array('dirname' => '/home/test/mail/'));]]>
        </programlisting>

        <para>Both constructors throw a <code>Zend_Mail_Exception</code> if the storage can't be read.</para>

    </sect2>
    <sect2 id="zend.mail.read-open-remote">
        <title>Opening a remote storage</title>

        <para>
            For remote storages the two most popular protocols are supported: Pop3 and Imap. Both need at least a host
            and a user to connect and login. The default password is an empty string, the default port as given in the
            protocol RFC.
        </para>

        <programlisting role="php"><![CDATA[<?php
// connecting with Pop3
$mail = new Zend_Mail_Storage_Pop3(array('host'     => 'example.com'
                                         'user'     => 'test',
                                         'password' => 'test'));

// connecting with Imap
$mail = new Zend_Mail_Storage_Imap(array('host'     => 'example.com'
                                         'user'     => 'test',
                                         'password' => 'test'));

// example for a none standard port
$mail = new Zend_Mail_Storage_Pop3(array('host'     => 'example.com',
                                         'port'     => 1120
                                         'user'     => 'test',
                                         'password' => 'test'));]]>
        </programlisting>

        <para>
            For both storages SSL and TLS are supported. If you use SSL the default port changes as given in the RFC.
        </para>

        <programlisting role="php"><![CDATA[<?php
// examples for Zend_Mail_Storage_Pop3, same works for Zend_Mail_Storage_Imap

// use SSL on different port (default is 995 for Pop3 and 993 for Imap)
$mail = new Zend_Mail_Storage_Pop3(array('host'     => 'example.com'
                                         'user'     => 'test',
                                         'password' => 'test',
                                         'ssl'      => 'SSL'));

// use TLS
$mail = new Zend_Mail_Storage_Pop3(array('host'     => 'example.com'
                                         'user'     => 'test',
                                         'password' => 'test',
                                         'ssl'      => 'TLS'));]]>
        </programlisting>

        <para>
            Both constructors can throw <code>Zend_Mail_Exception</code> or <code>Zend_Mail_Protocol_Exception</code>
            (extends <code>Zend_Mail_Exception</code>), depending on the type of error.
        </para>

    </sect2>
    <sect2 id="zend.mail.read-fetching">
        <title>Fetching messages and simple methods</title>

        <para>
            Once you've opened the storage messages can be fetched. You need the message number, which is a counter
            starting with 1 for the first message. To fetch the message you use the method <code>getMessage()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
$message = $mail->getMessage($messageNum);]]>
        </programlisting>

        <para>
            Array access is also supported, but won't supported any additional parameters that could be added to
            <code>getMessage()</code>. As long as you don't mind and can live with defaults you may use:
        </para>

        <programlisting role="php"><![CDATA[<?php
$message = $mail[$messageNum];]]>
        </programlisting>

        <para>For iterating over all messages the Iterator interface is implemented:</para>

        <programlisting role="php"><![CDATA[<?php
foreach ($mail as $messageNum => $message) {
    // do stuff ...
}]]>
        </programlisting>

        <para>
            To count the messages in the storage you can either use the method <code>countMessages()</code> or use array
            access:
        </para>

        <programlisting role="php"><![CDATA[<?php
// method
$maxMessage = $mail->countMessages();

// array access
$maxMessage = count($mail);]]>
        </programlisting>

        <para>To remove a mail you use the method <code>removeMessage()</code> or again array access:</para>

        <programlisting role="php"><![CDATA[<?php
// method
$mail->removeMessage($messageNum);

// array access
unset($mail[$messageNum]);]]>
        </programlisting>

    </sect2>
    <sect2 id="zend.mail.read-message">
        <title>Working with messages</title>

        <para>After you fetched the messages with <code>getMessage()</code> you want to fetch headers, the content
        or single parts of a multipart message. All headers can be accessed via properties or the method
        <code>getHeader()</code> if you want more control or have unusual header names. The header names are
        lower-cased internally, thus the case of the header name in the mail message doesn't matter. Also headers
        with a dash can be written in camel-case.</para>

        <programlisting role="php"><![CDATA[<?php
// get the message object
$message = $mail->getMessage(1);

// output subject of message
echo $message->subject . "\n";

// get content-type header
$type = $message->contentType;]]>
        </programlisting>

        <para>If you have multiple headers with the same name i.e. the Received headers you might want it as array
        instead of a string, which is possible with the <code>getHeader()</code> method.</para>

        <programlisting role="php"><![CDATA[<?php
// get header as property - the result is always a string, with new lines between the single occurrences in the message
$received = $message->received;

// the same via getHeader() method
$received = $message->getHeader('received', 'string');

// better an array with a single entry for every occurrences
$received = $message->getHeader('received', 'array');
foreach ($received as $line) {
    // do stuff
}

// if you don't define a format you'll get the internal representation (string for single headers, array for multiple)
$received = $message->getHeader('received');
if (is_string($received)) {
    // only one received header found in message
}]]>
        </programlisting>

        <para>The method <code>getHeaders()</code> returns all headers as array with the lower-cased name as
        key and the value as array for multiple headers or as string for single headers.</para>

        <programlisting role="php"><![CDATA[<?php
// dump all headers
foreach ($message->getHeaders() as $name => $value) {
    if (is_string($value)) {
        echo "$name: $value\n";
        continue;
    }
    foreach ($value as $entry) {
        echo "$name: $entry\n";
    }
}]]>
        </programlisting>

        <para>If you don't have a multipart message fetching the content is easy done via
        <code>getContent()</code>. Unlike the headers the content is only fetched when needed (aka late-fetch).</para>

        <programlisting role="php"><![CDATA[<?php
// output message content for HTML
echo '<pre>';
echo $message->getContent();
echo '</pre>';]]>
        </programlisting>

        <para>Checking for a multipart message is done with the method <code>isMultipart()</code>. If you have
        multipart message you can get an instance of <code>Zend_Mail_Part</code> with the method
        <code>getPart()</code>. <code>Zend_Mail_Part</code> is the base class of <code>Zend_Mail_Message</code>,
        so you have the same methods: <code>getHeader()</code>, <code>getHeaders()</code>, <code>getContent()</code>,
        <code>getPart()</code>, <code>isMultipart</code> and the properties for headers.</para>

        <programlisting role="php"><![CDATA[<?php
// get the first none multipart part
$part = $message;
while ($part->isMultipart()) {
    $part = $message->getPart(1);
}
echo 'Type of this part is ' . strtok($part->contentType, ';') . "\n";
echo "Content:\n";
echo $part->getContent();]]>
        </programlisting>

        <para><code>Zend_Mail_Part</code> also implements <code>RecursiveIterator</code>, which makes it easy to scan through all parts. And
        for easy output it also implements the magic method <code>__toString()</code>, which returns the content.</para>

        <programlisting role="php"><![CDATA[<?php
// output first text/plain part
$foundPart = null;
foreach (new RecursiveIteratorIterator($mail->getMessage(1)) as $part) {
    try {
        if (strtok($part->contentType, ';') == 'text/plain') {
            $foundPart = $part;
            break;
        }
    } catch (Zend_Mail_Exception $e) {
        // ignore
    }
}
if (!$foundPart) {
    echo 'no plain text part found';
} else {
    echo "plain text part: \n" . $foundPart;
}]]>
        </programlisting>

    </sect2>
    <sect2 id="zend.mail.read-flags">
        <title>Checking for flags</title>

        <para>Maildir and IMAP support storing flags. The class <code>Zend_Mail_Storage</code> has constants for all known
        maildir and IMAP system flags, named <code>Zend_Mail_Storage::FLAG_&lt;flagname&gt;</code>. To check
        for flags <code>Zend_Mail_Message</code> has a method called <code>hasFlag()</code>. With
        <code>getFlags()</code> you'll get all set flags.</para>

        <programlisting role="php"><![CDATA[<?php
// find unread messages
echo "Unread mails:\n";
foreach ($mail as $message) {
    if ($message->hasFlag(Zend_Mail_Storage::FLAG_SEEN)) {
        continue;
    }
    // mark recent/new mails
    if ($message->hasFlag(Zend_Mail_Storage::FLAG_RECENT)) {
        echo '! ';
    } else {
        echo '  ';
    }
    echo $message->subject . "\n";
}


// check for known flags
$flags = $message->getFlags();
echo "Message is flagged as: ";
foreach ($flags as $flag) {
    switch ($flag) {
        case Zend_Mail_Storage::FLAG_ANSWERED:
            echo 'Answered ';
            break;
        case Zend_Mail_Storage::FLAG_FLAGGED:
            echo 'Flagged ';
            break;

        // ...
        // check for other flags
        // ...

        default:
            echo $flag . '(unknown flag) ';
    }
}]]>
        </programlisting>

        <para>As IMAP allows user or client defined flags you could get flags, that don't have a constant in
        <code>Zend_Mail_Storage</code>. Instead they are returned as string and can be checked the same way with
        <code>hasFlag()</code>.</para>

        <programlisting role="php"><![CDATA[<?php
// check message for client defined flags $IsSpam, $SpamTested
if (!$message->hasFlag('$SpamTested')) {
    echo 'message has not been tested for spam';
} else if ($message->hasFlag('$IsSpam')) {
    echo 'this message is spam';
} else {
    echo 'this message is ham';
}]]>
        </programlisting>

    </sect2>
    <sect2 id="zend.mail.read-folders">
        <title>Using folders</title>

        <para>
            All storages, except Pop3, support folders, also called mailboxes. The interface implemented by all storages
            supporting folders is called <code>Zend_Mail_Storage_Folder_Interface</code>. Also all of these classes have an
            additional optional parameter called <code>folder</code>, which is the folder selected after login, in the constructor.
        </para>
        <para>
            For the local storages you need to use separate classes called <code>Zend_Mail_Storage_Folder_Mbox</code> or
            <code>Zend_Mail_Storage_Folder_Maildir</code>. Both need one parameter called <code>dirname</code> with the name of the base dir.
            The format for maildir is as defined in maildir++ (with a dot as default delimiter), Mbox is a directory
            hierarchy with Mbox files. If you don't have a Mbox file called INBOX in your Mbox base dir you need to set
            an other folder in the constructor.
        </para>
        <para>
            <code>Zend_Mail_Storage_Imap</code> already supports folders by default. Examples for opening these storages:
        </para>

        <programlisting role="php"><![CDATA[<?php
// mbox with folders
$mail = new Zend_Mail_Storage_Folder_Mbox(array('dirname' => '/home/test/mail/'));

// mbox with a default folder not called INBOX, also works
// with Zend_Mail_Storage_Folder_Maildir and Zend_Mail_Storage_Imap
$mail = new Zend_Mail_Storage_Folder_Mbox(array('dirname' => '/home/test/mail/',
                                                'folder'  => 'Archive'));

// maildir with folders
$mail = new Zend_Mail_Storage_Folder_Maildir(array('dirname' => '/home/test/mail/'));

// maildir with colon as delimiter, as suggested in Maildir++
$mail = new Zend_Mail_Storage_Folder_Maildir(array('dirname' => '/home/test/mail/'
                                                   'delim'   => ':'));

// imap is the same with and without folders
$mail = new Zend_Mail_Storage_Imap(array('host'     => 'example.com'
                                         'user'     => 'test',
                                         'password' => 'test'));]]>
        </programlisting>

        <para>
            With the method getFolders($root = null) you can get the folder hierarchy starting with the root folder or
            the given folder. It's returned as instance of <code>Zend_Mail_Storage_Folder</code>, which implements
            <code>RecursiveIterator</code> and all children are also instances of <code>Zend_Mail_Storage_Folder</code>. Each of
            these instances has a local and a global name returned by the methods <code>getLocalName()</code> and
            <code>getGlobalName()</code>. The global name is the absolute name from the root folder (including
            delimiters), the local name is the name in the parent folder.
        </para>

        <table id="zend.mail.read-folders.table-1">
            <title>Mail Folder Names</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Global Name</entry>
                        <entry>Local Name</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>/INBOX</entry>
                        <entry>INBOX</entry>
                    </row>
                    <row>
                        <entry>/Archive/2005</entry>
                        <entry>2005</entry>
                    </row>
                    <row>
                        <entry>List.ZF.General</entry>
                        <entry>General</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            If you use the iterator the key of the current element is the local name. The global name is also returned
            by the magic method <code>__toString()</code>. Some folders may not be selectable, which means they can't
            store messages and selecting them results in an error. This can be checked with the method
            <code>isSelectable()</code>. So it's very easy to output the whole tree in a view:
        </para>

        <programlisting role="php"><![CDATA[<?php
$folders = new RecursiveIteratorIterator($this->mail->getFolders(),
                                         RecursiveIteratorIterator::SELF_FIRST);
echo '<select name="folder">';
foreach ($folders as $localName => $folder) {
    $localName = str_pad('', $folders->getDepth(), '-', STR_PAD_LEFT) . $localName;
    echo '<option';
    if (!$folder->isSelectable()) {
        echo ' disabled="disabled"';
    }
    echo ' value="' . htmlspecialchars($folder) . '">'
        . htmlspecialchars($localName) . '</option>';
}
echo '</select>';]]>
        </programlisting>

        <para>
            The current selected folders is returned by the method <code>getSelectedFolder()</code>. Changing the folder
            is done with the method <code>selectFolder()</code>, which needs the global name as parameter. If you want
            to avoid to write delimiters you can also use the properties of a <code>Zend_Mail_Storage_Folder</code> instance:
        </para>

        <programlisting role="php"><![CDATA[<?php
// depending on your mail storage and its settings $rootFolder->Archive->2005
// is the same as:
//   /Archive/2005
//  Archive:2005
//  INBOX.Archive.2005
//  ...
$folder = $mail->getFolders()->Archive->2005;
echo 'Last folder was ' . $mail->getSelectedFolder() . "new folder is $folder\n";
$mail->selectFolder($folder);]]>
        </programlisting>

    </sect2>
    <sect2 id="zend.mail.read-advanced">
        <title>Advanced Use</title>

        <sect3 id="zend.mail.read-advanced.noop">
            <title>Using NOOP</title>

            <para>
                If you're using a remote storage and have some long tasks you might need to keep the connection alive
                via noop:
            </para>

            <programlisting role="php"><![CDATA[<?php
foreach ($mail as $message) {

    // do some calculations ...

    $mail->noop(); // keep alive

    // do something else ...

    $mail->noop(); // keep alive
}]]>
            </programlisting>

        </sect3>
        <sect3 id="zend.mail.read-advanced.caching">
            <title>Caching instances</title>

            <para>
            <code>Zend_Mail_Storage_Mbox</code>, <code>Zend_Mail_Storage_Folder_Mbox</code>, <code>Zend_Mail_Storage_Maildir</code> and
            <code>Zend_Mail_Storage_Folder_Maildir</code> implement the magic methods <code>__sleep()</code> and
            <code>__wakeup()</code>, which means they are serializable. This avoids parsing the files or directory tree
            more than once. The disadvantage is that your Mbox or Maildir storage should not change. Some easy checks
            are done, like reparsing the current Mbox file if the modification time changes or reparsing the folder
            structure if a folder has vanished (which still results in an error, but you can search for an other folder
            afterwards). It's better if you have something like a signal file for changes and check it before using the
            cached instance.
            </para>

            <programlisting role="php"><![CDATA[<?php
// there's no specific cache handler/class used here,
// change the code to match your cache handler
$signal_file = '/home/test/.mail.last_change';
$mbox_basedir = '/home/test/mail/';
$cache_id = 'example mail cache ' . $mbox_basedir . $signal_file;

$cache = new Your_Cache_Class();
if (!$cache->isCached($cache_id) || filemtime($signal_file) > $cache->getMTime($cache_id)) {
    $mail = new Zend_Mail_Storage_Folder_Pop3(array('dirname' => $mbox_basedir));
} else {
    $mail = $cache->get($cache_id);
}

// do stuff ...

$cache->set($cache_id, $mail);]]>
            </programlisting>

        </sect3>
        <sect3 id="zend.mail.read-advanced.extending">
            <title>Extending Protocol Classes</title>

            <para>
                Remote storages use two classes: <code>Zend_Mail_Storage_&lt;Name&gt;</code> and
                <code>Zend_Mail_Protocol_&lt;Name&gt;</code>. The protocol class translates the protocol commands and
                responses from and to PHP, like methods for the commands or variables with different structures for
                data. The other/main class implements the common interface.
            </para>

            <para>
                If you need additional protocol features you can extend the protocol class and use it in the
                constructor of the main class. As an example assume we need to knock different ports before we can
                connect to POP3.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
Zend_Loader::loadClass('Zend_Mail_Storage_Pop3');

class Example_Mail_Exception extends Zend_Mail_Exception
{
}

class Example_Mail_Protocol_Exception extends Zend_Mail_Protocol_Exception
{
}

class Example_Mail_Protocol_Pop3_Knock extends Zend_Mail_Protocol_Pop3
{
    private $host, $port;

    public function __construct($host, $port = null)
    {
        // no auto connect in this class
        $this->host = $host;
        $this->port = $port;
    }

    public function knock($port)
    {
        $sock = @fsockopen($this->host, $port);
        if ($sock) {
            fclose($sock);
        }
    }

    public function connect($host = null, $port = null, $ssl = false)
    {
        if ($host === null) {
            $host = $this->host;
        }
        if ($port === null) {
            $port = $this->port;
        }
        parent::connect($host, $port);
    }
}

class Example_Mail_Pop3_Knock extends Zend_Mail_Storage_Pop3
{
    public function __construct(array $params)
    {
        // ... check $params here! ...
        $protocol = new Example_Mail_Protocol_Pop3_Knock($params['host']);

        // do our "special" thing
        foreach ((array)$params['knock_ports'] as $port) {
            $protocol->knock($port);
        }

        // get to correct state
        $protocol->connect($params['host'], $params['port']);
        $protocol->login($params['user'], $params['password']);

        // initialize parent
        parent::__construct($protocol);
    }
}

$mail = new Example_Mail_Pop3_Knock(array('host'        => 'localhost',
                                          'user'        => 'test',
                                          'password'    => 'test',
                                          'knock_ports' => array(1101, 1105, 1111)));]]>
            </programlisting>

            <para>
                As you see we always assume we're connected, logged in and, if supported, a folder is selected in the
                constructor of the main class. Thus if you assign your own protocol class you always need to make sure
                that's done or the next method will fail if the server doesn't allow it in the current state.
            </para>

        </sect3>
        <sect3 id="zend.mail.read-advanced.quota">
            <title>Using Quota (since 1.5)</title>

            <para>
            <code>Zend_Mail_Storage_Writable_Maildir</code> has support for Maildir++ quotas. It's disabled by default,
            but it's possible to use it manually, if the automatic checks are not desired (this means 
            <code>appendMessage()</code>, <code>removeMessage()</code> and <code>copyMessage()</code> do no checks
            and do not add entry to the maildirsize file). If enabled an exception is thrown if you try to write
            to the maildir if it's already over quota.
            </para>
            
            <para>
            There are three methods used for quotas: <code>getQuota()</code>, <code>setQuota()</code> and 
            <code>checkQuota()</code>:
            </para>

            <programlisting role="php"><![CDATA[<?php
$mail = new Zend_Mail_Storage_Writable_Maildir(array('dirname' => '/home/test/mail/'));
$mail->setQuota(true); // true to enable, false to disable
echo 'Quota check is now ', $mail->getQuota() ? 'enabled' : 'disabled', "\n";
// check quota can be used even if quota checks are disabled
echo 'You are ', $mail->checkQuota() ? 'over quota' : 'not over quota', "\n";]]>
            </programlisting>
            
            <para>
            <code>checkQuota()</code> can also return a more detailed response:
            </para>

            <programlisting role="php"><![CDATA[<?php
$quota = $mail->checkQuota(true);
echo 'You are ', $quota['over_quota'] ? 'over quota' : 'not over quota', "\n";
echo 'You have ', $quota['count'], ' of ', $quota['quota']['count'], ' messages and use ';
echo $quota['size'], ' of ', $quota['quota']['size'], ' octets';]]>
            </programlisting>
            
            <para>
            If you want to specify your own quota instead of using the one specified in the maildirsize file you
            can do with <code>setQuota()</code>:
            </para>
            
            <programlisting role="php"><![CDATA[<?php
// message count and octet size supported, order does matter
$quota = $mail->setQuota(array('size' => 10000, 'count' => 100));]]>
            </programlisting>
            
            <para>
            To add your own quota checks use single letters as key and they are preserved (but obviously not checked).
            It's also possible to extend  <code>Zend_Mail_Storage_Writable_Maildir</code> to define your own quota only
            if the maildirsize file is missing (which can happen in Maildir++):
            </para>

            <programlisting role="php"><![CDATA[<?php
class Example_Mail_Storage_Maildir extends Zend_Mail_Storage_Writable_Maildir {
	// getQuota is called with $fromStorage = true by quota checks
	public function getQuota($fromStorage = false) {
		try {
			return parent::getQuota($fromStorage);
		} catch (Zend_Mail_Storage_Exception $e) {
			if (!$fromStorage) {
				// unknown error:
				throw $e;
			}
			// maildirsize file must be missing
			
			list($count, $size) = get_quota_from_somewhere_else();
			return array('count' => $count, 'size' => $size);
		}
	}
}]]>
            </programlisting>


        </sect3>
    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.measure.creation">

    <title>Creation of Measurements</title>

    <para>
        When creating a measurement object, <code>Zend_Measure_*</code> methods expect the input/original measurement
        data value as the first parameter. This can be a
        <link linkend="zend.measure.creation.number"><code>numeric argument</code>
        </link>
        , a
        <link linkend="zend.measure.creation.string"><code>string</code>
        </link>
        without units, or a
        <link linkend="zend.measure.creation.localized"><code>localized string</code> with unit(s) specified.
        </link>
        The second parameter defines the type of the measurement. Both parameters are mandatory. The language may
        optionally be specified as the third parameter.
    </para>

    <sect2 id="zend.measure.creation.number">

        <title>Creating measurements from integers and floats</title>

        <para>
            In addition to integer data values, floating point types may be used, but
            <ulink url="http://www.php.net/float">"simple decimal fractions like 0.1 or 0.7 cannot be converted into their internal binary counterparts without a little loss of precision,"</ulink>
            sometimes giving surprising results. Also, do not compare two "float" type numbers for equality.
        </para>

        <example id="zend.measure.creation.number.example-1">
            <title>Creation using integer and floating values</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$measurement = 1234.7;
$unit = new Zend_Measure_Length((integer)$measurement, Zend_Measure_Length::STANDARD);
echo $unit;
// outputs '1234 m' (meters)

$unit = new Zend_Measure_Length($measurement, Zend_Measure_Length::STANDARD);
echo $unit;
// outputs '1234.7 m' (meters)]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.measure.creation.string">

        <title>Creating measurements from strings</title>

        <para>
            Many measurements received as input to ZF applications can only be passed to <code>Zend_Measure_*</code>
            classes as strings, such as numbers written using
            <ulink url="http://en.wikipedia.org/wiki/Roman_numerals">roman numerals</ulink>
            or extremely large binary values that exceed the precision of PHP's native integer and float types. Since
            integers can be denoted using strings, if there is any risk of losing precision due to limitations of PHP's
            native integer and float types, using strings instead. <code>Zend_Measure_Number</code> uses the BCMath
            extension to support arbitrary precision, as shown in the example below, to avoid limitations in many PHP
            functions, such as
            <ulink url="http://php.net/bin2dec"><code>bin2dec()</code>
            </ulink>
            .
        </para>

        <example id="zend.measure.creation.string.example-1">
            <title>Creation using strings</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Number.php';

$mystring = "10010100111010111010100001011011101010001";
$unit = new Zend_Measure_Number($mystring, Zend_Measure_Number::BINARY);

echo $unit;]]>
            </programlisting>
        </example>

        <para>
            Usually, <code>Zend_Measure_*</code> can automatically extract the desired measurement embedded in an
            arbitrary string. Only the first identifiable number denoted using standard European/Latin digits
            (0,1,2,3,4,5,6,7,8,9) will be used for measurement creation. If there are more numerals later in the string,
            the rest of these numerals will be ignored.
        </para>

        <example id="zend.measure.creation.string.example-2">
            <title>Arbitrary text input containing measurements</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Area.php';

$mystring = "My house is 125m² in size";
$unit = new Zend_Measure_Area($mystring, Zend_Measure_Area::STANDARD);
echo $unit; // outputs "125 m²in size";

$mystring = "My house is 125m² in size, it has 5 rooms of 25m² each.";
$unit = new Zend_Measure_Area($mystring, Zend_Measure_Area::STANDARD);
echo $unit; // outputs "125 m² in size";]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.measure.creation.localized">

        <title>Measurements from localized strings</title>

        <para>
            When a string is entered in a localized notation, the correct interpretation can not be determined without
            knowing the intended locale. The division of decimal digits with "." and grouping of thousands with "," is
            common in the English language, but not so in other languages. For example, the English number "1,234.50"
            would be interpreted as meaning "1.2345" in German. To deal with such problems, the locale-aware
            <code>Zend_Measure_*</code> family of classes offer the possibility to specify a language or region to
            disambiguate the input data and properly interpret the intended semantic value.
        </para>

        <example id="zend.measure.creation.localized.example-1">
            <title>Localized string</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$locale = new Zend_Locale('de');
$mystring = "The boat is 1,234.50 long.";
$unit = new Zend_Measure_Length($mystring, Zend_Measure_Length::STANDARD, $locale);
echo $unit; // outputs "1.234 m"


$mystring = "The boat is 1,234.50 long.";
$unit = new Zend_Measure_Length($mystring, Zend_Measure_Length::STANDARD, 'en_US');
echo $unit; // outputs "1234.50 m"]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.measure.edit">

    <title>Manipulating Measurements</title>

    <para>
        Parsing and normalization of input, combined with output to localized notations makes data accessible to users
        in different locales. Many additional methods exist in <code>Zend_Measure_*</code> components to manipulate and
        work with this data, after it has been normalized.
    </para>

    <itemizedlist>
        <listitem>
            <para>
                <link linkend="zend.measure.edit.convert"><code>Convert</code>
                </link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.measure.edit.add"><code>Add and subtract</code>
                </link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.measure.edit.equal"><code>Compare to boolean</code>
                </link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.measure.edit.compare"><code>Compare to greater/smaller</code>
                </link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.measure.edit.changevalue"><code>Manually change values</code>
                </link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.measure.edit.changetype"><code>Manually change types</code>
                </link>
            </para>
        </listitem>
    </itemizedlist>

    <sect2 id="zend.measure.edit.convert">

        <title>Convert</title>

        <para>
            Probably the most important feature is the conversion into different units of measurement. The conversion of
            a unit can be done any number of times using the method <code>convertTo()</code>. Units of measurement can
            only be converted to other units of the same type (class). Therefore, it is not possible to convert (e.g.) a
            length into a weight, which would might encourage poor programming practices and allow errors to propagate
            without exceptions.
        </para>

        <para>
            The <code>convertTo</code> method accepts an optional parameter. With this parameter you can define
            an precision for the returned output. The standard precision is '<code>2</code>'.
        </para>

        <example id="zend.measure.edit.convert.example-1">
            <title>Convert</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Weight.php';

$locale = new Zend_Locale('de');
$mystring = "1.234.567,89";
$unit = new Zend_Measure_Weight($mystring,'POND', $locale);

print "Kilo:".$unit->convertTo('KILOGRAM');

// constants are considered "better practice" than strings
print "Ton:".$unit->convertTo(Zend_Measure_Weight::TON);

// define a precision for the output
print "Ton:".$unit->convertTo(Zend_Measure_Weight::TON, 3);]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.measure.edit.add">

        <title>Add and subtract</title>

        <para>
            Measurements can be added together using <code>add()</code> and subtracted using <code>sub()</code>. Each
            addition will create a new object for the result. The actual object will never be changed by the class. The
            new object will be of the same type as the originating object. Dynamic objects support a fluid style of
            programming, where complex sequences of operations can be nested without risk of side-effects altering the
            input objects.
        </para>

        <para>
            <example id="zend.measure.edit.add.example-1">
                <title>Adding units</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

// Define objects
$unit = new Zend_Measure_Length(200, Zend_Measure_Length::CENTIMETER);
$unit2 = new Zend_Measure_Length(1, Zend_Measure_Length::METER);

// Add $unit2 to $unit
$sum = $unit->add($unit2);

echo $sum; // outputs "300 cm"]]>
                </programlisting>
            </example>
        </para>

        <note>
            <title>Automatic conversion</title>
            <para>
                Adding one object to another will automatically convert it to the correct unit. It is not neccessary to
                call
                <link linkend="zend.measure.edit.convert"><code>convertTo()</code>
                </link>
                before adding different units.
            </para>
        </note>

        <para>
            <example id="zend.measure.edit.add.example-2">
                <title>Subtract</title>
                <para>
                    Subtraction of measurements works just like addition.
                </para>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

// Define objects
$unit = new Zend_Measure_Length(200, Zend_Measure_Length::CENTIMETER);
$unit2 = new Zend_Measure_Length(1, Zend_Measure_Length::METER);

// Subtract $unit2 from $unit
$sum = $unit->sub($unit2);

echo $sum;]]>
                </programlisting>
            </example>
        </para>

    </sect2>

    <sect2 id="zend.measure.edit.equal">

        <title>Compare</title>

        <para>
            Measurements can also be compared, but without automatic unit conversion. Thus, <code>equals()</code>
            returns <code>TRUE</code>, only if both the value and the unit of measure are identical.
        </para>

        <para>
            <example id="zend.measure.edit.equal.example-1">
                <title>Different measurements</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

// Define measurements
$unit = new Zend_Measure_Length(100, Zend_Measure_Length::CENTIMETER);
$unit2 = new Zend_Measure_Length(1, Zend_Measure_Length::METER);

if ($unit->equals($unit2)) {
    print "Both measurements are identical";
} else {
    print "These are different measurements";
}]]>
                </programlisting>
            </example>
            <example id="zend.measure.edit.equal.example-2">
                <title>Identical measurements</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

// Define measurements
$unit = new Zend_Measure_Length(100, Zend_Measure_Length::CENTIMETER);
$unit2 = new Zend_Measure_Length(1, Zend_Measure_Length::METER);

$unit2->setType(Zend_Measure_Length::CENTIMETER);

if ($unit->equals($unit2)) {
    print "Both measurements are identical";
} else {
    print "These are different measurements";
}]]>
                </programlisting>
            </example>
        </para>

    </sect2>

    <sect2 id="zend.measure.edit.compare">

        <title>Compare</title>

        <para>
            To determine if a measurement is less than or greater than another, use <code>compare()</code>, which
            returns 0, -1 or 1 depending on the difference between the two objects. Identical measurements will return
            0. Lesser ones will return a negative, greater ones a positive value.
        </para>

        <para>
            <example id="zend.measure.edit.compare.example-1">
                <title>Difference</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$unit = new Zend_Measure_Length(100, Zend_Measure_Length::CENTIMETER);
$unit2 = new Zend_Measure_Length(1, Zend_Measure_Length::METER);
$unit3 = new Zend_Measure_Length(1.2, Zend_Measure_Length::METER);

print "Equal:".$unit2->compare($unit);
print "Lesser:".$unit2->compare($unit3);
print "Greater:".$unit3->compare($unit2);]]>
                </programlisting>
            </example>
        </para>

    </sect2>

    <sect2 id="zend.measure.edit.changevalue">

        <title>Manually change values</title>

        <para>
            To change the value of a measurement explicitly, use <code>setValue()</code>. to overwrite the current
            value. The parameters are the same as the constructor.
        </para>

        <para>
            <example id="zend.measure.edit.changevalue.example-1">
                <title>Changing a value</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$locale = new Zend_Locale('de_AT');
$unit = new Zend_Measure_Length(1,Zend_Measure_Length::METER);

$unit->setValue(1.2);
echo $unit;

$unit->setValue(1.2, Zend_Measure_Length::KILOMETER);
echo $unit;

$unit->setValue("1.234,56", Zend_Measure_Length::MILLIMETER,$locale);
echo $unit;]]>
                </programlisting>
            </example>
        </para>

    </sect2>

    <sect2 id="zend.measure.edit.changetype">

        <title>Manually change types</title>

        <para>
            To change the type of a measurement without altering its value use <code>setType()</code>.
        </para>

        <example id="zend.measure.edit.changetype.example-1">
            <title>Changing the type</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$unit = new Zend_Measure_Length(1,Zend_Measure_Length::METER);
echo $unit; // outputs "1 m"

$unit->setType(Zend_Measure_Length::KILOMETER);
echo $unit; // outputs "1000 km"]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.measure.introduction">

    <title>Introduction</title>

    <para>
        <code>Zend_Measure_*</code> classes provide a generic and easy way for working with measurements. Using
        <code>Zend_Measure_*</code> classes, you can convert measurements into different units of the same type. They
        can be added, subtracted and compared against each other. From a given input made in the user's native language,
        the unit of measurement can be automatically extracted. Numerous units of measurement are supported.
    </para>

    <example id="zend.measure.introduction.example-1">
        <title>Converting measurements</title>
        <para>
            The following introductory example shows automatic conversion of units of measurement. To convert a
            measurement, its value and its type have to be known. The value can be an integer, a float, or even a string
            containing a number. Conversions are only possible for units of the same type (mass, area, temperature,
            velocity, etc.), not between types.
        </para>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$locale = new Zend_Locale('en');
$unit = new Zend_Measure_Length(100, Zend_Measure_Length::METER, $locale);

// Convert meters to yards
echo $unit->convertTo(Zend_Measure_Length::YARD);]]>
        </programlisting>
    </example>

    <para>
        <code>Zend_Measure_*</code> includes support for many different units of measurement. The units of measurement
        all have a unified notation: <code>Zend_Measure_&lt;TYPE&gt;::NAME_OF_UNIT</code>, where &lt;TYPE&gt;
        corresponds to a well-known physical or numerical property. . Every unit of measurement consists of a conversion
        factor and a display unit. A detailed list can be found in the chapter
        <link linkend="zend.measure.types"><code>Types of measurements</code>
        </link>
        .
    </para>

    <example id="zend.measure.introduction.example-2">
        <title>The <code>meter</code> measurement</title>
        <para>
            The <code>meter</code> is used for measuring lengths, so its type constant can be found in the
            <code>Length</code> class. To refer to this unit of measurement, the notation <code>Length::METER</code>
            must be used. The display unit is <code>m</code>.
        </para>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

echo Zend_Measure_Length::STANDARD;  // outputs 'Length::METER'
echo Zend_Measure_Length::KILOMETER; // outputs 'Length::KILOMETER'

$unit = new Zend_Measure_Length(100,'METER');
echo $unit;
// outputs '100 m']]>
        </programlisting>
    </example>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.measure.output">

    <title>Outputting measurements</title>

    <para>
        Measurements can be output in a number of different ways.
    </para>

    <para>
        <link linkend="zend.measure.output.auto"><code>Automatic output</code>
        </link>
    </para>

    <para>
        <link linkend="zend.measure.output.value"><code>Outputting values</code>
        </link>
    </para>

    <para>
        <link linkend="zend.measure.output.unit"><code>Output with unit of measurement</code>
        </link>
    </para>

    <para>
        <link linkend="zend.measure.output.unit"><code>Output as localized string</code>
        </link>
    </para>

    <sect2 id="zend.measure.output.auto">

        <title>Automatic output</title>

        <para>
            <code>Zend_Measure</code> supports outputting of strings automatically.
            <example id="zend.measure.output.auto.example-1">
                <title>Automatic output</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$locale = new Zend_Locale('de');
$mystring = "1.234.567,89 Meter";
$unit = new Zend_Measure_Length($mystring,Zend_Measure_Length::STANDARD, $locale);

echo $unit;]]>
                </programlisting>
            </example>
        </para>

        <note>
            <title>Measurement output</title>
            <para>
                Output can be achieved simply by using
                <ulink url="http://php.net/echo"><code>echo</code>
                </ulink>
                or
                <ulink url="http://php.net/print"><code>print</code>
                </ulink>
                .
            </para>
        </note>

    </sect2>

    <sect2 id="zend.measure.output.value">

        <title>Outputting values</title>

        <para>
            The value of a measurement can be output using <code>getValue()</code>.
            <example id="zend.measure.output.value.example-1">
                <title>Output a value</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Length.php';

$locale = new Zend_Locale('de');
$mystring = "1.234.567,89 Meter";
$unit = new Zend_Measure_Length($mystring,Zend_Measure_Length::STANDARD, $locale);

echo $unit->getValue();]]>
                </programlisting>
            </example>
        </para>

        <para>
            The <code>getValue()</code> method accepts an optional parameter '<code>round</code>' which allows to
            define a precision for the generated output. The standard precision is '<code>2</code>'.
        </para>
    </sect2>

    <sect2 id="zend.measure.output.unit">

        <title>Output with unit of measurement</title>

        <para>
            The function <code>getType()</code> returns the current unit of measurement.
            <example id="zend.measure.output.unit.example-1">
                <title>Outputting units</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Weight.php';

$locale = new Zend_Locale('de');
$mystring = "1.234.567,89";
$unit = new Zend_Measure_Weight($mystring,Zend_Measure_Weight::POUND, $locale);

echo $unit->getType();]]>
                </programlisting>
            </example>
        </para>

    </sect2>

    <sect2 id="zend.measure.output.localized">

        <title>Output as localized string</title>

        <para>
            Outputtig a string in a format common in the users' country is usually desirable. For example, the
            measurement "1234567.8" would become "1.234.567,8" for Germany. This functionality will be supported in a
            future release.
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.measure.types">

    <title>Types of measurements</title>

    <para>
        All supported measurement types are listed below, each with an example of the standard usage for such
        measurements.
    </para>

    <table id="zend.measure.types.table-1">
        <title>List of measurement types</title>
        <tgroup cols="4">
            <thead>
                <row>
                    <entry>Typ</entry>
                    <entry>Class</entry>
                    <entry>Standardunit</entry>
                    <entry>Description</entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>Acceleration</entry>
                    <entry>Zend_Measure_Acceleration</entry>
                    <entry>Meter per square second | <code>m/s²</code>
                    </entry>
                    <entry><code>Zend_Measure_Acceleration</code> covers the
                            physical factor of acceleration.
                        </entry>
                </row>
                <row>
                    <entry>Angle</entry>
                    <entry>Zend_Measure_Angle</entry>
                    <entry>Radiant | <code>rad</code>
                    </entry>
                    <entry><code>Zend_Measure_Angle</code> covers angular dimensions.</entry>
                </row>
                <row>
                    <entry>Area</entry>
                    <entry>Zend_Measure_Area</entry>
                    <entry>Square meter | <code>m²</code>
                    </entry>
                    <entry><code>Zend_Measure_Area</code> covers square measures.</entry>
                </row>
                <row>
                    <entry>Binary</entry>
                    <entry>Zend_Measure_Binary</entry>
                    <entry>Byte | <code>b</code>
                    </entry>
                    <entry><code>Zend_Measure_Binary</code> covers binary convertions.</entry>
                </row>
                <row>
                    <entry>Capacitance</entry>
                    <entry>Zend_Measure_Capacitance</entry>
                    <entry>Farad | <code>F</code>
                    </entry>
                    <entry><code>Zend_Measure_Capacitance</code> covers physical factor of capacitance.
                        </entry>
                </row>
                <row>
                    <entry>Cooking volumes</entry>
                    <entry>Zend_Measure_Cooking_Volume</entry>
                    <entry>Cubic meter | <code>m³</code>
                    </entry>
                    <entry><code>Zend_Measure_Cooking_Volume</code> covers volumes
                            which are used for cooking or written in cookbooks.
                        </entry>
                </row>
                <row>
                    <entry>Cooking weights</entry>
                    <entry>Zend_Measure_Cooking_Weight</entry>
                    <entry>Gram | <code>g</code>
                    </entry>
                    <entry><code>Zend_Measure_Cooking_Weight</code> covers the weights
                            which are used for cooking or written in cookbooks.
                        </entry>
                </row>
                <row>
                    <entry>Current</entry>
                    <entry>Zend_Measure_Current</entry>
                    <entry>Ampere | <code>A</code>
                    </entry>
                    <entry><code>Zend_Measure_Current</code> covers the physical factor of current.
                        </entry>
                </row>
                <row>
                    <entry>Density</entry>
                    <entry>Zend_Measure_Density</entry>
                    <entry>Kilogram per cubic meter | <code>kg/m³</code>
                    </entry>
                    <entry><code>Zend_Measure_Density</code> covers the physical factor of density.
                        </entry>
                </row>
                <row>
                    <entry>Energy</entry>
                    <entry>Zend_Measure_Energy</entry>
                    <entry>Joule | <code>J</code>
                    </entry>
                    <entry><code>Zend_Measure_Energy</code> covers the physical factor of energy.
                        </entry>
                </row>
                <row>
                    <entry>Force</entry>
                    <entry>Zend_Measure_Force</entry>
                    <entry>Newton | <code>N</code>
                    </entry>
                    <entry><code>Zend_Measure_Force</code> covers the physical factor of force.
                        </entry>
                </row>
                <row>
                    <entry>Flow (mass)</entry>
                    <entry>Zend_Measure_Flow_Mass</entry>
                    <entry>Kilogram per second | <code>kg/s</code>
                    </entry>
                    <entry><code>Zend_Measure_Flow_Mass</code> covers the physical factor of flow rate.
                            The weight of the flowing mass is used as reference point within this class.
                        </entry>
                </row>
                <row>
                    <entry>Flow (mole)</entry>
                    <entry>Zend_Measure_Flow_Mole</entry>
                    <entry>Mole per second | <code>mol/s</code>
                    </entry>
                    <entry><code>Zend_Measure_Flow_Mole</code> covers the physical factor of flow rate.
                            The density of the flowing mass is used as reference point within this class.
                        </entry>
                </row>
                <row>
                    <entry>Flow (volume)</entry>
                    <entry>Zend_Measure_Flow_Volume</entry>
                    <entry>Cubic meter per second | <code>m³/s</code>
                    </entry>
                    <entry><code>Zend_Measure_Flow_Volume</code> covers the physical factor of flow rate.
                            The volume of the flowing mass is used as reference point within this class.
                        </entry>
                </row>
                <row>
                    <entry>Frequency</entry>
                    <entry>Zend_Measure_Frequency</entry>
                    <entry>Hertz | <code>Hz</code>
                    </entry>
                    <entry><code>Zend_Measure_Frequency</code> covers the physical factor of frequency.
                        </entry>
                </row>
                <row>
                    <entry>Illumination</entry>
                    <entry>Zend_Measure_Illumination</entry>
                    <entry>Lux | <code>lx</code>
                    </entry>
                    <entry><code>Zend_Measure_Illumination</code> covers the physical factor of light density.
                        </entry>
                </row>
                <row>
                    <entry>Length</entry>
                    <entry>Zend_Measure_Length</entry>
                    <entry>Meter | <code>m</code>
                    </entry>
                    <entry><code>Zend_Measure_Length</code> covers the physical factor of length.
                        </entry>
                </row>
                <row>
                    <entry>Lightness</entry>
                    <entry>Zend_Measure_Lightness</entry>
                    <entry>Candela per square meter | <code>cd/m²</code>
                    </entry>
                    <entry><code>Zend_Measure_Ligntness</code> covers the physical factor of light energy.
                        </entry>
                </row>
                <row>
                    <entry>Number</entry>
                    <entry>Zend_Measure_Number</entry>
                    <entry>Decimal | <code>(10)</code>
                    </entry>
                    <entry><code>Zend_Measure_Number</code> converts between number formats.
                        </entry>
                </row>
                <row>
                    <entry>Power</entry>
                    <entry>Zend_Measure_Power</entry>
                    <entry>Watt | <code>W</code>
                    </entry>
                    <entry><code>Zend_Measure_Power</code> covers the physical factor of power.
                        </entry>
                </row>
                <row>
                    <entry>Pressure</entry>
                    <entry>Zend_Measure_Pressure</entry>
                    <entry>Newton per square meter | <code>N/m²</code>
                    </entry>
                    <entry><code>Zend_Measure_Pressure</code> covers the physical factor of pressure.
                        </entry>
                </row>
                <row>
                    <entry>Speed</entry>
                    <entry>Zend_Measure_Speed</entry>
                    <entry>Meter per second | <code>m/s</code>
                    </entry>
                    <entry><code>Zend_Measure_Speed</code> covers the physical factor of speed.
                        </entry>
                </row>
                <row>
                    <entry>Temperature</entry>
                    <entry>Zend_Measure_Temperature</entry>
                    <entry>Kelvin | <code>K</code>
                    </entry>
                    <entry><code>Zend_Measure_Temperature</code> covers the physical factor of temperature.
                        </entry>
                </row>
                <row>
                    <entry>Torque</entry>
                    <entry>Zend_Measure_Torque</entry>
                    <entry>Newton meter | <code>Nm</code>
                    </entry>
                    <entry><code>Zend_Measure_Torque</code> covers the physical factor of torque.
                        </entry>
                </row>
                <row>
                    <entry>Viscosity (dynamic)</entry>
                    <entry>Zend_Measure_Viscosity_Dynamic</entry>
                    <entry>Kilogram per meter second | <code>kg/ms</code>
                    </entry>
                    <entry><code>Zend_Measure_Viscosity_Dynamic</code> covers the physical factor of viscosity.
                            The weight of the fluid is used as reference point within this class.
                        </entry>
                </row>
                <row>
                    <entry>Viscosity (kinematic)</entry>
                    <entry>Zend_Measure_Viscosity_Kinematic</entry>
                    <entry>Square meter per second | <code>m²/s</code>
                    </entry>
                    <entry><code>Zend_Measure_Viscosity_Kinematic</code> covers the physical factor of viscosity.
                            The distance of the flown fluid is used as reference point within this class.
                        </entry>
                </row>
                <row>
                    <entry>Volume</entry>
                    <entry>Zend_Measure_Volume</entry>
                    <entry>Cubic meter | <code>m³</code>
                    </entry>
                    <entry><code>Zend_Measure_Volume</code> covers the physical factor of volume (content).
                        </entry>
                </row>
                <row>
                    <entry>Weight</entry>
                    <entry>Zend_Measure_Weight</entry>
                    <entry>Kilogram | <code>kg</code>
                    </entry>
                    <entry><code>Zend_Measure_Weight</code> covers the physical factor of weight.
                        </entry>
                </row>
            </tbody>
        </tgroup>
    </table>

    <sect2 id="zend.measure.types.binary">

        <title>Hints for Zend_Measure_Binary</title>

        <para>
            Some popular binary conventions, include terms like kilo-, mega-, giga, etc. in normal language use imply
            base 10, such as 1000 or 10³. However, in the binary format for computers these terms have to be seen for a
            convertion factor of 1024 instead of 1000. To preclude confusions a few years ago the notation BI was
            introduced. Instead of kilobyte, kibibyte for kilo-binary-byte should be used.
        </para>

        <para>
            In the class BINARY both notations can be found, such as <code>KILOBYTE = 1024 - binary conputer conversion
            KIBIBYTE = 1024 - new notation KILO_BINARY_BYTE = 1024 - new</code>, or the notation, long format
            <code>KILOBYTE_SI = 1000 - SI notation for kilo (1000)</code>. DVDs for example are marked with the
            SI-notation, but almost all harddisks are marked in computer binary notation.
        </para>

    </sect2>

    <sect2 id="zend.measure.types.decimal">

        <title>Hints for Zend_Measure_Number</title>

        <para>
            The best known number format is the decimal system. Additionaly this class supports the octal system, the
            hexadecimal system, the binary system, the roman number system and some other less popular systems. Note
            that only the decimal part of numbers is handled. Any fractional part will be stripped.
        </para>

    </sect2>

    <sect2 id="zend.measure.types.roman">

        <title>Roman numbers</title>

        <para>
            For the roman numbersystem digits greater 4000 are supported. In reality these digits are shown with a
            crossbeam on top of the digit. As the crossbeam can not be shown within the computer, an underline has to be
            used instead of it.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Measure/Number.php';

$great = '_X';
$locale = new Zend_Locale('en');
$unit = new Zend_Measure_Number($great,Zend_Measure_Number::ROMAN, $locale);

// convert to the decimal system
echo $unit->convertTo(Zend_Measure_Number::DECIMAL);]]>
        </programlisting>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.memory.memory-manager">
    <title>Memory Manager</title>

    <sect2 id="zend.memory.memory-manager.creation">

        <title>Creating a Memory Manager</title>

        <para>
            You can create new a memory manager
            (<code>Zend_Memory_Manager</code> object) using the
            <code>Zend_Memory::factory($backendName [, $backendOprions])</code>
            method.
        </para>

        <para>
            The first argument <code>$backendName</code> is a string that
            names one of the backend implementations supported by Zend_Cache.
        </para>

        <para>
            The second argument <code>$backendOptions</code> is an optional
            backend options array.
        </para>

        <programlisting role="php"><![CDATA[<?php
$backendOptions = array(
    'cache_dir' => './tmp/' // Directory where to put the swapped memory blocks
);

$memoryManager = Zend_Memory::factory('File', $backendOptions);]]>
        </programlisting>

        <para>
            Zend_Memory uses <link linkend="zend.cache.backends">Zend_Cache backends</link>
            as storage providers.
        </para>

        <para>
            You may use the special name '<code>None</code>' as a backend name,
            in addition to standard Zend_Cache backends.

            <programlisting role="php"><![CDATA[<?php
$memoryManager = Zend_Memory::factory('None');]]>
            </programlisting>
        </para>

        <para>
            If you use '<code>None</code>' as the backend name, then the memory
            manager never swaps memory blocks.  This is useful if you know that
            memory is not limited or the overall size of objects never reaches
            the memory limit.
        </para>

        <para>
            The '<code>None</code>' backend doesn't need any option specified.
        </para>

    </sect2>

    <sect2 id="zend.memory.memory-manager.objects-management">

        <title>Managing Memory Objects</title>

        <para>
            This section describes creating and destroying objects in the
            managed memory, and settings to control memory manager behavior.
        </para>

        <sect3 id="zend.memory.memory-manager.objects-management.movable">

            <title>Creating Movable Objects</title>

            <para>
                Create movable objects (objects, which may be swapped) using
                the <code>Zend_Memory_Manager::create([$data])</code> method:
                <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->create($data);]]>
                </programlisting>

            </para>

            <para>
                The <code>$data</code> argument is optional and used to
                initialize the object value.  If the <code>$data</code>
                argument is omitted, the value is an empty string.
            </para>

        </sect3>

        <sect3 id="zend.memory.memory-manager.objects-management.locked">

            <title>Creating Locked Objects</title>

            <para>
                Create locked objects (objects, which are not swapped) using
                the <code>Zend_Memory_Manager::createLocked([$data])</code> method:
                <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->createLocked($data);]]>
                </programlisting>
            </para>

            <para>
                The <code>$data</code> argument is optional and used to
                initialize the object value.  If the <code>$data</code>
                argument is omitted, the value is an empty string.
            </para>

        </sect3>

        <sect3 id="zend.memory.memory-manager.objects-management.destruction">

            <title>Destroying Objects</title>

            <para>
                Memory objects are automatically destroyed and removed from
                memory when they go out of scope:

                <programlisting role="php"><![CDATA[<?php
function foo()
{
    global $memoryManager, $memList;

    ...

    $memObject1 = $memoryManager->create($data1);
    $memObject2 = $memoryManager->create($data2);
    $memObject3 = $memoryManager->create($data3);

    ...

    $memList[] = $memObject3;

    ...

    unset($memObject2); // $memObject2 is destroyed here

    ...
    // $memObject1 is destroyed here
    // but $memObject2 object is still referenced by $memList and is not destroyed
}]]>
                </programlisting>
            </para>

            <para>
                This applies to both movable and locked objects.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.memory.memory-manager.settings">

        <title>Memory Manager Settings</title>

        <sect3 id="zend.memory.memory-manager.settings.memory-limit">

            <title>Memory Limit</title>

            <para>
                Memory limit is a number of bytes allowed to be used by loaded
                movable objects.
            </para>

            <para>
                If loading or creation of an object causes memory usage to
                exceed of this limit, then the memory manager swaps some other
                objects.
            </para>

            <para>
                You can retrieve or set the memory limit setting using the
                <code>getMemoryLimit()</code> and <code>setMemoryLimit($newLimit)</code>
                methods:
                <programlisting role="php"><![CDATA[<?php
$oldLimit = $memoryManager->getMemoryLimit();  // Get memory limit in bytes
$memoryManager->setMemoryLimit($newLimit);     // Set memory limit in bytes]]>
                </programlisting>
            </para>

            <para>
                A negative value for memory limit means 'no limit'.
            </para>

            <para>
                The default vaule is two-thirds of the value of
                '<code>memory_limit</code>' in php.ini or 'no limit' (-1)
                if '<code>memory_limit</code>' is not set in php.ini.
            </para>

        </sect3>

        <sect3 id="zend.memory.memory-manager.settings.min-size">

            <title>MinSize</title>

            <para>
                MinSize is a minimal size of memory objects, which may be
                swapped by memory manager.  The memory manager does not swap
                objects that are smaller than this value.  This reduces the
                number of swap/load operations.
            </para>

            <para>
                You can retrieve or set the minimum size using the
                <code>getMinSize()</code> and <code>setMinSize($newSize)</code>
                methods:
                <programlisting role="php"><![CDATA[<?php
$oldMinSize = $memoryManager->getMinSize();  // Get MinSize in bytes
$memoryManager->setMinSize($newSize);        // Set MinSize limit in bytes]]>
                </programlisting>
            </para>

            <para>
                The default minimum size value is 16KB (16384 bytes).
            </para>

        </sect3>

    </sect2>

</sect1>
<sect1 id="zend.memory.memory-objects">

    <title>Memory Objects</title>

    <sect2 id="zend.memory.memory-objects.movable">

        <title>Movable</title>

        <para>
            Create movable memory objects using the <code>create([$data])</code>
            method of the memory manager:
            <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->create($data);]]>
            </programlisting>
        </para>

        <para>
            "Movable" means that such objects may be swapped and unloaded from
            memory and then loaded when application code accesses the object.
        </para>

    </sect2>

    <sect2 id="zend.memory.memory-objects.locked">

        <title>Locked</title>

        <para>
            Create locked memory objects using the <code>createLocked([$data])</code>
            method of the memory manager:
            <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->createLocked($data);]]>
            </programlisting>
        </para>

        <para>
            "Locked" means that such objects are never swapped and unloaded
            from memory.
        </para>

        <para>
            Locked objects provides the same interface as movable objects
            (<code>Zend_Memory_Container_Interface</code>).
            So locked object can be used in any place instead of movable objects.
        </para>

        <para>
            It's useful if an application or developer can decide, that some
            objects should never be swapped, based on performance considerations.
        </para>

        <para>
            Access to locked objects is faster, because the memory manager doesn't
            need to track changes for these objects.
        </para>

        <para>
            The locked objects class (<code>Zend_Memory_Container_Locked</code>)
            guarantees virtually the same performance as working with a string
            variable.  The overhead is a single dereference to get the class property.
        </para>

    </sect2>

    <sect2 id="zend.memory.memory-objects.value">

        <title>Memory container 'value' property.</title>

        <para>
            Use the memory container (movable or locked) '<code>value</code>'
            property to operate with memory object data:
            <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->create($data);

echo $memObject->value;

$memObject->value = $newValue;

$memObject->value[$index] = '_';

echo ord($memObject->value[$index1]);

$memObject->value = substr($memObject->value, $start, $length);]]>
            </programlisting>
        </para>

        <para>
            An alternative way to access memory object data is to use the
            <link linkend="zend.memory.memory-objects.api.getRef"><code>getRef()</code></link>
            method.  This method <emphasis>must</emphasis> be used for PHP
            versions before 5.2.  It also may have to be used in some other
            cases for performance reasons.
        </para>
    </sect2>

    <sect2 id="zend.memory.memory-objects.api">

        <title>Memory container interface</title>

        <para>
            Memory container provides the following methods:
        </para>

        <sect3 id="zend.memory.memory-objects.api.getRef">

            <title>getRef() method</title>

            <programlisting role="php"><![CDATA[<?php
public function &getRef();]]>
            </programlisting>

            <para>
                The <code>getRef()</code> method returns reference to the object value.
            </para>

            <para>
                Movable objects are loaded from the cache at this moment if the
                object is not already in memory.  If the object is loaded from
                the cache, this might cause swapping of other objects if the
                memory limit would be exceeded by having all the managed
                objects in memory.
            </para>

            <para>
                The <code>getRef()</code> method <emphasis>must</emphasis> be
                used to access memory object data for PHP versions before 5.2.
            </para>

            <para>
                Tracking changes to data needs additional resources.
                The <code>getRef()</code> method returns reference to string,
                which is changed directly by user application.
                So, it's a good idea to use the <code>getRef()</code> method
                for value data processing:
                <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->create($data);

$value = &$memObject->getRef();

for ($count = 0; $count < strlen($value); $count++) {
    $char = $value[$count];
    ...
}]]>
                </programlisting>
            </para>

        </sect3>

        <sect3 id="zend.memory.memory-objects.api.touch">

            <title>touch() method</title>

            <programlisting role="php"><![CDATA[<?php
public function touch();]]>
            </programlisting>
            <para>
                The <code>touch()</code> method should be used in common with
                <code>getRef()</code>. It signals that object value has been changed:
                <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->create($data);
...

$value = &$memObject->getRef();

for ($count = 0; $count < strlen($value); $count++) {
    ...
    if ($condition) {
        $value[$count] = $char;
    }
    ...
}

$memObject->touch();]]>
                </programlisting>

            </para>

        </sect3>

        <sect3 id="zend.memory.memory-objects.api.lock">

            <title>lock() method</title>

            <programlisting role="php"><![CDATA[<?php
public function lock();]]>
            </programlisting>

            <para>
                The <code>lock()</code> methods locks object in memory.
                It should be used to prevent swapping of some objects you choose.
                Normally, this is not necessary, because the memory manager uses
                an intelligent algorithm to choose candidates for swapping.
                But if you exactly know, that at at this part of code some
                objects should not be swapped, you may lock them.
            </para>

            <para>
                Locking objects in memory also guarantees that reference
                returned by the <code>getRef()</code> method is valid until you
                unlock the object:
                <programlisting role="php"><![CDATA[<?php
$memObject1 = $memoryManager->create($data1);
$memObject2 = $memoryManager->create($data2);
...

$memObject1->lock();
$memObject2->lock();

$value1 = &$memObject1->getRef();
$value2 = &$memObject2->getRef();

for ($count = 0; $count < strlen($value2); $count++) {
    $value1 .= $value2[$count];
}

$memObject1->touch();
$memObject1->unlock();
$memObject2->unlock();]]>
                </programlisting>
            </para>

        </sect3>

        <sect3 id="zend.memory.memory-objects.api.unlock">

            <title>unlock() method</title>

            <programlisting role="php"><![CDATA[<?php
public function unlock();]]>
            </programlisting>

            <para>
                <code>unlock()</code> method unlocks object when it's no longer
                necessary to be locked. See the example above.
            </para>

        </sect3>

        <sect3 id="zend.memory.memory-objects.api.isLocked">

            <title>isLocked() method</title>

            <programlisting role="php"><![CDATA[<?php
public function isLocked();]]>
            </programlisting>

            <para>
                The <code>isLocked()</code> method can be used to check if
                object is locked.  It returns <code>true</code> if the object
                is locked, or <code>false</code> if it is not locked.
                This is always <code>true</code> for "locked" objects,
                and may be either <code>true</code> or <code>false</code>
                for "movable" objects.
            </para>

        </sect3>

    </sect2>

</sect1>
<sect1 id="zend.memory.overview">
    <title>Overview</title>

    <sect2 id="zend.memory.introduction">
        <title>Introduction</title>
        <para>
            The Zend_Memory component is intended to manage data in an
            environment with limited memory.
        </para>

        <para>
            Memory objects (memory containers) are generated by memory manager
            by request and transparently swapped/loaded when it's necessary.
        </para>

        <para>
            For example, if creating or loading a managed object would cause
            the total memory usage to exceed the limit you specify, some
            managed objects are copied to cache storage outside of memory.
            In this way, the total memory used by managed objects does not
            exceed the limit you need to enforce.
        </para>

        <para>
            The memory manager uses
            <link linkend="zend.cache.backends">Zend_Cache backends</link>
            as storage providers.
        </para>

        <example id="zend.memory.introduction.example-1">
            <title>Using Zend_Memory component</title>
            <para>
                <code>Zend_Memory::factory()</code> instantiates the memory
                manager object with specified backend options.
            </para>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Memory.php';

$backendOptions = array(
    'cache_dir' => './tmp/' // Directory where to put the swapped memory blocks
);

$memoryManager = Zend_Memory::factory('File', $backendOptions);

$loadedFiles = array();

for ($count = 0; $count < 10000; $count++) {
    $f = fopen($fileNames[$count], 'rb');
    $data = fread($f, filesize($fileNames[$count]));
    $fclose($f);

    $loadedFiles[] = $memoryManager->create($data);
}

echo $loadedFiles[$index1]->value;

$loadedFiles[$index2]->value = $newValue;

$loadedFiles[$index3]->value[$charIndex] = '_';]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.memory.theory-of-operation">

        <title>Theory of Operation</title>

        <para>
            Zend_Memory component operates with the following concepts:
            <itemizedlist>
                <listitem>
                    <para>Memory manager</para>
                </listitem>
                <listitem>
                    <para>Memory container</para>
                </listitem>
                <listitem>
                    <para>Locked memory object</para>
                </listitem>
                <listitem>
                    <para>Movable memory object</para>
                </listitem>
            </itemizedlist>
        </para>

        <sect3 id="zend.memory.theory-of-operation.manager">

            <title>Memory manager</title>

            <para>
                The memory manager generates memory objects (locked or movable)
                by request of user application and returns them wrapped into
                a memory container object.
            </para>

        </sect3>

        <sect3 id="zend.memory.theory-of-operation.container">

            <title>Memory container</title>

            <para>
                The memory container has a virtual or actual <code>value</code>
                attribute of string type. This attribute contains the data value
                specified at memory object creation time.
            </para>

            <para>
                You can operate with this <code>value</code> attribute as
                an object property:

                <programlisting role="php"><![CDATA[<?php
$memObject = $memoryManager->create($data);

echo $memObject->value;

$memObject->value = $newValue;

$memObject->value[$index] = '_';

echo ord($memObject->value[$index1]);

$memObject->value = substr($memObject->value, $start, $length);]]>
                </programlisting>
            </para>

            <note>
                <para>
                    If you are using a PHP version earlier than 5.2, use the
                    <link linkend="zend.memory.memory-objects.api.getRef">getRef()</link>
                    method instead of accessing the value property directly.
                </para>
            </note>

        </sect3>

        <sect3 id="zend.memory.theory-of-operation.locked">

            <title>Locked memory</title>

            <para>
                Locked memory objects are always stored in memory.
                Data stored in locked memory are never swapped to the cache
                backend.
            </para>

        </sect3>

        <sect3 id="zend.memory.theory-of-operation.movable">

            <title>Movable memory</title>

            <para>
                Movable memory objects are transparently swapped and loaded
                to/from the cache backend by Zend_Memory when it's necessary.
            </para>

            <para>
                The memory manager doesn't swap objects with size less than
                the specified minimum, due to performance considerations.
                See <xref linkend="zend.memory.memory-manager.settings.min-size" />
                for more details.
            </para>

        </sect3>

    </sect2>

</sect1>
<sect1 id="zend.mime.mime">
    <title>Zend_Mime</title>

    <sect2 id="zend.mime.mime.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Mime</code> is a support class for handling multipart MIME messages. It is used by <link
            linkend="zend.mail"><code>Zend_Mail</code></link> and <link
            linkend="zend.mime.message"><code>Zend_Mime_Message</code></link> and may be used by applications requiring
            MIME support.
        </para>
    </sect2>

    <sect2 id="zend.mime.mime.static">
    <title>Static Methods and Constants</title>
    <para>
        <code>Zend_Mime</code> provides a simple set of static helper methods to work with MIME:
        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Mime::isPrintable()</code>: Returns TRUE if the given string contains no unprintable characters,
                FALSE otherwise.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::encodeBase64()</code>: Encodes a string into base64 encoding.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::encodeQuotedPrintable()</code>: Encodes a string with the quoted-printable mechanism.
                </para>
            </listitem>
        </itemizedlist>
    </para>
    <para>
        <code>Zend_Mime</code> defines a set of constants commonly used with MIME Messages:
        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Mime::TYPE_OCTETSTREAM</code>: 'application/octet-stream'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::TYPE_TEXT</code>: 'text/plain'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::TYPE_HTML</code>: 'text/html'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::ENCODING_7BIT</code>: '7bit'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::ENCODING_8BIT</code>: '8bit'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::ENCODING_QUOTEDPRINTABLE</code>: 'quoted-printable'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::ENCODING_BASE64</code>: 'base64'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::DISPOSITION_ATTACHMENT</code>: 'attachment'
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Mime::DISPOSITION_INLINE</code>: 'inline'
                </para>
            </listitem>
        </itemizedlist>
    </para>
    </sect2>

    <sect2 id="zend.mime.mime.instantiation">
    <title>Instantiating Zend_Mime</title>
    <para>
        When Instantiating a <code>Zend_Mime</code> Object, a MIME boundary is stored that
        is used for all subsequent non-static method calls on that object.
        If the constructor is called with a string parameter, this value
        is used as a MIME boundary. If not, a random MIME boundary is generated
        during construction time.
    </para>
    <para>
        A <code>Zend_Mime</code> object has the following Methods:
        <itemizedlist>
            <listitem>
                <para>
                    <code>boundary()</code>: Returns the MIME boundary string.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>boundaryLine()</code>: Returns the complete MIME boundary line.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>mimeEnd()</code>: Returns the complete MIME end boundary line.
                </para>
            </listitem>
        </itemizedlist>
    </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.mime.message">
    <title>Zend_Mime_Message</title>

    <sect2 id="zend.mime.message.introduction">
      <title>Introduction</title>

      <para><code>Zend_Mime_Message</code> represents a MIME compliant message
      that can contain one or more seperate Parts (Represented as <link
      linkend="zend.mime.part"><code>Zend_Mime_Part</code></link> objects). With
      <code>Zend_Mime_Message</code>, MIME compliant multipart messages can be generated from
      <code>Zend_Mime_Part</code> objects. Encoding and Boundary handling are handled transparently
      by the class. <code>Zend_Mime_Message</code> objects can also be reconstructed from given
      strings (experimental). Used by <link linkend="zend.mail"><code>Zend_Mail</code></link>.
      </para>
    </sect2>

    <sect2 id="zend.mime.message.instantiation">
        <title>Instantiation</title>
        <para>
            There is no explicit constructor for <code>Zend_Mime_Message</code>.
        </para>
    </sect2>

    <sect2 id="zend.mime.message.addparts">
        <title>Adding MIME Parts</title>

        <para><link linkend="zend.mime.part"><code>Zend_Mime_Part</code></link>
        Objects can be added to a given <code>Zend_Mime_Message</code> object by calling
        <code>-&gt;addPart($part)</code></para>

    <para>An array with all <link linkend="zend.mime.part"><code>Zend_Mime_Part</code></link>
    objects in the <code>Zend_Mime_Message</code> is returned
        from the method <code>-&gt;getParts()</code>.  The Zend_Mime_Part objects
        can then be changed since they are stored in the array as references. If
        parts are added to the array or the sequence is changed, the array needs
        to be given back to the <link linkend="zend.mime.part"><code>Zend_Mime_Part</code></link>
        object by calling <code>-&gt;setParts($partsArray)</code>.</para>

        <para>The function <code>-&gt;isMultiPart()</code> will return true if
        more than one part is registered with the <code>Zend_Mime_Message</code> object and thus
        the object would generate a Multipart-Mime-Message when generating the
        actual output.</para>
    </sect2>

    <sect2 id="zend.mime.message.bondary">
        <title>Boundary handling</title>

        <para><code>Zend_Mime_Message</code> usually creates and uses its own
        <code>Zend_Mime</code> Object to generate a boundary. If you need to
        define the boundary or want to change the behaviour of the <code>Zend_Mime</code> object
        used by <code>Zend_Mime_Message</code>, you can instantiate the <code>Zend_Mime</code>
        object yourself and then register it to <code>Zend_Mime_Message</code>.
        Usually you will not need to do this. <code>-&gt;setMime(Zend_Mime
        $mime)</code> sets a special instance of <code>Zend_Mime</code> to be used
        by this <code>Zend_Mime_Message</code></para>

        <para><code>-&gt;getMime()</code> returns the instance of
        <code>Zend_Mime</code> that will be used to render the message when
        <code>generateMessage()</code> is called.</para>

        <para><code>-&gt;generateMessage()</code> renders the <code>Zend_Mime_Message</code>
        content to a string.</para>
    </sect2>

    <sect2 id="zend.mime.message.parse">
        <title>parsing a string to create a Zend_Mime_Message object
        (experimental)</title>

        <para>A given MIME compliant message in string form can be used to
        reconstruct a <code>Zend_Mime_Message</code> Object from it.
        <code>Zend_Mime_Message</code> has a static factory Method to parse this
        String and return a <code>Zend_Mime_Message</code> Object.</para>

        <para><code>Zend_Mime_Message::createFromMessage($str, $boundary)</code>
        decodes the given string and returns a <code>Zend_Mime_Message</code>
        Object that can then be examined using <code>-&gt;getParts()</code></para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.mime.part">
    <title>Zend_Mime_Part</title>

    <sect2 id="zend.mime.part.introduction">
      <title>Introduction</title>

      <para>This class represents a single part of a MIME message. It contains the
      actual content of the message part plus information about its encoding,
      content type and original filename. It provides a method for generating a
      string from the stored data. <code>Zend_Mime_Part</code> objects can be
      added to <link
      linkend="zend.mime.message"><code>Zend_Mime_Message</code></link> to
      assemble a complete multipart message.</para>
    </sect2>

  <sect2 id="zend.mime.part.instantiation">
    <title>Instantiation</title>

    <para><code>Zend_Mime_Part</code> is instantiated with a string that
    represents the content of the new part. The type is assumed to be
    OCTET-STREAM, encoding is 8Bit. After instantiating a
    <code>Zend_Mime_Part</code>, meta information can be set by accessing its
    attributes directly:</para>

    <programlisting role="php"><![CDATA[<?php
public $type = ZMime::TYPE_OCTETSTREAM;
public $encoding = ZMime::ENCODING_8BIT;
public $id;
public $disposition;
public $filename;
public $description;
public $charset;]]>
    </programlisting>
    </sect2>

  <sect2 id="zend.mime.part.methods">
    <title>Methods for rendering the message part to a string</title>

    <para><code>getContent()</code> returns the encoded content of the
    MimePart as a string using the encoding specified in the attribute
    $encoding. Valid values are ZMime::ENCODING_* Characterset conversions are
    not performed.</para>

    <para>
        <code>getHeaders()</code> returns the Mime-Headers for the
        MimePart as generated from the information in the publicly accessable
        attributes. The attributes of the object need to be set correctly before
        this method is called.
        <itemizedlist>
            <listitem>
                <para>
                    <code>$charset</code>
                    has to be set to the actual charset of the content if it is a text type (Text or HTML).
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$id</code>
´                   may be set to identify a content-id for inline images in a HTML mail.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$filename</code>
                    contains the name the file will get when downloading it.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$disposition</code>
                    defines if the file should be treated as an attachment or if it is used inside
                    the (HTML-) mail (inline).
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>$description</code>
                    is only used for informational purposes.
                </para>
            </listitem>
        </itemizedlist>
    </para>
  </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.openid.consumer">
    <title>Zend_OpenId_Consumer Basics</title>
    <para>
        <code>Zend_OpenId_Consumer</code> is used to implement the OpenID
        authentication schema on web sites.
    </para>

    <sect2 id="zend.openid.consumer.authentication">
        <title>OpenID Authentication</title>
        <para>
            From a site developers point of view, the OpenID authentication
            process consists of three steps:
        </para>

        <orderedlist>
            <listitem>
                <para>
                    Show OpenID authentication form.
                </para>
            </listitem>

            <listitem>
                <para>
                    Accept OpenID identity and pass it to the OpenID provider.
                </para>
            </listitem>

            <listitem>
                <para>
                    Verify response from the OpenID provider.
                </para>
            </listitem>
        </orderedlist>

        <para>
            In actual fact the OpenID authentication protocol performs more
            steps, but most of them are encapsulated inside the
            <code>Zend_OpenId_Consumer</code>, and they are transparent to the
            developer.
        </para>

        <para>
            The OpenID authentication process is initiated by the end-user by
            filling in their identification into the appropriate form and submiting
            it. The following example shows a simple form that accepts an OpenID
            identifier. Note that the example shows only a login.
        </para>

        <example id="zend.openid.consumer.example-1">
            <title>The Simple OpenID Login form</title>
            <programlisting role="php"><![CDATA[<html><body>
<form method="post" action="example-1_2.php"><fieldset>
<legend>OpenID Login</legend>
<input type="text" name="openid_identifier">
<input type="submit" name="openid_action" value="login">
</fieldset></form></body></html>]]>
            </programlisting>
        </example>

        <para>
            On submit this form passes the OpenID identity to the following PHP
            script that performs a second step of authentication. The only thing the
            PHP script needs to do in this step is call the
            <code>Zend_OpenId_Consumer::login()</code> method. The first argument of this
            method is an accepted OpenID identity and the second is a URL of a script
            that handles the third and last step of authentication.
        </para>

        <example id="zend.openid.consumer.example-1_2">
            <title>The Authentication Request Handler</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";

$consumer = new Zend_OpenId_Consumer();
if (!$consumer->login($_POST['openid_identifier'], 'example-1_3.php')) {
    die("OpenID login failed.");
}]]>
            </programlisting>
        </example>

        <para>
            The <code>Zend_OpenId_Consumer::login()</code> performs discovery on
            a given identifier and on success, finds out the address of the identity
            provider and its local identifier. Then, it creates an association to the
            given provider so that both the site and provider know the same secret
            that is used to sign the following messages. Then it passes an
            authentication request to the provider. Note this request redirects the
            end-user's web browser to an OpenID server site, where users are able to
            continue the authentication process.
        </para>

        <para>
            An OpenID Server usually asks users for; their password (if they
            weren't previously logged-in), if the user trusts this site and what
            information may be returned to the site. These interactions are not
            visible to the OpenID-enabled site so there is no what for it to get the
            user's password or other information that was not opened.
        </para>

        <para>
            On success, <code>Zend_OpenId_Consumer::login()</code> never
            returns, because it performs an HTTP redirection, however in case of error
            it may return false. Errors may occure due to an invalid identity, dead
            provider, communication error, etc
        </para>

        <para>
            The third step of authentication is initiated by a response from the
            OpenID provider, after it has already authenticated the user's password.
            This response is passed indirectly, as an HTTP redirection of the
            end-user's web browser. And the only thing that site must do is to check
            if this response is valid.
        </para>

        <example id="zend.openid.consumer.example-1_3">
            <title>The Authentication Response Verifier</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";

$consumer = new Zend_OpenId_Consumer();
if ($consumer->verify($_GET, $id)) {
    echo "VALID $id";
} else {
    echo "INVALID $id";
}]]>
            </programlisting>
        </example>

        <para>
            This check is performed using the <code>Zend_OpenId_Consumer::verify</code>
            method, that takes the whole array of
            the HTTP request's arguments and checks if this response is properly
            signed by an appropriate OpenID provider. It also may assign
            the claimed OpenID identity that was entered by end-user in the
            first step into the second (optional) argument.
        </para>
    </sect2>

    <sect2 id="zend.openid.consumer.combine">
        <title>Combine all Steps in One Page</title>
        <para>
            The following example combines all three steps together. It doesn't
            provide any additional functionality. The only advantage is that now
            developers don't need to specify any URL's of scripts that handle the next
            step. By default, all steps use the same URL. However, the script now
            includes a dispatch code that calls appropriate code for each step of
            authentication.
        </para>

        <example id="zend.openid.consumer.example-2">
            <title>The Complete OpenID Login Script</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";

$status = "";
if (isset($_POST['openid_action']) &&
    $_POST['openid_action'] == "login" &&
    !empty($_POST['openid_identifier'])) {

    $consumer = new Zend_OpenId_Consumer();
    if (!$consumer->login($_POST['openid_identifier'])) {
        $status = "OpenID login failed.<br>";
    }
} else if (isset($_GET['openid_mode'])) {
    if ($_GET['openid_mode'] == "id_res") {
        $consumer = new Zend_OpenId_Consumer();
        if ($consumer->verify($_GET, $id)) {
            $status = "VALID $id";
        } else {
            $status = "INVALID $id";
        }
    } else if ($_GET['openid_mode'] == "cancel") {
        $status = "CANCELED";
    }
}
?>
<html><body>
<?php echo "$status<br>";?>
<form method="post"><fieldset>
<legend>OpenID Login</legend>
<input type="text" name="openid_identifier" value="">
<input type="submit" name="openid_action" value="login">
</fieldset></form></body></html>]]>
            </programlisting>
        </example>

        <para>
            In addition, this code differenciates between canceled and wrong
            authentication responses. The provider retuns a canceled responce in cases
            when an identity provider doesn't know the supplied identity or the user
            is not logged-in or they don't trust the site. A wrong response assumes
            that the responce is wrong or incorrectly signed.
        </para>
    </sect2>

    <sect2 id="zend.openid.consumer.realm">
        <title>Realm</title>
        <para>
            When an OpenID-enabled site passes authentication requests to a
            provider, it identifies itself with a realm URL. This URL may be
            considered as a root of a trusted site. If the user trusts the URL they
            will also trust to matched and subsequent URLs.
        </para>

        <para>
            By default, the realm URL is automatically set to the URL of the
            directory where the login script is. This decision is useful for most, but
            not all cases. Sometimes a whole site and not directory is used, or even a
            combination of several servers from one domain.
        </para>

        <para>
            To implement this ability, developers may pass the realm value as a
            third argument to the <code>Zend_OpenId_Consumer::login</code> method. In
            the following example the single interaction asks for trusted access to
            all php.net sites.
        </para>

        <example id="zend.openid.consumer.example-3_2">
            <title>Authentication Request for Specified Realm</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";

$consumer = new Zend_OpenId_Consumer();
if (!$consumer->login($_POST['openid_identifier'], 'example-3_3.php', 'http://*.php.net/')) {
    die("OpenID login failed.");
}]]>
            </programlisting>
        </example>

        <para>
            The example below only implements the second step of authentication,
            the first and third steps are the same as in the first example.
        </para>
    </sect2>

    <sect2 id="zend.openid.consumer.check">
        <title>Immediate Check</title>
        <para>
            In some situations it is necissary to see if a user is already
            logged-in into a trusted OpenID server without any interaction with the
            user. The <code>Zend_OpenId_Consumer::check</code> method does precisely
            that. It is executed with exactly the same arguments as
            <code>Zend_OpenId_Consumer::login</code> but it doesn't show the user any
            OpenID server pages. Therefore from the users point of view it is
            transparent and it seems as if they never left the site. The third step
            succeedes if user is already logged-in and trusted to the site otherwise
            it will fail.
        </para>

        <example id="zend.openid.consumer.example-4">
            <title>Immediate Check without Interaction</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";

$consumer = new Zend_OpenId_Consumer();
if (!$consumer->check($_POST['openid_identifier'], 'example-4_3.php')) {
    die("OpenID login failed.");
}]]>
            </programlisting>
        </example>

        <para>
            The example below only implements the second step of authentication,
            first and third steps are the same as in the first example.
        </para>
    </sect2>

    <sect2 id="zend.openid.consumer.storage">
        <title>Zend_OpenId_Consumer_Storage</title>
        <para>
            There are three steps to the OpenID authentication procedure, each
            step is performed by a separate HTTP request. To store information between
            requests <code>Zend_OpenId_Consumer</code> uses internal storage.
        </para>

        <para>
            Developers may not care about this storage because by default
            <code>Zend_OpenId_Consumer</code> uses file-based storage under /tmp
            similar to PHP sessions. However, this storage may be not suitable in all
            cases. Some may want to store information in a database while others may
            need to use common storage suitable for big web-farms. Fortunately,
            developers may easily replace the default storage with their own. The only
            thing to implement is it's own storage class as a child of
            the <code>Zend_OpenId_Consumer_Storage</code> method and pass it as a first
            argument to the <code>Zend_OpenId_Consumer</code> constructor.
        </para>

        <para>
            The following example demonstrates a simple storage that uses
            <code>Zend_Db</code> as the backend containing three groups of functions.
            the first is for working with associations, the second is to cache
            discovery information and the third is to check responce uniqueness. The
            class is implemented in such a way that it can be easily used with
            existing or new databases. If necessary, it will create database tables if
            they don't exist.
        </para>

        <example id="zend.openid.consumer.example-5">
            <title>Databse Storage</title>
            <programlisting role="php"><![CDATA[<?php
class DbStorage extends Zend_OpenId_Consumer_Storage
{
    private $_db;
    private $_association_table;
    private $_discovery_table;
    private $_nonce_table;

    public function __construct($db,
                                $association_table = "association",
                                $discovery_table = "discovery",
                                $nonce_table = "nonce")
    {
        $this->_db = $db;
        $this->_association_table = $association_table;
        $this->_discovery_table = $discovery_table;
        $this->_nonce_table = $nonce_table;
        $tables = $this->_db->listTables();
        if (!in_array($association_table, $tables)) {
            $this->_db->getConnection()->exec(
                "create table $association_table (" .
                " url     varchar(256) not null primary key," .
                " handle  varchar(256) not null," .
                " macFunc char(16) not null," .
                " secret  varchar(256) not null," .
                " expires timestamp" .
                ")");
        }
        if (!in_array($discovery_table, $tables)) {
            $this->_db->getConnection()->exec(
                "create table $discovery_table (" .
                " id      varchar(256) not null primary key," .
                " realId  varchar(256) not null," .
                " server  varchar(256) not null," .
                " version float," .
                " expires timestamp" .
                ")");
        }
        if (!in_array($nonce_table, $tables)) {
            $this->_db->getConnection()->exec(
                "create table $nonce_table (" .
                " nonce   varchar(256) not null primary key," .
                " created timestamp default current_timestamp" .
                ")");
        }
    }

    public function addAssociation($url, $handle, $macFunc, $secret, $expires)
    {
        $table = $this->_association_table;
        $secret = base64_encode($secret);
        $this->_db->query("insert into $table (url, handle, macFunc, secret, expires) " .
                          "values ('$url', '$handle', '$macFunc', '$secret', $expires)");
        return true;
    }

    public function getAssociation($url, &$handle, &$macFunc, &$secret, &$expires)
    {
        $table = $this->_association_table;
        $this->_db->query("delete from $table where expires < " . time());
        $res = $this->_db->fetchRow("select handle, macFunc, secret, expires from $table where url = '$url'");
        if (is_array($res)) {
            $handle  = $res['handle'];
            $macFunc = $res['macFunc'];
            $secret  = base64_decode($res['secret']);
            $expires = $res['expires'];
            return true;
        }
        return false;
    }

    public function getAssociationByHandle($handle, &$url, &$macFunc, &$secret, &$expires)
    {
        $table = $this->_association_table;
        $this->_db->query("delete from $table where expires < " . time());
        $res = $this->_db->fetchRow("select url, macFunc, secret, expires from $table where handle = '$handle'");
        if (is_array($res)) {
            $url     = $res['url'];
            $macFunc = $res['macFunc'];
            $secret  = base64_decode($res['secret']);
            $expires = $res['expires'];
            return true;
        }
        return false;
    }

    public function delAssociation($url)
    {
        $table = $this->_association_table;
        $this->_db->query("delete from $table where url = '$url'");
        return true;
    }

    public function addDiscoveryInfo($id, $realId, $server, $version, $expires)
    {
        $table = $this->_discovery_table;
        $this->_db->query("insert into $table (id, realId, server, version, expires) " .
                          "values ('$id', '$realId', '$server', $version, $expires)");
        return true;
    }

    public function getDiscoveryInfo($id, &$realId, &$server, &$version, &$expires)
    {
        $table = $this->_discovery_table;
        $this->_db->query("delete from $table where expires < " . time());
        $res = $this->_db->fetchRow("select realId, server, version, expires from $table where id = '$id'");
        if (is_array($res)) {
            $realId  = $res['realId'];
            $server  = $res['server'];
            $version = $res['version'];
            $expires = $res['expires'];
            return true;
        }
        return false;
    }

    public function delDiscoveryInfo($id)
    {
        $table = $this->_discovery_table;
        $this->_db->query("delete from $table where id = '$id'");
        return true;
    }

    public function isUniqueNonce($nonce)
    {
        $table = $this->_nonce_table;
        try {
            $ret = $this->_db->query("insert into $table (nonce) values ('$nonce')");
        } catch (Zend_Db_Statement_Exception $e) {
            return false;
        }
        return true;
    }

    public function purgeNonces($date=null)
    {
    }
}

$db = Zend_Db::factory('Pdo_Sqlite',
    array('dbname'=>'/tmp/openid_consumer.db'));
$storage = new DbStorage($db);
$consumer = new Zend_OpenId_Consumer($storage);]]>
            </programlisting>
        </example>

        <para>
            The example doesn't include OpenID authentication code itself, but
            it is based on the same logic as in the previous or following
            examples.
        </para>
    </sect2>

    <sect2 id="zend.openid.consumer.sreg">
        <title>Simple Registration Extension</title>
        <para>
            In addition to authentication, the OpenID can be used for
            light-weight profile exchange. This feature is not covered by OpenID
            authentication specification but by the OpenID Simple Registration
            Extension protocol. This protocol allows OpenID-enabled sites to ask for
            information about an end-user from OpenID providers. Such information may
            include:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis>nickname</emphasis>
                    - any UTF-8 string that the end user wants to use as a nickname.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>email</emphasis>
                    - the email address of the end user as specified in section 3.4.1
                    of RFC2822.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>fullname</emphasis>
                    - a UTF-8 string representation of the end user's full name.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>dob</emphasis>
                    - the end user's date of birth as YYYY-MM-DD. Any values whose
                    representation uses fewer than the specified number of digits
                    should be zero-padded. The length of this value must always be
                    10. If the end user does not want to reveal any particular
                    component of this value, it must be set to zero. For instance,
                    if a end user wants to specify that his date of birth is in 1980,
                    but not the month or day, the value returned shall be "1980-00-00".
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>gender</emphasis>
                    - the end user's gender, "M" for male, "F" for female.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>postcode</emphasis>
                    - UTF-8 string that should conform to the end user's country's
                    postal system.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>country</emphasis>
                    - the End User's country of residence as specified by ISO3166.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>language</emphasis>
                    - end User's preferred language as specified by ISO639.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>timezone</emphasis>
                    - ASCII string from TimeZone database. For example,
                    "Europe/Paris" or "America/Los_Angeles".
                </para>
            </listitem>
        </itemizedlist>

        <para>
            An OpenID-enabled web site may ask for any combination of these
            fields. It may also strictly require some information and allow end-users
            to provide or hide other information. The following example creates an
            object of the <code>Zend_OpenId_Extension_Sreg</code> class that requires
            a <emphasis>nickname</emphasis> and optionally ask for
            <emphasis>email</emphasis> and <emphasis>fullname</emphasis>.
        </para>

        <example id="zend.openid.consumer.example-6_2">
            <title>Sending Requests with a Simple Registration Extension</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";
require_once "Zend/OpenId/Extension/Sreg.php";

$sreg = new Zend_OpenId_Extension_Sreg(array(
    'nickname'=>true,
    'email'=>false,
    'fullname'=>false), null, 1.1);
$consumer = new Zend_OpenId_Consumer();
if (!$consumer->login($_POST['openid_identifier'], 'example-6_3.php', null, $sreg)) {
    die("OpenID login failed.");
}]]>
            </programlisting>
        </example>

        <para>
            As you can see the <code>Zend_OpenId_Extension_Sreg</code>
            constructor accepts an array of asked fields. This array has the names of
            fields as indexes and requirements flag as values.
            <emphasis>true</emphasis> means the field is required and
            <emphasis>false</emphasis> means the field is optional. The
            <code>Zend_OpenId_Consumer::login</code> accepts extensions or list of
            extensions as a fourth argument.
        </para>

        <para>
            On the third step of authentication, the
            <code>Zend_OpenId_Extension_Sreg</code> object should be passed to
            <code>Zend_OpenId_Consumer::verify</code>. Then on successful authentication
            <code>Zend_OpenId_Extension_Sreg::getProperties</code> will return an
            associative array of requested fields.
        </para>

        <example id="zend.openid.consumer.example-6_3">
            <title>Verifying Responses with a Simple Registration Extension</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";
require_once "Zend/OpenId/Extension/Sreg.php";

$sreg = new Zend_OpenId_Extension_Sreg(array(
    'nickname'=>true,
    'email'=>false,
    'fullname'=>false), null, 1.1);
$consumer = new Zend_OpenId_Consumer();
if ($consumer->verify($_GET, $id, $sreg)) {
    echo "VALID $id<br>\n";
    $data = $sreg->getProperties();
    if (isset($data['nickname'])) {
        echo "nickname: " . $data['nickname'] . "<br>\n";
    }
    if (isset($data['email'])) {
        echo "email: " . $data['email'] . "<br>\n";
    }
    if (isset($data['fullname'])) {
        echo "fullname: " . $data['fullname'] . "<br>\n";
    }
} else {
    echo "INVALID $id";
}]]>
            </programlisting>
        </example>

        <para>
            If <code>Zend_OpenId_Extension_Sreg</code> was created without any
            arguments, the user code should check for the existence of the required
            data itself. However, if the object is created with the same list of
            required fields as on the second step, it will automatically check for the
            existence of required data. In this case, <code>Zend_OpenId_Consumer::verify</code>
             will return <emphasis>false</emphasis> if any of the required fields are
            missing.
        </para>

        <para>
            By default, <code>Zend_OpenId_Extension_Sreg</code> uses version
            1.0, because the specification for version 1.1 is not yet finalized.
            However, some libraries don't fully support version 1.0. For example,
            www.myopenid.com requires an SREG namespace in requests which is only
            available in 1.1. To work with this server, explicitly set the version to
            1.1 in the <code>Zend_OpenId_Extension_Sreg</code> constructor.
        </para>

        <para>
            The second argument of the <code>Zend_OpenId_Extension_Sreg</code>
            constructor is a policy URL, that should be provided to the end-user by
            the identity provider.
        </para>
    </sect2>

    <sect2 id="zend.openid.consumer.auth">
        <title>Integration with Zend_Auth</title>
        <para>
            Zend Framework provides a special class to support user
            authentication - <code>Zend_Auth</code>. This class can be used together
            with <code>Zend_OpenId_Consumer</code>. The following example shows how
            <code>OpenIdAdapter</code> implements
            the <code>Zend_Auth_Adapter_Interface</code> with the
            <code>authenticate</code> method.This performs an authentication query and
            verification.
        </para>

        <para>
            The big difference between this adapter and existing ones, is that
            it works on two HTTP requests and includes a dispatch code to perform the
            second or third step of OpenID authentication.
        </para>

        <example id="zend.openid.consumer.example-7">
            <title>Zend_Auth Adapter for OpenID</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Consumer.php";
require_once "Zend/Auth.php";
require_once "Zend/Auth/Adapter/Interface.php";

class OpenIdAdapter implements Zend_Auth_Adapter_Interface {
    private $_id = null;

    public function __construct($id = null) {
        $this->_id = $id;
    }

    public function authenticate() {
        $id = $this->_id;
        if (!empty($id)) {
            $consumer = new Zend_OpenId_Consumer();
            if (!$consumer->login($id)) {
                $ret = false;
                $mdg = "Authentication failed.";
            }
        } else {
            $consumer = new Zend_OpenId_Consumer();
            if ($consumer->verify($_GET, $id)) {
                $ret = true;
                $msg = "Authentication successful";
            } else {
                $ret = false;
                $msg = "Authentication failed";
            }
        }
        return new Zend_Auth_Result($ret, $id, array($msg));
    }
}

$status = "";
$auth = Zend_Auth::getInstance();
if ((isset($_POST['openid_action']) &&
     $_POST['openid_action'] == "login" &&
     !empty($_POST['openid_identifier'])) ||
    isset($_GET['openid_mode'])) {
    $adapter = new OpenIdAdapter(@$_POST['openid_identifier']);
    $result = $auth->authenticate($adapter);
    if ($result->isValid()) {
        Zend_OpenId::redirect(Zend_OpenId::selfURL());
    } else {
        $auth->clearIdentity();
        foreach ($result->getMessages() as $message) {
            $status .= "$message<br>\n";
        }
    }
} else if ($auth->hasIdentity()) {
    if (isset($_POST['openid_action']) &&
        $_POST['openid_action'] == "logout") {
        $auth->clearIdentity();
    } else {
        $status = "Yoy are logged-in as " . $auth->getIdentity() . "<br>\n";
    }
}
?>
<html><body>
<?php echo "$status";?>
<form method="post"><fieldset>
<legend>OpenID Login</legend>
<input type="text" name="openid_identifier" value="">
<input type="submit" name="openid_action" value="login">
<input type="submit" name="openid_action" value="logout">
</fieldset></form></body></html>]]>
            </programlisting>
        </example>

        <para>
            With <code>Zend_Auth</code> the end-user's identity is saved in the
            session's data. It may be checked with <code>Zend_Auth::hasIdentity</code>
            and <code>Zend_Auth::getIdentity</code>.
        </para>
    </sect2>

    <sect2 id="zend.openid.consumer.mvc">
        <title>Integration with Zend_Controller</title>
        <para>
            Finally a couple of words about integration into
            Model-View-Controller applications. Such Zend Framework applications are
            implemented using the <code>Zend_Controller</code> class and they use
            objects of the <code>Zend_Controller_Response_Http</code> class to prepare
            HTTP responses and send them back to the end user's web-browser.
        </para>

        <para>
            <code>Zend_OpenId_Consumer</code> doesn't provide any GUI
            capabilities but it performs HTTP redirections on success of
            <code>Zend_OpenId_Consumer::login</code> and
            <code>Zend_OpenId_Consumer::check</code>. These redirections, may work
            incorrectly or not work at all if some data was already sent to the
            web-browser. To properly perform HTTP redirection in MVC code the real
            <code>Zend_Controller_Response_Http</code> should be sent to
            <code>Zend_OpenId_Consumer::login</code> or
            <code>Zend_OpenId_Consumer::check</code> as the last argument.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.openid.introduction">
    <title>Introduction</title>
    <para>
        <code>Zend_OpenId</code> is a Zend Framework component that provides a
        simple API for building OpenID-enabled sites and identity providers.
    </para>

    <sect2 id="zend.openid.introduction.what">
        <title>What is OpenID?</title>
        <para>
            OpenID is a set of protocols for user-centric digital identities.
            These protocols allow to create an identity online, using an identity
            provider. This identity can be used anywhere that OpenID is supported.
            Using OpenID-enabled sites, web users do not need to remember traditional
            authentication tokens such as username and password. All OpenID-enabled
            sites accept a single OpenID identity. This identity is typically a URL.
            It may be the URL of the user's personal page, blog or other resource that
            may provide additional information about them. No more need for many
            passwords and different user names - just one identifier for all Internet
            services. OpenID is an open, decentralized, and free user centric
            solution. A user may choose which OpenID provider to use, or even create
            their own personal identity server. No central authority is needed to
            approve or register OpenID-enabled sites or identity providers.
        </para>

        <para>
            For more information about OpenID visit <ulink url="http://www.openid.net/">OpenID official site</ulink>
            and look into the <ulink url="http://www.openidbook.com/">OpenID Book by Rafeeq
            Rehman</ulink>.
        </para>
    </sect2>

    <sect2 id="zend.openid.introduction.how">
        <title>How Does it Work?</title>
        <para>
            The main purpose of the <code>Zend_OpenId</code> components is to
            implement an OpenID authentication protocol as described in the following
            diagram:
        </para>

        <para>
            <inlinegraphic align="center" fileref="figures/zend.openid.protocol.jpg" format="JPEG" scale="100" valign="middle" width="559" />
        </para>

        <orderedlist>
            <listitem>
                <para>
                    Authentication is initiated by the end-user, who passes their
                    OpenID identifier to the OpenID consumer through a User-Agent.
                </para>
            </listitem>
            <listitem>
                <para>
                    The OpenID consumer performs normalization of the user-supplied
                    identifier, and discovery on it. As result, it gets the following:
                    a claimed identifier, OpenID provider URL and an OpenID protocol
                    version.
                </para>
            </listitem>
            <listitem>
                <para>
                    The OpenID client establishes an optional association with the
                    server using Diffie-Hellman keys. As a result, both parties get
                    a common "shared secret" that is used for signing and verification
                    of the following (subsequent) messages.
                </para>
            </listitem>
            <listitem>
                <para>
                    The OpenID consumer redirects the User-Agent to the OpenID
                    provider's URL with an OpenID authentication request.
                </para>
            </listitem>
            <listitem>
                <para>
                    The OpenID Provider checks if the user-Agent is already
                    authenticated and offers to do so if needed.
                </para>
            </listitem>
            <listitem>
                <para>
                    The end user enters the required password.
                </para>
            </listitem>
            <listitem>
                <para>
                    The OpenID Provider checks if it is allowed to pass the user
                    identity to the given consumer, and asks the user if needed.
                </para>
            </listitem>
            <listitem>
                <para>
                    The end user allows or disallows passing his identity.
                </para>
            </listitem>
            <listitem>
                <para>
                    The OpenID Provider redirects the User-Agent back to the OpenID
                    consumer with an "authentication approved" or "failed" request.
                </para>
            </listitem>
            <listitem>
                <para>
                    The OpenID consumer verifies the information received from the
                    provider by using the "shared secret" it got on step 3 or by
                    sending additional direct request to the OpenID provider.
                </para>
            </listitem>
        </orderedlist>
    </sect2>

    <sect2 id="zend.openid.introduction.structure">
        <title>Zend_OpenId Structure</title>
        <para>
            <code>Zend_OpenId</code> consists of two sub packages. The first one
            is <code>Zend_OpenId_Consumer</code> for developing OpenID-enabled sites
            and the second <code>Zend_OpenId_Provider</code> for developing OpenID
            servers. They are completely independent of each other and may be used
            separately.
        </para>

        <para>
            The only common parts of these sub packages are the OpenID Simple
            Registration Extension implemented by
            <code>Zend_OpenId_Extension_Sreg</code> class and the set of utility
            functions implemented by <code>Zend_OpenId</code> class.
        </para>

        <note>
            <para>
                <code>Zend_OpenId</code> takes advantage of the <ulink url="http://php.net/gmp">GMP extension</ulink>,
                where available. Consider enabling the GMP extension for better performance when using
                <code>Zend_OpenId</code>.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.openid.introduction.standards">
        <title>Supported Standards</title>
        <para>
            The <code>Zend_OpenId</code> component conforms to the following
            standards:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    OpenID Authentication protocol version 1.1
                </para>
            </listitem>
            <listitem>
                <para>
                    OpenID Authentication protocol version 2.0 draft 11
                </para>
            </listitem>
            <listitem>
                <para>
                    OpenID Simple Registration Extension version 1.0
                </para>
            </listitem>
            <listitem>
                <para>
                    OpenID Simple Registration Extension version 1.1 draft 1
                </para>
            </listitem>
        </itemizedlist>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.openid.provider">
    <title>Zend_OpenId_Provider</title>
    <para>
        The <code>Zend_OpenId_Provider</code> is used to implement OpenID
        servers. This chapter provides very basic examples demonstrating how to
        build a working server. However, for implementation of a production OpenID
        server (like <ulink url="http://www.myopenid.com">www.myopenid.com</ulink>) you
        may be required to deal with more complex issues.
    </para>

    <sect2 id="zend.openid.provider.start">
        <title>Quick Start</title>
        <para>
            The following identity includes the code for creating a user account
            using <code>Zend_OpenId_Provider::register</code>. The link element with
            <code>rel="openid.server"</code> points to our own server script. If you
            submit this identity to an OpenID-enabled site, it will perform
            authentication on this server.
        </para>

        <para>
            The code before &lt;html&gt; is just a trick that automatically
            creates a user account. You wont need such code when using real
            identities.
        </para>

        <example id="zend.openid.provider.example-1">
            <title>The Identity</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Provider.php";
define("TEST_SERVER", Zend_OpenId::absoluteURL("example-8.php"));
define("TEST_ID", Zend_OpenId::selfURL());
define("TEST_PASSWORD", "123");
$server = new Zend_OpenId_Provider();
if (!$server->hasUser(TEST_ID)) {
    $server->register(TEST_ID, TEST_PASSWORD);
}
?>
<html><head>
<link rel="openid.server" href="<?php echo TEST_SERVER;?>" />
</head><body>
<?php echo TEST_ID;?>
</body></html>]]>
            </programlisting>
        </example>

        <para>
            The following identity server script handles two kinds of requests
            from OpenID-enabled sites (for association and authentication). Both of
            them are handled by the same method
            <code>Zend_OpenId_Provider::handle</code>. The two arguments to
            <code>Zend_OpenId_Provider</code> are URLs of login and trust pages, these
            ask for interaction from the end-user.
        </para>

        <para>
            On success, the method <code>Zend_OpenId_Provider::handle</code>
            returns a string that should be passed back to the OpenID-enabled site. On
            failure, it returns <code>false</code> - in this example it will return a
            HTTP 403 response. You will get it if you try to open this page by
            web-browser, because it sends a non-OpenID conformed request.
        </para>

        <example id="zend.openid.provider.example-2">
            <title>Simple Identity Provider</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Provider.php";
$server = new Zend_OpenId_Provider("example-8-login.php", "example-8-trust.php");
$ret = $server->handle();
if (is_string($ret)) {
    echo $ret;
} else if ($ret !== true) {
    header('HTTP/1.0 403 Forbidden');
    echo 'Forbidden';
}]]>
            </programlisting>
        </example>

        <para>
            It is a good idea to use a secure connection (HTTPS) for this and
            especially for the following interactive scripts, to prevent password
            disclosure.
        </para>

        <para>
            The following script implements a login screen for an identity
            server <code>Zend_OpenId_Provider</code> and redirects to this page when a
            required user has not yet logged-in. On this page, users enter a password
            to login.
        </para>

        <para>
            You should use the password "123" that was used during a tricky user
            registration from an identity script.
        </para>

        <para>
            On submit, the script calls <code>Zend_OpenId_Provider::login</code>
            with the accepted end-user's identity and password, then redirects it back
            to the main identity provider's script. On success, the
            <code>Zend_OpenId_Provider::login</code> establishes a session between the
            end-user and the identity-provider and stores the information about
            logged-in user. So, all following requests from the same end-user won't
            require login procedure (even if they come from another OpenID enabled
            web-site).
        </para>

        <para>
            Note that this session is between end-user and identity provider
            only. OpenID enabled sites know nothing about it.
        </para>

        <example id="zend.openid.provider.example-3">
            <title>Simple Login Screen</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Provider.php";
$server = new Zend_OpenId_Provider();

if ($_SERVER['REQUEST_METHOD'] == 'POST' &&
    isset($_POST['openid_action']) &&
    $_POST['openid_action'] === 'login' &&
    isset($_POST['openid_identifier']) &&
    isset($_POST['openid_password'])) {
    $server->login($_POST['openid_identifier'], $_POST['openid_password']);
    Zend_OpenId::redirect("example-8.php", $_GET);
}
?>
<html><body>
<form method="post"><fieldset>
<legend>OpenID Login</legend>
<table border=0>
<tr><td>Name:</td><td><input type="text" name="openid_identifier" value="<?php
echo $_GET['openid_identity'];
?>"></td></tr>
<tr><td>Password:</td><td><input type="text" name="openid_password" value=""></td></tr>
<tr><td>&nbsp;</td><td><input type="submit" name="openid_action" value="login"></td></tr>
</table></fieldset></form></body></html>]]>
            </programlisting>
        </example>

        <para>
            The fact that the user is logged-in doesn't mean that the
            authentication must succeed. The user may decide to trust or not to trust
            particular OpenID enabled sites. The following trust screen allows the
            end-user to make that choise. This choise may be done only for current
            requests or "forever". In the last case information about
            trusted/untrusted sites is stored in an internal database and all
            following authentication requests from this site will be handled
            automatically, without user interaction.
        </para>

        <example id="zend.openid.provider.example-4">
            <title>Simple Trust Screen</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Provider.php";
$server = new Zend_OpenId_Provider();

if ($_SERVER['REQUEST_METHOD'] == 'POST' &&
    isset($_POST['openid_action']) &&
    $_POST['openid_action'] === 'trust') {

    if (isset($_POST['allow'])) {
        if (isset($_POST['forever'])) {
            $server->allowSite($server->getSiteRoot($_GET));
        }
        $server->respondToConsumer($_GET);
    } else if (isset($_POST['deny'])) {
        if (isset($_POST['forever'])) {
            $server->denySite($server->getSiteRoot($_GET));
        }
        Zend_OpenId::redirect($_GET['openid_return_to'], array('openid.mode'=>'cancel'));
    }
}
?>
<html><body>
<p>A site identifying as <a href="<?php echo $server->getSiteRoot($_GET);?>">
<?php echo $server->getSiteRoot($_GET);?></a> has asked us for confirmation that
<a href="<?php echo $server->getLoggedInUser();?>">
<?php echo $server->getLoggedInUser();?></a> is your identity URL.</p>
<form method="post">
<input type="checkbox" name="forever">
<label for="forever">forever</label><br>
<input type="hidden" name="openid_action" value="trust">
<input type="submit" name="allow" value="Allow">
<input type="submit" name="deny" value="Deny">
</form></body></html>]]>
            </programlisting>
        </example>

        <para>
            Production OpenID servers usually support Simple Registration
            Extension that allows consumers to ask some information about user from
            provider. In this case the trust page is usually extended with ability to
            enter requested fields or to select user profile.
        </para>
    </sect2>

    <sect2 id="zend.openid.provider.all">
        <title>Combine all together</title>
        <para>
            It is possible to combine all provider functions in one script. In
            this case login and trust URLs are omitted, and
            <code>Zend_OpenId_Provider</code> assumes that they point to the same page
            with additional "openid.action" GET argument.
        </para>

        <para>
            The following example is not complete. It doesn't provide GUI for
            end-user like it should, but performs automatic login and trusting instead.
            It is done just to simplify the example, and real server must include code
            from previous examples.
        </para>

        <example id="zend.openid.provider.example-5">
            <title>All together</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Provider.php";
$server = new Zend_OpenId_Provider();

define("TEST_ID", Zend_OpenId::absoluteURL("example-9-id.php"));
define("TEST_PASSWORD", "123");

if ($_SERVER['REQUEST_METHOD'] == 'GET' &&
    isset($_GET['openid_action']) &&
    $_GET['openid_action'] === 'login') {
    $server->login(TEST_ID, TEST_PASSWORD);
    unset($_GET['openid_action']);
    Zend_OpenId::redirect(Zend_OpenId::selfUrl(), $_GET);
} else if ($_SERVER['REQUEST_METHOD'] == 'GET' &&
    isset($_GET['openid_action']) &&
    $_GET['openid_action'] === 'trust') {
    unset($_GET['openid_action']);
    $server->respondToConsumer($_GET);
} else {
    $ret = $server->handle();
    if (is_string($ret)) {
        echo $ret;
    } else if ($ret !== true) {
        header('HTTP/1.0 403 Forbidden');
        echo 'Forbidden';
    }
}]]>
            </programlisting>
        </example>

        <para>
            If you compare this example with previous example divided to
            separate page, in addition to dispatch code you will see only the one
            difference - <code>unset($_GET['openid_action'])</code>. This
            <code>unset</code> is necessary to route next request to main
            handler.
        </para>
    </sect2>

    <sect2 id="zend.openid.provider.sreg">
        <title>Simple Registration Extension</title>
        <para>
            The following identity page makes a trick again. It creates new user
            account and associates it with profile (nickname and password). Such
            tricks aren't needed in real life where end-user registers on OpenID
            server and fill-in their profiles, but implementing this GUI is not a
            subject of this manual.
        </para>

        <example id="zend.openid.provider.example-6">
            <title>Identity with Profile</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Provider.php";
require_once "Zend/OpenId/Extension/Sreg.php";
define("TEST_SERVER", Zend_OpenId::absoluteURL("example-10.php"));
define("TEST_ID", Zend_OpenId::selfURL());
define("TEST_PASSWORD", "123");
$server = new Zend_OpenId_Provider();
if (!$server->hasUser(TEST_ID)) {
    $server->register(TEST_ID, TEST_PASSWORD);
    $server->login(TEST_ID, TEST_PASSWORD);
    $sreg = new Zend_OpenId_Extension_Sreg(array(
        'nickname' =>'test',
        'email' => 'test@test.com'
    ));
    $root = Zend_OpenId::absoluteURL(".");
    Zend_OpenId::normalizeUrl($root);
    $server->allowSite($root, $sreg);
    $server->logout();
}
?>
<html><head>
<link rel="openid.server" href="<?php echo TEST_SERVER;?>" />
</head><body>
<?php echo TEST_ID;?>
</body></html>]]>
            </programlisting>
        </example>

        <para>
            You should pass this identity to OpenID-enabled site (use Simple
            Registration Extension example from previous chapter) and it will use the
            following OpenID server script.
        </para>

        <para>
            It is a variation from previous "All together" example. It uses the
            same automatic login mechanism, but it doesn't contain any code for trust
            page. The user already trusts "forever" to example scripts. This trust was
            made by <code>Zend_OpenId_Provider::alowSite</code> method in identity
            script. The same method associated profile with trusted URL and this
            profile will be returned automatically on request from this trusted
            URL.
        </para>

        <para>
            The only thing necessary to make Simple Registration Extension work
            is passing object of <code>Zend_OpenId_Extension_Sreg</code> as second
            argument to <code>Zend_OpenId_Provider::handle</code>.
        </para>

        <example id="zend.openid.provider.example-7">
            <title>Provider with SREG</title>
            <programlisting role="php"><![CDATA[<?php
require_once "Zend/OpenId/Provider.php";
require_once "Zend/OpenId/Extension/Sreg.php";
$server = new Zend_OpenId_Provider();
$sreg = new Zend_OpenId_Extension_Sreg();

define("TEST_ID", Zend_OpenId::absoluteURL("example-10-id.php"));
define("TEST_PASSWORD", "123");

if ($_SERVER['REQUEST_METHOD'] == 'GET' &&
    isset($_GET['openid_action']) &&
    $_GET['openid_action'] === 'login') {
    $server->login(TEST_ID, TEST_PASSWORD);
    unset($_GET['openid_action']);
    Zend_OpenId::redirect(Zend_OpenId::selfUrl(), $_GET);
} else if ($_SERVER['REQUEST_METHOD'] == 'GET' &&
    isset($_GET['openid_action']) &&
    $_GET['openid_action'] === 'trust') {
   echo "UNTRUSTED DATA" ;
} else {
    $ret = $server->handle(null, $sreg);
    if (is_string($ret)) {
        echo $ret;
    } else if ($ret !== true) {
        header('HTTP/1.0 403 Forbidden');
        echo 'Forbidden';
    }
}]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.openid.provider.else">
        <title>What Else?</title>
        <para>
            Building OpenID servers is less usual tasks then building
            OpenID-enabled sites, so this manual don't try to cover all
            <code>Zend_OpenId_Provider</code> features as it was done for
            <code>Zend_OpenId_Consumer</code>.
        </para>

        <para>
            In two words in additional it provides:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    a set of methods to build end-user's GUI interface that allows
                    users to register, manage their trusted sites and profiles.
                </para>
            </listitem>
            <listitem>
                <para>
                    an abstraction storage layer to store information about users,
                    their sites and profiles. It also stores associations between
                    provider and OpenID-enabled sites. This layer is very similar
                    to the <code>Zend_OpenId_Consumer</code>'s one. It also uses
                    file storage by default but may be substituted with another
                    implementation.
                </para>
            </listitem>
            <listitem>
                <para>
                    an abstraction user-association layer that may associate
                    end-user's web browser with logged-in identity
                </para>
            </listitem>
        </itemizedlist>

        <para>
            <code>Zend_OpenId_Provider</code> doesn't try to cover all possible
            features that can be implemented by OpenID server (like digital
            certificates), but it can be easily extended using
            <code>Zend_OpenId_Extension</code>s or by creating a child class.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.pdf.create">
    <title>Creating and loading PDF documents.</title>
    <para>
    <code>Zend_Pdf</code> class represents PDF document itself and provides document level
    functionality.
    </para>

    <para>
    To create new document new <code>Zend_Pdf</code> object should be created.
    </para>

    <para>
    <code>Zend_Pdf</code> class also provides two static methods to load existing PDF.
    These are <code>Zend_Pdf::load()</code> and <code>Zend_Pdf::parse()</code> methods.
    Both of them return Zend_Pdf object as a result or throw an exception if error occurs.
    </para>

    <example id="zend.pdf.create.example-1">
        <title>Create new or load existing PDF document.</title>
        <programlisting role="php"><![CDATA[<?php
...
// Create new PDF document.
$pdf1 = new Zend_Pdf();

// Load PDF document from a file.
$pdf2 = Zend_Pdf::load($fileName);

// Load PDF document from a string.
$pdf3 = Zend_Pdf::parse($pdfString);
...]]>
      </programlisting>
    </example>

    <para>
    PDF file format supports incremental document update. Thus each time when document
    is updated, then new revision of the document is created.
    Zend_Pdf module supports retrieving of specified revision.
    </para>
    <para>
    Revision can be specified as a second parameter for <code>Zend_Pdf::load()</code> and
    <code>Zend_Pdf::parse()</code> methods or requested by <code>Zend_Pdf::rollback()</code>
        <footnote>
            <para>
            <code>Zend_Pdf::rollback()</code> method must be invoked before any changes, applied to the document.
            Otherwise behavior is undefined.
            </para>
        </footnote>
    call.
    </para>

    <example id="zend.pdf.create.example-2">
        <title>Requesting specified revision of the PDF document.</title>
        <programlisting role="php"><![CDATA[<?php
...
// Load PDF previouse revision of the document.
$pdf1 = Zend_Pdf::load($fileName, 1);

// Load PDF previouse revision of the document.
$pdf2 = Zend_Pdf::parse($pdfString, 1);

// Load first revision of the document.
$pdf3 = Zend_Pdf::load($fileName);
$revisions = $pdf3->revisions();
$pdf3->rollback($revisions - 1);
...]]>
        </programlisting>
    </example>


</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.pdf.drawing">
    <title>Drawing.</title>

    <sect2 id="zend.pdf.drawing.geometry">
        <title>Geometry.</title>
        <para>
        PDF uses the same geometry as PostScript. It starts from bottom-left corner of page
        and by default is measured in points (1/72 of an inch).
        </para>
        <para>
        Page size can be retrieved from a page object:
        </para>
        <para>
            <programlisting role="php"><![CDATA[<?php
$width  = $pdfPage->getWidth();
$height = $pdfPage->getHeight();]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.pdf.drawing.color">
        <title>Colors.</title>
        <para>
        PDF has a powerful capabilities for colors representation. Zend_Pdf module supports Gray Scale,
        RGB and CMYK color spaces. Any of them can be used in any place, where <code>Zend_Pdf_Color</code>
        object is required. <code>Zend_Pdf_Color_GrayScale</code>, <code>Zend_Pdf_Color_Rgb</code> and
        <code>Zend_Pdf_Color_Cmyk</code> classes provide this functionality:
        </para>
        <programlisting role="php"><![CDATA[<?php
// $grayLevel (float number). 0.0 (black) - 1.0 (white)
$color1 = new Zend_Pdf_Color_GrayScale($grayLevel);

// $r, $g, $b (float numbers). 0.0 (minimum intensity) - 1.0 (maximum intensity)
$color2 = new Zend_Pdf_Color_Rgb($r, $g, $b);

// $c, $m, $y, $k (float numbers). 0.0 (minimum intensity) - 1.0 (maximum intensity)
$color3 = new Zend_Pdf_Color_Cmyk($c, $m, $y, $k);]]>
        </programlisting>

        <para>
        HTML style colors are also provided with <code>Zend_Pdf_Color_Html</code> class:
        </para>
        <programlisting role="php"><![CDATA[<?php
$color1 = new Zend_Pdf_Color_Html('#3366FF');
$color2 = new Zend_Pdf_Color_Html('silver');
$color3 = new Zend_Pdf_Color_Html('forestgreen');]]>
        </programlisting>
    </sect2>


    <sect2 id="zend.pdf.drawing.shape-drawing">
        <title>Shape Drawing.</title>
        <para>
        All drawing operations can be done in a context of PDF page.
        </para>
        <para>
        <code>Zend_Pdf_Page</code> class provides a set of drawing primitives:
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Draw a line from x1,y1 to x2,y2.
 *
 * @param float $x1
 * @param float $y1
 * @param float $x2
 * @param float $y2
 */
public function drawLine($x1, $y1, $x2, $y2);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Draw a rectangle.
 *
 * Fill types:
 * Zend_Pdf_Page::SHAPE_DRAW_FILL_AND_STROKE - fill rectangle and stroke (default)
 * Zend_Pdf_Page::SHAPE_DRAW_STROKE      - stroke rectangle
 * Zend_Pdf_Page::SHAPE_DRAW_FILL        - fill rectangle
 *
 * @param float $x1
 * @param float $y1
 * @param float $x2
 * @param float $y2
 * @param integer $fillType
 */
public function drawRectangle($x1, $y1, $x2, $y2, $fillType = Zend_Pdf_Page::SHAPE_DRAW_FILL_AND_STROKE);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Draw a polygon.
 *
 * If $fillType is Zend_Pdf_Page::SHAPE_DRAW_FILL_AND_STROKE or Zend_Pdf_Page::SHAPE_DRAW_FILL,
 * then polygon is automatically closed.
 * See detailed description of these methods in a PDF documentation
 * (section 4.4.2 Path painting Operators, Filling)
 *
 * @param array $x  - array of float (the X co-ordinates of the vertices)
 * @param array $y  - array of float (the Y co-ordinates of the vertices)
 * @param integer $fillType
 * @param integer $fillMethod
 */
public function drawPolygon($x, $y,
                            $fillType = Zend_Pdf_Page::SHAPE_DRAW_FILL_AND_STROKE,
                            $fillMethod = Zend_Pdf_Page::FILL_METHOD_NON_ZERO_WINDING);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Draw a circle centered on x, y with a radius of radius.
 *
 * Angles are specified in radians
 *
 * Method signatures:
 * drawCircle($x, $y, $radius);
 * drawCircle($x, $y, $radius, $fillType);
 * drawCircle($x, $y, $radius, $startAngle, $endAngle);
 * drawCircle($x, $y, $radius, $startAngle, $endAngle, $fillType);
 *
 *
 * It's not a really circle, because PDF supports only cubic Bezier curves.
 * But very good approximation.
 * It differs from a real circle on a maximum 0.00026 radiuses
 * (at PI/8, 3*PI/8, 5*PI/8, 7*PI/8, 9*PI/8, 11*PI/8, 13*PI/8 and 15*PI/8 angles).
 * At 0, PI/4, PI/2, 3*PI/4, PI, 5*PI/4, 3*PI/2 and 7*PI/4 it's exactly a tangent to a circle.
 *
 * @param float $x
 * @param float $y
 * @param float $radius
 * @param mixed $param4
 * @param mixed $param5
 * @param mixed $param6
 */
public function  drawCircle($x, $y, $radius, $param4 = null, $param5 = null, $param6 = null);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Draw an ellipse inside the specified rectangle.
 *
 * Method signatures:
 * drawEllipse($x1, $y1, $x2, $y2);
 * drawEllipse($x1, $y1, $x2, $y2, $fillType);
 * drawEllipse($x1, $y1, $x2, $y2, $startAngle, $endAngle);
 * drawEllipse($x1, $y1, $x2, $y2, $startAngle, $endAngle, $fillType);
 *
 * Angles are specified in radians
 *
 * @param float $x1
 * @param float $y1
 * @param float $x2
 * @param float $y2
 * @param mixed $param5
 * @param mixed $param6
 * @param mixed $param7
 */
public function drawEllipse($x1, $y1, $x2, $y2, $param5 = null, $param6 = null, $param7 = null);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.pdf.drawing.text-drawing">
        <title>Text Drawing.</title>
        <para>
        Text drawing operations also exist in the context of a PDF page. You can draw a single line of text
        at any position on the page by supplying the x and y coordinates of the baseline. Current font and
        current font size are used for text drawing operations (see detailed description below).
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Draw a line of text at the specified position.
 *
 * @param string $text
 * @param float $x
 * @param float $y
 * @param string $charEncoding (optional) Character encoding of source text.
 *   Defaults to current locale.
 * @throws Zend_Pdf_Exception
 */
public function drawText($text, $x, $y, $charEncoding = '');]]>
        </programlisting>
        <example id="zend.pdf.drawing.text-drawing.example-1">
            <title>Draw a string on the page.</title>
            <programlisting role="php"><![CDATA[<?php
...
$pdfPage->drawText('Hello world!', 72, 720);
...]]>
            </programlisting>
        </example>
        <para>
        By default, text strings are interpreted using the character encoding method of the current locale. If
        you have a string that uses a different encoding method (such as a UTF-8 string read from a file on disk,
        or a MacRoman string obtained from a legacy database), you can indicate the character encoding at draw
        time and Zend_Pdf will handle the conversion for you. You can supply source strings in any encoding
        method supported by PHP's <code><ulink url="http://www.php.net/manual/function.iconv.php">iconv()</ulink></code> function:
        </para>
        <example id="zend.pdf.drawing.text-drawing.example-2">
            <title>Draw a UTF-8-encoded string on the page.</title>
            <programlisting role="php"><![CDATA[<?php
...
// Read a UTF-8-encoded string from disk
$unicodeString = fread($fp, 1024);

// Draw the string on the page
$pdfPage->drawText($unicodeString, 72, 720, 'UTF-8');
...]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.pdf.drawing.using-fonts">
        <title>Using fonts.</title>
        <para>
        <code>Zend_Pdf_Page::drawText()</code> uses the page's current font and font size, which is set with
        the <code>Zend_Pdf_Page::setFont()</code> method:
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Set current font.
 *
 * @param Zend_Pdf_Resource_Font $font
 * @param float $fontSize
 */
public function setFont(Zend_Pdf_Resource_Font $font, $fontSize);]]>
        </programlisting>
        <para>
        PDF documents support PostScript Type 1 and TrueType fonts, as well as two specialized PDF types, Type 3
        and composite fonts. There are also 14 standard Type 1 fonts built-in to every PDF viewer: Courier (4
        styles), Helvetica (4 styles), Times (4 styles), Symbol, and Zapf Dingbats.
        </para>
        <para>
        Zend_Pdf currently supports the standard 14 PDF fonts as well as your own custom TrueType fonts. Font
        objects are obtained via one of two factory methods: <code>Zend_Pdf_Font::fontWithName($fontName)</code>
        for the standard 14 PDF fonts or <code>Zend_Pdf_Font::fontWithPath($filePath)</code> for custom fonts.
        </para>
        <example id="zend.pdf.drawing.using-fonts.example-1">
            <title>Create a standard font.</title>
            <programlisting role="php"><![CDATA[<?php
...
// Create new font
$font = Zend_Pdf_Font::fontWithName(Zend_Pdf_Font::FONT_HELVETICA);

// Apply font
$pdfPage->setFont($font, 36);
...]]>
            </programlisting>
        </example>
        <para>
        Constants for the standard 14 PDF font names are defined in the <code>Zend_Pdf_Font</code> class:
        <itemizedlist>
            <listitem>
                <para>Zend_Pdf_Font::FONT_COURIER</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_COURIER_BOLD</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_COURIER_ITALIC</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_COURIER_BOLD_ITALIC</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_TIMES</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_TIMES_BOLD</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_TIMES_ITALIC</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_TIMES_BOLD_ITALIC</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_HELVETICA</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_HELVETICA_BOLD</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_HELVETICA_ITALIC</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_HELVETICA_BOLD_ITALIC</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_SYMBOL</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Font::FONT_ZAPFDINGBATS</para>
            </listitem>
        </itemizedlist>
        </para>
        <para>
        You can also use any individual TrueType font (which usually has a '.ttf' extension) or an
        OpenType font ('.otf' extension) if it contains TrueType outlines. Currently unsupported,
        but planned for a future release are Mac OS X .dfont files and Microsoft TrueType Collection
        ('.ttc' extension) files.
        </para>
        <para>
        To use a TrueType font, you must provide the full file path to the font program. If the font
        cannot be read for some reason, or if it is not a TrueType font, the factory method will throw
        an exception:
        </para>
        <example id="zend.pdf.drawing.using-fonts.example-2">
            <title>Create a TrueType font.</title>
            <programlisting role="php"><![CDATA[<?php
...
// Create new font
$goodDogCoolFont = Zend_Pdf_Font::fontWithPath('/path/to/GOODDC__.TTF');

// Apply font
$pdfPage->setFont($goodDogCoolFont, 36);
...]]>
            </programlisting>
        </example>
        <para>
        By default, custom fonts will be embedded in the resulting PDF document. This allows recipients
        to view the page as intended, even if they don't have the proper fonts installed on their system.
        If you are concerned about file size, you can request that the font program not be embedded by
        passing a 'do not embed' option to the factory method:
        </para>
        <example id="zend.pdf.drawing.using-fonts.example-3">
            <title>Create a TrueType font, but do not embed it in the PDF document.</title>
            <programlisting role="php"><![CDATA[<?php
...
// Create new font
$goodDogCoolFont = Zend_Pdf_Font::fontWithPath('/path/to/GOODDC__.TTF',
                                               Zend_Pdf_Font::EMBED_DONT_EMBED);

// Apply font
$pdfPage->setFont($goodDogCoolFont, 36);
...]]>
            </programlisting>
        </example>
        <para>
        If the font program is not embedded but the recipient of the PDF file has the font installed on
        their system, they will see the document as intended. If they do not have the correct font
        installed, the PDF viewer application will do its best to synthesize a replacement.
        </para>
        <para>
        Some fonts have very specific licensing rules which prevent them from being embedded in PDF
        documents. So you are not caught off-guard by this, if you try to use a font that cannot be
        embedded, the factory method will throw an exception.
        </para>
        <para>
        You can still use these fonts, but you must either pass the do not embed flag as described above,
        or you can simply suppress the exception:
        </para>
        <example id="zend.pdf.drawing.using-fonts.example-4">
            <title>Do not throw an exception for fonts that cannot be embeded.</title>
            <programlisting role="php"><![CDATA[<?php
...
$font = Zend_Pdf_Font::fontWithPath('/path/to/unEmbeddableFont.ttf',
                                    Zend_Pdf_Font::EMBED_SUPPRESS_EMBED_EXCEPTION);
...]]>
            </programlisting>
        </example>
        <para>
        This suppression technique is preferred if you allow an end-user to choose their own fonts. Fonts
        which can be embedded in the PDF document will be; those that cannot, won't.
        </para>
        <para>
        Font programs can be rather large, some reaching into the tens of megabytes. By default, all embedded
        fonts are compressed using the Flate compression scheme, resulting in a space savings of 50% on average.
        If, for some reason, you do not want to compress the font program, you can disable it with an option:
        </para>
        <example id="zend.pdf.drawing.using-fonts.example-5">
            <title>Do not compress an embedded font.</title>
            <programlisting role="php"><![CDATA[<?php
...
$font = Zend_Pdf_Font::fontWithPath('/path/to/someReallyBigFont.ttf',
                                    Zend_Pdf_Font::EMBED_DONT_COMPRESS);
...]]>
            </programlisting>
        </example>
        <para>
        Finally, when necessary, you can combine the embedding options by using the bitwise OR operator:
        </para>
        <example id="zend.pdf.drawing.using-fonts.example-6">
            <title>Combining font embedding options.</title>
            <programlisting role="php"><![CDATA[<?php
...
$font = Zend_Pdf_Font::fontWithPath($someUserSelectedFontPath,
                                    (Zend_Pdf_Font::EMBED_SUPPRESS_EMBED_EXCEPTION |
                                     Zend_Pdf_Font::EMBED_DONT_COMPRESS));
...]]>
            </programlisting>
        </example>
    </sect2>


    <sect2 id="zend.pdf.drawing.extracting-fonts">
        <title>Starting in 1.5, Extracting fonts.</title>
        <para>
            <code>Zend_Pdf</code> module provides a possibility to extract fonts from loaded documents. 
        </para>

        <para>
            It may be useful for incremental document updates. Without this functionality you have to attach and possibly embed 
            font into a document each time you want to update it. 
        </para>
        
        <para>
            <code>Zend_Pdf</code> and <code>Zend_Pdf_Page</code> objects provide special methods to extract all fonts mentioned within 
            a document or a page:
        </para>
        <example id="zend.pdf.drawing.extracting-fonts.example-1">
            <title>Extracting fonts from a loaded document.</title>
            <programlisting role="php"><![CDATA[<?php
...
$pdf = Zend_Pdf::load($documentPath);
...
// Get all document fonts
$fontList = $pdf->extractFonts();
$pdf->pages[] = ($page = $pdf->newPage(Zend_Pdf_Page::SIZE_A4));
$yPosition = 700;
foreach ($fontList as $font) {
    $page->setFont($font, 15);
    $page->drawText($font->getFontName(Zend_Pdf_Font::NAME_POSTSCRIPT, 'en', 'UTF-8') 
                  . ':  The quick brown fox jumps over the lazy dog', 100, $yPosition, 'UTF-8');
    $yPosition -= 30;
}
...
// Get fonts referenced within the first document page
$firstPage = reset($pdf->pages);
$firstPageFonts = $firstPage->extractFonts();
...]]>
            </programlisting>
        </example>
        <example id="zend.pdf.drawing.extracting-fonts.example-2">
            <title>Extracting font from a loaded document by specifying font name.</title>
            <programlisting role="php"><![CDATA[<?php
...
$pdf = new Zend_Pdf();
...
$pdf->pages[] = ($page = $pdf->newPage(Zend_Pdf_Page::SIZE_A4));

$font = Zend_Pdf_Font::fontWithPath($fontPath);
$page->setFont($font, $fontSize);
$page->drawText($text, $x, $y);
...
// This font name should be stored somewhere...
$fontName = $font->getFontName(Zend_Pdf_Font::NAME_POSTSCRIPT, 'en', 'UTF-8');
...
$pdf->save($docPath);
...]]>
            </programlisting>
            <programlisting role="php"><![CDATA[<?php
...
$pdf = Zend_Pdf::load($docPath);
...
$pdf->pages[] = ($page = $pdf->newPage(Zend_Pdf_Page::SIZE_A4));

$font = $pdf->extractFont($fontName);  /* $srcPage->extractFont($fontName) can also be used here */
$page->setFont($font, $fontSize);
$page->drawText($text, $x, $y);
...
$pdf->save($docPath, true /* incremental update mode */);
...]]>
            </programlisting>
        </example>

        <para>
            Extracted fonts can be used in the place of any other font with the following limitations:
            <itemizedlist>
                <listitem><para>Extracted font can be used only in the context of the document from which it was extracted.</para></listitem>
                <listitem>
                    <para>
                        Possibly embedded font program is actually not extracted. So extracted font can't provide 
                        correct font metrics and original font has to be used for text width calculations: 
            <programlisting role="php"><![CDATA[<?php
...
$font = $pdf->extractFont($fontName);
$originalFont = Zend_Pdf_Font::fontWithPath($fontPath);

$page->setFont($font /* use extracted font for drawing */, $fontSize);
$xPosition = $x;
for ($charIndex = 0; $charIndex < strlen($text); $charIndex++) {
    $page->drawText($text[$charIndex], xPosition, $y);

    // Use original font for text width calculation
    $xPosition += $originalFont->widthForGlyph($originalFont->glyphNumberForCharacter($text[$charIndex]))/$originalFont->getUnitsPerEm()*$fontSize;
}
...]]>
            </programlisting>
                    </para>
                </listitem>
            </itemizedlist> 
        </para>
    </sect2>



    <sect2 id="zend.pdf.drawing.image-drawing">
        <title>Image Drawing.</title>
        <para>
        <code>Zend_Pdf_Page</code> class provides drawImage() method to draw image:
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Draw an image at the specified position on the page.
 *
 * @param Zend_Pdf_Resource_Image $image
 * @param float $x1
 * @param float $y1
 * @param float $x2
 * @param float $y2
 */
public function drawImage(Zend_Pdf_Resource_Image $image, $x1, $y1, $x2, $y2);]]>
        </programlisting>
        <para>
        Image objects should be created with <code>Zend_Pdf_Image::imageWithPath($filePath)</code> method
        (JPG, PNG and TIFF images are supported now):
        </para>
        <example id="zend.pdf.drawing.image-drawing.example-1">
            <title>Image drawing.</title>
            <programlisting role="php"><![CDATA[<?php
...
// load image
$image = Zend_Pdf_Image::imageWithPath('my_image.jpg');

$pdfPage->drawImage($image, 100, 100, 400, 300);
...]]>
            </programlisting>
        </example>

        <para>
            <emphasis>Important! JPEG support requires PHP GD extension to be configured.</emphasis>
            <emphasis>Important! PNG support requires ZLIB extension to be configured to work with Alpha channel images.</emphasis>
        </para>
        <para>
            Refer to the PHP documentation for detailed information
            (<ulink url="http://www.php.net/manual/en/ref.image.php">http://www.php.net/manual/en/ref.image.php</ulink>).
            (<ulink url="http://www.php.net/manual/en/ref.zlib.php">http://www.php.net/manual/en/ref.zlib.php</ulink>).
        </para>
    </sect2>

    <sect2 id="zend.pdf.drawing.line-drawing-style">
        <title>Line drawing style.</title>
        <para>
        Line drawing style is defined by line width, line color and line dashing pattern.
        All of this parameters can be assigned by <code>Zend_Pdf_Page</code>
        class methods:
        </para>
        <programlisting role="php"><![CDATA[<?php
/** Set line color. */
public function setLineColor(Zend_Pdf_Color $color);

/** Set line width. */
public function setLineWidth(float $width);

/**
 * Set line dashing pattern.
 *
 * Pattern is an array of floats: array(on_length, off_length, on_length, off_length, ...)
 * Phase is shift from the beginning of line.
 *
 * @param array $pattern
 * @param array $phase
 */
public function setLineDashingPattern($pattern, $phase = 0);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.pdf.drawing.fill-style">
        <title>Fill style.</title>
        <para>
        <code>Zend_Pdf_Page::drawRectangle()</code>, <code>Zend_Pdf_Page::drawPoligon()</code>,
        <code>Zend_Pdf_Page::drawCircle()</code> and <code>Zend_Pdf_Page::drawEllipse()</code> methods take
        <code>$fillType</code> argument as an optional parameter. It can be:
        </para>

        <itemizedlist>
            <listitem>
                <para>Zend_Pdf_Page::SHAPE_DRAW_STROKE - stroke shape</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Page::SHAPE_DRAW_FILL - only fill shape</para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Page::SHAPE_DRAW_FILL_AND_STROKE - fill and stroke (default behavior)</para>
            </listitem>
        </itemizedlist>

        <para>
        <code>Zend_Pdf_Page::drawPoligon()</code> methods also takes an additional parameter
        <code>$fillMethod</code>:
        </para>
        <itemizedlist>
            <listitem>
                <para>Zend_Pdf_Page::FILL_METHOD_NON_ZERO_WINDING (default behavior)</para>
                <para>
                <citetitle>PDF reference</citetitle> describes this rule as follows:
                <blockquote>
                    <para>
The nonzero winding number rule determines whether a given point is inside a
path by conceptually drawing a ray from that point to infinity in any direction
and then examining the places where a segment of the path crosses the ray. Starting
with a count of 0, the rule adds 1 each time a path segment crosses the ray
from left to right and subtracts 1 each time a segment crosses from right to left.
After counting all the crossings, if the result is 0 then the point is outside the path;
otherwise it is inside.

Note: The method just described does not specify what to do if a path segment coincides
with or is tangent to the chosen ray. Since the direction of the ray is arbitrary,
the rule simply chooses a ray that does not encounter such problem intersections.
For simple convex paths, the nonzero winding number rule defines the inside
and outside as one would intuitively expect. The more interesting cases are those
involving complex or self-intersecting paths like the ones shown in Figure 4.10
(in a PDF Reference).

For a path consisting of a five-pointed star, drawn with five connected straight
line segments intersecting each other, the rule considers the inside to be the entire
area enclosed by the star, including the pentagon in the center. For a path composed
of two concentric circles, the areas enclosed by both circles are considered
to be inside, provided that both are drawn in the same direction. If the circles are
drawn in opposite directions, only the "doughnut" shape between them is inside,
according to the rule; the "doughnut hole" is outside.
                </para>
            </blockquote>
            </para>
            </listitem>
            <listitem>
                <para>Zend_Pdf_Page::FILL_METHOD_EVEN_ODD</para>
                <para>
                <citetitle>PDF reference</citetitle> describes this rule as follows:
                <blockquote>
                    <para>
An alternative to the nonzero winding number rule is the even-odd rule. This rule
determines the "insideness" of a point by drawing a ray from that point in any
direction and simply counting the number of path segments that cross the ray,
regardless of direction. If this number is odd, the point is inside; if even, the point
is outside. This yields the same results as the nonzero winding number rule for
paths with simple shapes, but produces different results for more complex
shapes.

Figure 4.11 (in a PDF Reference) shows the effects of applying the even-odd rule
to complex paths. For the five-pointed star, the rule considers the triangular
points to be inside the path, but not the pentagon in the center. For the two
concentric circles, only the "doughnut" shape between the two circles is considered inside,
regardless of the directions in which the circles are drawn.
                    </para>
                </blockquote>
            </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.pdf.drawing.rotations">
        <title>Rotations.</title>
        <para>
        PDF page can be rotated before applying any draw operation.
        It can be done by <code>Zend_Pdf_Page::rotate()</code> method:
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Rotate the page around ($x, $y) point by specified angle (in radians).
 *
 * @param float $angle
 */
public function rotate($x, $y, $angle);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.pdf.drawing.save-restore">
        <title>Save/restore graphics state.</title>
        <para>
        At any time page graphics state (current font, font size, line color, fill color,
        line style, page rotation, clip area) can be saved and then restored. Save operation puts
        data to a graphics state stack, restore operation retrieves it from there.
        </para>
        <para>
        There are two methods in <code>Zend_Pdf_Page</code> class for these operations:
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Save the graphics state of this page.
 * This takes a snapshot of the currently applied style, position, clipping area and
 * any rotation/translation/scaling that has been applied.
 */
public function saveGS();

/**
 * Restore the graphics state that was saved with the last call to saveGS().
 */
public function restoreGS();]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.pdf.drawing.clipping">
        <title>Clipping draw area.</title>
        <para>
        PDF and Zend_Pdf module support clipping of draw area.
        Current clip area limits the regions of the page affected by painting operators. It's a whole page initially.
        </para>
        <para>
        <code>Zend_Pdf_Page</code> class provides a set of methods for clipping operations.
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Intersect current clipping area with a rectangle.
 *
 * @param float $x1
 * @param float $y1
 * @param float $x2
 * @param float $y2
 */
public function clipRectangle($x1, $y1, $x2, $y2);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Intersect current clipping area with a polygon.
 *
 * @param array $x  - array of float (the X co-ordinates of the vertices)
 * @param array $y  - array of float (the Y co-ordinates of the vertices)
 * @param integer $fillMethod
 */
public function clipPolygon($x, $y, $fillMethod = Zend_Pdf_Page::FILL_METHOD_NON_ZERO_WINDING);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Intersect current clipping area with a circle.
 *
 * @param float $x
 * @param float $y
 * @param float $radius
 * @param float $startAngle
 * @param float $endAngle
 */
public function clipCircle($x, $y, $radius, $startAngle = null, $endAngle = null);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Intersect current clipping area with an ellipse.
 *
 * Method signatures:
 * drawEllipse($x1, $y1, $x2, $y2);
 * drawEllipse($x1, $y1, $x2, $y2, $startAngle, $endAngle);
 *
 * @todo process special cases with $x2-$x1 == 0 or $y2-$y1 == 0
 *
 * @param float $x1
 * @param float $y1
 * @param float $x2
 * @param float $y2
 * @param float $startAngle
 * @param float $endAngle
 */
public function clipEllipse($x1, $y1, $x2, $y2, $startAngle = null, $endAngle = null);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.pdf.drawing.styles">
        <title>Styles.</title>
        <para>
        <code>Zend_Pdf_Style</code> class provides styles functionality.
        </para>
        <para>
        Styles can be used to store a set of graphic state parameters and apply it to a PDF page by one operation:
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Set the style to use for future drawing operations on this page
 *
 * @param Zend_Pdf_Style $style
 */
public function setStyle(Zend_Pdf_Style $style);

/**
 * Return the style, applied to the page.
 *
 * @return Zend_Pdf_Style|null
 */
public function getStyle();]]>
        </programlisting>

        <para>
        <code>Zend_Pdf_Style</code> class provides a set of methods to set or get different graphics state parameters:
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Set line color.
 *
 * @param Zend_Pdf_Color $color
 */
public function setLineColor(Zend_Pdf_Color $color);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get line color.
 *
 * @return Zend_Pdf_Color|null
 */
public function getLineColor();]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Set line width.
 *
 * @param float $width
 */
public function setLineWidth($width);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get line width.
 *
 * @return float
 */
public function getLineWidth();]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Set line dashing pattern
 *
 * @param array $pattern
 * @param float $phase
 */
public function setLineDashingPattern($pattern, $phase = 0);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get line dashing pattern
 *
 * @return array
 */
public function getLineDashingPattern();]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get line dashing phase
 *
 * @return float
 */
public function getLineDashingPhase();]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Set fill color.
 *
 * @param Zend_Pdf_Color $color
 */
public function setFillColor(Zend_Pdf_Color $color);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get fill color.
 *
 * @return Zend_Pdf_Color|null
 */
public function getFillColor();]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Set current font.
 *
 * @param Zend_Pdf_Resource_Font $font
 * @param float $fontSize
 */
public function setFont(Zend_Pdf_Resource_Font $font, $fontSize);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Modify current font size
 *
 * @param float $fontSize
 */
public function setFontSize($fontSize);]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get current font.
 *
 * @return Zend_Pdf_Resource_Font $font
 */
public function getFont();]]>
        </programlisting>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get current font size
 *
 * @return float $fontSize
 */
public function getFontSize();]]>
        </programlisting>
    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.pdf.introduction">
    <!-- @todo review and revise upon completion of refactoring -->
    <title>Introduction.</title>
    <para>
    Zend_Pdf module is a PDF (Portable Document Format) manipulation engine written entirely in PHP 5.
    It can load existing documents, create new, modify and save modified documents.
    Thus it can help any PHP-driven application dynamically prepare documents in a PDF by modifying existing template
    or generating document from a scratch.

    Zend_Pdf module supports the following features:
    <itemizedlist>
        <listitem>
            <para>
            Create new document or load existing one.
            <footnote>
                <para>
                PDF V1.4 (Acrobat 5) documents are supported for loading now.
                </para>
            </footnote>
            </para>
        </listitem>
        <listitem>
            <para>
            Retrieving specified revision of the document.
            </para>
        </listitem>
        <listitem>
            <para>
            Manipulate pages within document. Changing page order, adding new pages, removing pages
            from a document.
            </para>
        </listitem>
        <listitem>
            <para>
            Different drawing primitives (lines, rectangles, polygons, circles, ellipses and sectors).
            </para>
        </listitem>
        <listitem>
            <para>
            Text drawing using any of the 14 standard (built-in) fonts or your own custom TrueType fonts.
            </para>
        </listitem>
        <listitem>
            <para>
            Rotations.
            </para>
        </listitem>
        <listitem>
            <para>
            Image drawing.
            <footnote>
                <para>
                JPG, PNG [Up to 8bit per channel+Alpha] and TIFF images are supported.
                </para>
            </footnote>
            </para>
        </listitem>
        <listitem>
            <para>
            Incremental PDF file update.
            </para>
        </listitem>
    </itemizedlist>
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.pdf.pages">
    <title>Document pages.</title>
    <sect2 id="zend.pdf.pages.creation">
        <title>Page creation.</title>
        <para>
            PDF document page abstraction is represented by <code>Zend_Pdf_Page</code> class.
        </para>

        <para>
            PDF pages either are loaded from existing PDF, or created.
        </para>

        <para>
            New page can be obtained by creating new <code>Zend_Pdf_Page</code> object or calling
            <code>Zend_Pdf::newPage()</code> method, which returns <code>Zend_Pdf_Page</code> object.
            The difference is that <code>Zend_Pdf::newPage()</code> method creates a page, already attached to
            the document. In difference from unattached pages it can't be used with several PDF documents,
            but has a little bit better performance.
            <footnote>
                <para>
                It's a limitation of V1.0 version of Zend_Pdf module. It will be eliminated in future versions.
                But unattached pages will always give better (more optimal) result for sharing pages between documents.
                </para>
            </footnote>. It's your choice, which approach should be used.
        </para>

        <para>
        <code>Zend_Pdf::newPage()</code> method and <code>Zend_Pdf_Page</code> constructors take the same
        set of parameters specifying page size. It either the size of page ($x, $y) in a points (1/72 inch),
        or predefined constant, which is treated as a page type:
            <itemizedlist>
                <listitem>
                    <para>Zend_Pdf_Page::SIZE_A4</para>
                </listitem>
                <listitem>
                    <para>Zend_Pdf_Page::SIZE_A4_LANDSCAPE</para>
                </listitem>
                <listitem>
                    <para>Zend_Pdf_Page::SIZE_LETTER</para>
                </listitem>
                <listitem>
                    <para>Zend_Pdf_Page::SIZE_LETTER_LANDSCAPE</para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            Document pages are stored in <code>$pages</code> public member of <code>Zend_Pdf</code> class.
            It's an array of <code>Zend_Pdf_Page</code> objects. It completely defines set and order of document pages
            and can be manipulated as a common array:
        </para>

        <example id="zend.pdf.pages.example-1">
            <title>PDF document pages management.</title>
            <programlisting role="php"><![CDATA[<?php
    ...
    // Reverse page order
    $pdf->pages = array_reverse($pdf->pages);
    ...
    // Add new page
    $pdf->pages[] = new Zend_Pdf_Page(Zend_Pdf_Page::SIZE_A4);
    // Add new page
    $pdf->pages[] = $pdf->newPage(Zend_Pdf_Page::SIZE_A4);

    // Remove specified page.
    unset($pdf->pages[$id]);

    ...]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.pdf.pages.cloning">
        <title>Page cloning.</title>
        <para>
            Existing PDF page can be cloned by creating new <code>Zend_Pdf_Page</code> object with existing page as a parameter:
        </para>

        <example id="zend.pdf.pages.example-2">
            <title>Cloning existing page.</title>
            <programlisting role="php"><![CDATA[<?php
    ...
    // Store template page in a separate variable
    $template = $pdf->pages[$templatePageIndex];
    ...
    // Add new page
    $page1 = new Zend_Pdf_Page($template);
    $pdf->pages[] = $page1;
    ...

    // Add another page
    $page2 = new Zend_Pdf_Page($template);
    $pdf->pages[] = $page2;
    ...

    // Remove source template page from the documents.
    unset($pdf->pages[$templatePageIndex]);

    ...]]>
            </programlisting>
        </example>

        <para>
            It's useful if you need several pages to be created using one template.
        </para>

        <caution>
            <para>
                Important! Cloned page shares some PDF resources with a template page, so it can be used only withing the same document
                as a template page. Modified document can be saved as new one.
            </para>
        </caution>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.pdf.info">
    <!-- @todo review and revise upon completion of refactoring -->
    <title>Document Info and Metadata.</title>
    <para>
        A PDF document may include general information such as the document’s title,
        author, and creation and modification dates.
    </para>
    <para>
        Historicaly this information is stored using special Info structure. This structure
        is available for read and writing as an associative array using <code>properties</code> public property
        of Zend_Pdf objects:
            <programlisting role="php"><![CDATA[<?php
$pdf = Zend_Pdf::load($pdfPath);

echo $pdf->properties['Title'] . "\n";
echo $pdf->properties['Author'] . "\n";

$pdf->properties['Title'] = 'New Title.';
$pdf->save($pdfPath);
]]>
            </programlisting>

    </para>
    <para>
        The following keys are defined by PDF v1.4 (Acrobat 5) standard:

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis>Title</emphasis> - string, optional, the document’s title.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>Author</emphasis> - string, optional, the name of the person who created the document.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>Subject</emphasis> - string, optional, the subject of the document.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>Keywords</emphasis> - string, optional, keywords associated with the document.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>Creator</emphasis> - string, optional, if the document was converted to PDF from another format,
                    the name of the application (for example, Adobe FrameMaker®) that created the original document from which
                    it was converted.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>Producer</emphasis> - string, optional, if the document was converted to PDF from another format, the
                    name of the application (for example, Acrobat Distiller) that converted it to PDF..
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>CreationDate</emphasis> - string, optional, the date and time the document was created, in the following form:
                    "D:YYYYMMDDHHmmSSOHH'mm'", where:
                    <itemizedlist>
                        <listitem>
                            <para>
                                <emphasis>YYYY</emphasis> is the year.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>MM</emphasis> is the month.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>DD</emphasis> is the day (01–31).
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>HH</emphasis> is the hour (00–23).
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>mm</emphasis>is the minute (00–59).
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>SS</emphasis> is the second (00–59).
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>O</emphasis> is the relationship of local time to Universal Time (UT),
                                denoted by one of the characters +, −, or Z (see below).
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>HH</emphasis> followed by ' is the absolute value of the offset from UT in hours (00–23).
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>mm</emphasis> followed by ' is the absolute value of the offset from UT in minutes (00–59).
                            </para>
                        </listitem>
                    </itemizedlist>
                    The apostrophe character (') after HH and mm is part of the syntax. All fields after
                    the year are optional. (The prefix D:, although also optional, is strongly recommended.)
                    The default values for MM and DD are both 01; all other numerical
                    fields default to zero values. A plus sign (+) as the value of the O field signifies that
                    local time is later than UT, a minus sign (−) that local time is earlier than UT, and
                    the letter Z that local time is equal to UT. If no UT information is specified, the
                    relationship of the specified time to UT is considered to be unknown. Whether or
                    not the time zone is known, the rest of the date should be specified in local time.
                </para>
                <para>
                    For example, December 23, 1998, at 7:52 PM, U.S. Pacific Standard Time, is represented
                    by the string "D:199812231952−08'00'".
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>ModDate</emphasis> - string, optional, the date and time the document was most recently
                    modified, in the same form as <emphasis>CreationDate</emphasis>.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis>Trapped</emphasis> - boolean, optional, indicates whether the document has
                    been modified to include trapping information.
                    <itemizedlist>
                        <listitem>
                            <para>
                                <emphasis>true</emphasis> - The document has been fully trapped; no further trapping is needed.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>false</emphasis> - The document has not yet been trapped; any desired trapping must still be done.
                            </para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis>null</emphasis> - Either it is unknown whether the document has been
                                trapped or it has been partly but not yet fully trapped; some
                                additional trapping may still be needed.
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>
            </listitem>
        </itemizedlist>
    </para>

    <para>
        Since PDF v 1.6 metadata can be stored in the special XML document attached to the PDF
        (XMP - <ulink url="http://www.adobe.com/products/xmp/">Extensible Metadata Platform</ulink>).
    </para>

    <para>
        This XML document can be retrieved and attached to the PDF with <code>Zend_Pdf::getMetadata()</code> and
        <code>Zend_Pdf::setMetadata($metadata)</code> methods:
            <programlisting role="php"><![CDATA[<?php
$pdf = Zend_Pdf::load($pdfPath);
$metadata = $pdf->getMetadata();
$metadataDOM = new DOMDocument();
$metadataDOM->loadXML($metadata);

$xpath = new DOMXPath($metadataDOM);
$pdfPreffixNamespaceURI = $xpath->query('/rdf:RDF/rdf:Description')->item(0)->lookupNamespaceURI('pdf');
$xpath->registerNamespace('pdf', $pdfPreffixNamespaceURI);

$titleNode = $xpath->query('/rdf:RDF/rdf:Description/pdf:Title')->item(0);
$title = $titleNode->nodeValue;
...

$titleNode->nodeValue = 'New title';
$pdf->setMetadata($metadataDOM->saveXML());
$pdf->save($pdfPath);
]]>
            </programlisting>
    </para>

    <para>
        Common document properties are duplicated in the Info structure and Metadata document (if presented).
        It's user application responsibility now to keep them syncronized.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.pdf.save">
    <title>Save changes to the PDF document.</title>
    <para>
    There are two methods, which provide saving changes to the PDF document. These are <code>Zend_Pdf::save()</code> and
    <code>Zend_Pdf::render()</code> methods.
    </para>

    <para>
    <code>Zend_Pdf::save($filename, $updateOnly = false)</code> saves the PDF document to a file. If $updateOnly
    is true, then only the new PDF file segment is appended to a file. Otherwise, the file is overwritten.
    </para>

    <para>
    <code>Zend_Pdf::render($newSegmentOnly = false)</code> returns the PDF document as a string.  If
    $newSegmentOnly is true, then only the new PDF file segment is returned.
    </para>

    <example id="zend.pdf.save.example-1">
        <title>Save PDF document.</title>
        <programlisting role="php"><![CDATA[<?php
...
// Load PDF document.
$pdf = Zend_Pdf::load($fileName);
...
// Update document
$pdf->save($fileName, true);
// Save document as a new file
$pdf->save($newFileName);

// Return PDF document as a string.
$pdfString = $pdf->render();

...]]>
        </programlisting>
    </example>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.pdf.usage">
    <title>Zend_Pdf module usage example.</title>
    <para>
    This section provides an example of module usage.
    </para>

    <para>
    This example can be found in a <filename>demos/Zend/Pdf/demo.php</filename> file.
    </para>
    <para>
    There are also <filename>test.pdf</filename> file, which can be used with this demo
    for test purposes.
    </para>

    <example id="zend.pdf.usage.example-1">
        <title>Zend_Pdf module usage demo.</title>
        <programlisting role="php"><![CDATA[<?php
/**
 * @package Zend_Pdf
 * @subpackage demo
 */

/** Zend_Pdf */
require_once 'Zend/Pdf.php';

if (!isset($argv[1])) {
    echo "USAGE: php demo.php <pdf_file> [<output_pdf_file>]\n";
    exit;
}

try {
    $pdf = Zend_Pdf::load($argv[1]);
} catch (Zend_Pdf_Exception $e) {
    if ($e->getMessage() == 'Can not open \'' . $argv[1] . '\' file for reading.') {
        // Create new PDF if file doesn't exist
        $pdf = new Zend_Pdf();

        if (!isset($argv[2])) {
            // force complete file rewriting (instead of updating)
            $argv[2] = $argv[1];
        }
    } else {
        // Throw an exception if it's not the "Can't open file" exception
        throw $e;
    }
}

//------------------------------------------------------------------------------------
// Reverse page order
$pdf->pages = array_reverse($pdf->pages);

// Create new Style
$style = new Zend_Pdf_Style();
$style->setFillColor(new Zend_Pdf_Color_Rgb(0, 0, 0.9));
$style->setLineColor(new Zend_Pdf_Color_GrayScale(0.2));
$style->setLineWidth(3);
$style->setLineDashingPattern(array(3, 2, 3, 4), 1.6);
$style->setFont(Zend_Pdf_Font::fontWithName(Zend_Pdf_Font::FONT_HELVETICA_BOLD), 32);

// Create new image object
$stampImage = Zend_Pdf_Image::imageWithPath(dirname(__FILE__) . '/stamp.jpg');

// Mark page as modified
foreach ($pdf->pages as $page){
    $page->saveGS();
    $page->setStyle($style);
    $page->rotate(0, 0, M_PI_2/3);

    $page->saveGS();
    $page->clipCircle(550, -10, 50);
    $page->drawImage($stampImage, 500, -60, 600, 40);
    $page->restoreGS();

    $page->drawText('Modified by Zend Framework!', 150, 0);
    $page->restoreGS();
}

// Add new page generated by Zend_Pdf object (page is attached to the specified document)
$pdf->pages[] = ($page1 = $pdf->newPage('A4'));

// Add new page generated by Zend_Pdf_Page object (page is not attached to the document)
$pdf->pages[] = ($page2 = new Zend_Pdf_Page(Zend_Pdf_Page::SIZE_LETTER_LANDSCAPE));

// Create new font
$font = Zend_Pdf_Font::fontWithName(Zend_Pdf_Font::FONT_HELVETICA);

// Apply font and draw text
$page1->setFont($font, 36);
$page1->drawText('Helvetica 36 text string', 60, 500);

// Use font object for another page
$page2->setFont($font, 24);
$page2->drawText('Helvetica 24 text string', 60, 500);

// Use another font
$page2->setFont(Zend_Pdf_Font::fontWithName(Zend_Pdf_Font::FONT_TIMES_ROMAN), 32);
$page2->drawText('Times-Roman 32 text string', 60, 450);

// Draw rectangle
$page2->setFillColor(new Zend_Pdf_Color_GrayScale(0.8));
$page2->setLineColor(new Zend_Pdf_Color_GrayScale(0.2));
$page2->setLineDashingPattern(array(3, 2, 3, 4), 1.6);
$page2->drawRectangle(60, 400, 400, 350);

// Draw circle
$page2->setLineDashingPattern(Zend_Pdf_Page::LINE_DASHING_SOLID);
$page2->setFillColor(new Zend_Pdf_Color_Rgb(1, 0, 0));
$page2->drawCircle(85, 375, 25);

// Draw sectors
$page2->drawCircle(200, 375, 25, 2*M_PI/3, -M_PI/6);
$page2->setFillColor(new Zend_Pdf_Color_Cmyk(1, 0, 0, 0));
$page2->drawCircle(200, 375, 25, M_PI/6, 2*M_PI/3);
$page2->setFillColor(new Zend_Pdf_Color_Rgb(1, 1, 0));
$page2->drawCircle(200, 375, 25, -M_PI/6, M_PI/6);

// Draw ellipse
$page2->setFillColor(new Zend_Pdf_Color_Rgb(1, 0, 0));
$page2->drawEllipse(250, 400, 400, 350);
$page2->setFillColor(new Zend_Pdf_Color_Cmyk(1, 0, 0, 0));
$page2->drawEllipse(250, 400, 400, 350, M_PI/6, 2*M_PI/3);
$page2->setFillColor(new Zend_Pdf_Color_Rgb(1, 1, 0));
$page2->drawEllipse(250, 400, 400, 350, -M_PI/6, M_PI/6);

// Draw and fill polygon
$page2->setFillColor(new Zend_Pdf_Color_Rgb(1, 0, 1));
$x = array();
$y = array();
for ($count = 0; $count < 8; $count++) {
    $x[] = 140 + 25*cos(3*M_PI_4*$count);
    $y[] = 375 + 25*sin(3*M_PI_4*$count);
}
$page2->drawPolygon($x, $y,
                    Zend_Pdf_Page::SHAPE_DRAW_FILL_AND_STROKE,
                    Zend_Pdf_Page::FILL_METHOD_EVEN_ODD);

// Draw line
$page2->setLineWidth(0.5);
$page2->drawLine(60, 375, 400, 375);
//------------------------------------------------------------------------------------

if (isset($argv[2])) {
    $pdf->save($argv[2]);
} else {
    $pdf->save($argv[1], true /* update */);
}]]>
        </programlisting>
    </example>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.registry.using">

    <title>Using the Registry</title>

    <para>
        The registry is a container for storing objects and values in the
        application space.  By storing the value in the registry, the same
        object is always available throughout your application.
        This mechanism is an alternative to using global storage.
    </para>

    <para>
        The typical usage of the registry is through static methods in the
        Zend_Registry class.  Alternatively, the class is an array object,
        so you can access elements stored within it with a convenient
        array-like interface.
    </para>

    <sect2 id="zend.registry.using.storing">

        <title>Setting Values in the Registry</title>

        <para>
            To store an entry in the registry, use the static method
            <code>set()</code>.
        </para>

        <example id="zend.registry.using.storing.example">
            <title>Example of set() method</title>
            <programlisting role="php"><![CDATA[<?php
Zend_Registry::set('index', $value);]]>
            </programlisting>
        </example>

        <para>
            The value can be an object, an array, or a scalar.
            You can change the value stored in a specific entry of
            the registry by using <code>set()</code> to set it
            to a new value.
        </para>

        <para>
            The index can be a scalar, either string or integer,
            like an ordinary array.
        </para>

    </sect2>

    <sect2 id="zend.registry.using.retrieving">

        <title>Getting Values from the Registry</title>

        <para>
            To retrieve an entry from the registry, use the static method
            <code>get()</code>.
        </para>

        <example id="zend.registry.using.retrieving.example">
            <title>Example of get() method</title>
            <programlisting role="php"><![CDATA[<?php
$value = Zend_Registry::get('index');]]>
            </programlisting>
        </example>

        <para>
            The <code>getInstance()</code> method returns the static registry object.
        </para>

        <para>
            A registry object is iterable.
        </para>

        <example id="zend.registry.using.retrieving.example-iterating">
            <title>Example of iterating over the registry</title>
            <programlisting role="php"><![CDATA[<?php
$registry = Zend_Registry::getInstance();

foreach ($registry as $index => $value) {
    echo "Registry index $index contains:\n";
    var_dump($value);
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.registry.using.constructing">

        <title>Constructing a Registry Object</title>

        <para>
            In addition to accessing the static registry through
            static methods, you can create an instance directly and
            use it as an object.
        </para>

        <para>
            The registry instance you access through the
            static methods is simply one such instance, and it is
            for convenience that it is stored statically, so you
            can access it from anywhere in your appliation.
        </para>

        <para>
            Use a traditional <code>new</code> constructor to create
            an instance of the registry.  This gives you the opportunity
            to initialize the entries in the registry as an associatve
            array.
        </para>

        <example id="zend.registry.using.constructing.example">
            <title>Example of constructing a registry</title>
            <programlisting role="php"><![CDATA[<?php
$registry = new Zend_Registry(array('index' => $value));]]>
            </programlisting>
        </example>

        <para>
            After constructing this instance, you can use it using
            array-object methods, or you can set this instance
            to become the static instance using the static method
            <code>setInstance()</code>.
        </para>

        <example id="zend.registry.using.constructing.example-setinstance">
            <title>Example of initializing the static registry</title>
            <programlisting role="php"><![CDATA[<?php
$registry = new Zend_Registry(array('index' => $value));

Zend_Registry::setInstance($registry);]]>
            </programlisting>
        </example>

        <para>
            The <code>setInstance()</code> method throws a Zend_Exception
            if the static registry has already been initialized by its
            first access.
        </para>

    </sect2>

    <sect2 id="zend.registry.using.array-access">

        <title>Accessing the Registry as an Array</title>

        <para>
            If you have several values to get or set, you may find it
            convenient to access the registry with array notation.
        </para>

        <example id="zend.registry.using.array-access.example">
            <title>Example of array access</title>
            <programlisting role="php"><![CDATA[<?php
$registry = Zend_Registry::getInstance();

$registry['index'] = $value;

var_dump( $registry['index'] );]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.registry.using.array-object">

        <title>Accessing the Registry as an Object</title>

        <para>
            You may also find it convenient to access the registry
            in an object-oriented fashion, using index names as object
            properties.
            To do this, you need to specifically construct the registry
            object using the <code>ArrayObject::ARRAY_AS_PROPS</code> option,
            and initialize the static instance.  You must do this before
            the static registry has been accessed for the first time.
            <emphasis role="strong">Beware</emphasis> of using this option,
            since some versions of PHP have bugs when using the registry
            with this option.
        </para>

        <example id="zend.registry.using.array-object.example">
            <title>Example of object access</title>
            <programlisting role="php"><![CDATA[<?php
// in your application bootstrap:
$registry = new Zend_Registry(array(), ArrayObject::ARRAY_AS_PROPS)
Zend_Registry::setInstance($registry);
$registry->tree = 'apple';

.
.
.

// in a different function, elsewhere in your application:
$registry = Zend_Registry::getInstance();

echo $registry->tree; // echo's "apple"

$registry->index = $value;

var_dump($registry->index);]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.registry.using.isset">

        <title>Querying if an index exists</title>

        <para>
            To find out if a particular index in the registry
            has a value, use the static method <code>isRegistered()</code>.
        </para>

        <example id="zend.registry.using.isset.example-isregistered">
            <title>Example of isRegistered() method</title>
            <programlisting role="php"><![CDATA[<?php
if (Zend_Registry::isRegistered($index)) {
    $value = Zend_Registry::get($index);
}]]>
            </programlisting>
        </example>

        <para>
            To find out if a particular index in a registry
            array-object has a value, use <code>isset()</code>
            like you would with an ordinary array.
        </para>

        <example id="zend.registry.using.isset.example-isset">
            <title>Example of isset() method</title>
            <programlisting role="php"><![CDATA[<?php
$registry = Zend_Registry::getInstance();

// using array-access syntax
if (isset($registry['index'])) {
    var_dump( $registry['index'] );
}

// using object-access syntax, if enabled
if (isset($registry->index)) {
    var_dump( $registry->index );
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.registry.using.subclassing">

        <title>Extending the Registry</title>

        <para>
            The static registry is an instance of the class Zend_Registry.
            If you want to add functionality to the registry, you can
            create a class that extends Zend_Registry, and then you can
            specify this class as the class to use for the static registry.
            Use the static method <code>setClassName()</code> to specify
            the class.  The class must extend Zend_Registry.
        </para>

        <example id="zend.registry.using.subclassing.example">
            <title>Example of specifying the static registry's class name</title>
            <programlisting role="php"><![CDATA[<?php
Zend_Registry::setClassName('My_Registry');

Zend_Registry::set('index', $value);]]>
            </programlisting>
        </example>

        <para>
            The registry throws a Zend_Exception if you try to set the
            classname after the registry has been accessed for the first time.
            It is recommended that you specify the classname for your
            static registry in your application bootstrap.
        </para>

    </sect2>

    <sect2 id="zend.registry.using.unsetting">

        <title>Unsetting the Static Registry</title>

        <para>
            Although it is not normally necessary, you can
            unset the static instance of the registry.
            Use the static method <code>_unsetInstance()</code>.
        </para>

        <note>
            <title>Data loss risk</title>
            <para>
                When you use <code>_unsetInstance()</code>,
                all data in the static registry are
                discarded and cannot be recovered.
            </para>
        </note>

        <para>
            You might use this method, for example, if you want to
            use <code>setInstance()</code> or <code>setClassName()</code>
            after the static registry object has been initialized.
            Unsetting the static instance allows you to use these methods.
        </para>

        <example id="zend.registry.using.unsetting.example">
            <title>Example of _unsetInstance() method</title>
            <programlisting role="php"><![CDATA[<?php
Zend_Registry::set('index', $value);

Zend_Registry::_unsetInstance();

// change the class
Zend_Registry::setClassName('My_Registry');

Zend_Registry::set('index', $value);]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.rest.introduction">
    <title>Introduction</title>

    <para>
        REST Web Services use service-specific XML formats. These ad-hoc
        standards mean that the manner for accessing a REST web service is
        different for each service. REST web services typically use URL
        parameters (GET data) or path information for requesting data and POST
        data for sending data.
    </para>

    <para>
        The Zend Framework provides both Client and Server capabilities, which,
        when used together allow for a much more "local" interface experience
        via virtual object property access.  The Server component features
        automatic exposition of functions and classes using a meaningful and
        simple XML format. When accessing these services using the Client, it is
        possible to easily retrieve the return data from the remote call. Should
        you wish to use the client with a non-Zend_Rest_Server based service, it
        will still provide easier data access.
    </para>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.rest.client">
    <title>Zend_Rest_Client</title>
    <sect2 id="zend.rest.client.introduction">
        <title>Introduction</title>
        <para>
            Using the <code>Zend_Rest_Client</code> is very similar to using
            <code>SoapClient</code> objects (<ulink
            url="http://www.php.net/soap">SOAP web service extension</ulink>).
            You can simply call the REST service procedures as
            <code>Zend_Rest_Client</code> methods.  Specify the service's full
            address in the <code>Zend_Rest_Client</code> constructor.
        </para>

        <example id="zend.rest.client.introduction.example-1">
            <title>A basic REST request</title>

            <programlisting role="php"><![CDATA[<?php
/**
 * Connect to framework.zend.com server and retrieve a greeting
 */
require_once 'Zend/Rest/Client.php';

$client = new Zend_Rest_Client('http://framework.zend.com/rest');

echo $client->sayHello('Davey', 'Day')->get(); // "Hello Davey, Good Day"]]>
            </programlisting>
        </example>

        <note>
            <title>Differences in calling</title>
            <para>
                <code>Zend_Rest_Client</code> attempts to make remote methods
                look as much like native methods as possible, the only
                difference being that you must follow the method call with one
                of either <code>get()</code>, <code>post()</code>,
                <code>put()</code> or <code>delete()</code>. This call may be
                made via method chaining or in separate method calls:
            </para>

            <programlisting role="php"><![CDATA[<?php
$client->sayHello('Davey', 'Day');
echo $client->get();]]>
            </programlisting>
        </note>
    </sect2>

    <sect2 id="zend.rest.client.return">
        <title>Responses</title>

        <para>
            All requests made using <code>Zend_Rest_Client</code> return a
            <code>Zend_Rest_Client_Response</code> object. This object has many
            properties that make it easier to access the results.
        </para>

        <para>
            When the service is based on <code>Zend_Rest_Server</code>,
            <code>Zend_Rest_Client</code> can make several assumptions about the
            response, including response status (success or failure) and return
            type.
        </para>

        <example id="zend.rest.client.return.example-1">
            <title>Response Status</title>
            <programlisting role="php"><![CDATA[<?php
$result = $client->sayHello('Davey', 'Day')->get();

if ($result->isSuccess()) {
    echo $result; // "Hello Davey, Good Day"
}]]>
            </programlisting>
        </example>

        <para>
            In the example above, you can see that we use the request result as
            an object, to call <code>isSuccess()</code>, and then because of
            <code>__toString()</code>, we can simply <code>echo</code> the
            object to get the result. <code>Zend_Rest_Client_Response</code>
            will allow you to echo any scalar value. For complex types, you can
            use either array or object notation.
        </para>

        <para>
            If however, you wish to query a service not using
            <code>Zend_Rest_Server</code> the
            <code>Zend_Rest_Client_Response</code> object will behave more like
            a <code>SimpleXMLElement</code>. However, to make things easier, it
            will automatically query the XML using XPath if the property is not
            a direct descendant of the document root element. Additionally, if
            you access a property as a method, you will receive the PHP value
            for the object, or an array of PHP value results.
        </para>

        <example id="zend.rest.client.return.example-2">
            <title>Using Technorati's Rest Service</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Rest/Client.php';

$technorati = new Zend_Rest_Client('http://api.technorati.com/bloginfo');
$technorati->key($key);
$technorati->url('http://pixelated-dreams.com');
$result = $technorati->get();
echo $result->firstname() .' '. $result->lastname();]]>
            </programlisting>
        </example>

        <example id="zend.rest.client.return.example-3">
            <title>Example Technorati Response</title>
            <programlisting role="xml"><![CDATA[<?xml version="1.0" encoding="utf-8"?>
<!-- generator="Technorati API version 1.0 /bloginfo" -->
<!DOCTYPE tapi PUBLIC "-//Technorati, Inc.//DTD TAPI 0.02//EN" "http://api.technorati.com/dtd/tapi-002.xml">
<tapi version="1.0">
    <document>
        <result>
            <url>http://pixelated-dreams.com</url>
            <weblog>
                <name>Pixelated Dreams</name>
                <url>http://pixelated-dreams.com</url>
                <author>
                    <username>DShafik</username>
                    <firstname>Davey</firstname>
                    <lastname>Shafik</lastname>
                </author>
                <rssurl>http://pixelated-dreams.com/feeds/index.rss2</rssurl>
                <atomurl>http://pixelated-dreams.com/feeds/atom.xml</atomurl>
                <inboundblogs>44</inboundblogs>
                <inboundlinks>218</inboundlinks>
                <lastupdate>2006-04-26 04:36:36 GMT</lastupdate>
                <rank>60635</rank>
            </weblog>
            <inboundblogs>44</inboundblogs>
            <inboundlinks>218</inboundlinks>
        </result>
    </document>
</tapi>]]>
            </programlisting>
        </example>

        <para>
            Here we are accessing the <code>firstname</code> and
            <code>lastname</code> properties. Even though these are not
            top-level elements, they are automatically returned when accessed by
            name.
        </para>

        <note>
            <title>Multiple items</title>

            <para>
                If multiple items are found when accessing a value by name, an
                array of SimpleXMLElements will be returned; accessing via
                method notation will return an array of PHP values.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.rest.client.args">
        <title>Request Arguments</title>

        <para>
            Unless you are making a request to a <code>Zend_Rest_Server</code>
            based service, chances are you will need to send multiple arguments
            with your request. This is done by calling a method with the name of
            the argument, passing in the value as the first (and only) argument.
            Each of these method calls returns the object itself, allowing for
            chaining, or "fluent" usage. The first call, or the first argument
            if you pass in more than one argument, is always assumed to be the
            method when calling a <code>Zend_Rest_Server</code> service.
        </para>

        <example id="zend.rest.client.args.example-1">
            <title>Setting Request Arguments</title>

            <programlisting role="php"><![CDATA[<?php
$client = new Zend_Rest_Client('http://example.org/rest');

$client->arg('value1');
$client->arg2('value2');
$client->get();

// or

$client->arg('value1')->arg2('value2')->get();]]>
            </programlisting>
        </example>

        <para>
            Both of the methods in the example above, will result in the
            following get args:
            <code>?method=arg&amp;arg1=value1&amp;arg=value1&amp;arg2=value2</code>
        </para>

        <para>
            You will notice that the first call of
            <code>$client->arg('value1');</code> resulted in both
            <code>method=arg&amp;arg1=value1</code> and <code>arg=value1</code>;
            this is so that <code>Zend_Rest_Server</code> can understand the
            request properly, rather than requiring pre-existing knowledge of
            the service.
        </para>

        <warning>
            <title>Strictness of Zend_Rest_Client</title>

            <para>
                Any REST service that is strict about the arguments it receives will likely fail
                using <code>Zend_Rest_Client</code>, because of the behavior described
                above. This is not a common practice and should not cause problems.
            </para>
        </warning>
    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.rest.server">
    <title>Zend_Rest_Server</title>

    <sect2 id="zend.rest.server.introduction">
        <title>Introduction</title>

        <para>
            Zend_Rest_Server is intended as a fully-featured REST server.
        </para>
    </sect2>

    <sect2 id="zend.rest.server.usage">
        <title>REST Server Usage</title>

        <example id="zend.rest.server.usage.example-1">
            <title>Basic Zend_Rest_Server Usage - Classes</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Rest/Server.php';
require_once 'My/Service/Class.php';

$server = new Zend_Rest_Server();
$server->setClass('My_Service_Class');
$server->handle();]]>
            </programlisting>
        </example>

        <example id="zend.rest.server.usage.example-2">
            <title>Basic Zend_Rest_Server Usage - Functions</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Rest/Server.php';

/**
 * Say Hello
 *
 * @param string $who
 * @param string $when
 * @return string
 */
function sayHello($who, $when)
{
    return "Hello $who, Good $when";
}

$server = new Zend_Rest_Server();
$server->addFunction('sayHello');
$server->handle();]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.rest.server.args">
        <title>Calling a Zend_Rest_Server Service</title>

        <para>
            To call a <code>Zend_Rest_Server</code> service, you must supply a
            GET/POST <code>method</code> argument with a value that is the
            method you wish to call. You can then follow that up with any number
            of arguments using either the name of the argument (i.e. "who") or
            using <code>arg</code> following by the numeric position of the
            argument (i.e. "arg1").
        </para>

        <note>
            <title>Numeric index</title>
            <para>
                Numeric arguments use a 1-based index.
            </para>
        </note>

        <para>
            To call <code>sayHello</code> from the example above, you can use either:
        </para>

        <para>
            <code>?method=sayHello&amp;who=Davey&amp;when=Day</code>
        </para>

        <para>
            or:
        </para>

        <para>
            <code>?method=sayHello&amp;arg1=Davey&amp;arg2=Day</code>
        </para>
    </sect2>

    <sect2 id="zend.rest.server.customstatus">
        <title>Sending A Custom Status</title>

        <para>
            When returning values, to return a custom status, you may return an
            array with a <code>status</code> key.
        </para>

        <example id="zend.rest.server.customstatus.example-1">
            <title>Returning Custom Status</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Rest/Server.php';

/**
 * Say Hello
 *
 * @param string $who
 * @param string $when
 * @return array
 */
function sayHello($who, $when)
{
    return array('msg' => "An Error Occurred", 'status' => false);
}

$server = new Zend_Rest_Server();
$server->addFunction('sayHello');
$server->handle();]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.rest.server.customxml">
        <title>Returning Custom XML Responses</title>

        <para>
            If you wish to return custom XML, simply return a
            <code>DOMDocument</code>, <code>DOMElement</code> or
            <code>SimpleXMLElement</code> object.
        </para>

        <example id="zend.rest.server.customxml.example-1">
            <title>Return Custom XML</title>

            <programlisting><![CDATA[<?php
require_once 'Zend/Rest/Server.php';

/**
 * Say Hello
 *
 * @param string $who
 * @param string $when
 * @return SimpleXMLElement
 */
function sayHello($who, $when)
{
    $xml ='<?xml version="1.0" encoding="ISO-8859-1"?>
<mysite>
    <value>Hey $who! Hope you're having a good $when</value>
    <code>200</code>
</mysite>';

    $xml = simplexml_load_string($xml);
    return $xml;
}

$server = new Zend_Rest_Server();
$server->addFunction('sayHello');

$server->handle();]]>
            </programlisting>
        </example>

        <para>
            The response from the service will be returned without modification
            to the client.
        </para>
    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.search.lucene.advanced">
    <title>Advanced</title>

    <sect2 id="zend.search.lucene.advanced.static">
        <title>Using the index as static property</title>

        <para>
            The <code>Zend_Search_Lucene</code> object uses the destructor method to commit changes and clean up resources.
        </para>

        <para>
            It stores added documents in memory and dumps new index segment to disk depending on <code>MaxBufferedDocs</code> parameter.
        </para>

        <para>
            If <code>MaxBufferedDocs</code> limit is not reached then there are some "unsaved" documents which are saved as a new segment in the object's destructor method.
            The index auto-optimization procedure is invoked if necessary depending on the values of the <code>MaxBufferedDocs</code>, <code>MaxMergeDocs</code> and
            <code>MergeFactor</code> parameters.
        </para>

        <para>
            Static object properties (see below) are destroyed <emphasis>after</emphasis> the last line of the executed script.

            <programlisting role="php"><![CDATA[<?php
class Searcher {
    private static $_index;

    public static function initIndex() {
        self::$_index = Zend_Search_Lucene::open('path/to/index');
    }
}

Searcher::initIndex();]]>
            </programlisting>
        </para>


        <para>
            All the same, the destructor for static properties is correctly invoked at this point in the program's execution.
        </para>

        <para>
            One potential problem is exception handling. Exceptions thrown by destructors of static objects don't have context, because the destructor is executed after the script has already completed.
        </para>

        <para>
            You might see a "Fatal error: Exception thrown without a stack frame in Unknown on line 0" error message instead of exception description in such cases.
        </para>

        <para>
            Zend_Search_Lucene provides a workaround to this problem with the <code>commit()</code> method. It saves all unsaved changes and frees memory used for storing new segments.
            You are free to use the commit operation any time- or even several times- during script execution. You can still use the <code>Zend_Search_Lucene</code> object for searching,
            adding or deleting document after the commit operation. But the <code>commit()</code> call guarantees that if there are no document added or deleted after the call to <code>commit()</code>, then
            the <code>Zend_Search_Lucene</code> destructor has nothing to do and will not throw exception:

            <programlisting role="php"><![CDATA[<?php
class Searcher {
    private static $_index;

    public static function initIndex() {
        self::$_index = Zend_Search_Lucene::open('path/to/index');
    }

    ...

    public static function commit() {
        self::$_index->commit();
    }
}

Searcher::initIndex();

...

// Script shutdown routine
...
Searcher::commit();
...]]>
            </programlisting>
        </para>
    </sect2>

</sect1>
<sect1 id="zend.search.lucene.best-practice">
    <title>Best Practices</title>

    <sect2 id="zend.search.lucene.best-practice.field-names">
        <title>Field names</title>

        <para>
            There are no limitations for field names in Zend_Search_Lucene.
        </para>

        <para>
            Nevertheless it's a good idea not to use '<emphasis>id</emphasis>' and '<emphasis>score</emphasis>' names
            to avoid ambiguity in <code>QueryHit</code> properties names.
        </para>

        <para>
            The <code>Zend_Search_Lucene_Search_QueryHit</code> <code>id</code> and <code>score</code> properties always refer
            to internal Lucene document id and hit <link linkend="zend.search.lucene.searching.results-scoring">score</link>.
            If the indexed document has the same stored fields, you have to use the <code>getDocument()</code> method to access them:

            <programlisting role="php"><![CDATA[<?php
$hits = $index->find($query);

foreach ($hits as $hit) {
    // Get 'title' document field
    $title = $hit->title;

    // Get 'contents' document field
    $contents = $hit->contents;


    // Get internal Lucene document id
    $id = $hit->id;

    // Get query hit score
    $score = $hit->score;


    // Get 'id' document field
    $docId = $hit->getDocument()->id;

    // Get 'score' document field
    $docId = $hit->getDocument()->score;

    // Another way to get 'title' document field
    $title = $hit->getDocument()->title;
}]]>
            </programlisting>
        </para>
    </sect2>


    <sect2 id="zend.search.lucene.best-practice.indexing-performance">
        <title>Indexing performance</title>

        <para>
            Indexing performance is a compromise between used resources, indexing time and index quality.
        </para>

        <para>
            Index quality is completely determined by number of index segments.
        </para>

        <para>
            Each index segment is entirely independent portion of data. So indexes containing more segments need
            more memory and time for searching.
        </para>

        <para>
            Index optimization is a process of merging several segments into a new one. A fully optimized index contains
            only one segment.
        </para>

        <para>
            Full index optimization may be performed with the <code>optimize()</code> method:
            <programlisting role="php"><![CDATA[<?php
$index = Zend_Search_Lucene::open($indexPath);

$index->optimize();]]>
            </programlisting>
        </para>

        <para>
            Index optimization works with data streams and doesn't take a lot of memory but does require processor resources and time.
        </para>

        <para>
            Lucene index segments are not updatable by their nature (the update operation requires the segment file
            to be completely rewritten). So adding new document(s) to an index always generates a new segment.
            This, in turn, decreases index quality.
        </para>

        <para>
            An index auto-optimization process is performed after each segment generation and consists of merging partial segments.
        </para>

        <para>
            There are three options to control the behavior of auto-optimization
            (see <link linkend="zend.search.lucene.index-creation.optimization">Index optimization</link> section):
            <itemizedlist>
                <listitem>
                    <para><emphasis>MaxBufferedDocs</emphasis> is the number of documents that can be buffered in memory before a new segment is generated
                          and written to the hard drive.</para>
                </listitem>
                <listitem>
                    <para><emphasis>MaxMergeDocs</emphasis> is the maximum number of documents merged by auto-optimization process
                          into a new segment.</para>
                </listitem>
                <listitem>
                    <para><emphasis>MergeFactor</emphasis> determines how often auto-optimization is performed.</para>
                </listitem>
            </itemizedlist>
            <note>
                <para>
                    All these options are Zend_Search_Lucene object properties- not index properties. They affect only current
                    <code>Zend_Search_Lucene</code> object behavior and may vary for different scripts.
                </para>
            </note>
        </para>

        <para>
            <emphasis>MaxBufferedDocs</emphasis> doesn't have any effect if you index only one document per script execution. On the other hand, it's very important
            for batch indexing. Greater values increase indexing performance, but also require more memory.
        </para>

        <para>
            There is simply no way to calculate the best value for the <emphasis>MaxBufferedDocs</emphasis> parameter because it depends on average document size, the
            analyzer in use and allowed memory.
        </para>

        <para>
            A good way to find the right value is to perform several tests with the largest document you expect to be added to the index
            <footnote><para><code>memory_get_usage()</code> and <code>memory_get_peak_usage()</code> may be used to control
            memory usage.</para></footnote>. It's a best practice not to use more than a half of the allowed memory.
        </para>


        <para>
            <emphasis>MaxMergeDocs</emphasis> limits the segment size (in terms of documents). It therefore also limits auto-optimization time by guaranteeing
            that the <code>addDocument()</code> method is not executed more than a certain number of times. This is very important for interactive applications.
        </para>

        <para>
            Lowering the <emphasis>MaxMergeDocs</emphasis> parameter also may improve batch indexing performance. Index auto-optimization is an iterative process
            and is performed from bottom up. Small segments are merged into larger segment, which are in turn merged into even larger segments and
            so on. Full index optimization is achieved when only one large segment file remains.
        </para>

        <para>
            Small segments generally decrease index quality. Many small segments may also trigger
            the "Too many open files" error determined by OS limitations <footnote><para>Zend_Search_Lucene keeps each segment file opened
            to improve search performance.</para></footnote>.
        </para>

        <para>
            in general, background index optimization should be performed for interactive indexing mode and <emphasis>MaxMergeDocs</emphasis> shouldn't be
            too low for batch indexing.
        </para>


        <para>
            <emphasis>MergeFactor</emphasis> affects auto-optimization frequency. Lower values increase the quality of unoptimized indexes. Larger values increase
            indexing performance, but also increase the number of merged segments. This again may trigger the "Too many open files" error.
        </para>

        <para>
            <emphasis>MergeFactor</emphasis> groups index segments by their size:
            <orderedlist>
                <listitem><para>Not greater than <emphasis>MaxBufferedDocs</emphasis>.</para></listitem>
                <listitem><para>Greater than <emphasis>MaxBufferedDocs</emphasis>, but not greater than
                                <emphasis>MaxBufferedDocs</emphasis>*<emphasis>MergeFactor</emphasis>.</para></listitem>
                <listitem><para>Greater than <emphasis>MaxBufferedDocs</emphasis>*<emphasis>MergeFactor</emphasis>, but not greater than
                <emphasis>MaxBufferedDocs</emphasis>*<emphasis>MergeFactor</emphasis>*<emphasis>MergeFactor</emphasis>.</para></listitem>
                <listitem><para>...</para></listitem>
            </orderedlist>
        </para>

        <para>
            Zend_Search_Lucene checks during each <code>addDocument()</code> call to see if merging any segments may move the newly created segment
            into the next group. If yes, then merging is performed.
        </para>

        <para>
            So an index with N groups may contain <emphasis>MaxBufferedDocs</emphasis> + (N-1)*<emphasis>MergeFactor</emphasis> segments and contains at least
            <emphasis>MaxBufferedDocs</emphasis>*<emphasis>MergeFactor</emphasis><superscript>(N-1)</superscript> documents.
        </para>

        <para>
            This gives good approximation for the number of segments in the index:
        </para>
        <para>
            <emphasis>NumberOfSegments</emphasis>  &lt;= <emphasis>MaxBufferedDocs</emphasis> + <emphasis>MergeFactor</emphasis>*log
            <subscript><emphasis>MergeFactor</emphasis></subscript> (<emphasis>NumberOfDocuments</emphasis>/<emphasis>MaxBufferedDocs</emphasis>)
        </para>

        <para>
            <emphasis>MaxBufferedDocs</emphasis> is determined by allowed memory. This allows for the appropriate merge factor to get a reasonable
            number of segments.
        </para>


        <para>
            Tuning the <emphasis>MergeFactor</emphasis> parameter is more effective for batch indexing performance than <emphasis>MaxMergeDocs</emphasis>. But it's also more course-grained.
            So use the estimation above for tuning <emphasis>MergeFactor</emphasis>, then play with <emphasis>MaxMergeDocs</emphasis> to get best batch indexing performance.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.best-practice.shutting-down">
        <title>Index during Shut Down</title>

        <para>
            The <code>Zend_Search_Lucene</code> instance performs some work at exit time if any documents were added to the index but not written to a new segment.
        </para>

        <para>
            It also may trigger an auto-optimization process.
        </para>

        <para>
            The index object is automatically closed when it, and all returned QueryHit objects, go out of scope.
        </para>

        <para>
            If index object is stored in global variable than it's closed only at the end of script execution<footnote><para>This also
            may occur if the index or QueryHit instances are referred to in some cyclical data structures, because PHP garbage collects objects
            with cyclic references only at the end of script execution.</para></footnote>.
        </para>

        <para>
            PHP exception processing is also shut down at this moment.
        </para>

        <para>
            It doesn't prevent normal index shutdown process, but may prevent accurate error diagnostic if any error occurs during shutdown.
        </para>

        <para>
            There are two ways with which you may avoid this problem.
        </para>

        <para>
            The first is to force going out of scope:
            <programlisting role="php"><![CDATA[<?php
$index = Zend_Search_Lucene::open($indexPath);

...

unset($index);]]>
            </programlisting>
        </para>

        <para>
            And the second is to perform a commit operation before the end of script execution:
            <programlisting role="php"><![CDATA[<?php
$index = Zend_Search_Lucene::open($indexPath);

$index->commit();]]>
            </programlisting>
            This possibility is also described in the "<link linkend="zend.search.lucene.advanced.static">Advanced. Using index as static property</link>"
            section.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.best-practice.unique-id">
        <title>Retrieving documents by unique id</title>

        <para>
            It's a common practice to store some unique document id in the index. Examples include url, path, or database id.
        </para>

        <para>
            <code>Zend_Search_Lucene</code> provides a <code>termDocs()</code> method for retrieving documents containing specified terms.
        </para>

        <para>
            This is more efficient than using the <code>find()</code> method:
            <programlisting role="php"><![CDATA[<?php
// Retrieving documents with find() method using a query string
$query = $idFieldName . ':' . $docId;
$hits  = $index->find($query);
foreach ($hits as $hit) {
    $title    = $hit->title;
    $contents = $hit->contents;
    ...
}
...

// Retrieving documents with find() method using the query API
$term = new Zend_Search_Lucene_Index_Term($docId, idFieldName);
$query = new Zend_Search_Lucene_Search_Query_Term($term);
$hits  = $index->find($query);
foreach ($hits as $hit) {
    $title    = $hit->title;
    $contents = $hit->contents;
    ...
}

...

// Retrieving documents with termDocs() method
$term = new Zend_Search_Lucene_Index_Term($docId, idFieldName);
$docIds  = $index->termDocs($term);
foreach ($docIds as $id) {
    $doc = $index->getDocument($id);
    $title    = $doc->title;
    $contents = $doc->contents;
    ...
}]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.best-practice.memory-usage">
        <title>Memory Usage</title>

        <para>
            Zend_Search_Lucene is a relatively memory-intensive module.
        </para>

        <para>
            It uses memory to cache some information and optimize searching and indexing performance.
        </para>

        <para>
            The memory required differs for different modes.
        </para>

        <para>
            The terms dictionary index is loaded during the search. It's actually each 128<superscript>th</superscript>
            <footnote><para>The Lucene file format allows you to configure this number, but Zend_Search_Lucene doesn't expose this
            in its API. Nevertheless you still have the ability to configure this value if the index is prepared with another
            Lucene implementation.</para></footnote> term of the full dictionary.
        </para>

        <para>
            Thus memory usage is increased if you have a high number of unique terms. This may happen if you use untokenized phrases as a field values
            or index a large volume of non-text information.
        </para>

        <para>
            An unoptimized index consists of several segments. It also increases memory usage. Segments are independent, so each segment contains
            its own terms dictionary and terms dictionary index. If an index consists of <emphasis>N</emphasis> segments it may increase memory
            usage by <emphasis>N</emphasis> times in worst case. Perform index optimization to merge all segments into one to avoid such memory consumption.
        </para>

        <para>
            Indexing uses the same memory as searching plus memory for buffering documents. The amount of memory used may be managed with
            <emphasis>MaxBufferedDocs</emphasis> parameter.
        </para>

        <para>
            Index optimization (full or partial) uses stream-style data processing and doesn't require a lot of memory.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.best-practice.encoding">
        <title>Encoding</title>

        <para>
            Zend_Search_Lucene works with UTF-8 strings internally. So all strings returned by Zend_Search_Lucene are UTF-8 encoded.
        </para>

        <para>
            You shouldn't be concerned with encoding if you work with pure ASCII data, but you should be careful if this is not the case.
        </para>

        <para>
            Wrong encoding may cause error notices at the encoding conversion time or loss of data.
        </para>

        <para>
            Zend_Search_Lucene offers a wide range of encoding possibilities for indexed documents and parsed queries.
        </para>

        <para>
            Encoding may be explicitly specified as an optional parameter of field creation methods:
            <programlisting role="php"><![CDATA[<?php
$doc = new Zend_Search_Lucene_Document();
$doc->addField(Zend_Search_Lucene_Field::Text('title', $title, 'iso-8859-1'));
$doc->addField(Zend_Search_Lucene_Field::UnStored('contents', $contents, 'utf-8'));]]>
            </programlisting>
            This is the best way to avoid ambiguity in the encoding used.
        </para>

        <para>
            If optional encoding parameter is omitted, then the current locale is used. The current locale may contain character encoding data
            in addition to the language specification:
            <programlisting role="php"><![CDATA[<?php
setlocale(LC_ALL, 'fr_FR');
...

setlocale(LC_ALL, 'de_DE.iso-8859-1');
...

setlocale(LC_ALL, 'ru_RU.UTF-8');
...]]>
            </programlisting>
        </para>

        <para>
            The same approach is used to set query string encoding.
        </para>

        <para>
            If encoding is not specified, then the current locale is used to determine the encoding.
        </para>

        <para>
            Encoding may be passed as an optional parameter, if the query is parsed explicitly before search:
            <programlisting role="php"><![CDATA[<?php
$query = Zend_Search_Lucene_Search_QueryParser::parse($queryStr, 'iso-8859-5');
$hits = $index->find($query);
...]]>
            </programlisting>
        </para>

        <para>
            The default encoding may also be specified with <code>setDefaultEncoding()</code> method:
            <programlisting role="php"><![CDATA[<?php
Zend_Search_Lucene_Search_QueryParser::setDefaultEncoding('iso-8859-1');
$hits = $index->find($queryStr);
...]]>
            </programlisting>
            The empty string implies 'current locale'.
        </para>

        <para>
            If the correct encoding is specified it can be correctly processed by analyzer. The actual behavior depends on which analyzer is used.
            See the <link linkend="zend.search.lucene.charset">Character Set</link> documentation section for details.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.best-practice.maintenance">
        <title>Index maintenance</title>

        <para>
            It should be clear that Zend_Search_Lucene as well as any other Lucene implementation does not comprise a "database".
        </para>

        <para>
            Indexes should not be used for data storage. They do not provide partial backup/restore functionality, journaling, logging, transactions
            and many other feautures associated with database management systems.
        </para>

        <para>
            Nevertheless, Zend_Search_Lucene attempts to keep indexes in a consistent state at all times.
        </para>

        <para>
            Index backup and restoration should be performed by copying the contents of the index folder.
        </para>

        <para>
            If index corruption occures for any reason, the corrupted index should be restored or completely rebuilt.
        </para>

        <para>
            So it's a good idea to backup large indexes and store changelogs to perform manual restoration and roll-forward operations
            if necessary. This practice dramatically reduces index restoration time.
        </para>

    </sect2>
</sect1>
<sect1 id="zend.search.lucene.charset">
    <title>Character Set</title>

    <sect2 id="zend.search.lucene.charset.description">
        <title>UTF-8 and single-byte character set support</title>

        <para>
            Zend_Search_Lucene works with the UTF-8 charset internally. Index files store
            unicode data in Java's "modified UTF-8 encoding". Zend_Search_Lucene core
            completely supports this encoding with one exception.
            <footnote>
               <para>
                   Zend_Search_Lucene supports only Basic Multilingual Plane
                   (BMP) characters (from 0x0000 to 0xFFFF) and doesn't support
                   "supplementary characters" (characters whose code points are
                   greater than 0xFFFF)
               </para>
               <para>
                   Java 2 represents these characters as a pair of char (16-bit)
                   values, the first from the high-surrogates range (0xD800-0xDBFF),
                   the second from the low-surrogates range (0xDC00-0xDFFF). Then
                   they are encoded as usual UTF-8 characters in six bytes.
                   Standard UTF-8 representation uses four bytes for supplementary
                   characters.
               </para>
            </footnote>
        </para>

        <para>
            Actual input data encoding may be specified through Zend_Search_Lucene API. Data will
            be automatically converted into UTF-8 encoding.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.charset.default_analyzer">
        <title>Default text analyzer.</title>
        <para>
            However, the default text analyzer (which is also used within query parser) uses
            ctype_alpha() for tokenizing text and queries.
        </para>

        <para>
            ctype_alpha() is not UTF-8 compatible, so the analyzer converts text to 'ASCII//TRANSLIT' encoding before
            indexing. The same processing is transparently performed during query parsing.
            <footnote>
               <para>
                   Conversion to 'ASCII//TRANSLIT' may depend on current locale and OS.
               </para>
            </footnote>
        </para>

        <note>
            <title/>
            <para>
                Default analyzer doesn't treats numbers as parts of terms. Use corresponding 'Num' analyzer if you don't want words 
                to be broken by numbers.  
            </para>
        </note>
    </sect2>

    <sect2 id="zend.search.lucene.charset.utf_analyzer">
        <title>UTF-8 compatible text analyzers.</title>

        <para>
            Zend_Search_Lucene also contains a set of UTF-8 compatible analyzers: <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Utf8</code>,
            <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Utf8Num</code>, <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Utf8_CaseInsensitive</code>,
            <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Utf8Num_CaseInsensitive</code>.
        </para>

        <para>
             Any of this analyzers can be enabled with the code like this:

            <programlisting role="php"><![CDATA[<?php
Zend_Search_Lucene_Analysis_Analyzer::setDefault(
    new Zend_Search_Lucene_Analysis_Analyzer_Common_Utf8());]]>
            </programlisting>
        </para>

        <warning>
            <title/>
            <para>
                UTF-8 compatible analyzers were improved in ZF 1.5. Early versions of analyzers assumed 
                all non-ascii characters are letters. New analyzers implementation has more accurate behavior. 
            </para>
            <para>
                This may need you to re-build index to have data and search queries tokenized in the same way, otherwise search engine
                may return wrong result sets.  
            </para>
        </warning>

        <para>
            All of these analyzers need PCRE (Perl-compatible regular expressions) library to be compiled with UTF-8 support turned on. 
            PCRE UTF-8 support is turned on for the PCRE library sources bandled with PHP source code distribution, but if shared libraru is used
            instead of bandled with PHP sources, then UTF-8 support state may depend on you operation system. 
        </para>

        <para>
             Use the following code to check, if PCRE UTF-8 suppor is enabled:

            <programlisting role="php"><![CDATA[<?php
if (@preg_match('/\pL/u', 'a') == 1) {
    echo "PCRE unicode support is turned on.\n";
} else {
    echo "PCRE unicode support is turned off.\n";
}]]>
            </programlisting>
        </para>
        
        <para>
            Case insensitive versions of UTF-8 compatible analyzers also need <ulink url="http://www.php.net/manual/en/ref.mbstring.php">mbstring</ulink> extension to be enabled. 
        </para>
        
        <para>
            If you don't want mbstring extension to be turned on, but need case insensitive search, you may use the following approach: normalize source data before indexing
            and query string before searching by converting them to lowercase:
        
            <programlisting role="php"><![CDATA[<?php
// Indexing
setlocale(LC_CTYPE, 'de_DE.iso-8859-1');

...

Zend_Search_Lucene_Analysis_Analyzer::setDefault(
    new Zend_Search_Lucene_Analysis_Analyzer_Common_Utf8());

...

$doc = new Zend_Search_Lucene_Document();

$doc->addField(Zend_Search_Lucene_Field::UnStored('contents', strtolower($contents)));

// Title field for search through (indexed, unstored)
$doc->addField(Zend_Search_Lucene_Field::UnStored('title', strtolower($title)));

// Title field for retrieving (unindexed, stored)
$doc->addField(Zend_Search_Lucene_Field::UnIndexed('_title', $title));]]>
            </programlisting>

            <programlisting role="php"><![CDATA[<?php
// Searching
setlocale(LC_CTYPE, 'de_DE.iso-8859-1');

...

Zend_Search_Lucene_Analysis_Analyzer::setDefault(
    new Zend_Search_Lucene_Analysis_Analyzer_Common_Utf8());

...

$hits = $index->find(strtolower($query));]]>
            </programlisting>
        </para>
    </sect2>
</sect1>
<sect1 id="zend.search.lucene.extending">
    <title>Extensibility</title>

    <sect2 id="zend.search.lucene.extending.analysis">
        <title>Text Analysis</title>
        <para>
            The <code>Zend_Search_Lucene_Analysis_Analyzer</code> class is used by the indexer to tokenize document
            text fields.
        </para>

        <para>
            The <code>Zend_Search_Lucene_Analysis_Analyzer::getDefault()</code> and <code>
            Zend_Search_Lucene_Analysis_Analyzer::setDefault()</code> methods are used
            to get and set the default analyzer.
        </para>

        <para>
            You can assign your own text analyzer or choose it from the set of predefined analyzers:
            <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Text</code> and
            <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Text_CaseInsensitive</code> (default).
            Both of them interpret tokens as sequences of letters.
            <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Text_CaseInsensitive</code> converts all tokens
            to lower case.
        </para>

        <para>
            To switch between analyzers:
        </para>

        <programlisting role="php"><![CDATA[<?php
Zend_Search_Lucene_Analysis_Analyzer::setDefault(
    new Zend_Search_Lucene_Analysis_Analyzer_Common_Text());
...
$index->addDocument($doc);]]>
        </programlisting>

        <para>
            The <code>Zend_Search_Lucene_Analysis_Analyzer_Common</code> class is designed to be an ancestor of all user
            defined analyzers. User should only define the <code>reset()</code> and <code>nextToken()</code> methods,
            which takes its string from the $_input member and returns tokens one by one
            (a <code>null</code> value indicates the end of the stream).
        </para>

        <para>
            The <code>nextToken()</code> method should call the <code>normalize()</code> method on each
            token. This will allow you to use token filters with your analyzer.
        </para>

        <para>
            Here is an example of a custom analyzer, which accepts words with digits as terms:

            <example id="zend.search.lucene.extending.analysis.example-1">
                <title>Custom text Analyzer.</title>
                <programlisting role="php"><![CDATA[<?php
/** Here is a custom text analyser, which treats words with digits as one term */


/** Zend_Search_Lucene_Analysis_Analyzer hierarchy */
require_once 'Zend/Search/Lucene/Analysis/Analyzer.php';

class My_Analyzer extends Zend_Search_Lucene_Analysis_Analyzer_Common
{
    private $_position;

    /**
     * Reset token stream
     */
    public function reset()
    {
        $this->_position = 0;
    }

    /**
     * Tokenization stream API
     * Get next token
     * Returns null at the end of stream
     *
     * @return Zend_Search_Lucene_Analysis_Token|null
     */
    public function nextToken()
    {
        if ($this->_input === null) {
            return null;
        }

        while ($this->_position < strlen($this->_input)) {
            // skip white space
            while ($this->_position < strlen($this->_input) &&
                   !ctype_alnum( $this->_input[$this->_position] )) {
                $this->_position++;
            }

            $termStartPosition = $this->_position;

            // read token
            while ($this->_position < strlen($this->_input) &&
                   ctype_alnum( $this->_input[$this->_position] )) {
                $this->_position++;
            }

            // Empty token, end of stream.
            if ($this->_position == $termStartPosition) {
                return null;
            }

            $token = new Zend_Search_Lucene_Analysis_Token(
                                      substr($this->_input,
                                             $termStartPosition,
                                             $this->_position - $termStartPosition),
                                      $termStartPosition,
                                      $this->_position);
            $token = $this->normalize($token);
            if ($token !== null) {
                return $token;
            }
            // Continue if token is skipped
        }

        return null;
    }
}

Zend_Search_Lucene_Analysis_Analyzer::setDefault(
    new My_Analyzer());]]>
                </programlisting>
            </example>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.extending.filters">
        <title>Tokens Filtering</title>
        <para>
            The <code>Zend_Search_Lucene_Analysis_Analyzer_Common</code> analyzer also offers a token filtering
            mechanism.
        </para>

        <para>
            The <code>Zend_Search_Lucene_Analysis_TokenFilter</code> class provides an abstract interface for such filters.
            Your own filters should extend this class either directly or indirectly.
        </para>

        <para>
            Any custom filter must implement the <code>normalize()</code> method which may transform input token or signal that
            the current token should be skipped.
        </para>

        <para>
            There are three filters already defined in the analysis subpackage:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>Zend_Search_Lucene_Analysis_TokenFilter_LowerCase</code>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Search_Lucene_Analysis_TokenFilter_ShortWords</code>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>Zend_Search_Lucene_Analysis_TokenFilter_StopWords</code>
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            The <code>LowerCase</code> filter is already used for
            <code>Zend_Search_Lucene_Analysis_Analyzer_Common_Text_CaseInsensitive</code> analyzer
            by default.
        </para>

        <para>
            The <code>ShortWords</code> and <code>StopWords</code> filters may be used with pre-defined or custom
            analyzers like this:
            <programlisting role="php"><![CDATA[<?php
$stopWords = array('a', 'an', 'at', 'the', 'and', 'or', 'is', 'am');
$stopWordsFilter = new Zend_Search_Lucene_Analysis_TokenFilter_StopWords($stopWords);

$analyzer = new Zend_Search_Lucene_Analysis_Analyzer_Common_TextNum_CaseInsensitive();
$analyzer->addFilter($stopWordsFilter);

Zend_Search_Lucene_Analysis_Analyzer::setDefault($analyzer);]]>
            </programlisting>
            <programlisting role="php"><![CDATA[<?php
$shortWordsFilter = new Zend_Search_Lucene_Analysis_TokenFilter_ShortWords();

$analyzer = new Zend_Search_Lucene_Analysis_Analyzer_Common_TextNum_CaseInsensitive();
$analyzer->addFilter($shortWordsFilter);

Zend_Search_Lucene_Analysis_Analyzer::setDefault($analyzer);]]>
            </programlisting>
        </para>

        <para>
            The <code>Zend_Search_Lucene_Analysis_TokenFilter_StopWords</code> constructor takes an array of stop-words
            as an input. But stop-words may be also loaded from a file:
            <programlisting role="php"><![CDATA[<?php
$stopWordsFilter = new Zend_Search_Lucene_Analysis_TokenFilter_StopWords();
$stopWordsFilter->loadFromFile($my_stopwords_file);

$analyzer = new Zend_Search_Lucene_Analysis_Analyzer_Common_TextNum_CaseInsensitive();
$analyzer->addFilter($stopWordsFilter);

Zend_Search_Lucene_Analysis_Analyzer::setDefault($analyzer);]]>
            </programlisting>
            This file should be a common text file with one word in each line. The '#' character marks a line as a comment.
        </para>

        <para>
            The <code>Zend_Search_Lucene_Analysis_TokenFilter_ShortWords</code> constructor has one optional argument.
            This is the word length limit, set by default to 2.
        </para>

    </sect2>


    <sect2 id="zend.search.lucene.extending.scoring">
        <title>Scoring Algorithms</title>
        <para>
            The score of a document <literal>d</literal> for a query <literal>q</literal> 
            is defined as follows:
        </para>

        <para>
            <code>score(q,d) = sum( tf(t in d) * idf(t) * getBoost(t.field in d) * lengthNorm(t.field in d)  ) *
            coord(q,d) * queryNorm(q)</code>
        </para>

        <para>
            tf(t in d) - <code>Zend_Search_Lucene_Search_Similarity::tf($freq)</code> - a score factor based on the frequency of a term or phrase in a document.
        </para>

        <para>
            idf(t) - <code>Zend_Search_Lucene_Search_Similarity::tf($term, $reader)</code> - a score factor for a simple term with the specified index.
        </para>

        <para>
            getBoost(t.field in d) - the boost factor for the term field.
        </para>

        <para>
            lengthNorm($term) - the normalization value for a field given the total
            number of terms contained in a field. This value is stored within the index.
            These values, together with field boosts, are stored in an index and multiplied
            into scores for hits on each field by the search code.
        </para>
        <para>
            Matches in longer fields are less precise, so implementations of this method
            usually return smaller values when numTokens is large, and larger values when numTokens is small.
        </para>

        <para>
            coord(q,d) - <code>Zend_Search_Lucene_Search_Similarity::coord($overlap, $maxOverlap)</code> - a
            score factor based on the fraction of all query terms that a document contains.
        </para>

        <para>
            The presence of a large portion of the query terms indicates a better match
            with the query, so implementations of this method usually return larger values
            when the ratio between these parameters is large and smaller values when
            the ratio between them is small.
        </para>

        <para>
            queryNorm(q) -  the normalization value for a query given the sum of the squared weights
            of each of the query terms. This value is then multiplied into the weight of each query
            term.
        </para>

        <para>
            This does not affect ranking, but rather just attempts to make scores from different
            queries comparable.
        </para>

        <para>
            The scoring algorithm can be customized by defining your own Similarity class. To do this
            extend the Zend_Search_Lucene_Search_Similarity class as defined below, then use
            the <code>Zend_Search_Lucene_Search_Similarity::setDefault($similarity);</code> method to set it as default.
        </para>

        <programlisting role="php"><![CDATA[<?php
class MySimilarity extends Zend_Search_Lucene_Search_Similarity {
    public function lengthNorm($fieldName, $numTerms) {
        return 1.0/sqrt($numTerms);
    }

    public function queryNorm($sumOfSquaredWeights) {
        return 1.0/sqrt($sumOfSquaredWeights);
    }

    public function tf($freq) {
        return sqrt($freq);
    }

    /**
     * It's not used now. Computes the amount of a sloppy phrase match,
     * based on an edit distance.
     */
    public function sloppyFreq($distance) {
        return 1.0;
    }

    public function idfFreq($docFreq, $numDocs) {
        return log($numDocs/(float)($docFreq+1)) + 1.0;
    }

    public function coord($overlap, $maxOverlap) {
        return $overlap/(float)$maxOverlap;
    }
}

$mySimilarity = new MySimilarity();
Zend_Search_Lucene_Search_Similarity::setDefault($mySimilarity);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.search.lucene.extending.storage">
        <title>Storage Containers</title>
        <para>
        The abstract class <code>Zend_Search_Lucene_Storage_Directory</code> defines directory functionality.
        </para>

        <para>
        The <code>Zend_Search_Lucene</code> constructor uses either a string or a
        <code>Zend_Search_Lucene_Storage_Directory</code> object
        as an input.
        </para>

        <para>
        The <code>Zend_Search_Lucene_Storage_Directory_Filesystem</code> class implements directory
        functionality for a file system.
        </para>

        <para>
        If a string is used as an input for the <code>Zend_Search_Lucene</code> constructor, then the index
        reader (<code>Zend_Search_Lucene</code> object) treats it as a file system path and instantiates
        the <code>Zend_Search_Lucene_Storage_Directory_Filesystem</code> object.
        </para>

        <para>
        You can define your own directory implementation by extending the
        <code>Zend_Search_Lucene_Storage_Directory</code> class.
        </para>

        <para>
        <code>Zend_Search_Lucene_Storage_Directory</code> methods:
        </para>
        <programlisting><![CDATA[<?php
abstract class Zend_Search_Lucene_Storage_Directory {
/**
 * Closes the store.
 *
 * @return void
 */
abstract function close();


/**
 * Creates a new, empty file in the directory with the given $filename.
 *
 * @param string $name
 * @return void
 */
abstract function createFile($filename);


/**
 * Removes an existing $filename in the directory.
 *
 * @param string $filename
 * @return void
 */
abstract function deleteFile($filename);


/**
 * Returns true if a file with the given $filename exists.
 *
 * @param string $filename
 * @return boolean
 */
abstract function fileExists($filename);


/**
 * Returns the length of a $filename in the directory.
 *
 * @param string $filename
 * @return integer
 */
abstract function fileLength($filename);


/**
 * Returns the UNIX timestamp $filename was last modified.
 *
 * @param string $filename
 * @return integer
 */
abstract function fileModified($filename);


/**
 * Renames an existing file in the directory.
 *
 * @param string $from
 * @param string $to
 * @return void
 */
abstract function renameFile($from, $to);


/**
 * Sets the modified time of $filename to now.
 *
 * @param string $filename
 * @return void
 */
abstract function touchFile($filename);


/**
 * Returns a Zend_Search_Lucene_Storage_File object for a given $filename in the directory.
 *
 * @param string $filename
 * @return Zend_Search_Lucene_Storage_File
 */
abstract function getFileObject($filename);

}]]>
        </programlisting>

        <para>
        The <code>getFileObject($filename)</code> method of a <code>Zend_Search_Lucene_Storage_Directory</code>
        instance returns a <code>Zend_Search_Lucene_Storage_File</code> object.
        </para>
        <para>
        The <code>Zend_Search_Lucene_Storage_File</code> abstract class implements file abstraction and index
        file reading primitives.
        </para>
        <para>
        You must also extend <code>Zend_Search_Lucene_Storage_File</code> for your directory implementation.
        </para>
        <para>
        Only two methods of <code>Zend_Search_Lucene_Storage_File</code> must be overridden in your
        implementation:
        </para>
        <programlisting><![CDATA[<?php
class MyFile extends Zend_Search_Lucene_Storage_File {
    /**
     * Sets the file position indicator and advances the file pointer.
     * The new position, measured in bytes from the beginning of the file,
     * is obtained by adding offset to the position specified by whence,
     * whose values are defined as follows:
     * SEEK_SET - Set position equal to offset bytes.
     * SEEK_CUR - Set position to current location plus offset.
     * SEEK_END - Set position to end-of-file plus offset. (To move to
     * a position before the end-of-file, you need to pass a negative value
     * in offset.)
     * Upon success, returns 0; otherwise, returns -1
     *
     * @param integer $offset
     * @param integer $whence
     * @return integer
     */
    public function seek($offset, $whence=SEEK_SET) {
        ...
    }

    /**
     * Read a $length bytes from the file and advance the file pointer.
     *
     * @param integer $length
     * @return string
     */
    protected function _fread($length=1) {
        ...
    }
}]]>
        </programlisting>

    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.search.lucene.index-creation">
    <title>Building Indexes</title>

    <sect2 id="zend.search.lucene.index-creation.creating">
        <title>Creating a New Index</title>

        <para>
            Index creation and updating capabilities are implemented within the Zend_Search_Lucene component, as well as the Java Lucene project.
            You can use either of these options to create indexes that Zend_Search_Lucene can search.
        </para>

        <para>
            The PHP code listing below provides an example of how to index a file
            using Zend_Search_Lucene indexing API:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Create index
$index = Zend_Search_Lucene::create('/data/my-index');

$doc = new Zend_Search_Lucene_Document();

// Store document URL to identify it in the search results
$doc->addField(Zend_Search_Lucene_Field::Text('url', $docUrl));

// Index document contents
$doc->addField(Zend_Search_Lucene_Field::UnStored('contents', $docContent));

// Add document to the index
$index->addDocument($doc);]]>
        </programlisting>

        <para>
            Newly added documents are immediately searchable in the index.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.updating">
        <title>Updating Index</title>

        <para>
            The same procedure is used to update an existing index. The only difference
            is that the open() method is called instead of the create() method:
        </para>

        <programlisting role="php"><![CDATA[<?php
// Open existing index
$index = Zend_Search_Lucene::open('/data/my-index');

$doc = new Zend_Search_Lucene_Document();
// Store document URL to identify it in search result.
$doc->addField(Zend_Search_Lucene_Field::Text('url', $docUrl));
// Index document content
$doc->addField(Zend_Search_Lucene_Field::UnStored('contents', $docContent));

// Add document to the index.
$index->addDocument($doc);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.document-updating">
        <title>Updating Documents</title>

        <para>
            The Lucene index file format doesn't support document updating.
            Documents should be removed and re-added to the index to effectively update them.
        </para>

        <para>
            <code>Zend_Search_Lucene::delete()</code> method operates with an internal index document id. It can be retrieved
            from a query hit by 'id' property:
        </para>

        <programlisting role="php"><![CDATA[<?php
$removePath = ...;
$hits = $index->find('path:' . $removePath);
foreach ($hits as $hit) {
    $index->delete($hit->id);
}]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.counting">
        <title>Retrieving Index Size</title>

        <para>
            There are two methods to retrieve the size of an index in Zend_Search_Lucene.
        </para>

        <para>
             <code>Zend_Search_Lucene::maxDoc()</code> returns one greater than the largest possible document number.
             It's actually the overall number of the documents in the index including deleted documents, 
             so it has a synonym: <code>Zend_Search_Lucene::count()</code>.
        </para>

        <para>
             <code>Zend_Search_Lucene::numDocs()</code> returns the total number of non-deleted documents.
        </para>

        <programlisting role="php"><![CDATA[<?php
$indexSize = $index->count();
$documents = $index->numDocs();]]>
        </programlisting>

        <para>
            <code>Zend_Search_Lucene::isDeleted($id)</code> method may be used to check if a document is deleted.
        </para>

        <programlisting role="php"><![CDATA[<?php
for ($count = 0; $count < $index->maxDoc(); $count++) {
    if ($index->isDeleted($count)) {
        echo "Document #$id is deleted.\n";
    }
}]]>
        </programlisting>

        <para>
            Index optimization removes deleted documents and squeezes documents' IDs in to a smaller range.
            A document's internal id may therefore change during index optimization.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.optimization">
        <title>Index optimization</title>

        <para>
            A Lucene index consists of many segments. Each segment is a completely independent set of data.
        </para>
        <para>
            Lucene index segment files can't be updated by design. A segment update needs full segment
            reorganization. See Lucene index file formats for details
            (<ulink url="http://lucene.apache.org/java/2_0_0/fileformats.html">http://lucene.apache.org/java/2_0_0/fileformats.html</ulink>)
            <footnote>
        		<para>The currently supported Lucene index file format is version 2.1.</para>
        	</footnote>.
            New documents are added to the index by creating new segment.
        </para>
        <para>
            Increasing number of segments reduces quality of the index, but index optimization restores it.
            Optimization essentially merges several segments into a new one. This process also doesn't update segments.
            It generates one new large segment and updates segment list ('segments' file).
        </para>

        <para>
            Full index optimization can be trigger by calling the <code>Zend_Search_Lucene::optimize()</code> method. It merges all
            index segments into one new segment:
        </para>
        <programlisting role="php"><![CDATA[<?php
// Open existing index
$index = Zend_Search_Lucene::open('/data/my-index');

// Optimize index.
$index->optimize();]]>
        </programlisting>

        <para>
            Automatic index optimization is performed to keep indexes in a consistent state.
        </para>
        <para>
            Automatic optimization is an iterative process managed by several index options. It merges very small segments
            into larger ones, then merges these larger segments into even larger segments and so on.
        </para>

        <sect3 id="zend.search.lucene.index-creation.optimization.maxbuffereddocs">
            <title><emphasis>MaxBufferedDocs</emphasis> auto-optimization option</title>
            <para>
                <emphasis>MaxBufferedDocs</emphasis> is a minimal number of documents required before
                the buffered in-memory documents are written into a new segment.
            </para>
            <para>
                <emphasis>MaxBufferedDocs</emphasis> can be retrieved or set by <code>$index->getMaxBufferedDocs()</code> or
                <code>$index->setMaxBufferedDocs($maxBufferedDocs)</code> calls.
            </para>
            <para>
                Default value is 10.
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.index-creation.optimization.maxmergedocs">
            <title><emphasis>MaxMergeDocs</emphasis> auto-optimization option</title>
            <para>
                <emphasis>MaxMergeDocs</emphasis> is a largest number of documents ever merged by addDocument().
                Small values (e.g., less than 10.000) are best for interactive indexing, as this limits the length
                of pauses while indexing to a few seconds. Larger values are best for batched indexing and speedier
                searches.
            </para>
            <para>
                <emphasis>MaxMergeDocs</emphasis> can be retrieved or set by <code>$index->getMaxMergeDocs()</code> or
                <code>$index->setMaxMergeDocs($maxMergeDocs)</code> calls.
            </para>
            <para>
                Default value is PHP_INT_MAX.
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.index-creation.optimization.mergefactor">
            <title><emphasis>MergeFactor</emphasis> auto-optimization option</title>
            <para>
                <emphasis>MergeFactor</emphasis> determines how often segment indices are merged by addDocument().
                With smaller values, less RAM is used while indexing, and searches on unoptimized indices are faster,
                but indexing speed is slower. With larger values, more RAM is used during indexing, and while searches
                on unoptimized indices are slower, indexing is faster. Thus larger values (&gt; 10) are best for batch
                index creation, and smaller values (&lt; 10) for indices that are interactively maintained.
            </para>
            <para>
                <emphasis>MergeFactor</emphasis> is a good estimation for average number of segments merged by one auto-optimization pass.
                Too large values produce large number of segments while they are not merged into new one. It may be a cause of
                "failed to open stream: Too many open files" error message. This limitation is system dependent.
            </para>
            <para>
                <emphasis>MergeFactor</emphasis> can be retrieved or set by <code>$index->getMergeFactor()</code> or
                <code>$index->setMergeFactor($mergeFactor)</code> calls.
            </para>
            <para>
                Default value is 10.
            </para>
            <para>
                Lucene Java and Luke (Lucene Index Toolbox - <ulink url="http://www.getopt.org/luke/luke-0.6/">http://www.getopt.org/luke/luke-0.6/</ulink>)
                can also be used to optimize an index. Luke v0.6 must be used to be compatible with Zend_Search_Lucene component. Later Luke versions are
                based on Lucene v2.1 which uses the newer index file format. Full Luke project information can be found here -
                <ulink url="http://www.getopt.org/luke/">http://www.getopt.org/luke/</ulink>
            </para>
        </sect3>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.permissions">
        <title>Permissions</title>

        <para>
            By default, index files are available for reading and writing by everyone.
        </para>

        <para>
            It's possible to override this with the <code>Zend_Search_Lucene_Storage_Directory_Filesystem::setDefaultFilePermissions()</code> method:
        </para>


        <programlisting role="php"><![CDATA[<?php
// Get current default file permissions
$currentPermissions = Zend_Search_Lucene_Storage_Directory_Filesystem::getDefaultFilePermissions();

// Give read-writing permissions only for current user and group
Zend_Search_Lucene_Storage_Directory_Filesystem::setDefaultFilePermissions(0660);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.limitations">
        <title>Limitations</title>

        <sect3 id="zend.search.lucene.index-creation.limitations.index-size">
            <title>Index size</title>
            <para>
                Index size is limited by 2GB for 32-bit platforms.
            </para>

            <para>
                Use 64-bit platforms for larger indices.
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.index-creation.limitations.filesystems">
            <title>Supported Filesystems</title>
            <para>
                Zend_Search_Lucene uses <code>flock()</code> to provide concurrent searching, index updating and optimization.
            </para>

            <para>
                According to the PHP <ulink url="http://www.php.net/manual/en/function.flock.php">documentation</ulink>,
                "<code>flock()</code> will not work on NFS and many other networked file systems".
            </para>

            <para>
                Do not use networked file systems with Zend_Search_Lucene.
            </para>
        </sect3>
    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.search.lucene.java-lucene">
    <title>Interoperating with Java Lucene</title>

    <sect2 id="zend.search.lucene.index-creation.file-formats">
        <title>File Formats</title>
        <para>
          Zend_Search_Lucene index file formats are binary compatible with Java Lucene
          version 1.4 and greater.
        </para>

        <para>
          A detailed description of this format is available here:
          <ulink url="http://lucene.apache.org/java/2_0_0/fileformats.html"/>
          <footnote><para>The currently supported Lucene index file format version is v2.1.</para></footnote>.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.index-directory">
        <title>Index Directory</title>

        <para>
        After index creation, the index directory will contain several files:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                The <filename>segments</filename> file is a list of index segments.
                </para>
            </listitem>
            <listitem>
                <para>
                The <filename>*.cfs</filename> files contain index segments.
                Note! An optimized index always has only one segment.
                </para>
            </listitem>
            <listitem>
                <para>
                The <filename>deletable</filename> file is a list of files that are no longer used
                by the index, but which could not be deleted.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.search.lucene.java-lucene.source-code">
        <title>Java Source Code</title>
        <para>
            The Java program listing below provides an example of how to index a file
            using Java Lucene:
        </para>

        <programlisting role="java"><![CDATA[
/**
* Index creation:
*/
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.document.*;

import java.io.*

...

IndexWriter indexWriter = new IndexWriter("/data/my_index",
                                          new SimpleAnalyzer(), true);

...

String filename = "/path/to/file-to-index.txt"
File f = new File(filename);

Document doc = new Document();
doc.add(Field.Text("path", filename));
doc.add(Field.Keyword("modified",DateField.timeToString(f.lastModified())));
doc.add(Field.Text("author", "unknown"));
FileInputStream is = new FileInputStream(f);
Reader reader = new BufferedReader(new InputStreamReader(is));
doc.add(Field.Text("contents", reader));

indexWriter.addDocument(doc);]]>
        </programlisting>
    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.search.lucene.overview">
    <title>Overview</title>

    <sect2 id="zend.search.lucene.introduction">
        <title>Introduction</title>
        <para>Zend_Search_Lucene is a general purpose text search engine written entirely in PHP 5.
            Since it stores its index on the filesystem and does not require a database
            server, it can add search capabilities to almost any PHP-driven website.
            Zend_Search_Lucene supports the following features:<itemizedlist>
                <listitem>
                    <para>Ranked searching - best results returned first</para>
                </listitem>
                <listitem>
                    <para>
                       Many powerful query types: phrase queries, wildcard queries,
                       proximity queries, range queries and more
                        <footnote>
                           <para>
                             Term, multi-term, phrase queries, boolean expressions and subqueries are supported at this time.
                           </para>
                        </footnote>
                    </para>
                </listitem>
                <listitem>
                    <para>Search by specific field (e.g., title, author, contents)</para>
                </listitem>
            </itemizedlist>

            Zend_Search_Lucene was derived from the Apache Lucene project.  The currently supported Lucene version is 2.2.
            <footnote>
               <para>
                   Lucene 2.1 index format support (which is also used in Lucene 2.2) is included in the current "trunk" branch. 
                   It is available via SVN in current nightly snapshots.
               </para>
               <para>
                   We hope to include Lucene 2.1 index format support in ZF 1.5.0. The current release (ZF V1.0.4) works with
                   Lucene 1.9-2.0 index formats.
               </para>
            </footnote>.
            For more information on Lucene, visit <ulink url="http://lucene.apache.org/java/docs/"/> (<ulink url="http://lucene.apache.org/java/2_2_0/"/>).
        </para>
        <note>
            <title/>
            <para>
                Previous Zend_Search_Lucene implementations support the Lucene 1.9 index format. 
            </para>
            <para>
                Currently any index created using these versions is automatically upgraded to Lucene 2.1 format after the Zend_Search_Lucene update and
                will not be compatible with previous Zend_Search_Lucene versions.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.documents-and-fields">
        <title>Document and Field Objects</title>
            <para>
                Zend_Search_Lucene operates with documents as atomic objects for indexing.  A document is
                divided into named fields, and fields have content that can be searched.
            </para>

            <para>
                A document is represented by the Zend_Search_Lucene_Document class, and this objects of this class contain
                instances of Zend_Search_Lucene_Field that represent the fields on the document.
            </para>

            <para>
                It is important to note that any information can be added to the index.
                Application-specific information or metadata can be stored in the document
                fields, and later retrieved with the document during search.
            </para>

            <para>
                It is the responsibility of your application to control the indexer.
                This means that data can be indexed from any source
                that is accessible by your application.  For example, this could be the
                filesystem, a database, an HTML form, etc.
            </para>

            <para>
                <code>Zend_Search_Lucene_Field</code> class provides several static methods to create fields with
                different characteristics:
            </para>

            <programlisting role="php"><![CDATA[<?php
$doc = new Zend_Search_Lucene_Document();

// Field is not tokenized, but is indexed and stored within the index.
// Stored fields can be retrived from the index.
$doc->addField(Zend_Search_Lucene_Field::Keyword('doctype',
                                                 'autogenerated'));

// Field is not tokenized nor indexed, but is stored in the index.
$doc->addField(Zend_Search_Lucene_Field::UnIndexed('created',
                                                   time()));

// Binary String valued Field that is not tokenized nor indexed,
// but is stored in the index.
$doc->addField(Zend_Search_Lucene_Field::Binary('icon',
                                                $iconData));

// Field is tokenized and indexed, and is stored in the index.
$doc->addField(Zend_Search_Lucene_Field::Text('annotation',
                                              'Document annotation text'));

// Field is tokenized and indexed, but is not stored in the index.
$doc->addField(Zend_Search_Lucene_Field::UnStored('contents',
                                                  'My document content'));]]>
            </programlisting>

            <para>
                Each of these methods (excluding the <code>Zend_Search_Lucene_Field::Binary()</code> method) has an optional
                <code>$encoding</code> parameter for specifying input data encoding.
            </para>

            <para>
                Encoding may differ for different documents as well as for different fields within one document:

                <programlisting role="php"><![CDATA[<?php
$doc = new Zend_Search_Lucene_Document();
$doc->addField(Zend_Search_Lucene_Field::Text('title', $title, 'iso-8859-1'));
$doc->addField(Zend_Search_Lucene_Field::UnStored('contents', $contents, 'utf-8'));]]>
                </programlisting>
            </para>

            <para>
                If encoding parameter is omitted, then the current locale is used at processing time. For example:
                <programlisting role="php"><![CDATA[<?php
setlocale(LC_ALL, 'de_DE.iso-8859-1');
...
$doc->addField(Zend_Search_Lucene_Field::UnStored('contents', $contents));]]>
                </programlisting>
            </para>

            <para>
                Fields are always stored and returned from the index in UTF-8 encoding. Any required conversion to UTF-8 happens
                automatically.
            </para>

            <para>
                Text analyzers (<link linkend="zend.search.lucene.extending.analysis">see below</link>) may also convert text
                to some other encodings. Actually, the default analyzer converts text to 'ASCII//TRANSLIT' encoding.
                Be careful, however; this translation may depend on current locale.
            </para>

            <para>
                Fields' names are defined at your discretion in the <code>addField()</code> method.
            </para>

            <para>
                Java Lucene uses the 'contents' field as a default field to search.
                Zend_Search_Lucene searches through all fields by default, but the behavior is configurable.
                See the <link linkend="zend.search.lucene.query-language.fields">"Default search field"</link> chapter for details.
            </para>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.understanding-field-types">
        <title>Understanding Field Types</title>
        <itemizedlist>
            <listitem>
                <para>
                    <code>Keyword</code> fields are stored and indexed, meaning that they can be searched as well
                    as displayed in search results. They are not split up into separate words by tokenization.
                    Enumerated database fields usually translate well to Keyword fields in Zend_Search_Lucene.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>UnIndexed</code> fields are not searchable, but they are returned with search hits.  Database
                    timestamps, primary keys, file system paths, and other external identifiers are good
                    candidates for UnIndexed fields.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Binary</code> fields are not tokenized or indexed, but are stored for retrieval with search hits.
                    They can be used to store any data encoded as a binary string, such as an image icon.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Text</code> fields are stored, indexed, and tokenized. Text fields are appropriate for storing
                    information like subjects and titles that need to be searchable as well as returned with
                    search results.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>UnStored</code> fields are tokenized and indexed, but not stored in the index. Large amounts of
                    text are best indexed using this type of field. Storing data creates a larger index on
                    disk, so if you need to search but not redisplay the data, use an UnStored field.
                    UnStored fields are practical when using a Zend_Search_Lucene index in
                    combination with a relational database. You can index large data fields with UnStored
                    fields for searching, and retrieve them from your relational database by using a separate
                    field as an identifier.
               </para>

                <table id="zend.search.lucene.index-creation.understanding-field-types.table">
                    <title>Zend_Search_Lucene_Field Types</title>
                    <tgroup cols="4">
                        <thead>
                            <row>
                                <entry>Field Type</entry>
                                <entry>Stored</entry>
                                <entry>Indexed</entry>
                                <entry>Tokenized</entry>
                                <entry>Binary</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Keyword</entry>
                                <entry>Yes</entry>
                                <entry>Yes</entry>
                                <entry>No</entry>
                                <entry>No</entry>
                            </row>
                            <row>
                                <entry>UnIndexed</entry>
                                <entry>Yes</entry>
                                <entry>No</entry>
                                <entry>No</entry>
                                <entry>No</entry>
                            </row>
                            <row>
                                <entry>Binary</entry>
                                <entry>Yes</entry>
                                <entry>No</entry>
                                <entry>No</entry>
                                <entry>Yes</entry>
                            </row>
                            <row>
                                <entry>Text</entry>
                                <entry>Yes</entry>
                                <entry>Yes</entry>
                                <entry>Yes</entry>
                                <entry>No</entry>
                            </row>
                            <row>
                                <entry>UnStored</entry>
                                <entry>No</entry>
                                <entry>Yes</entry>
                                <entry>Yes</entry>
                                <entry>No</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
           </listitem>
       </itemizedlist>
    </sect2>

    <sect2 id="zend.search.lucene.index-creation.html-documents">
        <title>HTML documents</title>
        <para>
            Zend_Search_Lucene offers a HTML parsing feature. Documents can be created directly from a HTML file or string:
            <programlisting role="php"><![CDATA[<?php
$doc = Zend_Search_Lucene_Document_Html::loadHTMLFile($filename);
$index->addDocument($doc);
...
$doc = Zend_Search_Lucene_Document_Html::loadHTML($htmlString);
$index->addDocument($doc);]]>
            </programlisting>
        </para>

        <para>
            <code>Zend_Search_Lucene_Document_Html</code> class uses the <code>DOMDocument::loadHTML()</code> and
            <code>DOMDocument::loadHTMLFile()</code> methods to parse the source HTML, so it doesn't need HTML to be well formed or
            to be XHTML. On the other hand, it's sensitive to the encoding specied by the "meta http-equiv" header tag.
        </para>

        <para>
            <code>Zend_Search_Lucene_Document_Html</code> class recognizes document title, body and document header meta tags.
        </para>

        <para>
            The 'title' field is actually the /html/head/title value. It's stored within the index, tokenized and available for search.
        </para>

        <para>
            The 'body' field is the actual body content of the HTML file or string. It doesn't include scripts, comments or attributes.
        </para>

        <para>
            The <code>loadHTML()</code> and <code>loadHTMLFile()</code> methods of <code>Zend_Search_Lucene_Document_Html</code> class
            also have second optional argument. If it's set to true, then body content is also stored within index and can
            be retrieved from the index. By default, the body is tokenized and indexed, but not stored.
        </para>

        <para>
            Other document header meta tags produce additional document fields. The field 'name' is taken from 'name' attribute, and
            the 'content' attribute populates the field 'value'. Both are tokenized, indexed and stored, so documents may be searched by their meta tags
            (for example, by keywords).
        </para>

        <para>
            Parsed documents may be augmented by the programmer with any other field:
            <programlisting role="php"><![CDATA[<?php
$doc = Zend_Search_Lucene_Document_Html::loadHTML($htmlString);
$doc->addField(Zend_Search_Lucene_Field::UnIndexed('created',
                                                   time()));
$doc->addField(Zend_Search_Lucene_Field::UnIndexed('updated',
                                                   time()));
$doc->addField(Zend_Search_Lucene_Field::Text('annotation',
                                              'Document annotation text'));
$index->addDocument($doc);]]>
            </programlisting>
        </para>

        <para>
            Document links are not included in the generated document, but may be retrieved with
            the <code>Zend_Search_Lucene_Document_Html::getLinks()</code> and <code>Zend_Search_Lucene_Document_Html::getHeaderLinks()</code>
            methods:
            <programlisting role="php"><![CDATA[<?php
$doc = Zend_Search_Lucene_Document_Html::loadHTML($htmlString);
$linksArray = $doc->getLinks();
$headerLinksArray = $doc->getHeaderLinks();]]>
            </programlisting>
        </para>
    </sect2>

</sect1>
<sect1 id="zend.search.lucene.query-api">
    <title>Query Construction API</title>

    <para>
        In addition to parsing a string query automatically it's also possible to construct them with the query API.
    </para>

    <para>
        User queries can be combined with queries created through the query API. Simply use the query parser to construct a query from a string:
        <programlisting role="php"><![CDATA[<?php
$query = Zend_Search_Lucene_Search_QueryParser::parse($queryString);]]>
        </programlisting>
    </para>


    <sect2 id="zend.search.lucene.queries.exceptions">
        <title>Query Parser Exceptions</title>
        
        <para>
        The query parser may generate two types of exceptions:
        <itemizedlist>
            <listitem>
                <para>
                    <code>Zend_Search_Lucene_Exception</code> is thrown if something goes wrong in the query parser itself.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>Zend_Search_Lucene_Search_QueryParserException</code> is thrown when there is an error in the query syntax.
                </para>
            </listitem>
        </itemizedlist>
        It's a good idea to catch Zend_Search_Lucene_Search_QueryParserExceptions and handle it appropriately:
        <programlisting role="php"><![CDATA[<?php
try {
    $query = Zend_Search_Lucene_Search_QueryParser::parse($queryString);
} catch (Zend_Search_Lucene_Search_QueryParserException $e) {
    echo "Query syntax error: " . $e->getMessage() . "\n";
}]]>
            </programlisting>
        </para>

        <para>
            The same technique should be used for the find() method of a Zend_Search_Lucene object.
        </para>

        <para>
            Starting in 1.5, query parsing exceptions are suppressed by default. If query doesn't conform query language,
            then it's tokenized using current default analyzer and all tokenized terms are used for searching.
            
            Use <code>Zend_Search_Lucene_Search_QueryParser::dontSuppressQueryParsingExceptions()</code> method
            to turn exceptions on.
            <code>Zend_Search_Lucene_Search_QueryParser::suppressQueryParsingExceptions()</code> and 
            <code>Zend_Search_Lucene_Search_QueryParser::queryParsingExceptionsSuppressed()</code> methods are also
            intended to manage exceptions handling behavior.
            
        </para>
        
    </sect2>

    <sect2 id="zend.search.lucene.queries.term-query">
        <title>Term Query</title>
        <para>
            Term queries can be used for searching with a single term.
        </para>

        <para>
        Query string:
        </para>
        <programlisting role="querystring"><![CDATA[word1]]>
        </programlisting>

        <para>or</para>

        <para>
        Query construction by API:
        </para>
        <programlisting role="php"><![CDATA[<?php
$term  = new Zend_Search_Lucene_Index_Term('word1', 'field1');
$query = new Zend_Search_Lucene_Search_Query_Term($term);
$hits  = $index->find($query);]]>
        </programlisting>

        <para>
            The term field is optional. Zend_Search_Lucene searches through all indexed fields in each document if the field is not specified:
            <programlisting role="php"><![CDATA[<?php
$term  = new Zend_Search_Lucene_Index_Term('word1');  // Search for 'word1' in all indexed fields
$query = new Zend_Search_Lucene_Search_Query_Term($term);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.queries.multiterm-query">
        <title>Multi-Term Query</title>
        <para>
            Multi-term queries can be used for searching with a set of terms.
        </para>

        <para>
            Each term in a set can be defined as <emphasis>required</emphasis>,
            <emphasis>prohibited</emphasis>, or <emphasis>neither</emphasis>.

            <itemizedlist>
                <listitem>
                    <para>
                        <emphasis>required</emphasis> means that documents not matching this term will not match
                        the query;
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis>prohibited</emphasis> means that documents matching this term will not match
                        the query;
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis>neither</emphasis>, in which case matched documents are neither prohibited
                        from, nor required to, match the term. A document must match at least 1 term, however, to
                        match the query.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            If optional terms are added to a query with required terms,
            both queries will have the same result set but the optional terms may affect the score of the matched documents.
        </para>

        <para>
            Both search methods can be used for multi-term queries.
        </para>

        <para>
            Query string:
        </para>
        <programlisting role="querystring"><![CDATA[+word1 author:word2 -word3]]>
        </programlisting>

        <itemizedlist>
            <listitem>
                <para>
                    '+' is used to define a required term.
                </para>
            </listitem>
            <listitem>
                <para>
                    '-' is used to define a prohibited term.
                </para>
            </listitem>
            <listitem>
                <para>
                    'field:' prefix is used to indicate a document field for a search.
                    If it's omitted, then all fields are searched.
                </para>
            </listitem>
        </itemizedlist>

        <para>or</para>

        <para>
        Query construction by API:
        </para>
        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_MultiTerm();

$query->addTerm(new Zend_Search_Lucene_Index_Term('word1'), true);
$query->addTerm(new Zend_Search_Lucene_Index_Term('word2', 'author'), null);
$query->addTerm(new Zend_Search_Lucene_Index_Term('word3'), false);

$hits  = $index->find($query);]]>
        </programlisting>

        <para>
            It's also possible to specify terms list within MultiTerm query constructor:
            <programlisting role="php"><![CDATA[<?php
$terms = array(new Zend_Search_Lucene_Index_Term('word1'),
               new Zend_Search_Lucene_Index_Term('word2', 'author'),
               new Zend_Search_Lucene_Index_Term('word3'));
$signs = array(true, null, false);

$query = new Zend_Search_Lucene_Search_Query_MultiTerm($terms, $signs);

$hits  = $index->find($query);]]>
            </programlisting>
        </para>

        <para>
            The <code>$signs</code> array contains information about the term type:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>true</code> is used to define required term.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>false</code> is used to define prohibited term.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>null</code> is used to define a term that is neither required nor prohibited.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.queries.boolean-query">
        <title>Boolean Query</title>
        <para>
            Boolean queries allow to construct query using other queries and boolean operators.
        </para>

        <para>
            Each subquery in a set can be defined as <emphasis>required</emphasis>,
            <emphasis>prohibited</emphasis>, or <emphasis>optional</emphasis>.

            <itemizedlist>
                <listitem>
                    <para>
                        <emphasis>required</emphasis> means that documents not matching this subquery will not match
                        the query;
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis>prohibited</emphasis> means that documents matching this subquery will not match
                        the query;
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <emphasis>optional</emphasis>, in which case matched documents are neither prohibited
                        from, nor required to, match the subquery. A document must match at least 1 subquery, however, to
                        match the query.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            If optional subqueries are added to a query with required suqueries,
            both queries will have the same result set but the optional suqueries may affect the score of the matched documents.
        </para>

        <para>
            Both search methods can be used for boolean queries.
        </para>

        <para>
            Query string:
        </para>
        <programlisting role="querystring"><![CDATA[+(word1 word2 word3) author:(word4 word5) -word6]]>
        </programlisting>

        <itemizedlist>
            <listitem>
                <para>
                    '+' is used to define a required subquery.
                </para>
            </listitem>
            <listitem>
                <para>
                    '-' is used to define a prohibited subquery.
                </para>
            </listitem>
            <listitem>
                <para>
                    'field:' prefix is used to indicate a document field for a search.
                    If it's omitted, then all fields are searched.
                </para>
            </listitem>
        </itemizedlist>

        <para>or</para>

        <para>
        Query construction by API:
        </para>
        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_Boolean();

$subquery1 = new Zend_Search_Lucene_Search_Query_MultiTerm();
$subquery1->addTerm(new Zend_Search_Lucene_Index_Term('word1'));
$subquery1->addTerm(new Zend_Search_Lucene_Index_Term('word2'));
$subquery1->addTerm(new Zend_Search_Lucene_Index_Term('word3'));

$subquery2 = new Zend_Search_Lucene_Search_Query_MultiTerm();
$subquery2->addTerm(new Zend_Search_Lucene_Index_Term('word4', 'author'));
$subquery2->addTerm(new Zend_Search_Lucene_Index_Term('word5', 'author'));

$term6 = new Zend_Search_Lucene_Index_Term('word6');
$subquery3 = new Zend_Search_Lucene_Search_Query_Term($term6);

$query->addSubquery($subquery1, true  /* required */);
$query->addSubquery($subquery2, null  /* optional */);
$query->addSubquery($subquery3, false /* prohibited */);

$hits  = $index->find($query);]]>
        </programlisting>

        <para>
            It's also possible to specify subqueries list within Boolean query constructor:
            <programlisting role="php"><![CDATA[<?php
...
$subqueries = array($subquery1, $subquery2, $subquery3);
$signs = array(true, null, false);

$query = new Zend_Search_Lucene_Search_Query_Boolean($subqueries, $signs);

$hits  = $index->find($query);]]>
            </programlisting>
        </para>

        <para>
            The <code>$signs</code> array contains information about the subquery type:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>true</code> is used to define required subquery.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>false</code> is used to define prohibited subquery.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>null</code> is used to define a subquery that is neither required nor prohibited.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        
        <para>
            Each query which uses boolean operators can be rewritten using signs notation and constructed using API. For example:
	        <programlisting role="querystring"><![CDATA[word1 AND (word2 AND word3 AND NOT word4) OR word5]]></programlisting>
	        is equivalent to
            <programlisting role="querystring"><![CDATA[(+(word1) +(+word2 +word3 -word4)) (word5)]]></programlisting>
        </para>
    </sect2>


    <sect2 id="zend.search.lucene.queries.wildcard">
        <title>Starting in 1.5, Wildcard Query</title>
        <para>
            Wildcard queries can be used to search for documents containing strings matching specified patterns.
        </para>

        <para>
            The '?' symbol is used as a single character wildcard.
        </para>

        <para>
            The '*' symbol is used as a multiple character wildcard.
        </para>

        <para>
            Query string:
            <programlisting role="querystring"><![CDATA[field1:test*]]></programlisting>
        </para>


        <para>or</para>

        <para>
            Query construction by API:
            <programlisting role="php"><![CDATA[<?php
$pattern = new Zend_Search_Lucene_Index_Term('test*', 'field1');
$query = new Zend_Search_Lucene_Search_Query_Wildcard($pattern);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>

        <para>
            The term field is optional. Zend_Search_Lucene searches through all fields on each document if a field is not specified:
            <programlisting role="php"><![CDATA[<?php
$pattern = new Zend_Search_Lucene_Index_Term('test*');
$query = new Zend_Search_Lucene_Search_Query_Wildcard($pattern);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.queries.fuzzy">
        <title>Starting in 1.5, Fuzzy Query</title>
        <para>
            Fuzzy queries can be used to search for documents containing strings matching terms similar to specified term.
        </para>

        <para>
            Query string:
            <programlisting role="querystring"><![CDATA[field1:test~]]></programlisting>
            This query matches documents containing 'test' 'text' 'best' words and others.
        </para>

        <para>or</para>

        <para>
            Query construction by API:
            <programlisting role="php"><![CDATA[<?php
$term = new Zend_Search_Lucene_Index_Term('test', 'field1');
$query = new Zend_Search_Lucene_Search_Query_Fuzzy($term);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>

        <para>
            Optional similarity can be specified after "~" sign.
        </para>

        <para>
            Query string:
            <programlisting role="querystring"><![CDATA[field1:test~0.4]]></programlisting>
        </para>

        <para>or</para>

        <para>
            Query construction by API:
            <programlisting role="php"><![CDATA[<?php
$term = new Zend_Search_Lucene_Index_Term('test', 'field1');
$query = new Zend_Search_Lucene_Search_Query_Fuzzy($term, 0.4);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>


        <para>
            The term field is optional. Zend_Search_Lucene searches through all fields on each document if a field is not specified:
            <programlisting role="php"><![CDATA[<?php
$term = new Zend_Search_Lucene_Index_Term('test');
$query = new Zend_Search_Lucene_Search_Query_Fuzzy($term);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.queries.phrase-query">
        <title>Phrase Query</title>
        <para>
            Phrase Queries can be used to search for a phrase within documents.
        </para>

        <para>
            Phrase Queries are very flexible and allow the user or developer to search for exact phrases as well as 'sloppy' phrases.
        </para>

        <para>
            Phrases can also contain gaps or terms in the same places; they can be generated by
            the analyzer for different purposes. For example, a term can be duplicated to increase the term
            its weight, or several synonyms can be placed into a single position.
        </para>

        <programlisting role="php"><![CDATA[<?php
$query1 = new Zend_Search_Lucene_Search_Query_Phrase();

// Add 'word1' at 0 relative position.
$query1->addTerm(new Zend_Search_Lucene_Index_Term('word1'));

// Add 'word2' at 1 relative position.
$query1->addTerm(new Zend_Search_Lucene_Index_Term('word2'));

// Add 'word3' at 3 relative position.
$query1->addTerm(new Zend_Search_Lucene_Index_Term('word3'), 3);

...

$query2 = new Zend_Search_Lucene_Search_Query_Phrase(
                array('word1', 'word2', 'word3'), array(0,1,3));

...

// Query without a gap.
$query3 = new Zend_Search_Lucene_Search_Query_Phrase(
                array('word1', 'word2', 'word3'));

...

$query4 = new Zend_Search_Lucene_Search_Query_Phrase(
                array('word1', 'word2'), array(0,1), 'annotation');]]>
        </programlisting>

        <para>
            A phrase query can be constructed in one step with a class constructor or step by step with
            <code>Zend_Search_Lucene_Search_Query_Phrase::addTerm()</code> method calls.
        </para>

        <para>
            Zend_Search_Lucene_Search_Query_Phrase class constructor takes three optional arguments:
        </para>
        <programlisting role="php"><![CDATA[<?php
Zend_Search_Lucene_Search_Query_Phrase([array $terms[, array $offsets[, string $field]]]);]]>
        </programlisting>

        <para>
            The <code>$terms</code> parameter is an array of strings that contains a set of phrase terms.
            If it's omitted or equal to null, then an empty query is constructed.
        </para>

        <para>
            The <code>$offsets</code> parameter is an array of integers that contains offsets of terms in a phrase.
            If it's omitted or equal to null, then the terms' positions are assumed to be sequential with no gaps.
        </para>

        <para>
            The <code>$field</code> parameter is a string that indicates the document field to search.
            If it's omitted or equal to null, then the default field is searched.
        </para>

        <para>
            Thus:
        </para>
        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_Phrase(array('zend', 'framework'));]]>
        </programlisting>
        <para>
            will search for the phrase 'zend framework' in all fields.
        </para>

        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_Phrase(array('zend', 'download'), array(0, 2));]]>
        </programlisting>
        <para>
            will search for the phrase 'zend ????? download' and match 'zend platform download', 'zend studio
            download', 'zend core download', 'zend framework download', and so on.
        </para>

        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_Phrase(array('zend', 'framework'), null, 'title');]]>
        </programlisting>

        <para>
            will search for the phrase 'zend framework' in the 'title' field.
        </para>


        <para>
            <code>Zend_Search_Lucene_Search_Query_Phrase::addTerm()</code> takes two arguments, a
            required <code>Zend_Search_Lucene_Index_Term</code> object and an optional position:
        </para>
        <programlisting role="php"><![CDATA[<?php
Zend_Search_Lucene_Search_Query_Phrase::addTerm(Zend_Search_Lucene_Index_Term $term[, integer $position]);]]>
        </programlisting>

        <para>
            The <code>$term</code> parameter describes the next term in the phrase. It must indicate the same field as previous terms, or an exception will be thrown.
        </para>

        <para>
            The <code>$position</code> parameter indicates the term position in the phrase.
        </para>

        <para>
            Thus:
        </para>
        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_Phrase();
$query->addTerm(new Zend_Search_Lucene_Index_Term('zend'));
$query->addTerm(new Zend_Search_Lucene_Index_Term('framework'));]]>
        </programlisting>
        <para>
            will search for the phrase 'zend framework'.
         </para>

        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_Phrase();
$query->addTerm(new Zend_Search_Lucene_Index_Term('zend'), 0);
$query->addTerm(new Zend_Search_Lucene_Index_Term('framework'), 2);]]>
        </programlisting>
        <para>
            will search for the phrase 'zend ????? download' and match 'zend platform download', 'zend studio
            download', 'zend core download', 'zend framework download', and so on.
        </para>
        <programlisting role="php"><![CDATA[<?php
$query = new Zend_Search_Lucene_Search_Query_Phrase();
$query->addTerm(new Zend_Search_Lucene_Index_Term('zend', 'title'));
$query->addTerm(new Zend_Search_Lucene_Index_Term('framework', 'title'));]]>
        </programlisting>
        <para>
            will search for the phrase 'zend framework' in the 'title' field.
        </para>


        <para>
            The slop factor sets the number of other words permitted between specified words in the query phrase. If set to zero,
            then the corresponding query is an exact phrase search.  For larger values this works like the WITHIN or NEAR
            operators.
        </para>
        <para>
            The slop factor is in fact an edit distance, where the edits correspond to moving terms in the query
            phrase.  For example, to switch the order of two words requires two moves (the
            first move places the words atop one another), so to permit re-orderings of phrases, the slop factor
            must be at least two.
        </para>
        <para>
            More exact matches are scored higher than sloppier matches; thus, search results are sorted by
            exactness. The slop is zero by default, requiring exact matches.
        </para>
        <para>
            The slop factor can be assigned after query creation:
        </para>
        <programlisting role="php"><![CDATA[<?php
// Query without a gap.
$query = new Zend_Search_Lucene_Search_Query_Phrase(array('word1', 'word2'));

// Search for 'word1 word2', 'word1 ... word2'
$query->setSlop(1);
$hits1 = $index->find($query);

// Search for 'word1 word2', 'word1 ... word2',
// 'word1 ... ... word2', 'word2 word1'
$query->setSlop(2);
$hits2 = $index->find($query);]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.search.lucene.queries.range">
        <title>Starting in 1.5, Range Query</title>
        <para>
            <link linkend="zend.search.lucene.query-language.range">Range queries</link> are intended for searching terms within specified interval.
        </para>

        <para>
            Query string:
            <programlisting role="querystring"><![CDATA[mod_date:[20020101 TO 20030101]
title:{Aida TO Carmen}]]></programlisting>
        </para>

        <para>or</para>

        <para>
            Query construction by API:
            <programlisting role="php"><![CDATA[<?php
$from = new Zend_Search_Lucene_Index_Term('20020101', 'mod_date');
$to   = new Zend_Search_Lucene_Index_Term('20030101', 'mod_date');
$query = new Zend_Search_Lucene_Search_Query_Range($from, $to, true /* inclusive */);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>

        <para>
            Term fields are optional. Zend_Search_Lucene searches through all fields if the field is not specified:
            <programlisting role="php"><![CDATA[<?php
$from = new Zend_Search_Lucene_Index_Term('Aida');
$to   = new Zend_Search_Lucene_Index_Term('Carmen');
$query = new Zend_Search_Lucene_Search_Query_Range($from, $to, false /* non-inclusive */);
$hits  = $index->find($query);]]>
            </programlisting>
        </para>

        <para>
            Either (but not both) of the boundary terms may be set to null. Zend_Search_Lucene searches from the beginning or
            up to the end of the dictionary for the specified field(s) in this case:
            <programlisting role="php"><![CDATA[<?php
$from = new Zend_Search_Lucene_Index_Term('20020101', 'mod_date');
$query = new Zend_Search_Lucene_Search_Query_Range($from, null, true /* inclusive */);  // searches for ['20020101' TO ...]
$hits  = $index->find($query);]]>
            </programlisting>
        </para>
    </sect2>

</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.search.lucene.query-language">
    <title>Query Language</title>

    <para>
        Java Lucene and Zend_Search_Lucene provide quite powerful query languages.
    </para>

    <para>
        These languages are mostly the same with some minor differences, which are mentioned below.
    </para>

    <para>
        Full Java Lucene query language syntax documentation can be found
        <ulink url="http://lucene.apache.org/java/2_0_0/queryparsersyntax.html">here</ulink>.
    </para>

    <sect2 id="zend.search.lucene.query-language.terms">
        <title>Terms</title>

        <para>
            A query is broken up into terms and operators. There are three types of terms: Single Terms, Phrases,
            and Subqueries.
        </para>
        <para>
            A Single Term is a single word such as "test" or "hello".
        </para>
        <para>
            A Phrase is a group of words surrounded by double quotes such as "hello dolly".
        </para>
        <para>
            A Subquery is a query surrounded by parentheses such as "(hello dolly)".
        </para>
        <para>
            Multiple terms can be combined together with boolean operators to form complex queries (see below).
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.fields">
        <title>Fields</title>

        <para>
            Lucene supports fields of data. When performing a search you can either specify a field, or use
            the default field. The field names depend on indexed data and default field is defined
            by current settings.
        </para>
        <para>
            The first and most significant difference from Java Lucene is that terms are searched through
            <emphasis>all fields</emphasis> by default.
        </para>
        <para>
            There are two static methods in the Zend_Search_Lucene class which allow the developer to configure these settings:
        </para>
        <programlisting role="php"><![CDATA[<?php
$defaultSearchField = Zend_Search_Lucene::getDefaultSearchField();
...
Zend_Search_Lucene::setDefaultSearchField('contents');]]>
        </programlisting>

        <para>
            The <code>null</code> value indicated that the search is performed across all fields. It's the default setting.
        </para>
        <para>
            You can search specific fields by typing the field name followed by a colon ":" followed by the term you
            are looking for.
        </para>
        <para>
            As an example, let's assume a Lucene index contains two fields- title and text- with text as the default field.
            If you want to find the document entitled "The Right Way" which contains the text "don't go this way",
            you can enter:
        </para>
        <programlisting role="querystring"><![CDATA[title:"The Right Way" AND text:go]]>
        </programlisting>
        <para>
            or
        </para>
        <programlisting role="querystring"><![CDATA[title:"Do it right" AND go]]>
        </programlisting>
        <para>
            Because "text" is the default field, the field indicator is not required.
        </para>

        <para>
            Note: The field is only valid for the term, phrase or subquery that it directly precedes,
            so the query
            <programlisting role="querystring"><![CDATA[title:Do it right]]>
            </programlisting>
            Will only find "Do" in the title field. It will find "it" and "right" in the default field (if the default field is set)
            or in all indexed fields (if the default field is set to <code>null</code>).
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.wildcard">
        <title>Starting in 1.5, Wildcards<footnote><para>Wildcard queries  support is available with SVN and latest snapshot versions and 
               doesn't included into current release.</para></footnote></title>
        <para>
            Lucene supports single and multiple character wildcard searches within single terms (but not within phrase queries).
        </para>

        <para>
            To perform a single character wildcard search use the "?" symbol.
        </para>

        <para>
            To perform a multiple character wildcard search use the "*" symbol.
        </para>

        <para>
            The single character wildcard search looks for string that match the term with the "?" replaced by any single character.
            For example, to search for "text" or "test" you can use the search:
            <programlisting role="querystring"><![CDATA[te?t]]>
            </programlisting>
        </para>

        <para>
            Multiple character wildcard searches look for 0 or more characters when matching strings against terms. For example, to search for test,
            tests or tester, you can use the search:
            <programlisting role="querystring"><![CDATA[test*]]>
            </programlisting>
        </para>

        <para>
            You can use "?", "*" or both at any place of the term:
            <programlisting role="querystring"><![CDATA[*wr?t*]]>
            </programlisting>
            It searches for "write", "wrote", "written", "rewrite", "rewrote" and so on.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.modifiers">
        <title>Term Modifiers</title>

        <para>
            Lucene supports modifying query terms to provide a wide range of searching options.
        </para>
        <para>
            "~" modifier can be used to specify proximity search for phrases or fuzzy search for individual terms.
            <footnote>
                <para>
                    Fuzzy search is availably only starting ZF 1.5
                </para>
            </footnote>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.range">
        <title>Starting in 1.5, Range Searches<footnote><para>Range queries support is available with SVN and latest snapshot versions and 
               doesn't included into current release.</para></footnote></title>
        <para>
            Range queries allow the developer or user to match documents whose field(s) values are between the lower and upper bound specified by the range query.
            Range Queries can be inclusive or exclusive of the upper and lower bounds. Sorting is performed lexicographically.
            <programlisting role="querystring"><![CDATA[mod_date:[20020101 TO 20030101]]]>
            </programlisting>
            This will find documents whose mod_date fields have values between 20020101 and 20030101, inclusive. Note that Range Queries are not
            reserved for date fields. You could also use range queries with non-date fields:
            <programlisting role="querystring"><![CDATA[title:{Aida TO Carmen}]]>
            </programlisting>
            This will find all documents whose titles would be sorted between Aida and Carmen, but not including Aida and Carmen.
        </para>
        <para>
            Inclusive range queries are denoted by square brackets. Exclusive range queries are denoted by curly brackets.
        </para>
        <para>
            If field is not specified then Zend_Search_Lucene searches for specified interval through all fields by default.
            <programlisting role="querystring"><![CDATA[{Aida TO Carmen}]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.fuzzy">
        <title>Starting in 1.5, Fuzzy Searches<footnote><para>Fuzzy queries support is available with SVN and latest snapshot versions and 
               doesn't included into current release.</para></footnote></title>
        <para>
            Zend_Search_Lucene as well as Java Lucene supports fuzzy searches based on the Levenshtein Distance, or Edit Distance algorithm. 
            To do a fuzzy search use the tilde, "~", symbol at the end of a Single word Term. For example to search for a term similar 
            in spelling to "roam" use the fuzzy search:

            <programlisting role="querystring"><![CDATA[roam~]]></programlisting>

            This search will find terms like foam and roams.

            Additional (optional) parameter can specify the required similarity. The value is between 0 and 1, with a value closer to 1 only terms 
            with a higher similarity will be matched. For example:

            <programlisting role="querystring"><![CDATA[roam~0.8]]></programlisting>

            The default that is used if the parameter is not given is 0.5.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.proximity-search">
        <title>Proximity Searches</title>

        <para>
            Lucene supports finding words from a phrase that are within a specified word distance in a string. To do a proximity search
            use the tilde, "~", symbol at the end of the phrase. For example to search for a "Zend" and
            "Framework" within 10 words of each other in a document use the search:
            <programlisting role="querystring"><![CDATA["Zend Framework"~10]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.boosting">
        <title>Boosting a Term</title>

        <para>
            Java Lucene and Zend_Search_Lucene provide the relevance level of matching documents based
            on the terms found. To boost the relevance of a term use the caret, "^", symbol with a boost factor (a number)
            at the end of the term you are searching. The higher the boost factor, the more relevant
            the term will be.
        </para>
        <para>
            Boosting allows you to control the relevance of a document by boosting individual terms. For example,
            if you are searching for
            <programlisting role="querystring"><![CDATA[PHP framework]]>
            </programlisting>
            and you want the term "PHP" to be more relevant boost it using the ^ symbol along with the
            boost factor next to the term. You would type:
            <programlisting role="querystring"><![CDATA[PHP^4 framework]]>
            </programlisting>
            This will make documents with the term PHP appear more relevant. You can also boost phrase
            terms and subqueries as in the example:
            <programlisting role="querystring"><![CDATA["PHP framework"^4 "Zend Framework"]]>
            </programlisting>
            By default, the boost factor is 1. Although the boost factor must be positive,
            it may be less than 1 (e.g. 0.2).
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.boolean">
        <title>Boolean Operators</title>

        <para>
            Boolean operators allow terms to be combined through logic operators.
            Lucene supports AND, "+", OR, NOT and "-" as Boolean operators.
            Java Lucene requires boolean operators to be ALL CAPS. Zend_Search_Lucene does not.
        </para>

        <para>
            AND, OR, and NOT operators and "+", "-" defines two different styles to construct boolean queries.
            Unlike Java Lucene, Zend_Search_Lucene doesn't allow these two styles to be mixed.
        </para>
        <para>
            If the AND/OR/NOT style is used, then an AND or OR operator must be present between all query terms.
            Each term may also be preceded by NOT operator. The AND operator has higher precedence than the OR operator.
            This differs from Java Lucene behavior.
        </para>

        <sect3 id="zend.search.lucene.query-language.boolean.and">
            <title>AND</title>
            <para>
                The AND operator means that all terms in the "AND group" must match some part of the searched field(s).
            </para>
            <para>
                To search for documents that contain "PHP framework" and "Zend Framework" use the query:
                <programlisting role="querystring"><![CDATA["PHP framework" AND "Zend Framework"]]>
                </programlisting>
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.query-language.boolean.or">
            <title>OR</title>
            <para>
                The OR operator divides the query into several optional terms.
            </para>
            <para>
                To search for documents that contain "PHP framework" or "Zend Framework" use the query:
                <programlisting role="querystring"><![CDATA["PHP framework" OR "Zend Framework"]]>
                </programlisting>
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.query-language.boolean.not">
            <title>NOT</title>
            <para>
                The NOT operator excludes documents that contain the term after NOT. But an "AND group" which contains
                only terms with the NOT operator gives an empty result set instead of a full set of indexed documents.
            </para>
            <para>
                To search for documents that contain "PHP framework" but not "Zend Framework" use the query:
                <programlisting role="querystring"><![CDATA["PHP framework" AND NOT "Zend Framework"]]>
                </programlisting>
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.query-language.boolean.other-form">
            <title>&amp;&amp;, ||, and ! operators</title>
            <para>
                &amp;&amp;, ||, and ! may be used instead of AND, OR, and NOT notation.
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.query-language.boolean.plus">
            <title>+</title>
            <para>
                The "+" or required operator stipulates that the term after the "+" symbol must match the document.
            </para>
            <para>
                To search for documents that must contain "Zend" and may contain "Framework" use the query:
                <programlisting role="querystring"><![CDATA[+Zend Framework]]>
                </programlisting>
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.query-language.boolean.minus">
            <title>-</title>
            <para>
                The "-" or prohibit operator excludes documents that match the term after the "-" symbol.
            </para>
            <para>
                To search for documents that contain "PHP framework" but not "Zend Framework" use the query:
                <programlisting role="querystring"><![CDATA["PHP framework" -"Zend Framework"]]>
                </programlisting>
            </para>
        </sect3>

        <sect3 id="zend.search.lucene.query-language.boolean.no-operator">
            <title>No Operator</title>
            <para>
                If no operator is used, then the search behavior is defined by the "default boolean operator".
            </para>
            <para>
                This is set to <code>OR</code> by default.
            </para>
            <para>
                That implies each term is optional by default. It may or may not be present within document, but documents with this term
                will recieve a higher score.
            </para>
            <para>
                To search for documents that requires "PHP framework" and may contain "Zend Framework" use the query:
                <programlisting role="querystring"><![CDATA[+"PHP framework" "Zend Framework"]]>
                </programlisting>
            </para>

            <para>
                The default boolean operator may be set or retrieved with the
                <code>Zend_Search_Lucene_Search_QueryParser::setDefaultOperator($operator)</code> and
                <code>Zend_Search_Lucene_Search_QueryParser::getDefaultOperator()</code> methods, respectively.
            </para>
            <para>
                These methods operate with the
                <code>Zend_Search_Lucene_Search_QueryParser::B_AND</code> and
                <code>Zend_Search_Lucene_Search_QueryParser::B_OR</code> constants.
            </para>
        </sect3>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.grouping">
        <title>Grouping</title>

        <para>
            Java Lucene and Zend_Search_Lucene support using parentheses to group clauses to form sub queries. This can be
            useful if you want to control the precedence of boolean logic operators for a query or mix different boolean query styles:
            <programlisting role="querystring"><![CDATA[+(framework OR library) +php]]>
            </programlisting>
            Zend_Search_Lucene supports subqueries nested to any level.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.field-grouping">
        <title>Field Grouping</title>

        <para>
            Lucene also supports using parentheses to group multiple clauses to a single field.
        </para>
        <para>
            To search for a title that contains both the word "return" and the phrase "pink panther" use the query:
            <programlisting role="querystring"><![CDATA[title:(+return +"pink panther")]]>
            </programlisting>
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.query-language.escaping">
        <title>Escaping Special Characters</title>

        <para>
            Lucene supports escaping special characters that are used in query syntax. The current list of special
            characters is:
        </para>
        <para>
            + - &amp;&amp; || ! ( ) { } [ ] ^ " ~ * ? : \
        </para>
        <para>
            + and - inside single terms are automatically treated as common characters.
        </para>
        <para>
            For other instances of these characters use the \ before each special character you'd like to escape. For example to search for (1+1):2 use the query:
            <programlisting role="querystring"><![CDATA[\(1\+1\)\:2]]>
            </programlisting>
        </para>
    </sect2>

</sect1>
<sect1 id="zend.search.lucene.searching">
    <title>Searching an Index</title>

    <sect2 id="zend.search.lucene.searching.query_building">
        <title>Building Queries</title>

        <para>
            There are two ways to search the index. The first method uses
            query parser to construct a query from a string. The second is
            to programmatically create your own queries through the Zend_Search_Lucene API.
        </para>

        <para>
        Before choosing to use the provided query parser, please consider
        the following:

            <orderedlist>
                <listitem>
                    <para>
                        If you are programmatically creating a query string and then parsing
                        it with the query parser then you should consider building
                        your queries directly with the query API. Generally speaking, the query
                        parser is designed for human-entered text, not for program-generated text.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Untokenized fields are best added directly to queries and not through
                        the query parser. If a field's values are generated programmatically
                        by the application, then the query clauses for this field should also
                        be constructed programmatically.
                        An analyzer, which the query parser uses, is designed to convert
                        human-entered text to terms. Program-generated values, like dates,
                        keywords, etc., should be added with the query API.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        In a query form, fields that are general text should use the query parser.
                        All others, such as date ranges, keywords, etc., are better added directly
                        through the query API. A field with a limited set of values that can be
                        specified with a pull-down menu should not be added to a query string
                        that is subsequently parsed but instead should be added as a TermQuery clause.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Boolean queries allow the programmer to logically combine two or more queries into new one.
                        Thus it's the best way to add additional criteria to a search defined by
                        a query string.
                    </para>
                </listitem>
            </orderedlist>

        </para>

        <para>
            Both ways use the same API method to search through the index:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Search/Lucene.php';

$index = Zend_Search_Lucene::open('/data/my_index');

$index->find($query);]]>
        </programlisting>
        <para>
            The <code>Zend_Search_Lucene::find()</code> method determines the input type automatically and
            uses the query parser to construct an appropriate Zend_Search_Lucene_Search_Query object
            from an input of type string.
        </para>

        <para>
            It is important to note that the query parser uses the standard analyzer to tokenize separate parts of query string.
            Thus all transformations which are applied to indexed text are also applied to query strings.
        </para>
        <para>
            The standard analyzer may transform the query string to lower case for case-insensitivity, remove stop-words, and stem among other transformations.
        </para>
        <para>
            The API method doesn't transform or filter input terms in any way. It's therefore more suitable for
            computer generated or untokenized fields.
        </para>

        <sect3 id="zend.search.lucene.searching.query_building.parsing">
            <title>Query Parsing</title>
            <para>
                <code>Zend_Search_Lucene_Search_QueryParser::parse()</code> method may be used to parse query strings
                into query objects.
            </para>

            <para>
                This query object may be used in query construction API methods to combine user entered queries with
                programmatically generated queries.
            </para>

            <para>
                Actually, in some cases it's the only way to search for values within untokenized fields:

                <programlisting role="php"><![CDATA[<?php
$userQuery = Zend_Search_Lucene_Search_QueryParser::parse($queryStr);

$pathTerm  = new Zend_Search_Lucene_Index_Term('/data/doc_dir/' . $filename, 'path');
$pathQuery = new Zend_Search_Lucene_Search_Query_Term($pathTerm);

$query = new Zend_Search_Lucene_Search_Query_Boolean();
$query->addSubquery($userQuery, true /* required */);
$query->addSubquery($pathQuery, true /* required */);

$hits = $index->find($query);]]>
                </programlisting>
            </para>

            <para>
                <code>Zend_Search_Lucene_Search_QueryParser::parse()</code> method also takes an optional encoding parameter,
                which can specify query string encoding:
            <programlisting role="php"><![CDATA[<?php
$userQuery = Zend_Search_Lucene_Search_QueryParser::parse($queryStr, 'iso-8859-5');]]>
            </programlisting>
            </para>

            <para>
                If the encoding parameter is omitted, then current locale is used.
            </para>

            <para>
                It's also possible to specify the default query string encoding with
                <code>Zend_Search_Lucene_Search_QueryParser::setDefaultEncoding()</code> method:
                <programlisting role="php"><![CDATA[<?php
Zend_Search_Lucene_Search_QueryParser::setDefaultEncoding('iso-8859-5');
...
$userQuery = Zend_Search_Lucene_Search_QueryParser::parse($queryStr);]]>
                </programlisting>
            </para>

            <para>
                <code>Zend_Search_Lucene_Search_QueryParser::getDefaultEncoding()</code> returns the current default query
                string encoding (the empty string means "current locale").
            </para>
        </sect3>
    </sect2>

    <sect2 id="zend.search.lucene.searching.results">
        <title>Search Results</title>
        <para>
            The search result is an array of Zend_Search_Lucene_Search_QueryHit objects.  Each of these has
            two properties: <code>$hit->document</code> is a document number within
            the index and <code>$hit->score</code> is a score of the hit in
            a search result. The results are ordered by score (descending from highest score).
        </para>

        <para>
            The Zend_Search_Lucene_Search_QueryHit object also exposes each field of the Zend_Search_Lucene_Document found in the search 
            as a property of the hit.  In the following example, a hit is returned with two fields from the corresponding document: title and author.
        </para>
        <programlisting role="php"><![CDATA[<?php
require_once('Zend/Search/Lucene.php');

$index = Zend_Search_Lucene::open('/data/my_index');

$hits = $index->find($query);

foreach ($hits as $hit) {
    echo $hit->score;
    echo $hit->title;
    echo $hit->author;
}]]>
        </programlisting>

        <para>
            Stored fields are always returned in UTF-8 encoding.
        </para>

        <para>
            Optionally, the original Zend_Search_Lucene_Document object can be returned from the
            Zend_Search_Lucene_Search_QueryHit.

            You can retrieve stored parts of the document by using the <code>getDocument()</code>
            method of the index object and then get them by
            <code>getFieldValue()</code> method:
        </para>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Search/Lucene.php';

$index = Zend_Search_Lucene::open('/data/my_index');

$hits = $index->find($query);
foreach ($hits as $hit) {
    // return Zend_Search_Lucene_Document object for this hit
    echo $document = $hit->getDocument();

    // return a Zend_Search_Lucene_Field object
    // from the Zend_Search_Lucene_Document
    echo $document->getField('title');

    // return the string value of the Zend_Search_Lucene_Field object
    echo $document->getFieldValue('title');

    // same as getFieldValue()
    echo $document->title;
}]]>
        </programlisting>
        <para>
        The fields available from the Zend_Search_Lucene_Document object are determined at
        the time of indexing.  The document fields are either indexed, or
        index and stored, in the document by the indexing application
        (e.g. LuceneIndexCreation.jar).
        </para>

        <para>
        Note that the document identity ('path' in our example) is also stored
        in the index and must be retrieved from it.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.searching.results-limiting">
        <title>Limiting the Result Set</title>

        <para>
            The most computationally expensive part of searching is score calculation. It may take several seconds for large result sets (tens of thousands of hits).
        </para>

        <para>
            Zend_Search_Lucene gives the possibility to limit result set size with <code>getResultSetLimit()</code> and
            <code>setResultSetLimit()</code> methods:
            <programlisting role="php"><![CDATA[<?php
$currentResultSetLimit = Zend_Search_Lucene::getResultSetLimit();

Zend_Search_Lucene::setResultSetLimit($newLimit);]]>
            </programlisting>
            The default value of 0 means 'no limit'.
        </para>

        <para>
            It doesn't give the 'best N' results, but only the 'first N'<footnote><para>Returned hits are still ordered by score or by the the specified order, if given.</para></footnote>.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.searching.results-scoring">
        <title>Results Scoring</title>
        <para>
            Zend_Search_Lucene uses the same scoring algorithms as Java Lucene.
            All hits in the search result are ordered by score by default. Hits with greater score come first, and
            documents having higher scores should match the query more precisely than documents having lower scores.
        </para>

        <para>
            Roughly speaking, search hits that contain the searched term or phrase more frequently
            will have a higher score.
        </para>

        <para>
            A hit's score can be retrieved by accessing the <code>score</code> property of the hit:
        </para>
        <programlisting role="php"><![CDATA[<?php
$hits = $index->find($query);

foreach ($hits as $hit) {
    echo $hit->id;
    echo $hit->score;
}]]>
        </programlisting>

        <para>
            The Zend_Search_Lucene_Search_Similarity class is used to calculate the score for each hit.
            See <link linkend="zend.search.lucene.extending.scoring">Extensibility. Scoring Algorithms</link> section for details.
        </para>

    </sect2>

    <sect2 id="zend.search.lucene.searching.sorting">
        <title>Search Result Sorting</title>
        <para>
            By default, the search results are ordered by score. The programmer can change this behavior by setting a sort field (or a list of fields), sort type
            and sort order parameters.
        </para>

        <para>
            <code>$index->find()</code> call may take several optional parameters:
            <programlisting role="php"><![CDATA[<?php
$index->find($query [, $sortField [, $sortType [, $sortOrder]]] [, $sortField2 [, $sortType [, $sortOrder]]] ...);]]>
            </programlisting>
        </para>

        <para>
             A name of stored field by which to sort result should be passed as the <code>$sortField</code> parameter.
        </para>

        <para>
            <code>$sortType</code> may be omitted or take the following enumerated values:
            <code>SORT_REGULAR</code> (compare items normally- default value),
            <code>SORT_NUMERIC</code> (compare items numerically),
            <code>SORT_STRING</code> (compare items as strings).
        </para>

        <para>
            <code>$sortOrder</code> may be omitted or take the following enumerated values:
            <code>SORT_ASC</code> (sort in ascending order- default value),
            <code>SORT_DESC</code> (sort in descending order).
        </para>

        <para>
            Examples:
            <programlisting role="php"><![CDATA[<?php
$index->find($query, 'quantity', SORT_NUMERIC, SORT_DESC);]]>
            </programlisting>
            <programlisting role="php"><![CDATA[<?php
$index->find($query, 'fname', SORT_STRING, 'lname', SORT_STRING);]]>
            </programlisting>
            <programlisting role="php"><![CDATA[<?php
$index->find($query, 'name', SORT_STRING, 'quantity', SORT_NUMERIC, SORT_DESC);]]>
            </programlisting>
        </para>

        <para>
            Please use caution when using a non-default search order;
            the query needs to retrieve documents completely from an index, which may dramatically reduce search performance.
        </para>
    </sect2>

    <sect2 id="zend.search.lucene.searching.highlighting">
        <title>Search Results Highlighting</title>
        <para>
            <code>Zend_Search_Lucene_Search_Query::highlightMatches()</code> method allows the developer to highlight HTML document terms
            in the context of a search query:
            <programlisting role="php"><![CDATA[<?php
$query = Zend_Search_Lucene_Search_QueryParser::parse($queryStr);
$hits = $index->find($query);
...
$highlightedHTML = $query->highlightMatches($sourceHTML);]]>
            </programlisting>
        </para>

        <para>
            <code>highlightMatches()</code> method utilizes <code>Zend_Search_Lucene_Document_Html</code> class
            (see <link linkend="zend.search.lucene.index-creation.html-documents">HTML documents section</link> for details)
            for HTML processing, so it has the same requirements for HTML source.
        </para>
    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.server.introduction">
    <title>Introduction</title>
    <para>
        The <code>Zend_Server</code> family of classes provides functionality
        for the various server classes, including
        <code>Zend_XmlRpc_Server</code>, <code>Zend_Rest_Server</code>,
        <code>Zend_Json_Server</code> and <code>Zend_Soap_Wsdl</code>.
        <code>Zend_Server_Interface</code> provides an interface that mimics PHP
        5's <code>SoapServer</code> class; all server classes should implement
        this interface in order to provide a standard server API.
    </para>
    <para>
        The <code>Zend_Server_Reflection</code> tree provides a standard
        mechanism for performing function and class introspection for use as
        callbacks with the server classes, and provides data suitable for use
        with <code>Zend_Server_Interface</code>'s <code>getFunctions()</code>
        and <code>loadFunctions()</code> methods.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.server.reflection">
    <title>Zend_Server_Reflection</title>

    <sect2 id="zend.server.reflection.introduction">
        <title>Introduction</title>

        <para>
            Zend_Server_Reflection provides a standard mechanism for performing
            function and class introspection for use with server classes. It is
            based on PHP 5's Reflection API, and extends it to provide methods
            for retrieving parameter and return value types and descriptions, a
            full list of function and method prototypes (i.e., all possible
            valid calling combinations), and function/method descriptions.
        </para>
        <para>
            Typically, this functionality will only be used by developers of
            server classes for the framework.
        </para>
    </sect2>
    <sect2 id="zend.server.reflection.usage">
        <title>Usage</title>

        <para>
            Basic usage is simple:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Server/Reflection.php';
$class    = Zend_Server_Reflection::reflectClass('My_Class');
$function = Zend_Server_Reflection::reflectFunction('my_function');

// Get prototypes
$prototypes = $reflection->getPrototypes();

// Loop through each prototype for the function
foreach ($prototypes as $prototype) {

    // Get prototype return type
    echo "Return type: ", $prototype->getReturnType(), "\n";

    // Get prototype parameters
    $parameters = $prototype->getParameters();

    echo "Parameters: \n";
    foreach ($parameters as $parameter) {
        // Get parameter type
        echo "    ", $parameter->getType(), "\n";
    }
}

// Get namespace for a class, function, or method.
// Namespaces may be set at instantiation time (second argument), or using
// setNamespace()
$reflection->getNamespace();]]>
        </programlisting>

        <para>
            <code>reflectFunction()</code> returns a
            <code>Zend_Server_Reflection_Function</code> object;
            <code>reflectClass</code> returns a
            <code>Zend_Server_Reflection_Class</code> object. Please refer to
            the API documentation to know what methods are available to each.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.service.introduction">
    <title>Introduction</title>
    <para>
        <code>Zend_Service</code> is an abstract class which serves as a
        foundation for web service implementations, such as SOAP or REST.
    </para>
    <para>
        If you need support for generic, XML-based REST services, you may want
        to look at <link linkend="zend.rest.client"><code>Zend_Rest_Client</code></link>.
    </para>
    <para>
        In addition to being able to extend the <code>Zend_Service</code> and
        use <code>Zend_Rest_Client</code> for REST-based web services, Zend also
        provides support for popular web services.  See the following sections
        for specific information on each supported web service.
    </para>

    <itemizedlist>
        <listitem>
            <para>
                <link linkend="zend.service.akismet">Akismet</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.amazon">Amazon</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.audioscrobbler">Audioscrobbler</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.delicious">Del.icio.us</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.flickr">Flickr</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.simpy">Simpy</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.slideshare">SlideShare</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.strikeiron">StrikeIron</link>
            </para>
        </listitem>
        <listitem>
            <para>
                <link linkend="zend.service.yahoo">Yahoo!</link>
            </para>
        </listitem>
    </itemizedlist>

    <para>
        Additional services are coming in the future.
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.service.akismet">
    <title>Zend_Service_Akismet</title>

    <sect2 id="zend.service.akismet.introduction">
        <title>Introduction</title>

        <para>
            <code>Zend_Service_Akismet</code> provides a client for the <ulink
                url="http://akismet.com/development/api/">Akismet API</ulink>.
            The Akismet service is used to determine if incoming data is
            potentially spam; it also exposes methods for submitting data as
            known spam or as false positives (ham). Originally intended to help
            categorize and identify spam for Wordpress, it can be used for any
            type of data.
        </para>

        <para>
            Akismet requires an API key for usage. You may get one for signing
            up for a <ulink url="http://wordpress.com/">WordPress.com</ulink>
            account. You do not need to activate a blog; simply acquiring the
            account will provide you with the API key.
        </para>

        <para>
            Additionally, Akismet requires that all requests contain a URL to
            the resource for which data is being filtered, and, because of
            Akismet's origins in WordPress, this resource is called the blog
            url. This value should be passed as the second argument to the
            constructor, but may be reset at any time using the
            <code>setBlogUrl()</code> accessor, or overridden by specifying a
            'blog' key in the various method calls.
        </para>
    </sect2>

    <sect2 id="zend.service.akismet.verifykey">
        <title>Verify an API key</title>

        <para>
            <code>Zend_Service_Akismet::verifyKey($key)</code> is used to
            verify that an Akismet API key is valid. In most cases, you
            will not need to check, but if you need a sanity check, or
            to determine if a newly acquired key is active, you may do
            so with this method.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Akismet.php';

// Instantiate with the API key and a URL to the application or resource being
// used
$akismet = new Zend_Service_Akismet($apiKey, 'http://framework.zend.com/wiki/');
if ($akismet->verifyKey($apiKey) {
echo "Key is valid.\n";
} else {
echo "Key is not valid\n";
}]]>
        </programlisting>

        <para>
            If called with no arguments, <code>verifyKey()</code> uses
            the API key provided to the constructor.
        </para>

        <para>
            <code>verifyKey()</code> implements Akismet's
            <code>verify-key</code> REST method.
        </para>
    </sect2>

    <sect2 id="zend.service.akismet.isspam">
        <title>Check for spam</title>

        <para>
            <code>Zend_Service_Akismet::isSpam($data)</code> is used to
            determine if the data provided is considered spam by
            Akismet. It accepts an associative array as the sole
            argument. That array requires the following keys be set:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>user_ip</code>, the IP address of the user
                    submitting the data (not your IP address, but that
                    of a user on your site).
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>user_agent</code>, the reported UserAgent
                    string (browser and version) of the user submitting
                    the data.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            The following keys are also recognized specifically by the
            API:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>blog</code>, the fully qualified URL to the
                    resource or application. If not specified, the URL
                    provided to the constructor will be used.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>referrer</code>, the content of the
                    HTTP_REFERER header at the time of submission. (Note
                    spelling; it does not follow the header name.)
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>permalink</code>, the permalink location, if
                    any, of the entry the data was submitted to.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>comment_type</code>, the type of data
                    provided. Values specifically specified in the API
                    include 'comment', 'trackback', 'pingback', and an
                    empty string (''), but it may be any value.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>comment_author</code>, name of the person
                    submitting the data.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>comment_author_email</code>, email of the
                    person submitting the data.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>comment_author_url</code>, URL or home page of the
                    person submitting the data.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>comment_content</code>, actual data content
                    submitted.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            You may also submit any other environmental variables you
            feel might be a factor in determining if data is spam.
            Akismet suggests the contents of the entire $_SERVER array.
        </para>

        <para>
            The <code>isSpam()</code> method will return either true or
            false, and throw an exception if the API key is invalid.
        </para>

        <example id="zend.service.akismet.isspam.example-1">
            <title>isSpam() Usage</title>

            <programlisting role="php"><![CDATA[<?php
$data = array(
    'user_ip'              => '111.222.111.222',
    'user_agent'           => 'Mozilla/5.0 (Windows; U; Windows NT 5.2; en-GB; rv:1.8.1) Gecko/20061010 Firefox/2.0',
    'comment_type'         => 'contact',
    'comment_author'       => 'John Doe',
    'comment_author_email' => 'nospam@myhaus.net',
    'comment_content'      => "I'm not a spammer, honest!"
);
if ($akismet->isSpam($data)) {
    echo "Sorry, but we think you're a spammer.";
} else {
    echo "Welcome to our site!";
}]]>
            </programlisting>
        </example>

        <para>
            <code>isSpam()</code> implements the <code>comment-check</code>
            Akismet API method.
        </para>
    </sect2>

    <sect2 id="zend.service.akismet.submitspam">
        <title>Submitting known spam</title>

        <para>
            Occasionally spam data will get through the filter. If in your
            review of incoming data you discover spam that you feel should have
            been caught, you can submit it to Akismet to help improve their
            filter.
        </para>

        <para>
            <code>Zend_Service_Akismet::submitSpam()</code> takes the same data
            array as passed to <code>isSpam()</code>, but does not return a
            value. An exception will be raised if the API key used is invalid.
        </para>

        <example id="zend.service.akismet.submitspam.example-1">
            <title>submitSpam() Usage</title>

            <programlisting role="php"><![CDATA[<?php
$data = array(
    'user_ip'              => '111.222.111.222',
    'user_agent'           => 'Mozilla/5.0 (Windows; U; Windows NT 5.2; en-GB; rv:1.8.1) Gecko/20061010 Firefox/2.0',
    'comment_type'         => 'contact',
    'comment_author'       => 'John Doe',
    'comment_author_email' => 'nospam@myhaus.net',
    'comment_content'      => "I'm not a spammer, honest!"
);
$akismet->submitSpam($data));]]>
            </programlisting>
        </example>

        <para>
            <code>submitSpam()</code> implements the <code>submit-spam</code>
            Akismet API method.
        </para>
    </sect2>

    <sect2 id="zend.service.akismet.submitham">
        <title>Submitting false positives (ham)</title>

        <para>
            Occasionally data will be trapped erroneously as spam by Akismet.
            For this reason, you should probably keep a log of all data
            trapped as spam by Akismet and review it periodically. If you find
            such occurrences, you can submit the data to Akismet as "ham", or a
            false positive (ham is good, spam is not).
        </para>

        <para>
            <code>Zend_Service_Akismet::submitHam()</code> takes the same data
            array as passed to <code>isSpam()</code> or
            <code>submitSpam()</code>, and, like <code>submitSpam()</code>, does
            not return a value. An exception will be raised if the API key used
            is invalid.
        </para>

        <example id="zend.service.akismet.submitham.example-1">
            <title>submitHam() Usage</title>

            <programlisting role="php"><![CDATA[<?php
$data = array(
    'user_ip'              => '111.222.111.222',
    'user_agent'           => 'Mozilla/5.0 (Windows; U; Windows NT 5.2; en-GB; rv:1.8.1) Gecko/20061010 Firefox/2.0',
    'comment_type'         => 'contact',
    'comment_author'       => 'John Doe',
    'comment_author_email' => 'nospam@myhaus.net',
    'comment_content'      => "I'm not a spammer, honest!"
);
$akismet->submitHam($data));]]>
            </programlisting>
        </example>

        <para>
            <code>submitHam()</code> implements the <code>submit-ham</code>
            Akismet API method.
        </para>
    </sect2>

    <sect2 id="zend.service.akismet.accessors">
        <title>Zend-specific Accessor Methods</title>

        <para>
            While the Akismet API only specifies four methods,
            <code>Zend_Service_Akismet</code> has several additional accessors
            that may be used for modifying internal properties.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>getBlogUrl()</code> and <code>setBlogUrl()</code>
                    allow you to retrieve and modify the blog URL used in
                    requests.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getApiKey()</code> and <code>setApiKey()</code>
                    allow you to retrieve and modify the API key used in
                    requests.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getCharset()</code> and <code>setCharset()</code>
                    allow you to retrieve and modify the character set used to
                    make the request.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getPort()</code> and <code>setPort()</code>
                    allow you to retrieve and modify the TCP port used to make
                    the request.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getUserAgent()</code> and <code>setUserAgent()</code>
                    allow you to retrieve and modify the HTTP user agent used to
                    make the request. Note: this is not the user_agent used in
                    data submitted to the service, but rather the value provided
                    in the HTTP User-Agent header when making a request to the
                    service.
                </para>

                <para>
                    The value used to set the user agent should be of the form
                    <code>some user agent/version | Akismet/version</code>. The
                    default is <code>Zend Framework/ZF-VERSION | Akismet/1.11</code>, where <code>ZF-VERSION</code> is the current Zend Framework version as stored in the <code>Zend_Framework::VERSION</code> constant.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>
</sect1>

<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.service.amazon">
    <title>Zend_Service_Amazon</title>
    <sect2 id="zend.service.amazon.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Service_Amazon</code> is a simple API for using Amazon web services.
            <code>Zend_Service_Amazon</code> has two APIs: a more traditional one that follows Amazon's own API, and a
            simpler "Query API" for constructing even complex search queries easily.
        </para>
        <para>
            <code>Zend_Service_Amazon</code> enables developers to retrieve information appearing throughout Amazon.com
            web sites directly through the Amazon Web Services API. Examples include:
            <itemizedlist>
                <listitem>
                    <para>
                        Store item information, such as images, descriptions, pricing, and more
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Customer and editorial reviews
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Similar products and accessories
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Amazon.com offers
                    </para>
                </listitem>
                <listitem>
                    <para>
                        ListMania lists
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <para>
            In order to use <code>Zend_Service_Amazon</code>, you should already have an Amazon developer API key. To
            get a key and for more information, please visit the
            <ulink url="http://www.amazon.com/gp/aws/landing.html">Amazon Web Services</ulink> web site.
        </para>
        <note>
            <title>Attention</title>
            <para>
                Your Amazon developer API key is linked to your Amazon identity,
                so take appropriate measures to keep your API key private.
            </para>
        </note>
        <example id="zend.service.amazon.introduction.example.itemsearch">
            <title>Search Amazon Using the Traditional API</title>
            <para>
                In this example, we search for PHP books at Amazon and loop through the results, printing them.
            </para>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Amazon.php';
$amazon = new Zend_Service_Amazon('AMAZON_API_KEY');
$results = $amazon->itemSearch(array('SearchIndex' => 'Books', 'Keywords' => 'php'));
foreach ($results as $result) {
    echo $result->Title . '<br />';
}]]>
            </programlisting>
        </example>
        <example id="zend.service.amazon.introduction.example.query_api">
            <title>Search Amazon Using the Query API</title>
            <para>
                Here, we also search for PHP books at Amazon, but we instead use the Query API, which
                resembles the Fluent Interface design pattern.
            </para>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Amazon/Query.php';
$query = new Zend_Service_Amazon_Query('AMAZON_API_KEY');
$query->category('Books')->Keywords('PHP');
$results = $query->search();
foreach ($results as $result) {
    echo $result->Title . '<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.amazon.countrycodes">
        <title>Country Codes</title>
        <para>
            By default, <code>Zend_Service_Amazon</code> connects to the United States ("<code>US</code>") Amazon
            web service. To connect from a different country, simply specify the appropriate country code string
            as the second parameter to the constructor:
        </para>
        <example id="zend.service.amazon.countrycodes.example.country_code">
            <title>Choosing an Amazon Web Service Country</title>
            <programlisting><![CDATA[<?php
// Connect to Amazon in Japan
require_once 'Zend/Service/Amazon.php';
$amazon = new Zend_Service_Amazon('AMAZON_API_KEY', 'JP');]]>
            </programlisting>
        </example>
        <note>
            <title>Country codes</title>
            <para>
                Valid country codes are: <code>CA</code>, <code>DE</code>, <code>FR</code>, <code>JP</code>,
                <code>UK</code>, and <code>US</code>.
            </para>
        </note>
    </sect2>
    <sect2 id="zend.service.amazon.itemlookup">
        <title>Looking up a Specific Amazon Item by ASIN</title>
        <para>
            The <code>itemLookup()</code> method provides the ability to fetch a particular Amazon item when
            the ASIN is known.
        </para>
        <example id="zend.service.amazon.itemlookup.example.asin">
            <title>Looking up a Specific Amazon Item by ASIN</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Amazon.php';
$amazon = new Zend_Service_Amazon('AMAZON_API_KEY');
$item = $amazon->itemLookup('B0000A432X');]]>
            </programlisting>
        </example>
        <para>
            The <code>itemLookup()</code> method also accepts an optional second parameter for handling search
            options. For full details, including a list of available options, please see the
            <ulink
                url="http://www.amazon.com/gp/aws/sdk/main.html/103-9285448-4703844?s=AWSEcommerceService&amp;v=2005-10-05&amp;p=ApiReference/ItemLookupOperation">relevant Amazon documentation</ulink>.
        </para>
        <note>
            <title>Image information</title>
            <para>
                To retrieve images information for your search results, you must set
                <code>ResponseGroup</code> option to <code>Medium</code> or <code>Large</code>.
            </para>
        </note>
    </sect2>
    <sect2 id="zend.service.amazon.itemsearch">
        <title>Performing Amazon Item Searches</title>
        <para>
            Searching for items based on any of various available criteria are made simple using the
            <code>itemSearch()</code> method, as in the following example:
        </para>
        <example id="zend.service.amazon.itemsearch.example.basic">
            <title>Performing Amazon Item Searches</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Amazon.php';
$amazon = new Zend_Service_Amazon('AMAZON_API_KEY');
$results = $amazon->itemSearch(array('SearchIndex' => 'Books', 'Keywords' => 'php'));
foreach ($results as $result) {
    echo $result->Title . '<br />';
}]]>
            </programlisting>
        </example>
        <example id="zend.service.amazon.itemsearch.example.responsegroup">
            <title>Using the <code>ResponseGroup</code> Option</title>
            <para>
                The <code>ResponseGroup</code> option is used to control the specific information that will be returned
                in the response.
            </para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Amazon.php';
$amazon = new Zend_Service_Amazon('AMAZON_API_KEY');
$results = $amazon->itemSearch(array(
    'SearchIndex'   => 'Books',
    'Keywords'      => 'php',
    'ResponseGroup' => 'Small,ItemAttributes,Images,SalesRank,Reviews,EditorialReview,Similarities,ListmaniaLists'
    ));
foreach ($results as $result) {
    echo $result->Title . '<br />';
}]]>
            </programlisting>
        </example>
        <para>
            The <code>itemSearch()</code> method accepts a single array parameter for handling search
            options. For full details, including a list of available options, please see the
            <ulink
                url="http://www.amazon.com/gp/aws/sdk/main.html/103-9285448-4703844?s=AWSEcommerceService&amp;v=2005-10-05&amp;p=ApiReference/ItemSearchOperation">relevant Amazon documentation</ulink>
        </para>
        <tip>
            <para>
                The <link linkend="zend.service.amazon.query"><code>Zend_Service_Amazon_Query</code></link> class
                is an easy to use wrapper around this method.
            </para>
        </tip>
    </sect2>
    <sect2 id="zend.service.amazon.query">
        <title>Using the Alternative Query API</title>
        <sect3 id="zend.service.amazon.query.introduction">
            <title>Introduction</title>
            <para>
                <code>Zend_Service_Amazon_Query</code> provides an alternative API for using the Amazon Web Service.
                The alternative API uses the Fluent Interface pattern. That is, all calls can be made using chained method
                calls. (e.g., <code>$obj->method()->method2($arg)</code>)
            </para>
            <para>
                The <code>Zend_Service_Amazon_Query</code> API uses overloading to easily set up an item search and then
                allows you to search based upon the criteria specified. Each of the options is provided as a method call,
                and each method's argument corresponds to the named option's value:
            </para>
            <example id="zend.service.amazon.query.introduction.example.basic">
                <title>Search Amazon Using the Alternative Query API</title>
                <para>
                    In this example, the alternative query API is used as a fluent interface to specify options and their
                    respective values:
                </para>
                <programlisting><![CDATA[<?php
require_once 'Zend/Service/Amazon/Query.php';
$query = new Zend_Service_Amazon_Query('MY_API_KEY');
$query->Category('Books')->Keywords('PHP');
$results = $query->search();
foreach ($results as $result) {
    echo $result->Title . '<br />';
}]]>
                </programlisting>
                <para>
                    This sets the option <code>Category</code> to "Books" and <code>Keywords</code> to "PHP".
                </para>
                <para>
                    For more information on the available options, please refer to the
                    <ulink
                        url="http://www.amazon.com/gp/aws/sdk/main.html/102-9041115-9057709?s=AWSEcommerceService&amp;v=2005-10-05&amp;p=ApiReference/ItemSearchOperation">relevant Amazon documentation</ulink>.
                </para>
            </example>
        </sect3>
    </sect2>
    <sect2 id="zend.service.amazon.classes">
        <title>Zend_Service_Amazon Classes</title>
        <para>
            The following classes are all returned by
            <link linkend="zend.service.amazon.itemlookup"><code>Zend_Service_Amazon::itemLookup()</code></link>
            and
            <link linkend="zend.service.amazon.itemsearch"><code>Zend_Service_Amazon::itemSearch()</code></link>:
            <itemizedlist>
                <listitem><para><link linkend="zend.service.amazon.classes.item"><code>Zend_Service_Amazon_Item</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.image"><code>Zend_Service_Amazon_Image</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.resultset"><code>Zend_Service_Amazon_ResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.offerset"><code>Zend_Service_Amazon_OfferSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.offer"><code>Zend_Service_Amazon_Offer</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.similarproduct"><code>Zend_Service_Amazon_SimilarProduct</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.accessories"><code>Zend_Service_Amazon_Accessories</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.customerreview"><code>Zend_Service_Amazon_CustomerReview</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.editorialreview"><code>Zend_Service_Amazon_EditorialReview</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.amazon.classes.listmania"><code>Zend_Service_Amazon_ListMania</code></link></para></listitem>
            </itemizedlist>
        </para>
        <sect3 id="zend.service.amazon.classes.item">
            <title>Zend_Service_Amazon_Item</title>
            <para>
                <code>Zend_Service_Amazon_Item</code> is the class type used to represent an Amazon item returned by the
                web service. It encompasses all of the items attributes, including title, description, reviews, etc.
            </para>
            <sect4 id="zend.service.amazon.classes.item.asxml">
                <title>Zend_Service_Amazon_Item::asXML()</title>
                <para>
                    <methodsynopsis>
                        <type>string</type>
                        <methodname>asXML</methodname>
                        <void />
                    </methodsynopsis>
                </para>
                <para>Return the original XML for the item</para>
            </sect4>
            <sect4 id="zend.service.amazon.classes.item.properties">
                <title>Properties</title>
                <para>
                    <code>Zend_Service_Amazon_Item</code> has a number of properties directly related to their standard
                    Amazon API counterparts.
                </para>
                <table id="zend.service.amazon.classes.item.properties.table-1">
                    <title>Zend_Service_Amazon_Item Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>ASIN</entry>
                                <entry>string</entry>
                                <entry>Amazon Item ID</entry>
                            </row>
                            <row>
                                <entry>DetailPageURL</entry>
                                <entry>string</entry>
                                <entry>URL to the Items Details Page</entry>
                            </row>
                            <row>
                                <entry>SalesRank</entry>
                                <entry>int</entry>
                                <entry>Sales Rank for the Item</entry>
                            </row>
                            <row>
                                <entry>SmallImage</entry>
                                <entry>Zend_Service_Amazon_Image</entry>
                                <entry>Small Image of the Item</entry>
                            </row>
                            <row>
                                <entry>MediumImage</entry>
                                <entry>Zend_Service_Amazon_Image</entry>
                                <entry>Medium Image of the Item</entry>
                            </row>
                            <row>
                                <entry>LargeImage</entry>
                                <entry>Zend_Service_Amazon_Image</entry>
                                <entry>Large Image of the Item</entry>
                            </row>
                            <row>
                                <entry>Subjects</entry>
                                <entry>array</entry>
                                <entry>Item Subjects</entry>
                            </row>
                            <row>
                                <entry>Offers</entry>
                                <entry>
                                    <code>
                                        <link
                                            linkend="zend.service.amazon.classes.offerset">Zend_Service_Amazon_OfferSet</link>
                                    </code>
                                </entry>
                                <entry>Offer Summary and Offers for the Item</entry>
                            </row>
                            <row>
                                <entry>CustomerReviews</entry>
                                <entry>array</entry>
                                <entry>
                                    Customer reviews represented as an array of
                                    <code>
                                        <link
                                            linkend="zend.service.amazon.classes.customerreview">Zend_Service_Amazon_CustomerReview</link>
                                    </code>
                                    objects
                                </entry>
                            </row>
                            <row>
                                <entry>EditorialReviews</entry>
                                <entry>array</entry>
                                <entry>
                                    Editorial reviews represented as an array of
                                    <code>
                                        <link
                                            linkend="zend.service.amazon.classes.editorialreview">Zend_Service_Amazon_EditorialReview</link>
                                    </code>
                                    objects
                                </entry>
                            </row>
                            <row>
                                <entry>SimilarProducts</entry>
                                <entry>array</entry>
                                <entry>
                                    Similar Products represented as an array of
                                    <code>
                                        <link
                                            linkend="zend.service.amazon.classes.similarproduct">Zend_Service_Amazon_SimilarProduct</link>
                                    </code>
                                    objects
                                </entry>
                            </row>
                            <row>
                                <entry>Accessories</entry>
                                <entry>array</entry>
                                <entry>
                                    Accessories for the item represented as an array of
                                    <code>
                                        <link
                                            linkend="zend.service.amazon.classes.accessories">Zend_Service_Amazon_Accessories</link>
                                    </code>
                                    objects
                                </entry>
                            </row>
                            <row>
                                <entry>Tracks</entry>
                                <entry>array</entry>
                                <entry>An array of track numbers and names for Music CDs and DVDs</entry>
                            </row>
                            <row>
                                <entry>ListmaniaLists</entry>
                                <entry>array</entry>
                                <entry>
                                    Item related Listmania Lists as an array of
                                    <code>
                                        <link
                                            linkend="zend.service.amazon.classes.listmania">Zend_Service_Amazon_ListmainList</link>
                                    </code>
                                    objects
                                </entry>
                            </row>
                            <row>
                                <entry>PromotionalTag</entry>
                                <entry>string</entry>
                                <entry>Item Promotional Tag</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.image">
            <title>Zend_Service_Amazon_Image</title>
            <para><code>Zend_Service_Amazon_Image</code> represents a remote Image for a product.</para>
            <sect4 id="zend.service.amazon.classes.image.properties">
                <title>Properties</title>
                <table id="zend.service.amazon.classes.image.properties.table-1">
                    <title>Zend_Service_Amazon_Image Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Url</entry>
                                <entry>Zend_Uri</entry>
                                <entry>Remote URL for the Image</entry>
                            </row>
                            <row>
                                <entry>Height</entry>
                                <entry>int</entry>
                                <entry>The Height of the image in pixels</entry>
                            </row>
                            <row>
                                <entry>Width</entry>
                                <entry>int</entry>
                                <entry>The Width of the image in pixels</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.resultset">
            <title>Zend_Service_Amazon_ResultSet</title>
            <para>
                <code>Zend_Service_Amazon_ResultSet</code> objects are returned by
                <link linkend="zend.service.amazon.itemsearch">Zend_Service_Amazon::itemSearch()</link>
                and allow you to easily handle the multiple results returned.
            </para>
            <note>
                <title>SeekableIterator</title>
                <para>
                    Implements the <code>SeekableIterator</code> for easy iteration (e.g. using <code>foreach</code>), as
                    well as direct access to a specific result using <code>seek()</code>.
                </para>
            </note>
            <sect4 id="zend.service.amazon.classes.resultset.totalresults">
                <title>Zend_Service_Amazon_ResultSet::totalResults()</title>
                <methodsynopsis>
                    <type>int</type>
                    <methodname>totalResults</methodname>
                    <void />
                </methodsynopsis>
                <para>Returns the total number of results returned by the search</para>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.offerset">
            <title>Zend_Service_Amazon_OfferSet</title>
            <para>
                Each result returned by
                <link linkend="zend.service.amazon.itemsearch">Zend_Service_Amazon::itemSearch()</link>
                and
                <link linkend="zend.service.amazon.itemlookup">Zend_Service_Amazon::itemLookup()</link>
                contains a
                <code>Zend_Service_Amazon_OfferSet</code>
                object through which pricing information for the item can be retrieved.
            </para>
            <sect4 id="zend.service.amazon.classes.offerset.parameters">
                <title>Properties</title>
                <table id="zend.service.amazon.classes.offerset.parameters.table-1">
                    <title>Zend_Service_Amazon_OfferSet Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>LowestNewPrice</entry>
                                <entry>int</entry>
                                <entry>Lowest Price for the item in &quot;New&quot; condition</entry>
                            </row>
                            <row>
                                <entry>LowestNewPriceCurrency</entry>
                                <entry>string</entry>
                                <entry>
                                    The currency for the
                                    <code>LowestNewPrice</code>
                                </entry>
                            </row>
                            <row>
                                <entry>LowestOldPrice</entry>
                                <entry>int</entry>
                                <entry>Lowest Price for the item in &quot;Used&quot; condition</entry>
                            </row>
                            <row>
                                <entry>LowestOldPriceCurrency</entry>
                                <entry>string</entry>
                                <entry>
                                    The currency for the
                                    <code>LowestOldPrice</code>
                                </entry>
                            </row>
                            <row>
                                <entry>TotalNew</entry>
                                <entry>int</entry>
                                <entry>Total number of &quot;new&quot; condition available for the item</entry>
                            </row>
                            <row>
                                <entry>TotalUsed</entry>
                                <entry>int</entry>
                                <entry>Total number of &quot;used&quot; condition available for the item</entry>
                            </row>
                            <row>
                                <entry>TotalCollectible</entry>
                                <entry>int</entry>
                                <entry>Total number of &quot;collectible&quot; condition available for the item</entry>
                            </row>
                            <row>
                                <entry>TotalRefurbished</entry>
                                <entry>int</entry>
                                <entry>Total number of &quot;refurbished&quot; condition available for the item</entry>
                            </row>
                            <row>
                                <entry>Offers</entry>
                                <entry>array</entry>
                                <entry>
                                    An array of
                                    <code>Zend_Service_Amazon_Offer</code>
                                    objects.
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.offer">
            <title>Zend_Service_Amazon_Offer</title>
            <para>
                Each offer for an item is returned as an
                <code>Zend_Service_Amazon_Offer</code>
                object.
            </para>
            <sect4 id="zend.service.amazon.classes.offer.properties">
                <title>Zend_Service_Amazon_Offer Properties</title>
                <table id="zend.service.amazon.classes.offer.properties.table-1">
                    <title>Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>MerchantId</entry>
                                <entry>string</entry>
                                <entry>Merchants Amazon ID</entry>
                            </row>
                            <row>
                                <entry>GlancePage</entry>
                                <entry>string</entry>
                                <entry>URL for a page with a summary of the Merchant</entry>
                            </row>
                            <row>
                                <entry>Condition</entry>
                                <entry>string</entry>
                                <entry>Condition of the item</entry>
                            </row>
                            <row>
                                <entry>OfferListingId</entry>
                                <entry>string</entry>
                                <entry>ID of the Offer Listing</entry>
                            </row>
                            <row>
                                <entry>Price</entry>
                                <entry>int</entry>
                                <entry>Price for the item</entry>
                            </row>
                            <row>
                                <entry>CurrencyCode</entry>
                                <entry>string</entry>
                                <entry>Currency Code for the price of the item</entry>
                            </row>
                            <row>
                                <entry>Availability</entry>
                                <entry>string</entry>
                                <entry>Availability of the item</entry>
                            </row>
                            <row>
                                <entry>IsEligibleForSuperSaverShipping</entry>
                                <entry>boolean</entry>
                                <entry>Whether the item is eligible for Super Saver Shipping or not</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.similarproduct">
            <title>Zend_Service_Amazon_SimilarProduct</title>
            <para>
                When searching for items, Amazon also returns a list of similar products that the searcher may find to
                their liking. Each of these is returned as a <code>Zend_Service_Amazon_SimilarProduct</code> object.
            </para>
            <para>
                Each object contains the information to allow you to make sub-sequent requests to get the full information
                on the item.
            </para>
            <sect4 id="zend.service.amazon.classes.similarproduct.properties">
                <title>Properties</title>
                <table id="zend.service.amazon.classes.similarproduct.properties.table-1">
                    <title>Zend_Service_Amazon_SimilarProduct Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>ASIN</entry>
                                <entry>string</entry>
                                <entry>Products Amazon Unique ID (ASIN)</entry>
                            </row>
                            <row>
                                <entry>Title</entry>
                                <entry>string</entry>
                                <entry>Products Title</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.accessories">
            <title>Zend_Service_Amazon_Accessories</title>
            <para>
                Accessories for the returned item are represented as <code>Zend_Service_Amazon_Accessories</code> objects
            </para>
            <sect4 id="zend.service.amazon.classes.accessories.properties">
                <title>Properties</title>
                <table id="zend.service.amazon.classes.accessories.properties.table-1">
                    <title>Zend_Service_Amazon_Accessories Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>ASIN</entry>
                                <entry>string</entry>
                                <entry>Products Amazon Unique ID (ASIN)</entry>
                            </row>
                            <row>
                                <entry>Title</entry>
                                <entry>string</entry>
                                <entry>Products Title</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.customerreview">
            <title>Zend_Service_Amazon_CustomerReview</title>
            <para>
                Each Customer Review is returned as a <code>Zend_Service_Amazon_CustomerReview</code> object.
            </para>
            <sect4 id="zend.service.amazon.classes.customerreview.properties">
                <title>Properties</title>
                <table id="zend.service.amazon.classes.customerreview.properties.table-1">
                    <title>Zend_Service_Amazon_CustomerReview Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Rating</entry>
                                <entry>string</entry>
                                <entry>Item Rating</entry>
                            </row>
                            <row>
                                <entry>HelpfulVotes</entry>
                                <entry>string</entry>
                                <entry>Votes on how helpful the review is</entry>
                            </row>
                            <row>
                                <entry>CustomerId</entry>
                                <entry>string</entry>
                                <entry>Customer ID</entry>
                            </row>
                            <row>
                                <entry>TotalVotes</entry>
                                <entry>string</entry>
                                <entry>Total Votes</entry>
                            </row>
                            <row>
                                <entry>Date</entry>
                                <entry>string</entry>
                                <entry>Date of the Review</entry>
                            </row>
                            <row>
                                <entry>Summary</entry>
                                <entry>string</entry>
                                <entry>Review Summary</entry>
                            </row>
                            <row>
                                <entry>Content</entry>
                                <entry>string</entry>
                                <entry>Review Content</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.editorialreview">
            <title>Zend_Service_Amazon_EditorialReview</title>
            <para>
                Each items Editorial Reviews are returned as a <code>Zend_Service_Amazon_EditorialReview</code> object
            </para>
            <sect4 id="zend.service.amazon.classes.editorialreview.properties">
                <title>Properties</title>
                <table id="zend.service.amazon.classes.editorialreview.properties.table-1">
                    <title>Zend_Service_Amazon_EditorialReview Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Source</entry>
                                <entry>string</entry>
                                <entry>Source of the Editorial Review</entry>
                            </row>
                            <row>
                                <entry>Content</entry>
                                <entry>string</entry>
                                <entry>Review Content</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.amazon.classes.listmania">
            <title>Zend_Service_Amazon_Listmania</title>
            <para>
                Each results List Mania List items are returned as <code>Zend_Service_Amazon_Listmania</code> objects.
            </para>
            <sect4 id="zend.service.amazon.classes.listmania.properties">
                <title>Properties</title>
                <table id="zend.service.amazon.classes.listmania.properties.table-1">
                    <title>Zend_Service_Amazon_Listmania Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>ListId</entry>
                                <entry>string</entry>
                                <entry>List ID</entry>
                            </row>
                            <row>
                                <entry>ListName</entry>
                                <entry>string</entry>
                                <entry>List Name</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.amazon.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.service.audioscrobbler">

    <title>Zend_Service_Audioscrobbler</title>

    <sect2 id="zend.service.audioscrobbler.introduction">

        <title>Introduction to Searching Audioscrobbler</title>

        <para>
            <code>Zend_Service_Audioscrobbler</code> is a simple API for using the Audioscrobbler REST Web Service. The
            Audioscrobbler Web Service provides access to its database of Users, Artists, Albums, Tracks, Tags, Groups,
            and Forums. The methods of the <code>Zend_Service_Audioscrobbler</code> class begin with one of these terms.
            The syntax and namespaces of the Audioscrobbler Web Service are mirrored in
            <code>Zend_Service_Audioscrobbler</code>. For more information about the Audioscrobbler REST Web Service,
            please visit the <ulink url="http://www.audioscrobbler.net/data/webservices/">Audioscrobbler Web Service
            site</ulink>.
        </para>

    </sect2>

    <sect2 id="zend.service.audioscrobbler.users">

        <title>Users</title>

        <para>
            In order to retrieve information for a specific user, the <code>setUser()</code> method is first used to
            select the user for which data are to be retrieved. <code>Zend_Service_Audioscrobbler</code> provides
            several methods for retrieving data specific to a single user:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>userGetProfileInformation()</code>: Returns a SimpleXML object containing the current
                        user's profile information.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetTopArtists()</code>: Returns a SimpleXML object containing a list of the current
                        user's most listened to artists.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetTopAlbums()</code>: Returns a SimpleXML object containing a list of the current
                        user's most listened to albums.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetTopTracks()</code>: Returns a SimpleXML object containing a list of the current
                        user's most listened to tracks.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetTopTags()</code>: Returns a SimpleXML object containing a list of tags most applied
                        by the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetTopTagsForArtist()</code>: Requires that an artist be set via
                        <code>setArtist()</code>. Returns a SimpleXML object containing the tags most applied to the
                        current artist by the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetTopTagsForAlbum()</code>: Requires that an album be set via
                        <code>setAlbum()</code>. Returns a SimpleXML object containing the tags most applied to the
                        current album by the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetTopTagsForTrack()</code>: Requires that a track be set via
                        <code>setTrack()</code>. Returns a SimpleXML object containing the tags most applied to the
                        current track by the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetFriends()</code>: Returns a SimpleXML object containing the user names of the
                        current user's friends.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetNeighbours()</code>: Returns a SimpleXML object containing the user names of
                        people with similar listening habits to the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetRecentTracks()</code>: Returns a SimpleXML object containing the 10 tracks most
                        recently played by the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetRecentBannedTracks()</code>: Returns a SimpleXML object containing a list of the 10
                        tracks most recently banned by the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetRecentLovedTracks()</code>: Returns a SimpleXML object containing a list of the 10
                        tracks most recently loved by the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetRecentJournals()</code>: Returns a SimpleXML object containing a list of the
                        current user's most recent journal entries.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetWeeklyChartList()</code>: Returns a SimpleXML object containing a list of weeks for
                        which there exist Weekly Charts for the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetRecentWeeklyArtistChart()</code>: Returns a SimpleXML object containing the most
                        recent Weekly Artist Chart for the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetRecentWeeklyAlbumChart()</code>: Returns a SimpleXML object containing the most
                        recent Weekly Album Chart for the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetRecentWeeklyTrackChart()</code>: Returns a SimpleXML object containing the most
                        recent Weekly Track Chart for the current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetPreviousWeeklyArtistChart($fromDate, $toDate)</code>: Returns a SimpleXML object
                        containing the Weekly Artist Chart from <code>$fromDate</code> to <code>$toDate</code> for the
                        current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetPreviousWeeklyAlbumChart($fromDate, $toDate)</code>: Returns a SimpleXML object
                        containing the Weekly Album Chart from <code>$fromDate</code> to <code>$toDate</code> for the
                        current user.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>userGetPreviousWeeklyTrackChart($fromDate, $toDate)</code>: Returns a SimpleXML object
                        containing the Weekly Track Chart from <code>$fromDate</code> to <code>$toDate</code> for the
                        current user.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <example id="zend.service.audioscrobbler.users.example.profile_information">

            <title>Retrieving User Profile Information</title>

            <para>
                In this example, we use the <code>setUser()</code> and <code>userGetProfileInformation()</code> methods
                to retrieve a specific user's profile information:
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Audioscrobbler.php';
$as = new Zend_Service_Audioscrobbler();
$as->setUser('BigDaddy71'); // Set the user whose profile information we want to retrieve
$profileInfo = $as->userGetProfileInformation(); // Retrieve BigDaddy71's profile information
print "Information for $profileInfo->realname can be found at $profileInfo->url"; // Display some of it]]>
            </programlisting>

        </example>

        <example id="zend.service.audioscrobbler.users.example.weekly_artist_chart">

            <title>Retrieving a User's Weekly Artist Chart</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Audioscrobbler.php';
$as = new Zend_Service_Audioscrobbler();
$as->setUser('lo_fye'); // Set the user whose profile weekly artist chart we want to retrieve
$weeks = $as->userGetWeeklyChartList(); // Retrieves a list of previous weeks for which there are chart data
if (count($weeks) < 1) {
    echo 'No data available';
}
sort($weeks); // Order the list of weeks

$as->setFromDate($weeks[0]); // Set the starting date
$as->setToDate($weeks[0]); // Set the ending date

$previousWeeklyArtists = $as->userGetPreviousWeeklyArtistChart();

echo 'Artist Chart For Week Of ' . date('Y-m-d h:i:s', $as->from_date) . '<br />';

foreach ($previousWeeklyArtists as $artist) {
    // Display the artists' names with links to their profiles
    print '<a href="' . $artist->url . '">' . $artist->name . '</a><br />';
}]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.service.audioscrobbler.artists">

        <title>Artists</title>

        <para>
            <code>Zend_Service_Audioscrobbler</code> provides several methods for retrieving data about a specific
            artist, specified via the <code>setArtist()</code> method:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>artistGetRelatedArtists()</code>: Returns a SimpleXML object containing a list of
                        Artists similar to the current Artist.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>artistGetTopFans()</code>: Returns a SimpleXML object containing a list of Users who
                        listen most to the current Artist.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>artistGetTopTracks()</code>: Returns a SimpleXML object containing a list of the current
                        Artist's top-rated Tracks.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>artistGetTopAlbums()</code>: Returns a SimpleXML object containing a list of the current
                        Artist's top-rated Albums.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>artistGetTopTags()</code>: Returns a SimpleXML object containing a list of the Tags most
                        frequently applied to current Artist.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

        <example id="zend.service.audioscrobbler.artists.example.related_artists">

            <title>Retrieving Related Artists</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Audioscrobbler.php';
$as = new Zend_Service_Audioscrobbler();
$as->setArtist('LCD Soundsystem'); // Set the artist for whom you would like to retrieve related artists
$relatedArtists = $as->artistGetRelatedArtists(); // Retrieve the related artists
foreach ($relatedArtists as $artist) {
    print '<a href="' . $artist->url . '">' . $artist->name . '</a><br />'; // Display the related artists
}]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.service.audioscrobbler.tracks">

        <title>Tracks</title>

        <para>
            <code>Zend_Service_Audioscrobbler</code> provides two methods for retrieving data specific to a single
            track, specified via the <code>setTrack()</code> method:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>trackGetTopFans()</code>: Returns a SimpleXML object containing a list of Users who
                        listen most to the current Track.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>trackGetTopTags()</code>: Returns a SimpleXML object containing a list of the Tags most
                        frequently applied to the current Track.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

    <sect2 id="zend.service.audioscrobbler.tags">

        <title>Tags</title>

        <para>
            <code>Zend_Service_Audioscrobbler</code> provides several methods for retrieving data specific to a single
            tag, specified via the <code>setTag()</code> method:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>tagGetOverallTopTags()</code>: Returns a SimpleXML object containing a list of Tags most
                        frequently used on Audioscrobbler.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>tagGetTopArtists()</code>: Returns a SimpleXML object containing a list of Artists to whom
                        the current Tag was most frequently applied.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>tagGetTopAlbums()</code>: Returns a SimpleXML object containing a list of Albums to which
                        the current Tag was most frequently applied.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>tagGetTopTracks()</code>: Returns a SimpleXML object containing a list of Tracks to which
                        the current Tag was most frequently applied.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

    <sect2 id="zend.service.audioscrobbler.groups">

        <title>Groups</title>

        <para>
            <code>Zend_Service_Audioscrobbler</code> provides several methods for retrieving data specific to a single
            group, specified via the <code>setGroup()</code> method:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>groupGetRecentJournals()</code>: Returns a SimpleXML object containing a list of recent
                        journal posts by Users in the current Group.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>groupGetWeeklyChart()</code>: Returns a SimpleXML object containing a list of weeks for
                        which there exist Weekly Charts for the current Group.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>groupGetRecentWeeklyArtistChart()</code>: Returns a SimpleXML object containing the most
                        recent Weekly Artist Chart for the current Group.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>groupGetRecentWeeklyAlbumChart()</code>: Returns a SimpleXML object containing the most
                        recent Weekly Album Chart for the current Group.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>groupGetRecentWeeklyTrackChart()</code>: Returns a SimpleXML object containing the most
                        recent Weekly Track Chart for the current Group.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>groupGetPreviousWeeklyArtistChart($fromDate, $toDate)</code>: Requires
                        <code>setFromDate()</code> and <code>setToDate()</code>. Returns a SimpleXML object containing
                        the Weekly Artist Chart from the current fromDate to the current toDate for the current Group.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>groupGetPreviousWeeklyAlbumChart($fromDate, $toDate)</code>: Requires
                        <code>setFromDate()</code> and <code>setToDate()</code>. Returns a SimpleXML object containing
                        the Weekly Album Chart from the current fromDate to the current toDate for the current Group.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <code>groupGetPreviousWeeklyTrackChart($fromDate, $toDate)</code>: Returns a SimpleXML object
                        containing the Weekly Track Chart from the current fromDate to the current toDate for the
                        current Group.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

    <sect2 id="zend.service.audioscrobbler.forums">

        <title>Forums</title>

        <para>
            <code>Zend_Service_Audioscrobbler</code> provides a method for retrieving data specific to a single forum,
            specified via the <code>setForum()</code> method:
            <itemizedlist>
                <listitem>
                    <para>
                        <code>forumGetRecentPosts()</code>: Returns a SimpleXML object containing a list of recent posts
                        in the current forum.
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.service.delicious">
    <title>Zend_Service_Delicious</title>
    <sect2 id="zend.service.delicious.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Service_Delicious</code> is simple API for using
            <ulink url="http://del.icio.us">del.icio.us</ulink>
            XML and JSON web services. This component gives you read-write access to posts at del.icio.us
            if you provide credentials. It also allows read-only access to public data of all users.
        </para>
        <example id="zend.service.delicious.introduction.getAllPosts">
            <title>Get all posts</title>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');
$posts = $delicious->getAllPosts();

foreach ($posts as $post) {
    echo "--\n";
    echo "Title: {$post->getTitle()}\n";
    echo "Url: {$post->getUrl()}\n";
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.delicious.retrieving_posts">
        <title>Retrieving posts</title>
        <para>
            <code>Zend_Service_Delicious</code> provides three methods for retrieving posts: <code>getPosts()</code>,
            <code>getRecentPosts()</code> and <code>getAllPosts()</code>. All of these
            methods return an instance of <code>Zend_Service_Delicious_PostList</code>, which
            holds all retrieved posts.
        </para>
        <programlisting role="php"><![CDATA[<?php
/**
 * Get posts matching the arguments. If no date or url is given, most recent date will be used.
 *
 * @param string $tag Optional filtering by tag
 * @param Zend_Date $dt Optional filtering by date
 * @param string $url Optional filtering by url
 * @return Zend_Service_Delicious_PostList
 */
public function getPosts($tag = null, $dt = null, $url = null);

/**
 * Get recent posts
 *
 * @param string $tag   Optional filtering by tag
 * @param string $count Maximal number of posts to be returned (default 15)
 * @return Zend_Service_Delicious_PostList
 */
public function getRecentPosts($tag = null, $count = 15);

/**
 * Get all posts
 *
 * @param string $tag Optional filtering by tag
 * @return Zend_Service_Delicious_PostList
 */
public function getAllPosts($tag = null);]]>
        </programlisting>
    </sect2>
    <sect2 id="zend.service.delicious.postlist">
        <title>Zend_Service_Delicious_PostList</title>
        <para>
            Instances of this class are returned by the <code>getPosts()</code>, <code>getAllPosts()</code>,
            <code>getRecentPosts()</code>, and <code>getUserPosts()</code> methods of <code>Zend_Service_Delicious</code>.
        </para>
        <para>
            For easier data access this class implements the <code>Countable</code>, <code>Iterator</code>, and
            <code>ArrayAccess</code> interfaces.
        </para>
        <example id="zend.service.delicious.postlist.accessing_post_lists">
            <title>Accessing post lists</title>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');
$posts = $delicious->getAllPosts();

// count posts
echo count($posts);

// iterate over posts
foreach ($posts as $post) {
    echo "--\n";
    echo "Title: {$post->getTitle()}\n";
    echo "Url: {$post->getUrl()}\n";
}

// get post using array access
echo $posts[0]->getTitle();]]>
            </programlisting>
        </example>
        <note>
            <para>
                The <code>ArrayAccess::offsetSet()</code> and <code>ArrayAccess::offsetUnset()</code> methods
                throw exceptions in this implementation. Thus, code like <code>unset($posts[0]);</code> and
                <code>$posts[0] = 'A';</code> will throw exceptions because these properties are read-only.
            </para>
        </note>
        <para>
            Post list objects have two built-in filtering capabilities. Post lists may be filtered by tags and by URL.
        </para>
        <example id="zend.service.delicious.postlist.example.withTags">
            <title>Filtering a Post List with Specific Tags</title>
            <para>
                Posts may be filtered by specific tags using <code>withTags()</code>. As a convenience,
                <code>withTag()</code> is also provided for when only a single tag needs to be specified.
            </para>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');
$posts = $delicious->getAllPosts();

// Print posts having "php" and "zend" tags
foreach ($posts->withTags(array('php', 'zend')) as $post) {
    echo "Title: {$post->getTitle()}\n";
    echo "Url: {$post->getUrl()}\n";
}]]>
            </programlisting>
        </example>
        <example id="zend.service.delicious.postlist.example.byUrl">
            <title>Filtering a Post List by URL</title>
            <para>
                Posts may be filtered by URL matching a specified regular expression using the <code>withUrl()</code>
                method:
            </para>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');
$posts = $delicious->getAllPosts();

// Print posts having "help" in the URL
foreach ($posts->withUrl('/help/') as $post) {
    echo "Title: {$post->getTitle()}\n";
    echo "Url: {$post->getUrl()}\n";
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.delicious.editing_posts">
        <title>Editing posts</title>
        <example id="zend.service.delicious.editing_posts.post_editing">
            <title>Post editing</title>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');
$posts = $delicious->getPosts();

// set title
$posts[0]->setTitle('New title');
// save changes
$posts[0]->save();]]>
            </programlisting>
        </example>
        <example id="zend.service.delicious.editing_posts.method_call_chaining">
            <title>Method call chaining</title>
            <para>
               Every setter method returns the post object so that you can chain method calls using a fluent interface.
            </para>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');
$posts = $delicious->getPosts();

$posts[0]->setTitle('New title')
         ->setNotes('New notes')
         ->save();]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.delicious.deleting_posts">
        <title>Deleting posts</title>
        <para>
            There are two ways to delete a post, by specifying the post URL or by calling the <code>delete()</code>
            method upon a post object.
        </para>
        <example id="zend.service.delicious.deleting_posts.deleting_posts">
            <title>Deleting posts</title>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');

// by specifying URL
$delicious->deletePost('http://framework.zend.com');

// or by calling the method upon a post object
$posts = $delicious->getPosts();
$posts[0]->delete();

// another way of using deletePost()
$delicious->deletePost($posts[0]->getUrl());]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.delicious.adding_posts">
        <title>Adding new posts</title>
        <para>
            To add a post you first need to call the <code>createNewPost()</code> method, which returns a
            <code>Zend_Service_Delicious_Post</code> object. When you edit the post, you need to save it
            to the del.icio.us database by calling the <code>save()</code> method.
        </para>
        <example id="zend.service.delicious.adding_posts.adding_a_post">
            <title>Adding a post</title>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');

// create a new post and save it (with method call chaining)
$delicious->createNewPost('Zend Framework', 'http://framework.zend.com')
          ->setNotes('Zend Framework Homepage')
          ->save();

// create a new post and save it  (without method call chaining)
$newPost = $delicious->createNewPost('Zend Framework', 'http://framework.zend.com');
$newPost->setNotes('Zend Framework Homepage');
$newPost->save();]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.delicious.tags">
        <title>Tags</title>
        <example id="zend.service.delicious.tags.tags">
            <title>Tags</title>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');

// get all tags
print_r($delicious->getTags());

// rename tag ZF to zendFramework
$delicious->renameTag('ZF', 'zendFramework');]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.delicious.bundles">
        <title>Bundles</title>
        <example id="zend.service.delicious.bundles.example">
            <title>Bundles</title>
            <programlisting role="php"><![CDATA[<?php
$delicious = new Zend_Service_Delicious('username', 'password');

// get all bundles
print_r($delicious->getBundles());

// delete bundle someBundle
$delicious->deleteBundle('someBundle');

// add bundle
$delicious->addBundle('newBundle', array('tag1', 'tag2'));]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.delicious.public_data">
        <title>Public data</title>
        <para>
            The del.icio.us web API allows access to the public data of all users.
        </para>
        <table id="zend.service.delicious.public_data.functions_for_retrieving_public_data">
            <title>Methods for retrieving public data</title>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Name</entry>
                        <entry>Description</entry>
                        <entry>Return type</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry><code>getUserFans()</code></entry>
                        <entry>Retrieves fans of a user</entry>
                        <entry>Array</entry>
                    </row>
                    <row>
                        <entry><code>getUserNetwork()</code></entry>
                        <entry>Retrieves network of a user</entry>
                        <entry>Array</entry>
                    </row>
                    <row>
                        <entry><code>getUserPosts()</code></entry>
                        <entry>Retrieves posts of a user</entry>
                        <entry>Zend_Service_Delicious_PostList</entry>
                    </row>
                    <row>
                        <entry><code>getUserTags()</code></entry>
                        <entry>Retrieves tags of a user</entry>
                        <entry>Array</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
        <note>
            <para>
                When using only these methods, a username and password combination is not required when constructing
                a new <code>Zend_Service_Delicious</code> object.
            </para>
        </note>
        <example id="zend.service.delicious.public_data.retrieving_public_data">
            <title>Retrieving public data</title>
            <programlisting role="php"><![CDATA[<?php
// username and password are not required
$delicious = new Zend_Service_Delicious();

// get fans of user someUser
print_r($delicious->getUserFans('someUser'));

// get network of user someUser
print_r($delicious->getUserNetwork('someUser'));

// get tags of user someUser
print_r($delicious->getUserTags('someUser'));]]>
            </programlisting>
        </example>
        <sect3 id="zend.service.delicious.public_data.posts">
            <title>Public posts</title>
            <para>
                When retrieving public posts with the <code>getUserPosts()</code> method, a
                <code>Zend_Service_Delicious_PostList</code> object is returned, and it contains
                <code>Zend_Service_Delicious_SimplePost</code> objects, which contain basic information
                about the posts, including URL, title, notes, and tags.
            </para>
            <table id="zend.service.delicious.public_data.posts.SimplePost_methods">
                <title>Methods of the <code>Zend_Service_Delicious_SimplePost</code> class</title>
                <tgroup cols="3">
                    <thead>
                        <row>
                            <entry>Name</entry>
                            <entry>Description</entry>
                            <entry>Return type</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry><code>getNotes()</code></entry>
                            <entry>Returns notes of a post</entry>
                            <entry>String</entry>
                        </row>
                        <row>
                            <entry><code>getTags()</code></entry>
                            <entry>Returns tags of a post</entry>
                            <entry>Array</entry>
                        </row>
                        <row>
                            <entry><code>getTitle()</code></entry>
                            <entry>Returns title of a post</entry>
                            <entry>String</entry>
                        </row>
                        <row>
                            <entry><code>getUrl()</code></entry>
                            <entry>Returns URL of a post</entry>
                            <entry>String</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </sect3>
    </sect2>
    <sect2 id="zend.service.delicious.httpclient">
        <title>HTTP client</title>
        <para>
            <code>Zend_Service_Delicious</code> uses <code>Zend_Rest_Client</code> for making HTTP requests
            to the del.icio.us web service. To change which HTTP client <code>Zend_Service_Delicious</code>
            uses, you need to change the HTTP client of <code>Zend_Rest_Client</code>.
        </para>
        <example id="zend.service.delicious.httpclient.changing">
            <title>Changing the HTTP client of <code>Zend_Rest_Client</code></title>
            <programlisting role="php"><![CDATA[<?php
$myHttpClient = new My_Http_Client();
Zend_Rest_Client::setHttpClient($myHttpClient);]]>
            </programlisting>
        </example>
        <para>
            When you are making more than one request with <code>Zend_Service_Delicious</code> to speed your
            requests, it's better to configure your HTTP client to keep connections alive.
        </para>
        <example id="zend.service.delicious.httpclient.keepalive">
            <title>Configuring your HTTP client to keep connections alive</title>
            <programlisting role="php"><![CDATA[<?php
Zend_Rest_Client::getHttpClient()->setConfig(array(
        'keepalive' => true
));]]>
            </programlisting>
        </example>
        <note>
            <para>
                When a <code>Zend_Service_Delicious</code> object is constructed, the SSL transport
                of <code>Zend_Rest_Client</code> is set to <code>'ssl'</code> rather than the default of
                <code>'ssl2'</code>. This is because del.icio.us has some problems with <code>'ssl2'</code>, such
                as requests taking a long time to complete (around 2 seconds).
            </para>
        </note>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.service.flickr">
    <title>Zend_Service_Flickr</title>
    <sect2 id="zend.service.flickr.introduction">
        <title>Introduction to Searching Flickr</title>
        <para>
            <code>Zend_Service_Flickr</code> is a simple API for using the Flickr REST Web Service. In order to use
            the Flickr web services, you must have an API key. To obtain a key and for more information about the
            Flickr REST Web Service, please visit the
            <ulink url="http://www.flickr.com/services/api/">Flickr API Documentation</ulink>.
        </para>
        <para>
            In the following example, we use the <code>tagSearch()</code> method to search for photos having "php"
            in the tags.
        </para>
        <example id="zend.service.flickr.introduction.example-1">
            <title>Simple Flickr Photo Search</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Flickr.php';

$flickr = new Zend_Service_Flickr('MY_API_KEY');

$results = $flickr->tagSearch("php");

foreach ($results as $result) {
    echo $result->title . '<br />';
}]]>
            </programlisting>
        </example>
        <note>
            <title>Optional parameter</title>
            <para>
                <code>tagSearch()</code> accepts an optional second parameter as an array of options.
            </para>
        </note>
    </sect2>
    <sect2 id="zend.service.flickr.finding-users">
        <title>Finding Flickr Users' Photos and Information</title>
        <para>
            <code>Zend_Service_Flickr</code> provides several ways to get information about Flickr users:
        </para>
        <itemizedlist>
            <listitem>
                <para>
                    <code>userSearch()</code>: Accepts a string query of space-delimited tags and an optional second
                    parameter as an array of search options, and returns a set of photos as a
                    <code>Zend_Service_Flickr_ResultSet</code> object.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>getIdByUsername()</code>: Returns a string user ID associated with the given username string.
                </para>
            </listitem>
            <listitem>
                <para>
                    <code>getIdByEmail()</code>: Returns a string user ID associated with the given email address
                    string.
                </para>
            </listitem>
        </itemizedlist>
        <example id="zend.service.flickr.finding-users.example-1">
            <title>Finding a Flickr User's Public Photos by E-Mail Address</title>
            <para>
                In this example, we have a Flickr user's e-mail address, and we search for the user's public photos by
                using the <code>userSearch()</code> method:
            </para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Flickr.php';

$flickr = new Zend_Service_Flickr('MY_API_KEY');

$results = $flickr->userSearch($userEmail);

foreach ($results as $result) {
    echo $result->title . '<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.flickr.grouppoolgetphotos">
        <title>Finding photos From a Group Pool</title>
        <para>
            <code>Zend_Service_Flickr</code> allows to retrieve a group's pool photos based 
            on the group ID. Use the <code>groupPoolGetPhotos()</code> method:
        </para>
        <example id="zend.service.flickr.grouppoolgetphotos.example-1">
            <title>Retrieving a Group's Pool Photos by Group ID</title>
            <programlisting role="php"><![CDATA[<?php
    require_once 'Zend/Service/Flickr.php';

    $flickr = new Zend_Service_Flickr('MY_API_KEY');

    $results = $flickr->groupPoolGetPhotos($groupId);

    foreach ($results as $result) {
        echo $result->title . '<br />';
    }]]>            
            </programlisting>
        </example>
        <note>
            <title>Optional parameter</title>
            <para>
                <code>groupPoolGetPhotos()</code> accepts an optional second parameter as an array of options. 
            </para>
        </note>
    </sect2>
    <sect2 id="zend.service.flickr.getimagedetails">
        <title>Retrieving Flickr Image Details</title>
        <para>
            <code>Zend_Service_Flickr</code> makes it quick and easy to get an image's details based on a given image
            ID. Just use the <code>getImageDetails()</code> method, as in the following example:
        </para>
        <example id="zend.service.flickr.getimagedetails.example-1">
            <title>Retrieving Flickr Image Details</title>
            <para>
                Once you have a Flickr image ID, it is a simple matter to fetch information about the image:
            </para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Flickr.php';

$flickr = new Zend_Service_Flickr('MY_API_KEY');

$image = $flickr->getImageDetails($imageId);

echo "Image ID $imageId is $image->width x $image->height pixels.<br />\n";
echo "<a href=\"$image->clickUri\">Click for Image</a>\n";]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.flickr.classes">
        <title>Zend_Service_Flickr Result Classes</title>
        <para>
            The following classes are all returned by <code>tagSearch()</code> and <code>userSearch()</code>:
            <itemizedlist>
                <listitem><para><link linkend="zend.service.flickr.classes.resultset"><code>Zend_Service_Flickr_ResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.flickr.classes.result"><code>Zend_Service_Flickr_Result</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.flickr.classes.image"><code>Zend_Service_Flickr_Image</code></link></para></listitem>
            </itemizedlist>
        </para>
        <sect3 id="zend.service.flickr.classes.resultset">
            <title>Zend_Service_Flickr_ResultSet</title>
            <para>Represents a set of Results from a Flickr search.</para>
            <note>
                <para>
                    Implements the <code>SeekableIterator</code> interface for easy iteration (e.g., using
                    <code>foreach</code>), as well as direct access to a specific result using <code>seek()</code>.
                </para>
            </note>
            <sect4 id="zend.service.flickr.classes.resultset.properties">
                <title>Properties</title>
                <table id="zend.service.flickr.classes.resultset.properties.table-1">
                    <title>Zend_Service_Flickr_ResultSet Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>totalResultsAvailable</entry>
                                <entry>int</entry>
                                <entry>Total Number of Results available</entry>
                            </row>
                            <row>
                                <entry>totalResultsReturned</entry>
                                <entry>int</entry>
                                <entry>Total Number of Results returned</entry>
                            </row>
                            <row>
                                <entry>firstResultPosition</entry>
                                <entry>int</entry>
                                <entry>The offset in the total result set of this result set</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </sect4>
            <sect4 id="zend.service.flickr.classes.resultset.totalResults">
                <title>Zend_Service_Flickr_ResultSet::totalResults()</title>
                <para>
                    <methodsynopsis>
                        <type>int</type>
                        <methodname>totalResults</methodname>
                        <void />
                    </methodsynopsis>
                </para>
                <para>
                    Returns the total number of results in this result set.
                </para>
                <para>
                    <link linkend="zend.service.flickr.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.flickr.classes.result">
            <title>Zend_Service_Flickr_Result</title>
            <para>
                A single Image result from a Flickr query
            </para>
            <sect4 id="zend.service.flickr.classes.result.properties">
                <title>Properties</title>
                <table id="zend.service.flickr.classes.result.properties.table-1">
                    <title>Zend_Service_Flickr_Result Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>id</entry>
                                <entry>string</entry>
                                <entry>Image ID</entry>
                            </row>
                            <row>
                                <entry>owner</entry>
                                <entry>string</entry>
                                <entry>The photo owner's NSID.</entry>
                            </row>
                            <row>
                                <entry>secret</entry>
                                <entry>string</entry>
                                <entry>A key used in url construction.</entry>
                            </row>
                            <row>
                                <entry>server</entry>
                                <entry>string</entry>
                                <entry>The servername to use for URL construction.</entry>
                            </row>
                            <row>
                                <entry>title</entry>
                                <entry>string</entry>
                                <entry>The photo's title.</entry>
                            </row>
                            <row>
                                <entry>ispublic</entry>
                                <entry>string</entry>
                                <entry>The photo is public.</entry>
                            </row>
                            <row>
                                <entry>isfriend</entry>
                                <entry>string</entry>
                                <entry>The photo is visible to you because you are a friend of the owner.</entry>
                            </row>
                            <row>
                                <entry>isfamily</entry>
                                <entry>string</entry>
                                <entry>The photo is visible to you because you are family of the owner.</entry>
                            </row>
                            <row>
                                <entry>license</entry>
                                <entry>string</entry>
                                <entry>The license the photo is available under.</entry>
                            </row>
                            <row>
                                <entry>dateupload</entry>
                                <entry>string</entry>
                                <entry>The date the photo was uploaded.</entry>
                            </row>
                            <row>
                                <entry>datetaken</entry>
                                <entry>string</entry>
                                <entry>The date the photo was taken.</entry>
                            </row>
                            <row>
                                <entry>ownername</entry>
                                <entry>string</entry>
                                <entry>The screenname of the owner.</entry>
                            </row>
                            <row>
                                <entry>iconserver</entry>
                                <entry>string</entry>
                                <entry>The server used in assembling icon URLs.</entry>
                            </row>
                            <row>
                                <entry>Square</entry>
                                <entry><link linkend="zend.service.flickr.classes.image">Zend_Service_Flickr_Image</link></entry>
                                <entry>A 75x75 thumbnail of the image.</entry>
                            </row>
                            <row>
                                <entry>Thumbnail</entry>
                                <entry><link linkend="zend.service.flickr.classes.image">Zend_Service_Flickr_Image</link></entry>
                                <entry>A 100 pixel thumbnail of the image.</entry>
                            </row>
                            <row>
                                <entry>Small</entry>
                                <entry><link linkend="zend.service.flickr.classes.image">Zend_Service_Flickr_Image</link></entry>
                                <entry>A 240 pixel version of the image.</entry>
                            </row>
                            <row>
                                <entry>Medium</entry>
                                <entry><link linkend="zend.service.flickr.classes.image">Zend_Service_Flickr_Image</link></entry>
                                <entry>A 500 pixel version of the image.</entry>
                            </row>
                            <row>
                                <entry>Large</entry>
                                <entry><link linkend="zend.service.flickr.classes.image">Zend_Service_Flickr_Image</link></entry>
                                <entry>A 640 pixel version of the image.</entry>
                            </row>
                            <row>
                                <entry>Original</entry>
                                <entry><link linkend="zend.service.flickr.classes.image">Zend_Service_Flickr_Image</link></entry>
                                <entry>The original image.</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.flickr.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.flickr.classes.image">
            <title>Zend_Service_Flickr_Image</title>
            <para>Represents an Image returned by a Flickr search.</para>
            <sect4 id="zend.service.flickr.classes.image.properties">
                <title>Properties</title>
                <table id="zend.service.flickr.classes.image.properties.table-1">
                    <title>Zend_Service_Flickr_Image Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>uri</entry>
                                <entry>string</entry>
                                <entry>URI for the original image</entry>
                            </row>
                            <row>
                                <entry>clickUri</entry>
                                <entry>string</entry>
                                <entry>Clickable URI (i.e. the Flickr page) for the image</entry>
                            </row>
                            <row>
                                <entry>width</entry>
                                <entry>int</entry>
                                <entry>Width of the Image</entry>
                            </row>
                            <row>
                                <entry>height</entry>
                                <entry>int</entry>
                                <entry>Height of the Image</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.flickr.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.service.nirvanix">
    <title>Zend_Service_Nirvanix</title>

    <sect2 id="zend.service.nirvanix.introduction">
        <title>Introduction</title>

        <para>
            Nirvanix provides an Internet Media File System (IMFS), an
            Internet storage service that allows applications to upload, store and
            organize files and subsequently access them using a standard Web
            Services interface. An IMFS is distributed clustered file system,
            accessed over the Internet, and optimized for dealing with media files
            (audio, video, etc). The goal of an IMFS is to provide massive
            scalability to deal with the challenges of media storage growth, with
            guaranteed access and availability regardless of time and location.
            Finally, an IMFS gives applications the ability to access data
            securely, without the large fixed costs associated with acquiring and
            maintaining physical storage assets.
        </para>
    </sect2>

    <sect2 id="zend.service.nirvanix.registering">
        <title>Registering with Nirvanix</title>

        <para>
            Before you can get started with <code>Zend_Service_Nirvanix</code>, you must first
            register for an account.  Please see the 
            <ulink url="http://www.nirvanix.com/gettingStarted.aspx">Getting Started</ulink>
            page on the Nirvanix website for more information.
        </para>

        <para>
            After registering, you will receive a Username, Password, and 
            Application Key.  All three are required to use <code>Zend_Service_Nirvanix</code>.
        </para>
    </sect2>

    <sect2 id="zend.service.nirvanix.apiDocumentation">
        <title>API Documentation</title>

        <para>
            Access to the Nirvanix IMFS is available through both SOAP and a faster 
            REST service.  <code>Zend_Service_Nirvanix</code> provides a 
            relatively thin PHP 5 wrapper around the REST service.
        </para>
      
        <para>
            <code>Zend_Service_Nirvanix</code> aims to make using the Nirvanix REST service
            easier but understanding the service itself is still essential to be successful
            with Nirvanix.  
        </para>

        <para>
            The <ulink url="http://developer.nirvanix.com/sitefiles/1000/API.html">Nirvanix API Documentation</ulink>
            provides an overview as well as detailed information using the
            service.  Please familiarize yourself with this document and refer back to it
            as you use <code>Zend_Service_Nirvanix</code>.
        </para>
    </sect2>

    <sect2 id="zend.service.nirvanix.features">
        <title>Features</title>

        <para>
            Nirvanix's REST service can be used effectively with PHP using the 
            <ulink url="http://www.php.net/simplexml">SimpleXML</ulink>
            extension and <code>Zend_Http_Client</code> alone. However, using it this way
            is somewhat inconvenient due to repetitive operations like passing the
            session token on every request and repeatedly checking the response body for
            error codes.  
        </para>

        <para>
            <code>Zend_Service_Nirvanix</code> provides the following functionality:

            <itemizedlist>
                <listitem>
                    <para>
                        A single point for configuring your Nirvanix authentication
                        credentials that can be used across the Nirvanix namespaces.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        A proxy object that is more convenient to use than an HTTP client
                        alone, mostly removing the need to manually construct HTTP POST
                        requests to access the REST service.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        A response wrapper that parses each response body and throws an
                        exception if an error occurred, alleviating the need to repeatedly 
                        check the success of many commands.
                    </para>
                </listitem>

                <listitem>
                    <para>
                        Additional convenience methods for some of the more common operations.
                    </para>
                </listitem>
            </itemizedlist>
        </para>
    </sect2>

    <sect2 id="zend.service.nirvanix.storing-your-first">
        <title>Getting Started</title>

        <para>
            Once you have registered with Nirvanix, you're ready to store your first
            file on the IMFS.  The most common operations that you will need to do 
            on the IMFS are creating a new file, downloading an existing file, and
            deleting a file.  <code>Zend_Service_Nirvanix</code> provides convenience
            methods for these three operations.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Nirvanix.php';        

$auth = array('username' => 'your-username',
              'password' => 'your-password',
              'appKey'   => 'your-app-key');

$nirvanix = new Zend_Service_Nirvanix($auth);
$imfs = $nirvanix->getService('IMFS');

$imfs->putContents('/foo.txt', 'contents to store');

echo $imfs->getContents('/foo.txt');

$imfs->unlink('/foo.txt');]]>
        </programlisting>

        <para>
            The first step to using <code>Zend_Service_Nirvanix</code> is always
            to authenticate against the service. This is done by passing your
            credentials to the <code>Zend_Service_Nirvanix</code> constructor
            above. The associative array is passed directly to Nirvanix as POST
            parameters.
        </para>

        <para>
            Nirvanix divides its web services into 
            <ulink url="http://developer.nirvanix.com/sitefiles/1000/API.html#_Toc175999879">namespaces</ulink>.  
            Each namespace encapsulates a group of related operations. After getting
            an instance of <code>Zend_Service_Nirvanix</code>, call the
            <code>getService()</code> method to create a proxy for the namespace
            you want to use. Above, a proxy for the <code>IMFS</code> namespace is created.
        </para>

        <para>
            After you have a proxy for the namespace you want to use, call methods on it.
            The proxy will allow you to use any command available on the REST API.  The
            proxy may also make convenience methods available, which wrap web service
            commands.  The example above shows using the IMFS convenience methods to create a
            new file, retrieve and display that file, and finally delete the file.
        </para>
    </sect2>

    <sect2 id="zend.service.nirvanix.understanding-proxy">
        <title>Understanding the Proxy</title>

        <para>
            In the previous example, we used the <code>getService()</code> method to return
            a proxy object to the <code>IMFS</code> namespace.  The proxy object allows
            you to use the Nirvanix REST service in a way that's closer to making a normal
            PHP method call, as opposed to constructing your own HTTP request objects.
        </para>

        <para>
            A proxy object may provide convenience methods.  These are methods that the
            <code>Zend_Service_Nirvanix</code> provides to simplify the use of 
            the Nirvanix web services.  In the previous example, the methods 
            <code>putContents()</code>, <code>getContents()</code>, and <code>unlink()</code>
            do not have direct equivalents in the REST API.  They are convenience methods 
            provided by <code>Zend_Service_Nirvanix</code> that abstract more complicated
            operations on the REST API.
        </para>

        <para>
            For all other method calls to the proxy object, the proxy will dynamically
            convert the method call to the equivalent HTTP POST request to the REST API.
            It does this by using the method name as the API command, and an associative
            array in the first argument as the POST parameters.  
        </para>

        <para>
            Let's say you want to call the REST API method 
            <ulink url="http://developer.nirvanix.com/sitefiles/1000/API.html#_Toc175999923">RenameFile</ulink>,
            which does not have a convenience method in <code>Zend_Service_Nirvanix</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Nirvanix.php';        

$auth = array('username' => 'your-username',
              'password' => 'your-password',
              'appKey'   => 'your-app-key');

$nirvanix = new Zend_Service_Nirvanix($auth);
$imfs = $nirvanix->getService('IMFS');

$result = $imfs->renameFile(array('filePath' => '/path/to/foo.txt',
                                  'newFileName' => 'bar.txt'));]]>
        </programlisting>        

        <para>
            Above, a proxy for the <code>IMFS</code> namespace is created.  A method, 
            <code>renameFile()</code>, is then called on the proxy.  This method does not
            exist as a convenience method in the PHP code, so it is trapped by 
            <code>__call()</code> and converted into a POST request to the REST API where
            the associative array is used as the POST parameters.
        </para>

        <para>
            Notice in the Nirvanix API documentation that <code>sessionToken</code> is required
            for this method but we did not give it to the proxy object.  It is added 
            automatically for your convenience.
        </para>

        <para>
            The result of this operation will either be a <code>Zend_Service_Nirvanix_Response</code>
            object wrapping the XML returned by Nirvanix, or a <code>Zend_Service_Nirvanix_Exception</code>
            if an error occurred.
        </para>
    </sect2>

    <sect2 id="zend.service.nirvanix.examining-results">
        <title>Examining Results</title>

        <para>
            The Nirvanix REST API always returns its results in XML.  <code>Zend_Service_Nirvanix</code>
            parses this XML with the <code>SimpleXML</code> extension and then decorates
            the resulting <code>SimpleXMLElement</code> with a <code>Zend_Service_Nirvanix_Response</code>
            object.  
        </para>

        <para>
            The simplest way to examine a result from the service is to use the
            built-in PHP functions like <code>print_r()</code>:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Nirvanix.php';        

$auth = array('username' => 'your-username',
              'password' => 'your-password',
              'appKey'   => 'your-app-key');

$nirvanix = new Zend_Service_Nirvanix($auth);
$imfs = $nirvanix->getService('IMFS');

$result = $imfs->putContents('/foo.txt', 'fourteen bytes');
print_r($result);
?>


Zend_Service_Nirvanix_Response Object
(
    [_sxml:protected] => SimpleXMLElement Object
        (
            [ResponseCode] => 0
            [FilesUploaded] => 1
            [BytesUploaded] => 14
        ))]]>
        </programlisting>

        <para>
            You can access any property or method of the decorated <code>SimpleXMLElement</code>.
            In the above example, <code>$result->BytesUploaded</code> could be used to see the
            number of bytes received.  Should you want to access the <code>SimpleXMLElement</code>
            directly, just use <code>$result->getSxml()</code>.
        </para>

        <para>
            The most common response from Nirvanix is success (<code>ResponseCode</code> of zero).  
            It is not normally necessary to check <code>ResponseCode</code> because any non-zero
            result will throw a <code>Zend_Service_Nirvanix_Exception</code>.  See the next
            section on handling errors.
        </para>
    </sect2>

    <sect2 id="zend.service.nirvanix.handling-errors">
        <title>Handling Errors</title>

        <para>
            When using Nirvanix, it's important to anticipate errors that can be returned 
            by the service and handle them appropriately.  
        </para>

        <para>
            All operations against the REST service result in an XML return payload that 
            contains a <code>ResponseCode</code> element, such as the following example:
        </para>

        <programlisting role="xml"><![CDATA[
<Response>
   <ResponseCode>0</ResponseCode>
</Response>]]>
        </programlisting>
    
        <para>
            When the <code>ResponseCode</code> is zero such as in the example
            above, the operation was successful. When the operation is not
            successful, the <code>ResponseCode</code> is non-zero and an
            <code>ErrorMessage</code> element should be present.
        </para>

        <para>
            To alleviate the need to repeatedly check if the <code>ResponseCode</code>
            is non-zero, <code>Zend_Service_Nirvanix</code> automatically checks each response 
            returned by Nirvanix.  If the <code>ResponseCode</code> indicates an 
            error, a <code>Zend_Service_Nirvanix_Exception</code> will be thrown.
        </para>

        <programlisting role="xml"><![CDATA[<?php
require_once 'Zend/Service/Nirvanix.php';        
        
$auth = array('username' => 'your-username',
              'password' => 'your-password',
              'appKey'   => 'your-app-key');
$nirvanix = new Zend_Service_Nirvanix($auth);

try {

  $imfs = $nirvanix->getService('IMFS');
  $imfs->unlink('/a-nonexistant-path');

} catch (Zend_Service_Nirvanix_Exception $e) {
  echo $e->getMessage() . "\n";
  echo $e->getCode();
}]]>
        </programlisting>

        <para>
            In the example above, <code>unlink()</code> is a convenience method that wraps the
            <code>DeleteFiles</code> command on the REST API.  The <code>filePath</code> parameter required by the
            <ulink url="http://developer.nirvanix.com/sitefiles/1000/API.html#_Toc175999918">DeleteFiles</ulink>
            command contains a path that does not exist.  This will result in a 
            <code>Zend_Service_Nirvanix</code> exception being thrown with the message
            "Invalid path" and code 70005.
        </para>

        <para>
            The <ulink url="http://developer.nirvanix.com/sitefiles/1000/API.html">Nirvanix
            API Documentation</ulink> describes the errors associated with each command.  Depending
            on your needs, you may wrap each command in a <code>try</code> block or 
            wrap many commands in the same <code>try</code> block for convenience.  
        </para>
    </sect2>

</sect1>
<sect1 id="zend.service.simpy">
    <title>Zend_Service_Simpy</title>
    <sect2 id="zend.service.simpy.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Service_Simpy</code> is a lightweight wrapper for the free REST API available
            for the Simpy social bookmarking service.
        </para>
        <para>
            In order to use <code>Zend_Service_Simpy</code>, you should already have a Simpy account.
            To get an account, visit the <ulink url="http://simpy.com">Simpy web site</ulink>. For more
            information on the Simpy REST API, refer to the
            <ulink url="http://www.simpy.com/doc/api/rest">Simpy REST API documentation</ulink>.
        </para>
        <para>
            The Simpy REST API allows developers to interact with specific aspects of the service that
            the Simpy web site offers. The sections following will outline the use of
            <code>Zend_Service_Simpy</code> for each of these areas.
            <itemizedlist>
                <listitem>
                    <para>
                        Links: Create, Retrieve, Update, Delete
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Tags: Retrieve, Delete, Rename, Merge, Split
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Notes: Create, Retrieve, Update, Delete
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Watchlists: Get, Get All
                    </para>
                </listitem>
            </itemizedlist>
        </para>
    </sect2>
    <sect2 id="zend.service.simpy.links">
        <title>Links</title>
        <para>
            When querying links, results are returned in descending order by date added. Links can be
            searched by title, nickname, tags, note, or even the content of the web page associated
            with the link. Simpy offers searching by any or all of these fields with phrases, boolean
            operators, and wildcards. See the
            <ulink url="http://www.simpy.com/faq#searchSyntax">search syntax</ulink> and
            <ulink url="http://www.simpy.com/faq#searchFieldsLinks">search fields</ulink>
            sections of the Simpy FAQ for more information.
        </para>
        <example id="zend.service.simpy.links.querying">
            <title>Querying Links</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Simpy.php';
$simpy = new Zend_Service_Simpy('yourusername', 'yourpassword');

/* Search for the 10 links added most recently */
$linkQuery = new Zend_Service_Simpy_LinkQuery();
$linkQuery->setLimit(10);

/* Get and display the links */
$linkSet = $simpy->getLinks($linkQuery);
foreach ($linkSet as $link) {
    echo '<a href="';
    echo $link->getUrl();
    echo '">';
    echo $link->getTitle();
    echo '</a><br />';
}

/* Search for the 5 links added most recently with 'PHP' in
the title */
$linkQuery->setQueryString('title:PHP');
$linkQuery->setLimit(5);

/* Search for all links with 'French' in the title and
'language' in the tags */
$linkQuery->setQueryString('+title:French +tags:language');

/* Search for all links with 'French' in the title and without
'travel' in the tags */
$linkQuery->setQueryString('+title:French -tags:travel');

/* Search for all links added on 12/9/06 */
$linkQuery->setDate('2006-12-09');

/* Search for all links added after 12/9/06 (excluding that
date) */
$linkQuery->setAfterDate('2006-12-09');

/* Search for all links added before 12/9/06 (excluding that
date) */
$linkQuery->setBeforeDate('2006-12-09');

/* Search for all links added between 12/1/06 and 12/9/06
(excluding those two dates) */
$linkQuery->setBeforeDate('2006-12-01');
$linkQuery->setAfterDate('2006-12-09');]]>
            </programlisting>
        </example>
        <para>
            Links are represented uniquely by their URLs. In other words, if an attempt is made to save
            a link that has the same URL as an existing link, data for the existing link will be
            overwritten with the data specified in the save attempt.
        </para>
        <example id="zend.service.simpy.links.modifying">
            <title>Modifying Links</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Simpy.php';
$simpy = new Zend_Service_Simpy('yourusername', 'yourpassword');

/* Save a link */
$simpy->saveLink(
    'Zend Framework' // Title
    'http://framework.zend.com', // URL
    Zend_Service_Simpy_Link::ACCESSTYPE_PUBLIC, // Access Type
    'zend, framework, php' // Tags
    'Zend Framework home page' // Alternative title
    'This site rocks!' // Note
);

/* Overwrite the existing link with new data */
$simpy->saveLink(
    'Zend Framework'
    'http://framework.zend.com',
    Zend_Service_Simpy_Link::ACCESSTYPE_PRIVATE, // Access Type has changed
    'php, zend, framework' // Tags have changed order
    'Zend Framework' // Alternative title has changed
    'This site REALLY rocks!' // Note has changed
);

/* Delete the link */
$simpy->deleteLink('http://framework.zend.com');

/* A really easy way to do spring cleaning on your links ;) */
$linkSet = $this->_simpy->getLinks();
foreach ($linkSet as $link) {
    $this->_simpy->deleteLink($link->getUrl());
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.simpy.tags">
        <title>Tags</title>
        <para>
            When retrieved, tags are sorted in decreasing order (i.e. highest
            first) by the number of links that use the tag.
        </para>
        <example id="zend.service.simpy.tags.working">
            <title>Working With Tags</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Simpy.php';
$simpy = new Zend_Service_Simpy('yourusername', 'yourpassword');

/* Save a link with tags */
$simpy->saveLink(
    'Zend Framework' // Title
    'http://framework.zend.com', // URL
    Zend_Service_Simpy_Link::ACCESSTYPE_PUBLIC, // Access Type
    'zend, framework, php' // Tags
);

/* Get a list of all tags in use by links and notes */
$tagSet = $simpy->getTags();

/* Display each tag with the number of links using it */
foreach ($tagSet as $tag) {
    echo $tag->getTag();
    echo ' - ';
    echo $tag->getCount();
    echo '<br />';
}

/* Remove the 'zend' tag from all links using it */
$simpy->removeTag('zend');

/* Rename the 'framework' tag to 'frameworks' */
$simpy->renameTag('framework', 'frameworks');

/* Split the 'frameworks' tag into 'framework' and
'development', which will remove the 'frameworks' tag for
all links that use it and add the tags 'framework' and
'development' to all of those links */
$simpy->splitTag('frameworks', 'framework', 'development');

/* Merge the 'framework' and 'development' tags back into
'frameworks', basically doing the opposite of splitting them */
$simpy->mergeTags('framework', 'development', 'frameworks');]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.simpy.notes">
        <title>Notes</title>
        <para>
            Notes can be saved, retrieved, and deleted. They are uniquely
            identified by a numeric ID value.
        </para>
        <example id="zend.service.simpy.notes.working">
            <title>Working With Notes</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Simpy.php';
$simpy = new Zend_Service_Simpy('yourusername', 'yourpassword');

/* Save a note */
$simpy->saveNote(
    'Test Note', // Title
    'test,note', // Tags
    'This is a test note.' // Description
);

/* Overwrite an existing note */
$simpy->saveNote(
    'Updated Test Note', // Title
    'test,note,updated', // Tags
    'This is an updated test note.', // Description
    $note->getId() // Unique identifier
);

/* Search for the 10 most recently added notes */
$noteSet = $simpy->getNotes(null, 10);

/* Display the notes */
foreach ($noteSet as $note) {
    echo '<p>';
    echo $note->getTitle();
    echo '<br />';
    echo $note->getDescription();
    echo '<br >';
    echo $note->getTags();
    echo '</p>';
}

/* Search for all notes with 'PHP' in the title */
$noteSet = $simpy->getNotes('title:PHP');

/* Search for all notes with 'PHP' in the title and
without 'framework' in the description */
$noteSet = $simpy->getNotes('+title:PHP -description:framework');

/* Delete a note */
$simpy->deleteNote($note->getId());]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.simpy.watchlists">
        <title>Watchlists</title>
        <para>
            Watchlists cannot be created or removed using the API, only
            retrieved. Thus, you must set up a watchlist via the Simpy web
            site prior to attempting to access it using the API.
        </para>
        <example id="zend.service.simpy.watchlists.retrieving">
            <title>Retrieving Watchlists</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Simpy.php';
$simpy = new Zend_Service_Simpy('yourusername', 'yourpassword');

/* Get a list of all watchlists */
$watchlistSet = $simpy->getWatchlists();

/* Display data for each watchlist */
foreach ($watchlistSet as $watchlist) {
    echo $watchlist->getId();
    echo '<br />';
    echo $watchlist->getName();
    echo '<br />';
    echo $watchlist->getDescription();
    echo '<br />';
    echo $watchlist->getAddDate();
    echo '<br />';
    echo $watchlist->getNewLinks();
    echo '<br />';

    foreach ($watchlist->getUsers() as $user) {
        echo $user;
        echo '<br />';
    }

    foreach ($watchlist->getFilters() as $filter) {
        echo $filter->getName();
        echo '<br />';
        echo $filter->getQuery();
        echo '<br />';
    }
}

/* Get an individual watchlist by its identifier */
$watchlist = $simpy->getWatchlist($watchlist->getId());
$watchlist = $simpy->getWatchlist(1);]]>
            </programlisting>
        </example>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.service.slideshare">

    <title>Introduction</title>

    <para>
        The <code>Zend_Service_SlideShare</code> component is used to interact with the
        <ulink url="http://www.slideshare.net/">slideshare.net</ulink> web services for hosting
        slide shows online. With this component, you can embed slide shows which are hosted on this
        web site within a web site and even upload new slide shows to your account.
    </para>

    <sect2 id="zend.service.slideshare.basicusage">

        <title>Getting Started with <code>Zend_Service_SlideShare</code></title>

        <para>
            In order to use the Zend_Service_SlideShare component you must first create an account
            on the slideshare.net servers (more information can be found
            <ulink url="http://www.slideshare.net/developers/">here</ulink>) in order to receive an
            API key, username, password and shared secret value -- all of which are needed in order
            to use the <code>Zend_Service_SlideShare</code> component.
        </para>

        <para>
            Once you have setup an account, you can begin using the
            <code>Zend_Service_SlideShare</code> component by creating a new instance of the
            <code>Zend_Service_SlideShare</code> object and providing these values as shown below:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/SlideShare.php';

// Create a new instance of the component
$ss = new Zend_Service_SlideShare('APIKEY', 'SHAREDSECRET', 'USERNAME', 'PASSWORD');
?>]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.service.slideshare.slideshowobj">

        <title>The SlideShow object</title>

        <para>
            All slide shows in the <code>Zend_Service_SlideShare</code> component are represented
            using the <code>Zend_Service_SlideShare_SlideShow</code> object (both when retrieving
            and uploading new	slide shows). For your reference a pesudo-code version of this class
            is provided below.
        </para>

        <programlisting role="php"><![CDATA[<?php
class Zend_Service_SlideShare_SlideShow {

    /**
     * Retrieves the location of the slide show
     */
    public function getLocation() {
        return $this->_location;
    }

    /**
     * Gets the transcript for this slide show
     */
    public function getTranscript() {
        return $this->_transcript;
    }

    /**
     * Adds a tag to the slide show
     */
    public function addTag($tag) {
        $this->_tags[] = (string)$tag;
        return $this;
    }

    /**
     * Sets the tags for the slide show
     */
    public function setTags(Array $tags) {
        $this->_tags = $tags;
        return $this;
    }

    /**
     * Gets all of the tags associated with the slide show
     */
    public function getTags() {
        return $this->_tags;
    }

    /**
     * Sets the filename on the local filesystem of the slide show
     * (for uploading a new slide show)
     */
    public function setFilename($file) {
        $this->_slideShowFilename = (string)$file;
        return $this;
    }

    /**
     * Retrieves the filename on the local filesystem of the slide show
     * which will be uploaded
     */
    public function getFilename() {
        return $this->_slideShowFilename;
    }

    /**
     * Gets the ID for the slide show
     */
    public function getId() {
        return $this->_slideShowId;
    }

    /**
     * Retrieves the HTML embed code for the slide show
     */
    public function getEmbedCode() {
        return $this->_embedCode;
    }

    /**
     * Retrieves the Thumbnail URi for the slide show
     */
    public function getThumbnailUrl() {
        return $this->_thumbnailUrl;
    }

    /**
     * Sets the title for the Slide show
     */
    public function setTitle($title) {
        $this->_title = (string)$title;
        return $this;
    }

    /**
     * Retrieves the Slide show title
     */
    public function getTitle() {
        return $this->_title;
    }

    /**
     * Sets the description for the Slide show
     */
    public function setDescription($desc) {
        $this->_description = (string)$desc;
        return $this;
    }

    /**
     * Gets the description of the slide show
     */
    public function getDescription() {
        return $this->_description;
    }

    /**
     * Gets the numeric status of the slide show on the server
     */
    public function getStatus() {
        return $this->_status;
    }

    /**
     * Gets the textual description of the status of the slide show on the server
     */
    public function getStatusDescription() {
        return $this->_statusDescription;
    }

    /**
     * Gets the permanent link of the slide show
     */
    public function getPermaLink() {
        return $this->_permalink;
    }

    /**
     * Gets the number of views the slide show has received
     */
    public function getNumViews() {
        return $this->_numViews;
    }
}]]>
        </programlisting>

        <note>

            <para>
                The above pseudo-class only shows those methods which should be used by end-user
                developers. Other available methods are internal to the component.
            </para>

        </note>

        <para>
            When using the <code>Zend_Service_SlideShare</code> component, this data class will be
            used frequently to browse or add new slide shows to or from the web service.
        </para>

    </sect2>

    <sect2 id="zend.service.slideshare.getslideshow">

        <title>Retrieving a single slide show</title>

        <para>
            The simplest usage of the <code>Zend_Service_SlideShare</code> component is the
            retrieval of a single slide show by slide show ID provided by the slideshare.net
            application and is done by calling the <code>getSlideShow()</code> method of a
            <code>Zend_Service_SlideShare</code> object and using the resulting
            <code>Zend_Service_SlideShare_SlideShow</code> object as shown.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/SlideShare.php';

// Create a new instance of the component
$ss = new Zend_Service_SlideShare('APIKEY', 'SHAREDSECRET', 'USERNAME', 'PASSWORD');

$slideshow = $ss->getSlideShow(123456);

print "Slide Show Title: {$slideshow->getTitle()}<br/>\n";
print "Number of views: {$slideshow->getNumViews()}<br/>\n";
?>]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.service.slideshare.getslideshowlist">

        <title>Retrieving Groups of Slide Shows</title>

        <para>
            If you do not know the specific ID of a slide show you are interested in retrieving,
            you can retrieving groups of slide shows by using one of three methods:
        </para>

        <itemizedlist mark="opencircle">
            <listitem>
                <para>
                    <emphasis role="strong">Slide shows from a specific account</emphasis>
                </para>

                <para>
                    You can retrieve slide shows from a specific account by using the
                    <code>getSlideShowsByUsername()</code> method and providing the username from
                    which the slide shows should be retrieved
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">Slide shows which contain specific tags</emphasis>
                </para>

                <para>
                    You can retrieve slide shows which contain one or more specific tags by using
                    the <code>getSlideShowsByTag</code> method and providing one or more tags which
                    the slide show must have assigned to it in order to be retrieved
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">Slide shows by group</emphasis>
                </para>

                <para>
                    You can retrieve slide shows which are a member of a specific group using the
                    <code>getSlideShowsByGroup</code> method and providng the name of the group
                    which the slide show must belong to in order to be retrieved
                </para>
            </listitem>
        </itemizedlist>

        <para>
            Each of the above methods of retrieving multiple slide shows a similar approach is
            used. An example of using each method is shown below:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/SlideShare.php';

// Create a new instance of the component
$ss = new Zend_Service_SlideShare('APIKEY', 'SHAREDSECRET', 'USERNAME', 'PASSWORD');

$starting_offset = 0;
$limit = 10;

// Retrieve the first 10 of each type
$ss_user = $ss->getSlideShowsByUser('username', $starting_offset, $limit);
$ss_tags = $ss->getSlideShowsByTag('zend', $starting_offset, $limit);
$ss_group = $ss->getSlideShowsByGroup('mygroup', $starting_offset, $limit);

// Iterate over the slide shows
foreach($ss_user as $slideshow) {
   print "Slide Show Title: {$slideshow->getTitle}<br/>\n";
}
?>]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.service.slideshare.caching">

        <title><code>Zend_Service_SlideShare</code> Caching policies</title>

        <para>
            By default, <code>Zend_Service_SlideShare</code> will cache any request against the web
            service automatically to the filesystem (default path <code>/tmp</code>) for 12 hours.
            If you desire to change this behavior, you must provide your own
            <xref linkend="zend.cache" /> object using the <code>setCacheObject</code> method as
            shown:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Cache.php';
require_once 'Zend/Service/SlideShare.php';

$frontendOptions = array(
                        'lifetime' => 7200,
                        'automatic_serialization' => true);
$backendOptions  = array(
                        'cache_dir' => '/webtmp/');

$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);

$ss = new Zend_Service_SlideShare('APIKEY', 'SHAREDSECRET', 'USERNAME', 'PASSWORD');
$ss->setCacheObject($cache);

$ss_user = $ss->getSlideShowsByUser('username', $starting_offset, $limit);
?>]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.service.slideshare.httpclient">

        <title>Changing the behavior of the HTTP Client</title>

        <para>
            If for whatever reason you would like to change the behavior of the HTTP client when
            making the web service request, you can do so by creating your own instance of the
            <code>Zend_Http_Client</code> object (see <xref linkend="zend.http" />). This is useful
            for instance when it is desirable to set the timeout for the connection to something
            other then default as shown:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Http/Client.php';

$client = new Zend_Http_Client();
$client->setConfig(array('timeout' => 5));

$ss = new Zend_Service_SlideShare('APIKEY', 'SHAREDSECRET', 'USERNAME', 'PASSWORD');
$ss->setHttpClient($client);
$ss_user = $ss->getSlideShowsByUser('username', $starting_offset, $limit);
?>]]>
        </programlisting>

    </sect2>

</sect1>
<sect1 id="zend.service.strikeiron.advanced-uses">
    <title>Zend_Service_StrikeIron: Advanced Uses</title>

    <para>
      This section describes the more advanced uses of Zend_Service_StrikeIron.
    </para>

    <sect2 id="zend.service.strikeiron.advanced-uses.services-by-wsdl">
      <title>Using Services by WSDL</title>

      <para>
        Some StrikeIron services may have a PHP wrapper class available,
        such as those described in
        <link linkend="zend.service.strikeiron.bundled-services">Bundled Services</link>.
        However, StrikeIron offers hundreds of services and many of these
        may be usable even without creating a special wrapper class.
      </para>

      <para>
        To try a StrikeIron service that does not have a wrapper class available,
        give the <code>wsdl</code> option to <code>getService()</code>
        instead of the <code>class</code> option:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

// Get a generic client to the Reverse Phone Lookup service
$phone = $strikeIron->getService(array('wsdl' => 'http://ws.strikeiron.com/ReversePhoneLookup?WSDL'));

$result = $phone->lookup(array('Number' => '(408) 253-8800'));
echo $result->listingName;

// Zend Technologies USA Inc]]>
        </programlisting>
      </para>

      <para>
        Using StrikeIron services from the WSDL will require at least some understanding
        of the WSDL files.  StrikeIron has many resources on its site to help with this.
        Also,
        <ulink url="http://janschneider.de">Jan Schneider</ulink> from the
        <ulink url="http://horde.org">Horde project</ulink> has written a
        <ulink url="http://janschneider.de/news/25/268">small PHP routine</ulink> that
        will format a WSDL file into more readable HTML.
      </para>

      <para>
        Please note that only the services
        described in the <link linkend="zend.service.strikeiron.bundled-services">Bundled Services</link>
        section are officially supported.
      </para>

    </sect2>

    <sect2 id="zend.service.strikeiron.viewing-soap-transactions">
      <title>Viewing SOAP Transactions</title>

      <para>
        All communication with StrikeIron is done using the SOAP extension.  It
        is sometimes useful to view the XML exchanged with StrikeIron for debug
        purposes.
      </para>

      <para>
        Every StrikeIron client (subclass of <code>Zend_Service_StrikeIron_Base</code>)
        contains a <code>getSoapClient()</code> method to return the underlying instance of
        <code>SOAPClient</code> used to communicate with StrikeIron.
      </para>

      <para>
        PHP's
        <ulink url="http://www.php.net/manual/en/function.soap-soapclient-construct.php">SOAPClient</ulink>
        has a <code>trace</code> option that causes it to remember the XML exchanged during the last transaction.
        Zend_Service_StrikeIron does not enable the <code>trace</code> option by default but this
        can easily by changed by specifying the options that will be passed to the <code>SOAPClient</code> constructor.
      </para>

      <para>
        To view a SOAP transaction, call the <code>getSoapClient()</code> method
        to get the <code>SOAPClient</code> instance and then call the appropriate
        methods like
        <ulink url="http://www.php.net/manual/en/function.soap-soapclient-getlastrequest.php"><code>__getLastRequest()</code></ulink>
        and
        <ulink url="http://www.php.net/manual/en/function.soap-soapclient-getlastresponse.php"><code>__getLastRequest()</code></ulink>:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password',
                                                'options'  => array('trace' => true)));

// Get a client for the Sales & Use Tax Basic service
$taxBasic = $strikeIron->getService(array('class' => 'SalesUseTaxBasic'));

// Perform a method call
$taxBasic->getTaxRateCanada(array('province' => 'ontario'));

// Get SOAPClient instance and view XML
$soapClient = $taxBasic->getSoapClient();
echo $soapClient->__getLastRequest();
echo $soapClient->__getLastResponse();]]>
        </programlisting>
      </para>

    </sect2>
</sect1>
<sect1 id="zend.service.strikeiron.bundled-services">
    <title>Zend_Service_StrikeIron: Bundled Services</title>

    <para>
      Zend_Service_StrikeIron comes with wrapper classes for three popular StrikeIron services.
    </para>

    <sect2 id="zend.service.strikeiron.bundled-services.zip-code-information">
      <title>ZIP Code Information</title>

      <para>
        <code>Zend_Service_StrikeIron_ZipCodeInfo</code> provides a client for StrikeIron's
        Zip Code Information Service.  For more information on this service, visit these
        StrikeIron resources:

        <itemizedlist>
          <listitem>
            <para>
              <ulink url="http://www.strikeiron.com/ProductDetail.aspx?p=267">Zip Code Information Service Page</ulink>
            </para>
          </listitem>
          <listitem>
            <para>
              <ulink url="http://sdpws.strikeiron.com/zf1.StrikeIron/sdpZIPCodeInfo?WSDL">Zip Code Information Service WSDL</ulink>
            </para>
          </listitem>
        </itemizedlist>

        The service contains a <code>getZipCode()</code> method that will retrieve information
        about a United States ZIP code or Canadian postal code:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

// Get a client for the Zip Code Information service
$zipInfo = $strikeIron->getService(array('class' => 'ZipCodeInfo'));

// Get the Zip information for 95014
$response = $zipInfo->getZipCode(array('ZipCode' => 95014));
$zips = $response->serviceResult;

// Display the results
if ($zips->count == 0) {
    echo 'No results found';
} else {
    // a result with one single zip code is returned as an object,
    // not an array with one element as one might expect.
    if (! is_array($zips->zipCodes)) {
        $zips->zipCodes = array($zips->zipCodes);
    }

    // print all of the possible results
    foreach ($zips->zipCodes as $z) {
        $info = $z->zipCodeInfo;

        // show all properties
        print_r($info);

        // or just the city name
        echo $info->preferredCityName;
    }
}

// Detailed status information
// http://www.strikeiron.com/exampledata/StrikeIronZipCodeInformation_v3.pdf
$status = $response->serviceStatus;]]>
        </programlisting>
      </para>
    </sect2>

    <sect2 id="zend.service.strikeiron.bundled-services.us-address-verification">
      <title>U.S. Address Verification</title>

      <para>
        <code>Zend_Service_StrikeIron_USAddressVerification</code> provides a client for
        StrikeIron's U.S. Address Verification Service.  For more information on this
        service, visit these StrikeIron resources:

        <itemizedlist>
          <listitem>
            <para>
              <ulink url="http://www.strikeiron.com/ProductDetail.aspx?p=198">U.S. Address Verification Service Page</ulink>
            </para>
          </listitem>
          <listitem>
            <para>
              <ulink url="http://ws.strikeiron.com/zf1.StrikeIron/USAddressVerification4_0?WSDL">U.S. Address Verification Service WSDL</ulink>
            </para>
          </listitem>
        </itemizedlist>
      </para>

      <para>
        The service contains a <code>verifyAddressUSA()</code> method that will verify
        an address in the United States:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

// Get a client for the Zip Code Information service
$verifier = $strikeIron->getService(array('class' => 'USAddressVerification'));

// Address to verify.  Not all fields are required but
// supply as many as possible for the best results.
$address = array('firm'           => 'Zend Technologies',
                 'addressLine1'   => '19200 Stevens Creek Blvd',
                 'addressLine2'   => '',
                 'city_state_zip' => 'Cupertino CA 95014');

// Verify the address
$result = $verifier->verifyAddressUSA($address);

// Display the results
if ($result->addressErrorNumber != 0) {
    echo $result->addressErrorNumber;
    echo $result->addressErrorMessage;
} else {
    // show all properties
    print_r($result);

    // or just the firm name
    echo $result->firm;

    // valid address?
    $valid = ($result->valid == 'VALID');
}]]>
        </programlisting>
      </para>
    </sect2>

    <sect2 id="zend.service.strikeiron.bundled-services.sales-use-tax-basic">
      <title>Sales &amp; Use Tax Basic</title>

      <para>
        <code>Zend_Service_StrikeIron_SalesUseTaxBasic</code> provides a client for
        StrikeIron's Sales &amp; Use Tax Basic service.  For more information on this
        service, visit these StrikeIron resources:

        <itemizedlist>
          <listitem>
            <para>
              <ulink url="http://www.strikeiron.com/ProductDetail.aspx?p=351">Sales &amp; Use Tax Basic Service Page</ulink>
            </para>
          </listitem>
          <listitem>
            <para>
              <ulink url="http://ws.strikeiron.com/zf1.StrikeIron/taxdatabasic4?WSDL">Sales &amp; Use Tax Basic Service WSDL</ulink>
            </para>
          </listitem>
        </itemizedlist>
      </para>

      <para>
        The service contains two methods, <code>getTaxRateUSA()</code> and <code>getTaxRateCanada()</code>,
        that will retrieve sales and use tax data for the United States and Canada, respectively.

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

// Get a client for the Sales & Use Tax Basic service
$taxBasic = $strikeIron->getService(array('class' => 'SalesUseTaxBasic'));

// Query tax rate for Ontario, Canada
$rateInfo = $taxBasic->getTaxRateCanada(array('province' => 'foo'));
print_r($rateInfo);               // show all properties
echo $rateInfo->GST;              // or just the GST (Goods & Services Tax)

// Query tax rate for Cupertino, CA USA
$rateInfo = $taxBasic->getTaxRateUS(array('zip_code' => 95014));
print_r($rateInfo);               // show all properties
echo $rateInfo->state_sales_tax;  // or just the state sales tax]]>
        </programlisting>
      </para>
    </sect2>
</sect1>
<sect1 id="zend.service.strikeiron">
    <title>Zend_Service_StrikeIron</title>

    <para>
        Zend_Service_StrikeIron provides a PHP 5 client to StrikeIron
        web services.  See the following sections:
    </para>

    <para>
        <itemizedlist>
            <listitem><para><xref linkend="zend.service.strikeiron" /></para></listitem>
        </itemizedlist>
        <itemizedlist>
            <listitem><para><xref linkend="zend.service.strikeiron.bundled-services" /></para></listitem>
        </itemizedlist>
        <itemizedlist>
            <listitem><para><xref linkend="zend.service.strikeiron.advanced-uses" /></para></listitem>
        </itemizedlist>
    </para>

    <sect2 id="zend.service.strikeiron.overview">
        <title>Overview</title>

        <para>
          <ulink url="http://www.strikeiron.com">StrikeIron</ulink>
          offers hundreds of commercial data services ("Data as a Service")
          such as Online Sales Tax, Currency Rates, Stock Quotes, Geocodes, Global
          Address Verification, Yellow/White Pages, MapQuest Driving Directions,
          Dun &amp; Bradstreet Business Credit Checks, and much, much more.
        </para>

        <para>
          Each StrikeIron web service service shares a standard SOAP (and REST)
          API, making it easy to integrate and manage multiple services.
          StrikeIron also manages customer billing for all services in a single
          account, making it perfect for solution providers. Get
          started with free web services at
          <ulink url="http://www.strikeiron.com/sdp">http://www.strikeiron.com/sdp</ulink>.
        </para>

        <para>
          StrikeIron's services may be used through the
          <ulink url="http://us.php.net/soap">PHP 5 SOAP extension</ulink> alone.
          However, using StrikeIron this way does not give an ideal PHP-like interface.
          The Zend_Service_StrikeIron component provides a lightweight layer on
          top of the SOAP extension for working with StrikeIron services in a
          more convenient, PHP-like manner.
        </para>

        <note>
          <para>
            The PHP 5 SOAP extension must be installed and enabled to use
            Zend_Service_StrikeIron.
          </para>
        </note>

        <para>
          The Zend_Service_StrikeIron component provides:

          <itemizedlist>
            <listitem>
              <para>
                A single point for configuring your StrikeIron authentication credentials
                that can be used across many StrikeIron services.
              </para>
            </listitem>

            <listitem>
              <para>
                A standard way of retrieving your StrikeIron subscription information
                such as license status and the number of hits remaining to a service.
              </para>
            </listitem>

            <listitem>
              <para>
                The ability to use any StrikeIron service from its WSDL without
                creating a PHP wrapper class, and the option of creating a wrapper for
                a more convenient interface.
              </para>
            </listitem>

            <listitem>
              <para>
                Wrappers for three popular StrikeIron services.
              </para>
            </listitem>
          </itemizedlist>
        </para>

    </sect2>

    <sect2 id="zend.service.strikeiron.registering">
      <title>Registering with StrikeIron</title>
      <para>
        Before you can get started with Zend_Service_StrikeIron, you must first
        <ulink url="http://strikeiron.com/Register.aspx">register</ulink> for a
        StrikeIron developer account.
      </para>

      <para>
        After registering, you will receive a StrikeIron username and password.
        These will be used when connecting to StrikeIron using Zend_Service_StrikeIron.
      </para>

      <para>
        You will also need to <ulink url="http://www.strikeiron.com/ProductDetail.aspx?p=257">sign up</ulink>
        for StrikeIron's Super Data Pack Web Service.
      </para>

      <para>
        Both registration steps are free and can be done relatively quickly through
        the StrikeIron website.
      </para>
    </sect2>

    <sect2 id="zend.service.strikeiron.getting-started">
      <title>Getting Started</title>
      <para>
        Once you have <ulink url="http://strikeiron.com/Register.aspx">registered</ulink>
        for a StrikeIron account and signed up for the
        <ulink url="http://www.strikeiron.com/ProductDetail.aspx?p=257">Super Data Pack</ulink>,
        you're ready to start using Zend_Service_StrikeIron.
      </para>

      <para>
        StrikeIron consists of hundreds of different web services.
        Zend_Service_StrikeIron can be used with many of these services but provides supported
        wrappers for three of them:
      </para>

      <itemizedlist>
        <listitem>
          <para><link linkend="zend.service.strikeiron.bundled-services.zip-code-information">ZIP Code Information</link></para>
        </listitem>
        <listitem>
          <para><link linkend="zend.service.strikeiron.bundled-services.us-address-verification">US Address Verification</link></para>
        </listitem>
        <listitem>
          <para><link linkend="zend.service.strikeiron.bundled-services.sales-use-tax-basic">Sales &amp; Use Tax Basic</link></para>
        </listitem>
      </itemizedlist>

      <para>
        The class <code>Zend_Service_StrikeIron</code> provides a simple way
        of specifying your StrikeIron account information and other options in
        its constructor. It also has a factory method that will return clients
        for StrikeIron services:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

$taxBasic = $strikeIron->getService(array('class' => 'SalesUseTaxBasic'));]]>
        </programlisting>
      </para>

      <para>
        The <code>getService()</code> method will return a client for any
        StrikeIron service by the name of its PHP wrapper class. In this case,
        the name <code>SalesUseTaxBasic</code> refers to the wrapper class
        <code>Zend_Service_StrikeIron_SalesUseTaxBasic</code>. Wrappers are
        included for three services and described in
        <link linkend="zend.service.strikeiron.bundled-services">Bundled Services</link>.
      </para>

      <para>
        The <code>getService()</code> method can also return a client for
        a StrikeIron service that does not yet have a PHP wrapper.  This is
        explained in
        <link linkend="zend.service.strikeiron.advanced-uses.services-by-wsdl">Using Services by WSDL</link>.
      </para>
    </sect2>

    <sect2 id="zend.service.strikeiron.making-first-query">
      <title>Making Your First Query</title>

      <para>
        Once you have used the <code>getService()</code> method to get a client
        for a particular StrikeIron service, you can utilize that client
        by calling methods on it just like any other PHP object.

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

// Get a client for the Sales & Use Tax Basic service
$taxBasic = $strikeIron->getService(array('class' => 'SalesUseTaxBasic'));

// Query tax rate for Ontario, Canada
$rateInfo = $taxBasic->getTaxRateCanada(array('province' => 'ontario'));
echo $rateInfo->province;
echo $rateInfo->abbreviation;
echo $rateInfo->GST;]]>
        </programlisting>

        In the example above, the <code>getService()</code> method is used
        to return a client to the
        <link linkend="zend.service.strikeiron.bundled-services.sales-use-tax-basic">Sales &amp; Use Tax Basic</link> service.
        The client object is stored in <code>$taxBasic</code>.
      </para>

      <para>
        The <code>getTaxRateCanada()</code> method is then called on the
        service. An associative array is used to supply keyword parameters to
        the method. This is the way that all StrikeIron methods are called.
      </para>

      <para>
        The result from <code>getTaxRateCanada()</code> is stored in
        <code>$rateInfo</code> and has properties like <code>province</code>
        and <code>GST</code>.
      </para>

      <para>
        Many of the StrikeIron services are as simple to use as the example above.  See
        <link linkend="zend.service.strikeiron.bundled-services">Bundled Services</link>
        for detailed information on three StrikeIron services.
      </para>
    </sect2>

    <sect2 id="zend.service.strikeiron.examining-results">
      <title>Examining Results</title>
      <para>
        When learning or debugging the StrikeIron services, it's often useful to dump the
        result returned from a method call.  The result will always be an object that is an
        instance of <code>Zend_Service_StrikeIron_Decorator</code>.  This is a
        small <ulink url="http://en.wikipedia.org/wiki/Decorator_pattern">decorator</ulink>
        object that wraps the results from the method call.
      </para>

      <para>
        The simplest way to examine a result from the service is to use the built-in
        PHP functions like <ulink url="http://www.php.net/print_r">print_r()</ulink>:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

$taxBasic = $strikeIron->getService(array('class' => 'SalesUseTaxBasic'));

$rateInfo = $taxBasic->getTaxRateCanada(array('province' => 'ontario'));
print_r($rateInfo);
?>


Zend_Service_StrikeIron_Decorator Object
(
    [_name:protected] => GetTaxRateCanadaResult
    [_object:protected] => stdClass Object
        (
            [abbreviation] => ON
            [province] => ONTARIO
            [GST] => 0.06
            [PST] => 0.08
            [total] => 0.14
            [HST] => Y
        )
)]]>
        </programlisting>
      </para>

      <para>
        In the output above, we see that the decorator (<code>$rateInfo</code>) wraps an object
        named <code>GetTaxRateCanadaResult</code>, the result of the call to <code>getTaxRateCanada()</code>.
      </para>

      <para>
        This means that <code>$rateInfo</code> has public properties like <code>abbreviation</code>,
        <code>province</code>, and <code>GST</code>.  These are accessed like <code>$rateInfo->province</code>.
      </para>

      <tip>
        <para>
          StrikeIron result properties sometimes start with an uppercase
          letter such as <code>Foo</code> or <code>Bar</code> where most PHP object
          properties normally start with a lowercase letter as in <code>foo</code> or
          <code>bar</code>. The decorator will automatically do this inflection so you
          may read a property <code>Foo</code> as <code>foo</code>.
        </para>
      </tip>

      <para>
        If you ever need to get the original object or its name out of the decorator, use the
        respective methods <code>getDecoratedObject()</code> and <code>getDecoratedObjectName()</code>.
      </para>
    </sect2>

    <sect2 id="zend.service.strikeiron.handling-errors">
      <title>Handling Errors</title>
      <para>
        The previous examples are naive, i.e. no error handling was shown.
        It's possible that StrikeIron will return a fault during a method
        call. Events like bad account credentials or an expired subscription
        can cause StrikeIron to raise a fault.
      </para>

      <para>
        An exception will be thrown when such a fault occurs. You should
        anticipate and catch these exceptions when making method calls to the
        service:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

$taxBasic = $strikeIron->getService(array('class' => 'SalesUseTaxBasic'));

try {

  $taxBasic->getTaxRateCanada(array('province' => 'ontario'));

} catch (Zend_Service_StrikeIron_Exception $e) {

  // error handling for events like connection
  // problems or subscription errors

}]]>
        </programlisting>
        The exceptions thrown will always be <code>Zend_Service_StrikeIron_Exception</code>.
      </para>

      <para>
        It's important to understand the difference between exceptions and
        normal failed method calls. Exceptions occur for
        <emphasis>exceptional</emphasis> conditions, such as
        the network going down or your subscription expiring.
        Failed method calls that are a common occurrence,
        such as <code>getTaxRateCanada()</code> not finding the
        <code>province</code> you supplied, will not result an in exception.
      </para>

      <note>
        <para>
          Every time you make a method call to a StrikeIron service, you
          should check the response object for validity and also be
          prepared to catch an exception.
        </para>
      </note>

      <para><!-- included for whitespace --></para>
    </sect2>

    <sect2 id="zend.service.strikeiron.checking-subscription">
      <title>Checking Your Subscription</title>
      <para>
        StrikeIron provides many different services.  Some of these are
        free, some are available on a trial basis, and some are pay subscription only.
        When using StrikeIron, it's important to be aware of your subscription
        status for the services you are using and check it regularly.
      </para>

      <para>
        Each StrikeIron client returned by the <code>getService</code> method
        has the ability to check the subscription status for that service using
        the <code>getSubscriptionInfo()</code> method of the client:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/StrikeIron.php';

// Get a client for the Sales & Use Tax Basic service
$strikeIron = new Zend_Service_StrikeIron(array('username' => 'your-username',
                                                'password' => 'your-password'));

$taxBasic = $strikeIron->getService(array('class => 'SalesUseTaxBasic'));

// Check remaining hits for the Sales & Use Tax Basic service
$subscription = $taxBasic->getSubscriptionInfo();
echo $subscription->remainingHits;]]>
        </programlisting>
      </para>

      <para>
        The <code>getSubscriptionInfo()</code> method will return an object
        that typically has a <code>remainingHits</code> property.  It's
        important to check the status on each service that you are using.  If
        a method call is made to StrikeIron after the remaining hits have been
        used up, an exception will occur.
      </para>

      <para>
        Checking your subscription to a service does not use any remaining
        hits to the service.  Each time any method call to the service is made,
        the number of hits remaining will be cached and this cached value will
        be returned by <code>getSubscriptionInfo()</code> without connecting
        to the service again.  To force <code>getSubscriptionInfo()</code>
        to override its cache and query the subscription information again, use
        <code>getSubscriptionInfo(true)</code>.
      </para>
    </sect2>
</sect1>
<sect1 id="zend.service.technorati">
    <title>Zend_Service_Technorati</title>

    <sect2 id="zend.service.technorati.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Service_Technorati</code> provides an easy, intuitive and object-oriented interface for using
            the Technorati API. It provides access to all available
            <ulink url="http://technorati.com/developers/api/">Technorati API queries</ulink>
            and returns the original XML response as a friendly PHP object.
        </para>
        <para>
            <ulink url="http://technorati.com/">Technorati</ulink> is one of the most popular blog search engines.
            The API interface enables developers to retrieve information about a specific blog, search blogs matching a
            single tag or phrase and get information about a specific author (blogger). For a full list of available
            queries please see the
            <ulink url="http://technorati.com/developers/api/">Technorati API documentation</ulink>
            or the <link linkend="zend.service.technorati.queries">Available Technorati queries</link> section of this
            document.
        </para>
    </sect2>

    <sect2 id="zend.service.technorati.getting-started">
        <title>Getting Started</title>
        <para>
            Technorati requires a valid API key for usage. To get your own API Key you first need to
            <ulink url="http://technorati.com/signup/">create a new Technorati account</ulink>, then visit the
            <ulink url="http://technorati.com/developers/apikey.html">API Key section</ulink>.
        </para>
        <note>
            <title>API Key limits</title>
            <para>
                You can make up to 500 Technorati API calls per day, at no charge.
                Other usage limitations may apply, depending on the current Technorati API license.
            </para>
        </note>
        <para>
            Once you have a valid API key, you're ready to start using <code>Zend_Service_Technorati</code>.
        </para>
    </sect2>

    <sect2 id="zend.service.technorati.making-first-query">
        <title>Making Your First Query</title>
        <para>
            In order to run a query, first you need a <code>Zend_Service_Technorati</code> instance with a valid API
            key. Then choose one of the available query methods, and call it providing required arguments.
        </para>
        <example id="zend.service.technorati.making-first-query.example-1">
            <title>Sending your first query</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

// create a new Zend_Service_Technorati
// with a valid API_KEY
$technorati = new Zend_Service_Technorati('VALID_API_KEY');

// search Technorati for PHP keyword
$resultSet = $technorati->search('PHP');
]]>
            </programlisting>
        </example>
        <para>
            Each query method accepts an array of optional parameters that can be used to refine your query.
        </para>
        <example id="zend.service.technorati.making-first-query.example-2">
            <title>Refining your query</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

// create a new Zend_Service_Technorati
// with a valid API_KEY
$technorati = new Zend_Service_Technorati('VALID_API_KEY');

// filter your query including only results
// with some authority (Results from blogs with a handful of links)
$options = array('authority' => 'a4');

// search Technorati for PHP keyword
$resultSet = $technorati->search('PHP', $options);
]]>
            </programlisting>
        </example>
        <para>
            A <code>Zend_Service_Technorati</code> instance is not a single-use object. That is, you don't need to
            create a new instance for each query call; simply use your current <code>Zend_Service_Technorati</code>
            object as long as you need it.
        </para>
        <example id="zend.service.technorati.making-first-query.example-3">
            <title>Sending multiple queries with the same <code>Zend_Service_Technorati</code> instance</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

// create a new Zend_Service_Technorati
// with a valid API_KEY
$technorati = new Zend_Service_Technorati('VALID_API_KEY');

// search Technorati for PHP keyword
$search = $technorati->search('PHP');

// get top tags indexed by Technorati
$topTags = $technorati->topTags();
]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.service.technorati.consuming-results">
        <title>Consuming Results</title>
        <para>
            You can get one of two types of result object in response to a query.
        </para>
        <para>
            The first group is represented by <code>Zend_Service_Technorati_*ResultSet</code> objects. A result set
            object is basically a collection of result objects. It extends the basic
            <code>Zend_Service_Technorati_ResultSet</code> class and implements the <code>SeekableIterator</code> PHP
            interface. The best way to consume a result set object is to loop over it with the PHP <code>foreach</code>
            statement.
        </para>
        <example id="zend.service.technorati.consuming-results.example-1">
            <title>Consuming a result set object</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

// create a new Zend_Service_Technorati
// with a valid API_KEY
$technorati = new Zend_Service_Technorati('VALID_API_KEY');

// search Technorati for PHP keyword
// $resultSet is an instance of Zend_Service_Technorati_SearchResultSet
$resultSet = $technorati->search('PHP');

// loop over all result objects
foreach ($resultSet as $result) {
    // $result is an instance of Zend_Service_Technorati_SearchResult
} ]]>
            </programlisting>
        </example>
        <para>
            Because <code>Zend_Service_Technorati_ResultSet</code> implements the <code>SeekableIterator</code>
            interface, you can seek a specific result object using its position in the result collection.
        </para>
        <example id="zend.service.technorati.consuming-results.example-2">
            <title>Seeking a specific result set object</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

// create a new Zend_Service_Technorati
// with a valid API_KEY
$technorati = new Zend_Service_Technorati('VALID_API_KEY');

// search Technorati for PHP keyword
// $resultSet is an instance of Zend_Service_Technorati_SearchResultSet
$resultSet = $technorati->search('PHP');

// $result is an instance of Zend_Service_Technorati_SearchResult
$resultSet->seek(1);
$result = $resultSet->current();
]]>
            </programlisting>
        </example>
        <note>
            <para>
                <code>SeekableIterator</code> works as an array and counts positions starting from index 0. Fetching
                position number 1 means getting the second result in the collection.
            </para>
        </note>
        <para>
            The second group is represented by special standalone result objects.
            <code>Zend_Service_Technorati_GetInfoResult</code>, <code>Zend_Service_Technorati_BlogInfoResult</code> and
            <code>Zend_Service_Technorati_KeyInfoResult</code> act as wrappers for additional objects, such as
            <code>Zend_Service_Technorati_Author</code> and <code>Zend_Service_Technorati_Weblog</code>.
        </para>
        <example id="zend.service.technorati.consuming-results.example-3">
            <title>Consuming a standalone result object</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

// create a new Zend_Service_Technorati
// with a valid API_KEY
$technorati = new Zend_Service_Technorati('VALID_API_KEY');

// get info about weppos author
$result = $technorati->getInfo('weppos');

$author = $result->getAuthor();
echo "<h2>Blogs authored by " . $author->getFirstName() . " " . $author->getLastName() . "</h2>";
echo "<ol>";
foreach ($result->getWeblogs() as $weblog) {
    echo "<li>" . $weblog->getName() . "</li>";
}
echo "</ol>";
]]>
            </programlisting>
        </example>
        <para>
            Please read the <link linkend="zend.service.technorati.classes">Zend_Service_Technorati Classes</link>
            section for further details about response classes.
        </para>

    </sect2>

    <sect2 id="zend.service.technorati.handling-errors">
        <title>Handling Errors</title>
        <para>
            Each <code>Zend_Service_Technorati</code> query method throws a
            <code>Zend_Service_Technorati_Exception</code> exception on failure with a meaningful error message.
        </para>
        <para>
            There are several reasons that may cause a <code>Zend_Service_Technorati</code> query to fail.
            <code>Zend_Service_Technorati</code> validates all parameters for any query request. If a parameter is
            invalid or it contains an invalid value, a new <code>Zend_Service_Technorati_Exception</code> exception is
            thrown. Additionally, the Technorati API interface could be temporally unavailable, or it could return a
            response that is not well formed.
        </para>
        <para>
            You should always wrap a Technorati query with a <code>try</code>...<code>catch</code> block.
        </para>
        <example id="zend.service.technorati.handling-errors.example-1">
            <title>Handling a Query Exception</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
try {
    $resultSet = $technorati->search('PHP');
} catch(Zend_Service_Technorati_Exception $e) {
    echo "An error occurred: " $e->getMessage();
} ]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.service.technorati.checking-api-daily-usage">
        <title>Checking Your API Key Daily Usage</title>
        <para>
            From time to time you probably will want to check your API key daily usage. By default Technorati limits
            your API usage to 500 calls per day, and an exception is returned by <code>Zend_Service_Technorati</code>
            if you try to use it beyond this limit. You can get information about your API key usage using the
            <code>Zend_Service_Technorati::keyInfo()</code> method.
        </para>
        <para>
            <code>Zend_Service_Technorati::keyInfo()</code> returns a
            <code>Zend_Service_Technorati_KeyInfoResult</code> object. For full details please see the
            <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
        </para>
        <example id="zend.service.technorati.checking-api-daily-usage.example-1">
            <title>Getting API key daily usage information</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$key = $technorati->keyInfo();

echo "API Key: " . $key->getApiKey() . "<br />";
echo "Daily Usage: " . $key->getApiQueries() . "/" . $key->getMaxQueries() . "<br />";
]]>
            </programlisting>
        </example>
    </sect2>

    <sect2 id="zend.service.technorati.queries">
        <title>Available Technorati Queries</title>
        <para>
            <code>Zend_Service_Technorati</code> provides support for the following queries:
            <itemizedlist>
                <listitem><para><link linkend="zend.service.technorati.queries.cosmos"><code>Cosmos</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.queries.search"><code>Search</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.queries.tag"><code>Tag</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.queries.dailycounts"><code>DailyCounts</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.queries.toptags"><code>TopTags</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.queries.bloginfo"><code>BlogInfo</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.queries.blogposttags"><code>BlogPostTags</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.queries.getinfo"><code>GetInfo</code></link></para></listitem>
            </itemizedlist>
        </para>

        <sect3 id="zend.service.technorati.queries.cosmos">
            <title>Technorati Cosmos</title>
            <para>
                <ulink url="http://technorati.com/developers/api/cosmos.html">Cosmos</ulink> query lets you see what
                blogs are linking to a given URL. It returns a
                <link linkend="zend.service.technorati.classes.cosmosresultset"><code>Zend_Service_Technorati_CosmosResultSet</code></link>
                object. For full details please see <code>Zend_Service_Technorati::cosmos()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.cosmos.example-1">
                <title>Cosmos Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$resultSet = $technorati->cosmos('http://devzone.zend.com/');

echo "<p>Reading " . $resultSet->totalResults() .
     " of " . $resultSet->totalResultsAvailable() . " available results</p>";
echo "<ol>";
foreach ($resultSet as $result) {
    echo "<li>" . $result->getWeblog()->getName() . "</li>";
}
echo "</ol>";
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.search">
            <title>Technorati Search</title>
            <para>
                The <ulink url="http://technorati.com/developers/api/search.html">Search</ulink> query lets you see
                what blogs contain a given search string. It returns a
                <link linkend="zend.service.technorati.classes.searchresultset"><code>Zend_Service_Technorati_SearchResultSet</code></link>
                object. For full details please see <code>Zend_Service_Technorati::search()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.search.example-1">
                <title>Search Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$resultSet = $technorati->search('zend framework');

echo "<p>Reading " . $resultSet->totalResults() .
     " of " . $resultSet->totalResultsAvailable() . " available results</p>";
echo "<ol>";
foreach ($resultSet as $result) {
    echo "<li>" . $result->getWeblog()->getName() . "</li>";
}
echo "</ol>";
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.tag">
            <title>Technorati Tag</title>
            <para>
                The <ulink url="http://technorati.com/developers/api/tag.html">Tag</ulink> query lets you see what
                posts are associated with a given tag. It returns a
                <link linkend="zend.service.technorati.classes.tagresultset"><code>Zend_Service_Technorati_TagResultSet</code></link>
                object. For full details please see <code>Zend_Service_Technorati::tag()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.tag.example-1">
                <title>Tag Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$resultSet = $technorati->tag('php');

echo "<p>Reading " . $resultSet->totalResults() .
     " of " . $resultSet->totalResultsAvailable() . " available results</p>";
echo "<ol>";
foreach ($resultSet as $result) {
    echo "<li>" . $result->getWeblog()->getName() . "</li>";
}
echo "</ol>";
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.dailycounts">
            <title>Technorati DailyCounts</title>
            <para>
                The <ulink url="http://technorati.com/developers/api/dailycounts.html">DailyCounts</ulink> query
                provides daily counts of posts containing the queried keyword. It returns a
                <link linkend="zend.service.technorati.classes.dailycountsresultset"><code>Zend_Service_Technorati_DailyCountsResultSet</code></link>
                object. For full details please see <code>Zend_Service_Technorati::dailyCounts()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.dailycounts.example-1">
                <title>DailyCounts Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$resultSet = $technorati->dailyCounts('php');

foreach ($resultSet as $result) {
    echo "<li>" . $result->getDate() . "(" . $result->getCount() . ")</li>";
}
echo "</ol>";
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.toptags">
            <title>Technorati TopTags</title>
            <para>
                The <ulink url="http://technorati.com/developers/api/toptags.html">TopTags</ulink> query provides
                information on top tags indexed by Technorati. It returns a
                <link linkend="zend.service.technorati.classes.tagsresultset"><code>Zend_Service_Technorati_TagsResultSet</code></link>
                object. For full details please see <code>Zend_Service_Technorati::topTags()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.toptags.example-1">
                <title>TopTags Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$resultSet = $technorati->topTags();

echo "<p>Reading " . $resultSet->totalResults() .
     " of " . $resultSet->totalResultsAvailable() . " available results</p>";
echo "<ol>";
foreach ($resultSet as $result) {
    echo "<li>" . $result->getTag() . "</li>";
}
echo "</ol>";
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.bloginfo">
            <title>Technorati BlogInfo</title>
            <para>
                The <ulink url="http://technorati.com/developers/api/bloginfo.html">BlogInfo</ulink> query provides
                information on what blog, if any, is associated with a given URL. It returns a
                <link linkend="zend.service.technorati.classes.bloginforesult"><code>Zend_Service_Technorati_BlogInfoResult</code></link>
                object. For full details please see <code>Zend_Service_Technorati::blogInfo()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.bloginfo.example-1">
                <title>BlogInfo Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$result = $technorati->blogInfo('http://devzone.zend.com/');

echo '<h2><a href="' . (string) $result->getWeblog()->getUrl() . '">' .
     $result->getWeblog()->getName() . '</a></h2>';
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.blogposttags">
            <title>Technorati BlogPostTags</title>
            <para>
                The <ulink url="http://technorati.com/developers/api/blogposttags.html">BlogPostTags</ulink> query
                provides information on the top tags used by a specific blog. It returns a
                <link linkend="zend.service.technorati.classes.tagsresultset"><code>Zend_Service_Technorati_TagsResultSet</code></link>
                object. For full details please see <code>Zend_Service_Technorati::blogPostTags()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.blogposttags.example-1">
                <title>BlogPostTags Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$resultSet = $technorati->blogPostTags('http://devzone.zend.com/');

echo "<p>Reading " . $resultSet->totalResults() .
     " of " . $resultSet->totalResultsAvailable() . " available results</p>";
echo "<ol>";
foreach ($resultSet as $result) {
    echo "<li>" . $result->getTag() . "</li>";
}
echo "</ol>";
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.getinfo">
            <title>Technorati GetInfo</title>
            <para>
                The <ulink url="http://technorati.com/developers/api/getinfo.html">GetInfo</ulink> query tells you
                things that Technorati knows about a member. It returns a
                <link linkend="zend.service.technorati.classes.getinforesult"><code>Zend_Service_Technorati_GetInfoResult</code></link>
                object. For full details please see <code>Zend_Service_Technorati::getInfo()</code> in the
                <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
            <example id="zend.service.technorati.queries.getinfo.example-1">
                <title>GetInfo Query</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$result = $technorati->getInfo('weppos');

$author = $result->getAuthor();
echo "<h2>Blogs authored by " . $author->getFirstName() . " " . $author->getLastName() . "</h2>";
echo "<ol>";
foreach ($result->getWeblogs() as $weblog) {
    echo "<li>" . $weblog->getName() . "</li>";
}
echo "</ol>";
]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.queries.keyinfo">
            <title>Technorati KeyInfo</title>
            <para>
                The KeyInfo query provides information on daily usage of an API key. It returns a
               <link linkend="zend.service.technorati.classes.keyinforesult"><code>Zend_Service_Technorati_KeyInfoResult</code></link>
               object. For full details please see <code>Zend_Service_Technorati::keyInfo()</code> in the
               <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
            </para>
        </sect3>

    </sect2>

    <sect2 id="zend.service.technorati.classes">
        <title>Zend_Service_Technorati Classes</title>
        <para>
            The following classes are returned by the various Technorati queries. Each
            <code>Zend_Service_Technorati_*ResultSet</code> class holds a type-specific result set which can be easily
            iterated, with each result being contained in a type result object. All result set classes extend
            <code>Zend_Service_Technorati_ResultSet</code> class and implement the <code>SeekableIterator</code>
            interface, allowing for easy iteration and seeking to a specific result.
            <itemizedlist>
                <listitem><para><link linkend="zend.service.technorati.classes.resultset"><code>Zend_Service_Technorati_ResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.cosmosresultset"><code>Zend_Service_Technorati_CosmosResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.searchresultset"><code>Zend_Service_Technorati_SearchResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.tagresultset"><code>Zend_Service_Technorati_TagResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.dailycountsresultset"><code>Zend_Service_Technorati_DailyCountsResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.tagsresultset"><code>Zend_Service_Technorati_TagsResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.result"><code>Zend_Service_Technorati_Result</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.cosmosresult"><code>Zend_Service_Technorati_CosmosResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.searchresult"><code>Zend_Service_Technorati_SearchResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.tagresult"><code>Zend_Service_Technorati_TagResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.dailycountsresult"><code>Zend_Service_Technorati_DailyCountsResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.tagsresult"><code>Zend_Service_Technorati_TagsResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.getinforesult"><code>Zend_Service_Technorati_GetInfoResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.bloginforesult"><code>Zend_Service_Technorati_BlogInfoResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.technorati.classes.keyinforesult"><code>Zend_Service_Technorati_KeyInfoResult</code></link></para></listitem>
            </itemizedlist>
        </para>
        <note>
            <para>
                <code>Zend_Service_Technorati_GetInfoResult</code>, <code>Zend_Service_Technorati_BlogInfoResult</code>
                and <code>Zend_Service_Technorati_KeyInfoResult</code> represent exceptions to the above because they
                don't belong to a result set and they don't implement any interface. They represent a single response
                object and they act as a wrapper for additional <code>Zend_Service_Technorati</code> objects, such as
                <code>Zend_Service_Technorati_Author</code> and <code>Zend_Service_Technorati_Weblog</code>.
            </para>
        </note>
        <para>
            The <code>Zend_Service_Technorati</code> library includes additional convenient classes representing
            specific response objects. <code>Zend_Service_Technorati_Author</code> represents a single Technorati
            account, also known as a blog author or blogger. <code>Zend_Service_Technorati_Weblog</code> represents a
            single weblog object, along with all specific weblog properties such as feed URLs or blog name. For full
            details please see <code>Zend_Service_Technorati</code> in the
            <ulink url="http://framework.zend.com/apidoc/core/">API reference guide</ulink>.
        </para>

        <sect3 id="zend.service.technorati.classes.resultset">
            <title>Zend_Service_Technorati_ResultSet</title>
            <para>
                <code>Zend_Service_Technorati_ResultSet</code> is the most essential result set. The scope of this
                class is to be extended by a query-specific child result set class, and it should never be used to
                initialize a standalone object. Each of the specific result sets represents a collection of
                query-specific
                <link linkend="zend.service.technorati.classes.result"><code>Zend_Service_Technorati_Result</code></link>
                objects.
            </para>
            <para>
                <code>Zend_Service_Technorati_ResultSet</code> implements the PHP <code>SeekableIterator</code>
                interface, and you can iterate all result objects via the PHP <code>foreach</code> statement.
            </para>
            <example id="zend.service.technorati.classes.resultset.example-1">
                <title>Iterating result objects from a resultset collection</title>
                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Service/Technorati.php';

// run a simple query
$technorati = new Zend_Service_Technorati('VALID_API_KEY');
$resultSet = $technorati->search('php');

// $resultSet is now an instance of Zend_Service_Technorati_SearchResultSet
// it extends Zend_Service_Technorati_ResultSet
foreach ($resultSet as $result) {
    // do something with your
    // Zend_Service_Technorati_SearchResult object
} ]]>
                </programlisting>
            </example>
        </sect3>

        <sect3 id="zend.service.technorati.classes.cosmosresultset">
            <title>Zend_Service_Technorati_CosmosResultSet</title>
            <para>
                <code>Zend_Service_Technorati_CosmosResultSet</code> represents a Technorati Cosmos query result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_CosmosResultSet</code> extends
                    <link linkend="zend.service.technorati.classes.resultset">Zend_Service_Technorati_ResultSet</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.searchresultset">
            <title>Zend_Service_Technorati_SearchResultSet</title>
            <para>
                <code>Zend_Service_Technorati_SearchResultSet</code> represents a Technorati Search query result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_SearchResultSet</code> extends
                    <link linkend="zend.service.technorati.classes.resultset">Zend_Service_Technorati_ResultSet</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.tagresultset">
            <title>Zend_Service_Technorati_TagResultSet</title>
            <para>
                <code>Zend_Service_Technorati_TagResultSet</code> represents a Technorati Tag query result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_TagResultSet</code> extends
                    <link linkend="zend.service.technorati.classes.resultset">Zend_Service_Technorati_ResultSet</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.dailycountsresultset">
            <title>Zend_Service_Technorati_DailyCountsResultSet</title>
            <para>
                <code>Zend_Service_Technorati_DailyCountsResultSet</code> represents a Technorati DailyCounts query result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_DailyCountsResultSet</code> extends
                    <link linkend="zend.service.technorati.classes.resultset">Zend_Service_Technorati_ResultSet</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.tagsresultset">
            <title>Zend_Service_Technorati_TagsResultSet</title>
            <para>
                <code>Zend_Service_Technorati_TagsResultSet</code> represents a Technorati TopTags or BlogPostTags queries result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_TagsResultSet</code> extends
                    <link linkend="zend.service.technorati.classes.resultset">Zend_Service_Technorati_ResultSet</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.result">
            <title>Zend_Service_Technorati_Result</title>
            <para>
                <code>Zend_Service_Technorati_Result</code> is the most essential result object. The scope of this
                class is to be extended by a query specific child result class, and it should never be used to
                initialize a standalone object.
            </para>
        </sect3>

        <sect3 id="zend.service.technorati.classes.cosmosresult">
            <title>Zend_Service_Technorati_CosmosResult</title>
            <para>
                <code>Zend_Service_Technorati_CosmosResult</code> represents a single Technorati Cosmos query result
                object. It is never returned as a standalone object, but it always belongs to a valid
                <link linkend="zend.service.technorati.classes.cosmosresultset">Zend_Service_Technorati_CosmosResultSet</link>
                object.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_CosmosResult</code> extends
                    <link linkend="zend.service.technorati.classes.result">Zend_Service_Technorati_Result</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.searchresult">
            <title>Zend_Service_Technorati_SearchResult</title>
            <para>
                <code>Zend_Service_Technorati_SearchResult</code> represents a single Technorati Search query result
                object. It is never returned as a standalone object, but it always belongs to a valid
                <link linkend="zend.service.technorati.classes.searchresultset">Zend_Service_Technorati_SearchResultSet</link>
                object.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_SearchResult</code> extends
                    <link linkend="zend.service.technorati.classes.result">Zend_Service_Technorati_Result</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.tagresult">
            <title>Zend_Service_Technorati_TagResult</title>
            <para>
                <code>Zend_Service_Technorati_TagResult</code> represents a single Technorati Tag query result object.
                It is never returned as a standalone object, but it always belongs to a valid
                <link linkend="zend.service.technorati.classes.tagresultset">Zend_Service_Technorati_TagResultSet</link>
                object.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_TagResult</code> extends
                    <link linkend="zend.service.technorati.classes.result">Zend_Service_Technorati_Result</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.dailycountsresult">
            <title>Zend_Service_Technorati_DailyCountsResult</title>
            <para>
                <code>Zend_Service_Technorati_DailyCountsResult</code> represents a single Technorati DailyCounts query
                result object. It is never returned as a standalone object, but it always belongs to a valid
                <link linkend="zend.service.technorati.classes.dailycountsresultset">Zend_Service_Technorati_DailyCountsResultSet</link>
                object.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_DailyCountsResult</code> extends
                    <link linkend="zend.service.technorati.classes.result">Zend_Service_Technorati_Result</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.tagsresult">
            <title>Zend_Service_Technorati_TagsResult</title>
            <para>
                <code>Zend_Service_Technorati_TagsResult</code> represents a single Technorati TopTags or BlogPostTags
                query result object. It is never returned as a standalone object, but it always belongs to a valid
                <link linkend="zend.service.technorati.classes.tagsresultset">Zend_Service_Technorati_TagsResultSet </link>
                object.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Technorati_TagsResult</code> extends
                    <link linkend="zend.service.technorati.classes.result">Zend_Service_Technorati_Result</link>.
                </para>
            </note>
        </sect3>

        <sect3 id="zend.service.technorati.classes.getinforesult">
            <title>Zend_Service_Technorati_GetInfoResult</title>
            <para>
                <code>Zend_Service_Technorati_GetInfoResult</code> represents a single Technorati GetInfo query result
                object.
            </para>
        </sect3>

        <sect3 id="zend.service.technorati.classes.bloginforesult">
            <title>Zend_Service_Technorati_BlogInfoResult</title>
            <para>
                <code>Zend_Service_Technorati_BlogInfoResult</code> represents a single Technorati BlogInfo query
                result object.
            </para>
        </sect3>

        <sect3 id="zend.service.technorati.classes.keyinforesult">
            <title>Zend_Service_Technorati_KeyInfoResult</title>
            <para>
                <code>Zend_Service_Technorati_KeyInfoResult</code> represents a single Technorati KeyInfo query result
                object. It provides information about your
                <link linkend="zend.service.technorati.checking-api-daily-usage">Technorati API Key daily usage</link>.
            </para>
        </sect3>

    </sect2>

</sect1>
<sect1 id="zend.service.yahoo">
    <title>Zend_Service_Yahoo</title>
    <sect2 id="zend.service.yahoo.introduction">
        <title>Introduction</title>
        <para>
            <code>Zend_Service_Yahoo</code> is a simple API for using many of the Yahoo! REST APIs.
            <code>Zend_Service_Yahoo</code> allows you to search Yahoo! Web search, Yahoo! News, Yahoo! Local, Yahoo!
            Images. In order to use the Yahoo! REST API, you must have a Yahoo! Application ID. To obtain an Application ID, please complete and submit the
            <ulink url="http://developer.yahoo.com/wsregapp/">Application ID Request Form</ulink>.
        </para>
    </sect2>
    <sect2 id="zend.service.yahoo.websearch">
        <title>Searching the Web with Yahoo!</title>
        <para>
            <code>Zend_Service_Yahoo</code> enables you to search the Web with Yahoo! using the
            <code>webSearch()</code> method, which accepts a string query parameter and an optional second parameter
            as an array of search options. For full details and an option list, please visit the
            <ulink url="http://developer.yahoo.com/search/web/V1/webSearch.html">Yahoo! Web Search
            Documentation</ulink>. The <code>webSearch()</code> method returns a
            <code>Zend_Service_Yahoo_WebResultSet</code> object.
        </para>
        <example id="zend.service.yahoo.websearch.example-1">
            <title>Searching the Web with Yahoo!</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Yahoo.php';
$yahoo = new Zend_Service_Yahoo("YAHOO_APPLICATION_ID");
$results = $yahoo->webSearch('PHP');
foreach ($results as $result) {
    echo $result->Title .'<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.yahoo.imagesearch">
        <title>Finding Images with Yahoo!</title>
        <para>
            You can search for Images with Yahoo using <code>Zend_Service_Yahoo</code>'s <code>imageSearch()</code>
            method. This method accepts a string query parameter and an optional array of search options, as for the
            <link linkend="zend.service.yahoo.websearch"><code>webSearch()</code> method</link>. For full details
            and an option list, please visit the
            <ulink url="http://developer.yahoo.com/search/image/V1/imageSearch.html">Yahoo! Image Search
            Documentation</ulink>.
        </para>
        <example id="zend.service.yahoo.imagesearch.example-1">
            <title>Finding Images with Yahoo!</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Yahoo.php';
$yahoo = new Zend_Service_Yahoo("YAHOO_APPLICATION_ID");
$results = $yahoo->imageSearch('PHP');
foreach ($results as $result) {
    echo $result->Title .'<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.yahoo.videosearch">
        <title>Finding videos with Yahoo!</title>
        <para>
            You can search for videos with Yahoo using <code>Zend_Service_Yahoo</code>'s <code>videoSearch()</code>
            method. For full details and an option list, please visit the
            <ulink url="http://developer.yahoo.com/search/video/V1/videoSearch.html">Yahoo! Video Search
            Documentation</ulink>.
        </para>
        <example id="zend.service.yahoo.videosearch.example-1">
            <title>Finding videos with Yahoo!</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Yahoo.php';
$yahoo = new Zend_Service_Yahoo("YAHOO_APPLICATION_ID");
$results = $yahoo->videoSearch('PHP');
foreach ($results as $result) {
    echo $result->Title .'<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.yahoo.localsearch">
        <title>Finding Local Businesses and Services with Yahoo!</title>
        <para>
            You can search for local businesses and services with Yahoo! by using the <code>localSearch()</code> method.
            For full details, please see the
            <ulink url="http://developer.yahoo.com/search/local/V1/localSearch.html">Yahoo! Local Search
            Documentation</ulink>.
        </para>
        <example id="zend.service.yahoo.localsearch.example-1">
            <title>Finding Local Businesses and Services with Yahoo!</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Yahoo.php';
$yahoo = new Zend_Service_Yahoo("YAHOO_APPLICATION_ID");
$results = $yahoo->localSearch('Apple Computers', array('zip' => '95014'));
foreach ($results as $result) {
    echo $result->Title .'<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.yahoo.newssearch">
        <title>Searching Yahoo! News</title>
        <para>
            Searching Yahoo! News is simple; just use the <code>newsSearch()</code> method, as in the following
            example. For full details, please see the
            <ulink url="http://developer.yahoo.com/search/news/V1/newsSearch.html">Yahoo! News Search
            Documentation</ulink>.
        </para>
        <example id="zend.service.yahoo.newssearch.example-1">
            <title>Searching Yahoo! News</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Yahoo.php';
$yahoo = new Zend_Service_Yahoo("YAHOO_APPLICATION_ID");
$results = $yahoo->newsSearch('PHP');
foreach ($results as $result) {
    echo $result->Title .'<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.yahoo.inlinkdatasearch">
        <title>Searching Yahoo! Site Explorer Inbound Links</title>
        <para>
            Searching Yahoo! Site Explorer Inbound Links is simple; just use the <code>inlinkDataSearch()</code>
            method, as in the following example. For full details, please see the
            <ulink url="http://developer.yahoo.com/search/siteexplorer/V1/inlinkData.html">Yahoo!
            Site Explorer Inbound Links Documentation</ulink>.
        </para>
        <example id="zend.service.yahoo.inlinkdatasearch.example-1">
            <title>Searching Yahoo! Site Explorer Inbound Links</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Yahoo.php';
$yahoo = new Zend_Service_Yahoo("YAHOO_APPLICATION_ID");
$results = $yahoo->inlinkDataSearch('http://framework.zend.com/');
foreach ($results as $result) {
    echo $result->Title .'<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.yahoo.pagedatasearch">
        <title>Searching Yahoo! Site Explorer's PageData</title>
        <para>
            Searching Yahoo! Site Explorer's PageData is simple; just use the <code>pageDataSearch()</code>
            method, as in the following example. For full details, please see the
            <ulink url="http://developer.yahoo.com/search/siteexplorer/V1/pageData.html">Yahoo!
            Site Explorer PageData Documentation</ulink>.
        </para>
        <example id="zend.service.yahoo.pagedatasearch.example-1">
            <title>Searching Yahoo! Site Explorer's PageData</title>
            <programlisting><![CDATA[<?php
require_once 'Zend/Service/Yahoo.php';
$yahoo = new Zend_Service_Yahoo("YAHOO_APPLICATION_ID");
$results = $yahoo->pageDataSearch('http://framework.zend.com/');
foreach ($results as $result) {
    echo $result->Title .'<br />';
}]]>
            </programlisting>
        </example>
    </sect2>
    <sect2 id="zend.service.yahoo.classes">
        <title>Zend_Service_Yahoo Classes</title>
        <para>
            The following classes are all returned by the various Yahoo! searches. Each search type returns a
            type-specific result set which can be easily iterated, with each result being contained in a type result
            object. All result set classes implement the <code>SeekableIterator</code> interface, allowing for easy
            iteration and seeking to a specific result.
            <itemizedlist>
                <listitem><para><link linkend="zend.service.yahoo.classes.resultset"><code>Zend_Service_Yahoo_ResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.webresultset"><code>Zend_Service_Yahoo_WebResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.imageresultset"><code>Zend_Service_Yahoo_ImageResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.videoresultset"><code>Zend_Service_Yahoo_VideoResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.localresultset"><code>Zend_Service_Yahoo_LocalResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.newsresultset"><code>Zend_Service_Yahoo_NewsResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.inlinkdataresultset"><code>Zend_Service_Yahoo_InlinkDataResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.pagedataresultset"><code>Zend_Service_Yahoo_PageDataResultSet</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.result"><code>Zend_Service_Yahoo_Result</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.webresult"><code>Zend_Service_Yahoo_WebResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.imageresult"><code>Zend_Service_Yahoo_ImageResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.videoresult"><code>Zend_Service_Yahoo_VideoResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.localresult"><code>Zend_Service_Yahoo_LocalResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.newsresult"><code>Zend_Service_Yahoo_NewsResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.inlinkdataresult"><code>Zend_Service_Yahoo_InlinkDataResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.pagedataresult"><code>Zend_Service_Yahoo_PageDataResult</code></link></para></listitem>
                <listitem><para><link linkend="zend.service.yahoo.classes.image"><code>Zend_Service_Yahoo_Image</code></link></para></listitem>
            </itemizedlist>
        </para>
        <sect3 id="zend.service.yahoo.classes.resultset">
            <title>Zend_Service_Yahoo_ResultSet</title>
            <para>
                Each of the search specific result sets is extended from this base class.
            </para>
            <para>
                Each of the specific result sets returns a search specific
                <link linkend="zend.service.yahoo.classes.result">Zend_Service_Yahoo_Result</link> objects.
            </para>
            <sect4 id="zend.service.yahoo.classes.resultset.totalResults">
                <title>Zend_Service_Yahoo_ResultSet::totalResults()</title>
                <para>
                    <methodsynopsis>
                        <type>int</type>
                        <methodname>totalResults</methodname>
                        <void />
                    </methodsynopsis>
                </para>
                <para>
                    Returns the number of results returned for the search.
                </para>
            </sect4>
            <sect4 id="zend.service.yahoo.classes.resultset.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.resultset.properties.table-1">
                    <title>Zend_Service_Yahoo_ResultSet</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>totalResultsAvailable</entry>
                                <entry>int</entry>
                                <entry>
                                    Total number of results found.
                                </entry>
                            </row>
                            <row>
                                <entry>totalResultsReturned</entry>
                                <entry>int</entry>
                                <entry>Number of results in the current result set</entry>
                            </row>
                            <row>
                                <entry>firstResultPosition</entry>
                                <entry>int</entry>
                                <entry>Position of the first result in this set relative to the total number of results.</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.webresultset">
            <title>Zend_Service_Yahoo_WebResultSet</title>
            <para>
                <code>Zend_Service_Yahoo_WebResultSet</code> represents a Yahoo! Web Search result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Yahoo_WebResultSet</code> extends <link linkend="zend.service.yahoo.classes.resultset">Zend_Service_Yahoo_ResultSet</link>
                </para>
            </note>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.imageresultset">
            <title>Zend_Service_Yahoo_ImageResultSet</title>
            <para>
                <code>Zend_Service_Yahoo_ImageResultSet</code> represents a Yahoo! Image Search result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Yahoo_ImageResultSet</code> extends <link linkend="zend.service.yahoo.classes.resultset">Zend_Service_Yahoo_ResultSet</link>
                </para>
            </note>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.videoresultset">
            <title>Zend_Service_Yahoo_VideoResultSet</title>
            <para>
                <code>Zend_Service_Yahoo_VideoResultSet</code> represents a Yahoo! Video Search result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Yahoo_VideoResultSet</code> extends <link linkend="zend.service.yahoo.classes.resultset">Zend_Service_Yahoo_ResultSet</link>
                </para>
            </note>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.localresultset">
            <title>Zend_Service_Yahoo_LocalResultSet</title>
            <para>
                <code>Zend_Service_Yahoo_LocalResultSet</code> represents a Yahoo! Local Search result set.
            </para>
            <table id="zend.service.yahoo.classes.localresultset.table-1">
                <title>Zend_Service_Yahoo_LocalResultSet Properties</title>
                <tgroup cols="3">
                    <thead>
                        <row>
                            <entry>Name</entry>
                            <entry>Type</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>resultSetMapURL</entry>
                            <entry>string</entry>
                            <entry>The URL of a webpage containing a map graphic with all returned results plotted on it.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <note>
                <para>
                    <code>Zend_Service_Yahoo_LocalResultSet</code> extends <link linkend="zend.service.yahoo.classes.resultset">Zend_Service_Yahoo_ResultSet</link>
                </para>
            </note>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.newsresultset">
            <title>Zend_Service_Yahoo_NewsResultSet</title>
            <para>
                <code>Zend_Service_Yahoo_NewsResultSet</code> represents a Yahoo! News Search result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Yahoo_NewsResultSet</code> extends <link linkend="zend.service.yahoo.classes.resultset">Zend_Service_Yahoo_ResultSet</link>
                </para>
            </note>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.inlinkdataresultset">
            <title>Zend_Service_Yahoo_InlinkDataResultSet</title>
            <para>
                <code>Zend_Service_Yahoo_InlinkDataResultSet</code> represents a Yahoo! Inbound Link Search result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Yahoo_InlinkDataResultSet</code> extends <link linkend="zend.service.yahoo.classes.resultset">Zend_Service_Yahoo_ResultSet</link>
                </para>
            </note>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.pagedataresultset">
            <title>Zend_Service_Yahoo_PageDataResultSet</title>
            <para>
                <code>Zend_Service_Yahoo_PageDataResultSet</code> represents a Yahoo! PageData Search result set.
            </para>
            <note>
                <para>
                    <code>Zend_Service_Yahoo_PageDataResultSet</code> extends <link linkend="zend.service.yahoo.classes.resultset">Zend_Service_Yahoo_ResultSet</link>
                </para>
            </note>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
        </sect3>
        <sect3 id="zend.service.yahoo.classes.result">
            <title>Zend_Service_Yahoo_Result</title>
            <para>
                Each of the search specific results is extended from this base class.
            </para>
            <sect4 id="zend.service.yahoo.classes.result.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.result.properties.table-1">
                    <title>Zend_Service_Yahoo_Result Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Title</entry>
                                <entry>string</entry>
                                <entry>Title of the Result item</entry>
                            </row>
                            <row>
                                <entry>Url</entry>
                                <entry>string</entry>
                                <entry>The URL of the result item</entry>
                            </row>
                            <row>
                                <entry>ClickUrl</entry>
                                <entry>string</entry>
                                <entry>The URL for linking to the result item</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.webresult">
            <title>Zend_Service_Yahoo_WebResult</title>
            <para>
                Each Web Search result is returned as a <code>Zend_Service_Yahoo_WebResult</code> object.
            </para>
            <sect4 id="zend.service.yahoo.classes.webresult.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.webresult.properties.table-1">
                    <title>Zend_Service_Yahoo_WebResult Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Summary</entry>
                                <entry>string</entry>
                                <entry>Result summary</entry>
                            </row>
                            <row>
                                <entry>MimeType</entry>
                                <entry>string</entry>
                                <entry>Result mimetype</entry>
                            </row>
                            <row>
                                <entry>ModificationDate</entry>
                                <entry>string</entry>
                                <entry>The last modification date of the result as a UNIX timestamp.</entry>
                            </row>
                            <row>
                                <entry>CacheUrl</entry>
                                <entry>string</entry>
                                <entry>Yahoo! web cache URL for the result, if it exists.</entry>
                            </row>
                            <row>
                                <entry>CacheSize</entry>
                                <entry>int</entry>
                                <entry>The size of the Cache entry</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.imageresult">
            <title>Zend_Service_Yahoo_ImageResult</title>
            <para>
                Each Image Search result is returned as a <code>Zend_Service_Yahoo_ImageResult</code> object.
            </para>
            <sect4 id="zend.service.yahoo.classes.imageresult.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.imageresult.properties.table-1">
                    <title>Zend_Service_Yahoo_ImageResult Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Summary</entry>
                                <entry>string</entry>
                                <entry>Result summary</entry>
                            </row>
                            <row>
                                <entry>RefererUrl</entry>
                                <entry>string</entry>
                                <entry>The URL of the page which contains the image</entry>
                            </row>
                            <row>
                                <entry>FileSize</entry>
                                <entry>int</entry>
                                <entry>The size of the image file in bytes</entry>
                            </row>
                            <row>
                                <entry>FileFormat</entry>
                                <entry>string</entry>
                                <entry>The format of the image (bmp, gif, jpeg, png, etc.)</entry>
                            </row>
                            <row>
                                <entry>Height</entry>
                                <entry>int</entry>
                                <entry>The height of the image</entry>
                            </row>
                            <row>
                                <entry>Width</entry>
                                <entry>int</entry>
                                <entry>The width of the image</entry>
                            </row>
                            <row>
                                <entry>Thumbnail</entry>
                                <entry><link linkend="zend.service.yahoo.classes.image">Zend_Service_Yahoo_Image</link></entry>
                                <entry>Image thumbnail</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.videoresult">
            <title>Zend_Service_Yahoo_VideoResult</title>
            <para>
                Each Video Search result is returned as a <code>Zend_Service_Yahoo_VideoResult</code> object.
            </para>
            <sect4 id="zend.service.yahoo.classes.videoresult.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.videoresult.properties.table-1">
                    <title>Zend_Service_Yahoo_VideoResult Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Summary</entry>
                                <entry>string</entry>
                                <entry>Result summary</entry>
                            </row>
                            <row>
                                <entry>RefererUrl</entry>
                                <entry>string</entry>
                                <entry>The URL of the page which contains the video</entry>
                            </row>
                            <row>
                                <entry>FileSize</entry>
                                <entry>int</entry>
                                <entry>The size of the video file in bytes</entry>
                            </row>
                            <row>
                                <entry>FileFormat</entry>
                                <entry>string</entry>
                                <entry>The format of the video (avi, flash, mpeg, msmedia, quicktime, realmedia, etc.)</entry>
                            </row>
                            <row>
                                <entry>Height</entry>
                                <entry>int</entry>
                                <entry>The height of the video in pixels</entry>
                            </row>
                            <row>
                                <entry>Width</entry>
                                <entry>int</entry>
                                <entry>The width of the video in pixels</entry>
                            </row>
                            <row>
                                <entry>Duration</entry>
                                <entry>int</entry>
                                <entry>The length of the video in seconds</entry>
                            </row>
                            <row>
                                <entry>Channels</entry>
                                <entry>int</entry>
                                <entry>Number of audio channels in the video</entry>
                            </row>
                            <row>
                                <entry>Streaming</entry>
                                <entry>boolean</entry>
                                <entry>Whether the video is streaming or not</entry>
                            </row>
                            <row>
                                <entry>Thumbnail</entry>
                                <entry><link linkend="zend.service.yahoo.classes.image">Zend_Service_Yahoo_Image</link></entry>
                                <entry>Image thumbnail</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.localresult">
            <title>Zend_Service_Yahoo_LocalResult</title>
            <para>
                Each Local Search result is returned as a <code>Zend_Service_Yahoo_LocalResult</code> object.
            </para>
            <sect4 id="zend.service.yahoo.classes.localresult.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.localresult.properties.table-1">
                    <title>Zend_Service_Yahoo_LocalResult Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Address</entry>
                                <entry>string</entry>
                                <entry>Street Address of the result</entry>
                            </row>
                            <row>
                                <entry>City</entry>
                                <entry>string</entry>
                                <entry>City in which the result resides in</entry>
                            </row>
                            <row>
                                <entry>State</entry>
                                <entry>string</entry>
                                <entry>State in which the result resides in</entry>
                            </row>
                            <row>
                                <entry>Phone</entry>
                                <entry>string</entry>
                                <entry>Phone number for the result</entry>
                            </row>
                            <row>
                                <entry>Rating</entry>
                                <entry>int</entry>
                                <entry>User submitted rating for the result</entry>
                            </row>
                            <row>
                                <entry>Distance</entry>
                                <entry>float</entry>
                                <entry>The distance to the result from your specified location</entry>
                            </row>
                            <row>
                                <entry>MapUrl</entry>
                                <entry>string</entry>
                                <entry>A URL of a map for the result</entry>
                            </row>
                            <row>
                                <entry>BusinessUrl</entry>
                                <entry>string</entry>
                                <entry>The URL for the business website, if known</entry>
                            </row>
                            <row>
                                <entry>BusinessClickUrl</entry>
                                <entry>string</entry>
                                <entry>The URL for linking to the business website, if known</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.newsresult">
            <title>Zend_Service_Yahoo_NewsResult</title>
            <para>
                Each News Search result is returned as a <code>Zend_Service_Yahoo_NewsResult</code> object.
            </para>
            <sect4 id="zend.service.yahoo.classes.newsresult.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.newsresult.properties.table-1">
                    <title>Zend_Service_Yahoo_NewsResult Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Summary</entry>
                                <entry>string</entry>
                                <entry>Result summary</entry>
                            </row>
                            <row>
                                <entry>NewsSource</entry>
                                <entry>string</entry>
                                <entry>The company who distributed the article</entry>
                            </row>
                            <row>
                                <entry>NewsSourceUrl</entry>
                                <entry>string</entry>
                                <entry>The URL for the company who distributed the article</entry>
                            </row>
                            <row>
                                <entry>Language</entry>
                                <entry>string</entry>
                                <entry>The language the article is in</entry>
                            </row>
                            <row>
                                <entry>PublishDate</entry>
                                <entry>string</entry>
                                <entry>The date the article was published as a UNIX timestamp</entry>
                            </row>
                            <row>
                                <entry>ModificationDate</entry>
                                <entry>string</entry>
                                <entry>The date the article was last modified as a UNIX timestamp</entry>
                            </row>
                            <row>
                                <entry>Thumbnail</entry>
                                <entry><link linkend="zend.service.yahoo.classes.image">Zend_Service_Yahoo_Image</link></entry>
                                <entry>Image Thumbnail for the article, if it exists</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.inlinkdataresult">
            <title>Zend_Service_Yahoo_InlinkDataResult</title>
            <para>
                Each Inbound Link Search result is returned as a
                <code>Zend_Service_Yahoo_InlinkDatabResult</code> object.
            </para>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.pagedataresult">
            <title>Zend_Service_Yahoo_PageDataResult</title>
            <para>
                Each Page Data Search result is returned as a
                <code>Zend_Service_Yahoo_PageDatabResult</code> object.
            </para>
            <para>
                <link linkend="zend.service.yahoo.classes">Back to Class List</link>
            </para>
         </sect3>
         <sect3 id="zend.service.yahoo.classes.image">
            <title>Zend_Service_Yahoo_Image</title>
            <para>
                All images returned either by the Yahoo! Image Search or the Yahoo! News Search
                are represented by <code>Zend_Service_Yahoo_Image</code> objects
            </para>
            <sect4 id="zend.service.yahoo.classes.image.properties">
                <title>Properties</title>
                <table id="zend.service.yahoo.classes.image.properties.table-1">
                    <title>Zend_Service_Yahoo_Image Properties</title>
                    <tgroup cols="3">
                        <thead>
                            <row>
                                <entry>Name</entry>
                                <entry>Type</entry>
                                <entry>Description</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>Url</entry>
                                <entry>string</entry>
                                <entry>Image URL</entry>
                            </row>
                            <row>
                                <entry>Width</entry>
                                <entry>int</entry>
                                <entry>Image Width</entry>
                            </row>
                            <row>
                                <entry>Height</entry>
                                <entry>int</entry>
                                <entry>Image Height</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para>
                    <link linkend="zend.service.yahoo.classes">Back to Class List</link>
                </para>
            </sect4>
        </sect3>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.session.advanced_usage">

    <title>Advanced Usage</title>

    <para>
        While the basic usage examples are a perfectly acceptable way to utilize Zend Framework sessions, there are some
        best practices to consider. This section discusses the finer details of session handling and illustrates more
        advanced usage of the Zend_Session component.
    </para>

    <sect2 id="zend.session.advanced_usage.starting_a_session">

        <title>Starting a Session</title>

        <para>
            If you want all requests to have a session facilitated by Zend_Session, then start the session in the
            bootstrap file:
        </para>

        <example id="zend.session.advanced_usage.starting_a_session.example">

            <title>Starting the Global Session</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session.php';

Zend_Session::start();]]>
            </programlisting>

        </example>

        <para>
            By starting the session in the bootstrap file, you avoid the possibility that your session might be started
            after headers have been sent to the browser, which results in an exception, and possibly a broken page for
            website viewers. Various advanced features require <code>Zend_Session::start()</code> first. (More on
            advanced features later.)
        </para>

        <para>
            There are four ways to start a session, when using Zend_Session. Two are wrong.
        </para>

        <orderedlist>
            <listitem>
                <para>
                    Wrong: Do not enable PHP's
                    <ulink url="http://www.php.net/manual/en/ref.session.php#ini.session.auto-start"><code>                    session.auto_start</code>
                    setting</ulink>. If you do not have the ability to disable this setting in
                    php.ini, you are using mod_php (or equivalent), and the setting is already enabled in
                    <code>php.ini</code>, then add the following to your <code>.htaccess</code> file (usually in your
                    HTML document root directory):
                    <programlisting role="httpd.conf"><![CDATA[php_value session.auto_start 0]]>
                    </programlisting>
                </para>
            </listitem>
            <listitem>
                <para>
                    Wrong: Do not use PHP's
                    <ulink url="http://www.php.net/session_start"><code>session_start()</code></ulink> function
                    directly. If you use <code>session_start()</code> directly, and then start using
                    <code>Zend_Session_Namespace</code>, an exception will be thrown by
                    <code>Zend_Session::start()</code> ("session has already been started"). If you call
                    <code>session_start()</code> after using <code>Zend_Session_Namespace</code> or calling
                    <code>Zend_Session::start()</code>, an error of level <code>E_NOTICE</code> will be generated, and
                    the call will be ignored.
                </para>
            </listitem>
            <listitem>
                <para>
                    Correct: Use <code>Zend_Session::start()</code>. If you want all requests to have and use
                    sessions, then place this function call early and unconditionally in your bootstrap code.
                    Sessions have some overhead. If some requests need sessions, but other requests will not need to use
                    sessions, then:
                </para>
                <itemizedlist mark="opencircle">
                    <listitem>
                        <para>
                            Unconditionally set the <code>strict</code> option to <code>true</code> using
                            <code>Zend_Session::setOptions()</code> in your bootstrap.
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            Call <code>Zend_Session::start()</code> only for requests that need to use sessions and
                            before any <code>Zend_Session_Namespace</code> objects are instantiated.
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            Use "<code>new Zend_Session_Namespace()</code>" normally, where needed, but make sure
                            <code>Zend_Session::start()</code> has been called previously.
                        </para>
                    </listitem>
                </itemizedlist>
                <para>
                    The <code>strict</code> option prevents <code>new Zend_Session_Namespace()</code> from automatically
                    starting the session using <code>Zend_Session::start()</code>. Thus, this option helps application
                    developers enforce a design decision to avoid using sessions for certain requests, since it causes
                    an exception to be thrown when <code>Zend_Session_Namespace</code> is instantiated before
                    <code>Zend_Session::start()</code> is called. Developers should carefully consider the impact of
                    using <code>Zend_Session::setOptions()</code>, since these options have global effect, owing to
                    their correspondence to the underlying options for ext/session.
                </para>
            </listitem>
            <listitem>
                <para>
                    Correct: Just instantiate <code>Zend_Session_Namespace</code> whenever needed, and the underlying
                    PHP session will be automatically started. This offers extremely simple usage that works well in
                    most situations. However, you then become responsible for ensuring that the first
                    <code>new Zend_Session_Namespace()</code> happens <emphasis role="strong">before</emphasis> any
                    output (e.g., <ulink url="http://www.php.net/headers_sent">HTTP headers</ulink>) has been sent by
                    PHP to the client, if you are using the default, cookie-based sessions (strongly recommended). See
                    <xref linkend="zend.session.global_session_management.headers_sent" /> for more information.
                </para>
            </listitem>
        </orderedlist>

    </sect2>

    <sect2 id="zend.session.advanced_usage.locking">

        <title>Locking Session Namespaces</title>

        <para>
            Session namespaces can be locked, to prevent further alterations to the data in that namespace. Use
            <code>lock()</code> to make a specific namespace read-only, <code>unLock()</code> to make a read-only
            namespace read-write, and <code>isLocked()</code> to test if a namespace has been previously locked. Locks
            are transient and do not persist from one request to the next. Locking the namespace has no effect on setter
            methods of objects stored in the namespace, but does prevent the use of the namespace's setter method to
            remove or replace objects stored directly in the namespace. Similarly, locking
            <code>Zend_Session_Namespace</code> instances does not prevent the use of symbol table aliases to the same
            data (see <ulink url="http://www.php.net/references">PHP references</ulink>).
        </para>

        <example id="zend.session.advanced_usage.locking.example.basic">

            <title>Locking Session Namespaces</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

$userProfileNamespace = new Zend_Session_Namespace('userProfileNamespace');

// marking session as read only locked
$userProfileNamespace->lock();

// unlocking read-only lock
if ($userProfileNamespace->isLocked()) {
    $userProfileNamespace->unLock();
}]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.session.advanced_usage.expiration">

        <title>Namespace Expiration</title>

        <para>
            Limits can be placed on the longevity of both namespaces and individual keys in namespaces. Common use cases
            include passing temporary information between requests, and reducing exposure to certain security risks by
            removing access to potentially sensitive information some time after authentication occurred. Expiration can
            be based on either elapsed seconds or the number of "hops", where a hop occurs for each successive request
            that instantiates the namespace at least once.
        </para>

        <example id="zend.session.advanced_usage.expiration.example">

            <title>Expiration Examples</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

$s = new Zend_Session_Namespace('expireAll');
$s->a = 'apple';
$s->p = 'pear';
$s->o = 'orange';

$s->setExpirationSeconds(5, 'a'); // expire only the key "a" in 5 seconds

// expire entire namespace in 5 "hops"
$s->setExpirationHops(5);

$s->setExpirationSeconds(60);
// The "expireAll" namespace will be marked "expired" on
// the first request received after 60 seconds have elapsed,
// or in 5 hops, whichever happens first.]]>
            </programlisting>

        </example>

        <para>
            When working with data expiring from the session in the current request, care should be used when retrieving
            them. Although the data are returned by reference, modifying the data will not make expiring data persist
            past the current request. In order to "reset" the expiration time, fetch the data into temporary variables,
            use the namespace to unset them, and then set the appropriate keys again.
        </para>

    </sect2>

    <sect2 id="zend.session.advanced_usage.controllers">

        <title>Session Encapsulation and Controllers</title>

        <para>
            Namespaces can also be used to separate session access by controllers to protect variables from
            contamination. For example, an authentication controller might keep its session state data separate from all
            other controllers for meeting security requirements.
        </para>

        <example id="zend.session.advanced_usage.controllers.example">

            <title>Namespaced Sessions for Controllers with Automatic Expiration</title>

            <para>
                The following code, as part of a controller that displays a test question, initiates a boolean variable
                to represent whether or not a submitted answer to the test question should be accepted. In this case,
                the application user is given 300 seconds to answer the displayed question.
            </para>

            <programlisting role="php"><![CDATA[<?php
// ...
// in the question view controller
require_once 'Zend/Session/Namespace.php';
$testSpace = new Zend_Session_Namespace('testSpace');
$testSpace->setExpirationSeconds(300, 'accept_answer'); // expire only this variable
$testSpace->accept_answer = true;
//...]]>
            </programlisting>

            <para>
                Below, the controller that processes the answers to test questions determines whether or not to accept
                an answer based on whether the user submitted the answer within the allotted time:
            </para>

            <programlisting role="php"><![CDATA[<?php
// ...
// in the answer processing controller
require_once 'Zend/Session/Namespace.php';
$testSpace = new Zend_Session_Namespace('testSpace');
if ($testSpace->accept_answer === true) {
    // within time
}
else {
    // not within time
}
// ...]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.session.advanced_usage.single_instance">

        <title>Preventing Multiple Instances per Namespace</title>

        <para>
            Although <link linkend="zend.session.advanced_usage.locking">session locking</link> provides a good degree
            of protection against unintended use of namespaced session data, <code>Zend_Session_Namespace</code> also
            features the ability to prevent the creation of multiple instances corresponding to a single namespace.
        </para>

        <para>
            To enable this behavior, pass <code>true</code> to the second constructor argument when creating the last
            allowed instance of <code>Zend_Session_Namespace</code>. Any subsequent attempt to instantiate the same
            namespace would result in a thrown exception.
        </para>

        <example id="zend.session.advanced_usage.single_instance.example">

            <title>Limiting Session Namespace Access to a Single Instance</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

// create an instance of a namespace
$authSpaceAccessor1 = new Zend_Session_Namespace('Zend_Auth');

// create another instance of the same namespace, but disallow any new instances
$authSpaceAccessor2 = new Zend_Session_Namespace('Zend_Auth', true);

// making a reference is still possible
$authSpaceAccessor3 = $authSpaceAccessor2;

$authSpaceAccessor1->foo = 'bar';

assert($authSpaceAccessor2->foo, 'bar');

try {
    $aNamespaceObject = new Zend_Session_Namespace('Zend_Auth');
} catch (Zend_Session_Exception $e) {
    echo "Cannot instantiate this namespace since \$authSpaceAccessor2 was created\n";
}]]>
            </programlisting>

        </example>

        <para>
            The second parameter in the constructor above tells <code>Zend_Session_Namespace</code> that any future
            instances with the "<code>Zend_Auth</code>" namespace are not allowed. Attempting to create such an instance
            causes an exception to be thrown by the constructor. The developer therefore becomes responsible for storing
            a reference to an instance object (<code>$authSpaceAccessor1</code>, <code>$authSpaceAccessor2</code>, or
            <code>$authSpaceAccessor3</code> in the example above) somewhere, if access to the session namespace is
            needed at a later time during the same request. For example, a developer may store the reference in a static
            variable, add the reference to a
            <ulink url="http://www.martinfowler.com/eaaCatalog/registry.html">registry</ulink> (see
            <xref linkend="zend.registry" />), or otherwise make it available to other methods that may need access to
            the session namespace.
        </para>

    </sect2>

    <sect2 id="zend.session.advanced_usage.arrays">

        <title>Working with Arrays</title>

        <para>
            Due to the implementation history of PHP magic methods, modifying an array inside a namespace may not work
            under PHP versions before 5.2.1. If you will only be working with PHP 5.2.1 or later, then you may <link
            linkend="zend.session.advanced_usage.objects">skip to the next section</link>.
        </para>

        <example id="zend.session.advanced_usage.arrays.example.modifying">

            <title>Modifying Array Data with a Session Namespace</title>

            <para>
                The following illustrates how the problem may be reproduced:
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';
$sessionNamespace = new Zend_Session_Namespace();
$sessionNamespace->array = array();
$sessionNamespace->array['testKey'] = 1; // may not work as expected before PHP 5.2.1
echo $sessionNamespace->array['testKey'];]]>
            </programlisting>

        </example>

        <example id="zend.session.advanced_usage.arrays.example.building_prior">

            <title>Building Arrays Prior to Session Storage</title>

            <para>
                If possible, avoid the problem altogether by storing arrays into a session namespace only after all
                desired array values have been set.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';
$sessionNamespace = new Zend_Session_Namespace('Foo');
$sessionNamespace->array = array('a', 'b', 'c');]]>
            </programlisting>

        </example>

        <para>
            If you are using an affected version of PHP and need to modify the array after assigning it to a session
            namespace key, you may use either or both of the following workarounds.
        </para>

        <example id="zend.session.advanced_usage.arrays.example.workaround.reassign">

            <title>Workaround: Reassign a Modified Array</title>

            <para>
                In the code that follows, a copy of the stored array is created, modified, and reassigned to the
                location from which the copy was created, overwriting the original array.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';
$sessionNamespace = new Zend_Session_Namespace();

// assign the initial array
$sessionNamespace->array = array('tree' => 'apple');

// make a copy of the array
$tmp = $sessionNamespace->array;

// modfiy the array copy
$tmp['fruit'] = 'peach';

// assign a copy of the array back to the session namespace
$sessionNamespace->array = $tmp;

echo $sessionNamespace->array['fruit']; // prints "peach"]]>
            </programlisting>

        </example>

        <example id="zend.session.advanced_usage.arrays.example.workaround.reference">

            <title>Workaround: store array containing reference</title>

            <para>
                Alternatively, store an array containing a reference to the desired array, and then access it
                indirectly.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';
$myNamespace = new Zend_Session_Namespace('myNamespace');
$a = array(1, 2, 3);
$myNamespace->someArray = array( &$a );
$a['foo'] = 'bar';
echo $myNamespace->someArray['foo']; // prints "bar"]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.session.advanced_usage.objects">

        <title>Using Sessions with Objects</title>

        <para>
            If you plan to persist objects in the PHP session, know that they will be
            <ulink url="http://www.php.net/manual/en/language.oop.serialization.php">serialized</ulink> for storage.
            Thus, any object persisted with the PHP session must be unserialized upon retrieval from storage. The
            implication is that the developer must ensure that the classes for the persisted objects must have been
            defined before the object is unserialized from session storage. If an unserialized object's class is not
            defined, then it becomes an instance of <code>stdClass</code>.
        </para>

    </sect2>

    <sect2 id="zend.session.advanced_usage.testing">

        <title>Using Sessions with Unit Tests</title>

        <para>
            The Zend Framework relies on PHPUnit to facilitate testing of itself. Many developers extend the existing
            suite of unit tests to cover the code in their applications. The exception
            "<emphasis role="strong">Zend_Session is currently marked as read-only</emphasis>" is thrown while
            performing unit tests, if any write-related methods are used after ending the session. However, unit tests
            using Zend_Session require extra attention, because closing (<code>Zend_Session::writeClose()</code>), or
            destroying a session (<code>Zend_Session::destroy()</code>) prevents any further setting or unsetting of
            keys in any instance of <code>Zend_Session_Namespace</code>. This behavior is a direct result of the
            underlying ext/session mechanism and PHP's <code>session_destroy()</code> and
            <code>session_write_close()</code>, which have no "undo" mechanism to facilitate setup/teardown with unit
            tests.
        </para>

        <para>
            To work around this, see the unit test <code>testSetExpirationSeconds()</code> in
            <code>SessionTest.php</code> and <code>SessionTestHelper.php</code>, both located in
            <code>tests/Zend/Session</code>, which make use of PHP's <code>exec()</code> to launch a separate process.
            The new process more accurately simulates a second, successive request from a browser. The separate process
            begins with a "clean" session, just like any PHP script execution for a web request. Also, any changes to
            <code>$_SESSION</code> made in the calling process become available to the child process, provided the
            parent closed the session before using <code>exec()</code>.
        </para>

        <example id="zend.session.advanced_usage.testing.example">

            <title>PHPUnit Testing Code Dependent on Zend_Session</title>

            <programlisting role="php"><![CDATA[<?php
// testing setExpirationSeconds()
require_once 'tests/Zend/Session/SessionTestHelper.php'; // also see SessionTest.php
$script = 'SessionTestHelper.php';
$s = new Zend_Session_Namespace('space');
$s->a = 'apple';
$s->o = 'orange';
$s->setExpirationSeconds(5);

Zend_Session::regenerateId();
$id = Zend_Session::getId();
session_write_close(); // release session so process below can use it
sleep(4); // not long enough for things to expire
exec($script . "expireAll $id expireAll", $result);
$result = $this->sortResult($result);
$expect = ';a === apple;o === orange;p === pear';
$this->assertTrue($result === $expect,
    "iteration over default Zend_Session namespace failed; expecting result === '$expect', but got '$result'");

sleep(2); // long enough for things to expire (total of 6 seconds waiting, but expires in 5)
exec($script . "expireAll $id expireAll", $result);
$result = array_pop($result);
$this->assertTrue($result === '',
    "iteration over default Zend_Session namespace failed; expecting result === '', but got '$result')");
session_start(); // resume artificially suspended session

// We could split this into a separate test, but actually, if anything leftover from above
// contaminates the tests below, that is also a bug that we want to know about.
$s = new Zend_Session_Namespace('expireGuava');
$s->setExpirationSeconds(5, 'g'); // now try to expire only 1 of the keys in the namespace
$s->g = 'guava';
$s->p = 'peach';
$s->p = 'plum';

session_write_close(); // release session so process below can use it
sleep(6); // not long enough for things to expire
exec($script . "expireAll $id expireGuava", $result);
$result = $this->sortResult($result);
session_start(); // resume artificially suspended session
$this->assertTrue($result === ';p === plum',
    "iteration over named Zend_Session namespace failed (result=$result)");]]>
            </programlisting>

        </example>

    </sect2>

</sect1>
<sect1 id="zend.session.basic_usage">

    <title>Basic Usage</title>

    <para>
        <code>Zend_Session_Namespace</code> instances provide the primary API for manipulating session data in the Zend
        Framework. Namespaces are used to segregate all session data, although a default namespace exists for those who
        only want one namespace for all their session data. <code>Zend_Session</code> utilizes ext/session and its
        special <code>$_SESSION</code> superglobal as the storage mechanism for session state data. While
        <code>$_SESSION</code> is still available in PHP's global namespace, developers should refrain from directly
        accessing it, so that <code>Zend_Session</code> and <code>Zend_Session_Namespace</code> can most effectively and
        securely provide its suite of session related functionality.
    </para>

    <para>
        Each instance of <code>Zend_Session_Namespace</code> corresponds to an entry of the <code>$_SESSION</code>
        superglobal array, where the namespace is used as the key.

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

$myNamespace = new Zend_Session_Namespace('myNamespace');

// $myNamespace corresponds to $_SESSION['myNamespace']]]>
        </programlisting>

        It is possible to use Zend_Session in conjunction with other code that uses <code>$_SESSION</code> directly. To
        avoid problems, however, it is highly recommended that such code only uses parts of <code>$_SESSION</code> that
        do not correspond to instances of <code>Zend_Session_Namespace</code>.
    </para>

    <sect2 id="zend.session.basic_usage.basic_examples">

        <title>Tutorial Examples</title>

        <para>
            If no namespace is specified when instantiating <code>Zend_Session_Namespace</code>, all data will be
            transparently stored in a namespace called "<code>Default</code>". <code>Zend_Session</code> is not intended
            to work directly on the contents of session namespace containers. Instead, we use
            <code>Zend_Session_Namespace</code>. The example below demonstrates use of this default namespace, showing
            how to count the number of client requests during a session:
        </para>

        <example id="zend.session.basic_usage.basic_examples.example.counting_page_views">

            <title>Counting Page Views</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

$defaultNamespace = new Zend_Session_Namespace('Default');

if (isset($defaultNamespace->numberOfPageRequests)) {
    $defaultNamespace->numberOfPageRequests++; // this will increment for each page load.
} else {
    $defaultNamespace->numberOfPageRequests = 1; // first time
}

echo "Page requests this session: ", $defaultNamespace->numberOfPageRequests;]]>
            </programlisting>

        </example>

        <para>
            When multiple modules use instances of <code>Zend_Session_Namespace</code> having different namespaces, each
            module obtains data encapsulation for its session data. The <code>Zend_Session_Namespace</code> constructor
            can be passed an optional <code>$namespace</code> argument, which allows developers to partition session
            data into separate namespaces. Namespacing provides an effective and popular way to secure session state
            data against changes due to accidental naming collisions.
        </para>

        <para>
            Namespace names are restricted to character sequences represented as non-empty PHP strings that do not begin
            with an underscore ("<code>_</code>") character. Only core components included in the Zend Framework should
            use namespace names starting with "<code>Zend</code>".
        </para>

        <example id="zend.session.basic_usage.basic_examples.example.namespaces.new">

            <title>New Way: Namespaces Avoid Collisions</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

// in the Zend_Auth component
$authNamespace = new Zend_Session_Namespace('Zend_Auth');
$authNamespace->user = "myusername";

// in a web services component
$webServiceNamespace = new Zend_Session_Namespace('Some_Web_Service');
$webServiceNamespace->user = "mywebusername";]]>
            </programlisting>

        </example>

        <para>
            The example above achieves the same effect as the code below, except that the session objects above preserve
            encapsulation of session data within their respective namespaces.
        </para>

        <example id="zend.session.basic_usage.basic_examples.example.namespaces.old">

            <title>Old Way: PHP Session Access</title>

            <programlisting role="php"><![CDATA[<?php
$_SESSION['Zend_Auth']['user'] = "myusername";
$_SESSION['Some_Web_Service']['user'] = "mywebusername";]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.session.basic_usage.iteration">

        <title>Iterating Over Session Namespaces</title>

        <para>
            <code>Zend_Session_Namespace</code> provides the full
            <ulink url="http://www.php.net/~helly/php/ext/spl/interfaceIteratorAggregate.html">IteratorAggregate
            interface</ulink>, including support for the <code>foreach</code> statement:
        </para>

        <example id="zend.session.basic_usage.iteration.example">

            <title>Session Iteration</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

$aNamespace = new Zend_Session_Namespace('some_namespace_with_data_present');

foreach ($aNamespace as $index => $value) {
    echo "aNamespace->$index = '$value';\n";
}]]>
            </programlisting>

        </example>

    </sect2>

    <sect2 id="zend.session.basic_usage.accessors">

        <title>Accessors for Session Namespaces</title>

        <para>
            <code>Zend_Session_Namespace</code> implements the <code>__get()</code>, <code>__set()</code>,
            <code>__isset()</code>, and <code>__unset()</code>
            <ulink url="http://www.php.net/manual/en/language.oop5.overloading.php">magic methods</ulink>, which should
            not be invoked directly, except from within a subclass. Instead, the normal operators automatically invoke
            these methods, such as in the following example:
        </para>

        <example id="zend.session.basic_usage.accessors.example">

            <title>Accessing Session Data</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';

$namespace = new Zend_Session_Namespace(); // default namespace

$namespace->foo = 100;

echo "\$namespace->foo = $namespace->foo\n";

if (!isset($namespace->bar)) {
    echo "\$namespace->bar not set\n";
}

unset($namespace->foo);]]>
            </programlisting>

        </example>

    </sect2>

</sect1>
<sect1 id="zend.session.global_session_management">

    <title>Global Session Management</title>

    <para>
        The default behavior of sessions can be modified using the static methods of Zend_Session. All management and
        manipulation of global session management occurs using Zend_Session, including configuration of the
        <ulink url="http://www.php.net/session#session.configuration">usual options provided by ext/session</ulink>,
        using <code>Zend_Session::setOptions()</code>. For example, failure to insure the use of a safe
        <code>save_path</code> or a unique cookie name by ext/session using <code>Zend_Session::setOptions()</code> may
        result in security issues.
    </para>

    <sect2 id="zend.session.global_session_management.configuration_options">

        <title>Configuration Options</title>

        <para>
            When the first session namespace is requested, Zend_Session will automatically start the PHP session, unless
            already started with
            <link linkend="zend.session.advanced_usage.starting_a_session"><code>Zend_Session::start()</code></link>.
            The underlying PHP session will use defaults from Zend_Session, unless modified first by
            <code>Zend_Session::setOptions()</code>.
        </para>

        <para>
            To set a session configuration option, include the basename (the part of the name after
            "<code>session.</code>") as a key of an array passed to <code>Zend_Session::setOptions()</code>. The
            corresponding value in the array is used to set the session option value. If no options are set by the
            developer, Zend_Session will utilize recommended default options first, then the default php.ini settings.
            Community feedback about best practices for these options should be sent to
            <ulink url="mailto:fw-auth@lists.zend.com">fw-auth@lists.zend.com</ulink>.
        </para>

        <example id="zend.session.global_session_management.setoptions.example">

            <title>Using Zend_Config to Configure Zend_Session</title>

            <para>
                To configure this component using
                <link linkend="zend.config.adapters.ini"><code>Zend_Config_Ini</code></link>, first add the
                configuration options to the INI file:
            </para>

            <programlisting role="ini"><![CDATA[; Accept defaults for production
[production]
; bug_compat_42
; bug_compat_warn
; cache_expire
; cache_limiter
; cookie_domain
; cookie_lifetime
; cookie_path
; cookie_secure
; entropy_file
; entropy_length
; gc_divisor
; gc_maxlifetime
; gc_probability
; hash_bits_per_character
; hash_function
; name should be unique for each PHP application sharing the same domain name
name = UNIQUE_NAME
; referer_check
; save_handler
; save_path
; serialize_handler
; use_cookies
; use_only_cookies
; use_trans_sid

; remember_me_seconds = <integer seconds>
; strict = on|off


; Development inherits configuration from production, but overrides several values
[development : production]
; Don't forget to create this directory and make it rwx (readable and modifiable) by PHP.
save_path = /home/myaccount/zend_sessions/myapp
use_only_cookies = on
; When persisting session id cookies, request a TTL of 10 days
remember_me_seconds = 864000]]>
            </programlisting>

            <para>
                Next, load the configuration file and pass its array representation to
                <code>Zend_Session::setOptions()</code>:
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Config/Ini.php';
$config = new Zend_Config_Ini('myapp.ini', 'development');

require_once 'Zend/Session.php';
Zend_Session::setOptions($config->toArray());]]>
            </programlisting>

        </example>

        <para>
            Most options shown above need no explanation beyond that found in the standard PHP documentation, but those
            of particular interest are noted below.
            <itemizedlist mark="opencircle">
                <listitem>
                    <para>
                        boolean <code>strict</code> - disables automatic starting of <code>Zend_Session</code> when
                        using <code>new Zend_Session_Namespace()</code>.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        integer <code>remember_me_seconds</code> - how long should session id cookie persist, after user
                        agent has ended (e.g., browser application terminated).
                    </para>
                </listitem>
                <listitem>
                    <para>
                        string <code>save_path</code> - The correct value is system dependent, and should be provided by
                        the developer using an <emphasis role="strong">absolute path</emphasis> to a directory readable
                        and writable by the PHP process.  If a writable path is not supplied, then
                        <code>Zend_Session</code> will throw an exception when started (i.e., when <code>start()</code>
                        is called).
                    </para>
                    <note>
                        <title>Security Risk</title>
                        <para>
                            If the path is readable by other applications, then session hijacking might be possible. If
                            the path is writable by other applications, then
                            <ulink url="http://en.wikipedia.org/wiki/Session_poisoning">session poisoning</ulink>
                            might be possible. If this path is shared with other users or other PHP applications,
                            various security issues might occur, including theft of session content, hijacking of
                            sessions, and collision of garbage collection (e.g., another user's application might cause
                            PHP to delete your application's session files).
                        </para>
                        <para>
                            For example, an attacker can visit the victim's website to obtain a session cookie. Then, he
                            edits the cookie path to his own domain on the same server, before visiting his own website
                            to execute <code>var_dump($_SESSION)</code>. Armed with detailed knowledge of the victim's
                            use of data in their sessions, the attacker can then modify the session state (poisoning the
                            session), alter the cookie path back to the victim's website, and then make requests from
                            the victim's website using the poisoned session. Even if two applications on the same server
                            do not have read/write access to the other application's <code>save_path</code>, if the
                            <code>save_path</code> is guessable, and the attacker has control over one of these two
                            websites, the attacker could alter their website's <code>save_path</code> to use the other's
                            save_path, and thus accomplish session poisoning, under some common configurations of PHP.
                            Thus, the value for <code>save_path</code> should not be made public knowledge and should be
                            altered to a secure location unique to each application.
                        </para>
                    </note>
                </listitem>
                <listitem>
                    <para>
                        string <code>name</code> - The correct value is system dependent and should be provided by the
                        developer using a value <emphasis role="strong">unique</emphasis> to the application.
                    </para>
                    <note>
                        <title>Security Risk</title>
                        <para>
                            If the <code>php.ini</code> setting for <code>session.name</code> is the same (e.g., the
                            default "PHPSESSID"), and there are two or more PHP applications accessible through the same
                            domain name then they will share the same session data for visitors to both websites.
                            Additionally, possible corruption of session data may result.
                        </para>
                    </note>
                </listitem>
                <listitem>
                    <para>
                        boolean <code>use_only_cookies</code> - In order to avoid introducing additional security risks,
                        do not alter the default value of this option.
                        <note>
                            <title>Security Risk</title>
                            <para>
                                If this setting is not enabled, an attacker can easily fix victim's session ids, using
                                links on the attacker's website, such as
                                <code>http://www.example.com/index.php?PHPSESSID=fixed_session_id</code>. The fixation
                                works, if the victim does not already have a session id cookie for example.com. Once a
                                victim is using a known session id, the attacker can then attempt to hijack the session
                                by pretending to be the victim, and emulating the victim's user agent.
                            </para>
                        </note>
                    </para>
                </listitem>
            </itemizedlist>
        </para>

    </sect2>

    <sect2 id="zend.session.global_session_management.headers_sent">

        <title>Error: Headers Already Sent</title>

        <para>
            If you see the error message, "Cannot modify header information - headers already sent", or, "You must call
            ... before any output has been sent to the browser; output started in ...", then carefully examine the
            immediate cause (function or method) associated with the message. Any actions that require sending HTTP
            headers, such as sending a cookie, must be done before sending normal output (unbuffered output), except
            when using PHP's output buffering.
        </para>

        <itemizedlist mark="opencircle">
            <listitem>
                <para>
                    Using <ulink url="http://php.net/outcontrol">output buffering</ulink> often is sufficient to prevent
                    this issue, and may help improve performance. For example, in <code>php.ini</code>,
                    "<code>output_buffering = 65535</code>" enables output buffering with a 64K buffer. Even though
                    output buffering might be a good tactic on production servers to increase performance, relying only
                    on buffering to resolve the "headers already sent" problem is not sufficient. The application must
                    not exceed the buffer size, or the problem will occur whenever the output sent (prior to the HTTP
                    headers) exceeds the buffer size.
                </para>
            </listitem>
            <listitem>
                <para>
                    Alternatively, try rearranging the application logic so that actions manipulating headers are
                    performed prior to sending any output whatsoever.
                </para>
            </listitem>
            <listitem>
                <para>
                    If a Zend_Session method is involved in causing the error message, examine the method carefully, and
                    make sure its use really is needed in the application. For example, the default usage of
                    <code>destroy()</code> also sends an HTTP header to expire the client-side session cookie. If this
                    is not needed, then use <code>destroy(false)</code>, since the instructions to set cookies are sent
                    with HTTP headers.
                </para>
            </listitem>
            <listitem>
                <para>
                    Alternatively, try rearranging the application logic so that all actions manipulating headers are
                    performed prior to sending any output whatsoever.
                </para>
            </listitem>
            <listitem>
                <para>
                    Remove any closing "<code>?&gt;</code>" tags, if they occur at the end of a PHP source file. They
                    are not needed, and newlines and other nearly invisible whitespace following the closing tag can
                    trigger output to the client.
                </para>
            </listitem>
        </itemizedlist>

    </sect2>

    <sect2 id="zend.session.global_session_management.session_identifiers">

        <title>Session Identifiers</title>

        <para>
            Introduction: Best practice in relation to using sessions with ZF calls for using a browser cookie (i.e.
            a normal cookie stored in your web browser), instead of embedding a unique session identifier in URLs as
            a means to track individual users. By default this component uses only cookies to maintain session
            identifiers. The cookie's value is the unique identifier of your browser's session. PHP's ext/session
            uses this identifier to maintain a unique one-to-one relationship between website visitors, and
            persistent session data storage unique to each visitor. Zend_Session* wraps this storage mechanism
            (<code>$_SESSION</code>) with an object-oriented interface. Unfortunately, if an attacker gains access
            to the value of the cookie (the session id), an attacker might be able to hijack a visitor's session.
            This problem is not unique to PHP, or the Zend Framework. The <code>regenerateId()</code> method allows
            an application to change the session id (stored in the visitor's cookie) to a new, random, unpredictable
            value. Note: Although not the same, to make this section easier to read, we use the terms "user agent"
            and "web browser" interchangeably.
        </para>

        <para>
            Why?: If an attacker obtains a valid session identifier, an attacker might be able to impersonate a
            valid user (the victim), and then obtain access to confidential information or otherwise manipulate the
            victim's data managed by your application. Changing session ids helps protect against session hijacking.
            If the session id is changed, and an attacker does not know the new value, the attacker can not use the
            new session id in their attempts to hijack the visitor's session. Even if an attacker gains access to an
            old session id, <code>regenerateId()</code> also moves the session data from the old session id "handle"
            to the new one, so no data remains accessible via the old session id.
        </para>

        <para>
            When to use regenerateId(): Adding <code>Zend_Session::regenerateId()</code> to your Zend Framework
            bootstrap yields one of the safest and most secure ways to regenerate session id's in user agent
            cookies. If there is no conditional logic to determine when to regenerate the session id, then there are
            no flaws in that logic. Although regenerating on every request prevents several possible avenues of
            attack, not everyone wants the associated small performance and bandwidth cost. Thus, applications
            commonly try to dynamically determine situations of greater risk, and only regenerate the session ids in
            those situations. Whenever a website visitor's session's privileges are "escalated" (e.g. a visitor
            re-authenticates their identity before editing their personal "profile"), or whenever a security
            "sensitive" session parameter change occurs, consider using <code>regenerateId()</code> to create a new
            session id. If you call the <code>rememberMe()</code> function, then don't use
            <code>regenerateId()</code>, since the former calls the latter. If a user has successfully logged into
            your website, use <code>rememberMe()</code> instead of <code>regenerateId()</code>.
        </para>

        <sect3 id="zend.session.global_session_management.session_identifiers.hijacking_and_fixation">

            <title>Session Hijacking and Fixation</title>

            <para>
                Avoiding <ulink url="http://en.wikipedia.org/wiki/Cross_site_scripting">cross-site script (XSS)
                vulnerabilities</ulink> helps preventing session hijacking. According to
                <ulink url="http://secunia.com/">Secunia's</ulink> statistics XSS problems occur frequently, regardless
                of the languages used to create web applications. Rather than expecting to never have a XSS problem with
                an application, plan for it by following best practices to help minimize damage, if it occurs. With XSS,
                an attacker does not need direct access to a victim's network traffic. If the victim already has a
                session cookie, Javascript XSS might allow an attacker to read the cookie and steal the session. For
                victims with no session cookies, using XSS to inject Javascript, an attacker could create a session id
                cookie on the victim's browser with a known value, then set an identical cookie on the attacker's
                system, in order to hijack the victim's session. If the victim visited an attacker's website, then the
                attacker can also emulate most other identifiable characteristics of the victim's user agent. If your
                website has an XSS vulnerability, the attacker might be able to insert an AJAX Javascript that secretly
                "visits" the attacker's website, so that the attacker knows the victim's browser characteristics and
                becomes aware of a compromised session at the victim website. However, the attacker can not arbitrarily
                alter the server-side state of PHP sessions, provided the developer has correctly set the value for the
                <code>save_path</code> option.
            </para>

            <para>
                By itself, calling <code>Zend_Session::regenerateId()</code> when the user's session is first used, does
                not prevent session fixation attacks, unless you can distinguish between a session originated by an
                attacker emulating the victim. At first, this might sound contradictory to the previous statement above,
                until we consider an attacker who first initiates a real session on your website. The session is "first
                used" by the attacker, who then knows the result of the initialization (<code>regenerateId()</code>).
                The attacker then uses the new session id in combination with an XSS vulnerability, or injects the
                session id via a link on the attacker's website (works if <code>use_only_cookies = off</code>).
            </para>

            <para>
                If you can distinguish between an attacker and victim using the same session id, then session hijacking
                can be dealt with directly. However, such distinctions usually involve some form of usability tradeoffs,
                because the methods of distinction are often imprecise. For example, if a request is received from an IP
                in a different country than the IP of the request when the session was created, then the new request
                probably belongs to an attacker. Under the following conditions, there might not be any way for a
                website application to distinguish between a victim and an attacker:
                <itemizedlist mark='opencircle'>
                    <listitem>
                        <para>
                            - attacker first initiates a session on your website to obtain a valid session id
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            - attacker uses XSS vulnerability on your website to create a cookie on the victim's browser
                            with the same, valid session id (i.e. session fixation)
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            - both the victim and attacker originate from the same proxy farm (e.g. both are behind the
                            same firewall at a large company, like AOL)
                        </para>
                    </listitem>
                </itemizedlist>
                The sample code below makes it much harder for an attacker to know the current victim's session id,
                unless the attacker has already performed the first two steps above.
            </para>

            <example id="zend.session.global_session_management.session_identifiers.hijacking_and_fixation.example">

                <title>Session Fixation</title>

                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Session/Namespace.php';
$defaultNamespace = new Zend_Session_Namespace();

if (!isset($defaultNamespace->initialized)) {
    Zend_Session::regenerateId();
    $defaultNamespace->initialized = true;
}]]>
                </programlisting>

            </example>

        </sect3>

    </sect2>

    <sect2 id="zend.session.global_session_management.rememberme">

        <title><code>rememberMe(integer $seconds)</code></title>

        <para>
            Ordinarily, sessions end when the user agent terminates, such as when an end user exits a web browser
            program. However, your application may provide the ability to extend user sessions beyond the lifetime of
            the client program through the use of persistent cookies. Use <code>Zend_Session::rememberMe()</code> before
            a session is started to control the length of time before a persisted session cookie expires. If you do not
            specify a number of seconds, then the session cookie lifetime defaults to <code>remember_me_seconds</code>,
            which may be set using <code>Zend_Session::setOptions()</code>. To help thwart session fixation/hijacking,
            use this function when a user successfully authenticates with your application (e.g., from a "login" form).
        </para>

    </sect2>

    <sect2 id="zend.session.global_session_management.forgetme">

        <title><code>forgetMe()</code></title>

        <para>
            This function complements <code>rememberMe()</code> by writing a session cookie that has a lifetime ending
            when the user agent terminates.
        </para>

    </sect2>

    <sect2 id="zend.session.global_session_management.sessionexists">

        <title><code>sessionExists()</code></title>

        <para>
            Use this method to determine if a session already exists for the current user agent/request. It may be used
            before starting a session, and independently of all other <code>Zend_Session</code> and
            <code>Zend_Session_Namespace</code> methods.
        </para>

    </sect2>

    <sect2 id="zend.session.global_session_management.destroy">

        <title><code>destroy(bool $remove_cookie = true, bool $readonly = true)</code></title>

        <para>
            <code>Zend_Session::destroy()</code> destroys all of the persistent data associated with the current
            session. However, no variables in PHP are affected, so your namespaced sessions (instances of
            <code>Zend_Session_Namespace</code>) remain readable. To complete a "logout", set the optional parameter to
            <code>true</code> (the default) to also delete the user agent's session id cookie. The optional
            <code>$readonly</code> parameter removes the ability to create new <code>Zend_Session_Namespace</code>
            instances and for <code>Zend_Session</code> methods to write to the session data store.
        </para>

        <para>
            If you see the error message, "Cannot modify header information - headers already sent", then either avoid
            using <code>true</code> as the value for the first argument (requesting removal of the session cookie), or
            see <xref linkend="zend.session.global_session_management.headers_sent" />. Thus,
            <code>Zend_Session::destroy(true)</code> must either be called before PHP has sent HTTP headers, or output
            buffering must be enabled. Also, the total output sent must not exceed the set buffer size, in order to
            prevent triggering sending the output before the call to <code>destroy()</code>.
        </para>

        <note>
            <title>Throws</title>
            <para>
                By default, <code>$readonly</code> is enabled and further actions involving writing to the session data
                store will throw an exception.
            </para>
        </note>

    </sect2>

    <sect2 id="zend.session.global_session_management.stop">

        <title><code>stop()</code></title>

        <para>
            This method does absolutely nothing more than toggle a flag in Zend_Session to prevent further writing to
            the session data store. We are specifically requesting feedback on this feature. Potential uses/abuses might
            include temporarily disabling the use of <code>Zend_Session_Namespace</code> instances or
            <code>Zend_Session</code> methods to write to the session data store, while execution is transfered to view-
            related code. Attempts to perform actions involving writes via these instances or methods will throw an
            exception.
        </para>

    </sect2>

    <sect2 id="zend.session.global_session_management.writeclose">

        <title><code>writeClose($readonly = true)</code></title>

        <para>
            Shutdown the session, close writing and detach <code>$_SESSION</code> from the back-end storage mechanism.
            This will complete the internal data transformation on this request. The optional <code>$readonly</code>
            boolean parameter can remove write access by throwing an exception upon any attempt to write to the session
            via <code>Zend_Session</code> or <code>Zend_Session_Namespace</code>.
        </para>

        <note>
            <title>Throws</title>
            <para>
                By default, <code>$readonly</code> is enabled and further actions involving writing to the session data
                store will throw an exception. However, some legacy application might expect <code>$_SESSION</code> to
                remain writable after ending the session via <code>session_write_close()</code>. Although not considered
                "best practice", the <code>$readonly</code> option is available for those who need it.
            </para>
        </note>

    </sect2>

    <sect2 id="zend.session.global_session_management.expiresessioncookie">

        <title><code>expireSessionCookie()</code></title>

        <para>
            This method sends an expired session id cookie, causing the client to delete the session cookie. Sometimes
            this technique is used to perform a client-side logout.
        </para>

    </sect2>

    <sect2 id="zend.session.global_session_management.savehandler">

        <title><code>setSaveHandler(Zend_Session_SaveHandler_Interface $interface)</code></title>

        <para>
            Most developers will find the default save handler sufficient. This method provides an object-oriented
            wrapper for
            <ulink url="http://php.net/session_set_save_handler"><code>session_set_save_handler()</code></ulink>.
        </para>

    </sect2>

    <sect2 id="zend.session.global_session_management.namespaceisset">

        <title><code>namespaceIsset($namespace)</code></title>

        <para>
            Use this method to determine if a session namespace exists, or if a particular index exists in a particular
            namespace.
        </para>

        <note>
            <title>Throws</title>
            <para>
                An exception will be thrown if <code>Zend_Session</code> is not marked as readable (e.g., before <code>
                Zend_Session</code> has been started).
            </para>
        </note>

    </sect2>

    <sect2 id="zend.session.global_session_management.namespaceunset">

        <title><code>namespaceUnset($namespace)</code></title>

        <para>
            Use <code>Zend_Session::namespaceUnset($namespace)</code> to efficiently remove an entire namespace and its
            contents. As with all arrays in PHP, if a variable containing an array is unset, and the array contains
            other objects, those objects will remain available, if they were also stored by reference in other
            array/objects that remain accessible via other variables. So <code>namespaceUnset()</code> does not perform
            a "deep" unsetting/deleting of the contents of the entries in the namespace. For a more detailed
            explanation, please see <ulink url="http://php.net/references">References Explained</ulink> in the PHP
            manual.
        </para>

        <note>
            <title>Throws</title>
            <para>
                An exception will be thrown if the namespace is not writable (e.g., after <code>destroy()</code>).
            </para>
        </note>

    </sect2>

    <sect2 id="zend.session.global_session_management.namespaceget">

        <title><code>namespaceGet($namespace)</code></title>

        <para>
            DEPRECATED: Use <code>getIterator()</code> in <code>Zend_Session_Namespace</code>. This method returns an
            array of the contents of <code>$namespace</code>. If you have logical reasons to keep this method publicly
            accessible, please provide feedback to the
            <ulink url="mailto:fw-auth@lists.zend.com">fw-auth@lists.zend.com</ulink> mail list. Actually, all
            participation on any relevant topic is welcome :)
        </para>

        <note>
            <title>Throws</title>
            <para>
                An exception will be thrown if <code>Zend_Session</code> is not marked as readable (e.g., before
                <code>Zend_Session</code> has been started).
            </para>
        </note>

    </sect2>

    <sect2 id="zend.session.global_session_management.getiterator">

        <title><code>getIterator()</code></title>

        <para>
            Use <code>getIterator()</code> to obtain an array containing the names of all namespaces.
        </para>

        <note>
            <title>Throws</title>
            <para>
                An exception will be thrown if <code>Zend_Session</code> is not marked as readable (e.g., before
                <code>Zend_Session</code> has been started).
            </para>
        </note>

    </sect2>

</sect1>
<sect1 id="zend.session.introduction">

    <title>Introduction</title>

    <para>
        The Zend Framework Auth team greatly appreciates your feedback and contributions on our email list:
        <ulink url="mailto:fw-auth@lists.zend.com">fw-auth@lists.zend.com</ulink>
    </para>

    <para>
        With web applications written using PHP, a <emphasis role="bold">session</emphasis> represents a logical,
        one-to-one connection between server-side, persistent state data and a particular user agent client (e.g., web
        browser). <code>Zend_Session</code> helps manage and preserve session data, a logical complement of cookie
        data, across multiple page requests by the same client. Unlike cookie data, session data are not stored on the
        client side and are only shared with the client when server-side source code voluntarily makes the data
        available in response to a client request. For the purposes of this component and documentation, the term
        "session data" refers to the server-side data stored in
        <ulink url="http://www.php.net/manual/en/reserved.variables.php#reserved.variables.session"><code>$_SESSION</code></ulink>,
        managed by <code>Zend_Session</code>, and individually manipulated by <code>Zend_Session_Namespace</code>
        accessor objects. <emphasis role="bold">Session namespaces</emphasis> provide access to session data using
        classic <ulink url="http://en.wikipedia.org/wiki/Namespace_%28computer_science%29">namespaces</ulink>
        implemented logically as named groups of associative arrays, keyed by strings (similar to normal PHP arrays).
    </para>

    <para>
        <code>Zend_Session_Namespace</code> instances are accessor objects for namespaced slices of
        <code>$_SESSION</code>. The <code>Zend_Session</code> component wraps the existing PHP ext/session with an
        administration and management interface, as well as providing an API for <code>Zend_Session_Namespace</code> to
        persist session namespaces. <code>Zend_Session_Namespace</code> provides a standardized, object-oriented
        interface for working with namespaces persisted inside PHP's standard session mechanism. Support exists for
        both anonymous and authenticated (e.g., "login") session namespaces. <code>Zend_Auth</code>, the authentication
        component of the Zend Framework, uses <code>Zend_Session_Namespace</code> to store some information associated
        with authenticated users. Since <code>Zend_Session</code> uses the normal PHP ext/session functions internally,
        all the familiar configuration options and settings apply (see
        <ulink url="http://www.php.net/session">http://www.php.net/session</ulink>), with such bonuses as the
        convenience of an object-oriented interface and default behavior that provides both best practices and smooth
        integration with the Zend Framework. Thus, a standard PHP session identifier, whether conveyed by cookie or
        within URLs, maintains the association between a client and session state data.
    </para>

    <para>
        The default
        <ulink url="http://www.php.net/manual/en/function.session-set-save-handler.php">ext/session save
        handler</ulink> does not maintain this association for server clusters under certain conditions because session
        data are stored to the filesystem of the server that responded to the request. If a request may be processed by
        a different server than the one where the session data are located, then the responding server has no access to
        the session data (if they are not available from a networked filesystem). A list of additional, appropriate
        save handlers will be provided, when available. Community members are encouraged to suggest and submit save
        handlers to the <ulink url="mailto:fw-auth@lists.zend.com">fw-auth@lists.zend.com</ulink> list. A Zend_Db
        compatible save handler has been posted to the list.
    </para>

</sect1>
<sect1 id="zend.timesync.working">

    <title>Working with Zend_TimeSync</title>

    <para>
        <code>Zend_TimeSync</code> can return the actual time from any given
        <emphasis role="strong">NTP</emphasis> or <emphasis role="strong">SNTP</emphasis> timeserver.
        It can automatically handle multiple servers and provides a simple interface.
    </para>

    <note>
        <para>
            In all examples within this chapter we are using one of the available public generic timeservers.
            In our case <emphasis role="strong">0.europe.pool.ntp.org</emphasis>. For your environment
            it is recommended that you are using a public generic timeserver which is nearly to the location
            of your server. See <ulink url="http://www.pool.ntp.org">http://www.pool.ntp.org</ulink> for
            details.
        </para>
    </note>

    <sect2 id="zend.timesync.working.generic">

        <title>Generic timeserver request</title>

        <para>
            Requesting the time from a timeserver is quite simple. All you have to give is the timeserver
            from which you want to have the time.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

$server = new Zend_TimeSync('0.pool.ntp.org');

print $server->getDate()->getIso();]]>
        </programlisting>

        <para>
            So what is happening in the background of <code>Zend_TimeSync</code>? First the syntax of the
            given server is checked. So in our example '<code>0.pool.ntp.org</code>' is checked and
            recognised as possible correct adress for a timeserver. Then when calling
            <code>getDate()</code> the actual set timeserver is requested and it will return it's own
            time. <code>Zend_TimeSync</code> then calculates the difference to the actual time of the
            server running the script and returns a <code>Zend_Date</code> object with the actual,
            corrected time.
        </para>

        <para>
            For details about <code>Zend_Date</code> and it's methods you can refer to
            <link linkend="zend.date.introduction">Zend_Date</link>.
        </para>

    </sect2>

    <sect2 id="zend.timesync.working.multiple">

        <title>Multiple timeservers</title>

        <para>
            Not all timeservers are always available and will return their time. Servers will have a time
            where they can not be reached, for example when having a maintenance. In such cases, when the
            time can not be requested from the timeserver, you would get an exception.
        </para>

        <para>
            As simple solution <code>Zend_TimeSync</code> can handle multiple timeservers and supports a
            automatic fallback machanism. There are two supported ways. You can either give an array
            of timeservers when creating the instance. Or you can add additionally timeservers afterwards
            with the <code>addServer()</code> method.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

$server = new Zend_TimeSync(array('0.pool.ntp.org',
                                  '1.pool.ntp.org',
                                  '2.pool.ntp.org'));
$server->addServer('3.pool.ntp.org');

print $server->getDate()->getIso();]]>
        </programlisting>

        <para>
            There is no limitation in the ammount of timeservers you can add. When a timeserver can not
            be reached <code>Zend_TimeSync</code> will fallback and try to connect to the next given timeserver.
        </para>

        <para>
            When you give more than one timeserver, which should be your default behaviour, you should name
            your servers. You can either name your servers with the array key, but also with the second
            parameter at initiation or addition of an other timeserver.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

$server = new Zend_TimeSync(array('generic'  => '0.pool.ntp.org',
                                  'fallback' => '1.pool.ntp.org',
                                  'reserve'  => '2.pool.ntp.org'));
$server->addServer('3.pool.ntp.org', 'additional');

print $server->getDate()->getIso();]]>
        </programlisting>

        <para>
            Naming the timeservers gives you the ability to request a specific timeserver as we will see
            later in this chapter.
        </para>

    </sect2>

    <sect2 id="zend.timesync.working.protocol">

        <title>Protocols of timeservers</title>

        <para>
            There are different types of timeservers. The most public timeservers are using
            <emphasis role="strong">NTP</emphasis> as protocol. But there are different other
            protocols available.
        </para>

        <para>
            You can set the proper protocol within the address of the timeserver. Actual there are two
            protocols which are supported by <code>Zend_TimeSync</code>. The default protocol is
            <emphasis role="strong">NTP</emphasis>. If you are only using NTP you can ommit the protocol
            within the address as show in the previous examples.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

$server = new Zend_TimeSync(array('generic'  => 'ntp:\\0.pool.ntp.org',
                                  'fallback' => 'ntp:\\1.pool.ntp.org',
                                  'reserve'  => 'ntp:\\2.pool.ntp.org'));
$server->addServer('sntp:\\internal.myserver.com', 'additional');

print $server->getDate()->getIso();]]>
        </programlisting>

        <para>
            <code>Zend_TimeSync</code> is able to handle mixed timeservers. So you are not restricted to
            only one protocol, but you can add any server independently from it's protocol.
        </para>

    </sect2>

    <sect2 id="zend.timesync.working.ports">

        <title>Using ports for timeservers</title>

        <para>
            As every protocol within the world wide web, the <emphasis role="strong">NTP</emphasis> and
            <emphasis role="strong">SNTP</emphasis> protocols are using standard ports. NTP uses port
            <emphasis role="strong">123</emphasis> and SNTP uses <emphasis role="strong">37</emphasis>.
        </para>

        <para>
            But sometimes the used port differ from the standard one. You can define the port which
            has to be used for each server within the address. Just add the number of the port behind the
            address. If no port is defined, then <code>Zend_TimeSync</code> will use the standard port.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

$server = new Zend_TimeSync(array('generic'  => 'ntp:\\0.pool.ntp.org:200',
                                  'fallback' => 'ntp:\\1.pool.ntp.org'));
$server->addServer('sntp:\\internal.myserver.com:399', 'additional');

print $server->getDate()->getIso();]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.timesync.working.options">

        <title>Options for timeservers</title>

        <para>
            Actually there is only one option within <code>Zend_TimeSync</code> which will be used internally.
            But you can set any self defined option you are in need for and request it.
        </para>

        <para>
            The option <emphasis role="strong">timeout</emphasis> defines the number of seconds after which
            a connection is detected as broken when there was no response. The default value is
            <emphasis role="strong">1</emphasis>, which means that <code>Zend_TimeSync</code> will
            fallback to the next timeserver is the actual requested timeserver does not respond in one second.
        </para>

        <para>
            With the <code>setOptions()</code> method, you can set any option. It accepts an array where the
            key is the option to set and the value is the value of that option. Any previous set option will
            be overwritten by the new value. If you want to know which options are set, use the
            <code>getOptions()</code> method. It accepts either a key which returns the given option if set
            or, if no key is set, it will return all set options.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

Zend_TimeSync::setOptions(array('timeout' => 3, 'myoption' => 'timesync'));
$server = new Zend_TimeSync(array('generic'  => 'ntp:\\0.pool.ntp.org',
                                  'fallback' => 'ntp:\\1.pool.ntp.org'));
$server->addServer('sntp:\\internal.myserver.com', 'additional');

print $server->getDate()->getIso();
print_r(Zend_TimeSync::getOptions();
print "Timeout = " . Zend_TimeSync::getOptions('timeout');]]>
        </programlisting>

        <para>
            As you can see the options for <code>Zend_TimeSync</code> are static, which means that each
            instance of <code>Zend_TimeSync</code> will act with the same options.
        </para>

    </sect2>

    <sect2 id="zend.timesync.working.different">

        <title>Using different timeservers</title>

        <para>
            The default behaviour for requesting a time is to request it from the first given server.
            But sometimes it is useful to set a different timeserver from which to request the time.
            This can be done with the <code>setServer()</code> method. To define the used timeserver
            just set the alias as parameter within the method. And to get the actual used timeserver
            just call the <code>getServer()</code> method. It accepts an alias as parameter which
            defined the timeserver to be returned. If no parameter is given, the current timeserver will
            be returned.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

$server = new Zend_TimeSync(array('generic'  => 'ntp:\\0.pool.ntp.org',
                                  'fallback' => 'ntp:\\1.pool.ntp.org'));
$server->addServer('sntp:\\internal.myserver.com', 'additional');

$actual = $server->getServer();
$server = $server->setServer('additional');]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.timesync.working.informations">

        <title>Informations from timeservers</title>

        <para>
            Timeservers offer not only the time itself but also additionally informations. You can
            get these informations with the <code>getInfo()</code> method.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/TimeSync.php';

$server = new Zend_TimeSync(array('generic'  => 'ntp:\\0.pool.ntp.org',
                                  'fallback' => 'ntp:\\1.pool.ntp.org'));

print_r ($server->getInfo());]]>
        </programlisting>

        <para>
            The returned informations differ with the used protocols and they can also differ with the used
            servers.
        </para>

    </sect2>

    <sect2 id="zend.timesync.working.exceptions">

        <title>Taking care of exceptions</title>

        <para>
            Exceptions are collected for all timeserver and will be returned as array. So you are able
            to iterate through all throwed exceptions like shown in the following example:
        </para>

        <programlisting role="php"><![CDATA[<?php
$serverlist = array(
        // invalid servers
        'invalid_a'  => 'ntp://a.foo.bar.org',
        'invalid_b'  => 'sntp://b.foo.bar.org',
);

$server = new Zend_TimeSync($serverlist);

try {
    $result = $server->getDate();
    echo $result->getIso();
} catch (Zend_TimeSync_Exception $e) {

    $exceptions = $e->get();

    foreach ($exceptions as $key => $myException) {
        echo $myException->getMessage();
        echo '<br />';
    }
}]]>
        </programlisting>
    </sect2>
</sect1>
<sect1 id="zend.timesync.introduction">

    <title>Introduction</title>

    <para>
        <code>Zend_TimeSync</code> is able to receive internet or network time from a timeserver using
        the <emphasis role="strong">NTP</emphasis> or <emphasis role="strong">SNTP</emphasis> protocol.
        With <code>Zend_TimeSync</code> the Zend Framework is able to act indepentendly from the
        timesettings of the server where it is running.
    </para>

    <para>
        To be independent from the actual time of the server, <code>Zend_TimeSync</code> does internally
        work just with the difference of the real time which is send through NTP or SNTP and the internal
        servers time.
    </para>

    <note>

        <title>Background</title>

        <para>
            <code>Zend_TimeSync</code> is not able to change the server's time, but it will return a
            <link linkend="zend.date.introduction">Zend_Date</link> instance from which the difference
            to the servers time can be worked with.
        </para>

    </note>

    <sect2 id="zend.timesync.introduction.why">

        <title>Why <code>Zend_TimeSync</code> ?</title>

        <para>
            So why would someone use <code>Zend_TimeSync</code> ?
        </para>

        <para>
            Normally every server within a multiserver farm will have a service running which syncronises
            the own time with a timeserver. So within a standard environment it should not be necessary to
            use <code>Zend_TimeSync</code>. But it can become handy if there is no service available and if
            you don't have the right to install such a service.
        </para>

        <para>
            Here are some example usecases, where <code>Zend_TimeSync</code> is perfect suited for:
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    <emphasis role="strong">Server without timeservice</emphasis>
                </para>
                <para>
                    If your application is running on a server and this server does not have any timeservice
                    running it can be good to implement <code>Zend_TimeSync</code> within the own application.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Seperated database server</emphasis>
                </para>
                <para>
                    If your database is running on a seperated server and the other server is not connected
                    with <emphasis role="strong">NTP</emphasis> or <emphasis role="strong">SNTP</emphasis>
                    to the application server you would expect problems with data stored into the database
                    where timestamps are used.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Multiple servers</emphasis>
                </para>
                <para>
                    If your application is running on more than one server and the timebase of this servers
                    are not coupled together you can expect problems within your application when part of
                    the application are coming from one server and others from other servers.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="strong">Batch processing</emphasis>
                </para>
                <para>
                    If your want to include or work with a timeservice within a batch file or within a
                    command line application.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            In all this cases <code>Zend_TimeSync</code> is a perfect solution and can be used if you are
            not able to run any service on your server.
        </para>

    </sect2>

    <sect2 id="zend.timesync.introduction.ntp">

        <title>What is NTP ?</title>

        <para>
            The <code>Network Time Protocol</code> (<emphasis role="strong">NTP</emphasis>) is a protocol
            for synchronizing the clocks of computer systems over packet-switched, variable-latency data
            networks. NTP uses UDP port 123 as it's transport layer. See
            <ulink url="http://en.wikipedia.org/wiki/Network_Time_Protocol">this wikipedia article</ulink>
            for details about this protocol.
        </para>

    </sect2>

    <sect2 id="zend.timesync.introduction.sntp">

        <title>What is SNTP?</title>

        <para>
            The <code>Simple Network Time Protocol</code> (<emphasis role="strong">SNTP</emphasis>) is a
            protocol for syncronising with clocks of computer systems over packet-switched, variable-latency
            data networks. SNTP uses UDP port 37 as it's transport layer. It is nearly related to the
            <code>NTP</code> Protocol but simpler.
        </para>

    </sect2>

    <sect2 id="zend.timesync.introduction.problematic">

        <title>Problematic usage</title>

        <para>
            Be warned that when you are using <code>Zend_TimeSync</code> you will have to think about some
            details related to the structure of timesync and the web itself. How problems can be avoided
            and best practice will be described here. Read carefully before using <code>Zend_TimeSync</code>.
        </para>

    </sect2>

    <sect2 id="zend.timesync.introduction.decision">

        <title>Decide which server to use</title>

        <para>
            You have to select the timeserver which you want to use very carefully. This has several reasons
            which are described here:
        </para>

        <itemizedlist mark='opencircle'>
            <listitem>
                <para>
                    Distance
                </para>
                <para>
                    The distance from the server where your application is running to the timeserver you are
                    requesting. If your server is in europe it would make no sense to use a timeserver in
                    tahiti. Select always a server which is not far away. This reduces the time for the
                    request and reduced network load.
                </para>
            </listitem>
            <listitem>
                <para>
                    Speed
                </para>
                <para>
                    How long it takes to receive the request is also relevant. Try some servers to get the
                    best result. If you are requesting a server which is never accessible you will always
                    have a unnecessary delay.
                </para>
            </listitem>
            <listitem>
                <para>
                    Splitting
                </para>
                <para>
                    Do not use always the same server. All timeservers will lock request from servers which
                    are flooding the server. If your application makes excessive use of timeservers you
                    should not use a single timeserver but one of the pools described later.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            So where can you find a timeserver ? Generally you can use any timeserver you know. This can be
            a timeserver within you LAN or any public timeserver you know. If you decide to use a public
            timeserver you should use a server pool. Serverpools are public addresses where you will get
            a random timeserver from the pool if you request the time. This way you will not have to split your
            requests. There are public serverpools available for different regions so you will not have any of the
            problems mentioned above.
        </para>

        <para>
            Take a look at <ulink url="http://www.pool.ntp.org">pool.ntp.org</ulink> to get your nearest
            serverpool. So if your server is located within germany for example you can connect to
            <code>0.europe.pool.ntp.org</code> and so on.
        </para>

    </sect2>

</sect1>
<sect1 id="zend.translate.adapter">

    <title>Adapters for Zend_Translate</title>

    <para>
        Zend_Translate can handle different adapters for translation.
        Each adapter has its own advantages and disadvantages.
        Below is a comprehensive list of all supported adapters for
        translation source files.
    </para>

    <table id="zend.translate.adapter.table">
        <title>Adapters for Zend_Translate</title>
        <tgroup cols="3">
            <thead>
                <row>
                    <entry>Adapter</entry>
                    <entry>Description</entry>
                    <entry>Usage</entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>Array</entry>
                    <entry>Use php arrays</entry>
                    <entry>Small pages; simplest usage; only for programmers</entry>
                </row>
                <row>
                    <entry>Csv</entry>
                    <entry>Use comma seperated (*.csv/*.txt) files</entry>
                    <entry>Simple text file format; very fast; possible problems with unicode characters</entry>
                </row>
                <row>
                    <entry>Gettext</entry>
                    <entry>Use binary gettext (*.mo) files</entry>
                    <entry>GNU standard for linux; very fast; thread-safe; needs tools for translation</entry>
                </row>
                <row>
                    <entry>Tbx</entry>
                    <entry>Use termbase exchange (*.tbx/*.xml) files</entry>
                    <entry>Industry standard for inter application terminology strings; XML format</entry>
                </row>
                <row>
                    <entry>Tmx</entry>
                    <entry>Use tmx (*.tmx/*.xml) files</entry>
                    <entry>Industry standard for inter application translation; XML format; human readable</entry>
                </row>
                <row>
                    <entry>Qt</entry>
                    <entry>Use qt linguist (*.ts) files</entry>
                    <entry>Cross platform application framework; XML format; human readable</entry>
                </row>
                <row>
                    <entry>Xliff</entry>
                    <entry>Use xliff (*.xliff/*.xml) files</entry>
                    <entry>A simpler format as TMX but related to it; XML format; human readable</entry>
                </row>
                <row>
                    <entry>XmlTm</entry>
                    <entry>Use xmltm (*.xml) files</entry>
                    <entry>Industry standard for XML document translation memory; XML format; human readable</entry>
                </row>
                <row>
                    <entry>Others</entry>
                    <entry>*.sql</entry>
                    <entry>Different other adapters may be implemented in the future</entry>
                </row>
            </tbody>
        </tgroup>
    </table>

    <sect2 id="zend.translate.adapter.decision">

        <title>How to decide which translation adapter to use</title>

        <para>
            You should decide which Adapter you want to use for Zend_Translate.
            Frequently, external criteria such as a project requirement or
            a customer requirement determines this for you, but if you are in
            the position to do this yourself, the following hints may simplify
            your decision.
        </para>

        <sect3 id="zend.translate.adapter.array">

            <title>Zend_Translate_Adapter_Array</title>

            <para>
                The Array Adapter is the Adapter which is simplest to use for
                programmers.
                But when you have numerous translation strings or many
                languages you should think about another Adapter.
                For example, if you have 5000 translation strings,
                the Array Adapter is possibly not the best choice for you.
            </para>

            <para>
                You should only use this Adapter for small sites with a handful
                of languages, and if you or your programmer team creates the
                translations yourselves.
            </para>
        </sect3>

        <sect3 id="zend.translate.adapter.csv">

            <title>Zend_Translate_Adapter_Csv</title>

            <para>
                The Csv Adapter is the Adapter which is simplest to use for
                customers.
                CSV files are readable by standard text editors, but
                text editors often do not support utf8 character sets.
            </para>

            <para>
                You should only use this Adapter if your customer wants to do
                translations himself.
            </para>
        </sect3>

        <sect3 id="zend.translate.adapter.gettext">

            <title>Zend_Translate_Adapter_Gettext</title>

            <para>
                The Gettext Adapter is the Adapter which is used most
                frequently.  Gettext is a translation source format which was
                introduced by GNU, and is now used worldwide.
                It is not human readable, but there are several freeware tools
                (for instance, <ulink url="http://sourceforge.net/projects/poedit/">POEdit</ulink>), which are very helpful.
                The Zend_Translate Gettext Adapter is not implemented using
                PHP's gettext extension.
                You can use the Gettext Adapter even if you do not have
                the PHP gettext extension installed.
                Also the Adapter is thread-safe and the PHP gettext extension
                is currently not thread-safe.
            </para>

            <para>
                Most people will use this adapter.
                With the available tools, professional translation is
                very simple.  But gettext data are is stored in a
                machine-readable format, which is not readable without tools.
            </para>
        </sect3>

        <sect3 id="zend.translate.adapter.tbx">

            <title>Zend_Translate_Adapter_Tbx</title>

            <para>
                The Tbx Adapter is an Adapter which will be used by customers
                which already use the TBX format for their internal translation
                system. Tbx is no standard translation format but more a collection
                of already translated and pre translated source strings. When you
                use this adapter you have to be sure that all your needed source
                string are translated.
                TBX is a XML file based format and a completly new format.
                XML files are human-readable, but the parsing is not as fast
                as with gettext files.
            </para>

            <para>
                This adapter is perfect for companies when pre translated
                source files already exist.
                The files are human readable and system-independent.
            </para>
        </sect3>

        <sect3 id="zend.translate.adapter.tmx">

            <title>Zend_Translate_Adapter_Tmx</title>

            <para>
                The Tmx Adapter is the Adapter which will be used by most
                customers which have multiple systems which use the same
                translation source, or when the translation source must be
                system-independent.
                TMX is a XML file based format, which is announced to be the
                next industry standard.
                XML files are human-readable, but the parsing is not as fast
                as with gettext files.
            </para>

            <para>
                Most medium to large companies use this adapter.
                The files are human readable and system-independent.
            </para>
        </sect3>

        <sect3 id="zend.translate.adapter.qt">

            <title>Zend_Translate_Adapter_Qt</title>

            <para>
                The Qt Adapter is for all customers which have TS files as their
                translation source which are made by QtLinguist.
                QT is a XML file based format.
                XML files are human-readable, but the parsing is not as fast
                as with gettext files.
            </para>

            <para>
                Several big players have build software upon the QT framework.
                The files are human readable and system-independent.
            </para>
        </sect3>

        <sect3 id="zend.translate.adapter.xliff">

            <title>Zend_Translate_Adapter_Xliff</title>

            <para>
                The Xliff Adapter is the Adapter which will be used by most
                customers which want to have XML files but do not have tools
                for TMX.
                XLIFF is a XML file based format, which is related to TMX but
                simpler as it does not support all possibilities of it.
                XML files are human-readable, but the parsing is not as fast
                as with gettext files.
            </para>

            <para>
                Most medium companies use this adapter.
                The files are human readable and system-independent.
            </para>
        </sect3>

        <sect3 id="zend.translate.adapter.xmltm">

            <title>Zend_Translate_Adapter_XmlTm</title>

            <para>
                The XmlTm Adapter is the Adapter which will be used by customers
                which do their layout themself. XmlTm is a format which allows the
                complete html source to be included in the translation source, so
                the translation is coupled with the layout.
                XLIFF is a XML file based format, which is related to XLIFF but
                its not as simple to read.
            </para>

            <para>
                This adapter sould only be used when source files already exist.
                The files are human readable and system-independent.
            </para>
        </sect3>

    </sect2>

    <sect2 id="zend.translate.adapter.selfwritten">

        <title>Integrate self written Adapters</title>

        <para>
            Zend_Translate allows you to integrate and use self written Adapter
            classes. They can be used like the standard Adapter classes which
            are already included within Zend_Translate.
        </para>

        <para>
            Any adapter class you want to use with Zend_Translate must be a subclass
            of Zend_Translate_Adapter. Zend_Translate_Adapter is an abstract class
            which already defines all what is needed for translation. What has to be
            done by you, is the definition of the reader for translation datas.
        </para>

        <para>
            The usage of the prefix "Zend" should be limited to the Zend_Framework.
            If you extend Zend_Translate with your own adapter, you should name it
            like "Company_Translate_Adapter_MyFormat". The following code shows an
            example of how a self written adapter class could be implemented:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Translate.php';

try {
    $translate = new Zend_Translate('Company_Translate_Adapter_MyFormat', '/path/to/translate.xx', 'en', array('myoption' => 'myvalue'));
} catch (Exception $e) {
    // File not found, no adapter class...
    // General failure
}]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.translate.adapter.caching">

        <title>Speedup all Adapters</title>

        <para>
            <code>Zend_Translate</code> allows you use internally <code>Zend_Cache</code> to
            fasten the loading of translation sources. This comes very handy if you use many
            translation sources or extensive source formats like XML based files.
        </para>

        <para>
            To use caching you will just have to give a cache object to the
            <code>Zend_Translate::setCache()</code> method. It takes a instance of
            <code>Zend_Cache</code> as only parameter. Also if you use any adapter direct you
            can use the <code>setCache()</code> method.
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Translate.php';

$cache = Zend_Cache::factory('Page', 'File', $frontendOptions, $backendOptions);
Zend_Translate::setCache($cache);
$translate = new Zend_Translate('gettext', '/path/to/translate.mo', 'en');]]>
        </programlisting>

        <note>
            <para>
                You must set the cache <emphasis role="strong">before</emphasis> you use or initiate
                any adapter or instance of <code>Zend_Translate</code>. Otherwise your translation
                source will not be cached until you add a new source with the
                <code>addTranslation()</code> method.
            </para>
        </note>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.translate.introduction">

    <title>Introduction</title>

    <para>
        Zend_Translate is the Zend Framework's solution for multilingual
        applications.
    </para>

    <para>
        In multilingual applications, the content must be translated into
        several languages and display content depending on the user's language.
        PHP offers already several ways to handle such problems, however
        the PHP solution has some problems:
    </para>

    <itemizedlist>
        <listitem>
            <para>
                <emphasis role="strong">Inconsistent API:</emphasis>
                There is no single API for the different source formats.
                The usage of gettext for example is very complicated.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">PHP supports only gettext and native array:</emphasis>
                PHP itself offers only support for array or gettext.
                All other source formats have to be coded manually,
                because there is no native support.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">No detection of the default language:</emphasis>
                The default language of the user cannot be detected without
                deeper knowledge of the backgrounds for
                the different web browsers.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">Gettext is not thread-safe:</emphasis>
                PHP's gettext library is not thread safe, and it
                should not be used in a multithreaded environment.
                This is due to problems with gettext itself, not PHP,
                but it is an existing problem.
            </para>
        </listitem>
    </itemizedlist>

    <para>
        Zend_Translate does not have the above problems. This is why we
        recommend using Zend_Translate instead of PHP's native functions.
        The benefits of Zend_Translate are:
    </para>

    <itemizedlist>
        <listitem>
            <para>
                <emphasis role="strong">Supports multiple source formats:</emphasis>
                Zend_Translate supports several source formats, including
                those supported by PHP, and other formats including TMX
                and CSV files.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">Thread-safe gettext:</emphasis>
                The gettext reader of Zend_Translate is thread-safe.
                There are no problems using it in multi-threaded environments.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">Easy and generic API:</emphasis>
                The API of Zend_Translate is very simple and requires only a
                handful of functions.
                So it's easy to learn and easy to maintain.
                All source formats are handled the same way, so if the format
                of your source files change from Gettext to TMX,
                you only need to change one line of code to specify the
                storage adapter.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">Detection of the user's standard language:</emphasis>
                The preferred language of the user accessing the site can be
                detected and used by Zend_Translate.
            </para>
        </listitem>
        <listitem>
            <para>
                <emphasis role="strong">Automatic source detection:</emphasis>
                Zend_Translate is captable of detecting and integrating multiple source files
                and additionally detect the locale to be used depending on directory or filenames.
            </para>
        </listitem>
    </itemizedlist>

    <sect2 id="zend.translate.introduction.adapters">

        <title>Starting multi-lingual</title>

        <para>
            So let's get started with multi-lingual business.
            What we want to do is translate our string
            output so the view produces the translated output.
            Otherwise we would have to write one view
            for each language, and no one would like to do this.
            Generally, multi-lingual sites are very simple in their design.
            There are only four steps you would have to do:
        </para>

        <orderedlist numeration='arabic'>
            <listitem>
                <para>
                    Decide which adapter you want to use;
                </para>
            </listitem>
            <listitem>
                <para>
                    Create your view and integrate Zend_Translate in your code;
                </para>
            </listitem>
            <listitem>
                <para>
                    Create the source file from your code;
                </para>
            </listitem>
            <listitem>
                <para>
                    Translate your source file to the desired language.
                </para>
            </listitem>
        </orderedlist>

        <para>
            The following sections guide you through all four steps.
            Read through the next few pages to create your own
            multi-lingual web application.
        </para>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.translate.using">

    <title>Using Translation Adapters</title>

    <para>
        The next step is to use the adapter within your code.
    </para>

    <example id="zend.translate.using.example1">
        <title>Example of single-language PHP code</title>
        <programlisting role="php"><![CDATA[<?php
print "Example\n";
print "=======\n";
print "Here is line one\n";
print "Today is the " . date("d.m.Y") . "\n";
print "\n";
print "Fix language here is line two\n";]]>
        </programlisting>
    </example>

    <para>
        The example above shows some output with no support for translation.
        You probably write your code in your native language.
        Generally you need to translate not only the output,
        but also error messages and log messages.
    </para>

    <para>
        The next step is to include Zend Translate in your existing code.
        Of course it is much easier if you are writing your code using
        Zend_Translate instead of changing your code afterwards.
    </para>

    <example id="zend.translate.using.example2">
        <title>Example of multi-lingual PHP code</title>
        <programlisting role="php"><![CDATA[<?php
require_once("Zend/Translate.php");

$translate = new Zend_Translate('gettext', '/my/path/source-de.mo', 'de');
$translate->addTranslation('//my/path/fr-source.mo', 'fr');

print $translate->_("Example")."\n";
print "=======\n";
print $translate->_("Here is line one")."\n";
printf($translate->_("Today is the %1\$s") . "\n", date("d.m.Y"));
print "\n";

$translate->setLocale('fr');
print $translate->_("Fix language here is line two") . "\n";]]>
        </programlisting>
    </example>

    <para>
        Now let's get a deeper look into what has been done and how to
        integrate Zend_Translate into your code.
    </para>

    <para>
        Create a new Translation object and define the base adapter:

        <programlisting role="php"><![CDATA[<?php
require_once("Zend/Translate.php");

$translate = new Zend_Translate('gettext', '/my/path/source-de.mo', 'de');]]>
        </programlisting>

        In this example we decided the
        <emphasis role="strong">Gettext Adapter</emphasis>.
        We place our file <emphasis role="strong">source-de.mo</emphasis>
        into the directory <emphasis role="strong">/my/path</emphasis>.
        The gettext file will have German translation included.
        And we also added another language source for French.
    </para>

    <para>
        The next step is to wrap all strings which are to be translated.
        The simplest approach is to have only simple strings or sentences
        like this:

        <programlisting role="php"><![CDATA[<?php
print $translate->_("Example")."\n";
print "=======\n";
print $translate->_("Here is line one")."\n";]]>
        </programlisting>

        Some strings do not needed to be translated.
        The seperating line is always a seperating line,
        even in other languages.
    </para>

    <para>
        Having data values integrated into a translation string is also
        supported through the use of embedded parameters.

        <programlisting role="php"><![CDATA[<?php
printf($translate->_("Today is the %1\$s") . "\n", date("d.m.Y"));]]>
        </programlisting>

        Instead of <code>print()</code>, use the <code>printf()</code>
        function and replace all parameters with <code>%1\$s</code> parts.
        The first is <code>%1\$s</code>, the second <code>%2\$s</code>,
        and so on. This way a translation can be done without knowing
        the exact value. In our example, the date is always the actual day,
        but the string can be translated without the knowledge of the actual
        day.
    </para>

    <para>
        Each string is identified in the translation storage by a message id.
        You can use message id's instead of strings in your code, like this:

        <programlisting role="php"><![CDATA[<?php
print $translate->_(1)."\n";
print "=======\n";
print $translate->_(2)."\n";]]>
        </programlisting>

        But doing this has several disadvantages:
    </para>

    <para>
        You can not see what your code should output just by viewing your code.
    </para>

    <para>
        Also you will get problems if some strings are not translated.
        You always must imagine how translation works.
        First Zend_Translate looks if the set language has a translation
        for the given message id or string.
        If no translation string has been found it refers to the next lower
        language as defined within Zend_Locale.
        So "<emphasis role="strong">de_AT</emphasis>" becomes
        "<emphasis role="strong">de</emphasis>" only.
        If there is no translation found for
        "<emphasis role="strong">de</emphasis>" either,
        then the original message is returned.
        This way you always have an output, in case the message translation
        does not exist in your message storage.
        Zend_Translate never throws an error or exception when translating
        strings.
    </para>

    <sect2 id="zend.translate.using.structure">

        <title>Translation Source Structures</title>

        <para>
            Your next step is to create the translation sources for the several
            languages to which you translate.
            Every adapter is created its own way as described here.
            But there are some general features that are relevant for all adapters.
        </para>

        <para>
            You should know where to store your translation source files.
            With Zend_Translate you are not bound to any restriction.
            The following structures are preferable:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    Single structured source
                </para>

                <programlisting><![CDATA[
/application
/languages
  lang.en
  lang.de
/library]]>
                </programlisting>

                <para>
                    Positive: All source files for every languages can be
                    found in one directory.  No splitting of related files.
                </para>
            </listitem>
            <listitem>
                <para>
                    Language structured source
                </para>

                <programlisting><![CDATA[
/application
/languages
  /en
    lang.en
    other.en
  /de
    lang.de
    other.de
/library]]>
                </programlisting>

                <para>
                    Positive: Every language is based in one directory.
                    Easy translation as only one directory has to be
                    translated by a language team.
                    Also the usage of multiple files is transparent.
                </para>
            </listitem>
            <listitem>
                <para>
                    Application structured source
                </para>

                <programlisting><![CDATA[
/application
  /languages
    lang.en
    lang.de
    other.en
    other.de]]>
                </programlisting>

                <para>
                    Positive: All source files for every languages can be
                    found in one directory.  No splitting of related files.
                </para>

                <para>
                    Negative: Having multiple files for the same language is
                    problematic.
                </para>
            </listitem>
            <listitem>
                <para>
                    Gettext structured source
                </para>

                <programlisting><![CDATA[
/languages
  /de
    /LC_MESSAGES
      lang.mo
      other.mo
  /en
    /LC_MESSAGES
      lang.mo
      other.mo]]>
                </programlisting>

                <para>
                    Positive: Old gettext sources can be used without changing
                    structure.
                </para>

                <para>
                    Negative: Having sub-sub directories may be confusing
                    for people who have not used gettext before.
                </para>
            </listitem>
            <listitem>
                <para>
                   File structured source
                </para>

                <programlisting><![CDATA[
/application
  /models
    mymodel.php
    mymodel.de
    mymodel.en
  /views
  /controllers
    mycontroller.de
/document_root
  /images
  /styles
  .htaccess
  index.php
  index.de
/library
  /Zend]]>
                </programlisting>
                <para>
                    Positive: Every file is related to its own translation
                    source.
                </para>

                <para>
                    Negative: Multiple small translation source files make
                    it harder to translate.
                    Also every file has to be added as translation source.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            Single structured and language structured source files are most
            usable for Zend_Translate.
        </para>

        <para>
            So now, that we know which structure we want to have,
            we should create our translation source files.
        </para>

    </sect2>

    <sect2 id="zend.translate.using.source.array">

        <title>Creating array source files</title>

        <para>
            Array source files are just arrays.  But you have to define them
            manually because there is no tool for this.
            But because they are so simple, it's the fastest way to look up
            messages if your code works as expected.  It's generally the best
            adapter to get started with translation business.
        </para>

        <programlisting role="php"><![CDATA[
$english = array('message1' => 'message1',
                 'message2' => 'message2',
                 'message3' => 'message3');
$german = array('message1' => 'Nachricht1',
                'message2' => 'Nachricht2',
                'message3' => 'Nachricht3');

$translate = new Zend_Translate('array', $english, 'en');
$translate->addTranslation($deutsch, 'de');]]>
        </programlisting>

        <para>
            Since Release 1.5 it is also supported to have arrays included within a external file.
            You just have to give the filename and <code>Zend_Translate</code> will automatically
            include it and look for the array. See the following example for details:
        </para>

        <programlisting role="php"><![CDATA[
// myarray.php
<?php
return array(
    'message1' => 'Nachricht1',
    'message2' => 'Nachricht2',
    'message3' => 'Nachricht3');

// controller
$translate = new Zend_Translate('array', 'path/to/myarray.php', 'de');]]>
        </programlisting>

        <note>
            <para>
                Files which do not return an array will fail to be included.
                Also any output within this file will be ignored and suppressed.
            </para>

        </note>

    </sect2>

    <sect2 id="zend.translate.using.source.gettext">

        <title>Creating Gettext Source Files</title>

        <para>
            Gettext source files are created by GNU's gettext library.
            There are several free tools available that can parse your
            code files and create the needed gettext source files.
            These files have the ending <emphasis role="strong">*.mo</emphasis>
            and they are binary files.
            One freeware tool for creating the files is
            <ulink url="http://sourceforge.net/projects/poedit/">poEdit</ulink>.
            This tool also supports you for the translation process itself.
        </para>

        <programlisting role="php"><![CDATA[
// We expect that we have created the mo files and translated them
$translate = new Zend_Translate('gettext', 'path/to/english.mo', 'en');
$translate->addTranslation('path/to/german.mo', 'de');]]>
        </programlisting>

        <para>
            As you can see the adapters are used exactly the same way,
            with only just one small difference.
            Change 'array' to 'gettext'.  All other usages are exactly
            the same as with all other adapters.
            With the gettext adapter you no longer have to be aware of
            gettext's standard directory structure,
            bindtextdomain and textdomain.
            Just give the path and filename to the adapter.
        </para>

        <note>
            <para>
                 You should always use UTF-8 as source encoding.
                 Otherwise you will have problems if you are using two
                 different source encodings.
                 For example, if one of your source files is encoded
                 with ISO-8815-11 and another file is encoded with CP815.
                 You can set only one encoding for your source file,
                 so one of your languages probably will not display correctly.
            </para>
            <para>
                 UTF-8 is a portable format which supports all languages.
                 If you use UTF-8 encoding for all languages, you eliminate
                 the problem of incompatible encodings.
            </para>
        </note>
    </sect2>

    <sect2 id="zend.translate.using.source.tmx">

        <title>Creating TMX Source Files</title>

        <para>
            TMX source files are a new industry standard.
            They have the advantage of being XML files and so they are
            readable by every editor and of course they are human-readable.
            You can either create TMX files manually with a text editor,
            or you can use a tool. But most tools currently available for
            developing TMX source files are not freeware.
        </para>

        <example id="zend.translate.using.source.tmx.example">
            <title>Example TMX file</title>
            <programlisting role="xml"><![CDATA[
<?xml version="1.0" ?>
<!DOCTYPE tmx SYSTEM "tmx14.dtd">
<tmx version="1.4">
 <header creationtoolversion="1.0.0" datatype="winres" segtype="sentence" adminlang="en-us" srclang="de-at" o-tmf="abc" creationtool="XYZTool" >
 </header>
 <body>
  <tu tuid='message1'>
   <tuv xml:lang="de"><seg>Nachricht1</seg></tuv>
   <tuv xml:lang="en"><seg>message1</seg></tuv>
  </tu>
  <tu tuid='message2'>
   <tuv xml:lang="en"><seg>message2</seg></tuv>
   <tuv xml:lang="de"><seg>Nachricht2</seg></tuv>
  </tu>]]>
            </programlisting>

            <programlisting role="php"><![CDATA[
$translate = new Zend_Translate('tmx', 'path/to/mytranslation.tmx', 'en');
// TMX can have several languages within one TMX file.]]>
            </programlisting>
        </example>

        <para>
            TMX files can have several languages within the same file.
            All other included languages are added automatically,
            so you do not have to call <code>addLanguage()</code>.
        </para>

        <para>
            If you want to have only spezified languages from the source translated
            you can set the option <code>defined_language</code> to <code>true</code>.
            With this option you can add the wished languages explicit with
            <code>addLanguage()</code>. The default value for this option is to add all
            languages.
        </para>
    </sect2>

    <sect2 id="zend.translate.using.source.csv">

        <title>Creating CSV Source Files</title>

        <para>
            CSV source files are small and human readable.
            If your customers want to translate their own,
            you will probably use the CSV adapter.
        </para>

        <example id="zend.translate.using.source.csv.example">
            <title>Example CSV file</title>
            <programlisting><![CDATA[
﻿#Example csv file
message1;Nachricht1
message2;Nachricht2]]>
            </programlisting>

            <programlisting role="php"><![CDATA[
$translate = new Zend_Translate('csv', 'path/to/mytranslation.csv', 'de');
$translate->addTranslation('path/to/other.csv', 'fr');]]>
            </programlisting>
        </example>

        <para>
            The standard separator for CSV string is the '<code>;</code>' sign.
            But it has not to be that sign. With the option '<code>separator</code>'
            you can decide to use another separator sign.
        </para>

        <para>
            If you have to have the separator sign within your translation string you
            just have to double it to be included within the translation. One separator
            sign will separate the origin and translation strings and two separator signs
            will write the separator signs within the string. See the following example
            for details
        </para>

        <example id="zend.translate.using.source.csv.example2">
            <title>Example CSV file two</title>
            <programlisting><![CDATA[
﻿#Example csv file
# original 'message,1'
message,,1,Nachricht1
# translation 'Nachricht,2'
message2,Nachricht,,2
# original 'message3,'
message3,,,Nachricht3]]>
            </programlisting>

            <programlisting role="php"><![CDATA[
$translate = new Zend_Translate('csv', 'path/to/mytranslation.csv', 'de', array('separator' => ','));
$translate->addTranslation('path/to/other.csv', 'fr');]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.translate.using.options">

        <title>Options for adapters</title>

        <para>
            Options can be used with all adapters. Of course the options are different for all adapters.
            You can set options when you create the adapter. Actually there is one option which is available
            to all adapters. '<code>clear</code>' decides if translation data shold be added to existing
            one or not. Standard behaviour is to add new translation data to existing one. But the
            translation data is only cleared for the selected language. So all other languages will not be
            touched.
        </para>

        <para>
            You can set options temporary when using <code>addTranslation($data, $locale, array $options = array())</code>.
            as third and optional parameter. And you can use the <code>setOptions()</code> function to
            set the options fix.
        </para>

        <example id="zend.translate.using.options.example">
            <title>Using translation options</title>
            <programlisting role="php"><![CDATA[
// define ':' as separator for the translation source files
$options = array('separator' => ':');
$translate = new Zend_Translate('csv', 'path/to/mytranslation.csv', 'de', $options);

...

// clear the defined language and use new translation data
$options = array('clear' => true);
$translate->addTranslation('path/to/new.csv', 'fr', $options);]]>
            </programlisting>
        </example>

        <para>
            Here you can find all available options for the different adapters with a description of their usage:
        </para>

        <table id="zend.translate.using.options.alloptions">
            <title>Options for Translation Adapters</title>
            <tgroup cols="4">
                <thead>
                    <row>
                        <entry>Adapter</entry>
                        <entry>Option</entry>
                        <entry>Standard value</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>all</entry>
                        <entry>clear</entry>
                        <entry><emphasis role="strong">false</emphasis></entry>
                        <entry>If set to true, the already read translations will be cleared. This can be used
                        instead of creating a new instance when reading new translation data</entry>
                    </row>
                    <row>
                        <entry>all</entry>
                        <entry>scan</entry>
                        <entry><emphasis role="strong">null</emphasis></entry>
                        <entry>If set to null, no scanning of the directory structure will be done.
                        If set to Zend_Translate::LOCALE_DIRECTORY the locale will be detected within the
                        directory. It set to Zend_Translate::LOCALE_FILENAME the locale will be detected
                        within the filename. See <xref linkend="zend.translate.using.detection" />
                        for details</entry>
                    </row>
                    <row>
                        <entry>Csv</entry>
                        <entry>separator</entry>
                        <entry><emphasis role="strong">;</emphasis></entry>
                        <entry>Defines which sign is used for seperating source and translation</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>
            When you want to have self defined options, you are also able to use them within all adapters.
            The <code>setOptions()</code> method can be used to define your option. <code>setOptions()</code>
            needs an array with the options you want to set. If an given option exists it will be signed over.
            You can define as much options as needed as they will not be checked by the adapter. Just get sure
            that you do not sign over any existing option which is used by an adapter.
        </para>

        <para>
            To return the set option you can use the <code>getOptions()</code> method. When <code>getOptions()</code>
            is called without an parameter it will return all set options. When the optional parameter is given
            you will only get the particular option returned.
        </para>

    </sect2>

    <sect2 id="zend.translate.using.languages">

        <title>Handling languages</title>

        <para>
            When working with different languages there are a few methods which will be useful.
        </para>

        <para>
            The <code>getLocale()</code> method can be used to get the actual set language. It can eigther hold
            an instance of <code>Zend_Locale</code> or the identifier of a locale.
        </para>

        <para>
            The <code>setLocale()</code> method sets a new standard language for translation. This prevents the
            need of setting the optional language parameter more than once to the <code>translate()</code> method.
            If the given language does not exist, or no translation data is available for the language,
            <code>setLocale()</code> tries to downgrade to the language without the region if any was given.
            A language of <code>en_US</code> would be downgraded to <code>en</code>. When also the downgraded
            language can not be found an exception will be thrown.
        </para>

        <para>
            The <code>isAvailable()</code> method checks if a given language is already available. It returns
            <code>true</code> if data for the given language exist.
        </para>

        <para>
            And finally the <code>getList()</code> method can be used to get all actual set languages for an adapter
            returned as array.
        </para>

        <example id="zend.translate.using.languages.example">
            <title>Handling languages with adapters</title>
            <programlisting role="php"><![CDATA[
...
// returns the actual set language
$actual = $translate->getLocale();

...
// you can use the optional parameter while translating
echo $translate->_("my_text", "fr");
// or set a new standard language
$translate->setLocale("fr");
echo $translate->_("my_text");
// refer to the base language... fr_CH will be downgraded to fr and be used
$translate->setLocale("fr_CH");
echo $translate->_("my_text");

...
// check if this language exist
if ($translate->isAvailable("fr")) {
    // language exists
}]]>
            </programlisting>
        </example>

        <sect3 id="zend.translate.using.languages.automatic">

            <title>Automatically handling of languages</title>

            <para>
                Note that as long as you only add new translation sources with the <code>addTranslation()</code>
                method <code>Zend_Translate</code> will automatically set the best fitting language for your
                environment. So normally you will not need to call <code>setLocale()</code>.
            </para>

            <para>
                The algorithmus will search for the best fitting locale depending on the users browser and
                your environment. See the following example for details:
            </para>

            <example id="zend.translate.using.languages.automatic.example">
                <title>How automatically language detection works</title>
                <programlisting role="php"><![CDATA[
// Let's expect the browser returns this language settings
HTTP_ACCEPT_LANGUAGE = "de_AT=1;fr=1;en_US=0.8";

// Example 1:
$translate = new Zend_Translate("gettext", "\my_it.mo", "it_IT");
$translate->addTranslation("\my_es.mo","es_UG");
// no fitting language found, return the messageid

// Example 2:
$translate = new Zend_Translate("gettext", "\my_en.mo", "en_US");
$translate->addTranslation("\my_it.mo","it_IT");
// best found fitting language is "en_US"

// Example 3:
$translate = new Zend_Translate("gettext", "\my_it.mo", "it_IT");
$translate->addTranslation("\my_de.mo","de");
// best found fitting language is "de" because "de_AT" will be degraded to "de"

// Example 4:
$translate = new Zend_Translate("gettext", "\my_it.mo", "it_IT");
$translate->addTranslation("\my_ru.mo","ru");
$translate->setLocale("it_IT");
$translate->addTranslation("\my_de.mo","de");
// returns "it_IT" as translation source]]>
                </programlisting>
            </example>

            <para>
                After setting a language manually with the <code>setLocale()</code> method the automatically
                detection will be switched off and overridden.
            </para>

            <para>
                If you want to use the automatic again, you can set the language
                <emphasis role="strong">auto</emphasis> with <code>setLocale()</code> which will reactivate
                the automatically detection for <code>Zend_Translate</code>.
            </para>

        </sect3>

    </sect2>

    <sect2 id="zend.translate.using.detection">

        <title>Automatic source detection</title>

        <para>
            Zend_Translate can detect translation sources automatically. So you don't have
            to declare each source file manually. You can let Zend_Translate do this job and
            scan the complete directory structure for source files. 
        </para>

        <note>
            <para>
                Automatic source detection is available since Zend Framework version 1.5 .
            </para>
        </note>

        <para>
            The usage is quite the same as initiating a single translation source with one difference.
            You must give a directory which has to be scanned instead a file.
        </para>

        <example id="zend.translate.using.languages.directory.example">
            <title>Scanning a directory structure for sources</title>
            <programlisting role="php"><![CDATA[
// expect we have the following structure
//  /language
//  /language/login/login.tmx
//  /language/logout/logout.tmx
//  /language/error/loginerror.tmx
//  /language/error/logouterror.tmx

$translate = new Zend_Translate('tmx', '/language');]]>
            </programlisting>
        </example>

        <para>
            So Zend_Translate does not only search the given directory, but also all subdirectories for
            translation source files. This makes the usage quite simple. But Zend_Translate will ignore all
            files which are not sources or which produce failures while reading the translation data. So you
            have to make sure that all of your translation sources are correct and readable because you will
            not get any failure if a file is bogus or can not be read.
        </para>

        <note>
            <para>
                Depending on how deep your directory structure is and how much files are within this structure
                it can take a long time for Zend_Translate to complete.
            </para>
        </note>

        <para>
            In our example we have used the TMX format which includes the language to be used within the
            source. But many of the other source formats are not able to include the language within the
            file. Even this sources can be used with automatic scanning if you do some pre-requisits as
            described below:
            scanned. 
        </para>

        <sect3 id="zend.translate.using.detection.directory">

            <title>Language through naming directories</title>

            <para>
                One way to include automatic language detection is to name the directories related to the
                language which is used for the sources within this directory. This is the easiest way and
                is used for example within standard gettext implementations.
            </para>

            <para>
                Zend_Translate needs the 'scan' option to know that it should search the names of all
                directories for languages. See the following example for details:
            </para>

            <example id="zend.translate.using.detection.directory.example">
                <title>Directory scanning for languages</title>
                <programlisting role="php"><![CDATA[
// expect we have the following structure
//  /language
//  /language/de/login/login.tmx
//  /language/de/error/loginerror.tmx
//  /language/en/login/login.tmx
//  /language/en/error/loginerror.tmx

$translate = new Zend_Translate('gettext', '/language', null, array('scan' => Zend_Translate::LOCALE_DIRECTORY));]]>
                </programlisting>
            </example>

            <note>
                <para>
                    This works only for adapters which do not include the language within the source file.
                    Using this option for example with TMX will be ignored. Also language definitions within
                    the filename will be ignored when using this option.
                </para>
            </note>

            <note>
                <para>
                    You should be aware if you have several subdirectories under the same
                    structure. Expect we have a structure like
                    <code>/language/module/de/en/file.mo</code>. The path contains in this case
                    multiple strings which would be detected as locale. It could be eigther
                    <code>de</code> or <code>en</code>. As the behaviour is, in this case,
                    not declared it is recommended that you use file detection in such situations.
                </para>
            </note>

        </sect3>

        <sect3 id="zend.translate.using.detection.filename">

            <title>Language through filenames</title>

            <para>
                Another way to detect the langage automatically is to use special filenames. You can either
                name the complete file or parts of a file with the used language. To use this way of detection
                you will have to set the 'scan' option at initiation. There are several ways of naming the
                sourcefiles which are described below:
            </para>

            <example id="zend.translate.using.detection.filename.example">
                <title>Filename scanning for languages</title>
                <programlisting role="php"><![CDATA[
// expect we have the following structure
//  /language
//  /language/login/login_en.tmx
//  /language/login/login_de.tmx
//  /language/error/loginerror_en.tmx
//  /language/error/loginerror_de.tmx

$translate = new Zend_Translate('gettext', '/language', null, array('scan' => Zend_Translate::LOCALE_FILENAME));]]>
                </programlisting>
            </example>

            <sect4 id="zend.translate.using.detection.filename.complete">

                <title>Complete Filename</title>

                <para>
                    Having the whole file named after the language is the simplest way but only usable
                    if you have only one file per directory.
                </para>

                <programlisting><![CDATA[
/languages
  en.mo
  de.mo
  es.mo]]>
                </programlisting>

            </sect4>

            <sect4 id="zend.translate.using.detection.filename.extension">

                <title>Extension of the file</title>

                <para>
                    Another very simple way if to use the extension of the file for the language detection.
                    But this may be confusing because you will no longer know which file extension the file
                    originally was.
                </para>

                <programlisting><![CDATA[
/languages
  view.en
  view.de
  view.es]]>
                </programlisting>

            </sect4>

            <sect4 id="zend.translate.using.detection.filename.token">

                <title>Filename tokens</title>

                <para>
                    Zend_Translate is also captable of detecting the language if it is included within the
                    filename. But if you use this way you will have to seperate the language with a token.
                    There are three supported tokens which can be used: A point '.', a underline '_', or
                    a hyphen '-'.
                </para>

                <programlisting><![CDATA[
/languages
  view_en.mo  -> detects english
  view_de.mo  -> detects german
  view_it.mo  -> detects italian]]>
                </programlisting>

                <para>
                    The first found token which can be detected as locale will be used. See the following
                    example for details.
                </para>

                <programlisting><![CDATA[
/languages
  view_en_de.mo  -> detects english
  view_en_es.mo  -> detects english and overwrites the first file because the same messageids are used
  view_it_it.mo  -> detects italian]]>
                </programlisting>

                <para>
                    All three tokens are used to detect the locale. The first one is the point '.', the second
                    is the underline '_' and the third the hyphen '-'. If you have several tokens within the
                    filename the first found depending on the order of the tokens will be used. See the following
                    example for details.
                </para>

                <programlisting><![CDATA[
/languages
  view_en-it.mo  -> detects english because '_' will be used before '-'
  view-en_it.mo  -> detects italian because '_' will be used before '-'
  view_en.it.mo  -> detects italian because '.' will be used before '_']]>
                </programlisting>

            </sect4>

        </sect3>

    </sect2>

    <sect2 id="zend.translate.using.istranslated">

        <title>Checking for translations</title>

        <para>
            Normally text will be translated without any computations. But sometimes it is necessary to
            know if a text is translated or not within the source. Therefor the <code>isTranslated()</code>
            method can be used.
        </para>

        <para>
            <code>isTranslated($messageId, $original = false, $locale = null)</code> takes as first parameter
            the text from which you want to know if it can be translated. And as optional third parameter the locale
            for which you want to know the translation. The optional second parameter declares if translation
            is fixed to the declared language or a lower set of translations can be used. If you have a text which
            can be translated by 'en' but not for 'en_US' you will normally get the translation returned, but by
            setting <code>$original</code> to true, the <code>isTranslated()</code> method will return false in
            such cases.
        </para>

        <example id="zend.translate.using.istranslated.example">
            <title>Checking if a text is translatable</title>
            <programlisting role="php"><![CDATA[
$english = array('message1' => 'Nachricht 1',
                 'message2' => 'Nachricht 2',
                 'message3' => 'Nachricht 3');
$translate = new Zend_Translate('array', $english, 'de_AT');

if ($translate->isTranslated('message1')) {
    print "'message1' can be translated";
}
if (!($translate->isTranslated('message1', true, 'de'))) {
    print "'message1' can not be translated in 'de' as it's only available in 'de_AT'";
}
if ($translate->isTranslated('message1', false, 'de')) {
    print "'message1' can be translated in 'de_AT' falls back to 'de'";
}]]>
            </programlisting>
        </example>

    </sect2>

    <sect2 id="zend.translate.using.sourcedata">

        <title>Access to the source data</title>

        <para>
            Of course sometimes it is useful to have access to the translation source data. Therefor two
            functions exist.
        </para>

        <para>
            The <code>getMessageIds($locale = null)</code> method returns all known message ids as array.
        </para>

        <para>
            And the <code>getMessages($locale = null)</code> method returns the complete translation source as
            array. The message id is used as key and the translation data as value.
        </para>

        <para>
            Both methods accept an optional parameter <code>$locale</code> which, when set, returns the
            translation data for the specified language. If this parameter is not given, the actual set
            language will be used. Keep in mind that normally all translations should be available in all
            languages. Which means that in a normal situation you will not have to set this parameter.
        </para>

        <para>
            Additionally the <code>getMessages()</code> method is able to return the complete
            translation dictionary with the pseudo-locale 'all'. This will return all available
            translation data for each added locale.
        </para>

        <note>
            <para>
                Attention: The returned array can be <emphasis role="strong">very big</emphasis>,
                depending on the count of added locales and the amount of translation data.
            </para>
        </note>

        <example id="zend.translate.using.sourcedata.example">
            <title>Handling languages with adapters</title>
            <programlisting role="php"><![CDATA[
...
// returns all known message ids
$messageids = $translate->getMessageIds();
print_r($messageids);

...
// or just for the specified language
$messageids = $translate->getMessageIds('en_US');
print_r($messageids);

...
// returns all the complete translation data
$source = $translate->getMessages();
print_r($source);]]>
            </programlisting>
        </example>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.uri.chapter">
  <title>Zend_Uri</title>

  <sect2 id="zend.uri.overview">
    <title>Overview</title>

    <para>
      <code>Zend_Uri</code> is a component that aids in manipulating and
      validating <ulink url="http://www.w3.org/Addressing/">Uniform Resource
      Identifiers</ulink> (URIs). <code>Zend_Uri</code> exists primarily to
      service other components such as <code>Zend_Http_Client</code> but is
      also useful as a standalone utility.
    </para>

    <para>
      URIs always begin with a scheme, followed by a colon. The construction
      of the many different schemes varies significantly.  The
      <code>Zend_Uri</code> class provides a factory that returns a subclass of
      itself which specializes in each scheme.  The subclass
      will be named <code>Zend_Uri_&lt;scheme&gt;</code>, where
      <code>&lt;scheme&gt;</code> is the scheme lowercased with the first
      letter capitalized. An exception to this rule is HTTPS, which is also
      handled by <code>Zend_Uri_Http</code>.
    </para>
  </sect2>

  <sect2 id="zend.uri.creation">
    <title>Creating a New URI</title>

    <para>
      <code>Zend_Uri</code> will build a new URI from scratch if only a scheme
      is passed to <code>Zend_Uri::factory()</code>.
    </para>

    <example id="zend.uri.creation.example-1">
      <title>Creating a New URI with <code>Zend_Uri::factory()</code></title>

      <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Uri.php';

// To create a new URI from scratch, pass only the scheme.
$uri = Zend_Uri::factory('http');

// $uri instanceof Zend_Uri_Http]]>
      </programlisting>
    </example>

    <para>
      To create a new URI from scratch, pass only the scheme to
      <code>Zend_Uri::factory()</code><footnote><para>At the time of writing,
      Zend_Uri only supports the HTTP and HTTPS schemes.</para></footnote> .
      If an unsupported scheme is passed, a <code>Zend_Uri_Exception</code>
      will be thrown.
    </para>

    <para>
      If the scheme or URI passed is supported,
      <code>Zend_Uri::factory()</code> will return a subclass of itself that
      specializes in the scheme to be created.
    </para>
  </sect2>

  <sect2 id="zend.uri.manipulation">
    <title>Manipulating an Existing URI</title>

    <para>
      To manipulate an existing URI, pass the entire URI to
      <code>Zend_Uri::factory()</code>.
    </para>

    <example id="zend.uri.manipulation.example-1">
      <title>Manipulating an Existing URI with <code>Zend_Uri::factory()</code></title>

      <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Uri.php';

// To manipulate an existing URI, pass it in.
$uri = Zend_Uri::factory('http://www.zend.com');

// $uri instanceof Zend_Uri_Http]]>
      </programlisting>
    </example>

    <para>
      The URI will be parsed and validated. If it is found to be invalid, a
      <code>Zend_Uri_Exception</code> will be thrown immediately. Otherwise,
      <code>Zend_Uri::factory()</code> will return a subclass of itself that
      specializes in the scheme to be manipulated.
    </para>
  </sect2>

  <sect2 id="zend.uri.validation">
    <title>URI Validation</title>

    <para>
      The <code>Zend_Uri::check()</code> function can be used if only
      validation of an existing URI is needed.
    </para>

    <example id="zend.uri.validation.example-1">
      <title>URI Validation with <code>Zend_Uri::check()</code></title>

      <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Uri.php';

// Validate whether a given URI is well formed
$valid = Zend_Uri::check('http://uri.in.question');

// $valid is TRUE for a valid URI, or FALSE otherwise.]]>
      </programlisting>
    </example>

    <para>
      <code>Zend_Uri::check()</code> returns a boolean,
      which is more convenient than using <code>Zend_Uri::factory()</code>
      and catching the exception.
    </para>
  </sect2>

  <sect2 id="zend.uri.instance-methods">
    <title>Common Instance Methods</title>

    <para>
      Every instance of a <code>Zend_Uri</code> subclass (e.g.
      <code>Zend_Uri_Http</code>) has several instance methods that are useful
      for working with any kind of URI.
    </para>

    <sect3 id="zend.uri.instance-methods.getscheme">
      <title>Getting the Scheme of the URI</title>

      <para>
        The scheme of the URI is the part of the URI that precedes the colon.  For example,
        the scheme of <code>http://www.zend.com</code> is <code>http</code>.
      </para>

      <example id="zend.uri.instance-methods.getscheme.example-1">
        <title>Getting the Scheme from a <code>Zend_Uri_*</code> Object</title>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Uri.php';

$uri = Zend_Uri::factory('http://www.zend.com');

$scheme = $uri->getScheme();  // "http"]]>
        </programlisting>
      </example>

      <para>
        The <code>getScheme()</code> instance method returns only the scheme part of
        the URI object.
      </para>

    </sect3>

    <sect3 id="zend.uri.instance-methods.geturi">
      <title>Getting the Entire URI</title>

      <example id="zend.uri.instance-methods.geturi.example-1">
        <title>Getting the Entire URI from a <code>Zend_Uri_*</code> Object</title>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Uri.php';

$uri = Zend_Uri::factory('http://www.zend.com');

echo $uri->getUri();  // "http://www.zend.com"]]>
        </programlisting>
      </example>

      <para>
        The <code>getUri()</code> method returns the string representation
        of the entire URI.
      </para>
    </sect3>

    <sect3 id="zend.uri.instance-methods.valid">
      <title>Validating the URI</title>

      <para>
        <code>Zend_Uri::factory()</code> will always validate any URI passed
        to it and will not instantiate a new <code>Zend_Uri</code> subclass
        if the given URI is found to be invalid. However, after the
        <code>Zend_Uri</code> subclass is instantiated for a new URI or a
        valid existing one, it is possible that the URI can then later become
        invalid after it is manipulated.
      </para>

      <example id="zend.uri.instance-methods.valid.example-1">
        <title>Validating a <code>Zend_Uri_*</code> Object</title>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Uri.php';

$uri = Zend_Uri::factory('http://www.zend.com');

$isValid = $uri->valid();  // TRUE]]>
        </programlisting>
      </example>

      <para>
        The <code>valid()</code> instance method provides a means to check that the
        URI object is still valid.
      </para>
    </sect3>

  </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect2 id="zend.validate.set.email_address">

    <title>EmailAddress</title>

    <para>
        <code>Zend_Validate_EmailAddress</code> allows you to validate an email address. The validator first splits
        the email address on local-part @ hostname and attempts to match these against known specifications for email
        addresses and hostnames.
    </para>

    <para>
        <emphasis role="strong">Basic usage</emphasis>
    </para>

    <para>
        A basic example of usage is below:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/EmailAddress.php';
$validator = new Zend_Validate_EmailAddress();
if ($validator->isValid($email)) {
    // email appears to be valid
} else {
    // email is invalid; print the reasons
    foreach ($validator->getMessages() as $message) {
        echo "$message\n";
    }
}]]>
        </programlisting>

        This will match the email address <code>$email</code> and on failure populate
        <code>$validator->getMessages()</code> with useful error messages.
    </para>

    <para>
        <emphasis role="strong">Complex local parts</emphasis>
    </para>

    <para>
        <code>Zend_Validate_EmailAddress</code> will match any valid email address according to RFC2822. For example,
        valid emails include <code>bob@domain.com</code>, <code>bob+jones@domain.us</code>,
        <code>"bob@jones"@domain.com</code> and <code>"bob jones"@domain.com</code>
    </para>

    <para>
        Some obsolete email formats will not currently validate (e.g. carriage returns or a
        "\" character in an email address).
    </para>

    <para>
        <emphasis role="strong">Validating different types of hostnames</emphasis>
    </para>

    <para>
        The hostname part of an email address is validated against
        <link linkend="zend.validate.set.hostname"><code>Zend_Validate_Hostname</code></link>. By default
        only DNS hostnames of the form <code>domain.com</code> are accepted, though if you wish you
        can accept IP addresses and Local hostnames too.
    </para>

    <para>
        To do this you need to instantiate <code>Zend_Validate_EmailAddress</code> passing a parameter to indicate
        the type of hostnames you want to accept. More details are included in <code>Zend_Validate_Hostname</code>,
        though an example of how to accept both DNS and Local hostnames appears below:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/EmailAddress.php';
$validator = new Zend_Validate_EmailAddress(Zend_Validate_Hostname::ALLOW_DNS | Zend_Validate_Hostname::ALLOW_LOCAL);
if ($validator->isValid($email)) {
    // email appears to be valid
} else {
    // email is invalid; print the reasons
    foreach ($validator->getMessages() as $message) {
        echo "$message\n";
    }
}]]>
        </programlisting>
    </para>

    <para>
        <emphasis role="strong">Checking if the hostname actually accepts email</emphasis>
    </para>

    <para>
        Just because an email address is in the correct format, it doesn't necessarily mean that
        email address actually exists. To help solve this problem, you can use MX validation to
        check whether an MX (email) entry exists in the DNS record for the email's hostname.
        This tells you that the hostname accepts email, but doesn't tell you the exact email
        address itself is valid.
    </para>

    <para>
        MX checking is not enabled by default and at this time is only supported by UNIX platforms.
        To enable MX checking you can pass a second parameter to the <code>Zend_Validate_EmailAddress</code>
        constructor.

        <programlisting role="php"><![CDATA[<?php
$validator = new Zend_Validate_EmailAddress(Zend_Validate_Hostname::ALLOW_DNS, true);]]>
        </programlisting>

        Alternatively you can either pass <code>true</code> or <code>false</code> to
        <code>$validator->setValidateMx()</code> to enable or disable MX validation.
    </para>

    <para>
        By enabling this setting network functions will be used to check for the presence of an
        MX record on the hostname of the email address you wish to validate. Please be aware
        this will likely slow your script down.
    </para>

    <para>
        <emphasis role="strong">Validating International Domains Names</emphasis>
    </para>

    <para>
        <code>Zend_Validate_EmailAddress</code> will also match international characters that exist in some domains.
        This is known as International Domain Name (IDN) support. This is enabled by default, though
        you can disable this by changing the setting via the internal <code>Zend_Validate_Hostname</code> object
        that exists within <code>Zend_Validate_EmailAddress</code>.

        <programlisting role="php"><![CDATA[<?php
$validator->hostnameValidator->setValidateIdn(false);]]>
        </programlisting>

        More information on the usage of <code>setValidateIdn()</code> appears in the
        <code>Zend_Validate_Hostname</code> documentation.
    </para>

    <para>
        Please note IDNs are only validated if you allow DNS hostnames to be validated.
    </para>

    <para>
        <emphasis role="strong">Validating Top Level Domains</emphasis>
    </para>

    <para>
        By default a hostname will be checked against a list of known TLDs. This is enabled by
        default, though you can disable this by changing the setting via the internal
        <code>Zend_Validate_Hostname</code> object that exists within <code>Zend_Validate_EmailAddress</code>.

        <programlisting role="php"><![CDATA[<?php
$validator->hostnameValidator->setValidateTld(false);]]>
        </programlisting>

        More information on the usage of <code>setValidateTld()</code> appears in the
        <code>Zend_Validate_Hostname</code> documentation.
    </para>

    <para>
        Please note TLDs are only validated if you allow DNS hostnames to be validated.
    </para>

</sect2>
<!--
vim:se ts=4 sw=4 et:
-->
<sect2 id="zend.validate.set.hostname">

    <title>Hostname</title>

    <para>
        Zend_Validate_Hostname allows you to validate a hostname against a set of known specifications.
        It is possible to check for three different types of hostnames: a DNS Hostname (i.e.
        domain.com), IP address (i.e. 1.2.3.4), and Local hostnames (i.e. localhost). By default only
        DNS hostnames are matched.
    </para>

    <para>
        <emphasis role="strong">Basic usage</emphasis>
    </para>

    <para>
        A basic example of usage is below:

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/Hostname.php';
$validator = new Zend_Validate_Hostname();
if ($validator->isValid($hostname)) {
    // hostname appears to be valid
} else {
    // hostname is invalid; print the reasons
    foreach ($validator->getMessages() as $message) {
        echo "$message\n";
    }
}]]>
        </programlisting>

        This will match the hostname <code>$hostname</code> and on failure populate
        <code>$validator->getMessages()</code> with useful error messages.

    </para>

    <para>
        <emphasis role="strong">Validating different types of hostnames</emphasis>
    </para>

    <para>
        You may find you also want to match IP addresses, Local hostnames, or a combination of all
        allowed types. This can be done by passing a parameter to Zend_Validate_Hostname when you
        instantiate it. The paramter should be an integer which determines what types of hostnames
        are allowed. You are encouraged to use the Zend_Validate_Hostname constants to do this.
    </para>

    <para>
        The Zend_Validate_Hostname constants are: <code>ALLOW_DNS</code> to allow only DNS hostnames,
        <code>ALLOW_IP</code> to allow IP addresses, <code>ALLOW_LOCAL</code> to allow local network
        names, and <code>ALLOW_ALL</code> to allow all three types. To just check for IP addresses
        you can use the example below:
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/Hostname.php';
$validator = new Zend_Validate_Hostname(Zend_Validate_Hostname::ALLOW_IP);
if ($validator->isValid($hostname)) {
    // hostname appears to be valid
} else {
    // hostname is invalid; print the reasons
    foreach ($validator->getMessages() as $message) {
        echo "$message\n";
    }
}]]>
        </programlisting>
    </para>

    <para>
        As well as using <code>ALLOW_ALL</code> to accept all hostnames types you can combine
        these types to allow for combinations. For example, to accept DNS and Local hostnames
        instantiate your Zend_Validate_Hostname object as so:
        <programlisting role="php"><![CDATA[<?php
$validator = new Zend_Validate_Hostname(Zend_Validate_Hostname::ALLOW_DNS | Zend_Validate_Hostname::ALLOW_IP);]]>
        </programlisting>

    </para>

    <para>
        <emphasis role="strong">Validating International Domains Names</emphasis>
    </para>

    <para>
        Some Country Code Top Level Domains (ccTLDs), such as 'de' (Germany), support international
        characters in domain names. These are known as International Domain Names (IDN). These domains
        can be matched by Zend_Validate_Hostname via extended characters that are used in the validation
        process.
    </para>
    
    <para>
        At present the list of supported ccTLDs include:
   
        <itemizedlist>
                <listitem>
                    <para>at (Austria)</para>
                </listitem>
                <listitem>
                    <para>ch (Switzerland)</para>
                </listitem>
                <listitem>
                    <para>li (Liechtenstein)</para>
                </listitem>
                <listitem>
                    <para>de (Germany)</para>
                </listitem>
                <listitem>
                    <para>fi (Finland)</para>
                </listitem>
                <listitem>
                    <para>hu (Hungary)</para>
                </listitem>
                <listitem>
                    <para>no (Norway)</para>
                </listitem>
                <listitem>
                    <para>se (Sweden)</para>
                </listitem>
        </itemizedlist>
    
    </para>
    
    <para>
        To match an IDN domain it's as simple as just using the standard Hostname validator since IDN
        matching is enabled by default. If you wish to disable IDN validation this can be done by
        by either passing a parameter to the Zend_Validate_Hostname constructor or via the
        <code>$validator->setValidateIdn()</code> method.
    </para>
    
    <para>
        You can disable IDN validation by passing a second parameter to the Zend_Validate_Hostname
        constructor in the following way.

        <programlisting role="php"><![CDATA[<?php
$validator = new Zend_Validate_Hostname(Zend_Validate_Hostname::ALLOW_DNS, false);]]>
        </programlisting>

        Alternatively you can either pass TRUE or FALSE to
        <code>$validator->setValidateIdn()</code> to enable or disable IDN validation.

        If you are trying to match an IDN hostname which isn't currently supported it is likely
        it will fail validation if it has any international characters in it. Where a ccTLD file
        doesn't exist in Zend/Validate/Hostname specifying the additional characters a normal
        hostname validation is performed.
    </para>
    
    <para>
        Please note IDNs are only validated if you allow DNS hostnames to be validated.
    </para>

    <para>
        <emphasis role="strong">Validating Top Level Domains</emphasis>
    </para>

    <para>
        By default a hostname will be checked against a list of known TLDs. If this functionality
        is not required it can be disabled in much the same way as disabling IDN support.
        You can disable TLD validation by passing a third parameter to the Zend_Validate_Hostname constructor.
        In the example below we are supporting IDN validation via the second parameter.

        <programlisting role="php"><![CDATA[<?php
$validator = new Zend_Validate_Hostname(Zend_Validate_Hostname::ALLOW_DNS, true, false);]]>
        </programlisting>

        Alternatively you can either pass TRUE or FALSE to
        <code>$validator->setValidateTld()</code> to enable or disable TLD validation.
    </para>
    
    <para>
        Please note TLDs are only validated if you allow DNS hostnames to be validated.
    </para>

</sect2>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.validate.set" xmlns:xi="http://www.w3.org/2001/XInclude">

    <title>Standard Validation Classes</title>

    <para>
        The Zend Framework comes with a standard set of validation classes, which are ready for you to use.
    </para>

    <sect2 id="zend.validate.set.alnum">
        <title>Alnum</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> contains only alphabetic and digit characters.
            This validator includes an option to also consider white space characters as valid.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.alpha">
        <title>Alpha</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> contains only alphabetic characters. This
            validator includes an option to also consider white space characters as valid.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.barcode">
        <title>Barcode</title>
        <para>
            This validator is instantiated with a barcode type against which you wish to validate a barcode value.
            It currently supports "<code>UPC-A</code>" (Universal Product Code) and "<code>EAN-13</code>" (European
            Article Number) barcode types, and the <code>isValid()</code> method returns true if and only if the input
            successfully validates against the barcode validation algorithm. You should remove all characters other
            than the digits zero through nine (0-9) from the input value before passing it on to the validator.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.between">
        <title>Between</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> is between the minimum and maximum boundary
            values. The comparison is inclusive by default (<code>$value</code> may equal a boundary value), though
            this may be overridden in order to do a strict comparison, where <code>$value</code> must be strictly
            greater than the minimum and strictly less than the maximum.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.ccnum">
        <title>Ccnum</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> follows the Luhn algorithm (mod-10 checksum)
            for credit card numbers.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.date">
        <title>Date</title>
        <para>
            Returns <code>true</code> if <code>$value</code> is a valid date of the format <code>YYYY-MM-DD</code>.
            If the optional <code>locale</code> option is set then the date will be validated according to the
            set locale. And if the optional <code>format</code> option is set this format is used for the
            validation. For details about the optional parameters see
            <link linkend="zend.date.others.comparison.table">Zend_Date::isDate()</link>.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.digits">
        <title>Digits</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> only contains digit characters.
        </para>
    </sect2>

    <xi:include href="Zend_Validate-EmailAddress.xml" />

    <sect2 id="zend.validate.set.float">
        <title>Float</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> is a floating-point value.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.greater_than">
        <title>GreaterThan</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> is greater than the minimum boundary.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.hex">
        <title>Hex</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> contains only hexadecimal digit characters.
        </para>
    </sect2>

    <xi:include href="Zend_Validate-Hostname.xml" />

    <sect2 id="zend.validate.set.in_array">
        <title>InArray</title>
        <para>
            Returns <code>true</code> if and only if a "needle" <code>$value</code> is contained in a "haystack"
            array. If the strict option is <code>true</code>, then the type of <code>$value</code> is also checked.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.int">
        <title>Int</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> is a valid integer.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.ip">
        <title>Ip</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> is a valid IP address.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.less_than">
        <title>LessThan</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> is less than the maximum boundary.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.not_empty">
        <title>NotEmpty</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> is not an empty value.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.regex">
        <title>Regex</title>
        <para>
            Returns <code>true</code> if and only if <code>$value</code> matches against a regular expression
            pattern.
        </para>
    </sect2>

    <sect2 id="zend.validate.set.string_length">
        <title>StringLength</title>
        <para>
            Returns <code>true</code> if and only if the string length of <code>$value</code> is at least a minimum
            and no greater than a maximum (when the max option is not <code>null</code>). Since version 1.5.0, the
            <code>setMin()</code> method throws an exception if the minimum length is set to a value greater than the
            set maximum length, and the <code>setMax()</code> method throws an exception if the maximum length is set
            to a value less than than the set minimum length. Since version 1.0.2, this class supports UTF-8 and other
            character encodings, based on the current value of
            <ulink url="http://www.php.net/manual/en/ref.iconv.php#iconv.configuration"><code>iconv.internal_encoding</code></ulink>.
        </para>
    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect1 id="zend.validate.validator_chains">

    <title>Validator Chains</title>

    <para>
        Often multiple validations should be applied to some value in a particular order. The following code
        demonstrates a way to solve the example from the
        <link linkend="zend.validate.introduction">introduction</link>, where a username must be between 6 and
        12 alphanumeric characters:

        <programlisting role="php"><![CDATA[<?php
// Provides validator chaining capability
require_once 'Zend/Validate.php';

// Validators needed for the example
require_once 'Zend/Validate/StringLength.php';
require_once 'Zend/Validate/Alnum.php';

// Create a validator chain and add validators to it
$validatorChain = new Zend_Validate();
$validatorChain->addValidator(new Zend_Validate_StringLength(6, 12))
               ->addValidator(new Zend_Validate_Alnum());

// Validate the username
if ($validatorChain->isValid($username)) {
    // username passed validation
} else {
    // username failed validation; print reasons
    foreach ($validatorChain->getMessages() as $message) {
        echo "$message\n";
    }
}]]>
        </programlisting>

        Validators are run in the order they were added to <code>Zend_Validate</code>. In the above example,
        the username is first checked to ensure that its length is between 6 and 12 characters, and then it is
        checked to ensure that it contains only alphanumeric characters. The second validation, for
        alphanumeric characters, is performed regardless of whether the first validation, for length between 6
        and 12 characters, succeeds. This means that if both validations fail, <code>getMessages()</code> will
        return failure messages from both validators.
    </para>

    <para>
        In some cases it makes sense to have a validator break the chain if its validation process
        fails. <code>Zend_Validate</code> supports such use cases with the second parameter to the
        <code>addValidator()</code> method. By setting <code>$breakChainOnFailure</code> to <code>true</code>,
        the added validator will break the chain execution upon failure, which avoids running any other
        validations that are determined to be unnecessary or inappropriate for the situation. If the above
        example were written as follows, then the alphanumeric validation would not occur if the string length
        validation fails:

        <programlisting role="php"><![CDATA[<?php
$validatorChain->addValidator(new Zend_Validate_StringLength(6, 12), true)
        ->addValidator(new Zend_Validate_Alnum());]]>
        </programlisting>

    </para>

    <para>
        Any object that implements <code>Zend_Validate_Interface</code> may be used in a validator chain.
    </para>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.validate.writing_validators">

    <title>Writing Validators</title>

    <para>
        Zend_Validate supplies a set of commonly needed validators, but inevitably, developers will wish to
        write custom validators for their particular needs. The task of writing a custom validator is
        described in this section.
    </para>

    <para>
        <code>Zend_Validate_Interface</code> defines three methods, <code>isValid()</code>,
        <code>getMessages()</code>, and <code>getErrors()</code>, that may be implemented by user classes in order to
        create custom validation objects. An object that implements <code>Zend_Validate_Interface</code> interface
        may be added to a validator chain with <code>Zend_Validate::addValidator()</code>. Such objects may also be
        used with <link linkend="zend.filter.input"><code>Zend_Filter_Input</code></link>.
    </para>

    <para>
        As you may already have inferred from the above description of <code>Zend_Validate_Interface</code>,
        validation classes provided with Zend Framework return a boolean value for whether or not a value validates
        successfully. They also provide information about <emphasis role="bold">why</emphasis> a value failed
        validation. The availability of the reasons for validation failures may be valuable to an application for
        various purposes, such as providing statistics for usability analysis.
    </para>

    <para>
        Basic validation failure message functionality is implemented in <code>Zend_Validate_Abstract</code>. To
        include this functionality when creating a validation class, simply extend
        <code>Zend_Validate_Abstract</code>. In the extending class you would implement the
        <code>isValid()</code> method logic and define the message variables and message templates that correspond to
        the types of validation failures that can occur. If a value fails your validation tests, then
        <code>isValid()</code> should return <code>false</code>. If the value passes your validation tests, then
        <code>isValid()</code> should return <code>true</code>.
    </para>

    <para>
        In general, the <code>isValid()</code> method should not throw any exceptions, except where it is impossible
        to determine whether or not the input value is valid. A few examples of reasonable cases for throwing an
        exception might be if a file cannot be opened, an LDAP server could not be contacted, or a database
        connection is unavailable, where such a thing may be required for validation success or failure to be
        determined.
    </para>

    <example id="zend.validate.writing_validators.example.simple">

        <title>Creating a Simple Validation Class</title>

        <para>
            The following example demonstrates how a very simple custom validator might be written. In this case the
            validation rules are simply that the input value must be a floating point value.

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/Abstract.php';

class MyValid_Float extends Zend_Validate_Abstract
{
    const FLOAT = 'float';

    protected $_messageTemplates = array(
        self::FLOAT => "'%value%' is not a floating point value"
    );

    public function isValid($value)
    {
        $this->_setValue($value);

        if (!is_float($value)) {
            $this->_error();
            return false;
        }

        return true;
    }
}]]>
            </programlisting>

            The class defines a template for its single validation failure message, which includes the built-in magic
            parameter, <code>%value%</code>. The call to <code>_setValue()</code> prepares the object to insert the
            tested value into the failure message automatically, should the value fail validation. The call to
            <code>_error()</code> tracks a reason for validation failure. Since this class only defines one failure
            message, it is not necessary to provide <code>_error()</code> with the name of the failure message
            template.
        </para>

    </example>

    <example id="zend.validate.writing_validators.example.conditions.dependent">

        <title>Writing a Validation Class having Dependent Conditions</title>

        <para>
            The following example demonstrates a more complex set of validation rules, where it is required that the
            input value be numeric and within the range of minimum and maximum boundary values. An input value would
            fail validation for exactly one of the following reasons:

            <itemizedlist>
                <listitem>
                    <para>The input value is not numeric.</para>
                </listitem>
                <listitem>
                    <para>The input value is less than the minimum allowed value.</para>
                </listitem>
                <listitem>
                    <para>The input value is more than the maximum allowed value.</para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            These validation failure reasons are then translated to definitions in the class:

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/Abstract.php';

class MyValid_NumericBetween extends Zend_Validate_Abstract
{
    const MSG_NUMERIC = 'msgNumeric';
    const MSG_MINIMUM = 'msgMinimum';
    const MSG_MAXIMUM = 'msgMaximum';

    public $minimum = 0;
    public $maximum = 100;

    protected $_messageVariables = array(
        'min' => 'minimum',
        'max' => 'maximum'
    );

    protected $_messageTemplates = array(
        self::MSG_NUMERIC => "'%value%' is not numeric",
        self::MSG_MINIMUM => "'%value%' must be at least '%min%'",
        self::MSG_MAXIMUM => "'%value%' must be no more than '%max%'"
    );

    public function isValid($value)
    {
        $this->_setValue($value);

        if (!is_numeric($value)) {
            $this->_error(self::MSG_NUMERIC);
            return false;
        }

        if ($value < $this->minimum) {
            $this->_error(self::MSG_MINIMUM);
            return false;
        }

        if ($value > $this->maximum) {
            $this->_error(self::MSG_MAXIMUM);
            return false;
        }

        return true;
    }
}]]>
            </programlisting>

            The public properties <code>$minimum</code> and <code>$maximum</code> have been established to provide
            the minimum and maximum boundaries, respectively, for a value to successfully validate. The class also
            defines two message variables that correspond to the public properties and allow <code>min</code> and
            <code>max</code> to be used in message templates as magic parameters, just as with <code>value</code>.
        </para>

        <para>
            Note that if any one of the validation checks in <code>isValid()</code> fails, an appropriate failure
            message is prepared, and the method immediately returns <code>false</code>. These validation rules are
            therefore sequentially dependent. That is, if one test should fail, there is no need to test any
            subsequent validation rules. This need not be the case, however. The following example illustrates how to
            write a class having independent validation rules, where the validation object may return multiple
            reasons why a particular validation attempt failed.
        </para>

    </example>

    <example id="zend.validate.writing_validators.example.conditions.independent">

        <title>Validation with Independent Conditions, Multiple Reasons for Failure</title>

        <para>
            Consider writing a validation class for password strength enforcement - when a user is required to choose
            a password that meets certain criteria for helping secure user accounts. Let us assume that the password
            security criteria enforce that the password:

            <itemizedlist>
                <listitem>
                    <para>is at least 8 characters in length,</para>
                </listitem>
                <listitem>
                    <para>contains at least one uppercase letter,</para>
                </listitem>
                <listitem>
                    <para>contains at least one lowercase letter,</para>
                </listitem>
                <listitem>
                    <para>and contains at least one digit character.</para>
                </listitem>
            </itemizedlist>
        </para>

        <para>
            The following class implements these validation criteria:

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/Abstract.php';

class MyValid_PasswordStrength extends Zend_Validate_Abstract
{
    const LENGTH = 'length';
    const UPPER  = 'upper';
    const LOWER  = 'lower';
    const DIGIT  = 'digit';

    protected $_messageTemplates = array(
        self::LENGTH => "'%value%' must be at least 8 characters in length",
        self::UPPER  => "'%value%' must contain at least one uppercase letter",
        self::LOWER  => "'%value%' must contain at least one lowercase letter",
        self::DIGIT  => "'%value%' must contain at least one digit character"
    );

    public function isValid($value)
    {
        $this->_setValue($value);

        $isValid = true;

        if (strlen($value) < 8) {
            $this->_error(self::LENGTH);
            $isValid = false;
        }

        if (!preg_match('/[A-Z]/', $value)) {
            $this->_error(self::UPPER);
            $isValid = false;
        }

        if (!preg_match('/[a-z]/', $value)) {
            $this->_error(self::LOWER);
            $isValid = false;
        }

        if (!preg_match('/\d/', $value)) {
            $this->_error(self::DIGIT);
            $isValid = false;
        }

        return $isValid;
    }
}]]>
            </programlisting>

            Note that the four criteria tests in <code>isValid()</code> do not immediately return <code>false</code>.
            This allows the validation class to provide <emphasis role="bold">all</emphasis> of the reasons that the
            input password failed to meet the validation requirements. If, for example, a user were to input the
            string "<code>#$%</code>" as a password, <code>isValid()</code> would cause all four validation failure
            messages to be returned by a subsequent call to <code>getMessages()</code>.
        </para>

    </example>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.validate.introduction">

    <title>Introduction</title>

    <para>
        The Zend_Validate component provides a set of commonly needed
        validators. It also provides a simple validator chaining mechanism by
        which multiple validators may be applied to a single datum in a
        user-defined order.
    </para>

    <sect2 id="zend.validate.introduction.definition">

        <title>What is a validator?</title>

        <para>
            A validator examines its input with respect to some requirements
            and produces a boolean result - whether the input successfully
            validates against the requirements. If the input does not meet the
            requirements, a validator may additionally provide information
            about which requirement(s) the input does not meet.
        </para>

        <para>
            For example, a web application might require that a username be
            between six and twelve characters in length and may only contain
            alphanumeric characters. A validator can be used for ensuring that
            usernames meet these requirements. If a chosen username does not
            meet one or both of the requirements, it would be useful to know
            which of the requirements the username fails to meet.
        </para>

    </sect2>

    <sect2 id="zend.validate.introduction.using">

        <title>Basic usage of validators</title>

        <para>
            Having defined validation in this way provides the foundation for
            <code>Zend_Validate_Interface</code>, which defines two methods,
            <code>isValid()</code> and <code>getMessages()</code>. The
            <code>isValid()</code> method performs validation upon the provided
            value, returning <code>true</code> if and only if the value passes
            against the validation criteria.
        </para>

        <para>
            If <code>isValid()</code> returns <code>false</code>, the
            <code>getMessages()</code> returns an array of messages explaining
            the reason(s) for validation failure. The array keys are short
            strings that identify the reasons for validation failure, and the
            array values are the corresponding human-readable string messages.
            The keys and values are class-dependent; each validation class
            defines its own set of validation failure messages and the unique
            keys that identify them. Each class also has a <code>const</code>
            definition that matches each identifier for a validation failure
            cause.
        </para>

        <note>
            <para>
                The <code>getMessages()</code> methods return validation
                failure information only for the most recent
                <code>isValid()</code> call.  Each call to
                <code>isValid()</code> clears any messages and errors caused by
                a previous <code>isValid()</code> call, because it's likely
                that each call to <code>isValid()</code> is made for a
                different input value.
            </para>
        </note>

        <para>
            The following example illustrates validation of an e-mail address:

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/EmailAddress.php';

$validator = new Zend_Validate_EmailAddress();

if ($validator->isValid($email)) {
    // email appears to be valid
} else {
    // email is invalid; print the reasons
    foreach ($validator->getMessages() as $messageId => $message) {
        echo "Validation failure '$messageId': $message\n";
    }
}]]>
            </programlisting>

        </para>

    </sect2>

    <sect2 id="zend.validate.introduction.messages">

        <title>Customizing messages</title>

        <para>
            Validate classes provide a <code>setMessage()</code> method with
            which you can specify the format of a message returned by
            <code>getMessages()</code> in case of validation failure.  The
            first argument of this method is a string containing the error
            message.  You can include tokens in this string which will be
            substituted with data relevant to the validator.  The token
            <code>%value%</code> is supported by all validators; this is
            substituted with the value you passed to <code>isValid()</code>.
            Other tokens may be supported on a case-by-case basis in each
            validation class.  For example, <code>%max%</code> is a token
            supported by <code>Zend_Validate_LessThan</code>.
            The <code>getMessageVariables()</code> method returns an array
            of variable tokens supported by the validator.
        </para>

        <para>
            The second optional argument is a string that identifies the
            validation failure message template to be set, which is useful when
            a validation class defines more than one cause for failure. If you
            omit the second argument, <code>setMessage()</code> assumes the
            message you specify should be used for the first message template
            declared in the validation class. Many validation classes only have
            one error message template defined, so there is no need to specify
            which message template you are changing.
        </para>

        <para>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/StringLength.php';

$validator = new Zend_Validate_StringLength(8);

$validator->setMessage(
    'The string \'%value%\' is too short; it must be at least %min% characters',
    Zend_Validate_StringLength::TOO_SHORT);

if (!$validator->isValid('word')) {
    $messages = $validator->getMessages();
    echo current($messages);

    // echoes "The string 'word' is too short; it must be at least 8 characters"
}]]>
            </programlisting>
        </para>

        <para>
            You can set multiple messages using the <code>setMessages()</code>
            method.  Its argument is an array containing key/message pairs.

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/StringLength.php';

$validator = new Zend_Validate_StringLength(8, 12);

$validator->setMessages( array(
    Zend_Validate_StringLength::TOO_SHORT => 'The string \'%value%\' is too short',
    Zend_Validate_StringLength::TOO_LONG  => 'The string \'%value%\' is too long'
));]]>
            </programlisting>

        </para>

        <para>
            If your application requires even greater flexibility with which it
            reports validation failures, you can access properties by the same
            name as the message tokens supported by a given validation class.
            The <code>value</code> property is always available in a validator;
            it is the value you specified as the argument of
            <code>isValid()</code>.  Other properties may be supported on a
            case-by-case basis in each validation class.

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate/StringLength.php';

$validator = new Zend_Validate_StringLength(8, 12);

if (!validator->isValid('word')) {
    echo 'Word failed: '
        . $validator->value
        . '; its length is not between '
        . $validator->min
        . ' and '
        . $validator->max
        . "\n";
}]]>
            </programlisting>
        </para>

    </sect2>

    <sect2 id="zend.validate.introduction.static">

        <title>Using the static <code>is()</code> method</title>

        <para>
            If it's inconvenient to load a given validation class and create an
            instance of the validator, you can use the static method
            <code>Zend_Validate::is()</code> as an alternative invocation
            style.  The first argument of this method is a data input value,
            that you would pass to the <code>isValid()</code> method.  The
            second argument is a string, which corresponds to the basename of
            the validation class, relative to the <code>Zend_Validate</code>
            namespace.  The <code>is()</code> method automatically loads the
            class, creates an instance, and applies the <code>isValid()</code>
            method to the data input.

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate.php';

if (Zend_Validate::is($email, 'EmailAddress')) {
    // Yes, email appears to be valid
}]]>
            </programlisting>

        </para>

        <para>
            You can also pass an array of constructor arguments, if they
            are needed for the validator.

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Validate.php';

if (Zend_Validate::is($value, 'Between', array(1, 12))) {
    // Yes, $value is between 1 and 12
}]]>
            </programlisting>

        </para>

        <para>
            The <code>is()</code> method returns a boolean value, the same as
            the <code>isValid()</code> method.  When using the static
            <code>is()</code> method, validation failure messages are not
            available.
        </para>

        <para>
            The static usage can be convenient for invoking a validator ad hoc,
            but if you have the need to run a validator for multiple inputs,
            it's more efficient to use the non-static usage, creating an
            instance of the validator object and calling its
            <code>isValid()</code> method.
        </para>

        <para>
            Also, the <code>Zend_Filter_Input</code> class allows you to
            instantiate and run multiple filter and validator classes on demand
            to process sets of input data. See
            <xref linkend="zend.filter.input" />.
        </para>

    </sect2>


</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.version.reading">

    <title>Reading the Zend Framework Version</title>

    <para>
        The class constant <code>Zend_Version::VERSION</code>
        contains a string that identifies the current version
        number of Zend Framework.  For example, "0.9.0beta".
    </para>

    <para>
        The static method <code>Zend_Version::compareVersion($version)</code>
        is based on the PHP function
        <ulink url="http://php.net/version_compare"><code>version_compare()</code></ulink>.
        The method returns -1 if the specified <code>$version</code>
        is older than the Zend Framework version, 0 if they are the same,
        and +1 if the specified <code>$version</code> is newer than the
        Zend Framework version.
    </para>

    <example id="zend.version.reading.example">
        <title>Example of compareVersion() method</title>
        <programlisting role="php"><![CDATA[<?php
// returns -1, 0 or 1
$cmp = Zend_Version::compareVersion('1.0.0');]]>
        </programlisting>
    </example>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.view.abstract">
    <title>Zend_View_Abstract</title>

    <para>
        <code>Zend_View_Abstract</code> is the base class on which
        <code>Zend_View</code> is built; <code>Zend_View</code> itself simply
        extends it and declares a concrete implementation of the
        <code>_run()</code> method (which is invoked by <code>render()</code>).
    </para>

    <para>
        Many developers find that they want to extend
        <code>Zend_View_Abstract</code> to add custom functionality, and
        inevitably run into issues with its design, which includes a number of
        private members. This document aims to explain the decision behind the
        design.
    </para>

    <para>
        <code>Zend_View</code> is something of an anti-templating engine in that
        it uses PHP natively for its templating. As a result, all of PHP is
        available, and view scripts inherit the scope of their calling object.
    </para>

    <para>
        It is this latter point that is salient to the design decisions.
        Internally, <code>Zend_View::_run()</code> does the following:
    </para>

    <programlisting role="php"><![CDATA[<?php
protected function _run()
{
    include func_get_arg(0);
}
?>]]></programlisting>

    <para>
        As such, the view scripts have access to the current object
        (<code>$this</code>), <emphasis>and any methods or members of that
            object</emphasis>. Since many operations depend on members with
        limited visibility, this poses a problem: the view scripts could
        potentially make calls to such methods or modify critical properties
        directly. Imagine a script overwriting <code>$_path</code> or
        <code>$_file</code> inadvertently -- any further calls to
        <code>render()</code> or view helpers would break!
    </para>

    <para>
        Fortunately, PHP 5 has an answer to this with its visibility
        declarations: private members are not accessible by objects extending a
        given class. This led to the current design: since
        <code>Zend_View</code> <emphasis>extends</emphasis>
        <code>Zend_View_Abstract</code>, view scripts are thus limited to only
        protected or public methods and members of
        <code>Zend_View_Abstract</code> -- effectively limiting the actions it
        can perform, and allowing us to secure critical areas from abuse by view
        scripts.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.view.controllers">
    <title>Controller Scripts</title>

    <para>
        The controller is where you instantiate and configure Zend_View.
        You then assign variables to the view, and tell the view to
        render output using a particular script.
    </para>

    <sect2 id="zend.view.controllers.assign">

        <title>Assigning Variables</title>

        <para>
            Your controller script should assign necessary variables to the view
            before it hands over control to the view script.  Normally, you
            can do assignments one at a time by assigning to property names
            of the view instance:
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();
$view->a = "Hay";
$view->b = "Bee";
$view->c = "Sea";]]>
        </programlisting>

        <para>
            However, this can be tedious when you have already collected the
            values to be assigned into an array or object.
        </para>

        <para>
            The assign() method lets you assign from an array or object "in
            bulk."  The following examples have the same effect as the above
            one-by-one property assignments.
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();

// assign an array of key-value pairs, where the
// key is the variable name, and the value is
// the assigned value.
$array = array(
    'a' => "Hay",
    'b' => "Bee",
    'c' => "Sea",
);
$view->assign($array);

// do the same with an object's public properties;
// note how we cast it to an array when assigning.
$obj = new StdClass;
$obj->a = "Hay";
$obj->b = "Bee";
$obj->c = "Sea";
$view->assign((array) $obj);]]>
        </programlisting>

        <para>
            Alternatively, you can use the assign method to assign
            one-by-one by passing a string variable name, and then the
            variable value.
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();
$view->assign('a', "Hay");
$view->assign('b', "Bee");
$view->assign('c', "Sea");]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.view.controllers.render">

        <title>Rendering a View Script</title>

        <para>
            Once you have assigned all needed variables, the controller
            should tell Zend_View to render a particular view script.
            Do so by calling the render() method.  Note that the method will
            return the rendered view, not print it, so you need to print or
            echo it yourself at the appropriate time.
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();
$view->a = "Hay";
$view->b = "Bee";
$view->c = "Sea";
echo $view->render('someView.php');]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.view.controllers.script-paths">

        <title>View Script Paths</title>

        <para>
            By default, Zend_View expects your view scripts to be relative to
            your calling script.  For example, if your controller script is at
            "/path/to/app/controllers" and it calls
            $view->render('someView.php'), Zend_View will look for
            "/path/to/app/controllers/someView.php".
        </para>

        <para>
            Obviously, your view scripts are probably located elsewhere.  To
            tell Zend_View where it should look for view scripts, use the
            setScriptPath() method.
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();
$view->setScriptPath('/path/to/app/views');]]>
        </programlisting>

        <para>
            Now when you call $view->render('someView.php'), it will look
            for "/path/to/app/views/someView.php".
        </para>

        <para>
            In fact, you can "stack" paths using the addScriptPath()
            method. As you add paths to the stack, Zend_View will look
            at the most-recently-added path for the requested view
            script.  This allows you override default views with custom
            views so that you may create custom "themes" or "skins" for
            some views, while leaving others alone.
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();
$view->addScriptPath('/path/to/app/views');
$view->addScriptPath('/path/to/custom/');

// now when you call $view->render('booklist.php'), Zend_View will
// look first for "/path/to/custom/booklist.php", then for
// "/path/to/app/views/booklist.php", and finally in the current
// directory for "booklist.php".]]>
        </programlisting>

    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
--><sect3 id="zend.view.helpers.initial.action">
    <title>Action View Helper</title>

    <para>
        The <code>Action</code> view helper enables view scripts to dispatch a
        given controller action; the result of the response object following the
        dispatch is then returned. These can be used when a particular action
        could generate re-usable content or "widget-ized" content.
    </para>

    <para>
        Actions that result in a <code>_forward()</code> or redirect are
        considered invalid, and will return an empty string.
    </para>

    <para>
        The API for the <code>Action</code> view helper follows that of most MVC
        components that invoke controller actions: <code>action($action,
            $controller, $module = null, array $params = array())</code>.
        <code>$action</code> and <code>$controller</code> are required; if no
        module is specified, the default module is assumed.
    </para>

    <example id="zend.view.helpers.initial.action.usage">
        <title>Basic Usage of Action View Helper</title>

        <para>
            As an example, you may have a <code>CommentController</code> with a
            <code>listAction()</code> method you wish to invoke in order to pull
            a list of comments for the current request:
        </para>

        <programlisting role="php"><![CDATA[
<div id="sidebar right"> 
    <div class="item">
        <?= $this->action('list', 'comment', null, array('count' => 10)); ?> 
    </div>
</div>
]]></programlisting>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.doctype">
    <title>Doctype Helper</title>

    <para>
        Valid HTML and XHTML documents should include a <code>DOCTYPE</code>
        declaration. Besides being difficult to remember, these can also affect
        how certain elements in your document should be rendered (for instance,
        CDATA escaping in <code>&lt;script&gt;</code> and
        <code>&lt;style&gt;</code> elements.
    </para>

    <para>
        The <code>Doctype</code> helper allows you to specify one of the
        following types:
    </para>

    <itemizedlist>
        <listitem><para><code>XHTML11</code></para></listitem>
        <listitem><para><code>XHTML1_STRICT</code></para></listitem>
        <listitem><para><code>XHTML1_TRANSITIONAL</code></para></listitem>
        <listitem><para><code>XHTML1_FRAMESET</code></para></listitem>
        <listitem><para><code>XHTML_BASIC1</code></para></listitem>
        <listitem><para><code>HTML4_STRICT</code></para></listitem>
        <listitem><para><code>HTML4_LOOSE</code></para></listitem>
        <listitem><para><code>HTML4_FRAMESET</code></para></listitem>
    </itemizedlist>

    <para>
        You can also specify a custom doctype as long as it is well-formed.
    </para>

    <para>
        The <code>Doctype</code> helper is a concrete implementation of the 
        <link linkend="zend.view.helpers.initial.placeholder">Placeholder
            helper</link>.
    </para>

    <example id="zend.view.helpers.initial.doctype.basicusage">
        <title>Doctype Helper Basic Usage</title>

        <para>
            You may specify the doctype at any time. However, probably the
            simplest use case is to specify it and output it at the same time,
            at the top of your layout script:
        </para>

        <programlisting role="php"><![CDATA[
<?= $this->doctype('XHTML1_STRICT') ?>
]]></programlisting>
        
        <para>
            From this point forward, any helpers that depend on the doctype for
            their output will be doctype aware -- and the doctype will be
            present in your document.
        </para>
    </example>

    <example id="zend.view.helpers.initial.doctype.retrieving">
        <title>Retrieving the Doctype</title>

        <para>
            If you need to know the doctype later, you can do so by calling
            <code>getDoctype()</code> on the object, which is returned by
            invoking the helper.
        </para>

        <programlisting role="php"><![CDATA[<?php
$doctype = $view->doctype()->getDoctype();
?>]]></programlisting>

        <para>
            Typically, you'll simply want to know if the doctype is XHTML or
            not; for this, the <code>isXhtml()</code> method will suffice:
        </para>

        <programlisting role="php"><![CDATA[<?php
if ($view->doctype()->isXhtml()) {
    // do something differently
}
?>]]></programlisting>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.headlink">
    <title>HeadLink Helper</title>

    <para>
        The HTML <code>&lt;link&gt;</code> element is increasingly used for
        linking a variety of resources for your site: stylesheets, feeds,
        favicons, trackbacks, and more. The <code>HeadTitle</code> helper
        provides a simple interface for creating and aggregating these elements
        for later retrieval and output in your layout script.
    </para>

    <para>
        The <code>HeadLink</code> helper has special methods for adding
        stylesheet links to its stack:
    </para>

    <itemizedlist>
        <listitem><para><code>appendStylesheet($href, $media,
                    $conditionalStylesheet)</code></para></listitem>
        <listitem><para><code>offsetSetStylesheet($index, $href, $media,
                    $conditionalStylesheet)</code></para></listitem>
        <listitem><para><code>prependStylesheet($href, $media,
                    $conditionalStylesheet)</code></para></listitem>
        <listitem><para><code>setStylesheet($href, $media,
                    $conditionalStylesheet)</code></para></listitem>
    </itemizedlist>

    <para>
        The <code>$media</code> value defaults to 'screen', but may be any valid
        media value. <code>$conditionalStylesheet</code> is a boolean, and will
        be used at rendering time to determine if special comments should be
        included to prevent loading of the stylesheet on certain platforms.
    </para>

    <para>
        Additionally, the <code>HeadLink</code> helper has special methods for
        adding 'alternate' links to its stack:
    </para>

    <itemizedlist>
        <listitem><para><code>appendAlternate($href, $type,
                    $title)</code></para></listitem>
        <listitem><para><code>offsetSetAlternate($index, $href, $type,
                    $title)</code></para></listitem>
        <listitem><para><code>prependAlternate($href, $type,
                    $title)</code></para></listitem>
        <listitem><para><code>setAlternate($href, $type,
                    $title)</code></para></listitem>
    </itemizedlist>

    <para>
        The <code>headLink()</code> helper method allows specifying all
        attributes necessary for a <code>&lt;link&gt;</code> element, and allows
        you to also specify placement -- whether the new element replaces all
        others, prepends (top of stack), or appends (end of stack).
    </para>

    <para>
        The <code>HeadLink</code> helper is a concrete implementation of the 
        <link linkend="zend.view.helpers.initial.placeholder">Placeholder
            helper</link>.
    </para>

    <example id="zend.view.helpers.initial.headlink.basicusage">
        <title>HeadLink Helper Basic Usage</title>

        <para>
            You may specify a <code>headLink</code> at any time. Typically, you
            will specify global links in your layout script, and application
            specific links in your application view scripts. In your layout
            script, in the &lt;head&gt; section, you will then echo the helper
            to output it.
        </para>

        <programlisting role="php"><![CDATA[
<?php // setting links in a view script:
$this->headLink()->appendStylesheet('/styles/basic.css')
                 ->headLink(array('rel' => 'favicon', 'href' => '/img/favicon.ico'), 'PREPEND')
                 ->prependStylesheet('/styles/moz.css', 'screen', true);
?>
<?php // rendering the links: ?>
<?= $this->headLink() ?>
]]></programlisting>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.headmeta">
    <title>HeadMeta Helper</title>

    <para>
        The HTML <code>&lt;meta&gt;</code> element is used to provide meta
        information about your HTML document -- typically keywords, document
        character set, caching pragmas, etc. Meta tags may be either of the
        'http-equiv' or 'name' types, must contain a 'content' attribute, and
        can also have either of the 'lang' or 'scheme' modifier attributes.
    </para>

    <para>
        The <code>HeadMeta</code> helper supports the following methods for
        setting and adding meta tags:
    </para>

    <itemizedlist>
        <listitem><para><code>appendName($keyValue, $content,
                    $conditionalName)</code></para></listitem>
        <listitem><para><code>offsetSetName($index, $keyValue, $content,
                    $conditionalName)</code></para></listitem>
        <listitem><para><code>prependName($keyValue, $content,
                    $conditionalName)</code></para></listitem>
        <listitem><para><code>setName($keyValue, $content,
                    $modifiers)</code></para></listitem>
        <listitem><para><code>appendHttpEquiv($keyValue, $content,
                    $conditionalHttpEquiv)</code></para></listitem>
        <listitem><para><code>offsetSetHttpEquiv($index, $keyValue, $content,
                    $conditionalHttpEquiv)</code></para></listitem>
        <listitem><para><code>prependHttpEquiv($keyValue, $content,
                    $conditionalHttpEquiv)</code></para></listitem>
        <listitem><para><code>setHttpEquiv($keyValue, $content,
                    $modifiers)</code></para></listitem>
    </itemizedlist>

    <para>
        The <code>$keyValue</code> item is used to define a value for the 'name'
        or 'http-equiv' key; <code>$content</code> is the value for the
        'content' key, and <code>$modifiers</code> is an optional associative
        array that can contain keys for 'lang' and/or 'scheme'.
    </para>

    <para>
        You may also set meta tags using the <code>headMeta()</code> helper
        method, which has the following signature: <code>headMeta($content,
            $keyValue, $keyType = 'name', $modifiers = array(), $placement =
            'APPEND')</code>. <code>$keyValue</code> is the content for the key
        specified in <code>$keyType</code>, which should be either 'name' or
        'http-equiv'. <code>$placement</code> can be either 'SET' (overwrites
        all previously stored values), 'APPEND' (added to end of stack), or
        'PREPEND' (added to top of stack).
    </para>

    <para>
        <code>HeadMeta</code> overrides each of <code>append()</code>,
        <code>offsetSet()</code>, <code>prepend()</code>, and <code>set()</code>
        to enforce usage of the special methods as listed above. Internally, it
        stores each item as a <code>stdClass</code> token, which it later
        serializes using the <code>itemToString()</code> method. This allows you
        to perform checks on the items in the stack, and optionally modify these
        items by simply modifying the object returned.
    </para>

    <para>
        The <code>HeadMeta</code> helper is a concrete implementation of the 
        <link linkend="zend.view.helpers.initial.placeholder">Placeholder
            helper</link>.
    </para>

    <example id="zend.view.helpers.initial.headmeta.basicusage">
        <title>HeadMeta Helper Basic Usage</title>

        <para>
            You may specify a new meta tag at any time. Typically, you
            will specify client-side caching rules or SEO keywords.
        </para>

        <para>
            For instance, if you wish to specify SEO keywords, you'd be creating
            a meta name tag with the name 'keywords' and the content the
            keywords you wish to associate with your page:
        </para>

        <programlisting role="php"><![CDATA[
<?php // setting meta keywords
$this->headMeta()->appendName('keywords', 'framework php productivity');
?>
]]></programlisting>

        <para>
            If you wishedto set some client-side caching rules, you'd set
            http-equiv tags with the rules you wish to enforce:
        </para>

        <programlisting role="php"><![CDATA[
<?php // disabling client-side cache
$this->headMeta()->appendHttpEquiv('expires', 'Wed, 26 Feb 1997 08:21:57 GMT')
                 ->appendHttpEquiv('pragma', 'no-cache')
                 ->appendHttpEquiv('Cache-Control', 'no-cache');
?>
]]></programlisting>

        <para>
            Another popular use for meta tags is setting the content type,
            character set, and language:
        </para>

        <programlisting role="php"><![CDATA[
<?php // setting content type and character set
$this->headMeta()->appendHttpEquiv('Content-Type', 'text/html; charset=UTF-8')
                 ->appendHttpEquiv('Content-Language', 'en-US');
?>
]]></programlisting>

        <para>
            As a final example, an easy way to display a transitional message
            before a redirect is using a "meta refresh":
        </para>

        <programlisting role="php"><![CDATA[
<?php // setting a meta refresh for 3 seconds to a new url:
$this->headMeta()->appendHttpEquiv('Refresh', '3;URL=http://www.some.org/some.html');
?>
]]></programlisting>

        <para>
            When you're ready to place your meta tags in the layout, simply echo
            the helper:
        </para>

        <programlisting role="php"><![CDATA[
<?= $this->headMeta() ?>
]]></programlisting>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.headscript">
    <title>HeadScript Helper</title>

    <para>
        The HTML <code>&lt;script&gt;</code> element is used to either provide
        inline client-side scripting elements or link to a remote resource
        containing client-side scripting code. The <code>HeadScript</code>
        helper allows you to manage both.
    </para>

    <para>
        The <code>HeadScript</code> helper supports the following methods for
        setting and adding scripts:
    </para>

    <itemizedlist>
        <listitem><para><code>appendFile($src, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
        <listitem><para><code>offsetSetFile($index, $src, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
        <listitem><para><code>prependFile($src, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
        <listitem><para><code>setFile($src, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
        <listitem><para><code>appendScript($script, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
        <listitem><para><code>offsetSetScript($index, $script, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
        <listitem><para><code>prependScript($script, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
        <listitem><para><code>setScript($script, $type = 'text/javascript',
                    $attrs = array())</code></para></listitem>
    </itemizedlist>

    <para>
        In the case of the <code>*File()</code> methods, <code>$src</code> is
        the remote location of the script to load; this is usually in the form
        of a URL or a path. For the <code>*Script()</code> methods,
        <code>$script</code> is the client-side scripting directives you wish to
        use in the element.
    </para>

    <para>
        <code>HeadScript</code> also allows capturing scripts; this can be
        useful if you want to create the client-side script programmatically,
        and then place it elsewhere. The usage for this will be showed in an
        example below.
    </para>

    <para>
        Finally, you can also use the <code>headScript()</code> method to
        quickly add script elements; the signature for this is
        <code>headScript($mode = 'FILE', $spec, $placement = 'APPEND')</code>.
        The <code>$mode</code> is either 'FILE' or 'SCRIPT', depending on if
        you're linking a script or defining one. <code>$spec</code> is either
        the script file to link or the script source itself.
        <code>$placement</code> should be either 'APPEND', 'PREPEND', or 'SET'.
    </para>

    <para>
        <code>HeadScript</code> overrides each of <code>append()</code>,
        <code>offsetSet()</code>, <code>prepend()</code>, and <code>set()</code>
        to enforce usage of the special methods as listed above. Internally, it
        stores each item as a <code>stdClass</code> token, which it later
        serializes using the <code>itemToString()</code> method. This allows you
        to perform checks on the items in the stack, and optionally modify these
        items by simply modifying the object returned.
    </para>

    <para>
        The <code>HeadScript</code> helper is a concrete implementation of the 
        <link linkend="zend.view.helpers.initial.placeholder">Placeholder
            helper</link>.
    </para>

    <note>
        <title>Use InlineScript for HTML Body Scripts</title>

        <para>
            <code>HeadScript</code>'s sibling helper, <link
                linkend="zend.view.helpers.initial.inlinescript">InlineScript</link>, 
            should be used when you wish to include scripts inline in the HTML
            <code>body</code>. Placing scripts at the end of your document is a
            good practice for speeding up delivery of your page, particularly
            when using 3rd party analytics scripts.
        </para>
    </note>

    <note>
        <title>Arbitrary Attributes are Disabled by Default</title>

        <para>
            By default, <code>HeadScript</code> only will render
            <code>&lt;script&gt;</code> attributes that are blessed by the W3C.
            These include 'type', 'charset', 'defer', 'language', and 'src.'
            However, some javascript frameworks, notably <ulink
                url="http://www.dojotoolkit.org/">Dojo</ulink>, utilize custom
            attributes in order to modify behavior. To allow such attributes,
            you can enable them via the
            <code>setAllowArbitraryAttributes()</code> method:
        </para>

        <programlisting role="php"><![CDATA[<?php
$this->headScript()->setAllowArbitraryAttributes(true);
?>]]></programlisting>
    </note>

    <example id="zend.view.helpers.initial.headscript.basicusage">
        <title>HeadScript Helper Basic Usage</title>

        <para>
            You may specify a new script tag at any time. As noted above, these
            may be links to outside resource files or scripts theselves.
        </para>

        <programlisting role="php"><![CDATA[
<?php // adding scripts
$this->headScript()->appendFile('/js/prototype.js')
                   ->appendScript($onloadScript);
?>
]]></programlisting>

        <para>
            Order is often important with client-side scripting; you may need to
            ensure that libraries are loaded in a specific order due to
            dependencies each have; use the various append, prepend, and
            offsetSet directives to aid in this task:
        </para>

        <programlisting role="php"><![CDATA[
<?php // Putting scripts in order

// place at a particular offset to ensure loaded last
$this->headScript()->offsetSetScript(100, '/js/myfuncs.js');

// use scriptaculous effects (append uses next index, 101)
$this->headScript()->appendScript('/js/scriptaculous.js');

// but always have base prototype script load first:
$this->headScript()->prependScript('/js/prototype.js');
?>
]]></programlisting>

        <para>
            When you're finally ready to output all scripts in your layout
            script, simply echo the helper:
        </para>

        <programlisting role="php"><![CDATA[
<?= $this->headScript() ?>
]]></programlisting>
    </example>

    <example id="zend.view.helpers.initial.headscript.capture">
        <title>Capturing Scripts Using the HeadScript Helper</title>

        <para>
            Sometimes you need to generate client-side scripts programmatically.
            While you could use string concatenation, heredocs, and the like,
            often it's easier just to do so by creating the script and
            sprinkling in PHP tags. <code>HeadScript</code> lets you do just
            that, capturing it to the stack:
        </para>

        <programlisting role="php"><![CDATA[
<?php $this->headScript()->captureStart() ?>
var action = '<?= $this->baseUrl ?>';
$('foo_form').action = action;
<?php $this->headScript()->captureEnd() ?>
]]></programlisting>

        <para>
            The following assumptions are made:
        </para>

        <itemizedlist>
            <listitem><para>
                    The script will be appended to the stack. If you wish for it
                    to replace the stack or be added to the top, you will need
                    to pass 'SET' or 'PREPEND', respectively, as the first
                    argument to <code>captureStart()</code>.
            </para></listitem>

            <listitem><para>
                    The script MIME type is assumed to be 'text/javascript'; if you
                    wish to specify a different type, you will need to pass it
                    as the second argument to <code>captureStart()</code>.
            </para></listitem>

            <listitem><para>
                    If you wish to specify any additional attributes for the
                    <code>&lt;script&gt;</code> tag, pass them in an array as
                    the third argument to <code>captureStart()</code>.
            </para></listitem>
        </itemizedlist>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.headstyle">
    <title>HeadStyle Helper</title>

    <para>
        The HTML <code>&lt;style&gt;</code> element is used to include
        CSS stylesheets inline in the HTML <code>&lt;head&gt;</code> element. 
    </para>

    <note>
        <title>Use HeadLink to link CSS files</title>

        <para>
            <link linkend="zend.view.helpers.initial.headlink">HeadLink</link>
            should be used to create <code>&lt;link&gt;</code> elements for
            including external stylesheets. <code>HeadScript</code> is used when
            you wish to define your stylesheets inline.
        </para>
    </note>

    <para>
        The <code>HeadStyle</code> helper supports the following methods for
        setting and adding stylesheet declarations:
    </para>

    <itemizedlist>
        <listitem><para><code>appendStyle($content, $attributes =
                    array())</code></para></listitem>
        <listitem><para><code>offsetSetStyle($index, $content, $attributes =
                    array())</code></para></listitem>
        <listitem><para><code>prependStyle($content, $attributes =
                    array())</code></para></listitem>
        <listitem><para><code>setStyle($content, $attributes =
                    array())</code></para></listitem>
    </itemizedlist>

    <para>
        In all cases, <code>$content</code> is the actual CSS declarations.
        <code>$attributes</code> are any additional attributes you wish to provide to the
        <code>style</code> tag: lang, title, media, or dir are all permissable.
    </para>

    <para>
        <code>HeadStyle</code> also allows capturing style declarations; this
        can be useful if you want to create the declarations programmatically,
        and then place them elsewhere. The usage for this will be showed in an
        example below.
    </para>

    <para>
        Finally, you can also use the <code>headStyle()</code> method to
        quickly add declarations elements; the signature for this is
        <code>headStyle($content$placement = 'APPEND', $attributes = array())</code>.
        <code>$placement</code> should be either 'APPEND', 'PREPEND', or 'SET'.
    </para>

    <para>
        <code>HeadStyle</code> overrides each of <code>append()</code>,
        <code>offsetSet()</code>, <code>prepend()</code>, and <code>set()</code>
        to enforce usage of the special methods as listed above. Internally, it
        stores each item as a <code>stdClass</code> token, which it later
        serializes using the <code>itemToString()</code> method. This allows you
        to perform checks on the items in the stack, and optionally modify these
        items by simply modifying the object returned.
    </para>

    <para>
        The <code>HeadStyle</code> helper is a concrete implementation of the 
        <link linkend="zend.view.helpers.initial.placeholder">Placeholder
            helper</link>.
    </para>

    <example id="zend.view.helpers.initial.headstyle.basicusage">
        <title>HeadStyle Helper Basic Usage</title>

        <para>
            You may specify a new style tag at any time:
        </para>

        <programlisting role="php"><![CDATA[
<?php // adding styles
$this->headStyle()->appendStyle($styles);
?>
]]></programlisting>

        <para>
            Order is very important with CSS; you may need to ensure that
            declarations are loaded in a specific order due to the order of the
            cascade; use the various append, prepend, and offsetSet directives
            to aid in this task:
        </para>

        <programlisting role="php"><![CDATA[
<?php // Putting styles in order

// place at a particular offset:
$this->headStyle()->offsetSetStyle(100, $customStyles);

// place at end:
$this->headStyle()->appendStyle($finalStyles);

// place at beginning
$this->headStyle()->prependStyle($firstStyles);
?>
]]></programlisting>

        <para>
            When you're finally ready to output all style declarations in your
            layout script, simply echo the helper:
        </para>

        <programlisting role="php"><![CDATA[
<?= $this->headStyle() ?>
]]></programlisting>
    </example>

    <example id="zend.view.helpers.initial.headstyle.capture">
        <title>Capturing Style Declarations Using the HeadStyle Helper</title>

        <para>
            Sometimes you need to generate CSS style declarations
            programmatically.  While you could use string concatenation,
            heredocs, and the like, often it's easier just to do so by creating
            the styles and sprinkling in PHP tags. <code>HeadStyle</code> lets
            you do just that, capturing it to the stack:
        </para>

        <programlisting role="php"><![CDATA[
<?php $this->headStyle()->captureStart() ?>
body {
    background-color: <?= $this->bgColor ?>;
}
<?php $this->headStyle()->captureEnd() ?>
]]></programlisting>

        <para>
            The following assumptions are made:
        </para>

        <itemizedlist>
            <listitem><para>
                    The style declarations will be appended to the stack. If you
                    wish for them to replace the stack or be added to the top,
                    you will need to pass 'SET' or 'PREPEND', respectively, as
                    the first argument to <code>captureStart()</code>.
            </para></listitem>

            <listitem><para>
                    If you wish to specify any additional attributes for the
                    <code>&lt;style&gt;</code> tag, pass them in an array as
                    the second argument to <code>captureStart()</code>.
            </para></listitem>
        </itemizedlist>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.headtitle">
    <title>HeadTitle Helper</title>

    <para>
        The HTML <code>&lt;title&gt;</code> element is used to provide a title
        for an HTML document. The <code>HeadTitle</code> helper allows you to
        programmatically create and store the title for later retrieval and
        output.
    </para>

    <para>
        The <code>HeadTitle</code> helper is a concrete implementation of the 
        <link linkend="zend.view.helpers.initial.placeholder">Placeholder
            helper</link>. It overrides the <code>toString()</code> method to
        enforce generating a <code>&lt;title&gt;</code> element, and adds a
        <code>headTitle()</code> method for quick and easy setting and
        aggregation of title elements. The signature for that method is
        <code>headTitle($title, $setType = 'APPEND')</code>; by default, the
        value is appended to the stack (aggregating title segments), but you may
        also specify either 'PREPEND' (place at top of stack) or 'SET'
        (overwrite stack).
    </para>

    <example id="zend.view.helpers.initial.headtitle.basicusage">
        <title>HeadTitle Helper Basic Usage</title>

        <para>
            You may specify a title tag at any time. A typical usage would have
            you setting title segments for each level of depth in your
            application: site, controller, action, and potentially resource.
        </para>

        <programlisting role="php"><![CDATA[<?php 
// setting the controller and action name as title segments:
$request = Zend_Controller_Front::getInstance()->getRequest();
$this->headTitle($request->getActionName())
     ->headTitle($request->getControllerName());

// setting the site in the title; possibly in the layout script:
$this->headTitle('Zend Framework');

// setting a separator string for segments:
$this->headTitle()->setSeparator(' / ');
?>
]]></programlisting>

        <para>
            When you're finally ready to render the title in your layout
            script, simply echo the helper:
        </para>

        <programlisting role="php"><![CDATA[
<!-- renders <action> / <controller> / Zend Framework -->
<?= $this->headTitle() ?>
]]></programlisting>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.inlinescript">
    <title>InlineScript Helper</title>

    <para>
        The HTML <code>&lt;script&gt;</code> element is used to either provide
        inline client-side scripting elements or link to a remote resource
        containing client-side scripting code. The <code>InlineScript</code>
        helper allows you to manage both. It is derived from <link
            linkend="zend.view.helpers.initial.headscript">HeadScript</link>,
        and any method of that helper is available; however, use the
        <code>inlineScript()</code> method in place of
        <code>headScript()</code>.
    </para>

    <note>
        <title>Use InlineScript for HTML Body Scripts</title>

        <para>
            <code>InlineScript</code>, should be used when you wish to include
            scripts inline in the HTML <code>body</code>. Placing scripts at the
            end of your document is a good practice for speeding up delivery of
            your page, particularly when using 3rd party analytics scripts.
        </para>

        <para>
            Some JS libraries need to be included in the HTML <code>head</code>;
            use <link linkend="zend.view.helpers.initial.headscript">HeadScript</link>
            for those scripts.
        </para>
    </note>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.json">
    <title>JSON Helper</title>

    <para>
        When creating views that return JSON, it's important to also set the
        appropriate response header. The JSON view helper does exactly that. In
        addition, by default, it disables layouts (if currently enabled), as
        layouts generally aren't used with JSON responses.
    </para>

    <para>
        The JSON helper sets the following header:
    </para>

    <programlisting role="text"><![CDATA[
Content-Type: application/json
]]></programlisting>

    <para>
        Most AJAX libraries look for this header when parsing responses to
        determine how to handle the content.
    </para>

    <para>
        Usage of the JSON helper is very straightforward:
    </para>

    <programlisting role="php"><![CDATA[<?php
<?= $this->json($this->data) ?>
?>]]></programlisting>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.partial">
    <title>Partial Helper</title>

    <para>
        The <code>Partial</code> view helper is used to render a specified
        template within its own variable scope. The primary use is for reusable
        template fragments with which you do not need to worry about variable
        name clashes. Additionally, they allow you to specify partial view
        scripts from specific modules.
    </para>

    <para>
        A sibling to the <code>Partial</code>, the <code>PartialLoop</code> view
        helper allows you to pass iterable data, and render a partial for each
        item.
    </para>

    <example id="zend.view.helpers.initial.partial.usage">
        <title>Basic Usage of Partials</title>

        <para>
            Basic usage of partials is to render a template fragment in its own
            view scope. Consider the following partial script:
        </para>

        <programlisting role="php"><![CDATA[
<?php // partial.phtml ?>
<ul>
    <li>From: <?= $this->escape($this->from) >?</li>
    <li>Subject: <?= $this->escape($this->subject) >?</li>
</ul>
]]></programlisting>

        <para>
            You would then call it from your view script using the following:
        </para>

        <programlisting role="php"><![CDATA[
<?= $this->partial('partial.phtml', array(
    'from' => 'Team Framework', 
    'subject' => 'view partials')); ?>
]]></programlisting>

        <para>
            Which would then render:
        </para>

        <programlisting role="html"><![CDATA[
<ul>
    <li>From: Team Framework</li>
    <li>Subject: view partials</li>
</ul>
]]></programlisting>

    </example>
        <note>
            <title>What is a model?</title>

            <para>
                A model used with the <code>Partial</code> view helper can be
                one of the following:
            </para>

            <itemizedlist>
                <listitem><para>
                        <emphasis>Array</emphasis>. If an array is passed, it
                        should be associative, as its key/value pairs are
                        assigned to the view with keys as view variables.
                </para></listitem>

                <listitem><para>
                        <emphasis>Object implementing toArray()
                            method</emphasis>. If an object is passed an has a
                        <code>toArray()</code> method, the results of
                        <code>toArray()</code> will be assigned to the view
                        object as view variables.
                </para></listitem>

                <listitem><para>
                        <emphasis>Standard object</emphasis>. Any other object
                        will assign the results of
                        <code>object_get_vars()</code> (essentially all public
                        properties of the object) to the view object.
                </para></listitem>
            </itemizedlist>
        </note>

    <example id="zend.view.helpers.initial.partial.partialloop">
        <title>Using PartialLoop to Render Iterable Models</title>

        <para>
            Typically, you'll want to use partials in a loop, to render the same
            content fragment many times; this way you can put large blocks of
            repeated content or complex display logic into a single location.
            However this has a performance impact, as the partial helper needs
            to be invoked once for each iteration.
        </para>

        <para>
            The <code>PartialLoop</code> view helper helps solve this issue. It
            allows you to pass an iterable item (array or object implementing
            <code>Iterator</code>) as the model. It then iterates over this,
            passing, the items to the partial script as the model. Items in the
            iterator may be any model the <code>Partial</code> view helper
            allows.
        </para>

        <para>
            Let's assume the following partial view script:
        </para>

        <programlisting role="php"><![CDATA[
<? // partialLoop.phtml ?>
    <dt><?= $this->key ?></dt>
    <dd><?= $this->value ?></dd>

]]></programlisting>

        <para>
            And the following "model":
        </para>

        <programlisting role="php"><![CDATA[<?php
$model = array(
    array('key' => 'Mammal', 'value' => 'Camel'),
    array('key' => 'Bird', 'value' => 'Penguin'),
    array('key' => 'Reptile', 'value' => 'Asp'),
    array('key' => 'Fish', 'value' => 'Flounder'),
);
?>]]></programlisting>

        <para>
            In your view script, you could then invoke the
            <code>PartialLoop</code> helper:
        </para>

        <programlisting role="php"><![CDATA[
<dl>
<?= $this->partialLoop('partialLoop.phtml', $model) ?>
</dl>
]]></programlisting>

        <programlisting role="html"><![CDATA[
<dl></dl>
    <dt>Mammal</dt>
    <dd>Camel</dd>

    <dt>Bird</dt>
    <dd>Penguin</dd>

    <dt>Reptile</dt>
    <dd>Asp</dd>

    <dt>Fish</dt>
    <dd>Flounder</dd>

</dl>
]]></programlisting>
    </example>

    <example id="zend.view.helpers.initial.partial.modules">
        <title>Rendering Partials in Other Modules</title>

        <para>
            Sometime a partial will exist in a different module. If you know the
            name of the module, you can pass it as the second argument to either
            <code>partial()</code> or <code>partialLoop()</code>, moving the
            <code>$model</code> argument to third position.
        </para>

        <para>
            For instance, if there's a pager partial you wish to use that's in
            the 'list' module, you could grab it as follows:
        </para>

        <programlisting role="php"><![CDATA[
<?= $this->partial('pager.phtml', 'list', $pagerData) ?>
]]></programlisting>

        <para>
            In this way, you can re-use partials created specifically for other
            modules. That said, it's likely a better practice to put re-usable
            partials in shared view script paths.
        </para>
    </example>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.placeholder">
    <title>Placeholder Helper</title>

    <para>
        The <code>Placeholder</code> view helper is used to persist content
        between view scripts and view instances. It also offers some useful
        features such as aggregating content, capturing view script content
        for later use, and adding pre- and post-text to content (and custom
        separators for aggregated content).
    </para>

    <example id="zend.view.helpers.initial.placeholder.usage">
        <title>Basic Usage of Placeholders</title>

        <para>
            Basic usage of placeholders is to persist view data. Each invocation
            of the <code>Placeholder</code> helper expects a placeholder name;
            the helper then returns a placeholder container object that you can
            either manipulate or simply echo out.
        </para>

        <programlisting role="php"><![CDATA[
<?php $this->placeholder('foo')->set("Some text for later") ?>

<?php 
    echo $this->placeholder('foo'); 
    // outputs "Some text for later"
?>
]]></programlisting>
    </example>

    <example id="zend.view.helpers.initial.placeholder.aggregation">
        <title>Using Placeholders to Aggregate Content</title>

        <para>
            Aggregating content via placeholders can be useful at times as well.
            For instance, your view script may have a variable array from which
            you wish to retrieve messages to display later; a later view script
            can then determine how those will be rendered.
        </para>

        <para>
            The <code>Placeholder</code> view helper uses containers that extend
            <code>ArrayObject</code>, providing a rich featureset for
            manipulating arrays. In addition, it offers a variety of methods for
            formatting the content stored in the container:
        </para>

        <itemizedlist>
            <listitem><para>
                    <code>setPrefix($prefix)</code> sets text with which to
                    prefix the content. Use <code>getPrefix()</code> at any time
                    to determine what the current setting is.
            </para></listitem>

            <listitem><para>
                    <code>setPostfix($prefix)</code> sets text with which to
                    append the content. Use <code>getPostfix()</code> at any time
                    to determine what the current setting is.
            </para></listitem>

            <listitem><para>
                    <code>setSeparator($prefix)</code> sets text with which to
                    separate aggregated content. Use <code>getSeparator()</code>
                    at any time to determine what the current setting is.
            </para></listitem>

            <listitem><para>
                    <code>setIndent($prefix)</code> can be used to set an
                    indentation value for content. If an integer is passed,
                    that number of spaces will be used; if a string is passed,
                    the string will be used.  Use <code>getIndent()</code>
                    at any time to determine what the current setting is.
            </para></listitem>
        </itemizedlist>

        <programlisting role="php"><![CDATA[
<!-- first view script -->
<?php $this->placeholder('foo')->exchangeArray($this->data) ?>
]]></programlisting>

        <programlisting role="php"><![CDATA[
<!-- later view script -->
<?php 
$this->placeholder('foo')->setPrefix("<ul>\n    <li>")
                         ->setSeparator("</li><li>\n") 
                         ->setIndent(4)
                         ->setPostfix("</li></ul>\n");
?>

<?php 
    echo $this->placeholder('foo'); 
    // outputs as unordered list with pretty indentation
?>
]]></programlisting>

        <para>
            Because the <code>Placeholder</code> container objects extend
            <code>ArrayObject</code>, you can also assign content to a specific
            key in the container easily, instead of simply pushing it into the
            container. Keys may be accessed either as object properties or as
            array keys.
        </para>

        <programlisting role="php"><![CDATA[
<?php $this->placeholder('foo')->bar = $this->data ?>
<?php echo $this->placeholder('foo')->bar ?>

<?php
$foo = $this->placeholder('foo');
echo $foo['bar'];
?>
]]></programlisting>
    </example>

    <example id="zend.view.helpers.initial.placeholder.capture">
        <title>Using Placeholders to Capture Content</title>

        <para>
            Occasionally you may have content for a placeholder in a view script
            that is easiest to template; the <code>Placeholder</code> view
            helper allows you to capture arbitrary content for later rendering
            using the following API.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>captureStart($type, $key)</code> begins capturing
                    content. 
                </para>

                <para>
                    <code>$type</code> should be one of the
                    <code>Placeholder</code> constants <code>APPEND</code> or
                    <code>SET</code>. If <code>APPEND</code>, captured content
                    is appended to the list of current content in the
                    placeholder; if <code>SET</code>, captured content is used
                    as the sole value of the placeholder (potentially replacing
                    any previous content). By default, <code>$type</code> is
                    <code>APPEND</code>.
                </para>

                <para>
                    <code>$key</code> can be used to specify a specific key in
                    the placeholder container to which you want content
                    captured.
                </para>

                <para>
                    <code>captureStart()</code> locks capturing until
                    <code>captureEnd()</code> is called; you cannot nest
                    capturing with the same placholder container. Doing so will
                    raise an exception.
                </para>
            </listitem>

            <listitem><para>
                    <code>captureEnd()</code> stops capturing content, and
                    places it in the container object according to how
                    <code>captureStart()</code> was called.
            </para></listitem>
        </itemizedlist>

        <programlisting role="php"><![CDATA[
<!-- Default capture: append -->
<?php $this->placeholder('foo')->captureStart() 
foreach ($this->data as $datum): ?>
<div class="foo">
    <h2><?= $datum->title ?></h2>
    <p><?= $datum->content ?></p>
</div>
<?php $this->placeholder('foo')->captureEnd() ?>

<?php echo $this->placeholder('foo') ?>
]]></programlisting>

        <programlisting role="php"><![CDATA[
<!-- Capture to key -->
<?php $this->placeholder('foo')->captureStart('SET', 'data') 
foreach ($this->data as $datum): ?>
<div class="foo">
    <h2><?= $datum->title ?></h2>
    <p><?= $datum->content ?></p>
</div>
<?php $this->placeholder('foo')->captureEnd() ?>

<?php echo $this->placeholder('foo')->data ?>
]]></programlisting>
    </example>

    <sect4 id="zend.view.helpers.initial.placeholder.implementations">
        <title>Concrete Placeholder Implementations</title>

        <para>
            Zend Framework ships with a number of "concrete" placeholder
            implementations. These are for commonly used placeholders: doctype,
            page title, and various &lt;head&gt; elements. In all cases, calling
            the placeholder with no arguments returns the element itself. 
        </para>

        <para>
            Documentation for each element is covered separately, as linked
            below:
        </para>

        <itemizedlist>
            <listitem><para>
                    <link linkend="zend.view.helpers.initial.doctype">Doctype</link>
            </para></listitem>

            <listitem><para>
                    <link linkend="zend.view.helpers.initial.headlink">HeadLink</link>
            </para></listitem>

            <listitem><para>
                    <link linkend="zend.view.helpers.initial.headmeta">HeadMeta</link>
            </para></listitem>

            <listitem><para>
                    <link linkend="zend.view.helpers.initial.headscript">HeadScript</link>
            </para></listitem>

            <listitem><para>
                    <link linkend="zend.view.helpers.initial.headstyle">HeadStyle</link>
            </para></listitem>

            <listitem><para>
                    <link linkend="zend.view.helpers.initial.headtitle">HeadTitle</link>
            </para></listitem>

            <listitem><para>
                    <link linkend="zend.view.helpers.initial.inlinescript">InlineScript</link>
            </para></listitem>
        </itemizedlist>
    </sect4>
</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect3 id="zend.view.helpers.initial.translate">

    <title>Translate Helper</title>

    <para>
        Often web sites are available in several languages. To translate the
        content of a site you should simply use <link
            linkend="zend.translate.introduction">Zend Translate</link> and to
        integrate <code>Zend Translate</code> within your view you should use
        the <code>Translate</code> View Helper.
    </para>


    <para>
        In all following examples we are using the simple Array Translation
        Adapter. Of course you can also use any instance of
        <code>Zend_Translate</code> and also any subclasses of
        <code>Zend_Translate_Adapter</code>. There are several ways to initiate
        the <code>Translate</code> View Helper:
    </para>

    <itemizedlist>
        <listitem>
            <para>
                Registered, through a previously registered instance in
                <code>Zend_Registry</code>
            </para>
        </listitem>
        <listitem>
            <para>
                Afterwards, through the fluent interface
            </para>
        </listitem>
        <listitem>
            <para>
                Directly, through initiating the class
            </para>
        </listitem>
    </itemizedlist>

    <para>
        A registered instance of <code>Zend_Translate</code> is the preferred
        usage for this helper.  You can also select the locale to be used simply
        before you add the adapter to the registry.
    </para>

    <note>
        <para>
            We are speaking of locales instead of languages because a language
            also may contain a region.  For example English is spoken in
            different dialects. There may be a translation for British and one
            for American English. Therefore, we say "locale" instead of
            "language."
        </para>
    </note>

    <example id="zend.view.helpers.initial.translate.registered">

        <title>Registered instance</title>

        <para>
            To use a registered instance just create an instance of
            <code>Zend_Translate</code> or <code>Zend_Translate_Adapter</code>
            and register it within <code>Zend_Registry</code> using
            <code>Zend_Translate</code> as its key.
        </para>

        <programlisting role="php"><![CDATA[<?php
// our example adapter
$adapter = new Zend_Translate('array', array('simple' => 'einfach'), 'de');
Zend_Registry::set('Zend_Translate', $adapter);

// within your view
echo $this->translate('simple');
// this returns 'einfach'
?>]]></programlisting>

    </example>

    <para>
        If you are more familiar with the fluent interface, then you can also
        create an instace within your view and initiate the helper afterwards.
    </para>

    <example id="zend.view.helpers.initial.translate.afterwards">

        <title>Within the view</title>

        <para>
            To use the fluent interface, create an instance of
            <code>Zend_Translate</code> or <code>Zend_Translate_Adapter</code>,
            call the helper without a parameter, and call the
            <code>setTranslator()</code> method.
        </para>

        <programlisting role="php"><![CDATA[<?php
// within your view
$adapter = new Zend_Translate('array', array('simple' => 'einfach'), 'de');
$this->translate()->setTranslator($adapter)->translate('simple');
// this returns 'einfach'
?>]]></programlisting>

    </example>

    <para>
        If you are using the helper without <code>Zend_View</code> then you can
        also use it directly.
    </para>

    <example id="zend.view.helpers.initial.translate.directly">

        <title>Direct usage</title>

        <programlisting role="php"><![CDATA[<?php
// our example adapter
$adapter = new Zend_Translate('array', array('simple' => 'einfach'), 'de');

// initiate the adapter
$translate = new Zend_View_Helper_Translate($adapter);
print $translate->translate('simple'); // this returns 'einfach'
?>]]></programlisting>

        <para>
            You would use this way if you are not working with
            <code>Zend_View</code> and need to create translated output.
        </para>

    </example>

    <para>
        As already seen, the <code>translate()</code> method is used to return
        the translation. Just call it with the needed messageid of your
        translation adapter. But it can also replace parameters within the
        translation string. Therefore, it accepts variable parameters in two ways:
        either as a list of parameters, or as an array of parameters. As examples:
    </para>

    <example id="zend.view.helpers.initial.translate.parameter">

        <title>Single parameter</title>

        <para>
            To use a single parameter just add it to the method.
        </para>

        <programlisting role="php"><![CDATA[<?php
// within your view
$date = "Monday";
$this->translate('Today is %1\$s', $date);
// could return 'Heute ist Monday'
?>]]></programlisting>

    </example>

    <note>
        <para>
            Keep in mind that if you are using parameters which are also text,
            you may also need to translate these parameters.
        </para>
    </note>

    <example id="zend.view.helpers.initial.translate.parameterlist">

        <title>List of parameters</title>

        <para>
            Or use a list of parameters and add it to the method.
        </para>

        <programlisting role="php"><![CDATA[<?php
// within your view
$date = "Monday";
$month = "April";
$time = "11:20:55";
$this->translate('Today is %1\$s in %2\$s. Actual time: %3\$s', $date, $month, $time);
// Could return 'Heute ist Monday in April. Aktuelle Zeit: 11:20:55'
?>]]></programlisting>

    </example>

    <example id="zend.view.helpers.initial.translate.parameterarray">

        <title>Array of parameters</title>

        <para>
            Or use an array of parameters and add it to the method.
        </para>

        <programlisting role="php"><![CDATA[<?php
// within your view
$date = array("Monday", "April", "11:20:55");
$this->translate('Today is %1\$s in %2\$s. Actual time: %3\$s', $date);
// Could return 'Heute ist Monday in April. Aktuelle Zeit: 11:20:55'
?>]]></programlisting>

    </example>

    <para>
        Sometimes it is necessary to change the locale of the translation. This
        can be done either dynamically per translation or statically for all
        following translations. And you can use it with both a parameter list
        and an array of parameters. In both cases the locale must be given as
        the last single parameter.
    </para>

    <example id="zend.view.helpers.initial.translate.dynamic">

        <title>Change locale dynamically</title>

        <programlisting role="php"><![CDATA[<?php
// within your view
$date = array("Monday", "April", "11:20:55");
$this->translate('Today is %1\$s in %2\$s. Actual time: %3\$s', $date, 'it');
?>]]></programlisting>

    </example>

    <para>
        This example returns the Italian translation for the messageid. But it
        will only be used once. The next translation will use the locale from
        the adapter. Normally you will set the desired locale within the
        translation adapter before you add it to the registry. But you can also
        set the locale from within the helper:
    </para>

    <example id="zend.view.helpers.initial.translate.static">

        <title>Change locale statically</title>

        <programlisting role="php"><![CDATA[<?php
// within your view
$date = array("Monday", "April", "11:20:55");
$this->setLocale('it')->translate('Today is %1\$s in %2\$s. Actual time: %3\$s', $date);
?>]]></programlisting>

    </example>

    <para>
        The above example sets <code>'it'</code> as the new default locale which
        will be used for all further translations.
    </para>

    <para>
        Of course there is also a <code>getLocale()</code> method to get the
        currently set locale. 
    </para>

    <example id="zend.view.helpers.initial.translate.getlocale">

        <title>Get the currently set locale</title>

        <programlisting role="php"><![CDATA[<?php
// within your view
$date = array("Monday", "April", "11:20:55");

// returns 'de' as set default locale from our above examples
$this->getLocale();

$this->setLocale('it')->translate('Today is %1\$s in %2\$s. Actual time: %3\$s', $date);

// returns 'it' as new set default locale
$this->getLocale();
?>]]></programlisting>

    </example>

</sect3>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.view.helpers" xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>View Helpers</title>

    <para>
        In your view scripts, often it is necessary to perform certain
        complex functions over and over: e.g., formatting a date,
        generating form elements, or displaying action links.  You can
        use helper classes to perform these behaviors for you.
    </para>

    <para>
        A helper is simply a class. Let's say we want a helper named 'fooBar'.
        By default, the class is prefixed with <code>'Zend_View_Helper_'</code>
        (you can specify a custom prefix when setting a helper path), and the
        last segment of the class name is the helper name; this segment should
        be TitleCapped; the full class name is then:
        <code>Zend_View_Helper_FooBar</code>. This class should contain at the
        minimum a single method, named after the helper, and camelCased:
        <code>fooBar()</code>.
    </para>

    <note>
        <title>Watch the Case</title>
        <para>
            Helper names are always camelCased, i.e., they never begin with an
            uppercase character. The class name itself is MixedCased, but the
            method that is actually executed is camelCased.
        </para>
    </note>

    <note>
        <title>Default Helper Path</title>

        <para>
            The default helper path always points to the Zend Framework view
            helpers, i.e., 'Zend/View/Helper/'. Even if you call
            <code>setHelperPath()</code> to overwrite the existing paths, this
            path will be set to ensure the default helpers work.
        </para>
    </note>


    <para>
        To use a helper in your view script, call it using
        <code>$this->helperName()</code>. Behind the scenes,
        <code>Zend_View</code> will load the
        <code>Zend_View_Helper_HelperName</code> class, create an object
        instance of it, and call its <code>helperName()</code> method.  The
        object instance is persistent within the <code>Zend_View</code>
        instance, and is reused for all future calls to
        <code>$this->helperName()</code>.
    </para>

    <sect2 id="zend.view.helpers.initial">
        <title>Initial Helpers</title>

        <para>
            <code>Zend_View</code> comes with an initial set of helper classes,
            most of which relate to form element generation and perform
            the appropriate output escaping automatically. In addition, there
            are helpers for creating route-based URLs and HTML lists, as well as
            declaring variables. The currently shipped helpers include:
        </para>

        <itemizedlist>

            <listitem><para>
                <code>declareVars():</code> Primarily for use when using
                <code>strictVars()</code>, this helper can be used to declare
                template variables that may or may not already be set in the
                view object, as well as to set default values.  Arrays passed as
                arguments to the method will be used to set default values;
                otherwise, if the variable does not exist, it is set to an empty
                string.
            </para></listitem>

            <listitem><para>
                <code>fieldset($name, $content, $attribs):</code> Creates an
                XHTML fieldset. If <code>$attribs</code> contains a 'legend'
                key, that value will be used for the fieldset legend. The
                fieldset will surround the <code>$content</code> as provided to
                the helper.
            </para></listitem>

            <listitem><para>
                <code>form($name, $attribs, $content):</code> Generates an XHTML
                form. All <code>$attribs</code> are escaped and rendered as
                XHTML attributes of the form tag. If <code>$content</code> is
                present and not a boolean false, then that content is rendered
                within the start and close form tags; if <code>$content</code>
                is a boolean false (the default), only the opening form tag is
                generated.
            </para></listitem>

            <listitem><para>
                <code>formButton($name, $value, $attribs):</code> Creates an
                &lt;input type="button" /&gt; element.
            </para></listitem>

            <listitem>
                <para>
                    <code>formCheckbox($name, $value, $attribs,
                        $options):</code> Creates an &lt;input type="checkbox"
                    /&gt; element.  
                </para>

                <para>
                    By default, when no $value is provided and no $options are
                    present, '0' is assumed to be the unchecked value, and '1'
                    the checked value. If a $value is passed, but no $options
                    are present, the checked value is assumed to be the value
                    passed.
                </para>

                <para>
                    $options should be an array. If the array is indexed, the
                    first value is the checked value, and the second the
                    unchecked value; all other values are ignored. You may also
                    pass an associative array with the keys 'checked' and
                    'unChecked'.
                </para>

                <para>
                    If $options has been passed, if $value matches the checked
                    value, then the element will be marked as checked. You may
                    also mark the element as checked or unchecked by passing a
                    boolean value for the attribute 'checked'.
                </para>

                <para>
                    The above is probably best summed up with some examples:
                </para>

                <programlisting role="php"><![CDATA[<?php
// '1' and '0' as checked/unchecked options; not checked
echo $this->formCheckbox('foo');

// '1' and '0' as checked/unchecked options; checked
echo $this->formCheckbox('foo', null, array('checked' => true));

// 'bar' and '0' as checked/unchecked options; not checked 
echo $this->formCheckbox('foo', 'bar');

// 'bar' and '0' as checked/unchecked options; checked 
echo $this->formCheckbox('foo', 'bar', array('checked' => true));

// 'bar' and 'baz' as checked/unchecked options; unchecked 
echo $this->formCheckbox('foo', null, null, array('bar', 'baz');

// 'bar' and 'baz' as checked/unchecked options; unchecked 
echo $this->formCheckbox('foo', null, null, array(
    'checked' => 'bar', 
    'unChecked' => 'baz'
));

// 'bar' and 'baz' as checked/unchecked options; checked 
echo $this->formCheckbox('foo', 'bar', null, array('bar', 'baz');
echo $this->formCheckbox('foo', null, array('checked' => true), array('bar', 'baz');

// 'bar' and 'baz' as checked/unchecked options; unchecked 
echo $this->formCheckbox('foo', 'baz', null, array('bar', 'baz');
echo $this->formCheckbox('foo', null, array('checked' => false), array('bar', 'baz');
]]></programlisting>

                <para>
                    In all cases, the markup prepends a hidden element with the
                    unchecked value; this way, if the value is unchecked, you
                    will still get a valid value returned to your form.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>formErrors($errors, $options):</code> Generates an
                    XHTML unordered list to show errors. <code>$errors</code>
                    should be a string or an array of strings;
                    <code>$options</code> should be any attributes you want
                    placed in the opening list tag.
                </para>

                <para>
                    You can specify alternate opening, closing, and separator
                    content when rendering the errors by calling several methods
                    on the helper:
                </para>

                <itemizedlist>
                    <listitem><para>
                            <code>setElementStart($string)</code>; default is
                            '&lt;ul class="errors"%s"&gt;&lt;li&gt;', where %s
                            is replaced with the attributes as specified in
                            <code>$options</code>.
                    </para></listitem>

                    <listitem><para>
                            <code>setElementSeparator($string)</code>; default
                            is '&lt;/li&gt;&lt;li&gt;'.
                    </para></listitem>

                    <listitem><para>
                            <code>setElementEnd($string)</code>; default is
                            '&lt;/li&gt;&lt;/ul&gt;'.
                    </para></listitem>
                </itemizedlist>
            </listitem>

            <listitem><para>
                <code>formFile($name, $value, $attribs):</code> Creates an
                &lt;input type="file" /&gt; element.
            </para></listitem>

            <listitem><para>
                <code>formHidden($name, $value, $attribs):</code> Creates an
                &lt;input type="hidden" /&gt; element.
            </para></listitem>

            <listitem><para>
                <code>formLabel($name, $value, $attribs):</code> Creates a
                &lt;label&gt; element, setting the <code>for</code> attribute to
                <code>$name</code>, and the actual label text to
                <code>$value</code>. If <code>disable</code> is passed in
                <code>attribs</code>, nothing will be returned.
            </para></listitem>

            <listitem><para>
                <code>formMultiCheckbox($name, $value, $attribs, $options,
                    $listsep):</code> Creates a list of checkboxes.
                <code>$options</code> should be an associative array, and may be
                arbitrarily deep. <code>$value</code> may be a single value or
                an array of selected values that match the keys in the
                <code>$options</code> array. <code>$listsep</code> is an HTML
                break ("&lt;br /&gt;") by default. By default, this element is
                treated as an array; all checkboxes share the same name, and are
                submitted as an array.
            </para></listitem>

            <listitem><para>
                <code>formPassword($name, $value, $attribs):</code> Creates an
                &lt;input type="password" /&gt; element.
            </para></listitem>

            <listitem><para>
                <code>formRadio($name, $value, $attribs, $options):</code>
                Creates a series of &lt;input type="radio" /&gt; elements, one
                for each of the $options elements.  In the $options array, the
                element key is the radio value, and the element value is the
                radio label.  The $value radio will be preselected for you.
            </para></listitem>

            <listitem><para>
                <code>formReset($name, $value, $attribs):</code> Creates an
                &lt;input type="reset" /&gt; element.
            </para></listitem>

            <listitem><para>
                <code>formSelect($name, $value, $attribs, $options):</code>
                Creates a &lt;select&gt;...&lt;/select&gt; block, with one
                &lt;option&gt;one for each of the $options elements.  In the
                $options array, the element key is the option value, and the
                element value is the option label.  The $value option(s) will be
                preselected for you.
            </para></listitem>

            <listitem><para>
                <code>formSubmit($name, $value, $attribs):</code> Creates an
                &lt;input type="submit" /&gt; element.
            </para></listitem>

            <listitem><para>
                <code>formText($name, $value, $attribs):</code> Creates an
                &lt;input type="text" /&gt; element.
            </para></listitem>

            <listitem><para>
                <code>formTextarea($name, $value, $attribs):</code> Creates a
                &lt;textarea&gt;...&lt;/textarea&gt; block.
            </para></listitem>

            <listitem><para>
                <code>url($urlOptions, $name, $reset):</code> Creates a URL
                string based on a named route. <code>$urlOptions</code> should
                be an associative array of key/value pairs used by the
                particular route.
            </para></listitem>

            <listitem><para>
                <code>htmlList($items, $ordered, $attribs, $escape):</code> generates
                unordered and ordered lists based on the <code>$items</code>
                passed to it. If <code>$items</code> is a multidimensional
                array, a nested list will be built. If the <code>$escape</code>
                flag is true (default), individual items will be escaped using
                the view objects registered escaping mechanisms; pass a false
                value if you want to allow markup in your lists.
            </para></listitem>

        </itemizedlist>

        <para>
            Using these in your view scripts is very easy, here is an example.
            Note that you all you need to do is call them; they will load
            and instantiate themselves as they are needed.
        </para>

        <programlisting role="php"><![CDATA[<?php
// inside your view script, $this refers to the Zend_View instance.
//
// say that you have already assigned a series of select options under
// the name $countries as array('us' => 'United States', 'il' =>
// 'Israel', 'de' => 'Germany').
?>
<form action="action.php" method="post">
    <p><label>Your Email:
        <?php echo $this->formText('email', 'you@example.com', array('size' => 32)) ?>
    </label></p>
    <p><label>Your Country:
        <?php echo $this->formSelect('country', 'us', null, $this->countries) ?>
    </label></p>
    <p><label>Would you like to opt in?
        <?php echo $this->formCheckbox('opt_in', 'yes', null, array('yes', 'no')) ?>
    </label></p>
</form>]]>
        </programlisting>

        <para>
            The resulting output from the view script will look something like this:
        </para>

        <programlisting role="php"><![CDATA[<form action="action.php" method="post">
    <p><label>Your Email:
        <input type="text" name="email" value="you@example.com" size="32" />
    </label></p>
    <p><label>Your Country:
        <select name="country">
            <option value="us" selected="selected">United States</option>
            <option value="il">Israel</option>
            <option value="de">Germany</option>
        </select>
    </label></p>
    <p><label>Would you like to opt in?
        <input type="hidden" name="opt_in" value="no" />
        <input type="checkbox" name="opt_in" value="yes" checked="checked" />
    </label></p>
</form>]]>
        </programlisting>

        <xi:include href="Zend_View-Helpers-Action.xml" />
        <xi:include href="Zend_View-Helpers-Partial.xml" />
        <xi:include href="Zend_View-Helpers-Placeholder.xml" />
        <xi:include href="Zend_View-Helpers-Doctype.xml" />
        <xi:include href="Zend_View-Helpers-HeadLink.xml" />
        <xi:include href="Zend_View-Helpers-HeadMeta.xml" />
        <xi:include href="Zend_View-Helpers-HeadScript.xml" />
        <xi:include href="Zend_View-Helpers-HeadStyle.xml" />
        <xi:include href="Zend_View-Helpers-HeadTitle.xml" />
        <xi:include href="Zend_View-Helpers-InlineScript.xml" />
        <xi:include href="Zend_View-Helpers-Json.xml" />
        <xi:include href="Zend_View-Helpers-Translate.xml" />
    </sect2>

    <sect2 id="zend.view.helpers.paths">
        <title>Helper Paths</title>

        <para>
            As with view scripts, your controller can specify a stack of paths
            for <code>Zend_View</code> to search for helper classes. By default,
            <code>Zend_View</code> looks in "Zend/View/Helper/*" for helper
            classes. You can tell <code>Zend_View</code> to look in other
            locations using the <code>setHelperPath()</code> and
            <code>addHelperPath()</code> methods.  Additionally, you can
            indicate a class prefix to use for helpers in the path provided, to
            allow namespacing your helper classes. By default, if no class
            prefix is provided, 'Zend_View_Helper_' is assumed.
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();

// Set path to /path/to/more/helpers, with prefix 'My_View_Helper'
$view->setHelperPath('/path/to/more/helpers', 'My_View_Helper');]]>
        </programlisting>


        <para>
            In fact, you can "stack" paths using the
            <code>addHelperPath()</code> method. As you add paths to the stack,
            <code>Zend_View</code> will look at the most-recently-added path for
            the requested helper class.  This allows you to add to (or even
            override) the initial distribution of helpers with your own custom
            helpers.
        </para>

        <programlisting role="php"><![CDATA[<?php
$view = new Zend_View();
// Add /path/to/some/helpers with class prefix 'My_View_Helper'
$view->addHelperPath('/path/to/some/helpers', 'My_View_Helper');
// Add /other/path/to/helpers with class prefix 'Your_View_Helper'
$view->addHelperPath('/other/path/to/helpers', 'Your_View_Helper');

// now when you call $this->helperName(), Zend_View will look first for
// "/other/path/to/helpers/HelperName.php" using class name "My_View_Helper_HelperName",
// then for "/path/to/some/helpers/HelperName" using class name "Your_View_Helper_HelperName",
// and finally for "Zend/View/Helper/HelperName.php" using class name "Zend_View_Helper_HelperName".]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.view.helpers.custom">
        <title>Writing Custom Helpers</title>

        <para>
            Writing custom helpers is easy; just follow these rules:
        </para>

        <itemizedlist>

            <listitem><para>
                The class name must, at the very minimum, end with the helper
                name itself, using MixedCaps.  E.g., if you were writing a
                helper called "specialPurpose", the class name would minimally
                need to be "SpecialPurpose". You may, and should, give the class
                name a prefix, and it is recommended that you use 'View_Helper'
                as part of that prefix: "My_View_Helper_SpecialPurpose". (You
                will need to pass in the prefix, with or without the trailing
                underscore, to <code>addHelperPath()</code> or
                <code>setHelperPath()</code>).
            </para></listitem>

            <listitem><para>
                The class must have a public method that matches the
                helper name; this is the method that will be called when
                your template calls "$this->specialPurpose()".  In our
                "specialPurpose" helper example, the required method
                declaration would be "public function specialPurpose()".
            </para></listitem>

            <listitem><para>
                In general, the class should not echo or print or otherwise
                generate output.  Instead, it should return values to be
                printed or echoed.  The returned values should be escaped
                appropriately.
            </para></listitem>

            <listitem><para>
                The class must be in a file named after the helper class.  Again
                using our "specialPurpose" helper example, the file has to be
                named "SpecialPurpose.php".
            </para></listitem>
        </itemizedlist>

        <para>
            Place the helper class file somewhere in your helper path stack, and
            <code>Zend_View</code> will automatically load, instantiate,
            persist, and execute it for you.
        </para>

        <para>
            Here is an example of our <code>SpecialPurpose</code> helper code:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_View_Helper_SpecialPurpose
{
    protected $_count = 0;
    public function specialPurpose()
    {
        $this->_count++;
        $output = "I have seen 'The Jerk' {$this->_count} time(s).";
        return htmlspecialchars($output);
    }
}]]>
        </programlisting>

        <para>
            Then in a view script, you can call the <code>SpecialPurpose</code>
            helper as many times as you like; it will be instantiated once, and
            then it persists for the life of that <code>Zend_View</code>
            instance.
        </para>

        <programlisting role="php"><![CDATA[<?php
// remember, in a view script, $this refers to the Zend_View instance.
echo $this->specialPurpose();
echo $this->specialPurpose();
echo $this->specialPurpose();]]>
        </programlisting>

        <para>
            The output would look something like this:
        </para>
        <programlisting role="php"><![CDATA[I have seen 'The Jerk' 1 time(s).
I have seen 'The Jerk' 2 time(s).
I have seen 'The Jerk' 3 time(s).]]>
        </programlisting>

        <para>
            Sometimes you will need access to the calling <code>Zend_View</code>
            object -- for instance, if you need to use the registered encoding,
            or want to render another view script as part of your helper. To get
            access to the view object, your helper class should have a
            <code>setView($view)</code> method, like the following:
        </para>

        <programlisting role="php"><![CDATA[<?php
class My_View_Helper_ScriptPath
{
    public $view;

    public function setView(Zend_View_Interface $view)
    {
        $this->view = $view;
    }

    public function scriptPath($script)
    {
        return $this->view->getScriptPath($script);
    }
}]]>
        </programlisting>

        <para>
            If your helper class has a <code>setView()</code> method, it will be
            called when the helper class is first instantiated, and passed the
            current view object. It is up to you to persist the object in your
            class, as well as determine how it should be accessed.
        </para>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.view.introduction">
    <title>Introduction</title>

    <para>
        <code>Zend_View</code> is a class for working with the "view" portion of
        the model-view-controller pattern.  That is, it exists to
        help keep the view script separate from the model and
        controller scripts.  It provides a system of helpers, output
        filters, and variable escaping.
    </para>

    <para>
        <code>Zend_View</code> is template system agnostic; you may use PHP as
        your template language, or create instances of other
        template systems and manipulate them within your view
        script.
    </para>

    <para>
        Essentially, using <code>Zend_View</code> happens in two major steps:

        1.  Your controller script creates an instance of
        Zend_View and assigns variables to that instance.

        2. The controller tells the <code>Zend_View</code> to render a particular
        view, thereby handing control over the view script, which
        generates the view output.
    </para>

    <sect2 id="zend.view.introduction.controller">
        <title>Controller Script</title>

        <para>
            As a simple example, let us say your controller has a list
            of book data that it wants to have rendered by a view.  The
            controller script might look something like this:
        </para>

        <programlisting role="php"><![CDATA[<?php
// use a model to get the data for book authors and titles.
$data = array(
    array(
        'author' => 'Hernando de Soto',
        'title' => 'The Mystery of Capitalism'
    ),
    array(
        'author' => 'Henry Hazlitt',
        'title' => 'Economics in One Lesson'
    ),
    array(
        'author' => 'Milton Friedman',
        'title' => 'Free to Choose'
    )
);

// now assign the book data to a Zend_View instance
Zend_Loader::loadClass('Zend_View');
$view = new Zend_View();
$view->books = $data;

// and render a view script called "booklist.php"
echo $view->render('booklist.php');]]>
        </programlisting>

    </sect2>

    <sect2 id="zend.view.introduction.view">

        <title>View Script</title>

        <para>
            Now we need the associated view script, "booklist.php".
            This is a PHP script like any other, with one exception:  it
            executes inside the scope of the <code>Zend_View</code> instance, which
            means that references to $this point to the Zend_View
            instance properties and methods.  (Variables assigned to the
            instance by the controller are public properties of the
            Zend_View instance.)  Thus, a very basic view script could
            look like this:
        </para>

        <programlisting role="php"><![CDATA[<?php if ($this->books): ?>

    <!-- A table of some books. -->
    <table>
        <tr>
            <th>Author</th>
            <th>Title</th>
        </tr>

        <?php foreach ($this->books as $key => $val): ?>
        <tr>
            <td><?php echo $this->escape($val['author']) ?></td>
            <td><?php echo $this->escape($val['title']) ?></td>
        </tr>
        <?php endforeach; ?>

    </table>

<?php else: ?>

    <p>There are no books to display.</p>

<?php endif;]]>
        </programlisting>

        <para>
            Note how we use the "escape()" method to apply output
            escaping to variables.
        </para>

    </sect2>

    <sect2 id="zend.view.introduction.options">
        <title>Options</title>

        <para>
            <code>Zend_View</code> has several options that may be set to
            configure the behaviour of your view scripts.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>basePath</code>: indicate a base path from which to set
                    the script, helper, and filter path. It assumes a directory
                    structure of:
                </para>

                <programlisting role="php"><![CDATA[
base/path/
    helpers/
    filters/
    scripts/]]>
                </programlisting>

                <para>
                    This may be set via <code>setBasePath()</code>,
                    <code>addBasePath()</code>, or the <code>basePath</code>
                    option to the constructor.
                </para>
            </listitem>

            <listitem><para>
                <code>encoding</code>: indicate the character encoding to use
                with <code>htmlentities()</code>,
                <code>htmlspecialchars()</code>, and other operations. Defaults
                to ISO-8859-1 (latin1). May be set via
                <code>setEncoding()</code> or the <code>encoding</code> option
                to the constructor.
            </para></listitem>

            <listitem><para>
                <code>escape</code>: indicate a callback to be used by
                <code>escape()</code>. May be set via <code>setEscape()</code>
                or the <code>escape</code> option to the constructor.
            </para></listitem>

            <listitem><para>
                <code>filter</code>: indicate a filter to use after rendering
                a view script. May be set via <code>setFilter()</code>,
                <code>addFilter()</code>, or the <code>filter</code> option to
                the constructor.
            </para></listitem>

            <listitem><para>
                <code>strictVars:</code> force <code>Zend_View</code> to emit
                notices and warnings when uninitialized view variables are
                accessed. This may be set by calling
                <code>strictVars(true)</code> or passing the
                <code>strictVars</code> option to the constructor.
            </para></listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.view.introduction.accessors">
        <title>Utility Accessors</title>

        <para>
            Typically, you'll only ever need to call on <code>assign()</code>,
            <code>render()</code>, or one of the methods for setting/adding
            filter, helper, and script paths. However, if you wish to extend
            <code>Zend_View</code> yourself, or need access to some of its
            internals, a number of accessors exist:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <code>getVars()</code> will return all assigned variables.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>clearVars()</code> will clear all assigned variables;
                    useful when you wish to re-use a view object, but want to
                    control what variables are available.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getScriptPath($script)</code> will retrieve the
                    resolved path to a given view script.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getScriptPaths()</code> will retrieve all registered
                    script paths.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getHelperPath($helper)</code> will retrieve the
                    resolved path to the named helper class.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getHelperPaths()</code> will retrieve all registered
                    helper paths.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getFilterPath($filter)</code> will retrieve the
                    resolved path to the named filter class.
                </para>
            </listitem>

            <listitem>
                <para>
                    <code>getFilterPaths()</code> will retrieve all registered
                    filter paths.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.view.scripts">

    <title>View Scripts</title>

    <para>
        Once your controller has assigned variables and called render(),
        Zend_View then includes the requested view script and executes
        it "inside" the scope of the Zend_View instance.  Therefore,
        in your view scripts, references to $this actually point to the
        Zend_View instance itself.
    </para>

    <para>
        Variables assigned to the view from the controller are referred
        to as instance properties.  For example, if the controller were
        to assign a variable 'something', you would refer to it as
        $this->something in the view script.  (This allows you to keep
        track of which values were assigned to the script, and which are
        internal to the script itself.)
    </para>

    <para>
        By way of reminder, here is the example view script from the
        Zend_View introduction.
    </para>

    <programlisting role="php"><![CDATA[<?php if ($this->books): ?>

    <!-- A table of some books. -->
    <table>
        <tr>
            <th>Author</th>
            <th>Title</th>
        </tr>

        <?php foreach ($this->books as $key => $val): ?>
        <tr>
            <td><?php echo $this->escape($val['author']) ?></td>
            <td><?php echo $this->escape($val['title']) ?></td>
        </tr>
        <?php endforeach; ?>

    </table>

<?php else: ?>

    <p>There are no books to display.</p>

<?php endif;]]>
    </programlisting>

    <sect2 id="zend.view.scripts.escaping">

        <title>Escaping Output</title>

        <para>
            One of the most important tasks to perform in a view script
            is to make sure that output is escaped properly; among other
            things, this helps to avoid cross-site scripting attacks.
            Unless you are using a function, method, or helper that does
            escaping on its own, you should always escape variables when
            you output them.
        </para>

        <para>
            Zend_View comes with a method called escape() that does such
            escaping for you.
        </para>

        <programlisting role="php"><![CDATA[<?php
// bad view-script practice:
echo $this->variable;

// good view-script practice:
echo $this->escape($this->variable);]]>
        </programlisting>

        <para>
            By default, the escape() method uses the PHP htmlspecialchars()
            function for escaping.  However, depending on your environment,
            you may wish for escaping to occur in a different way.  Use the
            setEscape() method at the controller level to tell Zend_View
            what escaping callback to use.
        </para>

        <programlisting role="php"><![CDATA[<?php
// create a Zend_View instance
$view = new Zend_View();

// tell it to use htmlentities as the escaping callback
$view->setEscape('htmlentities');

// or tell it to use a static class method as the callback
$view->setEscape(array('SomeClass', 'methodName'));

// or even an instance method
$obj = new SomeClass();
$view->setEscape(array($obj, 'methodName'));

// and then render your view
echo $view->render(...);]]>
        </programlisting>

        <para>
            The callback function or method should take the value to be
            escaped as its first parameter, and all other parameters should
            be optional.
        </para>

    </sect2>

    <sect2 id="zend.view.scripts.templates">
        <title>Using Alternate Template Systems</title>

        <para>
            Although PHP is itself a powerful template system, many developers
            feel it is too powerful or complex for their template designers and
            will want to use an alternate template engine. Zend_View provides
            two mechanisms for doing so, the first through view scripts, the
            second by implementing Zend_View_Interface.
        </para>

        <sect3 id="zend.view.scripts.templates.scripts">
            <title>Template Systems Using View Scripts</title>

            <para>
                A view script may be used to instantiate and manipulate a
                separate template object, such as a PHPLIB-style template.  The
                view script for that kind of activity might look something like
                this:
            </para>

            <programlisting role="php"><![CDATA[<?php
include_once 'template.inc';
$tpl = new Template();

if ($this->books) {
    $tpl->setFile(array(
        "booklist" => "booklist.tpl",
        "eachbook" => "eachbook.tpl",
    ));

    foreach ($this->books as $key => $val) {
        $tpl->set_var('author', $this->escape($val['author']);
        $tpl->set_var('title', $this->escape($val['title']);
        $tpl->parse("books", "eachbook", true);
    }

    $tpl->pparse("output", "booklist");
} else {
    $tpl->setFile("nobooks", "nobooks.tpl")
    $tpl->pparse("output", "nobooks");
}]]>´
            </programlisting>

            <para>
                These would be the related template files:
            </para>

            <programlisting role="html"><![CDATA[
<!-- booklist.tpl -->
<table>
    <tr>
        <th>Author</th>
        <th>Title</th>
    </tr>
    {books}
</table>

<!-- eachbook.tpl -->
    <tr>
        <td>{author}</td>
        <td>{title}</td>
    </tr>

<!-- nobooks.tpl -->
<p>There are no books to display.</p>]]>
            </programlisting>

        </sect3>

        <sect3 id="zend.view.scripts.templates.interface">
            <title>Template Systems Using Zend_View_Interface</title>

            <para>
                Some may find it easier to simply provide a Zend_View-compatible
                template engine. <code>Zend_View_Interface</code> defines the
                minimum interface needed for compatability:
            </para>

            <programlisting role="php"><![CDATA[
/**
 * Return the actual template engine object
 */
public function getEngine();

/**
 * Set the path to view scripts/templates
 */
public function setScriptPath($path);

/**
 * Set a base path to all view resources
 */
public function setBasePath($path, $prefix = 'Zend_View');

/**
 * Add an additional base path to view resources
 */
public function addBasePath($path, $prefix = 'Zend_View');

/**
 * Retrieve the current script paths
 */
public function getScriptPaths();

/**
 * Overloading methods for assigning template variables as object properties
 */
public function __set($key, $value);
public function __get($key);
public function __isset($key);
public function __unset($key);

/**
 * Manual assignment of template variables, or ability to assign multiple
 * variables en masse.
 */
public function assign($spec, $value = null);

/**
 * Unset all assigned template variables
 */
public function clearVars();

/**
 * Render the template named $name
 */
public function render($name);]]>
            </programlisting>

            <para>
                Using this interface, it becomes relatively easy to wrap a
                third-party template engine as a Zend_View-compatible class. As
                an example, the following is one potential wrapper for Smarty:
            </para>

            <programlisting role="php"><![CDATA[
require_once 'Zend/View/Interface.php';
require_once 'Smarty.class.php';

class Zend_View_Smarty implements Zend_View_Interface
{
    /**
     * Smarty object
     * @var Smarty
     */
    protected $_smarty;

    /**
     * Constructor
     *
     * @param string $tmplPath
     * @param array $extraParams
     * @return void
     */
    public function __construct($tmplPath = null, $extraParams = array())
    {
        $this->_smarty = new Smarty;

        if (null !== $tmplPath) {
            $this->setScriptPath($tmplPath);
        }

        foreach ($extraParams as $key => $value) {
            $this->_smarty->$key = $value;
        }
    }

    /**
     * Return the template engine object
     *
     * @return Smarty
     */
    public function getEngine()
    {
        return $this->_smarty;
    }

    /**
     * Set the path to the templates
     *
     * @param string $path The directory to set as the path.
     * @return void
     */
    public function setScriptPath($path)
    {
        if (is_readable($path)) {
            $this->_smarty->template_dir = $path;
            return;
        }

        throw new Exception('Invalid path provided');
    }

    /**
     * Retrieve the current template directory
     *
     * @return string
     */
    public function getScriptPaths()
    {
        return array($this->_smarty->template_dir);
    }

    /**
     * Alias for setScriptPath
     *
     * @param string $path
     * @param string $prefix Unused
     * @return void
     */
    public function setBasePath($path, $prefix = 'Zend_View')
    {
        return $this->setScriptPath($path);
    }

    /**
     * Alias for setScriptPath
     *
     * @param string $path
     * @param string $prefix Unused
     * @return void
     */
    public function addBasePath($path, $prefix = 'Zend_View')
    {
        return $this->setScriptPath($path);
    }

    /**
     * Assign a variable to the template
     *
     * @param string $key The variable name.
     * @param mixed $val The variable value.
     * @return void
     */
    public function __set($key, $val)
    {
        $this->_smarty->assign($key, $val);
    }

    /**
     * Retrieve an assigned variable
     *
     * @param string $key The variable name.
     * @return mixed The variable value.
     */
    public function __get($key)
    {
        return $this->_smarty->get_template_vars($key);
    }

    /**
     * Allows testing with empty() and isset() to work
     *
     * @param string $key
     * @return boolean
     */
    public function __isset($key)
    {
        return (null !== $this->_smarty->get_template_vars($key));
    }

    /**
     * Allows unset() on object properties to work
     *
     * @param string $key
     * @return void
     */
    public function __unset($key)
    {
        $this->_smarty->clear_assign($key);
    }

    /**
     * Assign variables to the template
     *
     * Allows setting a specific key to the specified value, OR passing an array
     * of key => value pairs to set en masse.
     *
     * @see __set()
     * @param string|array $spec The assignment strategy to use (key or array of key
     * => value pairs)
     * @param mixed $value (Optional) If assigning a named variable, use this
     * as the value.
     * @return void
     */
    public function assign($spec, $value = null)
    {
        if (is_array($spec)) {
            $this->_smarty->assign($spec);
            return;
        }

        $this->_smarty->assign($spec, $value);
    }

    /**
     * Clear all assigned variables
     *
     * Clears all variables assigned to Zend_View either via {@link assign()} or
     * property overloading ({@link __get()}/{@link __set()}).
     *
     * @return void
     */
    public function clearVars()
    {
        $this->_smarty->clear_all_assign();
    }

    /**
     * Processes a template and returns the output.
     *
     * @param string $name The template to process.
     * @return string The output.
     */
    public function render($name)
    {
        return $this->_smarty->fetch($name);
    }
}]]>
            </programlisting>

            <para>
                In this example, you would instantiate the
                <code>Zend_View_Smarty</code> class instead of
                <code>Zend_View</code>, and then use it in roughly the same
                fashion as <code>Zend_View</code>:
            </para>

            <programlisting role="php"><![CDATA[
$view = new Zend_View_Smarty();
$view->setScriptPath('/path/to/templates');
$view->book = 'Zend PHP 5 Certification Study Guide';
$view->author = 'Davey Shafik and Ben Ramsey'
$rendered = $view->render('bookinfo.tpl');]]>
            </programlisting>

        </sect3>
    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.xmlrpc.introduction">
    <title>Introduction</title>

    <para>
        From its <ulink url="http://www.xmlrpc.com/">home page</ulink>,
        XML-RPC is described as a "...remote procedure calling using HTTP as the
        transport and XML as the encoding. XML-RPC is designed to be as simple
        as possible, while allowing complex data structures to be transmitted,
        processed and returned."
    </para>

    <para>
        The Zend Framework provides support for both consuming remote XML-RPC
        services and building new XML-RPC servers.
    </para>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.xmlrpc.client">
    <title>Zend_XmlRpc_Client</title>

    <sect2 id="zend.xmlrpc.client.introduction">
        <title>Introduction</title>

        <para>
            The Zend Framework provides support for consuming remote XML-RPC
            services as a client in the <code>Zend_XmlRpc_Client</code>
            package. Its major features include automatic type conversion
            between PHP and XML-RPC, a server proxy object, and access to
            server introspection capabilities.
        </para>

    </sect2>


    <sect2 id="zend.xmlrpc.client.method-calls">
        <title>Method Calls</title>

        <para>
            The constructor of <code>Zend_XmlRpc_Client</code> receives the
            URL of the remote XML-RPC server endpoint as its first parameter.
            The new instance returned may be used to call any number of
            remote methods at that endpoint.
        </para>

        <para>
            To call a remote method with the XML-RPC client, instantiate it
            and use the <code>call()</code> instance method. The code sample
            below uses a demonstration XML-RPC server on the Zend Framework
            website. You can use it for testing or exploring the
            <code>Zend_XmlRpc</code> components.
        </para>

        <example id="zend.xmlrpc.client.method-calls.example-1">
            <title>XML-RPC Method Call</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Client.php';

$client = new Zend_XmlRpc_Client('http://framework.zend.com/xmlrpc');

echo $client->call('test.sayHello');

// hello]]>
            </programlisting>
        </example>

        <para>
            The XML-RPC value returned from the remote method call will be
            automatically unmarshaled and cast to the equivalent PHP native
            type. In the example above, a PHP <code>string</code> is returned
            and is immediately ready to be used.
        </para>

        <para>
            The first parameter of the <code>call()</code> method receives the
            name of the remote method to call. If the remote method requires
            any parameters, these can be sent by supplying a second, optional
            parameter to <code>call()</code> with an <code>array</code> of
            values to pass to the remote method:
        </para>

        <example id="zend.xmlrpc.client.method-calls.example-2">
            <title>XML-RPC Method Call with Parameters</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Client.php';

$client = new Zend_XmlRpc_Client('http://framework.zend.com/xmlrpc');

$arg1 = 1.1;
$arg2 = 'foo';

$result = $client->call('test.sayHello', array($arg1, $arg2));

// $result is a native PHP type]]>
            </programlisting>
        </example>

        <para>
            If the remote method doesn't require parameters, this optional
            parameter may either be left out or an empty <code>array()</code>
            passed to it. The array of parameters for the remote method can
            contain native PHP types, <code>Zend_XmlRpc_Value</code>
            objects, or a mix of each.
        </para>

        <para>
            The <code>call()</code> method will automatically convert the
            XML-RPC response and return its equivalent PHP native type. A
            <code>Zend_XmlRpc_Response</code> object for the return value will
            also be available by calling the <code>getLastResponse()</code>
            method after the call.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.value.parameters">
        <title>Types and Conversions</title>
        <para>
            Some remote method calls require parameters.  These are given to
            the <code>call()</code> method of <code>Zend_XmlRpc_Client</code>
            as an array in the second parameter.  Each parameter may be
            given as either a native PHP type which will be automatically
            converted, or as an object representing a specific XML-RPC type
            (one of the <code>Zend_XmlRpc_Value</code> objects).
        </para>

        <sect3 id="zend.xmlrpc.value.parameters.php-native">
            <title>PHP Native Types as Parameters</title>
            <para>
                Parameters may be passed to <code>call()</code> as native PHP
                variables, meaning as a <code>string</code>,
                <code>integer</code>, <code>float</code>,
                <code>boolean</code>, <code>array</code>, or an
                <code>object</code>. In this case, each PHP native type will
                be auto-detected and converted into one of the XML-RPC types
                according to this table:
            </para>

            <table id="zend.xmlrpc.value.parameters.php-native.table-1">
                <title>PHP and XML-RPC Type Conversions</title>
                <tgroup cols="2">
                    <thead>
                        <row>
                            <entry>PHP Native Type</entry>
                            <entry>XML-RPC Type</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>integer</entry>
                            <entry>int</entry>
                        </row>
                        <row>
                            <entry>double</entry>
                            <entry>double</entry>
                        </row>
                        <row>
                            <entry>boolean</entry>
                            <entry>boolean</entry>
                        </row>
                        <row>
                            <entry>string</entry>
                            <entry>string</entry>
                        </row>
                        <row>
                            <entry>array</entry>
                            <entry>array</entry>
                        </row>
                        <row>
                            <entry>associative array</entry>
                            <entry>struct</entry>
                        </row>
                        <row>
                            <entry>object</entry>
                            <entry>array</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </sect3>

        <sect3 id="zend.xmlrpc.value.parameters.xmlrpc-value">
            <title><code>Zend_XmlRpc_Value</code> Objects as Parameters</title>
            <para>
                Parameters may also be created as <code>Zend_XmlRpc_Value</code>
                instances to specify an exact XML-RPC type.  The primary reasons
                for doing this are:

                <itemizedlist>
                    <listitem>
                        <para>
                            When you want to make sure the correct parameter
                            type is passed to the procedure (i.e. the
                            procedure requires an integer and you may get it
                            from a database as a string)
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            When the procedure requires <code>base64</code> or
                            <code>dateTime.iso8601</code> type (which doesn't exists as a
                            PHP native type)
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            When auto-conversion may fail (i.e. you want to
                            pass an empty XML-RPC struct as a parameter. Empty
                            structs are represented as empty arrays in PHP
                            but, if you give an empty array as a parameter it
                            will be auto-converted to an XML-RPC array since
                            it's not an associative array)
                        </para>
                    </listitem>
                </itemizedlist>
            </para>

            <para>
                There are two ways to create a <code>Zend_XmlRpc_Value</code>
                object: instantiate one of the <code>Zend_XmlRpc_Value</code>
                subclasses directly, or use the static factory method
                <code>Zend_XmlRpc_Value::getXmlRpcValue()</code>.
            </para>

            <table id="zend.xmlrpc.value.parameters.xmlrpc-value.table-1">
                <title><code>Zend_XmlRpc_Value</code> Objects for XML-RPC Types</title>
                <tgroup cols="3">
                    <thead>
                        <row>
                            <entry>XML-RPC Type</entry>
                            <entry><code>Zend_XmlRpc_Value</code> Constant</entry>
                            <entry><code>Zend_XmlRpc_Value</code> Object</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>int</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_INTEGER</code></entry>
                            <entry><code>Zend_XmlRpc_Value_Integer</code></entry>
                        </row>
                        <row>
                            <entry>double</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_DOUBLE</code></entry>
                            <entry><code>Zend_XmlRpc_Value_Double</code></entry>
                        </row>
                        <row>
                            <entry>boolean</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_BOOLEAN</code></entry>
                            <entry><code>Zend_XmlRpc_Value_Boolean</code></entry>
                        </row>
                        <row>
                            <entry>string</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_STRING</code></entry>
                            <entry><code>Zend_XmlRpc_Value_String</code></entry>
                        </row>
                        <row>
                            <entry>base64</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_BASE64</code></entry>
                            <entry><code>Zend_XmlRpc_Value_Base64</code></entry>
                        </row>
                        <row>
                            <entry>dateTime.iso8601</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_DATETIME</code></entry>
                            <entry><code>Zend_XmlRpc_Value_DateTime</code></entry>
                        </row>
                        <row>
                            <entry>array</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_ARRAY</code></entry>
                            <entry><code>Zend_XmlRpc_Value_Array</code></entry>
                        </row>
                        <row>
                            <entry>struct</entry>
                            <entry><code>Zend_XmlRpc_Value::XMLRPC_TYPE_STRUCT</code></entry>
                            <entry><code>Zend_XmlRpc_Value_Struct</code></entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>

            <para>
                <note>
                    <title>Automatic Conversion</title>
                    <para>
                        When building a new <code>Zend_XmlRpc_Value</code>
                        object, its value is set by a PHP type. The PHP type
                        will be converted to the specified type using
                        PHP casting. For example, if a string is given as a
                        value to the <code>Zend_XmlRpc_Value_Integer</code>
                        object, it will be converted using
                        <code>(int)$value</code>.
                    </para>
                </note>
            </para>
        </sect3>
    </sect2>

    <sect2 id="zend.xmlrpc.client.requests-and-responses">
        <title>Server Proxy Object</title>
        <para>
            Another way to call remote methods with the XML-RPC client is to
            use the server proxy.  This is a PHP object that proxies a remote
            XML-RPC namespace, making it work as close to a native PHP object
            as possible.
        </para>

        <para>
            To instantiate a server proxy, call the <code>getProxy()</code>
            instance method of <code>Zend_XmlRpc_Client</code>. This will
            return an instance of <code>Zend_XmlRpc_Client_ServerProxy</code>.
            Any method call on the server proxy object will be forwarded to
            the remote, and parameters may be passed like any other PHP
            method.
        </para>

        <example id="zend.xmlrpc.client.requests-and-responses.example-1">
            <title>Proxy the Default Namespace</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Client.php';

$client = new Zend_XmlRpc_Client('http://framework.zend.com/xmlrpc');

$server = $client->getProxy();           // Proxy the default namespace

$hello = $server->test->sayHello(1, 2);  // test.Hello(1, 2) returns "hello"]]>
            </programlisting>
        </example>

        <para>
            The <code>getProxy()</code> method receives an optional argument
            specifying which namespace of the remote server to proxy. If it
            does not receive a namespace, the default namespace will be
            proxied.  In the next example, the <code>test</code> namespace
            will be proxied:
        </para>

        <example id="zend.xmlrpc.client.requests-and-responses.example-2">
            <title>Proxy Any Namespace</title>
            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Client.php';

$client = new Zend_XmlRpc_Client('http://framework.zend.com/xmlrpc');

$test  = $client->getProxy('test');     // Proxy the "test" namespace

$hello = $test->sayHello(1, 2);         // test.Hello(1,2) returns "hello"]]>
            </programlisting>
        </example>

        <para>
            If the remote server supports nested namespaces of any depth,
            these can also be used through the server proxy. For example, if
            the server in the example above had a method
            <code>test.foo.bar()</code>, it could be called as
            <code>$test->foo->bar()</code>.
        </para>
    </sect2>


    <sect2 id="zend.xmlrpc.client.error-handling">
        <title>Error Handling</title>
        <para>
            Two kinds of errors can occur during an XML-RPC method call: HTTP
            errors and XML-RPC faults. The <code>Zend_XmlRpc_Client</code>
            recognizes each and provides the ability to detect and trap them
            independently.
        </para>

        <sect3 id="zend.xmlrpc.client.error-handling.http">
            <title>HTTP Errors</title>

            <para>
                If any HTTP error occurs, such as the remote HTTP server
                returns a <code>404 Not Found</code>, a
                <code>Zend_XmlRpc_Client_HttpException</code> will be thrown.
            </para>

            <example id="zend.xmlrpc.client.error-handling.http.example-1">
                <title>Handling HTTP Errors</title>

                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Client.php';

$client = new Zend_XmlRpc_Client('http://foo/404');

try {

    $client->call('bar', array($arg1, $arg2));

} catch (Zend_XmlRpc_Client_HttpException $e) {

    // $e->getCode() returns 404
    // $e->getMessage() returns "Not Found"

}]]>
                </programlisting>
            </example>

            <para>
                Regardless of how the XML-RPC client is used, the
                <code>Zend_XmlRpc_Client_HttpException</code> will be thrown
                whenever an HTTP error occurs.
            </para>
        </sect3>

        <sect3 id="zend.xmlrpc.client.error-handling.faults">
            <title>XML-RPC Faults</title>

            <para>
                An XML-RPC fault is analogous to a PHP exception. It is a
                special type returned from an XML-RPC method call that has
                both an error code and an error message. XML-RPC faults are
                handled differently depending on the context of how the
                <code>Zend_XmlRpc_Client</code> is used.
            </para>

            <para>
                When the <code>call()</code> method or the server
                proxy object is used, an XML-RPC fault will result in a
                <code>Zend_XmlRpc_Client_FaultException</code> being thrown.
                The code and message of the exception will map directly to
                their respective values in the original XML-RPC fault
                response.
            </para>

            <example id="zend.xmlrpc.client.error-handling.faults.example-1">
                <title>Handling XML-RPC Faults</title>

                <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Client.php';

$client = new Zend_XmlRpc_Client('http://framework.zend.com/xmlrpc');

try {

    $client->call('badMethod');

} catch (Zend_XmlRpc_Client_FaultException $e) {

    // $e->getCode() returns 1
    // $e->getMessage() returns "Unknown method"

}]]>
                </programlisting>
            </example>

            <para>
                When the <code>call()</code> method is used to make the
                request, the <code>Zend_XmlRpc_Client_FaultException</code> will be
                thrown on fault. A <code>Zend_XmlRpc_Response</code> object
                containing the fault will also be available by calling
                <code>getLastResponse()</code>.
            </para>

            <para>
                When the <code>doRequest()</code> method is used to make the
                request, it will not throw the exception. Instead, it will
                return a <code>Zend_XmlRpc_Response</code> object returned
                will containing the fault. This can be checked with
                <code>isFault()</code> instance method of
                <code>Zend_XmlRpc_Response</code>.
            </para>
        </sect3>

    </sect2>

    <sect2 id="zend.xmlrpc.client.introspection">
        <title>Server Introspection</title>
        <para>
            Some XML-RPC servers support the de facto introspection methods under the XML-RPC
            <code>system.</code> namespace.  <code>Zend_XmlRpc_Client</code> provides special
            support for servers with these capabilities.
        </para>

        <para>
            A <code>Zend_XmlRpc_Client_ServerIntrospection</code> instance may be retrieved by calling
            the <code>getIntrospector()</code> method of <code>Zend_XmlRpcClient</code>.  It can
            then be used to perform introspection operations on the server.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.client.request-to-response">
        <title>From Request to Response</title>
        <para>
            Under the hood, the <code>call()</code> instance method of <code>Zend_XmlRpc_Client</code>
            builds a request object (<code>Zend_XmlRpc_Request</code>) and sends it to another method,
            <code>doRequest()</code>, that returns a response object (<code>Zend_XmlRpc_Response</code>).
        </para>

        <para>
            The <code>doRequest()</code> method is also available for use directly:
        </para>

        <example id="zend.xmlrpc.client.request-to-response.example-1">
            <title>Processing Request to Response</title>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Client.php';

$client = new Zend_XmlRpc_Client('http://framework.zend.com/xmlrpc');

$request = new Zend_XmlRpc_Request();
$request->setMethod('test.sayHello');
$request->setParams(array('foo', 'bar'));

$client->doRequest($request);

// $server->getLastRequest() returns instanceof Zend_XmlRpc_Request
// $server->getLastResponse() returns instanceof Zend_XmlRpc_Response]]>
            </programlisting>
        </example>

        <para>
            Whenever an XML-RPC method call is made by the client through any
            means, either the <code>call()</code> method,
            <code>doRequest()</code> method, or server proxy, the last request
            object and its resultant response object will always be available
            through the methods <code>getLastRequest()</code> and
            <code>getLastResponse()</code> respectively.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.client.http-client">
        <title>HTTP Client and Testing</title>

        <para>
            In all of the prior examples, an HTTP client was never specified.
            When this is the case, a new instance of
            <code>Zend_Http_Client</code> will be created with its default
            options and used by <code>Zend_XmlRpc_Client</code> automatically.
        </para>

        <para>
            The HTTP client can be retrieved at any time with the
            <code>getHttpClient()</code> method. For most cases, the default
            HTTP client will be sufficient. However, the
            <code>setHttpClient()</code> method allows for a different HTTP
            client instance to be injected.
        </para>

        <para>
            The <code>setHttpClient()</code> is particularly useful for unit testing.  When combined
            with the <code>Zend_Http_Client_Adapter_Test</code>, remote services can be mocked
            out for testing.  See the unit tests for <code>Zend_XmlRpc_Client</code> for examples
            of how to do this.
        </para>
    </sect2>

</sect1>
<!--
vim:se ts=4 sw=4 et:
-->
<sect1 id="zend.xmlrpc.server">
    <title>Zend_XmlRpc_Server</title>

    <sect2 id="zend.xmlrpc.server.introduction">
        <title>Introduction</title>

        <para>Zend_XmlRpc_Server is intended as a fully-featured XML-RPC server,
            following <ulink url="http://www.xmlrpc.com/spec">the specifications
            outlined at www.xmlrpc.com</ulink>. Additionally, it implements the
            system.multicall() method, allowing boxcarring of requests.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.server.usage">
        <title>Basic Usage</title>

        <para>
            An example of the most basic use case:
        </para>

        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';
require_once 'My/Service/Class.php';

$server = new Zend_XmlRpc_Server();
$server->setClass('My_Service_Class');
echo $server->handle();]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.xmlrpc.server.structure">
        <title>Server Structure</title>

        <para>
            Zend_XmlRpc_Server is composed of a variety of components, ranging
            from the server itself to request, response, and fault objects.
        </para>

        <para>
            To bootstrap Zend_XmlRpc_Server, the developer must attach one or
            more classes or functions to the server, via the
            <code>setClass()</code> and <code>addFunction()</code> methods.
        </para>

        <para>
            Once done, you may either pass a <code>Zend_XmlRpc_Request</code>
            object to <code>Zend_XmlRpc_Server::handle()</code>, or it will
            instantiate a <code>Zend_XmlRpc_Request_Http</code> object if none
            is provided -- thus grabbing the request from
            <code>php://input</code>.
        </para>

        <para>
            <code>Zend_XmlRpc_Server::handle()</code> then attempts to
            dispatch to the appropriate handler based on the method
            requested. It then returns either a
            <code>Zend_XmlRpc_Response</code>-based object or a
            <code>Zend_XmlRpc_Server_Fault</code>object. These objects both have
            <code>__toString()</code> methods that create valid XML-RPC XML
            responses, allowing them to be directly echoed.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.server.conventions">
        <title>Conventions</title>
        <para>
            Zend_XmlRpc_Server allows the developer to attach functions and
            class method calls as dispatchable XML-RPC methods. Via
            Zend_Server_Reflection, it does introspection on all attached
            methods, using the function and method docblocks to determine the
            method help text and method signatures.
        </para>

        <para>
            XML-RPC types do not necessarily map one-to-one to PHP types.
            However, the code will do its best to guess the appropriate type
            based on the values listed in @param and @return lines. Some XML-RPC
            types have no immediate PHP equivalent, however, and should be
            hinted using the XML-RPC type in the phpdoc. These include:
        </para>

        <itemizedlist>
            <listitem><para>dateTime.iso8601, a string formatted as
                    YYYYMMDDTHH:mm:ss</para></listitem>
            <listitem><para>base64, base64 encoded data</para></listitem>
            <listitem><para>struct, any associative array</para></listitem>
        </itemizedlist>

        <para>
            An example of how to hint follows:
        </para>

        <programlisting role="php"><![CDATA[<?php
/**
* This is a sample function
*
* @param base64 $val1 Base64-encoded data
* @param dateTime.iso8601 $val2 An ISO date
* @param struct $val3 An associative array
* @return struct
*/
function myFunc($val1, $val2, $val3)
{
}]]>
        </programlisting>

        <para>
            PhpDocumentor does no validation of the types specified for params
            or return values, so this will have no impact on your API
            documentation. Providing the hinting is necessary, however, when the
            server is validating the parameters provided to the method call.
        </para>

        <para>
            It is perfectly valid to specify multiple types for both params and
            return values; the XML-RPC specification even suggests that
            system.methodSignature should return an array of all possible method
            signatures (i.e., all possible combinations of param and return
            values). You may do so just as you normally would with
            PhpDocumentor, using the '|' operator:
        </para>

        <programlisting role="php"><![CDATA[<?php
/**
* This is a sample function
*
* @param string|base64 $val1 String or base64-encoded data
* @param string|dateTime.iso8601 $val2 String or an ISO date
* @param array|struct $val3 Normal indexed array or an associative array
* @return boolean|struct
*/
function myFunc($val1, $val2, $val3)
{
}]]>
        </programlisting>

        <para>
            One note, however: allowing multiple signatures can lead to
            confusion for developers using the services; generally speaking, an
            XML-RPC method should only have a single signature.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.server.namespaces">
        <title>Utilizing Namespaces</title>

        <para>
            XML-RPC has a concept of namespacing; basically, it allows grouping
            XML-RPC methods by dot-delimited namespaces. This helps prevent
            naming collisions between methods served by different classes. As an
            example, the XML-RPC server is expected to server several methods in
            the 'system' namespace:
        </para>

        <itemizedlist>
            <listitem><para>system.listMethods</para></listitem>
            <listitem><para>system.methodHelp</para></listitem>
            <listitem><para>system.methodSignature</para></listitem>
        </itemizedlist>

        <para>
            Internally, these map to the methods of the same name in
            Zend_XmlRpc_Server.
        </para>

        <para>
            If you want to add namespaces to the methods you serve, simply
            provide a namespace to the appropriate method when attaching a
            function or class:
        </para>

        <programlisting role="php"><![CDATA[<?php
// All public methods in My_Service_Class will be accessible as
// myservice.METHODNAME
$server->setClass('My_Service_Class', 'myservice');

// Function 'somefunc' will be accessible as funcs.somefunc
$server->addFunction('somefunc', 'funcs');]]>
        </programlisting>
    </sect2>

    <sect2 id="zend.xmlrpc.server.request">
        <title>Custom Request Objects</title>

        <para>
            Most of the time, you'll simply use the default request type
            included with Zend_XmlRpc_Server, Zend_XmlRpc_Request_Http. However,
            there may be times when you need XML-RPC to be available via the CLI,
            a GUI, or other environment, or want to log incoming requests. To do
            so, you may create a custom request object that extends
            Zend_XmlRpc_Request. The most important thing to remember is to
            ensure that the getMethod() and getParams() methods are implemented
            so that the XML-RPC server can retrieve that information in order to
            dispatch the request.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.server.response">
        <title>Custom Responses</title>

        <para>
            Similar to request objects, Zend_XmlRpc_Server can return custom
            response objects; by default, a Zend_XmlRpc_Response_Http object is
            returned, which sends an appropriate Content-Type HTTP header for
            use with XML-RPC. Possible uses of a custom object would be to log
            responses, or to send responses back to STDOUT.
        </para>

        <para>
            To use a custom response class, use
            Zend_XmlRpc_Server::setResponseClass() prior to calling handle().
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.server.fault">
        <title>Handling Exceptions via Faults</title>

        <para>
            Zend_XmlRpc_Server catches Exceptions generated by a dispatched
            method, and generates an XML-RPC fault response when such an
            exception is caught. By default, however, the exception messages and
            codes are not used in a fault response. This is an intentional
            decision to protect your code; many exceptions expose more
            information about the code or environment than a developer would
            necessarily intend (a prime example includes database abstraction or
            access layer exceptions).
        </para>

        <para>
            Exception classes can be whitelisted to be used as fault responses,
            however. To do so, simply utilize
            Zend_XmlRpc_Server_Fault::attachFaultException() to pass an
            exception class to whitelist:
        </para>

        <programlisting role="php"><![CDATA[<?php
Zend_XmlRpc_Server_Fault::attachFaultException('My_Project_Exception');]]>
        </programlisting>

        <para>
            If you utilize an exception class that your other project exceptions
            inherit, you can then whitelist a whole family of exceptions at a
            time. Zend_XmlRpc_Server_Exceptions are always whitelisted, to
            allow reporting specific internal errors (undefined methods, etc.).
        </para>

        <para>
            Any exception not specifically whitelisted will generate a fault
            response with a code of '404' and a message of 'Unknown error'.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.server.caching">
        <title>Caching Server Definitions Between Requests</title>
        <para>
            Attaching many classes to an XML-RPC server instance can utilize a
            lot of resources; each class must introspect using the Reflection
            API (via Zend_Server_Reflection), which in turn generates a list of
            all possible method signatures to provide to the server class.
        </para>
        <para>
            To reduce this performance hit somewhat, Zend_XmlRpc_Server_Cache
            can be used to cache the server definition between requests. When
            combined with __autoload(), this can greatly increase performance.
        </para>
        <para>
            An sample usage follows:
        </para>
        <programlisting role="php"><![CDATA[<?php
require_once 'Zend/Loader.php';
require_once 'Zend/XmlRpc/Server.php';
require_once 'Zend/XmlRpc/Server/Cache.php';

function __autoload($class)
{
    Zend_Loader::loadClass($class);
}

$cacheFile = dirname(__FILE__) . '/xmlrpc.cache';
$server = new Zend_XmlRpc_Server();

if (!Zend_XmlRpc_Server_Cache::get($cacheFile, $server)) {
    require_once 'My/Services/Glue.php';
    require_once 'My/Services/Paste.php';
    require_once 'My/Services/Tape.php';

    $server->setClass('My_Services_Glue', 'glue');   // glue. namespace
    $server->setClass('My_Services_Paste', 'paste'); // paste. namespace
    $server->setClass('My_Services_Tape', 'tape');   // tape. namespace

    Zend_XmlRpc_Server_Cache::save($cacheFile, $server);
}

echo $server->handle();]]>
        </programlisting>
        <para>
            The above example attempts to retrieve a server definition from
            xmlrpc.cache in the same directory as the script. If unsuccessful,
            it loads the service classes it needs, attaches them to the server
            instance, and then attempts to create a new cache file with the
            server definition.
        </para>
    </sect2>

    <sect2 id="zend.xmlrpc.server.use">
        <title>Usage Examples</title>
        <para>
            Below are several usage examples, showing the full spectrum of
            options available to developers. Usage examples will each build
            on the previous example provided.
        </para>
        <sect3 id="zend.xmlrpc.server.use.case1">
            <title>Basic Usage</title>

            <para>
                The example below attaches a function as a dispatchable XML-RPC
                method and handles incoming calls.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';

/**
 * Return the MD5 sum of a value
 *
 * @param string $value Value to md5sum
 * @return string MD5 sum of value
 */
function md5Value($value)
{
    return md5($value);
}

$server = new Zend_XmlRpc_Server();
$server->addFunction('md5Value');
echo $server->handle();]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.xmlrpc.server.use.case2">
            <title>Attaching a class</title>

            <para>
                The example below illustrates attaching a class' public methods
                as dispatchable XML-RPC methods.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';
require_once 'Services/Comb.php';

$server = new Zend_XmlRpc_Server();
$server->setClass('Services_Comb');
echo $server->handle();]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.xmlrpc.server.use.case3">
            <title>Attaching several classes using namespaces</title>

            <para>
                The example below illustrates attaching several classes, each
                with their own namespace.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';
require_once 'Services/Comb.php';
require_once 'Services/Brush.php';
require_once 'Services/Pick.php';

$server = new Zend_XmlRpc_Server();
$server->setClass('Services_Comb', 'comb');   // methods called as comb.*
$server->setClass('Services_Brush', 'brush'); // methods called as brush.*
$server->setClass('Services_Pick', 'pick');   // methods called as pick.*
echo $server->handle();]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.xmlrpc.server.use.case4">
            <title>Specifying exceptions to use as valid fault responses</title>

            <para>
                The example below allows any Services_Exception-derived class to
                report its code and message in the fault response.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';
require_once 'Zend/XmlRpc/Server/Fault.php';
require_once 'Services/Exception.php';
require_once 'Services/Comb.php';
require_once 'Services/Brush.php';
require_once 'Services/Pick.php';

// Allow Services_Exceptions to report as fault responses
Zend_XmlRpc_Server_Fault::attachFaultException('Services_Exception');

$server = new Zend_XmlRpc_Server();
$server->setClass('Services_Comb', 'comb');   // methods called as comb.*
$server->setClass('Services_Brush', 'brush'); // methods called as brush.*
$server->setClass('Services_Pick', 'pick');   // methods called as pick.*
echo $server->handle();]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.xmlrpc.server.use.case5">
            <title>Utilizing a custom request object</title>

            <para>
                The example below instantiates a custom request object and
                passes it to the server to handle.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';
require_once 'Zend/XmlRpc/Server/Fault.php';
require_once 'Services/Request.php';
require_once 'Services/Exception.php';
require_once 'Services/Comb.php';
require_once 'Services/Brush.php';
require_once 'Services/Pick.php';

// Allow Services_Exceptions to report as fault responses
Zend_XmlRpc_Server_Fault::attachFaultException('Services_Exception');

$server = new Zend_XmlRpc_Server();
$server->setClass('Services_Comb', 'comb');   // methods called as comb.*
$server->setClass('Services_Brush', 'brush'); // methods called as brush.*
$server->setClass('Services_Pick', 'pick');   // methods called as pick.*

// Create a request object
$request = new Services_Request();

echo $server->handle($request);]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.xmlrpc.server.use.case6">
            <title>Utilizing a custom response object</title>

            <para>
                The example below illustrates specifying a custom response class
                for the returned response.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';
require_once 'Zend/XmlRpc/Server/Fault.php';
require_once 'Services/Request.php';
require_once 'Services/Response.php';
require_once 'Services/Exception.php';
require_once 'Services/Comb.php';
require_once 'Services/Brush.php';
require_once 'Services/Pick.php';

// Allow Services_Exceptions to report as fault responses
Zend_XmlRpc_Server_Fault::attachFaultException('Services_Exception');

$server = new Zend_XmlRpc_Server();
$server->setClass('Services_Comb', 'comb');   // methods called as comb.*
$server->setClass('Services_Brush', 'brush'); // methods called as brush.*
$server->setClass('Services_Pick', 'pick');   // methods called as pick.*

// Create a request object
$request = new Services_Request();

// Utilize a custom response
$server->setResponseClass('Services_Response');

echo $server->handle($request);]]>
            </programlisting>
        </sect3>

        <sect3 id="zend.xmlrpc.server.use.case7">
            <title>Cache server definitions between requests</title>

            <para>
                The example below illustrates caching server definitions
                between requests.
            </para>

            <programlisting role="php"><![CDATA[<?php
require_once 'Zend/XmlRpc/Server.php';
require_once 'Zend/XmlRpc/Server/Fault.php';
require_once 'Zend/XmlRpc/Server/Cache.php';
require_once 'Services/Request.php';
require_once 'Services/Response.php';
require_once 'Services/Exception.php';
require_once 'Services/Comb.php';
require_once 'Services/Brush.php';
require_once 'Services/Pick.php';

// Specify a cache file
$cacheFile = dirname(__FILE__) . '/xmlrpc.cache';

// Allow Services_Exceptions to report as fault responses
Zend_XmlRpc_Server_Fault::attachFaultException('Services_Exception');

$server = new Zend_XmlRpc_Server();

// Attempt to retrieve server definition from cache
if (!Zend_XmlRpc_Server_Cache::get($cacheFile, $server)) {
    $server->setClass('Services_Comb', 'comb');   // methods called as comb.*
    $server->setClass('Services_Brush', 'brush'); // methods called as brush.*
    $server->setClass('Services_Pick', 'pick');   // methods called as pick.*

    // Save cache
    Zend_XmlRpc_Server_Cache::save($cacheFile, $server));
}

// Create a request object
$request = new Services_Request();

// Utilize a custom response
$server->setResponseClass('Services_Response');

echo $server->handle($request);]]>
            </programlisting>
        </sect3>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 et:
-->


</d:InfElement></d:DocumentationCore>